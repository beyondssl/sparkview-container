var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(r){var K=0;return function(){return K<r.length?{done:!1,value:r[K++]}:{done:!0}}};$jscomp.arrayIterator=function(r){return{next:$jscomp.arrayIteratorImpl(r)}};$jscomp.makeIterator=function(r){var K="undefined"!=typeof Symbol&&Symbol.iterator&&r[Symbol.iterator];return K?K.call(r):$jscomp.arrayIterator(r)};$jscomp.arrayFromIterator=function(r){for(var K,V=[];!(K=r.next()).done;)V.push(K.value);return V};
$jscomp.arrayFromIterable=function(r){return r instanceof Array?r:$jscomp.arrayFromIterator($jscomp.makeIterator(r))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(r){var K=function(){};K.prototype=r;return new K};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(r,K,V){if(r==Array.prototype||r==Object.prototype)return r;r[K]=V.value;return r};$jscomp.getGlobal=function(r){r=["object"==typeof globalThis&&globalThis,r,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var K=0;K<r.length;++K){var V=r[K];if(V&&V.Math==Math)return V}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(r,K){var V=$jscomp.propertyToPolyfillSymbol[K];if(null==V)return r[K];V=r[V];return void 0!==V?V:r[K]};
$jscomp.polyfill=function(r,K,V,oa){K&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(r,K,V,oa):$jscomp.polyfillUnisolated(r,K,V,oa))};$jscomp.polyfillUnisolated=function(r,K,V,oa){V=$jscomp.global;r=r.split(".");for(oa=0;oa<r.length-1;oa++){var T=r[oa];if(!(T in V))return;V=V[T]}r=r[r.length-1];oa=V[r];K=K(oa);K!=oa&&null!=K&&$jscomp.defineProperty(V,r,{configurable:!0,writable:!0,value:K})};
$jscomp.polyfillIsolated=function(r,K,V,oa){var T=r.split(".");r=1===T.length;oa=T[0];oa=!r&&oa in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ya=0;ya<T.length-1;ya++){var da=T[ya];if(!(da in oa))return;oa=oa[da]}T=T[T.length-1];V=$jscomp.IS_SYMBOL_NATIVE&&"es6"===V?oa[T]:null;K=K(V);null!=K&&(r?$jscomp.defineProperty($jscomp.polyfills,T,{configurable:!0,writable:!0,value:K}):K!==V&&($jscomp.propertyToPolyfillSymbol[T]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(T):$jscomp.POLYFILL_PREFIX+
T,T=$jscomp.propertyToPolyfillSymbol[T],$jscomp.defineProperty(oa,T,{configurable:!0,writable:!0,value:K})))};
$jscomp.getConstructImplementation=function(){function r(){function V(){}new V;Reflect.construct(V,[],function(){});return new V instanceof V}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(r())return Reflect.construct;var K=Reflect.construct;return function(V,oa,T){V=K(V,oa);T&&Reflect.setPrototypeOf(V,T.prototype);return V}}return function(V,oa,T){void 0===T&&(T=V);T=$jscomp.objectCreate(T.prototype||Object.prototype);return Function.prototype.apply.call(V,T,oa)||
T}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var r={a:!0},K={};try{return K.__proto__=r,K.a}catch(V){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(r,K){r.__proto__=K;if(r.__proto__!==K)throw new TypeError(r+" is not extensible");return r}:null;
$jscomp.inherits=function(r,K){r.prototype=$jscomp.objectCreate(K.prototype);r.prototype.constructor=r;if($jscomp.setPrototypeOf){var V=$jscomp.setPrototypeOf;V(r,K)}else for(V in K)if("prototype"!=V)if(Object.defineProperties){var oa=Object.getOwnPropertyDescriptor(K,V);oa&&Object.defineProperty(r,V,oa)}else r[V]=K[V];r.superClass_=K.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(r){if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(r){this.yieldResult=r};
$jscomp.generator.Context.prototype.throw_=function(r){this.abruptCompletion_={exception:r,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(r){this.abruptCompletion_={return:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(r){this.abruptCompletion_={jumpTo:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(r,K){this.nextAddress=K;return{value:r}};
$jscomp.generator.Context.prototype.yieldAll=function(r,K){r=$jscomp.makeIterator(r);var V=r.next();$jscomp.generator.ensureIteratorResultIsObject_(V);if(V.done)this.yieldResult=V.value,this.nextAddress=K;else return this.yieldAllIterator_=r,this.yield(V.value,K)};$jscomp.generator.Context.prototype.jumpTo=function(r){this.nextAddress=r};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(r,K){this.catchAddress_=r;void 0!=K&&(this.finallyAddress_=K)};$jscomp.generator.Context.prototype.setFinallyBlock=function(r){this.catchAddress_=0;this.finallyAddress_=r||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(r,K){this.nextAddress=r;this.catchAddress_=K||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(r){this.catchAddress_=r||0;r=this.abruptCompletion_.exception;this.abruptCompletion_=null;return r};$jscomp.generator.Context.prototype.enterFinallyBlock=function(r,K,V){V?this.finallyContexts_[V]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=r||0;this.finallyAddress_=K||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(r,K){K=this.finallyContexts_.splice(K||0)[0];if(K=this.abruptCompletion_=this.abruptCompletion_||K){if(K.isException)return this.jumpToErrorHandler_();void 0!=K.jumpTo&&this.finallyAddress_<K.jumpTo?(this.nextAddress=K.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=r};$jscomp.generator.Context.prototype.forIn=function(r){return new $jscomp.generator.Context.PropertyIterator(r)};
$jscomp.generator.Context.PropertyIterator=function(r){this.object_=r;this.properties_=[];for(var K in r)this.properties_.push(K);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var r=this.properties_.pop();if(r in this.object_)return r}return null};$jscomp.generator.Engine_=function(r){this.context_=new $jscomp.generator.Context;this.program_=r};
$jscomp.generator.Engine_.prototype.next_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,r,this.context_.next_);this.context_.next_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(r){this.context_.start_();var K=this.context_.yieldAllIterator_;if(K)return this.yieldAllStep_("return"in K?K["return"]:function(V){return{value:V,done:!0}},r,this.context_.return);this.context_.return(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],r,this.context_.next_);this.context_.throw_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(r,K,V){try{var oa=r.call(this.context_.yieldAllIterator_,K);$jscomp.generator.ensureIteratorResultIsObject_(oa);if(!oa.done)return this.context_.stop_(),oa;var T=oa.value}catch(ya){return this.context_.yieldAllIterator_=null,this.context_.throw_(ya),this.nextStep_()}this.context_.yieldAllIterator_=null;V.call(this.context_,T);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var r=this.program_(this.context_);if(r)return this.context_.stop_(),{value:r.value,done:!1}}catch(K){this.context_.yieldResult=void 0,this.context_.throw_(K)}this.context_.stop_();if(this.context_.abruptCompletion_){r=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(r.isException)throw r.exception;return{value:r.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(r){this.next=function(K){return r.next_(K)};this.throw=function(K){return r.throw_(K)};this.return=function(K){return r.return_(K)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(r,K){K=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(K));$jscomp.setPrototypeOf&&r.prototype&&$jscomp.setPrototypeOf(K,r.prototype);return K};
$jscomp.asyncExecutePromiseGenerator=function(r){function K(oa){return r.next(oa)}function V(oa){return r.throw(oa)}return new Promise(function(oa,T){function ya(da){da.done?oa(da.value):Promise.resolve(da.value).then(K,V).then(ya,T)}ya(r.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(r){return $jscomp.asyncExecutePromiseGenerator(r())};$jscomp.asyncExecutePromiseGeneratorProgram=function(r){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(r)))};
$jscomp.polyfill("Reflect",function(r){return r?r:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(r){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(r){if(r)return r;if($jscomp.setPrototypeOf){var K=$jscomp.setPrototypeOf;return function(V,oa){try{return K(V,oa),!0}catch(T){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(r){if(r)return r;var K=function(T,ya){this.$jscomp$symbol$id_=T;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ya})};K.prototype.toString=function(){return this.$jscomp$symbol$id_};var V=0,oa=function(T){if(this instanceof oa)throw new TypeError("Symbol is not a constructor");return new K("jscomp_symbol_"+(T||"")+"_"+V++,T)};return oa},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(r){if(r)return r;r=Symbol("Symbol.iterator");for(var K="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),V=0;V<K.length;V++){var oa=$jscomp.global[K[V]];"function"===typeof oa&&"function"!=typeof oa.prototype[r]&&$jscomp.defineProperty(oa.prototype,r,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return r},"es6",
"es3");$jscomp.iteratorPrototype=function(r){r={next:r};r[Symbol.iterator]=function(){return this};return r};
$jscomp.polyfill("Promise",function(r){function K(){this.batch_=null}function V(da){return da instanceof T?da:new T(function(ta,ha){ta(da)})}if(r&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return r;K.prototype.asyncExecute=function(da){if(null==this.batch_){this.batch_=[];var ta=this;this.asyncExecuteFunction(function(){ta.executeBatch_()})}this.batch_.push(da)};
var oa=$jscomp.global.setTimeout;K.prototype.asyncExecuteFunction=function(da){oa(da,0)};K.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var da=this.batch_;this.batch_=[];for(var ta=0;ta<da.length;++ta){var ha=da[ta];da[ta]=null;try{ha()}catch(na){this.asyncThrow_(na)}}}this.batch_=null};K.prototype.asyncThrow_=function(da){this.asyncExecuteFunction(function(){throw da;})};var T=function(da){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var ta=this.createResolveAndReject_();try{da(ta.resolve,ta.reject)}catch(ha){ta.reject(ha)}};T.prototype.createResolveAndReject_=function(){function da(na){return function(qa){ha||(ha=!0,na.call(ta,qa))}}var ta=this,ha=!1;return{resolve:da(this.resolveTo_),reject:da(this.reject_)}};T.prototype.resolveTo_=function(da){if(da===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(da instanceof T)this.settleSameAsPromise_(da);else{a:switch(typeof da){case "object":var ta=
null!=da;break a;case "function":ta=!0;break a;default:ta=!1}ta?this.resolveToNonPromiseObj_(da):this.fulfill_(da)}};T.prototype.resolveToNonPromiseObj_=function(da){var ta=void 0;try{ta=da.then}catch(ha){this.reject_(ha);return}"function"==typeof ta?this.settleSameAsThenable_(ta,da):this.fulfill_(da)};T.prototype.reject_=function(da){this.settle_(2,da)};T.prototype.fulfill_=function(da){this.settle_(1,da)};T.prototype.settle_=function(da,ta){if(0!=this.state_)throw Error("Cannot settle("+da+", "+
ta+"): Promise already settled in state"+this.state_);this.state_=da;this.result_=ta;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};T.prototype.scheduleUnhandledRejectionCheck_=function(){var da=this;oa(function(){if(da.notifyUnhandledRejection_()){var ta=$jscomp.global.console;"undefined"!==typeof ta&&ta.error(da.result_)}},1)};T.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var da=$jscomp.global.CustomEvent,ta=$jscomp.global.Event,
ha=$jscomp.global.dispatchEvent;if("undefined"===typeof ha)return!0;"function"===typeof da?da=new da("unhandledrejection",{cancelable:!0}):"function"===typeof ta?da=new ta("unhandledrejection",{cancelable:!0}):(da=$jscomp.global.document.createEvent("CustomEvent"),da.initCustomEvent("unhandledrejection",!1,!0,da));da.promise=this;da.reason=this.result_;return ha(da)};T.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var da=0;da<this.onSettledCallbacks_.length;++da)ya.asyncExecute(this.onSettledCallbacks_[da]);
this.onSettledCallbacks_=null}};var ya=new K;T.prototype.settleSameAsPromise_=function(da){var ta=this.createResolveAndReject_();da.callWhenSettled_(ta.resolve,ta.reject)};T.prototype.settleSameAsThenable_=function(da,ta){var ha=this.createResolveAndReject_();try{da.call(ta,ha.resolve,ha.reject)}catch(na){ha.reject(na)}};T.prototype.then=function(da,ta){function ha(Pa,xa){return"function"==typeof Pa?function(ub){try{na(Pa(ub))}catch(qb){qa(qb)}}:xa}var na,qa,Da=new T(function(Pa,xa){na=Pa;qa=xa});
this.callWhenSettled_(ha(da,na),ha(ta,qa));return Da};T.prototype.catch=function(da){return this.then(void 0,da)};T.prototype.callWhenSettled_=function(da,ta){function ha(){switch(na.state_){case 1:da(na.result_);break;case 2:ta(na.result_);break;default:throw Error("Unexpected state: "+na.state_);}}var na=this;null==this.onSettledCallbacks_?ya.asyncExecute(ha):this.onSettledCallbacks_.push(ha);this.isRejectionHandled_=!0};T.resolve=V;T.reject=function(da){return new T(function(ta,ha){ha(da)})};T.race=
function(da){return new T(function(ta,ha){for(var na=$jscomp.makeIterator(da),qa=na.next();!qa.done;qa=na.next())V(qa.value).callWhenSettled_(ta,ha)})};T.all=function(da){var ta=$jscomp.makeIterator(da),ha=ta.next();return ha.done?V([]):new T(function(na,qa){function Da(ub){return function(qb){Pa[ub]=qb;xa--;0==xa&&na(Pa)}}var Pa=[],xa=0;do Pa.push(void 0),xa++,V(ha.value).callWhenSettled_(Da(Pa.length-1),qa),ha=ta.next();while(!ha.done)})};return T},"es6","es3");
$jscomp.checkStringArgs=function(r,K,V){if(null==r)throw new TypeError("The 'this' value for String.prototype."+V+" must not be null or undefined");if(K instanceof RegExp)throw new TypeError("First argument to String.prototype."+V+" must not be a regular expression");return r+""};
$jscomp.polyfill("String.prototype.startsWith",function(r){return r?r:function(K,V){var oa=$jscomp.checkStringArgs(this,K,"startsWith");K+="";var T=oa.length,ya=K.length;V=Math.max(0,Math.min(V|0,oa.length));for(var da=0;da<ya&&V<T;)if(oa[V++]!=K[da++])return!1;return da>=ya}},"es6","es3");
$jscomp.iteratorFromArray=function(r,K){r instanceof String&&(r+="");var V=0,oa=!1,T={next:function(){if(!oa&&V<r.length){var ya=V++;return{value:K(ya,r[ya]),done:!1}}oa=!0;return{done:!0,value:void 0}}};T[Symbol.iterator]=function(){return T};return T};$jscomp.polyfill("Array.prototype.keys",function(r){return r?r:function(){return $jscomp.iteratorFromArray(this,function(K){return K})}},"es6","es3");
$jscomp.polyfill("Array.from",function(r){return r?r:function(K,V,oa){V=null!=V?V:function(ta){return ta};var T=[],ya="undefined"!=typeof Symbol&&Symbol.iterator&&K[Symbol.iterator];if("function"==typeof ya){K=ya.call(K);for(var da=0;!(ya=K.next()).done;)T.push(V.call(oa,ya.value,da++))}else for(ya=K.length,da=0;da<ya;da++)T.push(V.call(oa,K[da],da));return T}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var r={},K=Object.create(new $jscomp.global.Proxy(r,{get:function(V,oa,T){return V==r&&"q"==oa&&T==K}}));return!0===K.q}catch(V){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(r,K){return Object.prototype.hasOwnProperty.call(r,K)};
$jscomp.polyfill("WeakMap",function(r){function K(){if(!r||!Object.seal)return!1;try{var na=Object.seal({}),qa=Object.seal({}),Da=new r([[na,2],[qa,3]]);if(2!=Da.get(na)||3!=Da.get(qa))return!1;Da.delete(na);Da.set(qa,4);return!Da.has(na)&&4==Da.get(qa)}catch(Pa){return!1}}function V(){}function oa(na){var qa=typeof na;return"object"===qa&&null!==na||"function"===qa}function T(na){if(!$jscomp.owns(na,da)){var qa=new V;$jscomp.defineProperty(na,da,{value:qa})}}function ya(na){if(!$jscomp.ISOLATE_POLYFILLS){var qa=
Object[na];qa&&(Object[na]=function(Da){if(Da instanceof V)return Da;Object.isExtensible(Da)&&T(Da);return qa(Da)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(K())return r;var da="$jscomp_hidden_"+Math.random();ya("freeze");ya("preventExtensions");ya("seal");var ta=0,ha=function(na){this.id_=(ta+=Math.random()+1).toString();if(na){na=$jscomp.makeIterator(na);for(var qa;!(qa=na.next()).done;)qa=qa.value,this.set(qa[0],qa[1])}};ha.prototype.set=
function(na,qa){if(!oa(na))throw Error("Invalid WeakMap key");T(na);if(!$jscomp.owns(na,da))throw Error("WeakMap key fail: "+na);na[da][this.id_]=qa;return this};ha.prototype.get=function(na){return oa(na)&&$jscomp.owns(na,da)?na[da][this.id_]:void 0};ha.prototype.has=function(na){return oa(na)&&$jscomp.owns(na,da)&&$jscomp.owns(na[da],this.id_)};ha.prototype.delete=function(na){return oa(na)&&$jscomp.owns(na,da)&&$jscomp.owns(na[da],this.id_)?delete na[da][this.id_]:!1};return ha},"es6","es3");
$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(r){function K(){if($jscomp.ASSUME_NO_NATIVE_MAP||!r||"function"!=typeof r||!r.prototype.entries||"function"!=typeof Object.seal)return!1;try{var ha=Object.seal({x:4}),na=new r($jscomp.makeIterator([[ha,"s"]]));if("s"!=na.get(ha)||1!=na.size||na.get({x:4})||na.set({x:4},"t")!=na||2!=na.size)return!1;var qa=na.entries(),Da=qa.next();if(Da.done||Da.value[0]!=ha||"s"!=Da.value[1])return!1;Da=qa.next();return Da.done||4!=Da.value[0].x||"t"!=Da.value[1]||!qa.next().done?
!1:!0}catch(Pa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(K())return r;var V=new WeakMap,oa=function(ha){this.data_={};this.head_=da();this.size=0;if(ha){ha=$jscomp.makeIterator(ha);for(var na;!(na=ha.next()).done;)na=na.value,this.set(na[0],na[1])}};oa.prototype.set=function(ha,na){ha=0===ha?0:ha;var qa=T(this,ha);qa.list||(qa.list=this.data_[qa.id]=[]);qa.entry?qa.entry.value=na:(qa.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:ha,value:na},qa.list.push(qa.entry),this.head_.previous.next=qa.entry,this.head_.previous=qa.entry,this.size++);return this};oa.prototype.delete=function(ha){ha=T(this,ha);return ha.entry&&ha.list?(ha.list.splice(ha.index,1),ha.list.length||delete this.data_[ha.id],ha.entry.previous.next=ha.entry.next,ha.entry.next.previous=ha.entry.previous,ha.entry.head=null,this.size--,!0):!1};oa.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=da();this.size=0};oa.prototype.has=
function(ha){return!!T(this,ha).entry};oa.prototype.get=function(ha){return(ha=T(this,ha).entry)&&ha.value};oa.prototype.entries=function(){return ya(this,function(ha){return[ha.key,ha.value]})};oa.prototype.keys=function(){return ya(this,function(ha){return ha.key})};oa.prototype.values=function(){return ya(this,function(ha){return ha.value})};oa.prototype.forEach=function(ha,na){for(var qa=this.entries(),Da;!(Da=qa.next()).done;)Da=Da.value,ha.call(na,Da[1],Da[0],this)};oa.prototype[Symbol.iterator]=
oa.prototype.entries;var T=function(ha,na){var qa=na&&typeof na;"object"==qa||"function"==qa?V.has(na)?qa=V.get(na):(qa=""+ ++ta,V.set(na,qa)):qa="p_"+na;var Da=ha.data_[qa];if(Da&&$jscomp.owns(ha.data_,qa))for(ha=0;ha<Da.length;ha++){var Pa=Da[ha];if(na!==na&&Pa.key!==Pa.key||na===Pa.key)return{id:qa,list:Da,index:ha,entry:Pa}}return{id:qa,list:Da,index:-1,entry:void 0}},ya=function(ha,na){var qa=ha.head_;return $jscomp.iteratorPrototype(function(){if(qa){for(;qa.head!=ha.head_;)qa=qa.previous;for(;qa.next!=
qa.head;)return qa=qa.next,{done:!1,value:na(qa)};qa=null}return{done:!0,value:void 0}})},da=function(){var ha={};return ha.previous=ha.next=ha.head=ha},ta=0;return oa},"es6","es3");$jscomp.findInternal=function(r,K,V){r instanceof String&&(r=String(r));for(var oa=r.length,T=0;T<oa;T++){var ya=r[T];if(K.call(V,ya,T,r))return{i:T,v:ya}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(r){return r?r:function(K,V){return $jscomp.findInternal(this,K,V).i}},"es6","es3");
var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var K={};K.id=r.id;K.server=r.id;K.displayName=r.displayName||r.id;if(r=r.rdp){for(var V in r)K[V]=r[V];K.user=r.username||"";K.pwd=r.password||"";K.useConsole=r.console||!1;K.legacyMode=r.leagacyMode||r.legacyMode||!1;K.server_bpp=r.color||16;K.exe=r.remoteProgram||"";K.args=r.remoteArgs||"";K.startProgram=0<K.exe.length?"app":K.command&&0<K.command.length?"shell":"noapp"}return K}
function Rdp2(r){r=svGlobal.util.getServerArgs(r);if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var K=r.gateway||"",V=0,oa=0,T=16,ya=1==r.useSSL||"true"==r.useSSL||"on"==r.useSSL||null;r.width&&(V=parseInt(r.width,10));r.height&&(oa=parseInt(r.height,10));r.color&&(T=parseInt(r.color,10));r.server_bpp&&(T=parseInt(r.server_bpp,10));r=hi5.browser.obj2url(r);null===ya&&(ya="https:"==location.protocol);return new Rdp((ya?"wss://":"ws://")+K+"/RDP?"+r,V,oa,T)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(r,K,V,oa){function T(a){return"on"==a||"true"==a||1==a}function ya(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function da(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ta(a,b){a=la[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function ha(){return N.displayName||N.server||N.symlink||N.id||"undefined"}function na(a){p.loadbalanceToken||
(p.loadbalanceToken=la.loadbalanceTokenName?la.loadbalanceTokenName+"="+a:"")}function qa(a,b,c){p.ontitlechange&&(a=p.ontitlechange(a,c));p.setTitle&&a&&(b=b||window,b.document.title=a)}function Da(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return N.invitation||p.showMessage("15 bit color is not supported anymore."),!1;default:return!1}gb=a;b&&(Ma?Ma.postMessage({type:0,cmd:1,data:a}):Fa&&Fa.setColor(a));return!0}function Pa(a,b,c,e){Ka=a;La=b;Zb=$b=0;ac=Ka-1;bc=La-1;Va&&(Ka=(N.waWidth||
hi5.browser.getScreenWidth())|0,La=(N.waHeight||hi5.browser.getScreenHeight())|0);N.minWidth&&Ka<N.minWidth&&(Ka=N.minWidth|0);N.minHeight&&La<N.minHeight&&(La=N.minHeight|0);Ka&=-4;La&=-4;svGlobal.logger.warn("resolution changed, w:"+Ka+" h:"+La);var d=Ka,h=La;sa?sa.resize(d,h):sa=new Cc(d,h);ka.setSize(Ka,La,Va?"hidden":null);if(c||Ka!=a||La!=b)Ma?Ma.postMessage({type:0,cmd:2,data:{w:Ka,h:La}}):Fa&&Fa.setResolution(Ka,La);if(p.onresolutionchange&&!e)p.onresolutionchange(a,b)}function xa(a){!cb&&
Ja&&(Ma?(cc.data=a,"string"!=typeof a?Ma.postMessage(cc,[a]):Ma.postMessage(cc)):Fa.writeRawInput(a))}function ub(a){switch(a){case "\r":break;case "\n":p.writeScancode(28);break;case "\t":p.writeScancode(15);break;default:xa("86"+a)}}function qb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),h=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=h?5:9;c=new Uint8Array(e+c);c[0]=a;if(h)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{h=b.name;for(var q=Math.min(h.length,8),L=0;L<q;L++)c[1+L]=h.charCodeAt(L)}c.set(d,e);xa(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Ib(a){if(p){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};p.displayMsg&&p.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(p.onerror)p.onerror(a)}}function Dc(a){if(p){var b=__svi18n.info[a];b||(b="info "+a);p.displayMsg&&p.showMessage(b);svGlobal.logger.info(b)}}function dc(){var a=Ja;rb=Ja=!1;
Ma?Ma.postMessage({type:0,cmd:3}):Fa&&Fa.resetStatus();a&&(Ja=a)}function ec(a){Oa||(Oa=new hi5.file.UploadManager(new hi5.file.WsFileService(xa)),Oa.addEvent("beforeupload",function(b,c,e){if(p.beforeupload)return p.beforeupload(b,c,e)}),Oa.addEvent("fileuploaded",function(b,c,e){if(p.onfileuploaded)p.onfileuploaded(b,c,e)}),Oa.addEvent("uploaded",function(b,c){if(p.onuploaded)p.onuploaded(b,c)}),Oa.addEvent("uploadingCancelled",function(){if(p.onuploadingCancelled)p.onuploadingCancelled()}));a.setFileHandler(Oa)}
function Ec(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ja&&(e=!0,xa("8C5"+d.exe+"\t"+d.args+"\t"+p.sessionInfo.appInfo.session))}}function Bd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Fc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Jb(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function Cd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Gc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Hc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var h=[];e&1?h.push("usb"):e&2?h.push("nfc"):e&4?h.push("ble"):e&16?h.push("internal"):e&32&&h.push("hybrid");
d.transports=h}b.push(c)}}return b}function Gc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function Dd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function Ed(a,b){var c,e,d,h,q,L,A,G,J,x,z,v,n,y,t,O,E,P,Q,ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){if(1==W.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var X=$jscomp.makeIterator(e),D=X.next();!D.done;D=X.next())D=D.value,"USB"==D.toUpperCase()||"NFC"==D.toUpperCase()||"BLE"==D.toUpperCase()||"INTERNAL"==D.toUpperCase()||D.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+vb(new Uint8Array(d))),q=Jb(d),h=q.attStmt;if(L=a.clientDataJSON)console.log("==== clientDataJson bytes: "+vb(new Uint8Array(L))),A=window.origin,G=(new TextDecoder).decode(L),J=JSON.parse(G),J.origin&&(J.origin=A);x=a.getAuthenticatorData();
if(!x)return W.jumpTo(0);z=new Uint8Array(x);console.log("==== authenticatorData bytes: "+vb(z));return b?(v=b.id)?W.yield(Fd(v),5):W.jumpTo(0):W.jumpTo(0)}n=W.yieldResult;y=new Uint8Array(n);console.log("==== hash of realRpID: "+vb(y));t=new hi5.DataBuffer(new Uint8Array(z.byteLength));t.setBytes(y);O=z.slice?z.slice(32,z.length):z.subarray(32,z.length);t.setBytes(O);t.markEnd();E=t.getData();console.log("==== newAuthDataBytes: "+vb(new Uint8Array(E)));P={1:"packed",2:E,3:h};Q=CBOR.encode(P);ia=
new hi5.DataBuffer(new Uint8Array(Q.byteLength+1));ia.setByte(0);ia.setBytes(Q);ia.markEnd();return W.return(ia.getData())})}function Fd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Gd(b))})}function Gd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function vb(a){return Array.from(a,function(b){return("0"+
(b&255).toString(16)).slice(-2)}).join(", ")}function Hd(){var a=0,b=0,c=new p.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),h=e.getLittleEndian16(),q=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(q){case 1:case 4097:q=new RdpBuffer(new Uint8Array(6),0,6);q.setByte(6);q.setByte(1);q.setLittleEndian16(h);
q.setLittleEndian16(0);q.markEnd();c.send(q);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:h=e.getLittleEndian16();a+=h;break;case 43:case 1065:case 1577:43==q&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(h);d.setLittleEndian16(43==q?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:h=
e.getLittleEndian32();q=e.getLittleEndian32();e=e.getLittleEndian32();fc={baseRTT:h,bandwidth:q,averageRTT:e};if(p.onnetworkresult)p.onnetworkresult(fc);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};p.addGatewayChannel(c)}function Id(a,b,c,e,d){gc.set(a,b);hc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");
e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Jd(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ic(){var a="";N&&T(N.connectif)&&N.symlink&&"sessionStorage"in window&&(a="SV_"+N.symlink,N.domain&&(a+=N.domain),N.user&&(a+=N.user));return a}
function Kd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function ic(){if(!Ja){rb=!1;var a="";cb?Ha.init(!1,!0,!1,0,!1,!1):a=p.getRuntimeURL();void 0==la.wsPost&&(la.wsPost=!1);p.oncreatewebsocket&&(Ma=null);Ma?(cb&&(cb.onopen=jc,cb.onclose=Bb,cb.onmessage=function(c){kc.data=c.data;Ma.postMessage(kc,[kc.data])}),Ma.postMessage({type:0,
cmd:0,data:{addr:a,width:Ka,height:La,server_bpp:gb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:la.wsPost}})):(Fa=new RdpGeneral(cb||a,Ka,La,gb,sa,!1,la.wsPost),Fa.oncreatewebsocket=p.oncreatewebsocket,Fa.run());Ma?Ma.addEventListener("message",Jc,!1):(Fa.onopen=jc,Fa.onmessage=Kc,Fa.onclose=Bb,Fa.onerror=Ib,Fa.oninfo=Dc,Fa.onloggedin=lc,Fa.onresolutionchange=function(c,e){Pa(c,e,!1,N.monitorDef&&0<=N.monitor?!0:!1)},Fa.onAltSecWindows=Lc,Fa.onMoveCursor=mc,Fa.onCloseSurface=Mc,Fa.onColorChange=
Da,Fa.onHistoryReceived=function(){nc()},Fa.onLockKeyState=function(c){if(p.onLockKeyState)p.onLockKeyState(c)});if(a=ka.getSurface(ka.size()-1))Va?a&&(a.remoteApp=new Ec(N.exe,N.args,"")):qa(ha(),a.getWindow());if(N.invitation&&!T(N.shadow)){var b=null;a&&(b=a.initChat(N.expert));Cb=new p.GatewayChannel;Cb.name="C_H_A_T";Cb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,N.novice)};b&&(b.onchat=function(c){if(Ja){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,
e.length);e.setUnicodeString(c);e.markEnd();Cb.send(e)}});p.addGatewayChannel(Cb)}}}function Jc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:jc();break;case 1:Bb(a.expected);break;case 2:Ib(a.code);break;case 3:Dc(a.code);break;case 4:lc();break;case 5:Pa(a.w,a.h,!1,N.monitorDef&&0<=N.monitor?!0:!1);break;case 6:mc(a.x,a.y,!0);break;case 7:Mc();break;case 8:0==a.id&&nc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:Da(a.color);break;case 10:if(p.onLockKeyState)p.onLockKeyState(a.state);break;
default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:sa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:sa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:sa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:sa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:sa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:sa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Nc(a);break;case 10:Kc(a);break;case 11:Ua.attach(a.data,
0,a.data.length);Lc(Ua,a.size);break;case 12:sa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:sa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:sa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:sa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:sa.putFont(a.font,a.character,
a.glyph);break;case 17:sa.putCursor(a.idx,a.cursor);break;case 18:sa.setCursor(a.idx);break;case 19:sa.getHistory(xa,function(){Ma.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);sa.setHistory(a.order,Ua);break;case 21:sa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Oc(a){Qa&&Qa.check(a)}function jc(){Ja=!0;var a="87"+navigator.userAgent+"\t";Kb=hi5.tool.uuid();document.cookie=
Kb+"=sv";xa(a+Kb);if(p.onopen)p.onopen();la.joinCloseMode&&p.setJoinCloseMode(la.joinCloseMode)}function Mc(){ka&&ka.close()}function Kc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=kb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Ga.tag=a.getLittleEndian16();Ga.channels=a.getLittleEndian16();Ga.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Ga.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ga.tag+" channels="+Ga.channels+" bitsPerSample="+Ga.bitsPerSample+" samplePerSec="+Ga.samplePerSec);Ma&&Ma.postMessage({type:0,cmd:5,data:{tag:Ga.tag,channels:Ga.channels,samplePerSec:Ga.samplePerSec,bitsPerSample:Ga.bitsPerSample}});41222==Ga.tag&&(Ga.sampleRate=Ga.samplePerSec,Ta.initMediaPlayer(Ta,Ga,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);oc(a,
b,c,0);lb||(c+=Date.now()-e,xa("8A"+b+","+c))}Qa&&Qa.check();break;case 56:Pc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Qc(Ua);break;case 62:Rc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Sc(Ua);Qa&&Qa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ha[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ha[b].newInstance?(Ha[a]=Ha[b].newInstance(),Ha[a].id=a):(Ha[b].id=a,Ha[a]=Ha[b]),
Ha[a].onopen)Ha[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ha[a]&&Ha[a].process(b);break;case 4:if(Ha[a]&&Ha[a].onclose)Ha[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:Ld(Ua);break;default:if(p.onunknownmessage)p.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:xa("87"+navigator.userAgent);break;case 15:if(p){pc=!1;wb=p.reconnectTimes;
(p&&0==p.mode||T(N.connectif))&&nc();b="";for(b in mb)if((c=mb[b])&&c.onopen)c.onopen();for(b in kb)if((c=kb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&p&&(p.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(p.onnotify)p.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&p.onerror)p.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;p.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ka.drawLicense(a);break;case 50:if(Ja)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Md(a);break;case 2:Db?(Db.type==a?p.writeRawInput("881"+a+"\t"+Db.text):p.writeRawInput("881ERROR\t"),Db=null):!(b=ka.getFocused())||b.processClipReq(a)||!la.clipWarnAlways&&Tc||!N||N.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Tc=!0);break;case 5:(b=ka.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ka.setReadOnly("1"==
a);break;case 54:b=a.split("\t");a=ya()+b[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);p.onprintingready&&p.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ka.getFocused())&&b.showPDF(a);break;case 56:Pc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ka.getWinById(parseInt(b[0]))){if(!ka.hasApp(b[1])){(c=ka.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(p.onremoteappstart)p.onremoteappstart({id:b[1]});
if(a.isVisible()&&a.titleInfo&&p.ontitlechange)p.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Nd(a);break;case 59:a=hi5.Base64.dec(a,0);db=(new RdpBuffer(a,0,a.length)).getLittleEndian32();lb||!(db&16||db&65536)?(Lb=!1,Oa=null):(db&16&&(Lb=!0),Oa||(a=ka.getFocused())&&ec(a));db&64&&p.showMessage(__svi18n.info.recording);Oa&&(Oa.setUpload(!(db&128)),Oa.setDownload(!(db&131072)),Oa.canCopyFile=0!=(db&65536));ka.execute("setFeature",[db]);break;case 60:Qc(b64ToBuffer(a));
break;case 61:a=JSON.parse(a);switch(a.type){case 0:Pa(a.width,a.height,!0,!1);Da(a.color);(b=a.server)&&p&&(p.server=a.server);Uc=a.length;c=ka.getFocused();Va=1==a.isRail;c&&(1!=p.mode&&c.setAutoScale(!Va),b&&qa(ha(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Lb=!0,ec(c));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Uc);break;case 2:2==a.status?(dc(),Ja=!0):(b=0==a.status,b==sa.isPaused()||p.onsessionpause&&p.onsessionpause(b,
a)||(sa&&sa.pause(b,void 0),b||ka.repaint(0,0,sa.width-1,sa.height-1),a.warn&&p.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Rc(a);break;case 63:Sc(b64ToBuffer(a));break;default:if(p.onunknownmessage)p.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function nc(){if(!lb&&!Xa&&(Xa=!0,p&&(la.pingInterval&&p.startPing(la.pingInterval),p.onready)))p.onready()}function Ld(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=
1;xa(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(db^=65536,ka.execute("setFeature",[db]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(p.onLockKeyState)p.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);
break;case 7:b=a.getByte();p.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);p.sessionInfo.appInfo.twoFAQR=a;p.ontwofaqr&&p.ontwofaqr(a)||2==b&&ka.execute("showTwoFAQR");break;case 1:sa&&sa.pause(!0,!0);if(p.ontwofacode&&p.ontwofacode())return;(a=ka.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!p.ontwofaresult||!p.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();
if(a=ka.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var h=new Uint8Array(2+d.length);h[0]=146;h[1]=8;h.set(d,2);xa(h.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Od(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var h=ka.getFocused();h&&Ja&&(h=h.getThumbnail(a))&&h.length!=d&&(xa("8E7"+h),d=h.length)},
b))};this.stop=function(){clearInterval(c)}}function Pd(a,b){!$a||$a.width==a&&$a.interval==b||($a.stop(),$a=null);$a||($a=new Od(a,b));$a.start()}function Sc(a){var b=a.getAscllString(8);(b=mb[b])&&b.process&&b.process(a)}function Rc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);dc();Ja=!0;a=d.width;e=d.height;if(a==Ka&&e==La)break;Pa(a,e,!1,!1);break;case 1:d=JSON.parse(c);p.sessionInfo.joinedSessions.push(d.numericId);
p.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||la.alertJoin)p.onsessionjoin&&(a=p.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&p.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);p.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=p.sessionInfo.joiners;c=0;for(var h=b.length;c<h;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||la.alertJoin)p.onsessionexit&&
(a=p.onsessionexit(d)),!a&&__svi18n.info.exitsession&&p.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ka.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ka.setReadOnly(!0,2==
d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);p.onrequirecontrol&&(a=p.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;sa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));p.showMessage({title:a,msg:e,cbYes:function(){p.giveControl(d.numericId);this.destroy();sa.isPaused()&&
p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(d.numericId);this.destroy()},html:!0});break;case 6:ka.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Pa(d.width,d.height,!0,N.monitorDef&&0<=N.monitor?!0:!1);d.color&&(Da(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(p.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);pc=!0;if(p.onrequestcredential&&p.onrequestcredential(d,Ra.reconnect))break;
if(p.onautherror&&p.onautherror(d,Ra.reconnect))break;ka.getFocused().requestCredential(d,Ra.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Pd(d.width,d.interval):$a&&($a.stop(),$a=null);break;case 11:d=JSON.parse(c);p.onrequirejoin&&(a=p.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);p.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(d.numericId,!1);this.destroy()}});
break;case 13:d=JSON.parse(c);"login"==d.type&&lc();break;case 14:if(d=JSON.parse(c),p.oncontrolchange)p.oncontrolchange(d)}}function Qc(a){switch(a.getByte()){case 32:if(!sa.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,h=void 0;la.noCursorName||(d=a.getLittleEndian32(),p.sessionInfo.appInfo&&(h=p.sessionInfo.appInfo.sessions[d]));mc(c,e,!0,h,d,b)}}}function mc(a,b,c,e,d,h){sa.isPaused()||ka.getFocused().moveCursor(a,b,c,e,d,h)}function Nc(a){ka.setCursor(a)}
function Qd(a){var b=la.page&&la.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=ya();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Pc(a){a=JSON.parse(a);qc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",qc),c.setItem("appInfo.numericId",
b));na(a.appId);a.server||(a.server=ha());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=p.mode&&ka.execute("setAutoScale",[!0]):(p.mode=0,T(N.connectif)&&ka.setSize(Ka,La),la.disableJoinedAppResize&&(p.windowState=0));var e=ya();b=Qd("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),p.protocol="http"==c.substring(0,e)?"ws":"wss",p.gateway=c,b+="&gateway="+encodeURIComponent(c));
b=p.modifyURL(b);a.joinLink=b;p.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Pa(Ka,La,!0,!0),rb||1==p.mode||ka.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);la.cursorNameOnly=a.isAssistance;if(p.onsessionstart)p.onsessionstart(p.sessionInfo)}function Nd(a){if(Oa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Oa.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Oa.confirmId(c[0],
c[1],c[2]);break;case 2:Oa.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Oa.close(c[0]);break;case 9:a='<a href="'+p.modifyURL(ya()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ka.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Oa.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function oc(a,b,c,e){if(!Rd||sa.isPaused())return 0;
var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ga.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ga.tag)rc||(rc=new MSGSM),b=rc.decode(b,d,e),d=0,e=b.length;var h=Ga.bitsPerSample;var q=Math.floor(e/(h>>3));var L=c=e=0;a||(e=Math.pow(2,h-1)-1,c=-e-1,L=Math.pow(2,h));h=Ga.channels;var A=Math.floor(q/h),G=Ta.getBuffer(A),J=G.getChannelData(0),x=G.getChannelData(1);q=0;if(a)for(;q<A;)1==h?x[q]=J[q]=b[d++]:(J[q]=b[d++],x[q]=b[d++]),q++;else for(;q<A;)a=b[d++]|b[d++]<<8,a>e?(a-=L,
a/=-c):a/=e,1==h?J[q]=a:(J[q]=a,a=b[d++]|b[d++]<<8,a>e?(a-=L,a/=-c):a/=e),x[q]=a,q++;return Ta.playBuffer(G)}function Vc(a){if(!p.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<
a.indexOf("\n")?!1:p.onurlredirection&&p.onurlredirection(b)?!0:(a=ka.getFocused())?a.processLink(b):!1:!1}function Sd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=p.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Md(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(p.onservercopy&&p.onservercopy(a)||Vc(a))){var b=ka.getFocused();b&&b.copyToClip(Sd(a))}setTimeout(function(){xa("883")},
999)}}function lc(a){if(!rb&&(setTimeout(function(){Ja&&xa("884")},333),p.onloggedin))p.onloggedin();sc=rb=!0;a&&a.sessionId&&(p.sessionInfo.sessionId=a.sessionId);Va&&1!=p.mode&&ka.execute("setAutoScale",[!1]);Oa&&(Oa.enabled=!0);Mb&&!Va&&(sa.setContext(ka.getFocused().context),ka.repaint(0,0,sa.width-1,sa.height-1))}function Bb(a){if(p){hi5.browser.cookie.delete(Kb);svGlobal.logger.warn("closed "+(p.sessionInfo.appInfo?p.sessionInfo.appInfo.numericId:0));p.onagentmessage&&(p.onagentmessage=null);
if(p.onagentclose)p.onagentclose();var b=Ic();b&&p.sessionInfo.appInfo&&0==p.mode&&(sessionStorage[b]=p.sessionInfo.appInfo.session);if(p&&(b=1!=p.mode,!Ja&&b&&Ib("connection"),b=b&&(Ja||wb<p.reconnectTimes)&&0<wb&&!a,Xa=Ja=!1,b)){wb--;__svi18n.info.reconnecting&&p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-wb)+"/"+p.reconnectTimes,null,3E3);setTimeout(ic,la.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+wb);return}if(pc)svGlobal.logger.info("Req credential");else{Qa&&
(p.stopPing(),Qa=null);Ma&&(Ma.removeEventListener("message",Jc,!1),Ma.postMessage({type:0,cmd:4}),Ma.terminate(),Ma=null);Oa&&(Oa.release(),Oa=null);Sa=r=null;Ha&&(Ha.close(),Ha=null);mb&&hi5.Arrays.release(mb);kb&&hi5.Arrays.release(kb);$a&&($a.stop(),$a=null);Ta&&(Ta.close(),Ta=null);p.player&&(p.player=null);Eb=null;try{if(p.onclose)p.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ka&&(ka.close(),ka=null)}catch(c){svGlobal.logger.warn(c)}Ua=
null;Fa&&(Fa.onopen=null,Fa.onmessage=null,Fa.onclose=null,Fa.onerror=null,Fa.close(),Fa=null);ka=Ra=null;sa&&(sa.release(),sa=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(p.close):window.removeEventListener("unload",p.close,!1);window&&window.$rdp==p&&(window.$rdp=null);p=null}}}function Wc(){Fa&&Ja?Fa.close():Bb(!0)}function Lc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();
var e=a.getLittleEndian16(),d=a.getLittleEndian16(),h=0;16>c&&(h=a.getLittleEndian16());var q=a.getLittleEndian16(),L=a.getLittleEndian16();a.getBytes(q);h&&a.getBytes(h);if(8<=c&&(h=ka.getFocused())&&h.onremoteappicon){q=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();L=d+L;var A;a=a.getData();for(var G=0,J,x;d<L;)switch(c){case 16:(A=a[d++]|a[d++]<<8)?(x=A>>7&248,J=A>>2&248,A=A<<3&248,x|=x>>5,J|=J>>5,A|=A>>5,e[G++]=A,e[G++]=J,e[G++]=x,e[G++]=255):G+=4;break;
case 32:e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++]}q.putPixels(e,0,e.length);a=ka.getWinById(b);h.onremoteappicon(a,q)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ka.delWin(b)):Td(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+
c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((h=ka.getOwnerSurfaceById(b))&&h.railWin&&h.railWin.setActiveWinId(b,3==la.windowState),ka.setTitle(b),sa.getContext()||(b=ka.getFocused())&&sa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ka.zOrders,c.length=b,h=0;h<b;h++)c[h]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[h])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Xc(a){var b=
ka.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Td(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ka.getWinById(c);d?e=!0:d=new ka.LocalWin(c);
svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+
(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&
2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var h=d.showState;(2==h&&0!=la.noMinimize||
!e&&3==h&&5==la.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(h=0!=(b&4)){var q=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(q,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){q=a.getLittleEndian32();var L=a.getLittleEndian32();d.winOffsetX=q;d.winOffsetY=L;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+
d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==p.windowState?Xc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(q=ka.getFocused())){q=q.getFreeSpace();var A=d.winWidth,G=d.winHeight;if(d.winOffsetX>q.width||d.winOffsetY>q.height||0>A+d.winOffsetX||0>G+d.winOffsetY){var J=(q.width-d.winWidth)/2|0,x=(q.height-d.winHeight)/2|0;
0>J&&(J=0);0>x&&(x=0);setTimeout(function(){d.resize(J,x,A,G)},50)}}0!=(b&256)&&(q=a.getLittleEndian16(),0<q&&a.skipPosition(8*q));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ka.onWinChange(d);else ka.addWin(d);h&&ka.setTitle(c);c==ka.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ka.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+
c)}function Cc(a,b){function c(k,m,g,f,u){0<u.width?u.union(k,m,g,f):(u.x=k,u.y=m,u.width=g,u.height=f)}function e(k,m,g,f){for(ea=0;ea<fa;ea++){var u=X[ea];if(k>=u[0]&&m>=u[1]&&g<=u[2]&&f<=u[3])return D[ea]}return null}function d(k,m,g,f){if(fa){var u=e(k,m,k+g-1,m+f-1);u&&c(k,m,g,f,u)}else c(k,m,g,f,y)}function h(k,m,g,f,u,w,C){for(var B=u*g+f,F=k.setRGB,U=k.getRGB,M=0;M<C;M++){for(var l=0;l<w;l++){if(k){var I=U(f+l,u+M);F(f+l,u+M,~I&16777215)}else m[B]=~m[B]&16777215;B++}B+=g-w}}function q(k,m,
g,f,u,w,C,B,F,U){m=U*B+F;null==C&&(C=k);for(k=0;k<w;k++){for(F=0;F<u;F++)v[f+k][g+F]=v[f+k][g+F]&C[m]&16777215|4278190080,m++;m+=B-u}}function L(k,m,g,f,u,w,C,B,F,U){m=U*B+F;F=k.setRGB;U=k.getRGB;null==C&&(C=k);for(k=0;k<w;k++){for(var M=0;M<u;M++){var l=U(g+M,f+k);F(g+M,f+k,l|C[m]&16777215);m++}m+=B-u}}function A(k,m,g,f){var u=ma;if(u){var w=u.getRGB(m,g);switch(k){case 0:u.setRGB(m,g,0);break;case 1:u.setRGB(m,g,~(w|f)&16777215);break;case 2:u.setRGB(m,g,w&~f&16777215);break;case 3:u.setRGB(m,
g,~f&16777215);break;case 4:u.setRGB(m,g,16777215*(~w&f));break;case 5:u.setRGB(m,g,~w&16777215);break;case 6:u.setRGB(m,g,w^f&16777215);break;case 7:u.setRGB(m,g,~w&f&16777215);break;case 8:u.setRGB(m,g,w&f&16777215);break;case 9:u.setRGB(m,g,w^~f&16777215);break;case 10:break;case 11:u.setRGB(m,g,w|~f&16777215);break;case 12:u.setRGB(m,g,f);break;case 13:u.setRGB(m,g,(~w|f)&16777215);break;case 14:u.setRGB(m,g,w|f&16777215);break;case 15:u.setRGB(m,g,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+
k),u.setRGB(m,g,f)}}}function G(k,m,g,f,u,w,C,B,F){k>B||m>F||(g=k+g-1,g>B&&(g=B),k<w&&(k=w),g=g-k+1,f=m+f-1,f>F&&(f=F),m<C&&(m=C),f=f-m+1,1>g||1>f||ma.fillRect(k,m,g,f,u))}function J(k,m,g,f,u,w,C,B,F,U,M,l){if(!(m>M||g>l)){var I=m+f-1;I>M&&(I=M);F=m<F?F:m;I=I-m+1;M=g+u-1;M>l&&(M=l);U=g<U?U:g;l=M-g+1;if(!(1>I||1>l)){M=128;var H=0;C|=4278190080;B|=4278190080;if(F==m&&U==g&&I==f&&l==u)if(0==k)for(var R=0;R<u;R++){k=g+R;for(var ca=0;ca<f;ca++)0==M&&(H++,M=128),0!=(w[H]&M)&&(v[k][m+ca]=B),M>>=1;H++;M=
128;H==w.length&&(H=0)}else for(R=0;R<u;R++){k=g+R;for(ca=0;ca<f;ca++)0==M&&(H++,M=128),v[k][m+ca]=0!=(w[H]&M)?B:C,M>>=1;H++;M=128;H==w.length&&(H=0)}else if(0==k)for(R=0;R<l;R++){k=g+R;for(ca=0;ca<I;ca++)0==M&&(H++,M=128),m+ca>=F&&k>=U&&0!=(w[H]&M)&&(v[k][m+ca]=B),M>>=1;H++;M=128;H==w.length&&(H=0)}else for(R=0;R<l;R++){k=g+R;for(ca=0;ca<I;ca++)0==M&&(H++,M=128),m+ca>=F&&g+R>=U&&(v[k][m+ca]=0!=(w[H]&M)?B:C),M>>=1;H++;M=128;H==w.length&&(H=0)}}}}function x(k,m,g,f,u){this.offset=k;this.baseLine=m;
this.width=g;this.height=f;this.fontData=u}function z(k,m,g,f,u,w,C,B,F){this.cache_idx=k;this.rawData=m;this.none=!m;this.hotX=g;this.hotY=f;this.width=u;this.height=w;this.xorSize=B;this.andSize=F;this.result="";this.distance=0;this.bpp=C;this.system="";if(m){if(!this.distance){k=0;if(m){C=0;for(var U=m.length;C<U;C++)0!=m[C]&&(k+=C%u+(C/u|0))}this.distance=k}if(!this.system){a:switch(this.distance){case 507:k="text";break a;case 2046:case 4359:k="default";break a;default:k=""}this.system=k}}k=
"";if(!this.system&&m){C=u*w*4;k=62+C+B+F;U=new Uint8Array(k);k=new hi5.DataBuffer(U,0,k);k.setLittleEndian16(0);k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(u);k.setByte(w);k.setByte(0);k.setByte(0);k.setLittleEndian16(g);k.setLittleEndian16(f);k.setLittleEndian32(40+C+B+F);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(u);k.setLittleEndian32(2*w);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(B+F);k.setLittleEndian32(0);
k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);for(g=w-1;0<=g;g--)for(f=0;f<u;f++)w=m[u*g+f],k.setByte(w&255),k.setByte(w>>8&255),k.setByte(w>>16&255),k.setByte(w>>24&255);k="data:image/x-icon;base64,"+hi5.Base64.enc(k.getData())}this.url=k}var v=[],n=null,y=new hi5.graphic.Rectangle(0,0,0,0),t="Uint8ClampedArray"in window,O=null,E=0,P=0,Q=0,ia=0,W=null,X,D,ea=0,fa=0;this.width=a;this.height=b;var Y=!1,ma=this,ba={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=
function(k){O=k};this.getDirtyArea=function(){return y};this.setImgRect=function(k,m,g,f){E=k;P=m;Q=g;ia=f};this.parseMonitorDef=function(k){var m=k.split(","),g=m.length,f=[];if(1<g){for(var u=!1,w=0;w<g;w++){var C=m[w].split(":");if(4==C.length)f[w]=Array(5),f[w][0]=parseInt(C[0]),f[w][1]=parseInt(C[1]),f[w][2]=parseInt(C[2]),f[w][3]=parseInt(C[3]),f[w][4]=0==f[w][0]&&0==f[w][1]?1:0;else{u=!0;break}}u&&(svGlobal.logger.warn("invaiid monitorDef:"+k),f.length=0)}return f};this.setMonitorLayout=function(k){var m=
k.length,g=0;X=k;for(D=Array(m);g<m;g++)D[g]=new hi5.graphic.Rectangle(0,0,0,0);fa=m};this.setMonitorCount=function(k){fa=k};this.addImg=function(k){Q&&(W&&URL.revokeObjectURL(W.src),W=k)};this.flushImgs=function(){W&&(URL.revokeObjectURL(W.src),W=null,Q=0)};this.getData=function(){return v};this.pause=function(k,m){Y=k;m&&n&&n.fillRect(0,0,a,b)};this.release=function(){y=null;hi5.Arrays.release(D);ma.flushImgs();v=n=ma=null;ba=ba.imgData=null};this.isPaused=function(){return Y};this.setContext=function(k){k!=
n&&(n||!k||k.createImageData(1,1).data.buffer||(t=!1),n=k,null!=n&&(ba.imgData=n.createImageData(a,b)))};this.getContext=function(){return n};this.resize=function(k,m){if(v.length!=m||v[0].length!=k){for(var g=0;g<m;g++)v[g]=new Uint32Array(k);v.length=m;ma.width=a=k;ma.height=b=m;null!=n&&(ba.imgData=n.createImageData(a,b))}};ma.resize(a,b);this.getBuffer=function(){return v};this.setRGB=function(k,m,g){v[m][k]=g|4278190080};this.getRGB=function(k,m){return v[m][k]};this.setRGBs=function(k,m,g,f,
u,w,C){var B=k+g,F=m+f;F>b&&(F=b);if(!(k>=a)){B>a&&(g-=B-a);for(B=m;B<F;B++,w+=C)v[B].set(u.subarray(w,w+g),k);d(k,m,g,f)}};this.moveArea=function(k,m,g,f,u,w){if(0<w){var C=k+u,B=m+w,F;for(F=f-1;0<=F;F--)v[B+F].set(v[m+F].subarray(k,k+g),C)}else if(0>w)for(C=k+u,B=m+w,F=0;F<f;F++)v[B+F].set(v[m+F].subarray(k,k+g),C);else if(0<u){C=k+u;B=m+w;var U;for(F=g-1;0<=F;F--){var M=C+F;var l=k+F;for(U=0;U<f;U++)v[B+U][M]=v[m+U][l]}}else for(C=k+u,B=m+w,F=0;F<g;F++)for(M=C+F,l=k+F,U=0;U<f;U++)v[B+U][M]=v[m+
U][l];d(k+u,m+w,g,f)};this.getRGBs=function(k,m,g,f,u){var w=new Uint32Array(g*f),C=k+g;f=m+f;for(var B=0;m<f;m++)w.set(v[m].subarray(k,C),B),B+=g;return u?(u(w),null):w};this.repaint=function(k,m,g,f){var u=ba.imgData.data,w=0,C,B;O&&O.begin("paint");0>k&&(g+=k,k=0);0>m&&(f+=m,m=0);k+g>a&&(g=a-k);m+f>b&&(f=b-m);var F=k+g;var U=m+f;if(t)for(u=new Uint32Array(u.buffer),B=m;B<U;B++)u.set(v[B].subarray(k,F),w),w+=a;else{var M=4*(a-g)|0;for(B=m;B<U;B++){for(C=k;C<F;C++){var l=v[B][C];u[w++]=l&255;u[w++]=
l>>8&255;u[w++]=l>>16&255;u[w++]=255}w+=M}}ba.left=k;ba.top=m;ba.width=g;ba.height=f;O&&O.end("paint");return ba};this.postPaint=d;this.draw=function(k,m,g,f){if(!Y&&n)if(W&&W.complete&&(n.drawImage(W,E,P,Q,ia),URL.revokeObjectURL(W.src),W=null),fa){if(k=e(k,m,g,f),k.width)return ma.repaint(k.x,k.y,k.width,k.height),k.width=0,ba}else if(y.width)return ma.repaint(y.x,y.y,y.width,y.height),y.width=0,ba;return null};this.fillRect=function(k,m,g,f,u){var w=k+g,C=m+f;if(v[0].fill)for(var B,F=m;F<C;F++)v[F].fill(u,
k,w);else for(F=m;F<C;F++)for(B=k;B<w;B++)v[F][B]=u;d(k,m,g,f)};this.drawLine=function(k,m,g,f,u){if(m==f){if(k>g){var w=k;k=g;g=w}var C=v[m];g++;if(C.fill)C.fill(u,k,g);else for(w=k;w<g;w++)C[w]=u}else if(k==g)for(m>f&&(w=m,m=f,f=w),f++,w=m;w<f;w++)v[w][k]=u;else{var B=Math.abs(g-k),F=Math.abs(f-m);w=k;C=m;g=g>=k?k=1:k=-1;m=f>=m?f=1:f=-1;if(B>=F){m=k=0;var U=B;var M=B/2|0;var l=F}else f=g=0,U=F,M=F/2|0,l=B,B=F;if(!(1>B))for(B++,F=0;F<B;F++)v[C][w]=u,M+=l,M>=U&&(M-=U,w+=k,C+=f),w+=g,C+=m}};this.bitBlt=
function(k,m,g,f,u,w,C,B,F,U){var M=ma;switch(k){case 0:B=M.setRGB;for(M=g;M<g+u;M++)for(F=f;F<f+w;F++)B(M,F,0);break;case 1:k=C;F=U*B+F;U=M.setRGB;m=M.getRGB;null==k&&(k=M);for(M=0;M<w;M++){for(C=0;C<u;C++)U(g+u,f+w,~(m(g+u,f+w)|k[F])&16777215);F+=B-u}break;case 2:k=C;F=U*B+F;U=M.setRGB;m=M.getRGB;null==k&&(k=M);for(M=0;M<w;M++){for(C=0;C<u;C++){var l=m(g+u,f+w);U(g+u,f+w,l&~k[F]&16777215);F++}F+=B-u}break;case 3:h(M,C,B,F,U,u,w);C?M.setRGBs(g,f,u,w,C,U*B+F,B):M.moveArea(F,U,u,w,g-F,f-U);break;case 4:h(M,
null,m,g,f,u,w);q(M,m,g,f,u,w,C,B,F,U);break;case 5:h(M,null,m,g,f,u,w);break;case 6:k=C;F=U*B+F;null==k&&(k=M);for(M=0;M<w;M++){for(U=0;U<u;U++)v[f+M][g+U]=v[f+M][g+U]^k[F]&16777215|4278190080,F++;F+=B-u}break;case 7:k=C;F=U*B+F;U=M.setRGB;m=M.getRGB;null==k&&(k=M);for(M=0;M<w;M++){for(C=0;C<u;C++)l=m(g+C,f+M),U(g+C,f+M,~(l&k[F])&16777215),F++;F+=B-u}break;case 8:q(M,m,g,f,u,w,C,B,F,U);break;case 9:k=C;F=U*B+F;U=M.setRGB;m=M.getRGB;null==k&&(k=M);for(M=0;M<w;M++){for(C=0;C<u;C++)l=m(g+C,f+M),U(g+
C,f+M,l^~k[F]&16777215),F++;F+=B-u}break;case 10:break;case 11:k=C;F=U*B+F;U=M.setRGB;m=M.getRGB;null==k&&(k=M);for(M=0;M<w;M++){for(C=0;C<u;C++)l=m(g+C,f+M),U(g+C,f+M,l|~k[F]&16777215),F++;F+=B-u}break;case 12:C?M.setRGBs(g,f,u,w,C,U*B+F,B):M.moveArea(F,U,u,w,g-F,f-U);break;case 13:h(M,null,m,g,f,u,w);L(M,m,g,f,u,w,C,B,F,U);break;case 14:L(M,m,g,f,u,w,C,B,F,U);break;case 15:B=M.setRGB;for(M=g;M<g+u;M++)for(F=f;F<f+w;F++)B(M,F,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+k)}d(g,
f,u,w)};this.drawLineExt=function(k,m,g,f,u,w){if(k==g||m==f){var C;if(m==f)if(g>k){var B=g-k;if(!(1>B))for(C=0;C<B;C++)A(w,k+C,m,u)}else{if(B=k-g,!(1>B))for(C=0;C<B;C++)A(w,g+C,m,u)}else if(f>m){if(B=f-m,!(1>B))for(C=0;C<B;C++)A(w,k,m+C,u)}else if(B=m-f,!(1>B))for(C=0;C<B;C++)A(w,k,f+C,u)}else{var F=Math.abs(g-k),U=Math.abs(f-m);C=k;B=m;var M,l;var I=g>=k?M=1:M=-1;var H=f>=m?l=1:l=-1;if(F>=U){H=M=0;var R=F;var ca=F/2>>0;var pa=U}else l=I=0,R=U,ca=U/2>>0,pa=F,F=U;if(1>F)return;for(U=0;U<=F;U++)A(w,
C,B,u),ca+=pa,ca>=R&&(ca-=R,C+=M,B+=l),C+=I,B+=H}u=Math.min(k,g);k=Math.max(k,g);g=Math.min(m,f);m=Math.max(m,f);0>k-u||0>m-g||d(u,g,k-u+1,m-g+1)};this.drawText=function(k,m,g,f,u,w,C,B,F,U,M,l,I,H,R,ca,pa,ua,Ba,Ea,Ca){var za=0;1<l?G(U,M,l,I,u,ua,Ba,Ea,Ca):1==g&&G(w,C,B,F,u,ua,Ba,Ea,Ca);for(var Ia=ca,wa=0;wa<ca;)switch(pa[za+wa]){case 255:var Aa=pa[za+wa+2];if(Aa>Ia-za){wa=ca=0;break}Aa=pa.slice?pa.slice(za,za+Aa):pa.subarray(za,za+Aa);S[pa[za+wa+1]]=Aa;wa+=3;ca-=wa;za=wa;wa=0;break;case 254:var Na=
(Aa=S[pa[za+wa+1]])?Aa:null;Na&&0==Na[1]&&0==(m&32)&&(0!=(m&4)?R+=pa[za+wa+2]:H+=pa[za+wa+2]);wa=wa+2<ca?wa+3:wa+2;ca-=wa;za=wa;wa=0;if(!Na)break;for(var Ya=Na.length,Za=0;Za<Ya;Za++){Aa=ra.getFont(k,Na[Za]);if(0==(m&32)){var Wa=Na[++Za];0!=(Wa&128)?(0!=(m&4)?R+=Na[Za+1]|Na[Za+2]<<8:H+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(m&4)?R+=Wa:H+=Wa}Aa&&(J(g,H+Aa.offset&65535,R+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,u,f,ua,Ba,Ea,Ca),0!=(m&32)&&(H+=Aa.width))}break;default:Aa=ra.getFont(k,pa[za+wa]),0==
(m&32)&&(Wa=pa[za+ ++wa],0!=(Wa&128)?(0!=(m&4)?R+=pa[za+wa+1]|pa[za+wa+2]<<8:H+=pa[za+wa+1]|pa[za+wa+2]<<8,wa+=2):0!=(m&4)?R+=Wa:H+=Wa),Aa&&(J(g,H+Aa.offset&65535,R+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,u,f,ua,Ba,Ea,Ca),0!=(m&32)&&(H+=Aa.width)),wa++}1<l?0<I&&d(U,M,l,I):0<B&&0<F&&d(w,C,B,F)};this.drawBitmap=function(k,m,g,f,u,w,C,B,F){var U=va.getBitmap(k,m);U?(k=U.width,m=U.height,u>k&&(u=k),w>m&&(w=m),12==F?ma.setRGBs(g,f,u,w,U.data,B*k+C,k):ma.bitBlt(F,a,g,f,u,w,U.data,k,C,B)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
k+" idx="+m)};this.saveDesktop=function(k,m,g,f,u){ma.getRGBs(k,m,g,f,function(w){Z.save(k,m,g,f,u,w)})};this.restoreDesktop=function(k,m,g,f,u){(u=Z.restore(k,m,g,f,u))?ma.setRGBs(k,m,g,f,u,0,g):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(k,m,g){ra.putFont(k,m,g)};this.putBitmap=function(k,m,g){va.putBitmap(k,m,g)};this.putCursor=function(k,m){aa.set(k,m)};this.setCursor=function(k){if(!Y&&-1!=k){var m=aa.get(k);if(m)ma.onSetCursor(m);else svGlobal.logger.warn("invalid cursor"+
k)}};var ja=0;this.isSendingHistory=function(){return 2E3>Date.now()-ja};this.getHistory=function(k,m){var g=null;(g=aa.toPDU())&&k(g.buffer);if(ma.onGetGfxHistory)ma.onGetGfxHistory(k,m);else{O&&O.begin("his_bitmap");va.forEach(function(B,F,U){if(B){var M=0,l=0;U=0;for(var I=B.length;U<I;U++)B[U]&&B[U].data&&(M++,l+=B[U].raw?B[U].raw.length:4*B[U].data.length);if(M&&l){g=new Uint8Array(l+20*M+8);g[0]=29;g[2]=1;g[3]=4;l=new hi5.DataBuffer(g,4,g.length);l.setLittleEndian32(M);for(U=0;U<I;U++)(M=B[U])&&
M.data&&(l.setLittleEndian16(F),l.setLittleEndian16(U),l.setLittleEndian16(M.left),l.setLittleEndian16(M.top),l.setLittleEndian16(M.width),l.setLittleEndian16(M.height),l.setLittleEndian16(M.bitsperpixel),l.setLittleEndian16(M.codec),l.setLittleEndian32(M.raw?M.raw.length:4*M.data.length),l.setBytes(M.raw||new Uint8Array(M.data.buffer)));k(g.buffer)}}});O&&O.end("his_bitmap");O&&O.begin("his_font");(g=ra.toPDU())&&k(g.buffer);O&&O.end("his_font");for(var f=4,u=0,w=S.length;u<w;u++)S[u]&&(f+=S[u].length+
6);if(4<f){g=new Uint8Array(f);g[0]=29;g[2]=1;g[3]=7;var C=4;u=0;for(w=S.length;u<w;u++)S[u]&&S[u].length&&(g[C++]=u,g[C++]=u>>8,f=S[u].length,g[C++]=f,g[C++]=f>>8,g[C++]=f>>16,g[C++]=f>>24,g.set(S[u],C),C+=f);k(g.buffer)}(g=Z.toPDU())&&k(g.buffer);m();ja=Date.now()}};this.onHistoryDone=function(){ma.onGetGfxHistory&&p.reconnect(a,b,!0)};this.setHistory=function(k,m){svGlobal.logger.info("setHistory type:"+k);switch(k){case 4:O&&O.begin("his_bitmap_dec");var g=m.getLittleEndian32();for(k=0;k<g;k++){var f=
m.getLittleEndian16(),u=m.getLittleEndian16(),w=m.getLittleEndian16(),C=m.getLittleEndian16(),B=m.getLittleEndian16(),F=m.getLittleEndian16(),U=m.getLittleEndian16(),M=m.getLittleEndian16(),l=m.getLittleEndian32(),I=new Uint8Array(m.getData().buffer,m.getPosition(),l),H=new Uint8Array(l);H.set(I);I=rdpcodecs.bitmap;switch(M){case 0:var R=new Uint32Array(H.buffer);m.skipPosition(l);break;case 1:switch(U){case 16:R=I.decompressInt16(B,F,l,H,0);break;case 24:R=I.decompressInt24(B,F,l,H,0);break;case 32:R=
I.decompressInt32(B,F,l,H,0)}m.skipPosition(l);break;case 2:R=new rdpcodecs.NSCodec,R.process(m,U,B,F),l=R.getData(),R=R.getDataSize(),R=new Uint32Array(R),rdpcodecs.flipimage(l,0,R,B,F,1)}va.putBitmap(f,u,new rdpcodecs.Bitmap(R,B,F,w,C,U,0==M?null:H,M))}O&&O.end("his_bitmap_dec");break;case 5:ra.fromStream(m);break;case 6:aa.fromStream(m);break;case 7:for(;m.has(6);)if(k=m.getLittleEndian16(),l=m.getLittleEndian32())g=m.getData().subarray(m.getPosition(),m.getPosition()+l),S[k]=g,m.skipPosition(l);
break;case 9:Z.fromStream(m);break;default:if(ma.onSetGfxHistory)ma.onSetGfxHistory(k,m)}};var aa=new function(){var k=[],m=!1;this.useRemoteCursor=function(g){m=g};this.set=function(g,f){m&&(f.system="");k[g]=f};this.get=function(g){return k[g]};this.total=function(){return k.length};this.toPDU=function(){for(var g=2,f=2,u=0,w=0,C=k.length,B;w<C;w++)if(B=k[w])u++,f=f+7+(B.rawData?B.rawData.length:0);if(!u)return null;f=new Uint32Array(f);f[0]=100728861;f[1]=u;for(w=0;w<C;w++)if(B=k[w])if(u=B.rawData?
B.rawData.length:0,f[g++]=B.cache_idx|B.bpp<<16,f[g++]=B.hotX|B.hotY<<16,f[g++]=B.width|B.height<<16,f[g++]=B.xorSize,f[g++]=B.andSize,f[g++]=B.distance,f[g++]=u)f.set(B.rawData,g),g+=u;return f};this.fromStream=function(g){var f=g.getPosition();g=new Uint32Array(g.getData().buffer,f);var u=g[0],w=0;for(f=1;w<u;w++){var C=g[f]&65535;var B=g[f++]>>16;var F=g[f]&65535;var U=g[f++]>>16;var M=g[f]&65535;var l=g[f++]>>16;var I=g[f++];var H=g[f++];var R=g[f++];var ca=g[f++];var pa=null;ca&&(pa=new Uint32Array(ca),
pa.set(g.subarray(f,f+ca)),f+=ca);B=new z(C,pa,F,U,M,l,B,I,H);R&&(B.distance=R);m&&(B.system="");k[C]=B}}};aa.useRemoteCursor(!!la.remoteCursor);var Z=new function(){function k(g,f,u,w,C,B){this.x=g;this.y=f;this.cx=u;this.cy=w;this.offset=C;this.data=B}var m=[];this.save=function(g,f,u,w,C,B){g=new k(g,f,u,w,C,B);f=0;for(u=m.length;f<u;f++)if(!m[f]){m[f]=g;return}m.push(g)};this.restore=function(g,f,u,w,C){for(var B,F=0,U=m.length;F<U;F++)if((B=m[F])&&B.x==g&&B.y==f&&B.cx==u&&B.cy==w){if(B.offset==
C)return g=B.data,m[F]=null,g;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var g=0,f=2,u=0,w=m.length;u<w;u++)m[u]&&(g++,f+=m[u].data.length+6);if(!g||!f)return null;f=new Uint32Array(f);var C=2;f[0]=151060509;f[1]=g;for(u=0;u<w;u++)if(g=m[u])f[C++]=g.x,f[C++]=g.y,f[C++]=g.cx,f[C++]=g.cy,f[C++]=g.offset,f[C++]=g.data.length,f.set(g.data,C),C+=g.data.length;return f};this.fromStream=function(g){g=new Uint32Array(g.getData().buffer,g.getPosition());for(var f=1,u=g[0],
w,C,B,F,U,M,l,I=0;I<u;I++)w=g[f++],C=g[f++],B=g[f++],F=g[f++],U=g[f++],M=g[f++],l=new Uint32Array(M),M=f+M,l.set(g.subarray(f,M)),f=M,this.save(w,C,B,F,U,l)}},S=[],ra=new function(){var k=[];this.putFont=function(m,g,f){k[m]||(k[m]=[]);k[m][g]=f};this.getFont=function(m,g){return k[m]?k[m][g]:null};this.toPDU=function(){var m=0,g,f,u;var w=4;for(var C,B=k.length;m<B;m++)if((u=k[m])&&u.length)for(C=u.length,g=0;g<C;g++)(f=u[g])&&(w+=15+f.fontData.length);if(5>w)return null;var F=new Uint8Array(w);
w=new hi5.DataBuffer(F,0,w);F[0]=29;F[2]=1;F[3]=5;w.skipPosition(4);m=0;for(B=k.length;m<B;m++)if((u=k[m])&&u.length)for(C=u.length,g=0;g<C;g++)if(f=u[g])w.setByte(m),w.setLittleEndian16(g),w.setLittleEndian16(f.offset),w.setLittleEndian16(f.baseLine),w.setLittleEndian16(f.width),w.setLittleEndian16(f.height),w.setLittleEndian32(f.fontData.length),w.setBytes(f.fontData);return F};this.fromStream=function(m){for(;m.has(15);){var g=m.getByte(),f=m.getLittleEndian16(),u=m.getLittleEndian16(),w=m.getLittleEndian16(),
C=m.getLittleEndian16(),B=m.getLittleEndian16(),F=m.getLittleEndian32();F=m.getBytes(F);this.putFont(g,f,new x(u,w,C,B,F))}}},va=new function(){var k=[],m=[];this.putBitmap=function(g,f,u){if(32767==f)m[g]&&(m[g].data=null,m[g]=null),m[g]=u;else{var w=k[g];w?w[f]&&(w[f].data=null,w[f]=null):k[g]=w=[];w[f]=u}};this.getBitmap=function(g,f){return 32767==f?m[g]:k[g]?k[g][f]:null};this.forEach=function(g){for(var f=k.length,u=0;u<f;u++)g(k[u],u,k)}}}function Nb(a){function b(l,I,H){I[H]=l>>24&255;I[H+
1]=l>>16&255;I[H+2]=l>>8&255;I[H+3]=l&255}function c(l,I){var H=l.length;I=new Uint8Array(I?H+1:H);for(var R=0;R<H;R++)I[R]=l.charCodeAt(R);return I}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),h={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},
q=this,L=1,A=a?48E3:9E4,G=1,J=!1,x=null;this.initTypes=function(){for(var l in h)h[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)];h.url=[117,114,108,32]};q.initTypes();this.reset=function(){J=!1;G=L=1};this.close=function(){q&&(q.reset(),q=null)};this.remux=function(l){l.id=L;l.isAudio=a;l.timeScale=a?l.audioHeader.sampleRate:A;if(!J){var I=new v(a),H=new n(l);x=new Uint8Array(I.data.length+H.data.length);x.set(I.data,0);x.set(H.data,I.data.length);J=!0}l.sequenceNumber=G++;
I=new u(l);H=new M(l);l=new Uint8Array(I.data.length+H.data.length);l.set(I.data,0);l.set(H.data,I.data.length);x&&(I=new Uint8Array(x.length+l.length),I.set(x,0),I.set(l,x.length),l=I,x=null);if(q.ondata)q.ondata(l)};var z=function(l){this.type=l;this.data=null};z.prototype.setData=function(){var l=Array.prototype.slice.call(arguments,0),I=l.length,H=8,R;for(R=0;R<I;R++)H+=l[R].byteLength;this.data=new Uint8Array(H);b(H,this.data,0);this.data.set(this.type,4);H=8;for(R=0;R<I;R++)this.data.set(l[R],
H),H+=l[R].byteLength};var v=function(l){var I=z.call(this,h.ftyp)||this;var H=c("mp42"),R=c("mp41"),ca=c("isom"),pa=c("avc1"),ua=c("iso5"),Ba=new Uint8Array([0,0,2,0]);l?I.setData(H,Ba,H,R,ca,ua):I.setData(ca,Ba,ca,R,ua,pa);return I};$jscomp.inherits(v,z);var n=function(l){var I=z.call(this,h.moov)||this;var H=new y(l),R=new t(l);l=new g(l);I.setData(H.data,R.data,l.data);return I};$jscomp.inherits(n,z);var y=function(l){l=z.call(this,h.mvhd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,
0]),R=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]),pa=new Uint8Array(4);b(1E3,pa,0);var ua=new Uint8Array([0,1,0,0]),Ba=new Uint8Array([1,0]),Ea=new Uint8Array(10),Ca=new Uint8Array(36);Ca[1]=1;Ca[17]=1;Ca[32]=64;var za=new Uint8Array(24),Ia=new Uint8Array([255,255,255,255]);l.setData(I,H,R,ca,pa,e,ua,Ba,Ea,Ca,za,Ia);return l};$jscomp.inherits(y,z);var t=function(l){var I=z.call(this,h.trak)||this;var H=new O(l);l=new E(l);I.setData(H.data,l.data);return I};$jscomp.inherits(t,z);var O=function(l){var I=
z.call(this,h.tkhd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,7]),ca=new Uint8Array([0,0,0,0]),pa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(l.id,ua,0);var Ba=new Uint8Array(4),Ea=new Uint8Array(8),Ca=new Uint8Array([0,0]),za=new Uint8Array([0,0]),Ia=l.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),wa=new Uint8Array(2),Aa=new Uint8Array(36);Aa[1]=1;Aa[17]=1;Aa[32]=64;var Na=new Uint8Array(4);Na[0]=l.width>>8&255;Na[1]=l.width&255;Na[2]=0;Na[3]=0;var Ya=new Uint8Array(4);Ya[0]=
l.height>>8&255;Ya[1]=l.height&255;Ya[2]=0;Ya[3]=0;I.setData(H,R,ca,pa,ua,Ba,e,Ea,Ca,za,Ia,wa,Aa,Na,Ya);return I};$jscomp.inherits(O,z);var E=function(l){var I=z.call(this,h.mdia)||this;var H=new P(l),R=new Q(l);l=new ia(l);I.setData(H.data,R.data,l.data);return I};$jscomp.inherits(E,z);var P=function(l){var I=z.call(this,h.mdhd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,0]),pa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(l.timeScale,ua,0);l=new Uint8Array([85,
196]);var Ba=new Uint8Array(2);I.setData(H,R,ca,pa,ua,e,l,Ba);return I};$jscomp.inherits(P,z);var Q=function(l){var I=z.call(this,h.hdlr)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array(4);l=l.isAudio?c("soun"):c("vide");var pa=new Uint8Array(12),ua=c("Remote Spark Handler",!0);I.setData(H,R,ca,l,pa,ua);return I};$jscomp.inherits(Q,z);var ia=function(l){var I=z.call(this,h.minf)||this;var H=new D,R=new Y(l);l.isAudio?(l=new X,I.setData(l.data,H.data,R.data)):(l=new W,I.setData(l.data,
H.data,R.data));return I};$jscomp.inherits(ia,z);var W=function(){var l=z.call(this,h.vmhd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,1]),R=new Uint8Array([0,0]),ca=new Uint8Array(6);l.setData(I,H,R,ca);return l};$jscomp.inherits(W,z);var X=function(){var l=z.call(this,h.smhd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0]),ca=new Uint8Array(2);l.setData(I,H,R,ca);return l};$jscomp.inherits(X,z);var D=function(){var l=z.call(this,h.dinf)||this;var I=new ea;
l.setData(I.data);return l};$jscomp.inherits(D,z);var ea=function(){var l=z.call(this,h.dref)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,1]),ca=new fa;l.setData(I,H,R,ca.data);return l};$jscomp.inherits(ea,z);var fa=function(){var l=z.call(this,h.url)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,1]);l.setData(I,H);return l};$jscomp.inherits(fa,z);var Y=function(l){var I=z.call(this,h.stbl)||this;l=new ma(l);var H=new ra,R=new va,ca=new k,pa=new m;I.setData(l.data,
H.data,R.data,ca.data,pa.data);return I};$jscomp.inherits(Y,z);var ma=function(l){var I=z.call(this,h.stsd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,1]);l.isAudio?(l=new ba(l),I.setData(H,R,ca,l.data)):(l=new aa(l),I.setData(H,R,ca,l.data));return I};$jscomp.inherits(ma,z);var ba=function(l){var I=z.call(this,h.mp4a)||this;var H=new Uint8Array(6),R=new Uint8Array([0,1]),ca=new Uint8Array(8),pa=new Uint8Array([0,2]),ua=new Uint8Array([0,16]),Ba=new Uint8Array([0,
0]),Ea=new Uint8Array(2),Ca=l.audioHeader.sampleRate,za=new Uint8Array(4);za[0]=Ca>>8&255;za[1]=Ca&255;za[2]=0;za[3]=0;l=new ja(l);I.setData(H,R,ca,pa,ua,Ba,Ea,za,l.data);return I};$jscomp.inherits(ba,z);var ja=function(l){var I=z.call(this,h.esds)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array([3]),pa=new Uint8Array([25]),ua=new Uint8Array([0,0]),Ba=new Uint8Array([0]),Ea=new Uint8Array([4]),Ca=new Uint8Array([17]),za=new Uint8Array([64]),Ia=new Uint8Array([21]),wa=new Uint8Array(3),
Aa=l.bufferSizeDB;wa[0]=Aa>>16&255;wa[1]=Aa>>8&255;wa[2]=Aa&255;Aa=new Uint8Array(4);b(l.bitRate,Aa,0);var Na=new Uint8Array(4);b(l.bitRate,Na,0);var Ya=new Uint8Array([5]),Za=new Uint8Array([2]),Wa=l.audioHeader.audioType||2,nb=l.audioHeader.frequencyIdx,xb=l.audioHeader.channelConfig;l=new Uint8Array(2);l[0]=Wa<<3|nb>>1&7;l[1]=(nb&1)<<7|xb<<3;Wa=new Uint8Array([6]);nb=new Uint8Array([1]);xb=new Uint8Array([2]);I.setData(H,R,ca,pa,ua,Ba,Ea,Ca,za,Ia,wa,Aa,Na,Ya,Za,l,Wa,nb,xb);return I};$jscomp.inherits(ja,
z);var aa=function(l){var I=z.call(this,h.avc1)||this;var H=new Uint8Array(6),R=new Uint8Array([0,1]),ca=new Uint8Array([0,0]),pa=new Uint8Array(2),ua=new Uint8Array(12),Ba=new Uint8Array(2);Ba[0]=l.width>>8&255;Ba[1]=l.width&255;var Ea=new Uint8Array(2);Ea[0]=l.height>>8&255;Ea[1]=l.height&255;var Ca=new Uint8Array([0,72,0,0]),za=new Uint8Array([0,72,0,0]),Ia=new Uint8Array(4),wa=new Uint8Array([0,1]),Aa=c("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=Aa.length;Na.set(Aa,1);Aa=new Uint8Array([0,
24]);var Ya=new Uint8Array([255,255]);l=new Z(l);I.setData(H,R,ca,pa,ua,Ba,Ea,Ca,za,Ia,wa,Na,Aa,Ya,l.data);return I};$jscomp.inherits(aa,z);var Z=function(l){var I=z.call(this,h.avcC)||this;var H=new Uint8Array([1]),R=new Uint8Array([l.sps[1]]),ca=new Uint8Array([l.sps[2]]),pa=new Uint8Array([l.sps[3]]),ua=new Uint8Array([255]),Ba=new Uint8Array([225]),Ea=new Uint8Array(2),Ca=l.sps.byteLength;Ea[0]=Ca>>8&255;Ea[1]=Ca&255;Ca=new Uint8Array(l.sps);var za=new Uint8Array([1]),Ia=new Uint8Array(2),wa=
l.pps.byteLength;Ia[0]=wa>>8&255;Ia[1]=wa&255;l=new Uint8Array(l.pps);I.setData(H,R,ca,pa,ua,Ba,Ea,Ca,za,Ia,l);return I};$jscomp.inherits(Z,z);var S=function(){var l=z.call(this,h.btrt)||this;var I=new Uint8Array([0,28,156,128]),H=new Uint8Array([0,45,198,192]),R=new Uint8Array([0,45,198,192]);l.setData(I,H,R);return l};$jscomp.inherits(S,z);var ra=function(){var l=z.call(this,h.stts)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);l.setData(I,H,R);return l};
$jscomp.inherits(ra,z);var va=function(){var l=z.call(this,h.stsc)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);l.setData(I,H,R);return l};$jscomp.inherits(va,z);var k=function(){var l=z.call(this,h.stsz)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]);l.setData(I,H,R,ca);return l};$jscomp.inherits(k,z);var m=function(){var l=z.call(this,h.stco)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,
0,0]),R=new Uint8Array([0,0,0,0]);l.setData(I,H,R);return l};$jscomp.inherits(m,z);var g=function(l){var I=z.call(this,h.mvex)||this;l=new f(l);I.setData(l.data);return I};$jscomp.inherits(g,z);S=function(l){l=z.call(this,h.mehd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]);l.setData(I,H,d);return l};$jscomp.inherits(S,z);var f=function(l){var I=z.call(this,h.trex)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l.id,ca,0);l=new Uint8Array([0,0,0,1]);
var pa=new Uint8Array([0,0,0,0]),ua=new Uint8Array([0,0,0,0]),Ba=new Uint8Array([0,0,0,0]);I.setData(H,R,ca,l,pa,ua,Ba);return I};$jscomp.inherits(f,z);var u=function(l){var I=z.call(this,h.moof)||this;w.setSequenceNumber(l.sequenceNumber);l=new C(l);I.setData(w.data,l.data);return I};$jscomp.inherits(u,z);S=function(l){var I=z.call(this,h.mfhd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);I.setData(H,R,ca);return I};$jscomp.inherits(S,z);S.prototype.setSequenceNumber=
function(l){b(l,this.data,12)};var w=new S(1),C=function(l){var I=z.call(this,h.traf)||this;B.setTrackId(l.id);B.setSampleDuration(l.frameDuration);F.setBaseMediaDecodeTime(l.samples[0].timestamp);var H=32+B.data.length+F.data.length;if(l.isAudio)l=new U(l,null,H);else{for(var R=[],ca=0;ca<l.samples.length;ca++){var pa=l.samples[ca];R.push({size:pa.unitsLength+4*pa.units.length,duration:l.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:pa.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,
isNonSync:pa.hasIDR?0:1,degradationPriority:0}})}l=new U(l,R,H)}I.setData(B.data,F.data,l.data);return I};$jscomp.inherits(C,z);S=function(l,I){var H=z.call(this,h.tfhd)||this;H.isAudio=I;var R=new Uint8Array([0]),ca=I?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),pa=new Uint8Array(4);b(l,pa,0);I?(l=new Uint8Array([0,0,0,1]),I=new Uint8Array(4),b(1024,I,0),H.setData(R,ca,pa,l,I)):(l=new Uint8Array([0,0,2,0,1,1,0,0]),H.setData(R,ca,pa,l));return H};$jscomp.inherits(S,z);S.prototype.setTrackId=
function(l){b(l,this.data,12)};S.prototype.setSampleDuration=function(l){this.isAudio||b(l,this.data,16)};var B=new S(0,a);S=function(l){var I=z.call(this,h.tfdt)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);I.setData(H,R,ca);return I};$jscomp.inherits(S,z);S.prototype.setBaseMediaDecodeTime=function(l){b(l,this.data,12)};var F=new S(0),U=function(l,I,H){var R=z.call(this,h.trun)||this;var ca=new Uint8Array([0]),pa=l.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,
15,1]),ua=l.isAudio?4:16;H+=ua*(l.isAudio?l.samples.length:I.length)+28;var Ba=new Uint8Array(4);l.isAudio?b(l.samples.length,Ba,0):b(I.length,Ba,0);var Ea=new Uint8Array(4);b(H,Ea,0);if(l.isAudio){H=new Uint8Array(ua*l.samples.length);for(var Ca=0;Ca<l.samples.length;Ca++)b(l.samples[Ca].aacData.byteLength,H,ua*Ca)}else for(H=new Uint8Array(ua*I.length),Ca=0;Ca<I.length;Ca++){l=I[Ca];var za=ua*Ca;b(l.duration,H,za);b(l.size,H,za+4);var Ia=l.flags,wa=new Uint8Array(4);wa[0]=Ia.isLeading<<2|Ia.dependsOn;
wa[1]=Ia.isDependedOn<<6|Ia.hasRedundancy<<4|0|Ia.isNonSync;wa[2]=Ia.degradationPriority&61440;wa[3]=Ia.degradationPriority&15;H.set(wa,za+8);b(l.compositionTimeOffset,H,za+12)}R.setData(ca,pa,Ba,Ea,H);return R};$jscomp.inherits(U,z);S=function(l){var I=z.call(this,h.sdtp)||this;for(var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ca=new Uint8Array(l.length),pa=0;pa<l.length;pa++){var ua=l[pa].flags;ca[pa]=ua.isLeading<<6|ua.dependsOn<<4|R.isDependedOn<<2|R.hasRedundancy}I.setData(H,R,ca);return I};
$jscomp.inherits(S,z);var M=function(l){var I=z.call(this,h.mdat)||this;if(l.isAudio){for(var H=new Uint8Array(l.totalByteLength),R=0,ca=0;ca<l.samples.length;ca++){var pa=l.samples[ca].aacData;H.set(pa,R);R+=pa.byteLength}I.setData(H)}else{H=new Uint8Array(4*l.unitNum+l.totalByteLength);for(ca=R=0;ca<l.samples.length;ca++){pa=l.samples[ca];for(var ua=0;ua<pa.units.length;ua++){var Ba=pa.units[ua],Ea=Ba.data.byteLength;b(Ea,H,R);R+=4;H.set(Ba.data,R);R+=Ea}}I.setData(H)}return I};$jscomp.inherits(M,
z)}function tc(a){function b(G,J){this.aacData=G;this.timestamp=J}function c(G,J,x,z){this.audioType=G;this.frequencyIdx=J;this.sampleRate=x;this.channelConfig=z}var e=tc.SAMPLING_FREQUENCY,d=null,h=!0,q=this,L=0;this.reset=function(){L=0;d=null;A.audioHeader=null;a&&a.reset()};var A=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=
this.duration=0}};this.setMediaFormat=function(G,J){var x=G.frequencyIdx;x||(x=e.indexOf(G.sampleRate));-1==x&&console.error("Invalid AAC sampel rate: "+G.sampleRate);d=new c(G.audioType||2,x,G.sampleRate,G.channels||G.channelConfig);A.audioHeader=d;h=!J;if(q.oncodec)q.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(G){if(h){var J=q.readADTSHeader(G);G=G.subarray(J)}J=new b(G,L);L+=1024;A.samples.push(J);A.totalByteLength+=G.byteLength;G=1/(d.sampleRate/1024);A.duration=G;A.samples[0]&&
(A.bitRate=8*A.samples[0].aacData.length/G|0);a&&a.remux(A);A.clear()};this.readADTSHeader=function(G){var J=G[1]&0?9:7,x=(G[2]>>6&3)+1,z=G[2]>>2&15,v=e[z];v||console.error("Invalid Sampling Frequency Index: "+z);var n=((G[2]&1)<<2)+(G[3]>>6&3),y=G[1]>>1&3;0!=y&&console.error("Invalid data format: layer is not 0x00: "+y.toString(16));G.length!=((G[3]&3)<<11)+(G[4]<<3)+(G[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+G.length);if(d){if(z!=d.frequencyIdx&&(d.frequencyIdx=z,d.sampleRate=
v,q.oncodec))q.oncodec("mp4a.40.2",d)}else if(d=new c(x,z,v,n),A.audioHeader=d,q.oncodec)q.oncodec("mp4a.40.2",d);return J}}function Yc(a){function b(){if(0==L)console.error("no more ExpGolomb data");else{var J=0,x=q-L;for(A=0;x<q;){var z=a[x];if(3!=z||0!=a[x-1]||0!=a[x-2])A=A<<8|z,J++;x++;if(4<=J)break}4>J&&(A<<=4-J);G=8*J;L=q-x}}function c(J){if(!(G>J)){J-=G;var x=J>>3;J-=x>>3;L-=x;b()}A<<=J;G-=J}function e(J){var x=Math.min(G,J),z=A>>>32-x;32<J&&logger.error("Read more than 32 bits:"+J);G-=x;0<
G?A<<=x:0<L&&b();x=J-x;return 0<x?z<<x|e(x):z}function d(){var J;for(J=0;J<G;++J)if(0!==(A&2147483648>>>J))return A<<=J,G-=J,J;b();return J+d()}function h(){c(1+d())}var q=a.byteLength,L=q,A=0,G=0;this.readUEG=function(){var J=d();return e(J+1)-1};this.readEG=function(){var J=this.readUEG();return 1&J?1+J>>>1:-1*(J>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(J){var x=
8,z=8,v;for(v=0;v<J;v++)0!==z&&(z=this.readEG(),z=(x+z+256)%256),x=0===z?x:z};this.readSPS=function(){var J=0,x=0,z=0,v=0,n=1,y,t=0,O=!0;if(7>a.length)return console.log("no enough SPS data"),null;var E=this.readU8();if(7!=(E&31))return console.error("Invalid SPS type: "+E,a),null;E=this.readU8();e(5);c(3);this.readU8();h();if(100===E||110===E||122===E||244===E||44===E||83===E||86===E||118===E||128===E||138===E||139===E||134===E||135===E){var P=this.readUEG();3===P&&c(1);h();h();c(1);if(this.readBool()){var Q=
3!==P?8:12;for(y=0;y<Q;y++)this.readBool()&&(6>y?this.skipScalingList(16):this.skipScalingList(64))}}h();y=this.readUEG();if(0===y)this.readUEG();else if(1===y)for(c(1),c(1+d()),c(1+d()),Q=this.readUEG(),y=0;y<Q;y++)c(1+d());h();c(1);var ia=this.readUEG();y=this.readUEG();Q=e(1);0===Q&&c(1);c(1);this.readBool()&&(J=this.readUEG(),x=this.readUEG(),z=this.readUEG(),v=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var W=[1,1];break;case 2:W=[12,11];break;case 3:W=
[10,11];break;case 4:W=[16,11];break;case 5:W=[40,33];break;case 6:W=[24,11];break;case 7:W=[20,11];break;case 8:W=[32,11];break;case 9:W=[80,33];break;case 10:W=[18,11];break;case 11:W=[15,11];break;case 12:W=[64,33];break;case 13:W=[160,99];break;case 14:W=[4,3];break;case 15:W=[3,2];break;case 16:W=[2,1];break;case 255:W=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}W&&(n=W[0]/W[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&c(24));this.readBool()&&(h(),h());
this.readBool()&&(t=this.readU32(),W=this.readU32(),O=this.readBool(),t=W/(2*t))}n=Math.ceil((16*(ia+1)-2*J-2*x)*n);W=(2-Q)*(y+1)*16-(Q?2:4)*(z+v);y="avc1."+(0==a[1]?"00":a[1].toString(16));y+=0==a[2]?"00":a[2].toString(16);y+=0==a[3]?"00":a[3].toString(16);return{width:n,height:W,profileIdc:E,chromaFormatIdc:P,frameCropLeftOffset:J,frameCropRightOffset:x,frameCropTopOffset:z,frameCropBottomOffset:v,fps:t,fixedFrameRate:O,codec:y}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}
function Ud(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=L;this.unitsLength=A;this.timestamp=d;this.hasIDR=h}function e(){var z=!1;if(q&&J.sps){var v=new c;d+=J.frameDuration||3E3;J.samples.push(v);J.totalByteLength+=A;J.unitNum+=L.length;J.sequence++;z=!0;if(v.hasIDR&&x.onkeyframe)x.onkeyframe(v)}q=
h=!1;L=[];A=0;return z}var d=0,h=!1,q=!1,L=[],A=0,G=Nb.searchStartCode,J=null,x=this;J=new b;this.reset=function(){d=0;h=!1;L=[];A=0;J=new b;a&&a.reset()};this.close=function(){x&&(x.reset(),x=null)};this.parseH264Data=this.parse=function(z){for(var v=[],n=0,y,t,O,E=[0,0];n<z.byteLength;){E[0]=n;G(z,E);var P=E[0];if(-1==P)break;n=E[1];n=P+n;O=z[n];O&=31;y&&(y={type:t,data:z.subarray(y,P)},v.push(y));y=n;t=O}y&&(y={type:t,data:z.subarray(y,z.byteLength)},v.push(y));for(z=0;z<v.length;z++)switch(E=
v[z],n=E.type,n){case 1:case 2:case 3:case 4:L.push(E);A+=E.data.byteLength;q=!0;break;case 5:q=h=!0;L.push(E);A+=E.data.byteLength;break;case 6:break;case 7:n=new Yc(E.data);if(n=n.readSPS()){if(J.width=n.width,J.height=n.height,J.codec=n.codec,J.sps=E.data,n.fps&&(J.frameDuration=9E4/n.fps|0),L.push(E),A+=E.data.byteLength,x.oncodec)x.oncodec(J.codec,n)}else console.log("corrupted sps",E.data);break;case 8:J.pps=E.data;L.push(E);A+=E.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+
n)}e()&&J.sps&&(a.remux(J),J.clear())}}function Ob(a,b,c){function e(){for(;A;){if(t.updating){A=!1;break}var P=L.shift();if(!P)break;try{t.appendBuffer(P),G=0}catch(Q){L.unshift(P);if("QuotaExceededError"==Q.name)if(q(!0))continue;else{if(J.onerror)J.onerror(Q);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),J.close();break}G++;console.error("Failed to append buffer, retry "+G,Q);if(2<G){if(J.onerror)J.onerror(Q);break}}}}function d(){A=!0;e()}function h(){t=y.addSourceBuffer(x);
t.mode="sequence";t.addEventListener("updateend",d);t.addEventListener("error",function(P){console.error(P)});A=!0;J.play(!1);e()}function q(P){var Q=Math.min(a.played.end(0),t.buffered.end(0)),ia=0,W=n.length,X=!1,D=0;if(c)D=Q-180,0>D&&console.warn("Not possible, time played secs: "+Q);else if(1<W){var ea=W-2;for(Q=9E4*Q|0;ia<W;){if(n[ia]>Q){ea=ia-2;break}ia++}0<=ea&&(D=(n[ea]+1E3)/9E4)}if(0<D)try{t.remove(0,D),n.splice(0,ea+1),X=!0,console.info("Buffer removed "+D+" isAudio: "+c)}catch(fa){console.warn("Buffer removal "+
D+" failed, retry, isAudio: "+c)}P||(v=setTimeout(q,18E4));return X}var L=[],A=!1,G=0,J=this,x="",z=null,v=0,n=[],y=null,t=null,O=null,E=null;a.autoplay=!0;this.getKeyFrames=function(){return n};O=new Nb(c);O.ondata=function(P){L.push(P);e()};E=c?new tc(O):new Ud(O);E.onkeyframe=function(P){n.push(P.timestamp)};E.oncodec=function(P,Q){var ia=c?"audio/mp4;codecs=":"video/mp4;codecs=";ia+=P;if(ia!=x||(c?z.sampleRate!=Q.sampleRate:z.width!=Q.width||z.height!=Q.height))if(x=ia,z=Q,A=!1,t=null,y=new MediaSource,
y.addEventListener("sourceopen",h),a.src=URL.createObjectURL(y),J.onsps)J.onsps(Q)};b.onvideoframe=function(P){E.parse(P.bitstream)};b.onaudioframe=function(P){E.parse(P)};b.onendofstream=function(){J.reset()};this.play=function(P){a.play().catch(function(Q){if(!P&&(console.error(Q),J.onplayerror))J.onplayerror(Q)})};this.reset=function(){console.log("Reset player");v&&(clearTimeout(v),v=0);n.length=0;A=!1;x="";z=null;E&&E.reset();L.length=0};this.close=function(){J&&(J.reset(),y&&"open"==y.readyState&&
(y.endOfStream(),a.src=null),E&&E.close&&E.close(),O&&O.close&&O.close(),J=null)};this.setMediaFormat=function(P,Q){E.setMediaFormat&&E.setMediaFormat(P,Q)};this.getMediaSource=function(){return y};this.getMediaSourceBuffer=function(){return t};a.addEventListener("ended",function(P){console.warn(".... ended");v&&(clearTimeout(v),v=0)});a.addEventListener("emptied",function(P){A=!!t});a.addEventListener("pause",function(P){console.warn(".... paused");A=!!t;var Q=a.currentTime;a.play().then(function(){console.warn("... played: "+
a.currentTime+" t: "+Q)}).catch(function(ia){console.error(ia)})});a.addEventListener("waiting",function(P){A=!!t})}function Vd(a,b,c,e){function d(n,y,t,O){var E,P,Q,ia,W,X,D,ea,fa,Y,ma,ba,ja,aa,Z,S,ra,va,k,m,g,f,u,w,C,B,F,U,M,l,I,H,R,ca,pa,ua,Ba,Ea,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return E=n.allocationSize(),P=new Uint8Array(E),za.yield(n.copyTo(P),2);Q=n.codedWidth;ia=(Q+1)/2|0;W=n.codedHeight;X=(W+1)/2|0;D=Q*W;ea=D+ia*X;fa=2*D;Y=y.subarray(D,
fa);ma=y.subarray(fa);ra=S=Z=aa=ja=ba=0;g=m=k=va=null;f=P.subarray(0,D);u=P.subarray(D,ea);w=P.subarray(ea);C=0;for(B=O.length;C<B;C++){F=O[C];U=F.left;M=F.top;l=F.right;I=F.bottom;H=U/2|0;R=M/2|0;ca=l/2|0;pa=I/2|0;ua=H/2|0;Ba=ca/2|0;for(ja=M;ja<I;ja++)for(S=ja*Q,ra=S+Q,va=f.subarray(S,ra),m=Y.subarray(S,ra),g=ma.subarray(S,ra),ba=H;ba<ca;ba++)Z=2*ba+1,m[Z]=va[ba],g[Z]=va[ba+ia];Ea=(ia+1)/2|0;if(t)for(Ca=P.subarray(D),ja=R;ja<pa;ja++)for(S=ja*Q,ra=S+ia,va=Ca.subarray(S,ra),S=ra,ra=S+ia,k=Ca.subarray(S,
ra),S=(2*ja+1)*Q,ra=S+Q,m=Y.subarray(S,ra),g=ma.subarray(S,ra),ba=H;ba<ca;ba++)aa=2*ba,m[aa]=va[ba],g[aa]=k[ba];else for(ja=R;ja<pa;ja++)for(S=ja*ia,ra=S+ia,va=u.subarray(S,ra),k=w.subarray(S,ra),S=(2*ja+1)*Q,ra=S+Q,m=Y.subarray(S,ra),g=ma.subarray(S,ra),ba=ua;ba<Ba;ba++)aa=4*ba,m[aa]=va[ba],g[aa]=va[ba+Ea],aa+=2,m[aa]=k[ba],g[aa]=k[ba+Ea]}za.jumpToEnd()})}function h(n,y,t,O){var E,P,Q,ia,W,X,D,ea,fa,Y,ma,ba,ja,aa,Z,S,ra,va,k,m,g,f,u,w,C,B,F,U,M,l,I,H,R,ca,pa,ua,Ba,Ea,Ca,za,Ia,wa,Aa,Na,Ya,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==
Wa.nextAddress)return E=new Uint8Array(n.allocationSize()),Wa.yield(n.copyTo(E),2);P=n.codedWidth;Q=n.codedHeight;ia=(P+1)/2|0;W=(Q+1)/2|0;X=P*Q;D=X+ia*W;ea=E.subarray(X,D);fa=E.subarray(D);Y=2*X;ma=y.subarray(X,Y);ba=y.subarray(Y);k=va=ra=S=Z=aa=ja=0;u=f=g=m=null;w=0;for(C=O.length;w<C;w++){B=O[w];F=B.left;U=B.top;M=B.right;l=B.bottom;I=M-F;H=l-U;R=U*P+F;ca=E.subarray(R,X);pa=y.subarray(R,X);ua=ma.subarray(R);Ba=ba.subarray(R);Ea=F/2|0;Ca=U/2|0;za=M/2|0;Ia=l/2|0;wa=za-Ea;Aa=Ia-Ca;for(aa=0;aa<H;aa++)S=
aa*P,ra=S+I,m=ca.subarray(S,ra),pa.set(m,S);if(t)for(R=Ca*P+F,Na=E.subarray(X+R),aa=0;aa<Aa;aa++){S=aa*P;ra=S+I;m=Na.subarray(S,ra);S=2*aa*P;ra=S+I;f=ua.subarray(S,ra);u=Ba.subarray(S,ra);for(ja=0;ja<wa;ja++)Z=2*ja,va=m[Z],f[Z]=va,f[Z+1]=va,k=m[Z+1],u[Z]=k,u[Z+1]=k,void 0==k&&console.log("undefined v: "+Z,ja,aa,S,ra,I,wa,Aa);S+=P;ua.set(f,S);Ba.set(u,S)}else for(R=Ca*ia+Ea,Ya=ea.subarray(R),Za=fa.subarray(R),aa=0;aa<Aa;aa++){S=aa*ia;ra=S+wa;m=Ya.subarray(S,ra);g=Za.subarray(S,ra);S=2*aa*P;ra=S+I;
f=ua.subarray(S,ra);u=Ba.subarray(S,ra);for(ja=0;ja<wa;ja++)Z=2*ja,va=m[ja],f[Z]=va,f[Z+1]=va,k=g[ja],u[Z]=k,u[Z+1]=k;S+=P;ua.set(f,S);Ba.set(u,S)}}return Wa.return(y)})}function q(n){var y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){switch(t.nextAddress){case 1:if(!e){if(1E3==n.duration)G.onframedecoded(n,v.getRects(n.timestamp));t.jumpTo(2);break}y=null;return 1E3==n.duration?t.yield(v.setMainFrame(n),6):t.yield(v.getCombinedFrame(n),5);case 5:y=t.yieldResult;t.jumpTo(4);break;
case 6:y=t.yieldResult;case 4:G.onframedecoded(y),y.close();case 2:n.close(),t.jumpToEnd()}})}function L(n){var y=n.codec;if(y!=A||(b?x.sampleRate!=n.sampleRate:x.width!=n.width||x.height!=n.height))if(console.log("Codec: "+y+" audio: "+b),A=y,x=n,J||(J=new VideoDecoder({output:function(t){q(t)},error:function(t){console.error("VideoDecoder error:",t);if(G.onerror)G.onerror(t)}})),y={codec:A,codedWidth:n.width,codedHeight:n.height,hardwareAcceleration:c||"no-preference"},console.log(y),J.configure(y),
G.onsps)G.onsps(n)}var A=null,G=this,J,x=null,z={type:"delta",data:null,timestamp:0,duration:0},v=new function(){function n(P){for(;;){var Q=y.shift();if(Q){if(Q.timestamp==P)return Q.rects;if(Q.timestamp>P){console.log("not possible, time: "+P+" option.timestamp: "+Q.timestamp);break}}else break}return null}var y=[],t=null,O=!1,E={timestamp:0,codedWidth:0,codedHeight:9,duration:0,format:"I444"};this.pushRects=function(P){y.push(P)};this.getRects=n;this.setMainFrame=function(P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){if(1==
Q.nextAddress)return t||(t=new Uint8Array(2*P.allocationSize()),O="NV12"==P.format,E.codedWidth=P.codedWidth,E.codedHeight=P.codedHeight,console.log("isNV12: "+O+" supportsI444: "+e)),Q.yield(h(P,t,O,n(P.timestamp)),2);E.duration=P.duration;E.timestamp=P.timestamp;return Q.return(new VideoFrame(t,E))})};this.getCombinedFrame=function(P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){if(1==Q.nextAddress)return Q.yield(d(P,t,O,n(P.timestamp)),2);E.duration=P.duration;E.timestamp=P.timestamp;
return Q.return(new VideoFrame(t,E))})};this.close=function(){t&&(t=null)}};a.onvideoframe=function(n){var y=n.bitstream;var t=0,O=[0,0],E=y.length;var P=!1;var Q=null;for(var ia=!1,W=0,X=0;t<E;){O[0]=t;Nb.searchStartCode(y,O);var D=O[0];if(-1==D){X=O[1];break}D+=O[1];t=D+1;W=y[D]&31;switch(W){case 5:P=!0;break;case 7:(Q=(new Yc(y.subarray(D))).readSPS())||(ia=!0)}}t=E-t;O=null;7>t&&(O=y.subarray(0,E-(t+(X+1))),7==W&&(ia=!1));y=O;ia&&console.log("corrupted: "+n.timestamp,n.bitstream);Q&&L(Q);x&&(v.pushRects({timestamp:n.timestamp,
rects:n.regionRects}),y&&(n.bitstream=y),z.type=P?"key":"delta",z.data=n.bitstream,z.timestamp=n.timestamp,z.duration=n.isChroma?77:1E3,n=new EncodedVideoChunk(z),J.decode(n))};this.play=function(n){};this.reset=function(){console.log("Reset MediaDecoder");x=A=null;v.close();J&&J.reset()&&J.close();J=null};this.close=function(){G.reset();J&&(J.close(),J=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo=
{domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Mb=!1,mb={},kb={},Cb=null,p=this,pc=!1,Xa=!1,db=0,Db=null,Zc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var la=hi5.appcfg,Kb="";this.setConfig=function(a){la=a};var cb="object"==typeof r?r:null,N=cb?{}:hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));void 0==N.mapClipboard&&la.clipboard&&void 0!=la.clipboard.enabled&&(N.mapClipboard=la.clipboard.enabled);
N.hardwareAcceleration||(N.hardwareAcceleration=la.hardwareAcceleration);void 0==N.yuv444&&(N.yuv444=la.yuv444);void 0==la.enableDVCAudio&&(la.enableDVCAudio=!0);var Ka=0,La=0,gb=(oa||N.color||N.server_bpp||16)|0,rc=null,$c=null,Qa=null,fc=null,ad="/DOWNLOAD?",bd="/CLIP?";24==gb&&(gb=16);var Va="app"==N.startProgram,Lb=T(N.mapDisk),ob=0;this.setLinks=function(a){a.download&&(ad=a.download);a.clipboard&&(bd=a.clipboard)};this.protocol=cb?"":r.substring(0,r.indexOf("://")).toLowerCase();this.hasSmartCard=
function(){return T(N.smartCard)||T(N.mapSmartCard)||T(N.passwordIsPin)};this.enableWebAuthn=function(){return T(N.enableWebAuthn)||T(N.useWebAuthn)};this.hasScanner=function(){return T(N.scanner)};this.hasUSB=function(){return T(N.mapUSB)&&!!navigator.usb};this.getUSB=function(){return N.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=
function(a){$c=a};this.getProfiler=function(){return $c};this.gateway=function(){if(cb)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ya;var lb="object"==typeof r||0<r.indexOf("/PLAY?"),uc=!lb&&0<r.indexOf("invitation=");if(uc){var vc=decodeURIComponent(r),Pb=
vc.indexOf(' USERNAME="');if(0<Pb){Pb+=11;var Wd=vc.substring(Pb,vc.indexOf('"',Pb));r+="&novice="+Wd}r+="&mapClipboard=on";N.mapClipboard="on";this.reconnectOnResize=!1}if(lb)this.mode=1,cb?r="":(Ka=640,La=480),r+="&touchpad=on",N.touchpad="on",this.reconnectOnResize=!1;else if(0<r.indexOf("/JOIN?")||uc)this.mode=2,this.reconnectOnResize=!1;var wc=T(N.gfx)||T(N.remotefx)||0<p.mode;wc&&(Va||uc?(wc=!1,N.remotefx=!1):gb=32);K?Ka=parseInt(K):N.width&&(Ka=parseInt(N.width));V?La=parseInt(V):N.height&&
(La=parseInt(N.height));-1==Ka&&(Ka=hi5.browser.getScreenWidth());-1==La&&(La=hi5.browser.getScreenHeight());N.symlink&&N.parameters&&hi5.tool.queryToObj(N.parameters,N);N.gateway||(r+="&gateway="+encodeURIComponent(p.gateway));!N.minWidth&&la.minWidth&&(N.minWidth=la.minWidth);!N.minHeight&&la.minHeight&&(N.minHeight=la.minHeight);N.minWidth&&(N.minWidth=parseInt(N.minWidth));N.minHeight&&(N.minHeight=parseInt(N.minHeight));N.waWidth=N.waWidth?parseInt(N.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?
Math.max(screen.width,screen.height):screen.width;N.waWidth&=-4;N.waHeight=N.waHeight?parseInt(N.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;N.waHeight&=-4;"useSSL"in N||(r+="&useSSL="+("wss"==p.protocol));hi5.storage.isAvailable&&(T(N.shareClipboard)||N.shareClipboardId)&&(r+="&shareClipboardId="+(N.shareClipboardId||da()));la&&(void 0!=la.displayMsg?this.displayMsg=la.displayMsg:la.displayMsg=this.displayMsg,la.appTimeout&&(this.appTimeout=
la.appTimeout),void 0!=la.reconnectOnResize&&(this.reconnectOnResize=la.reconnectOnResize),la.reconnectTimes&&(this.reconnectTimes=la.reconnectTimes),void 0!=la.windowState&&(this.windowState=la.windowState),void 0!=la.openLink&&(this.openLink=la.openLink),void 0!=la.setTitle&&(this.setTitle=la.setTitle),"boolean"==typeof la.useWSS&&(r=(la.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),"boolean"==typeof la.remoteAppLogin&&(this.remoteAppLogin=la.remoteAppLogin,Mb=!la.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),
"boolean"==typeof la.hideLogin&&(Mb=la.hideLogin),void 0!=la.localPrinter&&void 0==N.localPrinter&&(N.localPrinter=la.localPrinter));var Oa=null;void 0==la.useWorker&&(la.useWorker=!1);la.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(la.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ma=la.useWorker?new Worker(ta("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,wb=this.reconnectTimes,
cc=Ma?{type:5,data:null}:null;this.getDisplayName=ha;this.server=ha();this.port=parseInt(N.port,10);this.loadbalanceToken="";la.loadbalanceTokenName&&(N[la.loadbalanceTokenName]?na(N[la.loadbalanceTokenName]):!1!==la.randomAppId?na(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){p.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+p.loadbalanceToken:"&"+p.loadbalanceToken,a+="&loadbalanceTokenName="+la.loadbalanceTokenName);return a};this.getURL=function(){return r};
this.getRuntimeURL=function(){var a=r+"&width="+Ka+"&height="+La+"&server_bpp="+gb+"&audio="+(Ta.available||hi5.browser.isIE),b=Ic(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=N.monitorDef,d=N.monitor,h=0;b=ka.size();var q=Array(b);c=Array(b);var L=0,A=0,G=0,J=0,x=0,z=0,v="";if(e){c=sa.parseMonitorDef(e);for(b=c.length;h<b;h++){var n=c[h];n[0]<G&&(G=n[0]);n[1]<J&&(J=n[1]);n[2]>x&&(x=n[2]);n[3]>z&&(z=n[3])}0>G&&(L=-G);0>J&&(A=-J);n=0>d?[G,J,x,z]:c[d];N.width=n[2]-n[0]+1;N.height=
n[3]-n[1]+1;h=ka.getSurface(0);h.setMonitor(n[0],n[1],n[2],n[3]);if(L||A)for(n=h.getMousePosition(),n.left+=L,n.right+=L,n.top+=A,n.bottom+=A,h=0;h<b;h++)n=c[h],n[0]+=L,n[1]+=A,n[2]+=L,n[3]+=A;sa.setMonitorLayout(c);0>d&&sa.setMonitorCount(0);p.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+N.width+"&height="+N.height}else{if(1<b&&!Va){for(ka.verifyMonitors();h<b;h++)e=ka.getSurface(h),n=e.getMousePosition(),n.left<G&&(G=n.left),n.top<J&&(J=n.top),n.right>x&&(x=n.right),n.bottom>z&&(z=n.bottom),
q[h]=n,v&&(v+=","),v+=n.left+":"+n.top+":"+n.right+":"+n.bottom;0>G&&(L=-G);0>J&&(A=-J);for(h=0;h<b;h++){n=ka.getSurface(h).getMousePosition();if(L||A)n.left+=L,n.right+=L,n.top+=A,n.bottom+=A;c[h]=[n.left,n.top,n.right,n.bottom,n.left==L&&n.top==A?1:0]}sa.setMonitorLayout(c);p.reconnectOnResize=!1}v&&(svGlobal.logger.warn("MonitorDef:"+v),N.width=x-G+1,N.height=z-J+1,v="&monitorDef="+v+"&width="+N.width+"&height="+N.height);b=v}a+=b;0>r.indexOf("waWidth")&&(b=(b=ka.getFocused())?b.getWindow():window,
a+="&waWidth="+N.waWidth+"&waHeight="+N.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;N.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());N.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==N.soundPref&&(N.soundPref=0,a+="&soundPref=0");L=c=b="";for(L in mb)A=mb[L],"flags"in A&&(b&&(b+=",",c+=","),b+=A.name,c+=A.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(L in kb)A=kb[L],"flags"in
A&&(b&&(b+=","),b+=A.name);b&&(a+="&gwChannelName="+b);if(c=Bd())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);N.audioRecord=T(N.audioRecord)&&hi5.audio.recordable;Ha.init(b,wc,N.audioRecord,N.soundPref,T(N.mapCamera)&&!!navigator.mediaDevices,T(N.mapUSB)&&!!navigator.usb);N.audioRecord&&(a+="&audioRecord=on");N.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ha.count&&(a+="&dvcChannels="+Ha.names.join(","));
a+="&binary=on";la.existingFile&&(a+="&existingFile="+la.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ya());a=p.modifyURL(a);la.copyTextOnly&&T(N.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);T(N.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Kd()};this.getColor=function(){return gb};this.changeTitle=
qa;hi5.browser.isTouch&&Math.max(Ka,La)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Fa=null,Ja=!1,rb=!1,sc=!1,Ta=new function(){function a(A){c&&(d&&d.disconnect(),h&&h.disconnect());hi5.audio.releaseAudioContext();A||(L&&(L.close(),L=null),q&&(q.pause(),q=null))}function b(A){console.error("play error: ",A)}var c=null;this.supportWebAudio=this.available=!1;(0==N.playSound||0<p.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&
(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(A){return c.createBuffer(2,A,Ga.samplePerSec)};var e=0,d=null,h=null;this.setVolume=function(A){1==A?d=null:(d||(d=c.createGain()),d.gain.value=A)};this.playBuffer=function(A){h=c.createBufferSource();h.buffer=A;d?(h.connect(d),d.connect(c.destination)):h.connect(c.destination);var G=c.currentTime,J=0<e?e:G;J<G&&(J=G);e=J+A.duration;h.start?h.start(J):h.noteOn(J);return e-G};this.iOSFix=function(){if(c){var A=
this.getBuffer(1024),G=c.createBufferSource();G.buffer=A;G.connect(c.destination);G.start?G.start(0):G.noteOn(0)}};this.close=a;var q=null,L=null;this.onaudioframe=null;this.initMediaPlayer=function(A,G,J){a(!0);q||(q=document.createElement("audio"));L||(L=new Ob(q,A,!0),L.onplayerror=b,L.onerror=function(x){console.error("Not possible audio error",x)},svGlobal.logger.info("MediaPlayer init, headerless: "+J+" sampleRate:"+G.sampleRate));L.setMediaFormat(G,J);L.play(!1)}},Rd=Ta.available,ab=null,sa=
new Cc(200,200);sa.onSetCursor=Nc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var $b=0,Zb=0,ac=Ka-1,bc=La-1,qc="";window.$rdp||(window.$rdp=this);Da(gb);this.setResolution=Pa;this.running=function(){return Ja};this.setJoinMode=function(a){Ja&&xa("8E1"+a)};this.setJoinCloseMode=function(a){Ja&&xa("8EB3\t"+a)};this.refuseControl=function(a){Ja&&xa("8E3"+a)};this.giveControl=function(a){Ja&&xa("8E4"+a)};this.pauseSession=function(a,b){Ja&&xa("8EB"+(b?1:0)+"\t"+a)};
this.closeSession=function(a){Ja&&xa("8EB2\t"+a)};this.requestControl=function(){Ja&&xa("8E2")};this.saveSession=function(a){Ja&&xa("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ja&&xa("8EA"+a+"\t"+(b?1:0))};var Eb=new function(){function a(){if(c&&0<c.length){var h=c.shift();h.key?Eb.sendSingleKey(h.down,h.key):h.char&&ub(h.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,
up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(h,q){var L=b[q.toLowerCase()];L?p.writeScancode(h,L):(L=q.length,0!=L&&(1==L?p.writeKeyCode(h,q.toUpperCase().charCodeAt(0)):h&&p.writeText(q)))};
var c=null,e=0,d=null;this.sendKeyComb=function(h,q,L){if(Xa){h=h.split("+");var A=h.length,G;if(0!=A){var J=null,x=[];for(G=0;G<A;G++){var z=h[G];""==z&&""==J&&(z="Add");""!=z&&x.push({key:z,down:!0});J=z}A=x.length;for(G=A-1;0<=G;G--)x.push({key:x[G].key,down:!1});if(q)c=x,e=q,d=L,a();else for(G=0,A=x.length;G<A;G++)Eb.sendSingleKey(x[G].down,x[G].key)}}};this.sendText=function(h,q,L){for(var A=[],G=0,J=h.length;G<J;G++)A.push({"char":h.charAt(G)});c=A;e=q;d=L;a()}};this.writeKeyComb=function(a,
b,c){Xa&&Eb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Xa)if(b)Eb.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)ub(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),p.writeRawInput("880"+b+"\t"+a.hashCode()),Db={type:b,text:a})};var ka=new function(a,b){function c(){function d(x){for(;0<x.ownerWinid;){var z=G.getWinById(x.ownerWinid);if(z&&z.isVisible())x=z;else break}return x}function h(x){for(var z="";x;)x.titleInfo&&(z=x.titleInfo),x=G.getWinById(x.ownerWinid);
return z}var q=[],L=[],A=0,G=this;this.mainWin=null;this.appId="";var J=0;this.getActiveWinId=function(){return J};this.setActiveWinId=function(x,z){svGlobal.logger.info("setActiveWinId: "+x+" old: "+J+" max: "+z);if(J!=x){var v=0==J;J=x;(x=G.getMainByWinId(x))&&x.isMainWin()&&G.mainWin!=x&&(G.mainWin=x);v&&z&&(z=ka.getFocused())&&(z=z.getFreeSpace(),x=z.width,p.resetSize(x,z.height))}};this.onchange=function(x){x.isVisible()||x!=G.mainWin?x.isVisible()&&!G.mainWin&&x.isMainWin()&&(G.mainWin=x,3==
a.windowState&&x.exeCommand(61488)):G.mainWin=null};this.addWin=function(x){for(var z=q.length,v=!1,n=0;n<z;n++)if(x.id==q[n].id){q[n]=x;v=!0;break}v||q.push(x);1==q.length&&(A=Date.now());z=x.isMainWin();svGlobal.logger.info("is mainwin:"+z+" id:"+x.id);z&&!G.mainWin&&(G.mainWin=x)};this.popWins=function(x){x=G.getWinById(x);var z=[];if(x){x=0<x.ownerWinid?x.ownerWinid:x.id;for(var v=q.length-1;0<=v;v--)if(q[v].ownerWinid==x||q[v].id==x)z.push(q[v]),q.splice(v,1)}return z};this.hasApp=function(x){return-1!=
L.indexOf(x)};this.addApp=function(x){return-1==L.indexOf(x)?(L.push(x),!0):!1};this.isNew=function(){return 3E4>Date.now()-A};this.getAll=function(){return q};this.hasWin=function(x){return 0<=q.indexOf(x)};this.close=function(){for(var x=0,z=q.length;x<z;x++)q[x].close()};this.clear=function(){q.length=0};this.delWin=function(x){for(var z=0,v=q.length;z<v;z++)if(q[z].id==x)return q.splice(z,1),z;return-1};this.isRunning=function(){var x=q.length;if(1>x)return!1;var z=0;for(x=q.length;z<x;z++){var v=
q[z];if(v.showState)return!0}return!1};this.getWinById=function(x){var z=q.length;if(1>z)return null;for(var v=0;v<z;v++){var n=q[v];if(n.id==x)return n}return null};this.getMainWinByAppId=function(x){var z=null,v=0;for(len=q.length;v<len;){z=q[v];if(z.appId==x&&z.isVisible()&&1>z.ownerWinid)break;v++}return z};this.getTopWin=function(x){var z=null,v,n=x.length;for(v=0;v<n&&(!(z=G.getWinById(x[v]))||!z.isVisible());v++)z=null;if(!z)for(svGlobal.logger.warn("No win found"),n=q.length,v=n-1;0<=v&&(z=
q[v],!z.isVisible());v--)z=null;return z};this.getMain=function(x){return(x=G.getTopWin(x))?d(x):null};this.getMainByWinId=function(x){return(x=G.getWinById(x))?d(x):null};this.getOtherApps=function(x,z,v){var n=q.length;if(0!=n&&q[n-1])if(n=q[n-1].appId,v||!n)setTimeout(function(){G.getOtherApps(x,z)},v||3E3);else{v=[];if(n=G.getTopWin(x)){var y=0<n.ownerWinid?n.ownerWinid:n.id,t=[],O=0;for(n=q.length;O<n;O++)q[O].ownerWinid!=y&&q[O].id!=y&&q[O].isVisible()&&t.push(q[O]);O=0;for(n=t.length;O<n;O++)t[O].ownerWinid!=
y&&t[O].id!=y&&(v.push({title:h(t[O]),win:d(t[O])}),y=0<t[O].ownerWinid?t[O].ownerWinid:t[O].id)}z(v)}};this.getFullTitle=function(x){for(var z,v="";;){z=G.getWinById(x);if(!z)break;z.titleInfo&&z.isVisible()&&(v&&(v=" > "+v),v=z.titleInfo+v);if(1>x)break;x=z.ownerWinid}return v}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,h=0;h<d;h++)e[h].railWin&&e[h].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,h=Array(d),q=0;q<d;q++)e[q].configMonitor(),
h[q]=e[q].getMousePosition();h.sort(function(G,J){var x=G.left-J.left;return 0!=x?x:G.top-J.top});var L=h.findIndex(function(G){return 0==G.left&&0==G.top});svGlobal.logger.info("monitor layout",h,L);-1==L&&(p.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",h));for(q=L-1;0<=q;){if(h[q].right<h[q+1].left){var A=h[q+1].left-h[q].right-1;0<A&&(h[q].right+=A,h[q].left+=A)}h[q].bottom<h[q+1].top&&(A=
h[q+1].top-h[q].bottom-1,0<A&&(h[q].top+=A,h[q].bottom+=A));q--}for(q=L+1;q<d;)h[q-1].right<h[q].left&&(A=h[q].left-h[q-1].right-1,0<A&&(h[q].right-=A,h[q].left-=A)),h[q-1].bottom<h[q].top&&(A=h[q].top-h[q-1].bottom-1,0<A&&(h[q].top-=A,h[q].bottom-=A)),q++};this.repaint=function(d,h,q,L){for(var A=0,G=e.length;A<G;A++)e[A].repaint(d,h,q,L)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var h=e.length,
q=0;q<h;q++)if(e[q].equals(d))return!0;return!1};this.getMonitorSurface=function(d,h,q,L){var A=e.length;if(1==A)return e[0];for(var G=0;G<A;G++)if(e[G].isMonitor(d,h,q,L))return e[G];return null};this.fromSyncedSurface=function(d){var h=e.length;Date.now();for(var q=0;q<h;q++)if(e[q].isClipSynced(d))return!0;return!1};this.setSize=function(d,h,q){for(var L=0,A=e.length;L<A;L++)e[L].setSize(d,h,q)};this.zOrders=[];this.drawLicense=function(d){for(var h=0,q=e.length;h<q;h++)e[h].drawLicense(d)};this.setReadOnly=
function(d,h){for(var q=0,L=e.length;q<L;q++)e[q].setReadOnly(d,h)};this.setVisible=function(d,h){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var h=0,q=e.length;h<q;h++)e[h]&&e[h].setCursor(d)};this.hide=function(d){d=0;for(var h=e.length;d<h;d++)e[d]&&e[d].hide()};this.execute=function(d,h){for(var q=0,L=e.length;q<L;q++)e[q][d].apply(e[q],h)};this.addWin=function(d){var h=this.getFocused();h||(svGlobal.logger.warn("Focused surface not found!"),h=e[e.length-1]);h?(Va=
!0,h.railWin||(h.railWin=new c,h.onunload=function(){hi5.appcfg.closeRemoteApp&&h.railWin&&h.railWin.close();h.remoteApp&&h.remoteApp.close();h.railWin&&(h.railWin.clear(),h.railWin=null);e.removeElm(h)}),h.context&&b.setContext(h.context),h.railWin.addWin(d),h.railWin.mainWin==d&&(setTimeout(function(){var q=h.getFreeSpace();a.writeRawInput("8C661441\t"+q.width+"\t"+q.height);svGlobal.logger.info("-- main win dp change:"+q.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);
svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&h.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var h,q=e.length-1;0<=q;q--){var L=e[q];h=L.railWin;var A=h.getWinById(d),G=A&&A.appId&&-1!=A.appId.toLowerCase().indexOf("runonce");if(0<=h.delWin(d)){A==h.mainWin&&(h.mainWin=null);if(L.toolbar){d=
"win"+d;var J=L.toolbar.querySelector("#"+d);J&&L.toolbar.removeChild(J)}if(!h.isRunning()&&0==p.mode){if(A.isMainWin()&&L.onremoteappclose)L.onremoteappclose(A);A=a.appTimeout;if(G||h.isNew())A*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(x){return function(){svGlobal.logger.info("Start del:"+Date.now());x.railWin&&x.railWin.isRunning()||(x.remoteApp&&x.remoteApp.close(),ka&&ka.delSurface(x))}}(L),A)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):
[]};this.getWinById=function(d){for(var h,q=0,L=e.length;q<L;q++)if(e[q]&&e[q].railWin&&(h=e[q].railWin.getWinById(d)))return h;return null};this.getMainWinByAppId=function(d){for(var h,q=0,L=e.length;q<L;q++)if(e[q].railWin&&(h=e[q].railWin.getMainWinByAppId(d)))return h;return null};this.onWinChange=function(d){for(var h,q=0,L=e.length;q<L;q++)if(e[q].railWin&&(h=e[q].railWin.getWinById(d.id)))e[q].railWin.onchange(d)};this.setTitle=function(d){for(var h,q=0,L=e.length;q<L;q++)if(e[q].railWin){h=
e[q].railWin.getWinById(d);var A=e[q].railWin.getFullTitle(d);if(A){a.changeTitle(A,e[q].getWindow(),h.appId);break}}};this.hasApp=function(d){for(var h=0,q=e.length;h<q;h++)if(e[h].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var h=0,q=e.length;h<q;h++)if(e[h].railWin&&e[h].railWin.hasWin(d))return e[h];return null};
this.getOwnerSurfaceById=function(d){for(var h,q=0,L=e.length;q<L;q++)if(e[q].railWin&&(h=e[q].railWin.getWinById(d)))return e[q];return null};this.getFocused=function(){for(var d=e.length,h=0;h<d;h++)if(e[h].focused)return e[h];return e[d-1]};this.close=function(){for(var d=0,h=e.length;d<h;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function h(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var q=this;this.resizable=function(){return q.isVisible?
0!=(q.style&262144)||0!=(q.style&65536)||0!=(q.style&16777216)||3==q.showState:!1};this.setShowState=function(L){q.showState=L};this.parent=function(){return ka.getWinById(q.ownerWinid)};this.resize=function(L,A,G,J){svGlobal.logger.info("www resize, l "+L+" w "+G);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+q.id+"\t"+L+"\t"+A+"\t"+G+"\t"+J)};this.exeCommand=function(L){svGlobal.logger.info("www exeCommand, cmd "+L);a.writeRawInput("8C4"+d+"\t"+L)};this.activate=function(L){svGlobal.logger.info("www activate, enable "+
L+" id:"+d);2==q.showState?(q.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+L)},50)):a.writeRawInput("8C3"+d+"\t"+L)};this.close=function(){svGlobal.logger.info("www close");q.exeCommand(61536)};this.getAppId=h;this.isVisible=function(){return q.winWidth&&q.winHeight&&q.showState&&45<q.winHeight&&45<q.winWidth};this.isMainWin=function(){if(!(q.isVisible()&&q.winWidth&&q.winHeight&&45<q.winHeight&&45<q.winWidth))return!1;var L=1>q.ownerWinid;if(!L)return L;var A=q.style;if(0!=
(A&4194304))return!0;if(0!=(A&2147483648)&&(0==(A&8388608)||0==(A&12582912)))return!1;var G=0!=(q.extStyle&128);(L=L&&!G)&&0!=(A&2147483648)&&0==(A&2156396544)&&(L=!1);return L};h()}}(p,sa);this.getSurfaces=function(){return ka};this.hide=function(){ka&&ka.hide()};this.getFileUrl=function(a,b,c){var e=ya(),d=ad,h=d.indexOf("://");e=(0<h&&11>h?d:e+d)+"s="+qc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return p.modifyURL(e)};this.listFiles=function(a,b){Oa&&Xa&&Oa.list(a,b)};
this.writeRawInput=function(a){if(Xa){xa(a);if(p.onactivity)p.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);xa(e.buffer)};var cd=0;if(la.numLock||la.numlock||T(N.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)cd|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;
this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;
this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var h=d.getFreeSpace(),q=h.width;h=h.height;Ra.checkLockFlags=!0;la.scale?d.scaleTo(q,h,!1):a.resetSize(q,h)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,h){this.reqCopyTime=Date.now();var q=a.getGatewayAddr(),L=bd,A=L.indexOf("://");q=(0<A&&11>A?L:q+
L)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(q),h);this.reqCopyTime=Date.now();Vc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,h,q){a.reconnectOnResize=!1;var L=a.getFileUrl(d,h,q);p.ondownload&&p.ondownload({fileName:d,url:L,source:h,action:q})||window.open(L)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return r};this.reconnect=function(d,h,q){N.symlink?(d="user="+d+"&pwd="+h,q&&(d+="&domain="+q),r=hi5.tool.replaceQuery(r,
"parameters",d)):(r=hi5.tool.replaceQuery(r,"user",d),r=hi5.tool.replaceQuery(r,"pwd",h),r=hi5.tool.replaceQuery(r,"domain",q));a.run()};this.sendKeyboardSyncFlags=function(d,h){return Xa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},h||333),!0):!1};this.sendKeyboardSynchronize=function(d,h,q){var L=0;q&&(L|=4);h&&(L|=2);d&&(L|=1);this.sendKeyboardSyncFlags(L)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",
20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,h){a.authWithCode(d,h)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(p,cd),Xd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,h){return a.repaint(c,e,d-c+1,h-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&
e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+c.id))}}(sa,ka);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new qb(143)};this.GatewayChannel=function(){return new qb(28)};this.DynamicChannel=function(){return new qb(64)};this.addChannel=function(a){mb[a.name]=a};this.addGatewayChannel=function(a){kb[a.name]=a};this.addDynamicChannel=function(a){Ha.names.push(a.name);Ha[a.name]=a;Ha.count++};
var Sa=null,Ha={count:0,names:[],usbChannel:null,close:function(){for(var a=Ha.names,b=0,c=a.length;b<c;b++)Ha[a[b]].onclose&&(Ha[a[b]].onclose(),Ha[a[b]]=null);a.length=0;Ha.usbChannel=null},init:function(a,b,c,e,d,h){function q(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=
this.formatTag=0;this.extenstion=null;var v=this;this.fromBuffer=function(n,y){v.formatTag=n.getLittleEndian16();v.nChannels=n.getLittleEndian16();v.nSamplesPerSec=n.getLittleEndian32();v.nAvgBytesPerSec=n.getLittleEndian32();v.nBlockAlign=n.getLittleEndian16();v.bitsPerSample=n.getLittleEndian16();var t=n.getLittleEndian16();v.cbSize=t;0<t&&!0!==y&&(v.extenstion=Array(t),n.copyToByteArray(v.extenstion,0,n.getPosition(),t),n.skipPosition(t))};this.toBuffer=function(n){n.setLittleEndian16(v.formatTag);
n.setLittleEndian16(v.nChannels);n.setLittleEndian32(v.nSamplesPerSec);n.setLittleEndian32(v.nAvgBytesPerSec);n.setLittleEndian16(v.nBlockAlign);n.setLittleEndian16(v.bitsPerSample);n.setLittleEndian16(v.cbSize);0<v.cbSize&&n.setBytes(v.extenstion)};this.getSize=function(){return 18+v.cbSize};this.toString=function(){return"Audio Format, tag="+v.formatTag+" nChannels="+v.nChannels+" nSamplesPerSec="+v.nSamplesPerSec+" nAvgBytesPerSec="+v.nAvgBytesPerSec+" nBlockAlign="+v.nBlockAlign+" bitsPerSample="+
v.bitsPerSample+" cbSize="+v.cbSize}}function L(){Sa=new p.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(v){var n=v.getLittleEndian32();v.getLittleEndian32();switch(n){case 5:n=v.getLittleEndian32(),Sa.maxMonitorAreaFactorA=v.getLittleEndian32(),Sa.maxMonitorAreaFactorB=v.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+n+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),v=new Uint8Array(2),
v[0]=146,v[1]=4,xa(v.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(v,n){if(Sa.enabled){var y=new Uint8Array(56),t=new RdpBuffer(y,0,56);v=v>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:v&-4;n=n>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:n&-4;t.setLittleEndian32(2);t.setLittleEndian32(56);t.setLittleEndian32(40);t.setLittleEndian32(1);t.setLittleEndian32(1);t.setLittleEndian32(0);t.setLittleEndian32(0);t.setLittleEndian32(v);t.setLittleEndian32(n);
t.setLittleEndian32(.26458*v|0);t.setLittleEndian32(.26458*n|0);t.setLittleEndian32(v>n?0:90);t.setLittleEndian32(100);t.setLittleEndian32(100);Sa.send(y);svGlobal.logger.warn("Display control: "+v+"x"+n)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!la.disableDVC){if(la.enableEcho){var A=new p.DynamicChannel;A.name="ECHO";A.process=function(v){var n=v.getPosition(),y=v.getEnd(),t=new Uint8Array(y-n);t.set(v.getData().subarray(n,y));A.send(t)};p.addDynamicChannel(A)}if(a){var G=
new p.DynamicChannel;G.name="Microsoft::Windows::RDS::Input";G.process=function(v){var n=v.getLittleEndian16();v.getLittleEndian32();switch(n){case 1:v.skipPosition(4),v=new RdpBuffer(new Uint8Array(16),0,16),v.setLittleEndian16(2),v.setLittleEndian32(16),v.setLittleEndian32(3),v.setLittleEndian32(65536),v.setLittleEndian16(256),v.markEnd(),G.send(v);case 5:ka.execute("setTouchRemoting",[!0]);Ha.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ka.execute("setTouchRemoting",
[!1]),Ha.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};p.addDynamicChannel(G)}if(c){svGlobal.logger.warn("Audio input on");var J=new p.DynamicChannel;(function(){function v(X){var D=new RdpBuffer(new Uint8Array(5),0,5);D.setByte(7);D.setLittleEndian32(X);D.markEnd();J.send(D)}function n(X){var D=X.getLittleEndian32(),ea=X.getLittleEndian32(),fa=new q;fa.fromBuffer(X,!0);var Y=0,ma=0;0<fa.cbSize&&(22==fa.cbSize?(Y=X.getLittleEndian16(),ma=X.getLittleEndian32(),X.skipPosition(16)):
(svGlobal.logger.warn("Wrong cbsize: "+fa.cbSize),X.skipPosition(fa.cbSize)));X=t[ea];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+D+" initial: "+ea+", "+X.toString());svGlobal.logger.info("Open fmt: "+fa.toString()+" validBits:"+Y+" mask:"+ma);E=!0;P=p.reconnectOnResize;p.reconnectOnResize=!1;W.onopen||(W.onopen=function(ba){if(Ja){y=ba;p.reconnectOnResize=P;v(ea);var ja=new RdpBuffer(new Uint8Array(5),0,5);ja.setByte(4);ja.setLittleEndian32(ba?0:1);ja.markEnd();J.send(ja)}});W.ondata||
(W.ondata=function(ba,ja){y&&(Q.length!=ja+1&&(Q=new Uint8Array(ja+1),Q[0]=6),J.send(O),Q.set(ba,1),J.send(Q))});W.start(X,D)}J.name="AUDIO_INPUT";J.process=function(X){var D=X.getByte();switch(D){case 1:X=X.getLittleEndian32();D=new RdpBuffer(new Uint8Array(5),0,5);D.setByte(1);D.setLittleEndian32(X);D.markEnd();J.send(D);break;case 2:var ea=X.getLittleEndian32();X.getLittleEndian32();var fa=hi5.audio.getAudioContext().sampleRate;for(D=t.length=0;D<ea;D++){var Y=new q;Y.fromBuffer(X);svGlobal.logger.info("Server rec fmt "+
D+":"+Y.toString());0==e&&49==Y.formatTag&&22050==Y.nSamplesPerSec?t.push(Y):1==Y.formatTag&&Y.nSamplesPerSec<=fa&&t.push(Y)}J.send(O);ea=0;X=t.length;for(D=0;D<X;D++)ea+=t[D].getSize();fa=new RdpBuffer(new Uint8Array(1024),0,1024);fa.setByte(2);fa.setLittleEndian32(X);fa.setLittleEndian32(ea+9);for(D=0;D<X;D++)t[D].toBuffer(fa),svGlobal.logger.info("Client rec fmt: "+t[D].toString());fa.skipPosition(1024-ea-9);fa.markEnd();J.send(fa);break;case 3:n(X);break;case 7:D=X.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+
t[D].toString()+" by client:"+E);E||(v(D),E=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+D)}};var y=!1,t=[];J.onclose=function(){y=!1;W&&W.close()};var O=new Uint8Array(1);O[0]=5;var E=!1,P=p.reconnectOnResize,Q=new Uint8Array(0),ia=ta("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),W=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),ia):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();p.addDynamicChannel(J)}p.addDynamicChannel(function(){var v=
new p.DynamicChannel;v.name="TSMF";var n={type:"image/jpeg"},y=Array(1);v.process=function(t){t.getPosition();var O=t.getLittleEndian32()&1073741823;var E=t.getLittleEndian32();var P=t.getLittleEndian32();switch(O){case 2:if(256==P){t.getLittleEndian32();P=new Uint8Array(16);var Q=new RdpBuffer(P,0,16);Q.setLittleEndian32(2);Q.setLittleEndian32(E);Q.setLittleEndian32(1);Q.setLittleEndian32(0);v.send(P)}break;case 0:switch(P){case 257:t.getBytes(16);t.getLittleEndian32();break;case 256:O=t.getPosition();
Q=t.getLittleEndian32();for(P=0;P<Q;P++){t.getLittleEndian32();var ia=t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(ia-4)}P=t.getPosition()-O;Q=P+8+4;P=new Uint8Array(Q);Q=new RdpBuffer(P,0,Q);Q.setLittleEndian32(-2147483648);Q.setLittleEndian32(E);P.set(t.getData().subarray(O,t.getPosition()),8);v.send(P);break;case 261:t.getBytes(16);t.getLittleEndian32();break;case 264:O=t.getLittleEndian32();t.skipPosition(4);t.getLittleEndian32();ia=t.getBytes(16);var W=t.getBytes(16);t.getLittleEndian32();
t.getLittleEndian32();t.getLittleEndian32();var X=t.getBytes(16);P=t.getLittleEndian32();t.skipPosition(P);P=new Uint8Array(20);Q=new RdpBuffer(P,0,20);Q.setLittleEndian32(-2147483648);Q.setLittleEndian32(E);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],ia)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],W)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],X)?Q.setLittleEndian32(1):(Q.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),
svGlobal.logger.warn(ia),svGlobal.logger.warn(W),svGlobal.logger.warn(X));Q.setLittleEndian32(O);v.send(P);break;case 258:t.getBytes(16);t.getLittleEndian32();O=t.getLittleEndian32();t.skipPosition(O);break;case 263:t.getBytes(16),P=new Uint8Array(16),Q=new RdpBuffer(P,0,16),Q.setLittleEndian32(-2147483648),Q.setLittleEndian32(E),Q.setLittleEndian32(1),v.send(P);case 277:t.getBytes(16);t.getLittleEndian32();break;case 262:t.getBytes(16);sa.flushImgs();sa.setImgRect(0,0,0,0);P=new Uint8Array(12);Q=
new RdpBuffer(P,0,12);Q.setLittleEndian32(-2147483648);Q.setLittleEndian32(E);v.send(P);break;case 278:t.getBytes(16);E=t.getLittleEndian32();P=t.getLittleEndian32();O=t.getLittleEndian32();t=t.getLittleEndian32();sa.setImgRect(E,P,O-E,t-P);break;case 265:t.getBytes(16);t.getLittleEndian64();t.getLittleEndian32();break;case 266:t.getBytes(16);break;case 268:t.getBytes(16);break;case 267:t.getBytes(16);break;case 269:t.getBytes(16);t.getLittleEndian32();break;case 274:break;case 275:break;case 259:t.getBytes(16);
t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(32);P=t.getLittleEndian32();E=new Image;O=t.getPosition();y[0]=t.getData().subarray(O,O+P);t=new Blob(y,n);E.src=URL.createObjectURL(t);sa.addImg(E);break;case 270:sa.flushImgs();break;case 273:break;case 260:break;case 276:t.getBytes(16);P=t.getLittleEndian32();O=t.getPosition()+P;t.skipPosition(8);E=t.getLittleEndian32();svGlobal.logger.info("window state:"+E);Q=t.getLittleEndian32();ia=t.getLittleEndian32();E=t.getLittleEndian32();P=t.getLittleEndian32();
t.skipPosition(8);W=t.getLittleEndian32();X=t.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+E+" top:"+P+" w:"+Q+" h:"+ia+" cl:"+W+" ct:"+X);t.setPosition(O);O=t.getLittleEndian32();for(O=t.getPosition()+O;t.getPosition()<O;){W=t.getLittleEndian32();X=t.getLittleEndian32();var D=t.getLittleEndian32(),ea=t.getLittleEndian32();svGlobal.logger.info("visible region, l:"+X+" t:"+W+" r:"+ea+" b:"+D)}sa.setImgRect(E,P,Q,ia);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+
P)}break;default:svGlobal.logger.warn("unkown interface:"+O)}};return v}());lb||p.addDynamicChannel(L());la.enableDVCAudio&&p.addDynamicChannel(function(v){var n=!1,y=0,t=0,O=0,E=0,P=[],Q=new Uint8Array(4),ia=new p.DynamicChannel;ia.name="AUDIO_PLAYBACK_DVC";ia.onclose=function(){};ia.process=function(W){function X(aa){aa.skipPosition(14);var Z=aa.getLittleEndian16();aa.getByte();var S=aa.getLittleEndian16();aa.skipPosition(1);for(var ra,va=P.length=0;va<Z;va++){var k=new q;k.fromBuffer(aa);(ra=22050<=
k.nSamplesPerSec&&(1==k.formatTag||49==k.formatTag&&22050==k.nSamplesPerSec&&0==v||41222==k.formatTag))&&P.push(k)}k=20;aa=P.length;for(va=0;va<aa;va++)k+=P[va].getSize();va=k+4;Z=new RdpBuffer(new Uint8Array(va),0,va);Z.setByte(7);Z.setByte(2);Z.setLittleEndian16(k);Z.setLittleEndian32(3);Z.setLittleEndian32(4294967295);Z.setLittleEndian32(0);Z.setLittleEndian16(0);Z.setLittleEndian16(aa);Z.skipPosition(1);Z.setLittleEndian16(S);Z.setByte(124);for(va=0;va<aa;va++)k=P[va],k.toBuffer(Z);Z.markEnd();
ia.send(Z);5<S&&(Z=new RdpBuffer(new Uint8Array(8),0,8),Z.setByte(12),Z.skipPosition(1),Z.setLittleEndian16(4),Z.setLittleEndian16(0),Z.setLittleEndian16(0),Z.markEnd(),ia.send(Z))}function D(aa){var Z=aa.getLittleEndian16();aa=aa.getLittleEndian16();var S=new RdpBuffer(new Uint8Array(8),0,8);S.setByte(6);S.setByte(35);S.setLittleEndian16(4);S.setLittleEndian16(Z);S.setLittleEndian16(aa);S.markEnd();ia.send(S)}function ea(){var aa=P[O];if(aa.formatTag!=Ga.tag||aa.nSamplesPerSec!=Ga.samplePerSec||
Ga.channels!=aa.nChannels)Ga.tag=aa.formatTag,Ga.channels=aa.nChannels,Ga.samplePerSec=aa.nSamplesPerSec,Ga.bitsPerSample=49==aa.formatTag?8:aa.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ga.tag+" channels="+Ga.channels+" bitsPerSample="+Ga.bitsPerSample+" samplePerSec="+Ga.samplePerSec),41222==Ga.tag&&(Ga.sampleRate=Ga.samplePerSec,Ta.initMediaPlayer(Ta,Ga,!0))}function fa(aa){t=aa.getLittleEndian16();O=aa.getLittleEndian16();E=aa.getByte();aa.skipPosition(3);Q.set(aa.getSubarray(4));
n=!0;ea()}function Y(aa,Z){var S=new RdpBuffer(new Uint8Array(8),0,8);S.setByte(5);S.skipPosition(1);S.setLittleEndian16(4);S.setLittleEndian16(aa);S.setByte(Z);S.skipPosition(1);S.markEnd();ia.send(S)}function ma(aa){n=!1;var Z=y-8,S=Date.now();aa.copyFromByteArray(Q,0,aa.getPosition(),4);oc(aa,E,t,Z);aa=t+(Date.now()-S);Y(aa,E)}function ba(aa){var Z=Date.now();t=aa.getLittleEndian16();O=aa.getLittleEndian16();E=aa.getByte();aa.skipPosition(7);ea();aa=oc(aa,E,t,0);aa*=1E3;Z=t+(Date.now()-Z)+aa;Y(Z,
E)}if(n)ma(W);else{var ja=W.getByte();W.skipPosition(1);y=W.getLittleEndian16();switch(ja){case 7:X(W);break;case 6:D(W);break;case 2:fa(W);break;case 3:W.getLittleEndian16();W.getLittleEndian16();break;case 13:ba(W)}}};return ia}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var x=svGlobal.DCVC_EXTENSION;x.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(v,n){svGlobal.logger.info("activate webcam");x.videoMedia.resolutions?
v():hi5.webcam.resolutions(function(y){svGlobal.logger.info("cam resolutions:",y);y.length?(x.videoMedia.resolutions=y,v()):n()})},deactivate:function(){var v=x.videoMedia;v.track&&(v.track.stop(),v.track=null);v.ctx=null;v.canvas=null;v.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(v,n,y,t,O){svGlobal.logger.info("startStream, width:"+v+" height:"+n+" frameRate:"+y);var E=x.videoMedia,P=E.track;if(P){var Q=P.getSettings();if("live"==P.readyState)if(v!=Q.width||n!=Q.height||
y!=Q.frameRate&&2!=E.type)P.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==E.type?E.minFrameRate:y,width:{exact:v},height:{exact:n}}}).then(function(ia){var W=document.createElement("video");W.srcObject=ia;W.play();if(window.OffscreenCanvas)var X=new OffscreenCanvas(100,100);else X=document.createElement("canvas"),X.style.position="absolute",X.style.left=0,X.style.top=0;E.track=ia.getVideoTracks()[0];E.canvas=X;E.ctx=X.getContext("2d");E.video=W;ia=E.track.getSettings();
E.canvas.width=ia.width;E.canvas.height=ia.height;t()}).catch(function(ia){svGlobal.logger.warn(ia);O()})},stopStream:function(){svGlobal.logger.info("stopStream");var v=x.videoMedia;v.track&&"live"==v.track.readyState&&v.track.stop()},grabFrame:function(v){function n(t){t.arrayBuffer().then(v)}var y=x.videoMedia;y.ctx.drawImage(y.video,0,0);y=y.canvas;y.convertToBlob?y.convertToBlob({type:"image/jpeg",quality:.6}).then(n):y.toBlob(n,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,
max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,
capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};x.WEBAUTHN=function(v){function n(){if(O){var E=Error("Cancelling existing WebAuthn API call for new one");E.name="WebAuthnAbortError";O.abort(E)}O=new AbortController;return O.signal}function y(){if(O){var E=Error("Manually cancelling existing WebAuthn API call");E.name="WebAuthnAbortError";O.abort(E);O=void 0}}var t=new v;t.name="WebAuthN_Channel";t.newInstance=function(){return x.WEBAUTHN(v)};
t.onopen=function(){svGlobal.logger.info("webAuthn open")};t.onclose=function(){svGlobal.logger.info("webAuthn close")};var O=null;t.process=function(E){var P=E.getEnd()-E.getPosition();E=E.getBytes(P);var Q=Jb(E),ia=Q.command;P=Q.flags;E=Q.timeout;var W=Q.webAuthNPara;if(ia)switch(console.log("==== command: "+Q.command),ia){case 5:if(Q.request)switch(ia=Q.request[0],console.log("==== webAuth cmdType = "+ia),console.log("==== webAuth request bytes: "+vb(Q.request.slice(1,Q.request.length))),ia){case 1:Q=
Q.request.slice(1,Q.request.length);var X=Jb(Q);Q=X[1];var D=X[2],ea=X[3],fa=X[4],Y=X[5];ia=X[6];var ma=X[7];X={};var ba=Dd(W);ba&&(ba.attestation&&(X.attestation=ba.attestation),ba.attestationFormats&&(X.attestationFormats=ba.attestationFormats));if(P=Cd(P,W,ma))X.authenticatorSelection=P;X.challenge=Q;Y&&(X.excludeCredentials=Hc(Y));X.rpId=D.id;X.rp=D;X.extensions=ia?ia:{};X.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};fa&&(X.pubKeyCredParams=
fa);E&&(X.timeout=E);X.user=ea;E={};E.signal=n();E.publicKey=X;navigator.credentials.create(E).then(function(ja){Ed(ja.response,D).then(function(aa){var Z={},S={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},ra=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);S.aaGuid=ra.buffer;S.residentKey=!0;Z.deviceInfo=S;Z.status=
0;Z.response=aa;aa=CBOR.encode(Z);Z=new hi5.DataBuffer(new Uint8Array(4+aa.byteLength));Z.setLittleEndian32(0);Z.setBytes(aa);Z.markEnd();t.send(Z)})}).catch(function(ja){console.log("WebAuthN MakeCredential failed with error code ["+ja.code+"], msg: "+ja.message);ja=new hi5.DataBuffer(new Uint8Array(4));ja.setLittleEndian32(1);ja.markEnd();t.send(ja)});break;case 2:Q=Q.request.slice(1,Q.request.length);X=Jb(Q);Q=X[2];ea=X[3];ia=X[4];ma=X[5];X={};ea&&(X.allowCredentials=Hc(ea));X.challenge=Q;ia&&
(X.extensions=ia);X.rp=window.location.hostname;E&&(X.timeout=E);if(E=Gc(P,W,ma))X.userVerification=E;E={};E.signal=n();E.publicKey=X;navigator.credentials.get(E).then(function(ja){ja=new hi5.DataBuffer(new Uint8Array(void 0));ja.markEnd();t.send(ja)}).catch(function(ja){console.log("WebAuthN GetAssertion failed with error code ["+ja.code+"], msg: "+ja.message);ja=new hi5.DataBuffer(new Uint8Array(4));ja.setLittleEndian32(1);ja.markEnd();t.send(ja)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+
ia)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:E=new hi5.DataBuffer(new Uint8Array(8));E.setLittleEndian32(0);P=Fc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;P?E.setLittleEndian32(1):E.setLittleEndian32(0);E.markEnd();t.send(E);break;case 7:y();E=new hi5.DataBuffer(new Uint8Array(4));E.setLittleEndian32(0);E.markEnd();t.send(E);break;case 8:E=new hi5.DataBuffer(new Uint8Array(8));E.setLittleEndian32(0);E.setLittleEndian32(4);
E.markEnd();t.send(E);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+ia)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return t};p.enableWebAuthn()&&Fc()&&(a=x.WEBAUTHN(p.DynamicChannel),p.addDynamicChannel(a));x.WEBCAM=function(v){var n=new v;n.name="RDCamera_Device_0";n.version=2;n.newInstance=function(){return x.WEBCAM(v)};n.onopen=function(){svGlobal.logger.info("cam open")};n.onclose=function(){svGlobal.logger.info("cam close")};n.sendSucess=
function(){var y=new hi5.DataBuffer(new Uint8Array(2));y.setByte(n.version);y.setByte(1);y.markEnd();n.send(y)};n.sendError=function(y){var t=new hi5.DataBuffer(new Uint8Array(6));t.setByte(n.version);t.setByte(2);t.setLittleEndian32(y||1);t.markEnd();n.send(t)};n.sendSteamListResp=function(){var y=new hi5.DataBuffer(new Uint8Array(7));y.setByte(n.version);y.setByte(10);y.setLittleEndian16(1);y.setByte(1);y.setByte(1);y.setByte(0);y.markEnd();n.send(y)};n.sendMediaTypeListResp=function(y){var t=x.videoMedia.resolutions,
O=t.length,E=new hi5.DataBuffer(new Uint8Array(2+26*O));E.setByte(n.version);E.setByte(12);for(var P=1==y,Q=0;Q<O;Q++){E.setByte(y);var ia=t[Q];E.setLittleEndian32(ia.width);E.setLittleEndian32(ia.height);E.setLittleEndian32(P?ia.frameRate:x.videoMedia.minFrameRate);E.setLittleEndian32(1);E.setLittleEndian32(1);E.setLittleEndian32(1);E.setByte(1)}E.markEnd();n.send(E)};n.sendCurrentMediaType=function(y,t){var O=new hi5.DataBuffer(new Uint8Array(28));O.setByte(n.version);O.setByte(14);t=x.videoMedia.resolutions[t];
O.setByte(y);O.setLittleEndian32(t.width);O.setLittleEndian32(t.height);O.setLittleEndian32(1==y?t.frameRate:x.videoMedia.minFrameRate);O.setLittleEndian32(1);O.setLittleEndian32(1);O.setLittleEndian32(1);O.setByte(1);O.markEnd();n.send(O)};n.sendSampleResp=function(y){x.videoMedia.grabFrame(function(t){var O=new hi5.DataBuffer(new Uint8Array(t.byteLength+3));O.setByte(n.version);O.setByte(18);O.setByte(y);O.setBytes(new Uint8Array(t));O.markEnd();n.send(O)})};n.sendPropertyListResp=function(){for(var y=
0,t,O,E=x.videoMedia.propertyList,P=0;2>P;P++){O=E[P];t=O.length;for(var Q=0;Q<t;Q++)null!=O[Q]&&y++}var ia=new hi5.DataBuffer(new Uint8Array(2+19*y));ia.setByte(n.version);ia.setByte(21);for(P=0;2>P;P++){O=E[P];t=O.length;var W=P+1;for(Q=0;Q<t;Q++)y=O[Q],null!=y&&(ia.setByte(W),ia.setByte(y.propertyId),ia.setByte(y.capabilities),ia.setLittleEndian32(y.min),ia.setLittleEndian32(y.max),ia.setLittleEndian32(y.step),ia.setLittleEndian32(y.default))}ia.markEnd();n.send(ia)};n.sendPropertyValueResp=function(y,
t){(y=x.videoMedia.propertyList[y-1][t-1])?(t=new hi5.DataBuffer(new Uint8Array(7)),t.setByte(n.version),t.setByte(23),t.setByte(y.capabilities),t.setLittleEndian32(y.default),t.markEnd(),n.send(t)):n.sendError(8)};n.setPropertyValue=function(y,t,O){if(y=x.videoMedia.propertyList[y-1][t-1])y.default=O};n.process=function(y){y.getByte();var t=y.getByte();switch(t){case 7:x.videoMedia.activate(n.sendSucess,n.sendError);break;case 8:x.videoMedia.deactivate();n.sendSucess();break;case 9:n.sendSteamListResp();
break;case 11:y=y.getByte();0!=y&&svGlobal.logger.warn("Invalid stream index: "+y);n.sendMediaTypeListResp(x.videoMedia.type);break;case 13:y=y.getByte();n.sendCurrentMediaType(x.videoMedia.type,y);break;case 15:y.getByte();t=y.getByte();if(t!=x.videoMedia.type){svGlobal.warn("Invalid video format req:"+t);n.sendError(6);break}t=y.getLittleEndian32();var O=y.getLittleEndian32();y=y.getLittleEndian32()/y.getLittleEndian32();x.videoMedia.startStream(t,O,y,n.sendSucess,n.sendError);break;case 16:x.videoMedia.stopStream();
n.sendSucess();break;case 17:y=y.getByte();0!=y&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+y);n.sendSampleResp(y);break;case 20:n.sendPropertyListResp();break;case 22:t=y.getByte();O=y.getByte();n.sendPropertyValueResp(t,O);break;case 24:t=y.getByte();O=y.getByte();var E=y.getByte();y=y.getLittleEndian32();1==E&&n.setPropertyValue(t,O,y);n.sendSucess();break;default:n.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+t)}};return n};x.WEBCAM_ENUM=function(v,n){var y=new v;
y.name="RDCamera_Device_Enumerator";y.onopen=function(){var t=new hi5.DataBuffer(new Uint8Array(2));t.setByte(n.version);t.setByte(3);t.markEnd();y.send(t);svGlobal.logger.info("camEnum open")};y.onclose=function(){svGlobal.logger.info("camEnum closed");x.videoMedia.deactivate()};y.addDevice=function(t){t+="\x00";var O=n.name+"\x00",E=new hi5.DataBuffer(new Uint8Array(2+2*t.length+O.length));E.setByte(n.version);E.setByte(5);E.setUnicodeString(t);E.setAscllString(O);E.markEnd();y.send(E)};y.process=
function(t){var O=t.getByte();t=t.getByte();switch(t){case 4:svGlobal.logger.info("camEnum ver resp: "+O);n.version=O;y.addDevice(hi5.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+t)}};return y};d&&(d=x.WEBCAM(p.DynamicChannel),a=x.WEBCAM_ENUM(p.DynamicChannel,d),p.addDynamicChannel(a),p.addDynamicChannel(d));h&&(svGlobal.logger.info("Mapping USB..."),p.addDynamicChannel(Ha.usbChannel));if(b&&x.GFX){var z=function(){ab.drawable.resumePlay||(ab.drawable.resumePlay=
function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();ab.resumeVideo()})};ab=x.GFX(p.DynamicChannel,T(N.remotefx)&&!T(N.gfx),0==p.mode,sa,N.hardwareAcceleration,T(N.yuv444)&&hi5.browser.supportsI444);ab.onmessage=function(v){p.showMessage(v)};z();ab.onuserinteract=function(v){ka.execute("showPlay");z();svGlobal.logger.info("resumePlay");return!0};ab.onfatalerror=function(v,n){p.reconnect(v.width,v.height,!0)};ab.onsps=function(v){v.fps&&p.setFPS(v.fps)};ab.onresetgraphic=function(v){p.setResolution(v.width,
v.height)};ab.onmapsurface=function(v){ab.onconfirm();var n=ka.getMonitorSurface(v.outputOriginX,v.outputOriginY,v.targetWidth+v.outputOriginX-1,v.targetHeight+v.outputOriginY-1);n?(n.setId(v.id),n.setSize(v.targetWidth,v.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+v.outputOriginX+" y:"+v.outputOriginY)};ab.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ka.execute("setDrawable",[ab.drawable])};p.addDynamicChannel(ab)}x.VOR&&(b=x.VOR(p.DynamicChannel),
p.addDynamicChannel(b[0]),p.addDynamicChannel(b[1]),p.addDynamicChannel(x.GT(p.DynamicChannel)))}}},eb=null;svGlobal.DCVC_EXTENSION&&!lb&&(p.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ha.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(p.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(eb=svGlobal.DCVC_EXTENSION.DRIVE(p.GatewayChannel),p.addGatewayChannel(eb)));this.getPrinters=function(a){if(!p.onagentmessage||!eb)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();
p.onagentmessage(b.getData());eb.listCallback=a};this.attachPrinter=function(a){eb&&eb.attachPrinter(a,p)};this.showError=Ib;this.resetStatus=dc;this.exeAppCmd=function(a){var b=ka.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ka.getWinById(a):ka.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=la.forceReconnect||!1);if(!Ja&&!c)return!1;N.minWidth&&a<N.minWidth&&(a<N.minWidth&&
svGlobal.logger.warn("Width "+a+" is samller than minWidth "+N.minWidth),a=N.minWidth);N.minHeight&&b<N.minHeight&&(b<N.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+N.minHeight),b=N.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ka)&&4>Math.abs(b-La))return!1;if(Sa&&Sa.enabled&&!1!==la.displayVC)Sa.applyResolution(a,b);else if(sc&&rb||c||Xa&&!sc)rb=!1,svGlobal.logger.info("reconnecting..."),xa("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=
function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));xa(a)};this.getUploadManager=function(){return Oa};this.setFPS=function(a){ka.execute("setFPS",[a])};this.addSurface=function(a){if(!ka.hasSurface(a)&&(Mb||sa.setContext(a.context),!ka.hasSurface(a)||!a.railWin)){lb&&a.setPlayerMode();N.mouseMoveEmu&&(a.mouseMoveEmu=T(N.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ka&&(Ka=b.width);0==La&&(La=b.height);a.setConfig(la);ka.addSurface(a);Pa(Ka,La,!0,N.monitorDef?!0:!1);a.setController(Ra);
a.setDrawable(Xd);a.setTouchpad(T(N.touchpad));var c=b=T(N.mapClipboard),e=b;void 0!=N.copyToLocal?c=T(N.copyToLocal):void 0!=la.copyToLocal&&(c=la.copyToLocal);void 0!=N.copyToRemote?e=T(N.copyToRemote):void 0!=la.copyToRemote&&(e=la.copyToRemote);a.setClipboard(b,c,e);Lb&&ec(a);N.invitation&&!T(N.control)&&(ka.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=N.ctrlToWin?T(N.ctrlToWin):void 0!=la.ctrlToWin?la.ctrlToWin:!0;c=void 0!=N.cmdToCtrl?T(N.cmdToCtrl):void 0!=la.cmdToCtrl?
la.cmdToCtrl:!0;a.run(parseInt(N.keyboard||1033,10),b,!!la.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ka.size();b<c;b++)ka.getSurface(b).railWin.getMain(ka.zOrders)&&a.push(ka.getSurface(b).railWin.getMain(ka.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";xa("8C2"+a+"\t"+b+"\t"+c);var e=ka.getSurface(ka.size()-1);e&&(e.remoteApp=new Ec(a,b,c))};this.startExitingApp=function(a){a=ka.popWins(a);for(var b=a.length-1;0<=b;b--)ka.addWin(a[b])};
var yb=new p.DynamicChannel;yb.name="PNPDR";yb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};yb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),yb.send(a)}};yb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};
p.addDynamicChannel(yb);var hb=null;T(N.scanner)&&(hb=new p.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(p.onagentmessage)p.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=
3;b.set(a.getBytes(c),2);if(p.onagentmessage)p.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(p.onagentmessage)p.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addDynamicChannel(hb));var bb=null;p.hasSmartCard()&&(bb=new p.GatewayChannel,bb.name="SCARDSTB",
bb.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(p.onagentmessage)p.onagentmessage(a);T(N.passwordIsPin)&&p.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},bb.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(p.onagentmessage)p.onagentmessage(c);break;case 3:a=a.getBytes(b-
2);b=b+4+4+4;zb&&(b+=zb.length);fb&&(b+=fb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);zb?(b.setLittleEndian32(zb.length),b.setBytes(zb)):b.setLittleEndian32(0);fb?(b.setLittleEndian32(fb.length),b.setBytes(fb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(p.onagentmessage)p.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(p.onagentmessage)p.onagentmessage(c);break;case 2:case 4:break;
default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(bb)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),p.onagentmessage)p.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},bb.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=
4;if(p.onagentmessage)p.onagentmessage(a)},p.addGatewayChannel(bb));la.detectNetwork&&(r+="&connectType=7",Hd());this.getNetworkResult=function(){return fc};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var gc=new Map,hc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(bb){var b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;bb.send(a);break;case 8:gc.clear();hc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className=
"appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var h=b.getLittleEndian32();
h=b.getAscllString(h,!1);var q=b.getLittleEndian32();q=b.getAscllString(q,!1);var L=b.getLittleEndian32();b.getAscllString(L,!1);L=b.getLittleEndian64();L=(new Date(1E3*L)).toDateString();d=Id(a,d,q,h,L);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});
b.onclose=function(){var A,G=document.querySelector('input[name="scard_name"]:checked');G&&(A=parseInt(G.value));zb=gc.get(A);sb=hc.get(A);A=document.getElementById("userPin").value;fb=(new TextEncoder("utf-8")).encode(A);A=2;A=fb?A+4+fb.length:A+4;A=sb?A+4+sb.length:A+4;A=new Uint8Array(A);A=new hi5.DataBuffer(A);A.setByte(1);A.setByte(2);fb?(A.setLittleEndian32(fb.length),A.setBytes(fb)):A.setLittleEndian32(0);sb?(A.setLittleEndian32(sb.length),A.setAsciiString(sb,sb.length)):A.setLittleEndian32(0);
bb&&bb.send(A)};document.getElementById("userPin").addEventListener("keypress",function(A){"Enter"===A.key&&(A.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),bb.send(b));break;
case 12:a[0]=1;a[1]=6;bb.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,p.onagentmessage)p.onagentmessage(b)}else if(e){e.innerHTML=
'<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Jd(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var A=0,G=document.querySelector('input[name="ds_name"]:checked');G&&(A=G.value);G=new Uint8Array(3);G[0]=4;G[1]=5;G[2]=A;if(p.onagentmessage)p.onagentmessage(G)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();p.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<
8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=p.getAgentLink(),hi5.notifications.notify({title:b,html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)h=
b.getLittleEndian32(),d=b.getUnicodeString(h),h=b.getLittleEndian32(),h=b.getUnicodeString(h),c.push({name:d,driver:h});eb&&eb.listCallback&&(eb.listCallback(c),eb.listCallback=null)}break;case 7:eb.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var zb,fb,sb,kc={type:6,data:null};this.setAgentStatus=function(a){Zc=a};this.getAgentStatus=function(){return Zc};this.run=function(){var a;if(a=null==p.onagentmessage)a=1==p.mode?!1:p.hasSmartCard()||
p.hasScanner()||T(N.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(p):(p.hasUSB()?ka.getFocused().requestUsbDevices(p.getUSB(),function(b){Ha.usbChannel.openDevices(b);ic()}):ic(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return sa};this.mouseDown=function(a,b,c){Xa&&xa("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Xa&&xa("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Xa&&xa("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Xa&&xa("8B"+(a?0:49152)+"\t"+b)};
this.writeScancode=function(a,b){Xa&&("number"==typeof a?(xa("840\t"+a),xa("8449152\t"+a)):xa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){p.reconnectOnResize&&(Va?(ob&&(clearTimeout(ob),ob=0),a&=-4,b&=-4,ob=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){p.writeRawInput("8C661441\t"+a+"\t"+b);3==p.windowState&&Xc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):p.running()&&(ob&&(clearTimeout(ob),ob=0),ob=setTimeout(function(){document.hidden||
p.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!p.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=$b,b[4]=$b>>8,b[5]=Zb,b[6]=Zb>>8,b[7]=ac,b[8]=ac>>8,b[9]=bc,b[10]=bc>>8);xa(b.buffer);return!0};this.refreshOutput=function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);xa(d.buffer)};this.sendPing=function(a){var b=
new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);xa(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||(Qa=new hi5.tool.ResponseMonitor(function(){Xa&&p.sendPing()},function(){if(Xa&&p.onnoresponse)return p.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;xa(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ma?Ma.postMessage({type:0,cmd:6,start:1}):(Fa.onSlowPath=Fa.onFastPath=Oc,Fa.onReqHistory=function(){Oc(15555)})};this.stopPing=
function(){Qa&&Qa.stop();Ma?Ma.postMessage({type:0,cmd:6,start:0}):Fa.onSlowPath=Fa.onFastPath=Fa.onReqHistory=null};var $a=null,Uc=0;this.play=function(){xa("F3")};this.pause=function(){xa("F2")};this.scan=function(a){xa("F4"+(a?"1":"0"))};this.seek=function(a){var b=ka.getFocused();b&&Ja&&(xa("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),sa&&sa.pause(!0,void 0))};var Ga={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);
a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Tc=!1;this.showMessage=function(a,b,c){p&&p.displayMsg&&a&&((b=b||ka.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Bb;this.close=function(){svGlobal.logger.info("closing...");
Ja&&Va&&ka&&la.closeRemoteApp&&ka.tryCloseRemoteApps();sa&&sa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Wc,2222)):Wc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(p.close):window.addEventListener("unload",p.close,!1);Nb.searchStartCode=function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};tc.SAMPLING_FREQUENCY=[96E3,
88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Ob.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Ob.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d,h){function q(D,ea,fa,Y){this.pixels=D;this.width=ea;this.height=fa;this.key=Y}function L(){this.bottom=this.right=
this.top=this.left=0;this.read=function(D){this.left=D.getLittleEndian16();this.top=D.getLittleEndian16();this.right=D.getLittleEndian16();this.bottom=D.getLittleEndian16()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function A(){this.qualityVal=this.p=this.qb=0;this.read=function(D){var ea=D.getByte();this.qp=ea&63;this.p=ea>>7&1;this.qualityVal=D.getByte()}}function G(D,ea,fa){this.bitstream=D;this.regionRects=ea;this.isChroma=
fa;this.timestamp=0}function J(D,ea,fa){this.width=D;this.height=ea;this.monitors=fa}function x(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(D){this.left=D.getLittleEndian32();this.top=D.getLittleEndian32();this.right=D.getLittleEndian32();this.bottom=D.getLittleEndian32();this.flags=D.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function z(D,ea,fa,Y,ma){function ba(){ra=
!1;va.drawable=Z._video;Z._player=ja?new Vd(Z,!1,Y,ma):new Ob(va.drawable,Z,!1);Z._player.onsps=function(g){console.log("*** SPS: "+g.width+"x"+g.height+" smooth:"+aa.imageSmoothingEnabled);ja&&(Z._video.width=g.width,Z._video.height=g.height);Z.onsps&&Z.onsps(g)};Z._player.onerror=function(g){Z.onfatalerror&&Z.onfatalerror(Z,g)};Z._player.onplayerror=function(g){function f(){va={drawable:Z._video};Z.player.play(!0)}va=null;if((!Z.onuserinteract||!Z.onuserinteract(f,"video"))&&Z.onmessage)Z.onmessage({msg:"Please click Yes to continue.<br>"+
g,cbYes:function(){Z.player.play(!0);this.destroy()}})};Z._player.onframedecoded=function(g,f){if(!m)if(f)for(var u=f.length,w=0;w<u;w++){var C=f[w],B=C.right-C.left,F=C.bottom-C.top;aa.drawImage(g,C.left,C.top,B,F,C.left,C.top,B,F)}else aa.drawImage(g,0,0)}}this.id=D;this.width=ea;this.height=fa;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=ea;this.targetHeight=fa;this._player=null;var ja="no-decoder"==Y?!1:!!window.VideoDecoder;this._video=ja?new OffscreenCanvas(ea,
fa):document.createElement("video");var aa=ja?this._video.getContext("2d",{alpha:!1,desynchronized:!0,antialias:!1,powerPreference:"high-performance"}):null,Z=this,S=null,ra=!0,va={drawable:null},k=10,m=!1;ja&&(svGlobal.logger.info("...MediaDecoder in use: "+Y),aa.imageSmoothingEnabled=!1);this.pause=function(g,f){m=g;f&&aa&&aa.fillRect(0,0,_screen.width,_screen.height)};this.resumeVideo=function(){Z._player&&Z._player.play(!0)};this.setDisplayBuffer=function(g){S=g};this.draw=function(g,f,u,w){return ra?
S.draw(g,f,u,w):va};this.processAvc=function(g){ra&&ba();if(ja)g.timestamp=k,k+=10;else if(g.isChroma)return;Z.onvideoframe(g)};this.reset=function(g,f){Z&&Z._player&&Z._player.reset()};this.close=function(){Z&&Z._player&&(Z._player.close(),Z._player=null);Z=null};this.setRGBs=function(g,f,u,w,C,B,F){S.setRGBs(g,f,u,w,C,B,F)};this.getRGBs=function(g,f,u,w){return S.getRGBs(g,f,u,w)};this.moveArea=function(g,f,u,w,C,B){S.moveArea(g,f,u,w,C,B)};this.fillRect=function(g,f,u,w,C){S.fillRect(g,f,u,w,C)};
this.postPaint=function(g,f,u,w){ra&&S.postPaint(g,f,u,w)}}function v(D,ea,fa,Y){var ma=new z(D,ea,fa,d,h);ma.pixelFormat=Y||33;ma.setDisplayBuffer(e);X.push(ma);W.oncreatesurface&&W.oncreatesurface(ma);svGlobal.logger.info("create surface id:"+D+" w:"+ea+" h:"+fa+" pixelFmt:"+ma.pixelFormat);return ma}function n(D,ea,fa){for(var Y=D.getPosition(),ma=D.getLittleEndian32(),ba=Array(ma),ja=0;ja<ma;ja++){var aa=new L;aa.read(D);ba[ja]=aa}aa=Array(ma);for(ja=0;ja<ma;ja++){var Z=new A;Z.read(D);aa[ja]=
Z}D=D.getBytes(ea-(D.getPosition()-Y));return new G(D,ba,fa)}function y(D,ea,fa,Y){fa=D.getLittleEndian32();var ma=fa>>>30;fa&=1073741823;switch(ma){case 0:var ba=n(D,fa,!1);var ja=n(D,ea-fa-4,!0);break;case 1:ba=n(D,fa,!1);break;case 2:ea=D.getEnd()-D.getPosition();ja=n(D,ea,!0);break;default:throw Error("Invalid LC: "+ma);}ba&&Y.processAvc(ba);ja&&Y.processAvc(ja)}var t=new function(){function D(f,u,w,C,B){this.len=f;this.code=u;this.valueBits=w;this.type=C;this.vbase=B}function ea(f){var u=25E5-
ba,w=f.length;if(u>=w)ma.set(f,ba),ba=u>w?ba+w:0;else if(25E5>=w)ma.set(f.subarray(0,u),ba),ma.set(f.subarray(u),0),ba=w-u;else{u=(w-u)%25E5;var C=w-u,B=f.subarray(C);f=f.subarray(w-25E5,C);ma.set(f,25E5-f.length);ma.set(B,0);ba=u}}function fa(f){for(;ra<f;)S<<=8,va<m?S+=k[va++]:console.log("--- end"),ra+=8;Z-=f;ra-=f;f=S>>ra;S&=(1<<ra)-1;return f}var Y=[new D(1,0,8,0,0),new D(5,17,5,1,0),new D(5,18,7,1,32),new D(5,19,9,1,160),new D(5,20,10,1,672),new D(5,21,12,1,1696),new D(5,24,0,0,0),new D(5,25,
0,0,1),new D(6,44,14,1,5792),new D(6,45,15,1,22176),new D(6,52,0,0,2),new D(6,53,0,0,3),new D(6,54,0,0,255),new D(7,92,18,1,54944),new D(7,93,20,1,317088),new D(7,110,0,0,4),new D(7,111,0,0,5),new D(7,112,0,0,6),new D(7,113,0,0,7),new D(7,114,0,0,8),new D(7,115,0,0,9),new D(7,116,0,0,10),new D(7,117,0,0,11),new D(7,118,0,0,58),new D(7,119,0,0,59),new D(7,120,0,0,60),new D(7,121,0,0,61),new D(7,122,0,0,62),new D(7,123,0,0,63),new D(7,124,0,0,64),new D(7,125,0,0,128),new D(8,188,20,1,1365664),new D(8,
189,21,1,2414240),new D(8,252,0,0,12),new D(8,253,0,0,56),new D(8,254,0,0,57),new D(8,255,0,0,102),new D(9,380,22,1,4511392),new D(9,381,23,1,8705696),new D(9,382,24,1,17094304)],ma=new Uint8Array(25E5),ba=0,ja=new Uint8Array(65536),aa=0,Z=0,S=0,ra=0,va=0,k=null,m=0,g=!0;this.toPDU=function(){if(g)return null;var f=new Uint8Array(2500008);f[0]=29;f[2]=1;f[3]=10;f[4]=ba;f[5]=ba>>8;f[6]=ba>>16;f[7]=ba>>24;f.set(ma,8);return f};this.fromStream=function(f){ba=f.getLittleEndian32();ma.set(f.getSubarray(25E5))};
this.decompress=function(f,u){if(u){k=f;g&&(g=!1);m=k.length-1;Z=8*m-k[m];for(aa=va=ra=S=0;0<Z;)for(var w=u=0,C=0;C<Y.length;C++){for(f=Y[C];u<f.len;)w=(w<<1)+fa(1),u++;0>w&&console.log("xxx inPrefix");if(w==f.code){if(0==f.type)f=f.vbase+fa(f.valueBits),(0>f||255<f)&&console.log("xxx do c"),f&=255,ma[ba]=f,25E5==++ba&&(ba=0),ja[aa++]=f;else if(u=fa(f.valueBits),u=f.vbase+u,0>u&&console.log("xxx distance"),0!=u){if(0==fa(1))f=3;else{f=4;for(w=2;1==fa(1);)f*=2,w++;f+=fa(w)}u=25E5-u+ba;u%=25E5;w=u+
f;if(Math.abs(ba-u)>=f&&25E5>w&&25E5>ba+f)u=ma.subarray(u,w),ma.set(u,ba),ba+=f,ja.set(u,aa),aa+=f;else for(;0<f;)w=ma[u],25E5==++u&&(u=0),ma[ba]=w,25E5==++ba&&(ba=0),ja[aa++]=w,f--}else f=fa(15),Z-=ra,S=ra=0,u=k.subarray(va,va+f),ea(u),ja.set(u,aa),va+=f,aa+=f,Z-=8*f;break}}65536<aa&&console.error("xx outputIndex:"+aa);return ja.subarray(0,aa)}ea(f);return f}},O=new function(){this.process=function(D){var ea=D.getByte();if(224==ea){var fa=0!=(D.getByte()&32);var Y=D.getPosition(),ma=D.getEnd();ea=
t.decompress(D.getData().subarray(Y,ma),fa);D.setPosition(ma)}else{225!=ea&&console.log("Invalid descriptor:"+ea);ma=D.getLittleEndian16();var ba=D.getLittleEndian32();ea=new Uint8Array(ba);for(var ja=0,aa,Z=0;Z<ma;Z++)aa=D.getLittleEndian32(),fa=0!=(D.getByte()&32),aa--,Y=D.getPosition(),fa=t.decompress(D.getData().subarray(Y,Y+aa),fa),ea.set(fa,ja),ja+=fa.length,D.skipPosition(aa);ja!=ba&&console.error("wrong size, actual:"+ja+" expected:"+ba)}return new RdpBuffer(ea,0,ea.length)}},E=null,P=new rdpcodecs.RemoteFX(!1),
Q=0,ia=[],W=new a;W.name="Microsoft::Windows::RDS::Graphics";var X=new function(D,ea){var fa=[];this.push=function(Y){Y.onsps=D.onsps;Y.onfatalerror=D.onfatalerror;Y.onplayerror=D.onplayerror;Y.onuserinteract=D.onuserinteract;Y.onmessage=D.onmessage;fa[Y.id]=Y};this.get=function(Y){return fa[Y]};this.getAll=function(){return fa};this.delete=function(Y){var ma=fa[Y];ma&&(ma.onsps=null,ma.onfatalerror=null,ma.onplayerror=null,fa[Y]=null)};this.reset=function(Y){Y=0;for(var ma=fa.length;Y<ma;Y++)fa[Y]&&
fa[Y].reset()};this.close=function(){for(var Y=0,ma=fa.length;Y<ma;Y++)fa[Y]&&fa[Y].close()};this.resumeVideo=function(){for(var Y=0,ma=fa.length;Y<ma;Y++)fa[Y]&&fa[Y].resumeVideo()};ea.pause=function(Y,ma){for(var ba=0,ja=fa.length;ba<ja;ba++)fa[ba]&&fa[ba].pause(Y,ma)}}(W,e);W.drawable=new function(){this.draw=function(D,ea,fa,Y,ma){return(ma=X.get(ma))?ma.draw(D,ea,fa,Y):null};this.getSurfaces=function(){return X};this.onfocus=function(D){};this.resumePlay=null};W.resumeVideo=function(){X.resumeVideo()};
W.process=function(D){for(var ea=O.process(D);ea.has(8);){var fa=ea.getLittleEndian16();ea.getLittleEndian16();var Y=ea.getLittleEndian32(),ma=ea.getPosition()+Y-8;switch(fa){case 1:var ba=ea,ja=ba.getLittleEndian16(),aa=ba.getLittleEndian16(),Z=ba.getByte(),S=ba.getLittleEndian16(),ra=ba.getLittleEndian16(),va=ba.getLittleEndian16(),k=ba.getLittleEndian16(),m=va-S,g=k-ra,f=ba.getLittleEndian32(),u=ba.getPosition()+f,w=X.get(ja);w||(W.onconfirm&&W.onconfirm(),w=v(ja,e.width,e.height,Z));switch(aa){case 0:var C=
rdpcodecs.bitmap.byte2int(ba.getData(),f,ba.getPosition());w.setRGBs(S,ra,m,g,C,0,m);break;case 3:for(var B=P.decode(ba,f),F=B.getRects(),U=B.getTiles(),M=B.getTileSize(),l=B.getRectSize(),I=0;I<M;I++){var H=U[I];if(l)for(var R=H.x+64,ca=H.y+64,pa=0;pa<l;pa++){var ua=F[pa],Ba=ua.x+ua.width,Ea=ua.y+ua.height;R<=Ba?ca<=Ea?w.setRGBs(H.x+S,H.y+ra,64,64,H.data,0,64):w.setRGBs(H.x+S,H.y+ra,64,Ea-H.y,H.data,0,64):ca<=Ea?w.setRGBs(H.x+S,H.y+ra,Ba-H.x,64,H.data,0,64):w.setRGBs(H.x+S,H.y+ra,Ba-H.x,Ea-H.y,H.data,
0,64)}else w.setRGBs(H.x,H.y,64,64,H.data,0,4)}break;case 8:E||(E=new ClearDecoder);E.decode(ba,m,g,w.getData(),S,ra,w.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Ca=w,za=n(ba,f,!1);Ca.processAvc(za);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:y(ba,f,!1,w);break;case 15:y(ba,f,!0,w);break;default:svGlobal.logger.warn("Invalid codec:"+aa)}ba.setPosition(u);w.postPaint(S,ra,m,g);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");
break;case 4:var Ia=ea;svGlobal.logger.info("...soliFill");for(var wa=Ia.getLittleEndian16(),Aa=-16777216|Ia.getByte()<<16|Ia.getByte()<<8|Ia.getByte()|Ia.getByte()<<24,Na=Ia.getLittleEndian16(),Ya=X.get(wa),Za=0;Za<Na;Za++){var Wa=Ia.getLittleEndian16(),nb=Ia.getLittleEndian16(),xb=Ia.getLittleEndian16()-Wa,dd=Ia.getLittleEndian16()-nb;Ya.fillRect(Wa,nb,xb,dd,Aa);Ya.postPaint(Wa,nb,xb,dd)}break;case 5:var ib=ea;svGlobal.logger.info("...surfaceToSurface");for(var ed=ib.getLittleEndian16(),fd=ib.getLittleEndian16(),
Qb=ib.getLittleEndian16(),Rb=ib.getLittleEndian16(),Sb=ib.getLittleEndian16()-Qb,xc=ib.getLittleEndian16()-Rb,Yd=ib.getLittleEndian16(),gd=X.get(ed),Zd=X.get(fd),hd=ed==fd?null:gd.getRGBs(Qb,Rb,Sb,xc),id=0;id<Yd;id++){var jd=ib.getLittleEndian16(),kd=ib.getLittleEndian16();hd?Zd.setRGBs(jd,kd,Sb,xc,hd,0,Sb):gd.moveArea(Qb,Rb,Sb,xc,jd-Qb,kd-Rb)}break;case 6:var pb=ea;svGlobal.logger.info("...surfaceToCache");var $d=pb.getLittleEndian16(),yc=pb.getLittleEndian32().toString(16),ld=pb.getLittleEndian32();
0<ld&&(yc=ld.toString(16)+yc);var ae=pb.getLittleEndian16(),md=pb.getLittleEndian16(),nd=pb.getLittleEndian16(),od=pb.getLittleEndian16()-md,pd=pb.getLittleEndian16()-nd,be=X.get($d).getRGBs(md,nd,od,pd);ia[ae]=new q(be,od,pd,yc);break;case 7:var Fb=ea;svGlobal.logger.info("...cacheToSurface");for(var ce=Fb.getLittleEndian16(),de=Fb.getLittleEndian16(),ee=Fb.getLittleEndian16(),Tb=ia[ce],fe=X.get(de),qd=0;qd<ee;qd++){var ge=Fb.getLittleEndian16(),he=Fb.getLittleEndian16();fe.setRGBs(ge,he,Tb.width,
Tb.height,Tb.pixels,0,Tb.width)}break;case 8:var ie=ea.getLittleEndian16();ia[ie]=null;break;case 9:var Ub=ea,je=Ub.getLittleEndian16(),ke=Ub.getLittleEndian16(),le=Ub.getLittleEndian16(),me=Ub.getByte();v(je,ke,le,me);break;case 10:var rd=ea.getLittleEndian16();X.delete(rd);svGlobal.logger.info("delete surface id:"+rd);break;case 11:var sd=ea;sd.getLittleEndian32();sd.getLittleEndian32();break;case 12:var ne=ea.getLittleEndian32();if(0==Q){var td=new Uint8Array(20),tb=new RdpBuffer(td);tb.setLittleEndian16(13);
tb.setLittleEndian16(0);tb.setLittleEndian32(20);tb.setLittleEndian32(4294967295);tb.setLittleEndian32(ne);Q++;tb.setLittleEndian32(Q);tb.markEnd();c&&W.send(td)}break;case 14:var Vb=ea,ud=Vb.getLittleEndian32(),vd=Vb.getLittleEndian32(),zc=Vb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+ud+" h:"+vd+" monitors:"+zc);for(var wd=Array(zc),Wb=0;Wb<zc;Wb++){var Ac=new x;Ac.read(Vb);wd[Wb]=Ac;svGlobal.logger.info("MonitorDef "+Wb+": "+Ac.toString())}var xd=new J(ud,vd,wd);X.reset(xd);W.onresetgraphic&&
W.onresetgraphic(xd);break;case 15:var Xb=ea,yd=Xb.getLittleEndian16();Xb.skipPosition(2);var Gb=X.get(yd);Gb.outputOriginX=Xb.getLittleEndian32();Gb.outputOriginY=Xb.getLittleEndian32();W.onmapsurface&&W.onmapsurface(Gb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+yd+" outX:"+Gb.outputOriginX+" outY:"+Gb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var Bc=ea,zd=Bc.getLittleEndian32(),oe=Bc.getLittleEndian32(),Hb=Bc.getLittleEndian32(),
Yb=!1;switch(zd){case 524292:Yb=!1;0==(Hb&1)&&(E=new ClearDecoder);break;case 524549:(Yb=0!=(Hb&16))||0!=(Hb&1)||(E=new ClearDecoder);break;default:Yb=0==(Hb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+zd.toString(16)+" len:"+oe+" flags:"+Hb+" h264:"+Yb);W.onconfirm&&W.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var Ab=ea,Ad=Ab.getLittleEndian16();Ab.skipPosition(2);var jb=X.get(Ad);jb.outputOriginX=Ab.getLittleEndian32();jb.outputOriginY=Ab.getLittleEndian32();
jb.targetWidth=Ab.getLittleEndian32();jb.targetHeight=Ab.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+Ad+" outX:"+jb.outputOriginX+" outY:"+jb.outputOriginY+" targetW:"+jb.targetWidth+" targetH:"+jb.targetHeight);W.onmapsurface&&W.onmapsurface(jb);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+fa);return}ea.setPosition(ma)}};W.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var D=
b?2:8,ea=10+12*D,fa=new Uint8Array(ea),Y=new RdpBuffer(fa);Y.setLittleEndian16(18);Y.setLittleEndian16(0);Y.setLittleEndian32(ea);Y.setLittleEndian16(D);Y.setLittleEndian32(524292);Y.setLittleEndian32(4);Y.setLittleEndian32(b?1:0);Y.setLittleEndian32(524549);Y.setLittleEndian32(4);Y.setLittleEndian32(b?19:0);b||(Y.setLittleEndian32(655362),Y.setLittleEndian32(4),Y.setLittleEndian32(0),Y.setLittleEndian32(655872),Y.setLittleEndian32(4),Y.setLittleEndian32(0),Y.setLittleEndian32(656129),Y.setLittleEndian32(4),
Y.setLittleEndian32(0),Y.setLittleEndian32(656384),Y.setLittleEndian32(4),Y.setLittleEndian32(0),Y.setLittleEndian32(656642),Y.setLittleEndian32(4),Y.setLittleEndian32(0),Y.setLittleEndian32(656896),Y.setLittleEndian32(4),Y.setLittleEndian32(0));Y.markEnd();c&&W.send(fa)};W.onclose=function(){X.close()};e.onGetGfxHistory=function(D,ea){var fa=t.toPDU();fa&&D(fa);ea();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(D,ea){svGlobal.logger.info("Set GFX Histroy");10==D?t.fromStream(ea):
svGlobal.logger.error("Invalid GFX histroy type: "+D)};return W}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var r=navigator&&(navigator.language||navigator.userLanguage||""),K=Rdp.languageToKeyboard[r];if(!K){var V=r.indexOf("-");V&&(K=Rdp.languageToKeyboard[r.substring(0,V)])}K||(svGlobal.logger.info("No valid layout for "+r),K=1033);return K}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
