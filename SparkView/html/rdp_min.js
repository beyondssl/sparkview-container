var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(n){var K=0;return function(){return K<n.length?{done:!1,value:n[K++]}:{done:!0}}};$jscomp.arrayIterator=function(n){return{next:$jscomp.arrayIteratorImpl(n)}};$jscomp.makeIterator=function(n){var K="undefined"!=typeof Symbol&&Symbol.iterator&&n[Symbol.iterator];return K?K.call(n):$jscomp.arrayIterator(n)};$jscomp.arrayFromIterator=function(n){for(var K,V=[];!(K=n.next()).done;)V.push(K.value);return V};
$jscomp.arrayFromIterable=function(n){return n instanceof Array?n:$jscomp.arrayFromIterator($jscomp.makeIterator(n))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(n){var K=function(){};K.prototype=n;return new K};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(n,K,V){if(n==Array.prototype||n==Object.prototype)return n;n[K]=V.value;return n};$jscomp.getGlobal=function(n){n=["object"==typeof globalThis&&globalThis,n,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var K=0;K<n.length;++K){var V=n[K];if(V&&V.Math==Math)return V}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(n,K){var V=$jscomp.propertyToPolyfillSymbol[K];if(null==V)return n[K];V=n[V];return void 0!==V?V:n[K]};
$jscomp.polyfill=function(n,K,V,ka){K&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(n,K,V,ka):$jscomp.polyfillUnisolated(n,K,V,ka))};$jscomp.polyfillUnisolated=function(n,K,V,ka){V=$jscomp.global;n=n.split(".");for(ka=0;ka<n.length-1;ka++){var U=n[ka];if(!(U in V))return;V=V[U]}n=n[n.length-1];ka=V[n];K=K(ka);K!=ka&&null!=K&&$jscomp.defineProperty(V,n,{configurable:!0,writable:!0,value:K})};
$jscomp.polyfillIsolated=function(n,K,V,ka){var U=n.split(".");n=1===U.length;ka=U[0];ka=!n&&ka in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ta=0;ta<U.length-1;ta++){var X=U[ta];if(!(X in ka))return;ka=ka[X]}U=U[U.length-1];V=$jscomp.IS_SYMBOL_NATIVE&&"es6"===V?ka[U]:null;K=K(V);null!=K&&(n?$jscomp.defineProperty($jscomp.polyfills,U,{configurable:!0,writable:!0,value:K}):K!==V&&($jscomp.propertyToPolyfillSymbol[U]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(U):$jscomp.POLYFILL_PREFIX+
U,U=$jscomp.propertyToPolyfillSymbol[U],$jscomp.defineProperty(ka,U,{configurable:!0,writable:!0,value:K})))};
$jscomp.getConstructImplementation=function(){function n(){function V(){}new V;Reflect.construct(V,[],function(){});return new V instanceof V}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(n())return Reflect.construct;var K=Reflect.construct;return function(V,ka,U){V=K(V,ka);U&&Reflect.setPrototypeOf(V,U.prototype);return V}}return function(V,ka,U){void 0===U&&(U=V);U=$jscomp.objectCreate(U.prototype||Object.prototype);return Function.prototype.apply.call(V,U,ka)||
U}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var n={a:!0},K={};try{return K.__proto__=n,K.a}catch(V){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(n,K){n.__proto__=K;if(n.__proto__!==K)throw new TypeError(n+" is not extensible");return n}:null;
$jscomp.inherits=function(n,K){n.prototype=$jscomp.objectCreate(K.prototype);n.prototype.constructor=n;if($jscomp.setPrototypeOf){var V=$jscomp.setPrototypeOf;V(n,K)}else for(V in K)if("prototype"!=V)if(Object.defineProperties){var ka=Object.getOwnPropertyDescriptor(K,V);ka&&Object.defineProperty(n,V,ka)}else n[V]=K[V];n.superClass_=K.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(n){if(!(n instanceof Object))throw new TypeError("Iterator result "+n+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(n){this.yieldResult=n};
$jscomp.generator.Context.prototype.throw_=function(n){this.abruptCompletion_={exception:n,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(n){this.abruptCompletion_={return:n};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(n){this.abruptCompletion_={jumpTo:n};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(n,K){this.nextAddress=K;return{value:n}};
$jscomp.generator.Context.prototype.yieldAll=function(n,K){n=$jscomp.makeIterator(n);var V=n.next();$jscomp.generator.ensureIteratorResultIsObject_(V);if(V.done)this.yieldResult=V.value,this.nextAddress=K;else return this.yieldAllIterator_=n,this.yield(V.value,K)};$jscomp.generator.Context.prototype.jumpTo=function(n){this.nextAddress=n};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(n,K){this.catchAddress_=n;void 0!=K&&(this.finallyAddress_=K)};$jscomp.generator.Context.prototype.setFinallyBlock=function(n){this.catchAddress_=0;this.finallyAddress_=n||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(n,K){this.nextAddress=n;this.catchAddress_=K||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(n){this.catchAddress_=n||0;n=this.abruptCompletion_.exception;this.abruptCompletion_=null;return n};$jscomp.generator.Context.prototype.enterFinallyBlock=function(n,K,V){V?this.finallyContexts_[V]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=n||0;this.finallyAddress_=K||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(n,K){K=this.finallyContexts_.splice(K||0)[0];if(K=this.abruptCompletion_=this.abruptCompletion_||K){if(K.isException)return this.jumpToErrorHandler_();void 0!=K.jumpTo&&this.finallyAddress_<K.jumpTo?(this.nextAddress=K.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=n};$jscomp.generator.Context.prototype.forIn=function(n){return new $jscomp.generator.Context.PropertyIterator(n)};
$jscomp.generator.Context.PropertyIterator=function(n){this.object_=n;this.properties_=[];for(var K in n)this.properties_.push(K);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var n=this.properties_.pop();if(n in this.object_)return n}return null};$jscomp.generator.Engine_=function(n){this.context_=new $jscomp.generator.Context;this.program_=n};
$jscomp.generator.Engine_.prototype.next_=function(n){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,n,this.context_.next_);this.context_.next_(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(n){this.context_.start_();var K=this.context_.yieldAllIterator_;if(K)return this.yieldAllStep_("return"in K?K["return"]:function(V){return{value:V,done:!0}},n,this.context_.return);this.context_.return(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(n){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],n,this.context_.next_);this.context_.throw_(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(n,K,V){try{var ka=n.call(this.context_.yieldAllIterator_,K);$jscomp.generator.ensureIteratorResultIsObject_(ka);if(!ka.done)return this.context_.stop_(),ka;var U=ka.value}catch(ta){return this.context_.yieldAllIterator_=null,this.context_.throw_(ta),this.nextStep_()}this.context_.yieldAllIterator_=null;V.call(this.context_,U);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var n=this.program_(this.context_);if(n)return this.context_.stop_(),{value:n.value,done:!1}}catch(K){this.context_.yieldResult=void 0,this.context_.throw_(K)}this.context_.stop_();if(this.context_.abruptCompletion_){n=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(n.isException)throw n.exception;return{value:n.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(n){this.next=function(K){return n.next_(K)};this.throw=function(K){return n.throw_(K)};this.return=function(K){return n.return_(K)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(n,K){K=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(K));$jscomp.setPrototypeOf&&n.prototype&&$jscomp.setPrototypeOf(K,n.prototype);return K};
$jscomp.asyncExecutePromiseGenerator=function(n){function K(ka){return n.next(ka)}function V(ka){return n.throw(ka)}return new Promise(function(ka,U){function ta(X){X.done?ka(X.value):Promise.resolve(X.value).then(K,V).then(ta,U)}ta(n.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(n){return $jscomp.asyncExecutePromiseGenerator(n())};$jscomp.asyncExecutePromiseGeneratorProgram=function(n){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(n)))};
$jscomp.polyfill("Reflect",function(n){return n?n:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(n){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(n){if(n)return n;if($jscomp.setPrototypeOf){var K=$jscomp.setPrototypeOf;return function(V,ka){try{return K(V,ka),!0}catch(U){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(n){if(n)return n;var K=function(U,ta){this.$jscomp$symbol$id_=U;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ta})};K.prototype.toString=function(){return this.$jscomp$symbol$id_};var V=0,ka=function(U){if(this instanceof ka)throw new TypeError("Symbol is not a constructor");return new K("jscomp_symbol_"+(U||"")+"_"+V++,U)};return ka},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(n){if(n)return n;n=Symbol("Symbol.iterator");for(var K="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),V=0;V<K.length;V++){var ka=$jscomp.global[K[V]];"function"===typeof ka&&"function"!=typeof ka.prototype[n]&&$jscomp.defineProperty(ka.prototype,n,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return n},"es6",
"es3");$jscomp.iteratorPrototype=function(n){n={next:n};n[Symbol.iterator]=function(){return this};return n};
$jscomp.polyfill("Promise",function(n){function K(){this.batch_=null}function V(X){return X instanceof U?X:new U(function(qa,aa){qa(X)})}if(n&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return n;K.prototype.asyncExecute=function(X){if(null==this.batch_){this.batch_=[];var qa=this;this.asyncExecuteFunction(function(){qa.executeBatch_()})}this.batch_.push(X)};
var ka=$jscomp.global.setTimeout;K.prototype.asyncExecuteFunction=function(X){ka(X,0)};K.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var X=this.batch_;this.batch_=[];for(var qa=0;qa<X.length;++qa){var aa=X[qa];X[qa]=null;try{aa()}catch(ia){this.asyncThrow_(ia)}}}this.batch_=null};K.prototype.asyncThrow_=function(X){this.asyncExecuteFunction(function(){throw X;})};var U=function(X){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var qa=this.createResolveAndReject_();try{X(qa.resolve,qa.reject)}catch(aa){qa.reject(aa)}};U.prototype.createResolveAndReject_=function(){function X(ia){return function(la){aa||(aa=!0,ia.call(qa,la))}}var qa=this,aa=!1;return{resolve:X(this.resolveTo_),reject:X(this.reject_)}};U.prototype.resolveTo_=function(X){if(X===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(X instanceof U)this.settleSameAsPromise_(X);else{a:switch(typeof X){case "object":var qa=null!=X;break a;
case "function":qa=!0;break a;default:qa=!1}qa?this.resolveToNonPromiseObj_(X):this.fulfill_(X)}};U.prototype.resolveToNonPromiseObj_=function(X){var qa=void 0;try{qa=X.then}catch(aa){this.reject_(aa);return}"function"==typeof qa?this.settleSameAsThenable_(qa,X):this.fulfill_(X)};U.prototype.reject_=function(X){this.settle_(2,X)};U.prototype.fulfill_=function(X){this.settle_(1,X)};U.prototype.settle_=function(X,qa){if(0!=this.state_)throw Error("Cannot settle("+X+", "+qa+"): Promise already settled in state"+
this.state_);this.state_=X;this.result_=qa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};U.prototype.scheduleUnhandledRejectionCheck_=function(){var X=this;ka(function(){if(X.notifyUnhandledRejection_()){var qa=$jscomp.global.console;"undefined"!==typeof qa&&qa.error(X.result_)}},1)};U.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var X=$jscomp.global.CustomEvent,qa=$jscomp.global.Event,aa=$jscomp.global.dispatchEvent;
if("undefined"===typeof aa)return!0;"function"===typeof X?X=new X("unhandledrejection",{cancelable:!0}):"function"===typeof qa?X=new qa("unhandledrejection",{cancelable:!0}):(X=$jscomp.global.document.createEvent("CustomEvent"),X.initCustomEvent("unhandledrejection",!1,!0,X));X.promise=this;X.reason=this.result_;return aa(X)};U.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var X=0;X<this.onSettledCallbacks_.length;++X)ta.asyncExecute(this.onSettledCallbacks_[X]);
this.onSettledCallbacks_=null}};var ta=new K;U.prototype.settleSameAsPromise_=function(X){var qa=this.createResolveAndReject_();X.callWhenSettled_(qa.resolve,qa.reject)};U.prototype.settleSameAsThenable_=function(X,qa){var aa=this.createResolveAndReject_();try{X.call(qa,aa.resolve,aa.reject)}catch(ia){aa.reject(ia)}};U.prototype.then=function(X,qa){function aa(Oa,sa){return"function"==typeof Oa?function(rb){try{ia(Oa(rb))}catch(ob){la(ob)}}:sa}var ia,la,xa=new U(function(Oa,sa){ia=Oa;la=sa});this.callWhenSettled_(aa(X,
ia),aa(qa,la));return xa};U.prototype.catch=function(X){return this.then(void 0,X)};U.prototype.callWhenSettled_=function(X,qa){function aa(){switch(ia.state_){case 1:X(ia.result_);break;case 2:qa(ia.result_);break;default:throw Error("Unexpected state: "+ia.state_);}}var ia=this;null==this.onSettledCallbacks_?ta.asyncExecute(aa):this.onSettledCallbacks_.push(aa);this.isRejectionHandled_=!0};U.resolve=V;U.reject=function(X){return new U(function(qa,aa){aa(X)})};U.race=function(X){return new U(function(qa,
aa){for(var ia=$jscomp.makeIterator(X),la=ia.next();!la.done;la=ia.next())V(la.value).callWhenSettled_(qa,aa)})};U.all=function(X){var qa=$jscomp.makeIterator(X),aa=qa.next();return aa.done?V([]):new U(function(ia,la){function xa(rb){return function(ob){Oa[rb]=ob;sa--;0==sa&&ia(Oa)}}var Oa=[],sa=0;do Oa.push(void 0),sa++,V(aa.value).callWhenSettled_(xa(Oa.length-1),la),aa=qa.next();while(!aa.done)})};return U},"es6","es3");
$jscomp.checkStringArgs=function(n,K,V){if(null==n)throw new TypeError("The 'this' value for String.prototype."+V+" must not be null or undefined");if(K instanceof RegExp)throw new TypeError("First argument to String.prototype."+V+" must not be a regular expression");return n+""};
$jscomp.polyfill("String.prototype.startsWith",function(n){return n?n:function(K,V){var ka=$jscomp.checkStringArgs(this,K,"startsWith");K+="";var U=ka.length,ta=K.length;V=Math.max(0,Math.min(V|0,ka.length));for(var X=0;X<ta&&V<U;)if(ka[V++]!=K[X++])return!1;return X>=ta}},"es6","es3");
$jscomp.iteratorFromArray=function(n,K){n instanceof String&&(n+="");var V=0,ka=!1,U={next:function(){if(!ka&&V<n.length){var ta=V++;return{value:K(ta,n[ta]),done:!1}}ka=!0;return{done:!0,value:void 0}}};U[Symbol.iterator]=function(){return U};return U};$jscomp.polyfill("Array.prototype.keys",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(K){return K})}},"es6","es3");
$jscomp.polyfill("Array.from",function(n){return n?n:function(K,V,ka){V=null!=V?V:function(qa){return qa};var U=[],ta="undefined"!=typeof Symbol&&Symbol.iterator&&K[Symbol.iterator];if("function"==typeof ta){K=ta.call(K);for(var X=0;!(ta=K.next()).done;)U.push(V.call(ka,ta.value,X++))}else for(ta=K.length,X=0;X<ta;X++)U.push(V.call(ka,K[X],X));return U}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var n={},K=Object.create(new $jscomp.global.Proxy(n,{get:function(V,ka,U){return V==n&&"q"==ka&&U==K}}));return!0===K.q}catch(V){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(n,K){return Object.prototype.hasOwnProperty.call(n,K)};
$jscomp.polyfill("WeakMap",function(n){function K(){if(!n||!Object.seal)return!1;try{var ia=Object.seal({}),la=Object.seal({}),xa=new n([[ia,2],[la,3]]);if(2!=xa.get(ia)||3!=xa.get(la))return!1;xa.delete(ia);xa.set(la,4);return!xa.has(ia)&&4==xa.get(la)}catch(Oa){return!1}}function V(){}function ka(ia){var la=typeof ia;return"object"===la&&null!==ia||"function"===la}function U(ia){if(!$jscomp.owns(ia,X)){var la=new V;$jscomp.defineProperty(ia,X,{value:la})}}function ta(ia){if(!$jscomp.ISOLATE_POLYFILLS){var la=
Object[ia];la&&(Object[ia]=function(xa){if(xa instanceof V)return xa;Object.isExtensible(xa)&&U(xa);return la(xa)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(n&&$jscomp.ES6_CONFORMANCE)return n}else if(K())return n;var X="$jscomp_hidden_"+Math.random();ta("freeze");ta("preventExtensions");ta("seal");var qa=0,aa=function(ia){this.id_=(qa+=Math.random()+1).toString();if(ia){ia=$jscomp.makeIterator(ia);for(var la;!(la=ia.next()).done;)la=la.value,this.set(la[0],la[1])}};aa.prototype.set=function(ia,
la){if(!ka(ia))throw Error("Invalid WeakMap key");U(ia);if(!$jscomp.owns(ia,X))throw Error("WeakMap key fail: "+ia);ia[X][this.id_]=la;return this};aa.prototype.get=function(ia){return ka(ia)&&$jscomp.owns(ia,X)?ia[X][this.id_]:void 0};aa.prototype.has=function(ia){return ka(ia)&&$jscomp.owns(ia,X)&&$jscomp.owns(ia[X],this.id_)};aa.prototype.delete=function(ia){return ka(ia)&&$jscomp.owns(ia,X)&&$jscomp.owns(ia[X],this.id_)?delete ia[X][this.id_]:!1};return aa},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(n){function K(){if($jscomp.ASSUME_NO_NATIVE_MAP||!n||"function"!=typeof n||!n.prototype.entries||"function"!=typeof Object.seal)return!1;try{var aa=Object.seal({x:4}),ia=new n($jscomp.makeIterator([[aa,"s"]]));if("s"!=ia.get(aa)||1!=ia.size||ia.get({x:4})||ia.set({x:4},"t")!=ia||2!=ia.size)return!1;var la=ia.entries(),xa=la.next();if(xa.done||xa.value[0]!=aa||"s"!=xa.value[1])return!1;xa=la.next();return xa.done||4!=xa.value[0].x||"t"!=xa.value[1]||!la.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(n&&$jscomp.ES6_CONFORMANCE)return n}else if(K())return n;var V=new WeakMap,ka=function(aa){this.data_={};this.head_=X();this.size=0;if(aa){aa=$jscomp.makeIterator(aa);for(var ia;!(ia=aa.next()).done;)ia=ia.value,this.set(ia[0],ia[1])}};ka.prototype.set=function(aa,ia){aa=0===aa?0:aa;var la=U(this,aa);la.list||(la.list=this.data_[la.id]=[]);la.entry?la.entry.value=ia:(la.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:aa,value:ia},la.list.push(la.entry),this.head_.previous.next=la.entry,this.head_.previous=la.entry,this.size++);return this};ka.prototype.delete=function(aa){aa=U(this,aa);return aa.entry&&aa.list?(aa.list.splice(aa.index,1),aa.list.length||delete this.data_[aa.id],aa.entry.previous.next=aa.entry.next,aa.entry.next.previous=aa.entry.previous,aa.entry.head=null,this.size--,!0):!1};ka.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=X();this.size=0};ka.prototype.has=
function(aa){return!!U(this,aa).entry};ka.prototype.get=function(aa){return(aa=U(this,aa).entry)&&aa.value};ka.prototype.entries=function(){return ta(this,function(aa){return[aa.key,aa.value]})};ka.prototype.keys=function(){return ta(this,function(aa){return aa.key})};ka.prototype.values=function(){return ta(this,function(aa){return aa.value})};ka.prototype.forEach=function(aa,ia){for(var la=this.entries(),xa;!(xa=la.next()).done;)xa=xa.value,aa.call(ia,xa[1],xa[0],this)};ka.prototype[Symbol.iterator]=
ka.prototype.entries;var U=function(aa,ia){var la=ia&&typeof ia;"object"==la||"function"==la?V.has(ia)?la=V.get(ia):(la=""+ ++qa,V.set(ia,la)):la="p_"+ia;var xa=aa.data_[la];if(xa&&$jscomp.owns(aa.data_,la))for(aa=0;aa<xa.length;aa++){var Oa=xa[aa];if(ia!==ia&&Oa.key!==Oa.key||ia===Oa.key)return{id:la,list:xa,index:aa,entry:Oa}}return{id:la,list:xa,index:-1,entry:void 0}},ta=function(aa,ia){var la=aa.head_;return $jscomp.iteratorPrototype(function(){if(la){for(;la.head!=aa.head_;)la=la.previous;for(;la.next!=
la.head;)return la=la.next,{done:!1,value:ia(la)};la=null}return{done:!0,value:void 0}})},X=function(){var aa={};return aa.previous=aa.next=aa.head=aa},qa=0;return ka},"es6","es3");$jscomp.findInternal=function(n,K,V){n instanceof String&&(n=String(n));for(var ka=n.length,U=0;U<ka;U++){var ta=n[U];if(K.call(V,ta,U,n))return{i:U,v:ta}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(n){return n?n:function(K,V){return $jscomp.findInternal(this,K,V).i}},"es6","es3");
var svManager={getInstance:function(){var n=window.$rdp;return n&&n.running&&n.running()?n:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(n){var K={};K.id=n.id;K.server=n.id;K.displayName=n.displayName||n.id;if(n=n.rdp){for(var V in n)K[V]=n[V];K.user=n.username||"";K.pwd=n.password||"";K.useConsole=n.console||!1;K.legacyMode=n.leagacyMode||n.legacyMode||!1;K.server_bpp=n.color||16;K.exe=n.remoteProgram||"";K.args=n.remoteArgs||"";K.startProgram=0<K.exe.length?"app":K.command&&0<K.command.length?"shell":"noapp"}return K}
function Rdp2(n){n=svGlobal.util.getServerArgs(n);if(!n||!n.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var K=n.gateway||"",V=0,ka=0,U=16,ta=1==n.useSSL||"true"==n.useSSL||"on"==n.useSSL||null;n.width&&(V=parseInt(n.width,10));n.height&&(ka=parseInt(n.height,10));n.color&&(U=parseInt(n.color,10));n.server_bpp&&(U=parseInt(n.server_bpp,10));n=hi5.browser.obj2url(n);null===ta&&(ta="https:"==location.protocol);return new Rdp((ta?"wss://":"ws://")+K+"/RDP?"+n,V,ka,U)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(n,K,V,ka){function U(a){return"on"==a||"true"==a||1==a}function ta(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function X(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function qa(a,b){a=ha[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function aa(){return P.displayName||P.server||P.symlink||P.id||"undefined"}function ia(a){p.loadbalanceToken||
(p.loadbalanceToken=ha.loadbalanceTokenName?ha.loadbalanceTokenName+"="+a:"")}function la(a,b,c){p.ontitlechange&&(a=p.ontitlechange(a,c));p.setTitle&&a&&(b=b||window,b.document.title=a)}function xa(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return P.invitation||p.showMessage("15 bit color is not supported anymore."),!1;default:return!1}gb=a;b&&(La?La.postMessage({type:0,cmd:1,data:a}):Ba&&Ba.setColor(a));return!0}function Oa(a,b,c,e){Ja=a;Ka=b;Wb=Xb=0;Yb=Ja-1;Zb=Ka-1;Va&&(Ja=(P.waWidth||
hi5.browser.getScreenWidth())|0,Ka=(P.waHeight||hi5.browser.getScreenHeight())|0);P.minWidth&&Ja<P.minWidth&&(Ja=P.minWidth|0);P.minHeight&&Ka<P.minHeight&&(Ka=P.minHeight|0);Ja&=-4;Ka&=-4;svGlobal.logger.warn("resolution changed, w:"+Ja+" h:"+Ka);var d=Ja,g=Ka;oa?oa.resize(d,g):oa=new xc(d,g);da.setSize(Ja,Ka,Va?"hidden":null);if(c||Ja!=a||Ka!=b)La?La.postMessage({type:0,cmd:2,data:{w:Ja,h:Ka}}):Ba&&Ba.setResolution(Ja,Ka);if(p.onresolutionchange&&!e)p.onresolutionchange(a,b)}function sa(a){!cb&&
Ha&&(La?($b.data=a,"string"!=typeof a?La.postMessage($b,[a]):La.postMessage($b)):Ba.writeRawInput(a))}function rb(a){switch(a){case "\r":break;case "\n":p.writeScancode(28);break;case "\t":p.writeScancode(15);break;default:sa("86"+a)}}function ob(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),g=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=g?5:9;c=new Uint8Array(e+c);c[0]=a;if(g)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{g=b.name;for(var m=Math.min(g.length,8),I=0;I<m;I++)c[1+I]=g.charCodeAt(I)}c.set(d,e);sa(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Fb(a){if(p){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};p.displayMsg&&p.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(p.onerror)p.onerror(a)}}function yc(a){if(p){var b=__svi18n.info[a];b||(b="info "+a);p.displayMsg&&p.showMessage(b);svGlobal.logger.info(b)}}function ac(){var a=Ha;pb=Ha=!1;La?La.postMessage({type:0,
cmd:3}):Ba&&Ba.resetStatus();a&&(Ha=a)}function bc(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(sa)),Ma.addEvent("beforeupload",function(b,c,e){if(p.beforeupload)return p.beforeupload(b,c,e)}),Ma.addEvent("fileuploaded",function(b,c,e){if(p.onfileuploaded)p.onfileuploaded(b,c,e)}),Ma.addEvent("uploaded",function(b,c){if(p.onuploaded)p.onuploaded(b,c)}),Ma.addEvent("uploadingCancelled",function(){if(p.onuploadingCancelled)p.onuploadingCancelled()}));a.setFileHandler(Ma)}function zc(a,
b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ha&&(e=!0,sa("8C5"+d.exe+"\t"+d.args+"\t"+p.sessionInfo.appInfo.session))}}function td(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ac(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}function Gb(a){a=
(new Uint8Array(a)).buffer;return CBOR.decode(a)}function ud(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=void 0));
d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Bc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Cc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var g=[];e&1?g.push("usb"):e&2?g.push("nfc"):e&4?g.push("ble"):e&16?g.push("internal"):e&32&&g.push("hybrid");d.transports=
g}b.push(c)}}return b}function Bc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function vd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function wd(a,b){var c,e,d,g,m,I,x,D,G,u,w,O,q,B,N,t,R,F,T,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var Y=$jscomp.makeIterator(e),A=Y.next();!A.done;A=Y.next())A=A.value,"USB"==A.toUpperCase()||"NFC"==A.toUpperCase()||"BLE"==A.toUpperCase()||"INTERNAL"==A.toUpperCase()||A.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+sb(new Uint8Array(d))),m=Gb(d),g=m.attStmt;if(I=a.clientDataJSON)console.log("==== clientDataJson bytes: "+sb(new Uint8Array(I))),x=window.origin,D=(new TextDecoder).decode(I),G=JSON.parse(D),G.origin&&(G.origin=x);u=a.getAuthenticatorData();
if(!u)return M.jumpTo(0);w=new Uint8Array(u);console.log("==== authenticatorData bytes: "+sb(w));return b?(O=b.id)?M.yield(xd(O),5):M.jumpTo(0):M.jumpTo(0)}q=M.yieldResult;B=new Uint8Array(q);console.log("==== hash of realRpID: "+sb(B));N=new hi5.DataBuffer(new Uint8Array(w.byteLength));N.setBytes(B);t=w.slice?w.slice(32,w.length):w.subarray(32,w.length);N.setBytes(t);N.markEnd();R=N.getData();console.log("==== newAuthDataBytes: "+sb(new Uint8Array(R)));F={1:"packed",2:R,3:g};T=CBOR.encode(F);y=new hi5.DataBuffer(new Uint8Array(T.byteLength+
1));y.setByte(0);y.setBytes(T);y.markEnd();return M.return(y.getData())})}function xd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(yd(b))})}function yd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function sb(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function zd(){var a=0,b=0,c=new p.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),g=e.getLittleEndian16(),m=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(m){case 1:case 4097:m=new RdpBuffer(new Uint8Array(6),0,6);m.setByte(6);m.setByte(1);m.setLittleEndian16(g);m.setLittleEndian16(0);m.markEnd();c.send(m);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:g=e.getLittleEndian16();a+=g;break;case 43:case 1065:case 1577:43==m&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(g);d.setLittleEndian16(43==m?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:g=e.getLittleEndian32();m=e.getLittleEndian32();
e=e.getLittleEndian32();Hb={baseRTT:g,bandwidth:m,averageRTT:e};if(p.onnetworkresult)p.onnetworkresult(Hb);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Hb);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};p.addGatewayChannel(c)}function Ad(a,b,c,e,d){cc.set(a,b);dc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Bd(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Dc(){var a="";P&&U(P.connectif)&&P.symlink&&"sessionStorage"in window&&(a="SV_"+P.symlink,P.domain&&(a+=P.domain),
P.user&&(a+=P.user));return a}function Cd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function ec(){if(!Ha){pb=!1;var a="";cb?Ea.init(!1,!0,!1,0,!1,!1):a=p.getRuntimeURL();void 0==ha.wsPost&&(ha.wsPost=!1);p.oncreatewebsocket&&(La=null);La?(cb&&(cb.onopen=fc,cb.onclose=zb,cb.onmessage=function(c){gc.data=c.data;La.postMessage(gc,
[gc.data])}),La.postMessage({type:0,cmd:0,data:{addr:a,width:Ja,height:Ka,server_bpp:gb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ha.wsPost}})):(Ba=new RdpGeneral(cb||a,Ja,Ka,gb,oa,!1,ha.wsPost),Ba.oncreatewebsocket=p.oncreatewebsocket,Ba.run());La?La.addEventListener("message",Ec,!1):(Ba.onopen=fc,Ba.onmessage=Fc,Ba.onclose=zb,Ba.onerror=Fb,Ba.oninfo=yc,Ba.onloggedin=hc,Ba.onresolutionchange=function(c,e){Oa(c,e,!1,P.monitorDef&&0<=P.monitor?!0:!1)},Ba.onAltSecWindows=Gc,Ba.onMoveCursor=ic,Ba.onCloseSurface=
Hc,Ba.onColorChange=xa,Ba.onHistoryReceived=function(){jc()},Ba.onLockKeyState=function(c){if(p.onLockKeyState)p.onLockKeyState(c)});if(a=da.getSurface(da.size()-1))Va?a&&(a.remoteApp=new zc(P.exe,P.args,"")):la(aa(),a.getWindow());if(P.invitation&&!U(P.shadow)){var b=null;a&&(b=a.initChat(P.expert));Ab=new p.GatewayChannel;Ab.name="C_H_A_T";Ab.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,P.novice)};b&&(b.onchat=function(c){if(Ha){var e=Array(2*c.length);e=new hi5.DataBuffer(e,
0,e.length);e.setUnicodeString(c);e.markEnd();Ab.send(e)}});p.addGatewayChannel(Ab)}}}function Ec(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:fc();break;case 1:zb(a.expected);break;case 2:Fb(a.code);break;case 3:yc(a.code);break;case 4:hc();break;case 5:Oa(a.w,a.h,!1,P.monitorDef&&0<=P.monitor?!0:!1);break;case 6:ic(a.x,a.y,!0);break;case 7:Hc();break;case 8:0==a.id&&jc();Pa&&Pa.check(1<a.id?15555:0);break;case 9:xa(a.color);break;case 10:if(p.onLockKeyState)p.onLockKeyState(a.state);
break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:oa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:oa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:oa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:oa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:oa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:oa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Ic(a);break;case 10:Fc(a);break;
case 11:Ua.attach(a.data,0,a.data.length);Gc(Ua,a.size);break;case 12:oa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:oa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:oa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:oa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:oa.putFont(a.font,
a.character,a.glyph);break;case 17:oa.putCursor(a.idx,a.cursor);break;case 18:oa.setCursor(a.idx);break;case 19:oa.getHistory(sa,function(){La.postMessage({type:0,cmd:7})});Pa&&Pa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);oa.setHistory(a.order,Ua);break;case 21:oa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Jc(a){Pa&&Pa.check(a)}function fc(){Ha=!0;var a="87"+navigator.userAgent+"\t";Ib=hi5.tool.uuid();document.cookie=
Ib+"=sv";sa(a+Ib);if(p.onopen)p.onopen();ha.joinCloseMode&&p.setJoinCloseMode(ha.joinCloseMode)}function Hc(){da&&da.close()}function Fc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=jb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Da.tag=a.getLittleEndian16();Da.channels=a.getLittleEndian16();Da.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Da.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec);La&&La.postMessage({type:0,cmd:5,data:{tag:Da.tag,channels:Da.channels,samplePerSec:Da.samplePerSec,bitsPerSample:Da.bitsPerSample}});41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);kc(a,
b,c,0);kb||(c+=Date.now()-e,sa("8A"+b+","+c))}Pa&&Pa.check();break;case 56:Kc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Lc(Ua);break;case 62:Mc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Nc(Ua);Pa&&Pa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ea[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ea[b].newInstance?(Ea[a]=Ea[b].newInstance(),Ea[a].id=a):(Ea[b].id=a,Ea[a]=Ea[b]),
Ea[a].onopen)Ea[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ea[a]&&Ea[a].process(b);break;case 4:if(Ea[a]&&Ea[a].onclose)Ea[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Pa&&Pa.check();break;case 146:Dd(Ua);break;default:if(p.onunknownmessage)p.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:sa("87"+navigator.userAgent);break;case 15:if(p){lc=!1;tb=p.reconnectTimes;
(p&&0==p.mode||U(P.connectif))&&jc();b="";for(b in lb)if((c=lb[b])&&c.onopen)c.onopen();for(b in jb)if((c=jb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&p&&(p.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(p.onnotify)p.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&p.onerror)p.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;p.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:da.drawLicense(a);break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Ed(a);break;case 2:Bb?(Bb.type==a?p.writeRawInput("881"+a+"\t"+Bb.text):p.writeRawInput("881ERROR\t"),Bb=null):!(b=da.getFocused())||b.processClipReq(a)||!ha.clipWarnAlways&&Oc||!P||P.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Oc=!0);break;case 5:(b=da.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:da.setReadOnly("1"==
a);break;case 54:b=a.split("\t");a=ta()+b[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);p.onprintingready&&p.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=da.getFocused())&&b.showPDF(a);break;case 56:Kc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=da.getWinById(parseInt(b[0]))){if(!da.hasApp(b[1])){(c=da.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(p.onremoteappstart)p.onremoteappstart({id:b[1]});
if(a.isVisible()&&a.titleInfo&&p.ontitlechange)p.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Fd(a);break;case 59:a=hi5.Base64.dec(a,0);db=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(db&16||db&65536)?(Jb=!1,Ma=null):(db&16&&(Jb=!0),Ma||(a=da.getFocused())&&bc(a));db&64&&p.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(db&128)),Ma.setDownload(!(db&131072)),Ma.canCopyFile=0!=(db&65536));da.execute("setFeature",[db]);break;case 60:Lc(b64ToBuffer(a));
break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);xa(a.color);(b=a.server)&&p&&(p.server=a.server);Pc=a.length;c=da.getFocused();Va=1==a.isRail;c&&(1!=p.mode&&c.setAutoScale(!Va),b&&la(aa(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Jb=!0,bc(c));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Pc);break;case 2:2==a.status?(ac(),Ha=!0):(b=0==a.status,b==oa.isPaused()||p.onsessionpause&&p.onsessionpause(b,
a)||(oa.pause(b),b||da.repaint(0,0,oa.width-1,oa.height-1),a.warn&&p.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Mc(a);break;case 63:Nc(b64ToBuffer(a));break;default:if(p.onunknownmessage)p.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function jc(){if(!kb&&!Wa&&(Wa=!0,p&&(ha.pingInterval&&p.startPing(ha.pingInterval),p.onready)))p.onready()}function Dd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;sa(a.buffer);
break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(db^=65536,da.execute("setFeature",[db]));break;case 6:Qa.remoteLockFlags=a.getLittleEndian32();Qa.checkLockFlags=!0;if(p.onLockKeyState)p.onLockKeyState({capsLock:0!=(Qa.remoteLockFlags&4),numLock:0!=(Qa.remoteLockFlags&2),scrollLock:0!=(Qa.remoteLockFlags&1)},{capsLock:0!=(Qa.localLockFlags&4),numLock:0!=(Qa.localLockFlags&2),scrollLock:0!=(Qa.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Qa.remoteLockFlags);
break;case 7:b=a.getByte();p.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);p.sessionInfo.appInfo.twoFAQR=a;p.ontwofaqr&&p.ontwofaqr(a)||2==b&&da.execute("showTwoFAQR");break;case 1:oa.pause(!0,!0);if(p.ontwofacode&&p.ontwofacode())return;(a=da.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!p.ontwofaresult||!p.ontwofaresult(b,a))&&Qa.onauthcoderesult)Qa.onauthcoderesult(b,a)}break;case 8:b=a.getByte();
if(a=da.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var g=new Uint8Array(2+d.length);g[0]=146;g[1]=8;g.set(d,2);sa(g.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Gd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var g=da.getFocused();g&&Ha&&(g=g.getThumbnail(a))&&g.length!=d&&(sa("8E7"+g),d=g.length)},
b))};this.stop=function(){clearInterval(c)}}function Hd(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Gd(a,b));Ya.start()}function Nc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Mc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ac();Ha=!0;a=d.width;e=d.height;if(a==Ja&&e==Ka)break;Oa(a,e,!1,!1);break;case 1:d=JSON.parse(c);p.sessionInfo.joinedSessions.push(d.numericId);
p.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||ha.alertJoin)p.onsessionjoin&&(a=p.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&p.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);p.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=p.sessionInfo.joiners;c=0;for(var g=b.length;c<g;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ha.alertJoin)p.onsessionexit&&
(a=p.onsessionexit(d)),!a&&__svi18n.info.exitsession&&p.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;da.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);da.setReadOnly(!0,2==
d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);p.onrequirecontrol&&(a=p.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;oa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));p.showMessage({title:a,msg:e,cbYes:function(){p.giveControl(d.numericId);this.destroy();oa.isPaused()&&
p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(d.numericId);this.destroy()},html:!0});break;case 6:da.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Oa(d.width,d.height,!0,P.monitorDef&&0<=P.monitor?!0:!1);d.color&&(xa(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(p.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);lc=!0;if(p.onrequestcredential&&p.onrequestcredential(d,Qa.reconnect))break;
if(p.onautherror&&p.onautherror(d,Qa.reconnect))break;da.getFocused().requestCredential(d,Qa.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Hd(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);p.onrequirejoin&&(a=p.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);p.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(d.numericId,!1);this.destroy()}});
break;case 13:d=JSON.parse(c);"login"==d.type&&hc();break;case 14:if(d=JSON.parse(c),p.oncontrolchange)p.oncontrolchange(d)}}function Lc(a){switch(a.getByte()){case 32:if(!oa.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,g=void 0;ha.noCursorName||(d=a.getLittleEndian32(),p.sessionInfo.appInfo&&(g=p.sessionInfo.appInfo.sessions[d]));ic(c,e,!0,g,d,b)}}}function ic(a,b,c,e,d,g){oa.isPaused()||da.getFocused().moveCursor(a,b,c,e,d,g)}function Ic(a){da.setCursor(a)}
function Id(a){var b=ha.page&&ha.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=ta();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Kc(a){a=JSON.parse(a);mc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",mc),c.setItem("appInfo.numericId",
b));ia(a.appId);a.server||(a.server=aa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=p.mode&&da.execute("setAutoScale",[!0]):(p.mode=0,U(P.connectif)&&da.setSize(Ja,Ka),ha.disableJoinedAppResize&&(p.windowState=0));var e=ta();b=Id("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),p.protocol="http"==c.substring(0,e)?"ws":"wss",p.gateway=c,b+="&gateway="+encodeURIComponent(c));
b=p.modifyURL(b);a.joinLink=b;p.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Oa(Ja,Ka,!0,!0),pb||1==p.mode||da.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ha.cursorNameOnly=a.isAssistance;if(p.onsessionstart)p.onsessionstart(p.sessionInfo)}function Fd(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Ma.confirmId(c[0],
c[1],c[2]);break;case 2:Ma.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Ma.close(c[0]);break;case 9:a='<a href="'+p.modifyURL(ta()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&da.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Ma.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function kc(a,b,c,e){if(!Jd||oa.isPaused())return 0;
var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Da.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Da.tag)nc||(nc=new MSGSM),b=nc.decode(b,d,e),d=0,e=b.length;var g=Da.bitsPerSample;var m=Math.floor(e/(g>>3));var I=c=e=0;a||(e=Math.pow(2,g-1)-1,c=-e-1,I=Math.pow(2,g));g=Da.channels;var x=Math.floor(m/g),D=Ta.getBuffer(x),G=D.getChannelData(0),u=D.getChannelData(1);m=0;if(a)for(;m<x;)1==g?u[m]=G[m]=b[d++]:(G[m]=b[d++],u[m]=b[d++]),m++;else for(;m<x;)a=b[d++]|b[d++]<<8,a>e?(a-=I,
a/=-c):a/=e,1==g?G[m]=a:(G[m]=a,a=b[d++]|b[d++]<<8,a>e?(a-=I,a/=-c):a/=e),u[m]=a,m++;return Ta.playBuffer(D)}function Qc(a){if(!p.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<
a.indexOf("\n")?!1:p.onurlredirection&&p.onurlredirection(b)?!0:(a=da.getFocused())?a.processLink(b):!1:!1}function Kd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=p.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Ed(a){if("text/plain;"!=a){if(1666<Date.now()-Qa.reqCopyTime&&!(p.onservercopy&&p.onservercopy(a)||Qc(a))){var b=da.getFocused();b&&b.copyToClip(Kd(a))}setTimeout(function(){sa("883")},
999)}}function hc(a){if(!pb&&(setTimeout(function(){Ha&&sa("884")},333),p.onloggedin))p.onloggedin();oc=pb=!0;a&&a.sessionId&&(p.sessionInfo.sessionId=a.sessionId);Va&&1!=p.mode&&da.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Kb&&!Va&&(oa.setContext(da.getFocused().context),da.repaint(0,0,oa.width-1,oa.height-1))}function zb(a){if(p){hi5.browser.cookie.delete(Ib);svGlobal.logger.warn("closed "+(p.sessionInfo.appInfo?p.sessionInfo.appInfo.numericId:0));p.onagentmessage&&(p.onagentmessage=null);
if(p.onagentclose)p.onagentclose();var b=Dc();b&&p.sessionInfo.appInfo&&0==p.mode&&(sessionStorage[b]=p.sessionInfo.appInfo.session);if(p&&(b=1!=p.mode,!Ha&&b&&Fb("connection"),b=b&&(Ha||tb<p.reconnectTimes)&&0<tb&&!a,Wa=Ha=!1,b)){tb--;__svi18n.info.reconnecting&&p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-tb)+"/"+p.reconnectTimes,null,3E3);setTimeout(ec,ha.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+tb);return}if(lc)svGlobal.logger.info("Req credential");else{Pa&&
(p.stopPing(),Pa=null);La&&(La.removeEventListener("message",Ec,!1),La.postMessage({type:0,cmd:4}),La.terminate(),La=null);Ma&&(Ma.release(),Ma=null);Ra=n=null;Ea&&(Ea.close(),Ea=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);p.player&&(p.player=null);Cb=null;try{if(p.onclose)p.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}da&&(da.close(),da=null)}catch(c){svGlobal.logger.warn(c)}Ua=
null;Ba&&(Ba.onopen=null,Ba.onmessage=null,Ba.onclose=null,Ba.onerror=null,Ba.close(),Ba=null);da=Qa=null;oa&&(oa.release(),oa=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(p.close):window.removeEventListener("unload",p.close,!1);window&&window.$rdp==p&&(window.$rdp=null);p=null}}}function Rc(){Ba&&Ha?Ba.close():zb(!0)}function Gc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();
var e=a.getLittleEndian16(),d=a.getLittleEndian16(),g=0;16>c&&(g=a.getLittleEndian16());var m=a.getLittleEndian16(),I=a.getLittleEndian16();a.getBytes(m);g&&a.getBytes(g);if(8<=c&&(g=da.getFocused())&&g.onremoteappicon){m=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();I=d+I;var x;a=a.getData();for(var D=0,G,u;d<I;)switch(c){case 16:(x=a[d++]|a[d++]<<8)?(u=x>>7&248,G=x>>2&248,x=x<<3&248,u|=u>>5,G|=G>>5,x|=x>>5,e[D++]=x,e[D++]=G,e[D++]=u,e[D++]=255):D+=4;break;
case 32:e[D++]=a[d++],e[D++]=a[d++],e[D++]=a[d++],e[D++]=a[d++]}m.putPixels(e,0,e.length);a=da.getWinById(b);g.onremoteappicon(a,m)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),da.delWin(b)):Ld(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+
c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((g=da.getOwnerSurfaceById(b))&&g.railWin&&g.railWin.setActiveWinId(b,3==ha.windowState),da.setTitle(b),oa.getContext()||(b=da.getFocused())&&oa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=da.zOrders,c.length=b,g=0;g<b;g++)c[g]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[g])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Sc(a){var b=
da.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Ld(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=da.getWinById(c);d?e=!0:d=new da.LocalWin(c);
svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+
(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&
2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var g=d.showState;(2==g&&0!=ha.noMinimize||
!e&&3==g&&5==ha.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(g=0!=(b&4)){var m=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(m,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){m=a.getLittleEndian32();var I=a.getLittleEndian32();d.winOffsetX=m;d.winOffsetY=I;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+
d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==p.windowState?Sc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(m=da.getFocused())){m=m.getFreeSpace();var x=d.winWidth,D=d.winHeight;if(d.winOffsetX>m.width||d.winOffsetY>m.height||0>x+d.winOffsetX||0>D+d.winOffsetY){var G=(m.width-d.winWidth)/2|0,u=(m.height-d.winHeight)/2|0;
0>G&&(G=0);0>u&&(u=0);setTimeout(function(){d.resize(G,u,x,D)},50)}}0!=(b&256)&&(m=a.getLittleEndian16(),0<m&&a.skipPosition(8*m));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)da.onWinChange(d);else da.addWin(d);g&&da.setTitle(c);c==da.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,da.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+
c)}function xc(a,b){function c(f,k,h,r,v){0<v.width?v.union(f,k,h,r):(v.x=f,v.y=k,v.width=h,v.height=r)}function e(f,k,h,r){for(Z=0;Z<ja;Z++){var v=Y[Z];if(f>=v[0]&&k>=v[1]&&h<=v[2]&&r<=v[3])return A[Z]}return null}function d(f,k,h,r){if(ja){var v=e(f,k,f+h-1,k+r-1);v&&c(f,k,h,r,v)}else c(f,k,h,r,B)}function g(f,k,h,r,v,z,J){for(var C=v*h+r,H=f.setRGB,W=f.getRGB,E=0;E<J;E++){for(var l=0;l<z;l++){if(f){var L=W(r+l,v+E);H(r+l,v+E,~L&16777215)}else k[C]=~k[C]&16777215;C++}C+=h-z}}function m(f,k,h,r,
v,z,J,C,H,W){k=W*C+H;null==J&&(J=f);for(f=0;f<z;f++){for(H=0;H<v;H++)O[r+f][h+H]=O[r+f][h+H]&J[k]&16777215|4278190080,k++;k+=C-v}}function I(f,k,h,r,v,z,J,C,H,W){k=W*C+H;H=f.setRGB;W=f.getRGB;null==J&&(J=f);for(f=0;f<z;f++){for(var E=0;E<v;E++){var l=W(h+E,r+f);H(h+E,r+f,l|J[k]&16777215);k++}k+=C-v}}function x(f,k,h,r){var v=fa;if(v){var z=v.getRGB(k,h);switch(f){case 0:v.setRGB(k,h,0);break;case 1:v.setRGB(k,h,~(z|r)&16777215);break;case 2:v.setRGB(k,h,z&~r&16777215);break;case 3:v.setRGB(k,h,~r&
16777215);break;case 4:v.setRGB(k,h,16777215*(~z&r));break;case 5:v.setRGB(k,h,~z&16777215);break;case 6:v.setRGB(k,h,z^r&16777215);break;case 7:v.setRGB(k,h,~z&r&16777215);break;case 8:v.setRGB(k,h,z&r&16777215);break;case 9:v.setRGB(k,h,z^~r&16777215);break;case 10:break;case 11:v.setRGB(k,h,z|~r&16777215);break;case 12:v.setRGB(k,h,r);break;case 13:v.setRGB(k,h,(~z|r)&16777215);break;case 14:v.setRGB(k,h,z|r&16777215);break;case 15:v.setRGB(k,h,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+
f),v.setRGB(k,h,r)}}}function D(f,k,h,r,v,z,J,C,H){f>C||k>H||(h=f+h-1,h>C&&(h=C),f<z&&(f=z),h=h-f+1,r=k+r-1,r>H&&(r=H),k<J&&(k=J),r=r-k+1,1>h||1>r||fa.fillRect(f,k,h,r,v))}function G(f,k,h,r,v,z,J,C,H,W,E,l){if(!(k>E||h>l)){var L=k+r-1;L>E&&(L=E);H=k<H?H:k;L=L-k+1;E=h+v-1;E>l&&(E=l);W=h<W?W:h;l=E-h+1;if(!(1>L||1>l)){E=128;var Q=0;J|=4278190080;C|=4278190080;if(H==k&&W==h&&L==r&&l==v)if(0==f)for(var S=0;S<v;S++){f=h+S;for(var ca=0;ca<r;ca++)0==E&&(Q++,E=128),0!=(z[Q]&E)&&(O[f][k+ca]=C),E>>=1;Q++;E=
128;Q==z.length&&(Q=0)}else for(S=0;S<v;S++){f=h+S;for(ca=0;ca<r;ca++)0==E&&(Q++,E=128),O[f][k+ca]=0!=(z[Q]&E)?C:J,E>>=1;Q++;E=128;Q==z.length&&(Q=0)}else if(0==f)for(S=0;S<l;S++){f=h+S;for(ca=0;ca<L;ca++)0==E&&(Q++,E=128),k+ca>=H&&f>=W&&0!=(z[Q]&E)&&(O[f][k+ca]=C),E>>=1;Q++;E=128;Q==z.length&&(Q=0)}else for(S=0;S<l;S++){f=h+S;for(ca=0;ca<L;ca++)0==E&&(Q++,E=128),k+ca>=H&&h+S>=W&&(O[f][k+ca]=0!=(z[Q]&E)?C:J),E>>=1;Q++;E=128;Q==z.length&&(Q=0)}}}}function u(f,k,h,r,v){this.offset=f;this.baseLine=k;
this.width=h;this.height=r;this.fontData=v}function w(f,k,h,r,v,z,J,C,H){this.cache_idx=f;this.rawData=k;this.none=!k;this.hotX=h;this.hotY=r;this.width=v;this.height=z;this.xorSize=C;this.andSize=H;this.result="";this.distance=0;this.bpp=J;this.system="";if(k){if(!this.distance){f=0;if(k){J=0;for(var W=k.length;J<W;J++)0!=k[J]&&(f+=J%v+(J/v|0))}this.distance=f}if(!this.system){a:switch(this.distance){case 507:f="text";break a;case 2046:case 4359:f="default";break a;default:f=""}this.system=f}}f=
"";if(!this.system&&k){J=v*z*4;f=62+J+C+H;W=new Uint8Array(f);f=new hi5.DataBuffer(W,0,f);f.setLittleEndian16(0);f.setLittleEndian16(2);f.setLittleEndian16(1);f.setByte(v);f.setByte(z);f.setByte(0);f.setByte(0);f.setLittleEndian16(h);f.setLittleEndian16(r);f.setLittleEndian32(40+J+C+H);f.setLittleEndian32(22);f.setLittleEndian32(40);f.setLittleEndian32(v);f.setLittleEndian32(2*z);f.setLittleEndian16(1);f.setLittleEndian16(32);f.setLittleEndian32(0);f.setLittleEndian32(C+H);f.setLittleEndian32(0);
f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);for(h=z-1;0<=h;h--)for(r=0;r<v;r++)z=k[v*h+r],f.setByte(z&255),f.setByte(z>>8&255),f.setByte(z>>16&255),f.setByte(z>>24&255);f="data:image/x-icon;base64,"+hi5.Base64.enc(f.getData())}this.url=f}var O=[],q=null,B=new hi5.graphic.Rectangle(0,0,0,0),N="Uint8ClampedArray"in window,t=null,R=0,F=0,T=0,y=0,M=null,Y,A,Z=0,ja=0;this.width=a;this.height=b;var ra=!1,fa=this,va={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(f){t=
f};this.getDirtyArea=function(){return B};this.setImgRect=function(f,k,h,r){R=f;F=k;T=h;y=r};this.parseMonitorDef=function(f){var k=f.split(","),h=k.length,r=[];if(1<h){for(var v=!1,z=0;z<h;z++){var J=k[z].split(":");if(4==J.length)r[z]=Array(5),r[z][0]=parseInt(J[0]),r[z][1]=parseInt(J[1]),r[z][2]=parseInt(J[2]),r[z][3]=parseInt(J[3]),r[z][4]=0==r[z][0]&&0==r[z][1]?1:0;else{v=!0;break}}v&&(svGlobal.logger.warn("invaiid monitorDef:"+f),r.length=0)}return r};this.setMonitorLayout=function(f){var k=
f.length,h=0;Y=f;for(A=Array(k);h<k;h++)A[h]=new hi5.graphic.Rectangle(0,0,0,0);ja=k};this.setMonitorCount=function(f){ja=f};this.addImg=function(f){T&&(M&&URL.revokeObjectURL(M.src),M=f)};this.flushImgs=function(){M&&(URL.revokeObjectURL(M.src),M=null,T=0)};this.getData=function(){return O};this.pause=function(f,k){ra=f;k&&q&&q.fillRect(0,0,a,b)};this.release=function(){B=null;hi5.Arrays.release(A);fa.flushImgs();O=q=fa=null;va=va.imgData=null};this.isPaused=function(){return ra};this.setContext=
function(f){f!=q&&(q||!f||f.createImageData(1,1).data.buffer||(N=!1),q=f,null!=q&&(va.imgData=q.createImageData(a,b)))};this.getContext=function(){return q};this.resize=function(f,k){if(O.length!=k||O[0].length!=f){for(var h=0;h<k;h++)O[h]=new Uint32Array(f);O.length=k;fa.width=a=f;fa.height=b=k;null!=q&&(va.imgData=q.createImageData(a,b))}};fa.resize(a,b);this.getBuffer=function(){return O};this.setRGB=function(f,k,h){O[k][f]=h|4278190080};this.getRGB=function(f,k){return O[k][f]};this.setRGBs=function(f,
k,h,r,v,z,J){var C=f+h,H=k+r;H>b&&(H=b);if(!(f>=a)){C>a&&(h-=C-a);for(C=k;C<H;C++,z+=J)O[C].set(v.subarray(z,z+h),f);d(f,k,h,r)}};this.moveArea=function(f,k,h,r,v,z){if(0<z){var J=f+v,C=k+z,H;for(H=r-1;0<=H;H--)O[C+H].set(O[k+H].subarray(f,f+h),J)}else if(0>z)for(J=f+v,C=k+z,H=0;H<r;H++)O[C+H].set(O[k+H].subarray(f,f+h),J);else if(0<v){J=f+v;C=k+z;var W;for(H=h-1;0<=H;H--){var E=J+H;var l=f+H;for(W=0;W<r;W++)O[C+W][E]=O[k+W][l]}}else for(J=f+v,C=k+z,H=0;H<h;H++)for(E=J+H,l=f+H,W=0;W<r;W++)O[C+W][E]=
O[k+W][l];d(f+v,k+z,h,r)};this.getRGBs=function(f,k,h,r,v){var z=new Uint32Array(h*r),J=f+h;r=k+r;for(var C=0;k<r;k++)z.set(O[k].subarray(f,J),C),C+=h;return v?(v(z),null):z};this.repaint=function(f,k,h,r){var v=va.imgData.data,z=0,J,C;t&&t.begin("paint");0>f&&(h+=f,f=0);0>k&&(r+=k,k=0);f+h>a&&(h=a-f);k+r>b&&(r=b-k);var H=f+h;var W=k+r;if(N)for(v=new Uint32Array(v.buffer),C=k;C<W;C++)v.set(O[C].subarray(f,H),z),z+=a;else{var E=4*(a-h)|0;for(C=k;C<W;C++){for(J=f;J<H;J++){var l=O[C][J];v[z++]=l&255;
v[z++]=l>>8&255;v[z++]=l>>16&255;v[z++]=255}z+=E}}va.left=f;va.top=k;va.width=h;va.height=r;t&&t.end("paint");return va};this.postPaint=d;this.draw=function(f,k,h,r){if(!ra&&q)if(M&&M.complete&&(q.drawImage(M,R,F,T,y),URL.revokeObjectURL(M.src),M=null),ja){if(f=e(f,k,h,r),f.width)return fa.repaint(f.x,f.y,f.width,f.height),f.width=0,va}else if(B.width)return fa.repaint(B.x,B.y,B.width,B.height),B.width=0,va;return null};this.fillRect=function(f,k,h,r,v){var z=f+h,J=k+r;if(O[0].fill)for(var C,H=k;H<
J;H++)O[H].fill(v,f,z);else for(H=k;H<J;H++)for(C=f;C<z;C++)O[H][C]=v;d(f,k,h,r)};this.drawLine=function(f,k,h,r,v){if(k==r){if(f>h){var z=f;f=h;h=z}var J=O[k];h++;if(J.fill)J.fill(v,f,h);else for(z=f;z<h;z++)J[z]=v}else if(f==h)for(k>r&&(z=k,k=r,r=z),r++,z=k;z<r;z++)O[z][f]=v;else{var C=Math.abs(h-f),H=Math.abs(r-k);z=f;J=k;h=h>=f?f=1:f=-1;k=r>=k?r=1:r=-1;if(C>=H){k=f=0;var W=C;var E=C/2|0;var l=H}else r=h=0,W=H,E=H/2|0,l=C,C=H;if(!(1>C))for(C++,H=0;H<C;H++)O[J][z]=v,E+=l,E>=W&&(E-=W,z+=f,J+=r),
z+=h,J+=k}};this.bitBlt=function(f,k,h,r,v,z,J,C,H,W){var E=fa;switch(f){case 0:C=E.setRGB;for(E=h;E<h+v;E++)for(H=r;H<r+z;H++)C(E,H,0);break;case 1:f=J;H=W*C+H;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<z;E++){for(J=0;J<v;J++)W(h+v,r+z,~(k(h+v,r+z)|f[H])&16777215);H+=C-v}break;case 2:f=J;H=W*C+H;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<z;E++){for(J=0;J<v;J++){var l=k(h+v,r+z);W(h+v,r+z,l&~f[H]&16777215);H++}H+=C-v}break;case 3:g(E,J,C,H,W,v,z);J?E.setRGBs(h,r,v,z,J,W*C+H,C):E.moveArea(H,
W,v,z,h-H,r-W);break;case 4:g(E,null,k,h,r,v,z);m(E,k,h,r,v,z,J,C,H,W);break;case 5:g(E,null,k,h,r,v,z);break;case 6:f=J;H=W*C+H;null==f&&(f=E);for(E=0;E<z;E++){for(W=0;W<v;W++)O[r+E][h+W]=O[r+E][h+W]^f[H]&16777215|4278190080,H++;H+=C-v}break;case 7:f=J;H=W*C+H;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<z;E++){for(J=0;J<v;J++)l=k(h+J,r+E),W(h+J,r+E,~(l&f[H])&16777215),H++;H+=C-v}break;case 8:m(E,k,h,r,v,z,J,C,H,W);break;case 9:f=J;H=W*C+H;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<z;E++){for(J=
0;J<v;J++)l=k(h+J,r+E),W(h+J,r+E,l^~f[H]&16777215),H++;H+=C-v}break;case 10:break;case 11:f=J;H=W*C+H;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<z;E++){for(J=0;J<v;J++)l=k(h+J,r+E),W(h+J,r+E,l|~f[H]&16777215),H++;H+=C-v}break;case 12:J?E.setRGBs(h,r,v,z,J,W*C+H,C):E.moveArea(H,W,v,z,h-H,r-W);break;case 13:g(E,null,k,h,r,v,z);I(E,k,h,r,v,z,J,C,H,W);break;case 14:I(E,k,h,r,v,z,J,C,H,W);break;case 15:C=E.setRGB;for(E=h;E<h+v;E++)for(H=r;H<r+z;H++)C(E,H,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+
f)}d(h,r,v,z)};this.drawLineExt=function(f,k,h,r,v,z){if(f==h||k==r){var J;if(k==r)if(h>f){var C=h-f;if(!(1>C))for(J=0;J<C;J++)x(z,f+J,k,v)}else{if(C=f-h,!(1>C))for(J=0;J<C;J++)x(z,h+J,k,v)}else if(r>k){if(C=r-k,!(1>C))for(J=0;J<C;J++)x(z,f,k+J,v)}else if(C=k-r,!(1>C))for(J=0;J<C;J++)x(z,f,r+J,v)}else{var H=Math.abs(h-f),W=Math.abs(r-k);J=f;C=k;var E,l;var L=h>=f?E=1:E=-1;var Q=r>=k?l=1:l=-1;if(H>=W){Q=E=0;var S=H;var ca=H/2>>0;var ma=W}else l=L=0,S=W,ca=W/2>>0,ma=H,H=W;if(1>H)return;for(W=0;W<=H;W++)x(z,
J,C,v),ca+=ma,ca>=S&&(ca-=S,J+=E,C+=l),J+=L,C+=Q}v=Math.min(f,h);f=Math.max(f,h);h=Math.min(k,r);k=Math.max(k,r);0>f-v||0>k-h||d(v,h,f-v+1,k-h+1)};this.drawText=function(f,k,h,r,v,z,J,C,H,W,E,l,L,Q,S,ca,ma,ya,Ga,Ca,Fa){var za=0;1<l?D(W,E,l,L,v,ya,Ga,Ca,Fa):1==h&&D(z,J,C,H,v,ya,Ga,Ca,Fa);for(var Sa=ca,ua=0;ua<ca;)switch(ma[za+ua]){case 255:var wa=ma[za+ua+2];if(wa>Sa-za){ua=ca=0;break}wa=ma.slice?ma.slice(za,za+wa):ma.subarray(za,za+wa);ba[ma[za+ua+1]]=wa;ua+=3;ca-=ua;za=ua;ua=0;break;case 254:var Na=
(wa=ba[ma[za+ua+1]])?wa:null;Na&&0==Na[1]&&0==(k&32)&&(0!=(k&4)?S+=ma[za+ua+2]:Q+=ma[za+ua+2]);ua=ua+2<ca?ua+3:ua+2;ca-=ua;za=ua;ua=0;if(!Na)break;for(var Xa=Na.length,Za=0;Za<Xa;Za++){wa=pa.getFont(f,Na[Za]);if(0==(k&32)){var $a=Na[++Za];0!=($a&128)?(0!=(k&4)?S+=Na[Za+1]|Na[Za+2]<<8:Q+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(k&4)?S+=$a:Q+=$a}wa&&(G(h,Q+wa.offset&65535,S+wa.baseLine&65535,wa.width,wa.height,wa.fontData,v,r,ya,Ga,Ca,Fa),0!=(k&32)&&(Q+=wa.width))}break;default:wa=pa.getFont(f,ma[za+ua]),0==
(k&32)&&($a=ma[za+ ++ua],0!=($a&128)?(0!=(k&4)?S+=ma[za+ua+1]|ma[za+ua+2]<<8:Q+=ma[za+ua+1]|ma[za+ua+2]<<8,ua+=2):0!=(k&4)?S+=$a:Q+=$a),wa&&(G(h,Q+wa.offset&65535,S+wa.baseLine&65535,wa.width,wa.height,wa.fontData,v,r,ya,Ga,Ca,Fa),0!=(k&32)&&(Q+=wa.width)),ua++}1<l?0<L&&d(W,E,l,L):0<C&&0<H&&d(z,J,C,H)};this.drawBitmap=function(f,k,h,r,v,z,J,C,H){var W=Ia.getBitmap(f,k);W?(f=W.width,k=W.height,v>f&&(v=f),z>k&&(z=k),12==H?fa.setRGBs(h,r,v,z,W.data,C*f+J,f):fa.bitBlt(H,a,h,r,v,z,W.data,f,J,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
f+" idx="+k)};this.saveDesktop=function(f,k,h,r,v){fa.getRGBs(f,k,h,r,function(z){ea.save(f,k,h,r,v,z)})};this.restoreDesktop=function(f,k,h,r,v){(v=ea.restore(f,k,h,r,v))?fa.setRGBs(f,k,h,r,v,0,h):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(f,k,h){pa.putFont(f,k,h)};this.putBitmap=function(f,k,h){Ia.putBitmap(f,k,h)};this.putCursor=function(f,k){na.set(f,k)};this.setCursor=function(f){if(!ra&&-1!=f){var k=na.get(f);if(k)fa.onSetCursor(k);else svGlobal.logger.warn("invalid cursor"+
f)}};var Aa=0;this.isSendingHistory=function(){return 2E3>Date.now()-Aa};this.getHistory=function(f,k){var h=null;(h=na.toPDU())&&f(h.buffer);if(fa.onGetGfxHistory)fa.onGetGfxHistory(f,k);else{t&&t.begin("his_bitmap");Ia.forEach(function(C,H,W){if(C){var E=0,l=0;W=0;for(var L=C.length;W<L;W++)C[W]&&C[W].data&&(E++,l+=C[W].raw?C[W].raw.length:4*C[W].data.length);if(E&&l){h=new Uint8Array(l+20*E+8);h[0]=29;h[2]=1;h[3]=4;l=new hi5.DataBuffer(h,4,h.length);l.setLittleEndian32(E);for(W=0;W<L;W++)(E=C[W])&&
E.data&&(l.setLittleEndian16(H),l.setLittleEndian16(W),l.setLittleEndian16(E.left),l.setLittleEndian16(E.top),l.setLittleEndian16(E.width),l.setLittleEndian16(E.height),l.setLittleEndian16(E.bitsperpixel),l.setLittleEndian16(E.codec),l.setLittleEndian32(E.raw?E.raw.length:4*E.data.length),l.setBytes(E.raw||new Uint8Array(E.data.buffer)));f(h.buffer)}}});t&&t.end("his_bitmap");t&&t.begin("his_font");(h=pa.toPDU())&&f(h.buffer);t&&t.end("his_font");for(var r=4,v=0,z=ba.length;v<z;v++)ba[v]&&(r+=ba[v].length+
6);if(4<r){h=new Uint8Array(r);h[0]=29;h[2]=1;h[3]=7;var J=4;v=0;for(z=ba.length;v<z;v++)ba[v]&&ba[v].length&&(h[J++]=v,h[J++]=v>>8,r=ba[v].length,h[J++]=r,h[J++]=r>>8,h[J++]=r>>16,h[J++]=r>>24,h.set(ba[v],J),J+=r);f(h.buffer)}(h=ea.toPDU())&&f(h.buffer);k();Aa=Date.now()}};this.onHistoryDone=function(){fa.onGetGfxHistory&&p.reconnect(a,b,!0)};this.setHistory=function(f,k){svGlobal.logger.info("setHistory type:"+f);switch(f){case 4:t&&t.begin("his_bitmap_dec");var h=k.getLittleEndian32();for(f=0;f<
h;f++){var r=k.getLittleEndian16(),v=k.getLittleEndian16(),z=k.getLittleEndian16(),J=k.getLittleEndian16(),C=k.getLittleEndian16(),H=k.getLittleEndian16(),W=k.getLittleEndian16(),E=k.getLittleEndian16(),l=k.getLittleEndian32(),L=new Uint8Array(k.getData().buffer,k.getPosition(),l),Q=new Uint8Array(l);Q.set(L);L=rdpcodecs.bitmap;switch(E){case 0:var S=new Uint32Array(Q.buffer);k.skipPosition(l);break;case 1:switch(W){case 16:S=L.decompressInt16(C,H,l,Q,0);break;case 24:S=L.decompressInt24(C,H,l,Q,
0);break;case 32:S=L.decompressInt32(C,H,l,Q,0)}k.skipPosition(l);break;case 2:S=new rdpcodecs.NSCodec,S.process(k,W,C,H),l=S.getData(),S=S.getDataSize(),S=new Uint32Array(S),rdpcodecs.flipimage(l,0,S,C,H,1)}Ia.putBitmap(r,v,new rdpcodecs.Bitmap(S,C,H,z,J,W,0==E?null:Q,E))}t&&t.end("his_bitmap_dec");break;case 5:pa.fromStream(k);break;case 6:na.fromStream(k);break;case 7:for(;k.has(6);)if(f=k.getLittleEndian16(),l=k.getLittleEndian32())h=k.getData().subarray(k.getPosition(),k.getPosition()+l),ba[f]=
h,k.skipPosition(l);break;case 9:ea.fromStream(k);break;default:if(fa.onSetGfxHistory)fa.onSetGfxHistory(f,k)}};var na=new function(){var f=[],k=!1;this.useRemoteCursor=function(h){k=h};this.set=function(h,r){k&&(r.system="");f[h]=r};this.get=function(h){return f[h]};this.total=function(){return f.length};this.toPDU=function(){for(var h=2,r=2,v=0,z=0,J=f.length,C;z<J;z++)if(C=f[z])v++,r=r+7+(C.rawData?C.rawData.length:0);if(!v)return null;r=new Uint32Array(r);r[0]=100728861;r[1]=v;for(z=0;z<J;z++)if(C=
f[z])if(v=C.rawData?C.rawData.length:0,r[h++]=C.cache_idx|C.bpp<<16,r[h++]=C.hotX|C.hotY<<16,r[h++]=C.width|C.height<<16,r[h++]=C.xorSize,r[h++]=C.andSize,r[h++]=C.distance,r[h++]=v)r.set(C.rawData,h),h+=v;return r};this.fromStream=function(h){var r=h.getPosition();h=new Uint32Array(h.getData().buffer,r);var v=h[0],z=0;for(r=1;z<v;z++){var J=h[r]&65535;var C=h[r++]>>16;var H=h[r]&65535;var W=h[r++]>>16;var E=h[r]&65535;var l=h[r++]>>16;var L=h[r++];var Q=h[r++];var S=h[r++];var ca=h[r++];var ma=null;
ca&&(ma=new Uint32Array(ca),ma.set(h.subarray(r,r+ca)),r+=ca);C=new w(J,ma,H,W,E,l,C,L,Q);S&&(C.distance=S);k&&(C.system="");f[J]=C}}};na.useRemoteCursor(!!ha.remoteCursor);var ea=new function(){function f(h,r,v,z,J,C){this.x=h;this.y=r;this.cx=v;this.cy=z;this.offset=J;this.data=C}var k=[];this.save=function(h,r,v,z,J,C){h=new f(h,r,v,z,J,C);r=0;for(v=k.length;r<v;r++)if(!k[r]){k[r]=h;return}k.push(h)};this.restore=function(h,r,v,z,J){for(var C,H=0,W=k.length;H<W;H++)if((C=k[H])&&C.x==h&&C.y==r&&
C.cx==v&&C.cy==z){if(C.offset==J)return h=C.data,k[H]=null,h;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var h=0,r=2,v=0,z=k.length;v<z;v++)k[v]&&(h++,r+=k[v].data.length+6);if(!h||!r)return null;r=new Uint32Array(r);var J=2;r[0]=151060509;r[1]=h;for(v=0;v<z;v++)if(h=k[v])r[J++]=h.x,r[J++]=h.y,r[J++]=h.cx,r[J++]=h.cy,r[J++]=h.offset,r[J++]=h.data.length,r.set(h.data,J),J+=h.data.length;return r};this.fromStream=function(h){h=new Uint32Array(h.getData().buffer,h.getPosition());
for(var r=1,v=h[0],z,J,C,H,W,E,l,L=0;L<v;L++)z=h[r++],J=h[r++],C=h[r++],H=h[r++],W=h[r++],E=h[r++],l=new Uint32Array(E),E=r+E,l.set(h.subarray(r,E)),r=E,this.save(z,J,C,H,W,l)}},ba=[],pa=new function(){var f=[];this.putFont=function(k,h,r){f[k]||(f[k]=[]);f[k][h]=r};this.getFont=function(k,h){return f[k]?f[k][h]:null};this.toPDU=function(){var k=0,h,r,v;var z=4;for(var J,C=f.length;k<C;k++)if((v=f[k])&&v.length)for(J=v.length,h=0;h<J;h++)(r=v[h])&&(z+=15+r.fontData.length);if(5>z)return null;var H=
new Uint8Array(z);z=new hi5.DataBuffer(H,0,z);H[0]=29;H[2]=1;H[3]=5;z.skipPosition(4);k=0;for(C=f.length;k<C;k++)if((v=f[k])&&v.length)for(J=v.length,h=0;h<J;h++)if(r=v[h])z.setByte(k),z.setLittleEndian16(h),z.setLittleEndian16(r.offset),z.setLittleEndian16(r.baseLine),z.setLittleEndian16(r.width),z.setLittleEndian16(r.height),z.setLittleEndian32(r.fontData.length),z.setBytes(r.fontData);return H};this.fromStream=function(k){for(;k.has(15);){var h=k.getByte(),r=k.getLittleEndian16(),v=k.getLittleEndian16(),
z=k.getLittleEndian16(),J=k.getLittleEndian16(),C=k.getLittleEndian16(),H=k.getLittleEndian32();H=k.getBytes(H);this.putFont(h,r,new u(v,z,J,C,H))}}},Ia=new function(){var f=[],k=[];this.putBitmap=function(h,r,v){if(32767==r)k[h]&&(k[h].data=null,k[h]=null),k[h]=v;else{var z=f[h];z?z[r]&&(z[r].data=null,z[r]=null):f[h]=z=[];z[r]=v}};this.getBitmap=function(h,r){return 32767==r?k[h]:f[h]?f[h][r]:null};this.forEach=function(h){for(var r=f.length,v=0;v<r;v++)h(f[v],v,f)}}}function Lb(a){function b(l,
L,Q){L[Q]=l>>24&255;L[Q+1]=l>>16&255;L[Q+2]=l>>8&255;L[Q+3]=l&255}function c(l,L){var Q=l.length;L=new Uint8Array(L?Q+1:Q);for(var S=0;S<Q;S++)L[S]=l.charCodeAt(S);return L}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),g={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],
smhd:[],mehd:[]},m=this,I=1,x=a?48E3:9E4,D=1,G=!1,u=null;this.initTypes=function(){for(var l in g)g[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)];g.url=[117,114,108,32]};m.initTypes();this.reset=function(){G=!1;D=I=1};this.close=function(){m&&(m.reset(),m=null)};this.remux=function(l){l.id=I;l.isAudio=a;l.timeScale=a?l.audioHeader.sampleRate:x;if(!G){var L=new O(a),Q=new q(l);u=new Uint8Array(L.data.length+Q.data.length);u.set(L.data,0);u.set(Q.data,L.data.length);G=!0}l.sequenceNumber=
D++;L=new v(l);Q=new E(l);l=new Uint8Array(L.data.length+Q.data.length);l.set(L.data,0);l.set(Q.data,L.data.length);u&&(L=new Uint8Array(u.length+l.length),L.set(u,0),L.set(l,u.length),l=L,u=null);if(m.ondata)m.ondata(l)};var w=function(l){this.type=l;this.data=null};w.prototype.setData=function(){var l=Array.prototype.slice.call(arguments,0),L=l.length,Q=8,S;for(S=0;S<L;S++)Q+=l[S].byteLength;this.data=new Uint8Array(Q);b(Q,this.data,0);this.data.set(this.type,4);Q=8;for(S=0;S<L;S++)this.data.set(l[S],
Q),Q+=l[S].byteLength};var O=function(l){var L=w.call(this,g.ftyp)||this;var Q=c("mp42"),S=c("mp41"),ca=c("isom"),ma=c("avc1"),ya=c("iso5"),Ga=new Uint8Array([0,0,2,0]);l?L.setData(Q,Ga,Q,S,ca,ya):L.setData(ca,Ga,ca,S,ya,ma);return L};$jscomp.inherits(O,w);var q=function(l){var L=w.call(this,g.moov)||this;var Q=new B(l),S=new N(l);l=new h(l);L.setData(Q.data,S.data,l.data);return L};$jscomp.inherits(q,w);var B=function(l){l=w.call(this,g.mvhd)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,
0]),S=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array(4);b(1E3,ma,0);var ya=new Uint8Array([0,1,0,0]),Ga=new Uint8Array([1,0]),Ca=new Uint8Array(10),Fa=new Uint8Array(36);Fa[1]=1;Fa[17]=1;Fa[32]=64;var za=new Uint8Array(24),Sa=new Uint8Array([255,255,255,255]);l.setData(L,Q,S,ca,ma,e,ya,Ga,Ca,Fa,za,Sa);return l};$jscomp.inherits(B,w);var N=function(l){var L=w.call(this,g.trak)||this;var Q=new t(l);l=new R(l);L.setData(Q.data,l.data);return L};$jscomp.inherits(N,w);var t=function(l){var L=
w.call(this,g.tkhd)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,7]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array([0,0,0,0]),ya=new Uint8Array(4);b(l.id,ya,0);var Ga=new Uint8Array(4),Ca=new Uint8Array(8),Fa=new Uint8Array([0,0]),za=new Uint8Array([0,0]),Sa=l.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),ua=new Uint8Array(2),wa=new Uint8Array(36);wa[1]=1;wa[17]=1;wa[32]=64;var Na=new Uint8Array(4);Na[0]=l.width>>8&255;Na[1]=l.width&255;Na[2]=0;Na[3]=0;var Xa=new Uint8Array(4);Xa[0]=
l.height>>8&255;Xa[1]=l.height&255;Xa[2]=0;Xa[3]=0;L.setData(Q,S,ca,ma,ya,Ga,e,Ca,Fa,za,Sa,ua,wa,Na,Xa);return L};$jscomp.inherits(t,w);var R=function(l){var L=w.call(this,g.mdia)||this;var Q=new F(l),S=new T(l);l=new y(l);L.setData(Q.data,S.data,l.data);return L};$jscomp.inherits(R,w);var F=function(l){var L=w.call(this,g.mdhd)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array([0,0,0,0]),ya=new Uint8Array(4);b(l.timeScale,ya,0);l=new Uint8Array([85,
196]);var Ga=new Uint8Array(2);L.setData(Q,S,ca,ma,ya,e,l,Ga);return L};$jscomp.inherits(F,w);var T=function(l){var L=w.call(this,g.hdlr)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);l=l.isAudio?c("soun"):c("vide");var ma=new Uint8Array(12),ya=c("Remote Spark Handler",!0);L.setData(Q,S,ca,l,ma,ya);return L};$jscomp.inherits(T,w);var y=function(l){var L=w.call(this,g.minf)||this;var Q=new A,S=new ra(l);l.isAudio?(l=new Y,L.setData(l.data,Q.data,S.data)):(l=new M,L.setData(l.data,
Q.data,S.data));return L};$jscomp.inherits(y,w);var M=function(){var l=w.call(this,g.vmhd)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,1]),S=new Uint8Array([0,0]),ca=new Uint8Array(6);l.setData(L,Q,S,ca);return l};$jscomp.inherits(M,w);var Y=function(){var l=w.call(this,g.smhd)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),S=new Uint8Array([0,0]),ca=new Uint8Array(2);l.setData(L,Q,S,ca);return l};$jscomp.inherits(Y,w);var A=function(){var l=w.call(this,g.dinf)||this;var L=new Z;
l.setData(L.data);return l};$jscomp.inherits(A,w);var Z=function(){var l=w.call(this,g.dref)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,1]),ca=new ja;l.setData(L,Q,S,ca.data);return l};$jscomp.inherits(Z,w);var ja=function(){var l=w.call(this,g.url)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,1]);l.setData(L,Q);return l};$jscomp.inherits(ja,w);var ra=function(l){var L=w.call(this,g.stbl)||this;l=new fa(l);var Q=new pa,S=new Ia,ca=new f,ma=new k;L.setData(l.data,
Q.data,S.data,ca.data,ma.data);return L};$jscomp.inherits(ra,w);var fa=function(l){var L=w.call(this,g.stsd)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,1]);l.isAudio?(l=new va(l),L.setData(Q,S,ca,l.data)):(l=new na(l),L.setData(Q,S,ca,l.data));return L};$jscomp.inherits(fa,w);var va=function(l){var L=w.call(this,g.mp4a)||this;var Q=new Uint8Array(6),S=new Uint8Array([0,1]),ca=new Uint8Array(8),ma=new Uint8Array([0,2]),ya=new Uint8Array([0,16]),Ga=new Uint8Array([0,
0]),Ca=new Uint8Array(2),Fa=l.audioHeader.sampleRate,za=new Uint8Array(4);za[0]=Fa>>8&255;za[1]=Fa&255;za[2]=0;za[3]=0;l=new Aa(l);L.setData(Q,S,ca,ma,ya,Ga,Ca,za,l.data);return L};$jscomp.inherits(va,w);var Aa=function(l){var L=w.call(this,g.esds)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array([3]),ma=new Uint8Array([25]),ya=new Uint8Array([0,0]),Ga=new Uint8Array([0]),Ca=new Uint8Array([4]),Fa=new Uint8Array([17]),za=new Uint8Array([64]),Sa=new Uint8Array([21]),ua=new Uint8Array(3),
wa=l.bufferSizeDB;ua[0]=wa>>16&255;ua[1]=wa>>8&255;ua[2]=wa&255;wa=new Uint8Array(4);b(l.bitRate,wa,0);var Na=new Uint8Array(4);b(l.bitRate,Na,0);var Xa=new Uint8Array([5]),Za=new Uint8Array([2]),$a=l.audioHeader.audioType||2,ab=l.audioHeader.frequencyIdx,ub=l.audioHeader.channelConfig;l=new Uint8Array(2);l[0]=$a<<3|ab>>1&7;l[1]=(ab&1)<<7|ub<<3;$a=new Uint8Array([6]);ab=new Uint8Array([1]);ub=new Uint8Array([2]);L.setData(Q,S,ca,ma,ya,Ga,Ca,Fa,za,Sa,ua,wa,Na,Xa,Za,l,$a,ab,ub);return L};$jscomp.inherits(Aa,
w);var na=function(l){var L=w.call(this,g.avc1)||this;var Q=new Uint8Array(6),S=new Uint8Array([0,1]),ca=new Uint8Array([0,0]),ma=new Uint8Array(2),ya=new Uint8Array(12),Ga=new Uint8Array(2);Ga[0]=l.width>>8&255;Ga[1]=l.width&255;var Ca=new Uint8Array(2);Ca[0]=l.height>>8&255;Ca[1]=l.height&255;var Fa=new Uint8Array([0,72,0,0]),za=new Uint8Array([0,72,0,0]),Sa=new Uint8Array(4),ua=new Uint8Array([0,1]),wa=c("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=wa.length;Na.set(wa,1);wa=new Uint8Array([0,
24]);var Xa=new Uint8Array([255,255]);l=new ea(l);L.setData(Q,S,ca,ma,ya,Ga,Ca,Fa,za,Sa,ua,Na,wa,Xa,l.data);return L};$jscomp.inherits(na,w);var ea=function(l){var L=w.call(this,g.avcC)||this;var Q=new Uint8Array([1]),S=new Uint8Array([l.sps[1]]),ca=new Uint8Array([l.sps[2]]),ma=new Uint8Array([l.sps[3]]),ya=new Uint8Array([255]),Ga=new Uint8Array([225]),Ca=new Uint8Array(2),Fa=l.sps.byteLength;Ca[0]=Fa>>8&255;Ca[1]=Fa&255;Fa=new Uint8Array(l.sps);var za=new Uint8Array([1]),Sa=new Uint8Array(2),ua=
l.pps.byteLength;Sa[0]=ua>>8&255;Sa[1]=ua&255;l=new Uint8Array(l.pps);L.setData(Q,S,ca,ma,ya,Ga,Ca,Fa,za,Sa,l);return L};$jscomp.inherits(ea,w);var ba=function(){var l=w.call(this,g.btrt)||this;var L=new Uint8Array([0,28,156,128]),Q=new Uint8Array([0,45,198,192]),S=new Uint8Array([0,45,198,192]);l.setData(L,Q,S);return l};$jscomp.inherits(ba,w);var pa=function(){var l=w.call(this,g.stts)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]);l.setData(L,Q,S);return l};
$jscomp.inherits(pa,w);var Ia=function(){var l=w.call(this,g.stsc)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]);l.setData(L,Q,S);return l};$jscomp.inherits(Ia,w);var f=function(){var l=w.call(this,g.stsz)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]);l.setData(L,Q,S,ca);return l};$jscomp.inherits(f,w);var k=function(){var l=w.call(this,g.stco)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,
0,0]),S=new Uint8Array([0,0,0,0]);l.setData(L,Q,S);return l};$jscomp.inherits(k,w);var h=function(l){var L=w.call(this,g.mvex)||this;l=new r(l);L.setData(l.data);return L};$jscomp.inherits(h,w);ba=function(l){l=w.call(this,g.mehd)||this;var L=new Uint8Array([0]),Q=new Uint8Array([0,0,0]);l.setData(L,Q,d);return l};$jscomp.inherits(ba,w);var r=function(l){var L=w.call(this,g.trex)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l.id,ca,0);l=new Uint8Array([0,0,0,1]);
var ma=new Uint8Array([0,0,0,0]),ya=new Uint8Array([0,0,0,0]),Ga=new Uint8Array([0,0,0,0]);L.setData(Q,S,ca,l,ma,ya,Ga);return L};$jscomp.inherits(r,w);var v=function(l){var L=w.call(this,g.moof)||this;z.setSequenceNumber(l.sequenceNumber);l=new J(l);L.setData(z.data,l.data);return L};$jscomp.inherits(v,w);ba=function(l){var L=w.call(this,g.mfhd)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);L.setData(Q,S,ca);return L};$jscomp.inherits(ba,w);ba.prototype.setSequenceNumber=
function(l){b(l,this.data,12)};var z=new ba(1),J=function(l){var L=w.call(this,g.traf)||this;C.setTrackId(l.id);C.setSampleDuration(l.frameDuration);H.setBaseMediaDecodeTime(l.samples[0].timestamp);var Q=32+C.data.length+H.data.length;if(l.isAudio)l=new W(l,null,Q);else{for(var S=[],ca=0;ca<l.samples.length;ca++){var ma=l.samples[ca];S.push({size:ma.unitsLength+4*ma.units.length,duration:l.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:ma.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,
isNonSync:ma.hasIDR?0:1,degradationPriority:0}})}l=new W(l,S,Q)}L.setData(C.data,H.data,l.data);return L};$jscomp.inherits(J,w);ba=function(l,L){var Q=w.call(this,g.tfhd)||this;Q.isAudio=L;var S=new Uint8Array([0]),ca=L?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),ma=new Uint8Array(4);b(l,ma,0);L?(l=new Uint8Array([0,0,0,1]),L=new Uint8Array(4),b(1024,L,0),Q.setData(S,ca,ma,l,L)):(l=new Uint8Array([0,0,2,0,1,1,0,0]),Q.setData(S,ca,ma,l));return Q};$jscomp.inherits(ba,w);ba.prototype.setTrackId=
function(l){b(l,this.data,12)};ba.prototype.setSampleDuration=function(l){this.isAudio||b(l,this.data,16)};var C=new ba(0,a);ba=function(l){var L=w.call(this,g.tfdt)||this;var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);L.setData(Q,S,ca);return L};$jscomp.inherits(ba,w);ba.prototype.setBaseMediaDecodeTime=function(l){b(l,this.data,12)};var H=new ba(0),W=function(l,L,Q){var S=w.call(this,g.trun)||this;var ca=new Uint8Array([0]),ma=l.isAudio?new Uint8Array([0,2,1]):
new Uint8Array([0,15,1]),ya=l.isAudio?4:16;Q+=ya*(l.isAudio?l.samples.length:L.length)+28;var Ga=new Uint8Array(4);l.isAudio?b(l.samples.length,Ga,0):b(L.length,Ga,0);var Ca=new Uint8Array(4);b(Q,Ca,0);if(l.isAudio){Q=new Uint8Array(ya*l.samples.length);for(var Fa=0;Fa<l.samples.length;Fa++)b(l.samples[Fa].aacData.byteLength,Q,ya*Fa)}else for(Q=new Uint8Array(ya*L.length),Fa=0;Fa<L.length;Fa++){l=L[Fa];var za=ya*Fa;b(l.duration,Q,za);b(l.size,Q,za+4);var Sa=l.flags,ua=new Uint8Array(4);ua[0]=Sa.isLeading<<
2|Sa.dependsOn;ua[1]=Sa.isDependedOn<<6|Sa.hasRedundancy<<4|0|Sa.isNonSync;ua[2]=Sa.degradationPriority&61440;ua[3]=Sa.degradationPriority&15;Q.set(ua,za+8);b(l.compositionTimeOffset,Q,za+12)}S.setData(ca,ma,Ga,Ca,Q);return S};$jscomp.inherits(W,w);ba=function(l){var L=w.call(this,g.sdtp)||this;for(var Q=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(l.length),ma=0;ma<l.length;ma++){var ya=l[ma].flags;ca[ma]=ya.isLeading<<6|ya.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy}L.setData(Q,
S,ca);return L};$jscomp.inherits(ba,w);var E=function(l){var L=w.call(this,g.mdat)||this;if(l.isAudio){for(var Q=new Uint8Array(l.totalByteLength),S=0,ca=0;ca<l.samples.length;ca++){var ma=l.samples[ca].aacData;Q.set(ma,S);S+=ma.byteLength}L.setData(Q)}else{Q=new Uint8Array(4*l.unitNum+l.totalByteLength);for(ca=S=0;ca<l.samples.length;ca++){ma=l.samples[ca];for(var ya=0;ya<ma.units.length;ya++){var Ga=ma.units[ya],Ca=Ga.data.byteLength;b(Ca,Q,S);S+=4;Q.set(Ga.data,S);S+=Ca}}L.setData(Q)}return L};
$jscomp.inherits(E,w)}function pc(a){function b(D,G){this.aacData=D;this.timestamp=G}function c(D,G,u,w){this.audioType=D;this.frequencyIdx=G;this.sampleRate=u;this.channelConfig=w}var e=pc.SAMPLING_FREQUENCY,d=null,g=!0,m=this,I=0;this.reset=function(){I=0;d=null;x.audioHeader=null;a&&a.reset()};var x=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=
this.bitRate=this.duration=0}};this.setMediaFormat=function(D,G){var u=D.frequencyIdx;u||(u=e.indexOf(D.sampleRate));-1==u&&console.error("Invalid AAC sampel rate: "+D.sampleRate);d=new c(D.audioType||2,u,D.sampleRate,D.channels||D.channelConfig);x.audioHeader=d;g=!G;if(m.oncodec)m.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(D){if(g){var G=m.readADTSHeader(D);D=D.subarray(G)}G=new b(D,I);I+=1024;x.samples.push(G);x.totalByteLength+=D.byteLength;D=1/(d.sampleRate/1024);x.duration=
D;x.samples[0]&&(x.bitRate=8*x.samples[0].aacData.length/D|0);a&&a.remux(x);x.clear()};this.readADTSHeader=function(D){var G=D[1]&0?9:7,u=(D[2]>>6&3)+1,w=D[2]>>2&15,O=e[w];O||console.error("Invalid Sampling Frequency Index: "+w);var q=((D[2]&1)<<2)+(D[3]>>6&3),B=D[1]>>1&3;0!=B&&console.error("Invalid data format: layer is not 0x00: "+B.toString(16));D.length!=((D[3]&3)<<11)+(D[4]<<3)+(D[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+D.length);if(d){if(w!=d.frequencyIdx&&(d.frequencyIdx=
w,d.sampleRate=O,m.oncodec))m.oncodec("mp4a.40.2",d)}else if(d=new c(u,w,O,q),x.audioHeader=d,m.oncodec)m.oncodec("mp4a.40.2",d);return G}}function Tc(a){function b(){if(0==I)console.error("no more ExpGolomb data");else{var G=0,u=m-I;for(x=0;u<m;){var w=a[u];if(3!=w||0!=a[u-1]||0!=a[u-2])x=x<<8|w,G++;u++;if(4<=G)break}4>G&&(x<<=4-G);D=8*G;I=m-u}}function c(G){if(!(D>G)){G-=D;var u=G>>3;G-=u>>3;I-=u;b()}x<<=G;D-=G}function e(G){var u=Math.min(D,G),w=x>>>32-u;32<G&&logger.error("Read more than 32 bits:"+
G);D-=u;0<D?x<<=u:0<I&&b();u=G-u;return 0<u?w<<u|e(u):w}function d(){var G;for(G=0;G<D;++G)if(0!==(x&2147483648>>>G))return x<<=G,D-=G,G;b();return G+d()}function g(){c(1+d())}var m=a.byteLength,I=m,x=0,D=0;this.readUEG=function(){var G=d();return e(G+1)-1};this.readEG=function(){var G=this.readUEG();return 1&G?1+G>>>1:-1*(G>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=
function(G){var u=8,w=8,O;for(O=0;O<G;O++)0!==w&&(w=this.readEG(),w=(u+w+256)%256),u=0===w?u:w};this.readSPS=function(){var G=0,u=0,w=0,O=0,q=1,B,N=0,t=!0;if(7>a.length)return console.log("no enought SPS data"),null;var R=this.readU8();if(7!=(R&31))return console.error("Invalid SPS type: "+R,a),null;R=this.readU8();e(5);c(3);this.readU8();g();if(100===R||110===R||122===R||244===R||44===R||83===R||86===R||118===R||128===R||138===R||139===R||134===R||135===R){var F=this.readUEG();3===F&&c(1);g();g();
c(1);if(this.readBool()){var T=3!==F?8:12;for(B=0;B<T;B++)this.readBool()&&(6>B?this.skipScalingList(16):this.skipScalingList(64))}}g();B=this.readUEG();if(0===B)this.readUEG();else if(1===B)for(c(1),c(1+d()),c(1+d()),T=this.readUEG(),B=0;B<T;B++)c(1+d());g();c(1);var y=this.readUEG();B=this.readUEG();T=e(1);0===T&&c(1);c(1);this.readBool()&&(G=this.readUEG(),u=this.readUEG(),w=this.readUEG(),O=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var M=[1,1];break;
case 2:M=[12,11];break;case 3:M=[10,11];break;case 4:M=[16,11];break;case 5:M=[40,33];break;case 6:M=[24,11];break;case 7:M=[20,11];break;case 8:M=[32,11];break;case 9:M=[80,33];break;case 10:M=[18,11];break;case 11:M=[15,11];break;case 12:M=[64,33];break;case 13:M=[160,99];break;case 14:M=[4,3];break;case 15:M=[3,2];break;case 16:M=[2,1];break;case 255:M=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}M&&(q=M[0]/M[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&
c(24));this.readBool()&&(g(),g());this.readBool()&&(N=this.readU32(),M=this.readU32(),t=this.readBool(),N=M/(2*N))}q=Math.ceil((16*(y+1)-2*G-2*u)*q);M=(2-T)*(B+1)*16-(T?2:4)*(w+O);B="avc1."+(0==a[1]?"00":a[1].toString(16));B+=0==a[2]?"00":a[2].toString(16);B+=0==a[3]?"00":a[3].toString(16);return{width:q,height:M,profileIdc:R,chromaFormatIdc:F,frameCropLeftOffset:G,frameCropRightOffset:u,frameCropTopOffset:w,frameCropBottomOffset:O,fps:N,fixedFrameRate:t,codec:B}};this.readSliceType=function(){this.readU8();
this.readUEG();return this.readUEG()}}function Md(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=I;this.unitsLength=x;this.timestamp=d;this.hasIDR=g}function e(){var w=!1;if(m&&G.sps){var O=new c;d+=G.frameDuration||3E3;G.samples.push(O);G.totalByteLength+=x;G.unitNum+=I.length;
G.sequence++;w=!0;if(O.hasIDR&&u.onkeyframe)u.onkeyframe(O)}m=g=!1;I=[];x=0;return w}var d=0,g=!1,m=!1,I=[],x=0,D=Lb.searchStartCode,G=null,u=this;G=new b;this.reset=function(){d=0;g=!1;I=[];x=0;G=new b;a&&a.reset()};this.close=function(){u&&(u.reset(),u=null)};this.parseH264Data=this.parse=function(w){for(var O=[],q=0,B,N,t,R=[0,0];q<w.byteLength;){R[0]=q;D(w,R);var F=R[0];if(-1==F)break;q=R[1];q=F+q;t=w[q];t&=31;B&&(B={type:N,data:w.subarray(B,F)},O.push(B));B=q;N=t}B&&(B={type:N,data:w.subarray(B,
w.byteLength)},O.push(B));for(w=0;w<O.length;w++)switch(R=O[w],q=R.type,q){case 1:case 2:case 3:case 4:I.push(R);x+=R.data.byteLength;m=!0;break;case 5:m=g=!0;I.push(R);x+=R.data.byteLength;break;case 6:break;case 7:q=new Tc(R.data);if(q=q.readSPS()){if(G.width=q.width,G.height=q.height,G.codec=q.codec,G.sps=R.data,q.fps&&(G.frameDuration=9E4/q.fps|0),I.push(R),x+=R.data.byteLength,u.oncodec)u.oncodec(G.codec,q)}else console.log("corrupted sps",R.data);break;case 8:G.pps=R.data;I.push(R);x+=R.data.byteLength;
break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+q)}e()&&G.sps&&(a.remux(G),G.clear())}}function Mb(a,b,c){function e(){for(;x;){if(N.updating){x=!1;break}var F=I.shift();if(!F)break;try{N.appendBuffer(F),D=0}catch(T){I.unshift(F);if("QuotaExceededError"==T.name)if(m(!0))continue;else{if(G.onerror)G.onerror(T);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),G.close();break}D++;console.error("Failed to append buffer, retry "+D,T);if(2<D){if(G.onerror)G.onerror(T);
break}}}}function d(){x=!0;e()}function g(){N=B.addSourceBuffer(u);N.mode="sequence";N.addEventListener("updateend",d);N.addEventListener("error",function(F){console.error(F)});x=!0;G.play(!1);e()}function m(F){var T=Math.min(a.played.end(0),N.buffered.end(0)),y=0,M=q.length,Y=!1,A=0;if(c)A=T-180,0>A&&console.warn("Not possible, time played secs: "+T);else if(1<M){var Z=M-2;for(T=9E4*T|0;y<M;){if(q[y]>T){Z=y-2;break}y++}0<=Z&&(A=(q[Z]+1E3)/9E4)}if(0<A)try{N.remove(0,A),q.splice(0,Z+1),Y=!0,console.info("Buffer removed "+
A+" isAudio: "+c)}catch(ja){console.warn("Buffer removal "+A+" failed, retry, isAudio: "+c)}F||(O=setTimeout(m,18E4));return Y}var I=[],x=!1,D=0,G=this,u="",w=null,O=0,q=[],B=null,N=null,t=null,R=null;a.autoplay=!0;this.getKeyFrames=function(){return q};t=new Lb(c);t.ondata=function(F){I.push(F);e()};R=c?new pc(t):new Md(t);R.onkeyframe=function(F){q.push(F.timestamp)};R.oncodec=function(F,T){var y=c?"audio/mp4;codecs=":"video/mp4;codecs=";y+=F;if(y!=u||(c?w.sampleRate!=T.sampleRate:w.width!=T.width||
w.height!=T.height))if(u=y,w=T,x=!1,N=null,B=new MediaSource,B.addEventListener("sourceopen",g),a.src=URL.createObjectURL(B),G.onsps)G.onsps(T)};b.onvideoframe=function(F){R.parse(F)};b.onaudioframe=function(F){R.parse(F)};b.onendofstream=function(){G.reset()};this.play=function(F){a.play().catch(function(T){if(!F&&(console.error(T),G.onplayerror))G.onplayerror(T)})};this.reset=function(){console.log("Reset player");O&&(clearTimeout(O),O=0);q.length=0;x=!1;u="";w=null;R&&R.reset();I.length=0};this.close=
function(){G&&(G.reset(),B&&"open"==B.readyState&&(B.endOfStream(),a.src=null),R&&R.close&&R.close(),t&&t.close&&t.close(),G=null)};this.setMediaFormat=function(F,T){R.setMediaFormat&&R.setMediaFormat(F,T)};this.getMediaSource=function(){return B};this.getMediaSourceBuffer=function(){return N};a.addEventListener("ended",function(F){console.warn(".... ended");O&&(clearTimeout(O),O=0)});a.addEventListener("emptied",function(F){x=!!N});a.addEventListener("pause",function(F){console.warn(".... paused");
x=!!N;var T=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+T)}).catch(function(y){console.error(y)})});a.addEventListener("waiting",function(F){x=!!N})}function Nd(a,b,c){function e(u){var w=u.codec;if(w!=d||(b?I.sampleRate!=u.sampleRate:I.width!=u.width||I.height!=u.height))if(console.log("Codec: "+w+" audio: "+b),d=w,I=u,m||(m=new VideoDecoder({output:function(O){var q=x.length;if(q){for(var B=O.timestamp;q&&x[0]<B;)x.shift(),q--;if(q&&x[0]==B){x.shift();
O.close();return}}g.onframedecoded&&g.onframedecoded(O);O.close()},error:function(O){console.error("Decoder error:",O)}})),m.configure({codec:d,codedWidth:u.width,codedHeight:u.height,hardwareAcceleration:c||"no-preference"}),g.onsps)g.onsps(u)}var d=null,g=this,m,I=null,x=[],D={type:"delta",data:null,timestamp:0},G=0;a.onvideoframe=function(u,w){var O=0;var q=[0,0],B=u.length,N=!1;var t=null;for(var R=!1;O<B;){q[0]=O;Lb.searchStartCode(u,q);var F=q[0];if(-1==F)break;F+=q[1];O=F+1;var T=u[F]&31;switch(T){case 1:case 2:case 3:case 4:break;
case 5:N=!0;break;case 6:break;case 7:(t=(new Tc(u.subarray(F))).readSPS())||(R=!0);break;case 8:break;case 9:break;default:console.log("nal type:"+T)}}O=N;if(R)console.log("corrupted: "+G,u);else if(t&&e(t),I)a:{D.type=O?"key":"delta";D.data=u;D.timestamp=G;if(w){if(!O)break a;x.push(G)}G+=10;u=new EncodedVideoChunk(D);m.decode(u)}};this.play=function(u){};this.reset=function(){console.log("Reset MediaDecoder");I=d=null;G=0;x.length=0;m&&m.reset()&&m.close();m=null};this.close=function(){g.reset();
m&&(m.close(),m=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Kb=!1,lb={},jb={},Ab=null,p=this,lc=!1,Wa=!1,db=0,Bb=null,Uc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ha=hi5.appcfg,Ib="";this.setConfig=function(a){ha=a};var cb=
"object"==typeof n?n:null,P=cb?{}:hi5.tool.queryToObj(n.substring(n.indexOf("?")+1));void 0==P.mapClipboard&&ha.clipboard&&void 0!=ha.clipboard.enabled&&(P.mapClipboard=ha.clipboard.enabled);P.hardwareAcceleration||(P.hardwareAcceleration=ha.hardwareAcceleration);void 0==ha.enableDVCAudio&&(ha.enableDVCAudio=!0);var Ja=0,Ka=0,gb=(ka||P.color||P.server_bpp||16)|0,nc=null,Vc=null,Pa=null,Hb=null,Wc="/DOWNLOAD?",Xc="/CLIP?";24==gb&&(gb=16);var Va="app"==P.startProgram,Jb=U(P.mapDisk),mb=0;this.setLinks=
function(a){a.download&&(Wc=a.download);a.clipboard&&(Xc=a.clipboard)};this.protocol=cb?"":n.substring(0,n.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return U(P.smartCard)||U(P.mapSmartCard)||U(P.passwordIsPin)};this.enableWebAuthn=function(){return U(P.enableWebAuthn)||U(P.useWebAuthn)};this.hasScanner=function(){return U(P.scanner)};this.hasUSB=function(){return U(P.mapUSB)&&!!navigator.usb};this.getUSB=function(){return P.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},
{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Vc=a};this.getProfiler=function(){return Vc};this.gateway=function(){if(cb)return"";var a=n.lastIndexOf("/RDP?");-1==a&&(a=n.lastIndexOf("/JOIN?"));-1==a&&(a=n.lastIndexOf("/PLAY?"));return n.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);
this.getGatewayAddr=ta;var kb="object"==typeof n||0<n.indexOf("/PLAY?"),qc=!kb&&0<n.indexOf("invitation=");if(qc){var rc=decodeURIComponent(n),Nb=rc.indexOf(' USERNAME="');if(0<Nb){Nb+=11;var Od=rc.substring(Nb,rc.indexOf('"',Nb));n+="&novice="+Od}n+="&mapClipboard=on";P.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,cb?n="":(Ja=640,Ka=480),n+="&touchpad=on",P.touchpad="on",this.reconnectOnResize=!1;else if(0<n.indexOf("/JOIN?")||qc)this.mode=2,this.reconnectOnResize=!1;var sc=U(P.gfx)||
U(P.remotefx)||0<p.mode;sc&&(Va||qc?(sc=!1,P.remotefx=!1):gb=32);K?Ja=parseInt(K):P.width&&(Ja=parseInt(P.width));V?Ka=parseInt(V):P.height&&(Ka=parseInt(P.height));-1==Ja&&(Ja=hi5.browser.getScreenWidth());-1==Ka&&(Ka=hi5.browser.getScreenHeight());P.symlink&&P.parameters&&hi5.tool.queryToObj(P.parameters,P);P.gateway||(n+="&gateway="+encodeURIComponent(p.gateway));!P.minWidth&&ha.minWidth&&(P.minWidth=ha.minWidth);!P.minHeight&&ha.minHeight&&(P.minHeight=ha.minHeight);P.minWidth&&(P.minWidth=parseInt(P.minWidth));
P.minHeight&&(P.minHeight=parseInt(P.minHeight));P.waWidth=P.waWidth?parseInt(P.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;P.waWidth&=-4;P.waHeight=P.waHeight?parseInt(P.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;P.waHeight&=-4;"useSSL"in P||(n+="&useSSL="+("wss"==p.protocol));hi5.storage.isAvailable&&(U(P.shareClipboard)||P.shareClipboardId)&&(n+="&shareClipboardId="+(P.shareClipboardId||
X()));ha&&(void 0!=ha.displayMsg?this.displayMsg=ha.displayMsg:ha.displayMsg=this.displayMsg,ha.appTimeout&&(this.appTimeout=ha.appTimeout),void 0!=ha.reconnectOnResize&&(this.reconnectOnResize=ha.reconnectOnResize),ha.reconnectTimes&&(this.reconnectTimes=ha.reconnectTimes),void 0!=ha.windowState&&(this.windowState=ha.windowState),void 0!=ha.openLink&&(this.openLink=ha.openLink),void 0!=ha.setTitle&&(this.setTitle=ha.setTitle),"boolean"==typeof ha.useWSS&&(n=(ha.useWSS?"wss":"ws")+n.substring(n.indexOf("://"))),
"boolean"==typeof ha.remoteAppLogin&&(this.remoteAppLogin=ha.remoteAppLogin,Kb=!ha.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ha.hideLogin&&(Kb=ha.hideLogin),void 0!=ha.localPrinter&&void 0==P.localPrinter&&(P.localPrinter=ha.localPrinter));var Ma=null;void 0==ha.useWorker&&(ha.useWorker=!1);ha.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&
(ha.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var La=ha.useWorker?new Worker(qa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,tb=this.reconnectTimes,$b=La?{type:5,data:null}:null;this.getDisplayName=aa;this.server=aa();this.port=parseInt(P.port,10);this.loadbalanceToken="";ha.loadbalanceTokenName&&(P[ha.loadbalanceTokenName]?ia(P[ha.loadbalanceTokenName]):!1!==ha.randomAppId?ia(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){p.loadbalanceToken&&
(a+=-1==a.indexOf("?")?"?"+p.loadbalanceToken:"&"+p.loadbalanceToken,a+="&loadbalanceTokenName="+ha.loadbalanceTokenName);return a};this.getURL=function(){return n};this.getRuntimeURL=function(){var a=n+"&width="+Ja+"&height="+Ka+"&server_bpp="+gb+"&audio="+(Ta.available||hi5.browser.isIE),b=Dc(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=P.monitorDef,d=P.monitor,g=0;b=da.size();var m=Array(b);c=Array(b);var I=0,x=0,D=0,G=0,u=0,w=0,O="";if(e){c=oa.parseMonitorDef(e);for(b=
c.length;g<b;g++){var q=c[g];q[0]<D&&(D=q[0]);q[1]<G&&(G=q[1]);q[2]>u&&(u=q[2]);q[3]>w&&(w=q[3])}0>D&&(I=-D);0>G&&(x=-G);q=0>d?[D,G,u,w]:c[d];P.width=q[2]-q[0]+1;P.height=q[3]-q[1]+1;g=da.getSurface(0);g.setMonitor(q[0],q[1],q[2],q[3]);if(I||x)for(q=g.getMousePosition(),q.left+=I,q.right+=I,q.top+=x,q.bottom+=x,g=0;g<b;g++)q=c[g],q[0]+=I,q[1]+=x,q[2]+=I,q[3]+=x;oa.setMonitorLayout(c);0>d&&oa.setMonitorCount(0);p.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+P.width+"&height="+P.height}else{if(1<
b&&!Va){for(da.verifyMonitors();g<b;g++)e=da.getSurface(g),q=e.getMousePosition(),q.left<D&&(D=q.left),q.top<G&&(G=q.top),q.right>u&&(u=q.right),q.bottom>w&&(w=q.bottom),m[g]=q,O&&(O+=","),O+=q.left+":"+q.top+":"+q.right+":"+q.bottom;0>D&&(I=-D);0>G&&(x=-G);for(g=0;g<b;g++){q=da.getSurface(g).getMousePosition();if(I||x)q.left+=I,q.right+=I,q.top+=x,q.bottom+=x;c[g]=[q.left,q.top,q.right,q.bottom,q.left==I&&q.top==x?1:0]}oa.setMonitorLayout(c);p.reconnectOnResize=!1}O&&(svGlobal.logger.warn("MonitorDef:"+
O),P.width=u-D+1,P.height=w-G+1,O="&monitorDef="+O+"&width="+P.width+"&height="+P.height);b=O}a+=b;0>n.indexOf("waWidth")&&(b=(b=da.getFocused())?b.getWindow():window,a+="&waWidth="+P.waWidth+"&waHeight="+P.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;P.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());P.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==P.soundPref&&(P.soundPref=0,a+="&soundPref=0");
I=c=b="";for(I in lb)x=lb[I],"flags"in x&&(b&&(b+=",",c+=","),b+=x.name,c+=x.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(I in jb)x=jb[I],"flags"in x&&(b&&(b+=","),b+=x.name);b&&(a+="&gwChannelName="+b);if(c=td())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);P.audioRecord=U(P.audioRecord)&&hi5.audio.recordable;Ea.init(b,sc,P.audioRecord,P.soundPref,U(P.mapCamera)&&!!navigator.mediaDevices,
U(P.mapUSB)&&!!navigator.usb);P.audioRecord&&(a+="&audioRecord=on");P.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ea.count&&(a+="&dvcChannels="+Ea.names.join(","));a+="&binary=on";ha.existingFile&&(a+="&existingFile="+ha.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ta());a=p.modifyURL(a);ha.copyTextOnly&&U(P.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&
(a+="&_keyboard="+b);U(P.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Cd()};this.getColor=function(){return gb};this.changeTitle=la;hi5.browser.isTouch&&Math.max(Ja,Ka)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Ba=null,Ha=!1,pb=!1,oc=!1,Ta=new function(){function a(x){c&&(d&&d.disconnect(),g&&g.disconnect());hi5.audio.releaseAudioContext();x||(I&&(I.close(),I=null),m&&(m.pause(),
m=null))}function b(x){console.error("play error: ",x)}var c=null;this.supportWebAudio=this.available=!1;(0==P.playSound||0<p.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(x){return c.createBuffer(2,x,Da.samplePerSec)};var e=0,d=null,g=null;this.setVolume=function(x){1==x?d=null:(d||(d=c.createGain()),d.gain.value=x)};this.playBuffer=function(x){g=c.createBufferSource();g.buffer=x;d?
(g.connect(d),d.connect(c.destination)):g.connect(c.destination);var D=c.currentTime,G=0<e?e:D;G<D&&(G=D);e=G+x.duration;g.start?g.start(G):g.noteOn(G);return e-D};this.iOSFix=function(){if(c){var x=this.getBuffer(1024),D=c.createBufferSource();D.buffer=x;D.connect(c.destination);D.start?D.start(0):D.noteOn(0)}};this.close=a;var m=null,I=null;this.onaudioframe=null;this.initMediaPlayer=function(x,D,G){a(!0);m||(m=document.createElement("audio"));I||(I=new Mb(m,x,!0),I.onplayerror=b,I.onerror=function(u){console.error("Not possible audio error",
u)},svGlobal.logger.info("MediaPlayer init, headerless: "+G+" sampleRate:"+D.sampleRate));I.setMediaFormat(D,G);I.play(!1)}},Jd=Ta.available,oa=new xc(200,200);oa.onSetCursor=Ic;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Xb=0,Wb=0,Yb=Ja-1,Zb=Ka-1,mc="";window.$rdp||(window.$rdp=this);xa(gb);this.setResolution=Oa;this.running=function(){return Ha};this.setJoinMode=function(a){Ha&&sa("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&sa("8EB3\t"+a)};this.refuseControl=
function(a){Ha&&sa("8E3"+a)};this.giveControl=function(a){Ha&&sa("8E4"+a)};this.pauseSession=function(a,b){Ha&&sa("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ha&&sa("8EB2\t"+a)};this.requestControl=function(){Ha&&sa("8E2")};this.saveSession=function(a){Ha&&sa("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&sa("8EA"+a+"\t"+(b?1:0))};var Cb=new function(){function a(){if(c&&0<c.length){var g=c.shift();g.key?Cb.sendSingleKey(g.down,g.key):g.char&&rb(g.char);
0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(g,m){var I=
b[m.toLowerCase()];I?p.writeScancode(g,I):(I=m.length,0!=I&&(1==I?p.writeKeyCode(g,m.toUpperCase().charCodeAt(0)):g&&p.writeText(m)))};var c=null,e=0,d=null;this.sendKeyComb=function(g,m,I){if(Wa){g=g.split("+");var x=g.length,D;if(0!=x){var G=null,u=[];for(D=0;D<x;D++){var w=g[D];""==w&&""==G&&(w="Add");""!=w&&u.push({key:w,down:!0});G=w}x=u.length;for(D=x-1;0<=D;D--)u.push({key:u[D].key,down:!1});if(m)c=u,e=m,d=I,a();else for(D=0,x=u.length;D<x;D++)Cb.sendSingleKey(u[D].down,u[D].key)}}};this.sendText=
function(g,m,I){for(var x=[],D=0,G=g.length;D<G;D++)x.push({"char":g.charAt(D)});c=x;e=m;d=I;a()}};this.writeKeyComb=function(a,b,c){Wa&&Cb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Wa)if(b)Cb.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)rb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),p.writeRawInput("880"+b+"\t"+a.hashCode()),Bb={type:b,text:a})};var da=new function(a,b){function c(){function d(u){for(;0<u.ownerWinid;){var w=D.getWinById(u.ownerWinid);if(w&&
w.isVisible())u=w;else break}return u}function g(u){for(var w="";u;)u.titleInfo&&(w=u.titleInfo),u=D.getWinById(u.ownerWinid);return w}var m=[],I=[],x=0,D=this;this.mainWin=null;this.appId="";var G=0;this.getActiveWinId=function(){return G};this.setActiveWinId=function(u,w){svGlobal.logger.info("setActiveWinId: "+u+" old: "+G+" max: "+w);if(G!=u){var O=0==G;G=u;(u=D.getMainByWinId(u))&&u.isMainWin()&&D.mainWin!=u&&(D.mainWin=u);O&&w&&(w=da.getFocused())&&(w=w.getFreeSpace(),u=w.width,p.resetSize(u,
w.height))}};this.onchange=function(u){u.isVisible()||u!=D.mainWin?u.isVisible()&&!D.mainWin&&u.isMainWin()&&(D.mainWin=u,3==a.windowState&&u.exeCommand(61488)):D.mainWin=null};this.addWin=function(u){for(var w=m.length,O=!1,q=0;q<w;q++)if(u.id==m[q].id){m[q]=u;O=!0;break}O||m.push(u);1==m.length&&(x=Date.now());w=u.isMainWin();svGlobal.logger.info("is mainwin:"+w+" id:"+u.id);w&&!D.mainWin&&(D.mainWin=u)};this.popWins=function(u){u=D.getWinById(u);var w=[];if(u){u=0<u.ownerWinid?u.ownerWinid:u.id;
for(var O=m.length-1;0<=O;O--)if(m[O].ownerWinid==u||m[O].id==u)w.push(m[O]),m.splice(O,1)}return w};this.hasApp=function(u){return-1!=I.indexOf(u)};this.addApp=function(u){return-1==I.indexOf(u)?(I.push(u),!0):!1};this.isNew=function(){return 3E4>Date.now()-x};this.getAll=function(){return m};this.hasWin=function(u){return 0<=m.indexOf(u)};this.close=function(){for(var u=0,w=m.length;u<w;u++)m[u].close()};this.clear=function(){m.length=0};this.delWin=function(u){for(var w=0,O=m.length;w<O;w++)if(m[w].id==
u)return m.splice(w,1),w;return-1};this.isRunning=function(){var u=m.length;if(1>u)return!1;var w=0;for(u=m.length;w<u;w++){var O=m[w];if(O.showState)return!0}return!1};this.getWinById=function(u){var w=m.length;if(1>w)return null;for(var O=0;O<w;O++){var q=m[O];if(q.id==u)return q}return null};this.getMainWinByAppId=function(u){var w=null,O=0;for(len=m.length;O<len;){w=m[O];if(w.appId==u&&w.isVisible()&&1>w.ownerWinid)break;O++}return w};this.getTopWin=function(u){var w=null,O,q=u.length;for(O=0;O<
q&&(!(w=D.getWinById(u[O]))||!w.isVisible());O++)w=null;if(!w)for(svGlobal.logger.warn("No win found"),q=m.length,O=q-1;0<=O&&(w=m[O],!w.isVisible());O--)w=null;return w};this.getMain=function(u){return(u=D.getTopWin(u))?d(u):null};this.getMainByWinId=function(u){return(u=D.getWinById(u))?d(u):null};this.getOtherApps=function(u,w,O){var q=m.length;if(0!=q&&m[q-1])if(q=m[q-1].appId,O||!q)setTimeout(function(){D.getOtherApps(u,w)},O||3E3);else{O=[];if(q=D.getTopWin(u)){var B=0<q.ownerWinid?q.ownerWinid:
q.id,N=[],t=0;for(q=m.length;t<q;t++)m[t].ownerWinid!=B&&m[t].id!=B&&m[t].isVisible()&&N.push(m[t]);t=0;for(q=N.length;t<q;t++)N[t].ownerWinid!=B&&N[t].id!=B&&(O.push({title:g(N[t]),win:d(N[t])}),B=0<N[t].ownerWinid?N[t].ownerWinid:N[t].id)}w(O)}};this.getFullTitle=function(u){for(var w,O="";;){w=D.getWinById(u);if(!w)break;w.titleInfo&&w.isVisible()&&(O&&(O=" > "+O),O=w.titleInfo+O);if(1>u)break;u=w.ownerWinid}return O}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=
e.length,g=0;g<d;g++)e[g].railWin&&e[g].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,g=Array(d),m=0;m<d;m++)e[m].configMonitor(),g[m]=e[m].getMousePosition();g.sort(function(D,G){var u=D.left-G.left;return 0!=u?u:D.top-G.top});var I=g.findIndex(function(D){return 0==D.left&&0==D.top});svGlobal.logger.info("monitor layout",g,I);-1==I&&(p.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",
g));for(m=I-1;0<=m;){if(g[m].right<g[m+1].left){var x=g[m+1].left-g[m].right-1;0<x&&(g[m].right+=x,g[m].left+=x)}g[m].bottom<g[m+1].top&&(x=g[m+1].top-g[m].bottom-1,0<x&&(g[m].top+=x,g[m].bottom+=x));m--}for(m=I+1;m<d;)g[m-1].right<g[m].left&&(x=g[m].left-g[m-1].right-1,0<x&&(g[m].right-=x,g[m].left-=x)),g[m-1].bottom<g[m].top&&(x=g[m].top-g[m-1].bottom-1,0<x&&(g[m].top-=x,g[m].bottom-=x)),m++};this.repaint=function(d,g,m,I){for(var x=0,D=e.length;x<D;x++)e[x].repaint(d,g,m,I)};this.size=function(){return e.length};
this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var g=e.length,m=0;m<g;m++)if(e[m].equals(d))return!0;return!1};this.getMonitorSurface=function(d,g,m,I){var x=e.length;if(1==x)return e[0];for(var D=0;D<x;D++)if(e[D].isMonitor(d,g,m,I))return e[D];return null};this.fromSyncedSurface=function(d){var g=e.length;Date.now();for(var m=0;m<g;m++)if(e[m].isClipSynced(d))return!0;return!1};this.setSize=function(d,g,m){for(var I=0,x=e.length;I<
x;I++)e[I].setSize(d,g,m)};this.zOrders=[];this.drawLicense=function(d){for(var g=0,m=e.length;g<m;g++)e[g].drawLicense(d)};this.setReadOnly=function(d,g){for(var m=0,I=e.length;m<I;m++)e[m].setReadOnly(d,g)};this.setVisible=function(d,g){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var g=0,m=e.length;g<m;g++)e[g]&&e[g].setCursor(d)};this.hide=function(d){d=0;for(var g=e.length;d<g;d++)e[d]&&e[d].hide()};this.execute=function(d,g){for(var m=0,I=e.length;m<I;m++)e[m][d].apply(e[m],
g)};this.addWin=function(d){var g=this.getFocused();g||(svGlobal.logger.warn("Focused surface not found!"),g=e[e.length-1]);g?(Va=!0,g.railWin||(g.railWin=new c,g.onunload=function(){hi5.appcfg.closeRemoteApp&&g.railWin&&g.railWin.close();g.remoteApp&&g.remoteApp.close();g.railWin&&(g.railWin.clear(),g.railWin=null);e.removeElm(g)}),g.context&&b.setContext(g.context),g.railWin.addWin(d),g.railWin.mainWin==d&&(setTimeout(function(){var m=g.getFreeSpace();a.writeRawInput("8C661441\t"+m.width+"\t"+m.height);
svGlobal.logger.info("-- main win dp change:"+m.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Qa.sendKeyboardSyncFlags(Qa.localLockFlags,500)),hi5.browser.isIE&&g.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var g,m=e.length-1;0<=m;m--){var I=e[m];g=I.railWin;var x=g.getWinById(d),
D=x&&x.appId&&-1!=x.appId.toLowerCase().indexOf("runonce");if(0<=g.delWin(d)){x==g.mainWin&&(g.mainWin=null);if(I.toolbar){d="win"+d;var G=I.toolbar.querySelector("#"+d);G&&I.toolbar.removeChild(G)}if(!g.isRunning()&&0==p.mode){if(x.isMainWin()&&I.onremoteappclose)I.onremoteappclose(x);x=a.appTimeout;if(D||g.isNew())x*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(u){return function(){svGlobal.logger.info("Start del:"+Date.now());u.railWin&&u.railWin.isRunning()||(u.remoteApp&&
u.remoteApp.close(),da&&da.delSurface(u))}}(I),x)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var g,m=0,I=e.length;m<I;m++)if(e[m]&&e[m].railWin&&(g=e[m].railWin.getWinById(d)))return g;return null};this.getMainWinByAppId=function(d){for(var g,m=0,I=e.length;m<I;m++)if(e[m].railWin&&(g=e[m].railWin.getMainWinByAppId(d)))return g;return null};this.onWinChange=function(d){for(var g,m=0,I=e.length;m<I;m++)if(e[m].railWin&&(g=e[m].railWin.getWinById(d.id)))e[m].railWin.onchange(d)};
this.setTitle=function(d){for(var g,m=0,I=e.length;m<I;m++)if(e[m].railWin){g=e[m].railWin.getWinById(d);var x=e[m].railWin.getFullTitle(d);if(x){a.changeTitle(x,e[m].getWindow(),g.appId);break}}};this.hasApp=function(d){for(var g=0,m=e.length;g<m;g++)if(e[g].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var g=
0,m=e.length;g<m;g++)if(e[g].railWin&&e[g].railWin.hasWin(d))return e[g];return null};this.getOwnerSurfaceById=function(d){for(var g,m=0,I=e.length;m<I;m++)if(e[m].railWin&&(g=e[m].railWin.getWinById(d)))return e[m];return null};this.getFocused=function(){for(var d=e.length,g=0;g<d;g++)if(e[g].focused)return e[g];return e[d-1]};this.close=function(){for(var d=0,g=e.length;d<g;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function g(){a.writeRawInput("8C0"+
d)}this.id=d;this.appId="";var m=this;this.resizable=function(){return m.isVisible?0!=(m.style&262144)||0!=(m.style&65536)||0!=(m.style&16777216)||3==m.showState:!1};this.setShowState=function(I){m.showState=I};this.parent=function(){return da.getWinById(m.ownerWinid)};this.resize=function(I,x,D,G){svGlobal.logger.info("www resize, l "+I+" w "+D);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+m.id+"\t"+I+"\t"+x+"\t"+D+"\t"+G)};this.exeCommand=function(I){svGlobal.logger.info("www exeCommand, cmd "+
I);a.writeRawInput("8C4"+d+"\t"+I)};this.activate=function(I){svGlobal.logger.info("www activate, enable "+I+" id:"+d);2==m.showState?(m.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+I)},50)):a.writeRawInput("8C3"+d+"\t"+I)};this.close=function(){svGlobal.logger.info("www close");m.exeCommand(61536)};this.getAppId=g;this.isVisible=function(){return m.winWidth&&m.winHeight&&m.showState&&45<m.winHeight&&45<m.winWidth};this.isMainWin=function(){if(!(m.isVisible()&&m.winWidth&&
m.winHeight&&45<m.winHeight&&45<m.winWidth))return!1;var I=1>m.ownerWinid;if(!I)return I;var x=m.style;if(0!=(x&4194304))return!0;if(0!=(x&2147483648)&&(0==(x&8388608)||0==(x&12582912)))return!1;var D=0!=(m.extStyle&128);(I=I&&!D)&&0!=(x&2147483648)&&0==(x&2156396544)&&(I=!1);return I};g()}}(p,oa);this.getSurfaces=function(){return da};this.hide=function(){da&&da.hide()};this.getFileUrl=function(a,b,c){var e=ta(),d=Wc,g=d.indexOf("://");e=(0<g&&11>g?d:e+d)+"s="+mc+"&f="+encodeURIComponent(a);b&&(e+=
"&src="+b);c&&(e+="&action="+c);return p.modifyURL(e)};this.listFiles=function(a,b){Ma&&Wa&&Ma.list(a,b)};this.writeRawInput=function(a){if(Wa){sa(a);if(p.onactivity)p.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);sa(e.buffer)};var Yc=0;if(ha.numLock||ha.numlock||U(P.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Yc|=2;var Qa=new function(a,
b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};
this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var g=d.getFreeSpace(),m=g.width;g=g.height;Qa.checkLockFlags=!0;ha.scale?d.scaleTo(m,g,!1):a.resetSize(m,g)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,
g){this.reqCopyTime=Date.now();var m=a.getGatewayAddr(),I=Xc,x=I.indexOf("://");m=(0<x&&11>x?I:m+I)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(m),g);this.reqCopyTime=Date.now();Qc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,g,m){a.reconnectOnResize=!1;var I=a.getFileUrl(d,g,m);p.ondownload&&p.ondownload({fileName:d,url:I,source:g,action:m})||window.open(I)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return n};this.reconnect=
function(d,g,m){P.symlink?(d="user="+d+"&pwd="+g,m&&(d+="&domain="+m),n=hi5.tool.replaceQuery(n,"parameters",d)):(n=hi5.tool.replaceQuery(n,"user",d),n=hi5.tool.replaceQuery(n,"pwd",g),n=hi5.tool.replaceQuery(n,"domain",m));a.run()};this.sendKeyboardSyncFlags=function(d,g){return Wa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},g||333),!0):!1};this.sendKeyboardSynchronize=function(d,g,m){var I=0;m&&(I|=4);g&&(I|=2);d&&(I|=1);this.sendKeyboardSyncFlags(I)};
this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,g){a.authWithCode(d,g)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(p,Yc),Pd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,g){return a.repaint(c,e,d-c+1,g-e+1)};
this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+c.id))}}(oa,da);this.sendKeyboardSynchronize=function(a,b,c){Qa.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new ob(143)};this.GatewayChannel=function(){return new ob(28)};this.DynamicChannel=function(){return new ob(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=
function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Ea.names.push(a.name);Ea[a.name]=a;Ea.count++};var Ra=null,Ea={count:0,names:[],usbChannel:null,close:function(){for(var a=Ea.names,b=0,c=a.length;b<c;b++)Ea[a[b]].onclose&&(Ea[a[b]].onclose(),Ea[a[b]]=null);a.length=0;Ea.usbChannel=null},init:function(a,b,c,e,d,g){function m(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=
41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var q=this;this.fromBuffer=function(B,N){q.formatTag=B.getLittleEndian16();q.nChannels=B.getLittleEndian16();q.nSamplesPerSec=B.getLittleEndian32();q.nAvgBytesPerSec=B.getLittleEndian32();q.nBlockAlign=B.getLittleEndian16();q.bitsPerSample=B.getLittleEndian16();var t=B.getLittleEndian16();q.cbSize=t;0<t&&!0!==N&&(q.extenstion=Array(t),B.copyToByteArray(q.extenstion,
0,B.getPosition(),t),B.skipPosition(t))};this.toBuffer=function(B){B.setLittleEndian16(q.formatTag);B.setLittleEndian16(q.nChannels);B.setLittleEndian32(q.nSamplesPerSec);B.setLittleEndian32(q.nAvgBytesPerSec);B.setLittleEndian16(q.nBlockAlign);B.setLittleEndian16(q.bitsPerSample);B.setLittleEndian16(q.cbSize);0<q.cbSize&&B.setBytes(q.extenstion)};this.getSize=function(){return 18+q.cbSize};this.toString=function(){return"Audio Format, tag="+q.formatTag+" nChannels="+q.nChannels+" nSamplesPerSec="+
q.nSamplesPerSec+" nAvgBytesPerSec="+q.nAvgBytesPerSec+" nBlockAlign="+q.nBlockAlign+" bitsPerSample="+q.bitsPerSample+" cbSize="+q.cbSize}}function I(){Ra=new p.DynamicChannel;Ra.name="Microsoft::Windows::RDS::DisplayControl";Ra.enabled=!1;Ra.process=function(q){var B=q.getLittleEndian32();q.getLittleEndian32();switch(B){case 5:B=q.getLittleEndian32(),Ra.maxMonitorAreaFactorA=q.getLittleEndian32(),Ra.maxMonitorAreaFactorB=q.getLittleEndian32(),Ra.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+
B+" factorA:"+Ra.maxMonitorAreaFactorA+" factorB:"+Ra.maxMonitorAreaFactorB),q=new Uint8Array(2),q[0]=146,q[1]=4,sa(q.buffer),Pa&&setTimeout(function(){Pa&&Pa.check(5E3)},1900)}};Ra.applyResolution=function(q,B){if(Ra.enabled){var N=new Uint8Array(56),t=new RdpBuffer(N,0,56);q=q>Ra.maxMonitorAreaFactorA?Ra.maxMonitorAreaFactorA:q&-4;B=B>Ra.maxMonitorAreaFactorB?Ra.maxMonitorAreaFactorB:B&-4;t.setLittleEndian32(2);t.setLittleEndian32(56);t.setLittleEndian32(40);t.setLittleEndian32(1);t.setLittleEndian32(1);
t.setLittleEndian32(0);t.setLittleEndian32(0);t.setLittleEndian32(q);t.setLittleEndian32(B);t.setLittleEndian32(.26458*q|0);t.setLittleEndian32(.26458*B|0);t.setLittleEndian32(q>B?0:90);t.setLittleEndian32(100);t.setLittleEndian32(100);Ra.send(N);svGlobal.logger.warn("Display control: "+q+"x"+B)}else svGlobal.logger.warn("Display control disabled.")};return Ra}if(!ha.disableDVC){if(ha.enableEcho){var x=new p.DynamicChannel;x.name="ECHO";x.process=function(q){var B=q.getPosition(),N=q.getEnd(),t=new Uint8Array(N-
B);t.set(q.getData().subarray(B,N));x.send(t)};p.addDynamicChannel(x)}if(a){var D=new p.DynamicChannel;D.name="Microsoft::Windows::RDS::Input";D.process=function(q){var B=q.getLittleEndian16();q.getLittleEndian32();switch(B){case 1:q.skipPosition(4),q=new RdpBuffer(new Uint8Array(16),0,16),q.setLittleEndian16(2),q.setLittleEndian32(16),q.setLittleEndian32(3),q.setLittleEndian32(65536),q.setLittleEndian16(256),q.markEnd(),D.send(q);case 5:da.execute("setTouchRemoting",[!0]);Ea.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:da.execute("setTouchRemoting",[!1]),Ea.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};p.addDynamicChannel(D)}if(c){svGlobal.logger.warn("Audio input on");var G=new p.DynamicChannel;(function(){function q(A){var Z=new RdpBuffer(new Uint8Array(5),0,5);Z.setByte(7);Z.setLittleEndian32(A);Z.markEnd();G.send(Z)}function B(A){var Z=A.getLittleEndian32(),ja=A.getLittleEndian32(),ra=new m;ra.fromBuffer(A,!0);var fa=0,va=0;0<ra.cbSize&&(22==ra.cbSize?(fa=A.getLittleEndian16(),
va=A.getLittleEndian32(),A.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+ra.cbSize),A.skipPosition(ra.cbSize)));A=t[ja];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+Z+" initial: "+ja+", "+A.toString());svGlobal.logger.info("Open fmt: "+ra.toString()+" validBits:"+fa+" mask:"+va);F=!0;T=p.reconnectOnResize;p.reconnectOnResize=!1;Y.onopen||(Y.onopen=function(Aa){if(Ha){N=Aa;p.reconnectOnResize=T;q(ja);var na=new RdpBuffer(new Uint8Array(5),0,5);na.setByte(4);na.setLittleEndian32(Aa?
0:1);na.markEnd();G.send(na)}});Y.ondata||(Y.ondata=function(Aa,na){N&&(y.length!=na+1&&(y=new Uint8Array(na+1),y[0]=6),G.send(R),y.set(Aa,1),G.send(y))});Y.start(A,Z)}G.name="AUDIO_INPUT";G.process=function(A){var Z=A.getByte();switch(Z){case 1:A=A.getLittleEndian32();Z=new RdpBuffer(new Uint8Array(5),0,5);Z.setByte(1);Z.setLittleEndian32(A);Z.markEnd();G.send(Z);break;case 2:var ja=A.getLittleEndian32();A.getLittleEndian32();var ra=hi5.audio.getAudioContext().sampleRate;for(Z=t.length=0;Z<ja;Z++){var fa=
new m;fa.fromBuffer(A);svGlobal.logger.info("Server rec fmt "+Z+":"+fa.toString());0==e&&49==fa.formatTag&&22050==fa.nSamplesPerSec?t.push(fa):1==fa.formatTag&&fa.nSamplesPerSec<=ra&&t.push(fa)}G.send(R);ja=0;A=t.length;for(Z=0;Z<A;Z++)ja+=t[Z].getSize();ra=new RdpBuffer(new Uint8Array(1024),0,1024);ra.setByte(2);ra.setLittleEndian32(A);ra.setLittleEndian32(ja+9);for(Z=0;Z<A;Z++)t[Z].toBuffer(ra),svGlobal.logger.info("Client rec fmt: "+t[Z].toString());ra.skipPosition(1024-ja-9);ra.markEnd();G.send(ra);
break;case 3:B(A);break;case 7:Z=A.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+t[Z].toString()+" by client:"+F);F||(q(Z),F=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+Z)}};var N=!1,t=[];G.onclose=function(){N=!1;Y&&Y.close()};var R=new Uint8Array(1);R[0]=5;var F=!1,T=p.reconnectOnResize,y=new Uint8Array(0),M=qa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),Y=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),
M):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();p.addDynamicChannel(G)}p.addDynamicChannel(function(){var q=new p.DynamicChannel;q.name="TSMF";var B={type:"image/jpeg"},N=Array(1);q.process=function(t){t.getPosition();var R=t.getLittleEndian32()&1073741823;var F=t.getLittleEndian32();var T=t.getLittleEndian32();switch(R){case 2:if(256==T){t.getLittleEndian32();T=new Uint8Array(16);var y=new RdpBuffer(T,0,16);y.setLittleEndian32(2);y.setLittleEndian32(F);y.setLittleEndian32(1);y.setLittleEndian32(0);
q.send(T)}break;case 0:switch(T){case 257:t.getBytes(16);t.getLittleEndian32();break;case 256:R=t.getPosition();y=t.getLittleEndian32();for(T=0;T<y;T++){t.getLittleEndian32();var M=t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(M-4)}T=t.getPosition()-R;y=T+8+4;T=new Uint8Array(y);y=new RdpBuffer(T,0,y);y.setLittleEndian32(-2147483648);y.setLittleEndian32(F);T.set(t.getData().subarray(R,t.getPosition()),8);q.send(T);break;case 261:t.getBytes(16);t.getLittleEndian32();break;case 264:R=t.getLittleEndian32();
t.skipPosition(4);t.getLittleEndian32();M=t.getBytes(16);var Y=t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.getLittleEndian32();var A=t.getBytes(16);T=t.getLittleEndian32();t.skipPosition(T);T=new Uint8Array(20);y=new RdpBuffer(T,0,20);y.setLittleEndian32(-2147483648);y.setLittleEndian32(F);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],M)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],Y)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,
1,0,170,0,85,89,90],A)?y.setLittleEndian32(1):(y.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(M),svGlobal.logger.warn(Y),svGlobal.logger.warn(A));y.setLittleEndian32(R);q.send(T);break;case 258:t.getBytes(16);t.getLittleEndian32();R=t.getLittleEndian32();t.skipPosition(R);break;case 263:t.getBytes(16),T=new Uint8Array(16),y=new RdpBuffer(T,0,16),y.setLittleEndian32(-2147483648),y.setLittleEndian32(F),y.setLittleEndian32(1),q.send(T);case 277:t.getBytes(16);
t.getLittleEndian32();break;case 262:t.getBytes(16);oa.flushImgs();oa.setImgRect(0,0,0,0);T=new Uint8Array(12);y=new RdpBuffer(T,0,12);y.setLittleEndian32(-2147483648);y.setLittleEndian32(F);q.send(T);break;case 278:t.getBytes(16);F=t.getLittleEndian32();T=t.getLittleEndian32();R=t.getLittleEndian32();t=t.getLittleEndian32();oa.setImgRect(F,T,R-F,t-T);break;case 265:t.getBytes(16);t.getLittleEndian64();t.getLittleEndian32();break;case 266:t.getBytes(16);break;case 268:t.getBytes(16);break;case 267:t.getBytes(16);
break;case 269:t.getBytes(16);t.getLittleEndian32();break;case 274:break;case 275:break;case 259:t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(32);T=t.getLittleEndian32();F=new Image;R=t.getPosition();N[0]=t.getData().subarray(R,R+T);t=new Blob(N,B);F.src=URL.createObjectURL(t);oa.addImg(F);break;case 270:oa.flushImgs();break;case 273:break;case 260:break;case 276:t.getBytes(16);T=t.getLittleEndian32();R=t.getPosition()+T;t.skipPosition(8);F=t.getLittleEndian32();svGlobal.logger.info("window state:"+
F);y=t.getLittleEndian32();M=t.getLittleEndian32();F=t.getLittleEndian32();T=t.getLittleEndian32();t.skipPosition(8);Y=t.getLittleEndian32();A=t.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+F+" top:"+T+" w:"+y+" h:"+M+" cl:"+Y+" ct:"+A);t.setPosition(R);R=t.getLittleEndian32();for(R=t.getPosition()+R;t.getPosition()<R;){Y=t.getLittleEndian32();A=t.getLittleEndian32();var Z=t.getLittleEndian32(),ja=t.getLittleEndian32();svGlobal.logger.info("visible region, l:"+A+" t:"+Y+" r:"+ja+
" b:"+Z)}oa.setImgRect(F,T,y,M);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+T)}break;default:svGlobal.logger.warn("unkown interface:"+R)}};return q}());kb||p.addDynamicChannel(I());ha.enableDVCAudio&&p.addDynamicChannel(function(q){var B=!1,N=0,t=0,R=0,F=0,T=[],y=new Uint8Array(4),M=new p.DynamicChannel;M.name="AUDIO_PLAYBACK_DVC";M.onclose=function(){};M.process=function(Y){function A(ea){ea.skipPosition(14);var ba=ea.getLittleEndian16();ea.getByte();var pa=ea.getLittleEndian16();
ea.skipPosition(1);for(var Ia,f=T.length=0;f<ba;f++){var k=new m;k.fromBuffer(ea);(Ia=22050<=k.nSamplesPerSec&&(1==k.formatTag||49==k.formatTag&&22050==k.nSamplesPerSec&&0==q||41222==k.formatTag))&&T.push(k)}k=20;ea=T.length;for(f=0;f<ea;f++)k+=T[f].getSize();f=k+4;ba=new RdpBuffer(new Uint8Array(f),0,f);ba.setByte(7);ba.setByte(2);ba.setLittleEndian16(k);ba.setLittleEndian32(3);ba.setLittleEndian32(4294967295);ba.setLittleEndian32(0);ba.setLittleEndian16(0);ba.setLittleEndian16(ea);ba.skipPosition(1);
ba.setLittleEndian16(pa);ba.setByte(124);for(f=0;f<ea;f++)k=T[f],k.toBuffer(ba);ba.markEnd();M.send(ba);5<pa&&(ba=new RdpBuffer(new Uint8Array(8),0,8),ba.setByte(12),ba.skipPosition(1),ba.setLittleEndian16(4),ba.setLittleEndian16(0),ba.setLittleEndian16(0),ba.markEnd(),M.send(ba))}function Z(ea){var ba=ea.getLittleEndian16();ea=ea.getLittleEndian16();var pa=new RdpBuffer(new Uint8Array(8),0,8);pa.setByte(6);pa.setByte(35);pa.setLittleEndian16(4);pa.setLittleEndian16(ba);pa.setLittleEndian16(ea);pa.markEnd();
M.send(pa)}function ja(){var ea=T[R];if(ea.formatTag!=Da.tag||ea.nSamplesPerSec!=Da.samplePerSec||Da.channels!=ea.nChannels)Da.tag=ea.formatTag,Da.channels=ea.nChannels,Da.samplePerSec=ea.nSamplesPerSec,Da.bitsPerSample=49==ea.formatTag?8:ea.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec),41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!0))}function ra(ea){t=ea.getLittleEndian16();
R=ea.getLittleEndian16();F=ea.getByte();ea.skipPosition(3);y.set(ea.getSubarray(4));B=!0;ja()}function fa(ea,ba){var pa=new RdpBuffer(new Uint8Array(8),0,8);pa.setByte(5);pa.skipPosition(1);pa.setLittleEndian16(4);pa.setLittleEndian16(ea);pa.setByte(ba);pa.skipPosition(1);pa.markEnd();M.send(pa)}function va(ea){B=!1;var ba=N-8,pa=Date.now();ea.copyFromByteArray(y,0,ea.getPosition(),4);kc(ea,F,t,ba);ea=t+(Date.now()-pa);fa(ea,F)}function Aa(ea){var ba=Date.now();t=ea.getLittleEndian16();R=ea.getLittleEndian16();
F=ea.getByte();ea.skipPosition(7);ja();ea=kc(ea,F,t,0);ea*=1E3;ba=t+(Date.now()-ba)+ea;fa(ba,F)}if(B)va(Y);else{var na=Y.getByte();Y.skipPosition(1);N=Y.getLittleEndian16();switch(na){case 7:A(Y);break;case 6:Z(Y);break;case 2:ra(Y);break;case 3:Y.getLittleEndian16();Y.getLittleEndian16();break;case 13:Aa(Y)}}};return M}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var u=svGlobal.DCVC_EXTENSION;u.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,
type:2,activate:function(q,B){svGlobal.logger.info("activate webcam");u.videoMedia.resolutions?q():hi5.video.resolutions(function(N){N.length?(u.videoMedia.resolutions=N,q()):B()})},deactivate:function(){var q=u.videoMedia;q.track&&(q.track.stop(),q.track=null);q.ctx=null;q.canvas=null;q.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(q,B,N,t,R){svGlobal.logger.info("startStream, width:"+q+" height:"+B+" frameRate:"+N);var F=u.videoMedia,T=F.track;if(T){var y=T.getSettings();
if("live"==T.readyState)if(q!=y.width||B!=y.height||N!=y.frameRate&&2!=F.type)T.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==F.type?F.minFrameRate:N,width:{exact:q},height:{exact:B}}}).then(function(M){var Y=document.createElement("video");Y.srcObject=M;Y.play();if(window.OffscreenCanvas)var A=new OffscreenCanvas(100,100);else A=document.createElement("canvas"),A.style.position="absolute",A.style.left=0,A.style.top=0;F.track=M.getVideoTracks()[0];F.canvas=A;F.ctx=A.getContext("2d");
F.video=Y;M=F.track.getSettings();F.canvas.width=M.width;F.canvas.height=M.height;t()}).catch(function(M){svGlobal.logger.warn(M);R()})},stopStream:function(){svGlobal.logger.info("stopStream");var q=u.videoMedia;q.track&&"live"==q.track.readyState&&q.track.stop()},grabFrame:function(q){function B(t){t.arrayBuffer().then(q)}var N=u.videoMedia;N.ctx.drawImage(N.video,0,0);N=N.canvas;N.convertToBlob?N.convertToBlob({type:"image/jpeg",quality:.6}).then(B):N.toBlob(B,"image/jpeg",.6)},propertyList:[[{propertyId:1,
capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,
max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};u.WEBAUTHN=function(q){function B(){if(R){var F=Error("Cancelling existing WebAuthn API call for new one");F.name="WebAuthnAbortError";R.abort(F)}R=new AbortController;return R.signal}function N(){if(R){var F=Error("Manually cancelling existing WebAuthn API call");F.name="WebAuthnAbortError";R.abort(F);R=void 0}}var t=new q;t.name="WebAuthN_Channel";
t.newInstance=function(){return u.WEBAUTHN(q)};t.onopen=function(){svGlobal.logger.info("webAuthn open")};t.onclose=function(){svGlobal.logger.info("webAuthn close")};var R=null;t.process=function(F){var T=F.getEnd()-F.getPosition();F=F.getBytes(T);var y=Gb(F),M=y.command;T=y.flags;F=y.timeout;var Y=y.webAuthNPara;if(M)switch(console.log("==== command: "+y.command),M){case 5:if(y.request)switch(M=y.request[0],console.log("==== webAuth cmdType = "+M),console.log("==== webAuth request bytes: "+sb(y.request.slice(1,
y.request.length))),M){case 1:y=y.request.slice(1,y.request.length);var A=Gb(y);y=A[1];var Z=A[2],ja=A[3],ra=A[4],fa=A[5];M=A[6];var va=A[7];A={};var Aa=vd(Y);Aa&&(Aa.attestation&&(A.attestation=Aa.attestation),Aa.attestationFormats&&(A.attestationFormats=Aa.attestationFormats));if(T=ud(T,Y,va))A.authenticatorSelection=T;A.challenge=y;fa&&(A.excludeCredentials=Cc(fa));A.rpId=Z.id;A.rp=Z;A.extensions=M?M:{};A.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};
ra&&(A.pubKeyCredParams=ra);F&&(A.timeout=F);A.user=ja;F={};F.signal=B();F.publicKey=A;navigator.credentials.create(F).then(function(na){wd(na.response,Z).then(function(ea){var ba={},pa={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},Ia=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);pa.aaGuid=Ia.buffer;pa.residentKey=
!0;ba.deviceInfo=pa;ba.status=0;ba.response=ea;ea=CBOR.encode(ba);ba=new hi5.DataBuffer(new Uint8Array(4+ea.byteLength));ba.setLittleEndian32(0);ba.setBytes(ea);ba.markEnd();t.send(ba)})}).catch(function(na){console.log("WebAuthN MakeCredential failed with error code ["+na.code+"], msg: "+na.message);na=new hi5.DataBuffer(new Uint8Array(4));na.setLittleEndian32(1);na.markEnd();t.send(na)});break;case 2:y=y.request.slice(1,y.request.length);A=Gb(y);y=A[2];ja=A[3];M=A[4];va=A[5];A={};ja&&(A.allowCredentials=
Cc(ja));A.challenge=y;M&&(A.extensions=M);A.rp=window.location.hostname;F&&(A.timeout=F);if(F=Bc(T,Y,va))A.userVerification=F;F={};F.signal=B();F.publicKey=A;navigator.credentials.get(F).then(function(na){na=new hi5.DataBuffer(new Uint8Array(void 0));na.markEnd();t.send(na)}).catch(function(na){console.log("WebAuthN GetAssertion failed with error code ["+na.code+"], msg: "+na.message);na=new hi5.DataBuffer(new Uint8Array(4));na.setLittleEndian32(1);na.markEnd();t.send(na)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+
M)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:F=new hi5.DataBuffer(new Uint8Array(8));F.setLittleEndian32(0);T=Ac()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;T?F.setLittleEndian32(1):F.setLittleEndian32(0);F.markEnd();t.send(F);break;case 7:N();F=new hi5.DataBuffer(new Uint8Array(4));F.setLittleEndian32(0);F.markEnd();t.send(F);break;case 8:F=new hi5.DataBuffer(new Uint8Array(8));F.setLittleEndian32(0);F.setLittleEndian32(4);
F.markEnd();t.send(F);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+M)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return t};p.enableWebAuthn()&&Ac()&&(a=u.WEBAUTHN(p.DynamicChannel),p.addDynamicChannel(a));u.WEBCAM=function(q){var B=new q;B.name="RDCamera_Device_0";B.version=2;B.newInstance=function(){return u.WEBCAM(q)};B.onopen=function(){svGlobal.logger.info("cam open")};B.onclose=function(){svGlobal.logger.info("cam close")};B.sendSucess=
function(){var N=new hi5.DataBuffer(new Uint8Array(2));N.setByte(B.version);N.setByte(1);N.markEnd();B.send(N)};B.sendError=function(N){var t=new hi5.DataBuffer(new Uint8Array(6));t.setByte(B.version);t.setByte(2);t.setLittleEndian32(N||1);t.markEnd();B.send(t)};B.sendSteamListResp=function(){var N=new hi5.DataBuffer(new Uint8Array(7));N.setByte(B.version);N.setByte(10);N.setLittleEndian16(1);N.setByte(1);N.setByte(1);N.setByte(0);N.markEnd();B.send(N)};B.sendMediaTypeListResp=function(N){var t=u.videoMedia.resolutions,
R=t.length,F=new hi5.DataBuffer(new Uint8Array(2+26*R));F.setByte(B.version);F.setByte(12);for(var T=1==N,y=0;y<R;y++){F.setByte(N);var M=t[y];F.setLittleEndian32(M.width);F.setLittleEndian32(M.height);F.setLittleEndian32(T?M.frameRate:u.videoMedia.minFrameRate);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setByte(1)}F.markEnd();B.send(F)};B.sendCurrentMediaType=function(N,t){var R=new hi5.DataBuffer(new Uint8Array(28));R.setByte(B.version);R.setByte(14);t=u.videoMedia.resolutions[t];
R.setByte(N);R.setLittleEndian32(t.width);R.setLittleEndian32(t.height);R.setLittleEndian32(1==N?t.frameRate:u.videoMedia.minFrameRate);R.setLittleEndian32(1);R.setLittleEndian32(1);R.setLittleEndian32(1);R.setByte(1);R.markEnd();B.send(R)};B.sendSampleResp=function(N){u.videoMedia.grabFrame(function(t){var R=new hi5.DataBuffer(new Uint8Array(t.byteLength+3));R.setByte(B.version);R.setByte(18);R.setByte(N);R.setBytes(new Uint8Array(t));R.markEnd();B.send(R)})};B.sendPropertyListResp=function(){for(var N=
0,t,R,F=u.videoMedia.propertyList,T=0;2>T;T++){R=F[T];t=R.length;for(var y=0;y<t;y++)null!=R[y]&&N++}var M=new hi5.DataBuffer(new Uint8Array(2+19*N));M.setByte(B.version);M.setByte(21);for(T=0;2>T;T++)for(R=F[T],t=R.length,y=0;y<t;y++)N=R[y],null!=N&&(M.setByte(T+0),M.setByte(N.propertyId),M.setByte(N.capabilities),M.setLittleEndian32(N.min),M.setLittleEndian32(N.max),M.setLittleEndian32(N.step),M.setLittleEndian32(N.default));M.markEnd();B.send(M)};B.sendPropertyValueResp=function(N,t){(N=u.videoMedia.propertyList[N][t-
1])?(t=new hi5.DataBuffer(new Uint8Array(7)),t.setByte(B.version),t.setByte(23),t.setByte(1),t.setLittleEndian32(N.value||N.default),t.markEnd(),B.send(t)):B.sendError(8)};B.process=function(N){N.getByte();var t=N.getByte();switch(t){case 7:u.videoMedia.activate(B.sendSucess,B.sendError);break;case 8:u.videoMedia.deactivate();B.sendSucess();break;case 9:B.sendSteamListResp();break;case 11:N=N.getByte();0!=N&&svGlobal.logger.warn("Invalid stream index: "+N);B.sendMediaTypeListResp(u.videoMedia.type);
break;case 13:N=N.getByte();B.sendCurrentMediaType(u.videoMedia.type,N);break;case 15:N.getByte();t=N.getByte();if(t!=u.videoMedia.type){svGlobal.warn("Invalid video format req:"+t);B.sendError(6);break}t=N.getLittleEndian32();var R=N.getLittleEndian32();N=N.getLittleEndian32()/N.getLittleEndian32();u.videoMedia.startStream(t,R,N,B.sendSucess,B.sendError);break;case 16:u.videoMedia.stopStream();B.sendSucess();break;case 17:N=N.getByte();0!=N&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+
N);B.sendSampleResp(N);break;case 20:B.sendPropertyListResp();break;case 22:t=N.getByte();N=N.getByte();B.sendPropertyValueResp(t,N);break;case 24:B.sendError(10);break;default:B.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+t)}};return B};u.WEBCAM_ENUM=function(q,B){var N=new q;N.name="RDCamera_Device_Enumerator";N.onopen=function(){var t=new hi5.DataBuffer(new Uint8Array(2));t.setByte(B.version);t.setByte(3);t.markEnd();N.send(t);svGlobal.logger.info("camEnum open")};N.onclose=function(){svGlobal.logger.info("camEnum closed");
u.videoMedia.deactivate()};N.addDevice=function(t){t+="\x00";var R=B.name+"\x00",F=new hi5.DataBuffer(new Uint8Array(2+2*t.length+R.length));F.setByte(B.version);F.setByte(5);F.setUnicodeString(t);F.setAscllString(R);F.markEnd();N.send(F)};N.process=function(t){var R=t.getByte();t=t.getByte();switch(t){case 4:svGlobal.logger.info("camEnum ver resp: "+R);B.version=R;N.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+
t)}};return N};d&&(d=u.WEBCAM(p.DynamicChannel),a=u.WEBCAM_ENUM(p.DynamicChannel,d),p.addDynamicChannel(a),p.addDynamicChannel(d));g&&(svGlobal.logger.info("Mapping USB..."),p.addDynamicChannel(Ea.usbChannel));if(b&&u.GFX){var w=function(){O.drawable.resumePlay||(O.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();O.resumeVideo()})},O=u.GFX(p.DynamicChannel,U(P.remotefx)&&!U(P.gfx),0==p.mode,oa,P.hardwareAcceleration);O.onmessage=function(q){p.showMessage(q)};w();O.onuserinteract=
function(q){da.execute("showPlay");w();svGlobal.logger.info("resumePlay");return!0};O.onfatalerror=function(q,B){p.reconnect(q.width,q.height,!0)};O.onsps=function(q){q.fps&&p.setFPS(q.fps)};O.onresetgraphic=function(q){p.setResolution(q.width,q.height)};O.onmapsurface=function(q){O.onconfirm();var B=da.getMonitorSurface(q.outputOriginX,q.outputOriginY,q.targetWidth+q.outputOriginX-1,q.targetHeight+q.outputOriginY-1);B?(B.setId(q.id),B.setSize(q.targetWidth,q.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+
q.outputOriginX+" y:"+q.outputOriginY)};O.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");da.execute("setDrawable",[O.drawable])};p.addDynamicChannel(O)}}}},eb=null;svGlobal.DCVC_EXTENSION&&!kb&&(p.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ea.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(p.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(eb=svGlobal.DCVC_EXTENSION.DRIVE(p.GatewayChannel),p.addGatewayChannel(eb)));this.getPrinters=function(a){if(!p.onagentmessage||!eb)return null;
var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();p.onagentmessage(b.getData());eb.listCallback=a};this.attachPrinter=function(a){eb&&eb.attachPrinter(a,p)};this.showError=Fb;this.resetStatus=ac;this.exeAppCmd=function(a){var b=da.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?da.getWinById(a):da.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=
ha.forceReconnect||!1);if(!Ha&&!c)return!1;P.minWidth&&a<P.minWidth&&(a<P.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+P.minWidth),a=P.minWidth);P.minHeight&&b<P.minHeight&&(b<P.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+P.minHeight),b=P.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ja)&&4>Math.abs(b-Ka))return!1;if(Ra&&Ra.enabled&&!1!==ha.displayVC)Ra.applyResolution(a,b);else if(oc&&pb||c||Wa&&!oc)pb=!1,svGlobal.logger.info("reconnecting..."),
sa("8E0"+a+"\t"+b),Qa&&(Qa.remoteLockFlags=0,Qa.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));sa(a)};this.getUploadManager=function(){return Ma};this.setFPS=function(a){da.execute("setFPS",[a])};this.addSurface=function(a){if(!da.hasSurface(a)&&(Kb||oa.setContext(a.context),!da.hasSurface(a)||!a.railWin)){kb&&a.setPlayerMode();P.mouseMoveEmu&&(a.mouseMoveEmu=U(P.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ja&&(Ja=b.width);0==Ka&&(Ka=
b.height);a.setConfig(ha);da.addSurface(a);Oa(Ja,Ka,!0,P.monitorDef?!0:!1);a.setController(Qa);a.setDrawable(Pd);a.setTouchpad(U(P.touchpad));var c=b=U(P.mapClipboard),e=b;void 0!=P.copyToLocal?c=U(P.copyToLocal):void 0!=ha.copyToLocal&&(c=ha.copyToLocal);void 0!=P.copyToRemote?e=U(P.copyToRemote):void 0!=ha.copyToRemote&&(e=ha.copyToRemote);a.setClipboard(b,c,e);Jb&&bc(a);P.invitation&&!U(P.control)&&(da.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=P.ctrlToWin?U(P.ctrlToWin):
void 0!=ha.ctrlToWin?ha.ctrlToWin:!0;c=void 0!=P.cmdToCtrl?U(P.cmdToCtrl):void 0!=ha.cmdToCtrl?ha.cmdToCtrl:!0;a.run(parseInt(P.keyboard||1033,10),b,!!ha.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=da.size();b<c;b++)da.getSurface(b).railWin.getMain(da.zOrders)&&a.push(da.getSurface(b).railWin.getMain(da.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";sa("8C2"+a+"\t"+b+"\t"+c);var e=da.getSurface(da.size()-1);e&&(e.remoteApp=new zc(a,
b,c))};this.startExitingApp=function(a){a=da.popWins(a);for(var b=a.length-1;0<=b;b--)da.addWin(a[b])};var vb=new p.DynamicChannel;vb.name="PNPDR";vb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};vb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),
a.setLittleEndian32(1),vb.send(a)}};vb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};p.addDynamicChannel(vb);var hb=null;U(P.scanner)&&(hb=new p.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(p.onagentmessage)p.onagentmessage(b);
break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(p.onagentmessage)p.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(p.onagentmessage)p.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},
p.addDynamicChannel(hb));var bb=null;p.hasSmartCard()&&(bb=new p.GatewayChannel,bb.name="SCARDSTB",bb.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(p.onagentmessage)p.onagentmessage(a);U(P.passwordIsPin)&&p.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},bb.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=
new Uint8Array(2);c[0]=3;c[1]=7;if(p.onagentmessage)p.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;wb&&(b+=wb.length);fb&&(b+=fb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);wb?(b.setLittleEndian32(wb.length),b.setBytes(wb)):b.setLittleEndian32(0);fb?(b.setLittleEndian32(fb.length),b.setBytes(fb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(p.onagentmessage)p.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=
new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(p.onagentmessage)p.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(bb)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),p.onagentmessage)p.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+
a[0]+"].")}},bb.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addGatewayChannel(bb));ha.detectNetwork&&(n+="&connectType=7",zd());this.getNetworkResult=function(){return Hb};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var cc=new Map,dc=new Map;this.writeAgent=
function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(bb){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;bb.send(a);break;case 8:cc.clear();dc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");
e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';
for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var m=b.getLittleEndian32();m=b.getAscllString(m,!1);var I=b.getLittleEndian32();b.getAscllString(I,!1);I=b.getLittleEndian64();I=(new Date(1E3*I)).toDateString();d=Ad(a,d,m,g,I);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=
!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var x,D=document.querySelector('input[name="scard_name"]:checked');D&&(x=parseInt(D.value));wb=cc.get(x);qb=dc.get(x);x=document.getElementById("userPin").value;fb=(new TextEncoder("utf-8")).encode(x);x=2;x=fb?x+4+fb.length:x+4;x=qb?x+4+qb.length:x+4;x=new Uint8Array(x);x=new hi5.DataBuffer(x);x.setByte(1);x.setByte(2);fb?(x.setLittleEndian32(fb.length),x.setBytes(fb)):x.setLittleEndian32(0);
qb?(x.setLittleEndian32(qb.length),x.setAsciiString(qb,qb.length)):x.setLittleEndian32(0);bb&&bb.send(x)};document.getElementById("userPin").addEventListener("keypress",function(x){"Enter"===x.key&&(x.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),
b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),bb.send(b));break;case 12:a[0]=1;a[1]=6;bb.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));
if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),
b.onclose=function(){p.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,p.onagentmessage)p.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Bd(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var x=0,D=document.querySelector('input[name="ds_name"]:checked');D&&(x=D.value);D=new Uint8Array(3);D[0]=
4;D[1]=5;D[2]=x;if(p.onagentmessage)p.onagentmessage(D)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();
p.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=p.getAgentLink(),hi5.notifications.notify({title:b,
html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)g=b.getLittleEndian32(),d=b.getUnicodeString(g),g=b.getLittleEndian32(),g=b.getUnicodeString(g),c.push({name:d,driver:g});eb&&eb.listCallback&&(eb.listCallback(c),eb.listCallback=null)}break;case 7:eb.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var wb,fb,qb,gc=
{type:6,data:null};this.setAgentStatus=function(a){Uc=a};this.getAgentStatus=function(){return Uc};this.run=function(){var a;if(a=null==p.onagentmessage)a=1==p.mode?!1:p.hasSmartCard()||p.hasScanner()||U(P.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(p):(p.hasUSB()?da.getFocused().requestUsbDevices(p.getUSB(),function(b){Ea.usbChannel.openDevices(b);ec()}):ec(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return oa};this.mouseDown=function(a,b,c){Wa&&sa("80"+a+"\t"+
b+"\t"+c)};this.mouseMove=function(a,b){Wa&&sa("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Wa&&sa("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Wa&&sa("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Wa&&("number"==typeof a?(sa("840\t"+a),sa("8449152\t"+a)):sa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){p.reconnectOnResize&&(Va?(mb&&(clearTimeout(mb),mb=0),a&=-4,b&=-4,mb=setTimeout(function(){document.hidden||(Ra&&Ra.enabled&&Ra.applyResolution(a,b),setTimeout(function(){p.writeRawInput("8C661441\t"+
a+"\t"+b);3==p.windowState&&Sc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):p.running()&&(mb&&(clearTimeout(mb),mb=0),mb=setTimeout(function(){document.hidden||p.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!p.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Xb,b[4]=Xb>>8,b[5]=Wb,b[6]=Wb>>8,b[7]=Yb,b[8]=Yb>>8,b[9]=Zb,b[10]=Zb>>8);sa(b.buffer);return!0};this.refreshOutput=
function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);sa(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);sa(b.buffer)};this.startPing=function(a,b){b=b||0;Pa||(Pa=new hi5.tool.ResponseMonitor(function(){Wa&&p.sendPing()},function(){if(Wa&&p.onnoresponse)return p.onnoresponse()}));Pa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;
sa(c.buffer);setTimeout(function(){Pa&&Pa.check()},1E3*(a+b));La?La.postMessage({type:0,cmd:6,start:1}):(Ba.onSlowPath=Ba.onFastPath=Jc,Ba.onReqHistory=function(){Jc(15555)})};this.stopPing=function(){Pa&&Pa.stop();La?La.postMessage({type:0,cmd:6,start:0}):Ba.onSlowPath=Ba.onFastPath=Ba.onReqHistory=null};var Ya=null,Pc=0;this.play=function(){sa("F3")};this.pause=function(){sa("F2")};this.scan=function(a){sa("F4"+(a?"1":"0"))};this.seek=function(a){var b=da.getFocused();b&&Ha&&(sa("F4"+(a?"1":"0")+
"\t"+(a/b.getScale().x|0)),oa.pause(!0))};var Da={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Oc=!1;this.showMessage=function(a,b,c){p&&p.displayMsg&&a&&((b=
b||da.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=zb;this.close=function(){svGlobal.logger.info("closing...");Ha&&Va&&da&&ha.closeRemoteApp&&da.tryCloseRemoteApps();oa&&oa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Rc,2222)):Rc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(p.close):window.addEventListener("unload",p.close,!1);Lb.searchStartCode=
function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};pc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Mb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Mb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||
(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d){function g(y,M,Y,A){this.pixels=y;this.width=M;this.height=Y;this.key=A}function m(y,M,Y){this.width=y;this.height=M;this.monitors=Y}function I(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(y){this.left=y.getLittleEndian32();this.top=y.getLittleEndian32();this.right=y.getLittleEndian32();this.bottom=y.getLittleEndian32();this.flags=y.getLittleEndian32()};this.toString=function(){return"left: "+
this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function x(y,M,Y,A){function Z(){Aa=!1;na.drawable=fa._video;fa._player=ja?new Nd(fa,!1,A):new Mb(na.drawable,fa,!1);fa._player.onsps=function(ea){ja&&(fa._video.width=ea.width,fa._video.height=ea.height);fa.onsps&&fa.onsps(ea)};fa._player.onerror=function(ea){fa.onfatalerror&&fa.onfatalerror(fa,ea)};fa._player.onplayerror=function(ea){function ba(){na={drawable:fa._video};fa.player.play(!0)}na=null;if((!fa.onuserinteract||
!fa.onuserinteract(ba,"video"))&&fa.onmessage)fa.onmessage({msg:"Please click Yes to continue.<br>"+ea,cbYes:function(){fa.player.play(!0);this.destroy()}})};fa._player.onframedecoded=function(ea){ra.drawImage(ea,0,0)}}this.id=y;this.width=M;this.height=Y;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=M;this.targetHeight=Y;this._player=null;var ja="no-decoder"==A?!1:!!window.VideoDecoder;this._video=ja?new OffscreenCanvas(M,Y):document.createElement("video");var ra=ja?
this._video.getContext("2d"):null,fa=this,va=null,Aa=!0,na={drawable:null};ja&&svGlobal.logger.info("...MediaDecoder in use: "+A);this.resumeVideo=function(){fa._player&&fa._player.play(!0)};this.setDisplayBuffer=function(ea){va=ea};this.draw=function(ea,ba,pa,Ia){return Aa?va.draw(ea,ba,pa,Ia):na};this.processAvc=function(ea,ba){Aa&&Z();if(!ba||ja)fa.onvideoframe(ea,ba)};this.reset=function(ea,ba){fa&&fa._player&&fa._player.reset()};this.close=function(){fa&&fa._player&&(fa._player.close(),fa._player=
null);fa=null};this.setRGBs=function(ea,ba,pa,Ia,f,k,h){va.setRGBs(ea,ba,pa,Ia,f,k,h)};this.getRGBs=function(ea,ba,pa,Ia){return va.getRGBs(ea,ba,pa,Ia)};this.moveArea=function(ea,ba,pa,Ia,f,k){va.moveArea(ea,ba,pa,Ia,f,k)};this.fillRect=function(ea,ba,pa,Ia,f){va.fillRect(ea,ba,pa,Ia,f)};this.postPaint=function(ea,ba,pa,Ia){Aa&&va.postPaint(ea,ba,pa,Ia)}}function D(y,M,Y,A){var Z=new x(y,M,Y,d);Z.pixelFormat=A||33;Z.setDisplayBuffer(e);T.push(Z);F.oncreatesurface&&F.oncreatesurface(Z);svGlobal.logger.info("create surface id:"+
y+" w:"+M+" h:"+Y+" pixelFmt:"+Z.pixelFormat);return Z}function G(y,M){var Y=y.getPosition(),A=y.getLittleEndian32();y.skipPosition(10*A);return y.getBytes(M-(y.getPosition()-Y))}function u(y,M,Y,A){Y=y.getLittleEndian32();var Z=Y>>>30;Y&=1073741823;switch(Z){case 0:var ja=G(y,Y);var ra=G(y,M-Y-4);break;case 1:ja=G(y,Y);break;case 2:M=y.getEnd()-y.getPosition();ra=G(y,M);break;default:throw Error("Invalid LC: "+Z);}ja&&A.processAvc(ja,!1);ra&&A.processAvc(ra,!0)}function w(y){var M=y.getLittleEndian32(),
Y=y.getLittleEndian32();y=y.getLittleEndian32();var A=!1;switch(M){case 524292:A=!1;0==(y&1)&&(B=new ClearDecoder);break;case 524549:(A=0!=(y&16))||0!=(y&1)||(B=new ClearDecoder);break;default:A=0==(y&32)}e.onGetGfxHistory=function(Z,ja){var ra=O.toPDU();ra&&Z(ra);ja();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(Z,ja){svGlobal.logger.info("Set GFX Histroy");10==Z?O.fromStream(ja):svGlobal.logger.error("Invalid GFX histroy type: "+Z)};svGlobal.logger.info("Gfx Cap, Ver:"+M.toString(16)+
" len:"+Y+" flags:"+y+" h264:"+A);F.onconfirm&&F.onconfirm();return A}var O=new function(){function y(f,k,h,r,v){this.len=f;this.code=k;this.valueBits=h;this.type=r;this.vbase=v}function M(f){var k=25E5-ja,h=f.length;if(k>=h)Z.set(f,ja),ja=k>h?ja+h:0;else if(25E5>=h)Z.set(f.subarray(0,k),ja),Z.set(f.subarray(k),0),ja=h-k;else{k=(h-k)%25E5;var r=h-k,v=f.subarray(r);f=f.subarray(h-25E5,r);Z.set(f,25E5-f.length);Z.set(v,0);ja=k}}function Y(f){for(;na<f;)Aa<<=8,ea<pa?Aa+=ba[ea++]:console.log("--- end"),
na+=8;va-=f;na-=f;f=Aa>>na;Aa&=(1<<na)-1;return f}var A=[new y(1,0,8,0,0),new y(5,17,5,1,0),new y(5,18,7,1,32),new y(5,19,9,1,160),new y(5,20,10,1,672),new y(5,21,12,1,1696),new y(5,24,0,0,0),new y(5,25,0,0,1),new y(6,44,14,1,5792),new y(6,45,15,1,22176),new y(6,52,0,0,2),new y(6,53,0,0,3),new y(6,54,0,0,255),new y(7,92,18,1,54944),new y(7,93,20,1,317088),new y(7,110,0,0,4),new y(7,111,0,0,5),new y(7,112,0,0,6),new y(7,113,0,0,7),new y(7,114,0,0,8),new y(7,115,0,0,9),new y(7,116,0,0,10),new y(7,117,
0,0,11),new y(7,118,0,0,58),new y(7,119,0,0,59),new y(7,120,0,0,60),new y(7,121,0,0,61),new y(7,122,0,0,62),new y(7,123,0,0,63),new y(7,124,0,0,64),new y(7,125,0,0,128),new y(8,188,20,1,1365664),new y(8,189,21,1,2414240),new y(8,252,0,0,12),new y(8,253,0,0,56),new y(8,254,0,0,57),new y(8,255,0,0,102),new y(9,380,22,1,4511392),new y(9,381,23,1,8705696),new y(9,382,24,1,17094304)],Z=new Uint8Array(25E5),ja=0,ra=new Uint8Array(65536),fa=0,va=0,Aa=0,na=0,ea=0,ba=null,pa=0,Ia=!0;this.toPDU=function(){if(Ia)return null;
var f=new Uint8Array(2500008);f[0]=29;f[2]=1;f[3]=10;f[4]=ja;f[5]=ja>>8;f[6]=ja>>16;f[7]=ja>>24;f.set(Z,8);return f};this.fromStream=function(f){ja=f.getLittleEndian32();Z.set(f.getSubarray(25E5))};this.decompress=function(f,k){if(k){ba=f;Ia&&(Ia=!1);pa=ba.length-1;va=8*pa-ba[pa];for(fa=ea=na=Aa=0;0<va;)for(var h=k=0,r=0;r<A.length;r++){for(f=A[r];k<f.len;)h=(h<<1)+Y(1),k++;0>h&&console.log("xxx inPrefix");if(h==f.code){if(0==f.type)f=f.vbase+Y(f.valueBits),(0>f||255<f)&&console.log("xxx do c"),f&=
255,Z[ja]=f,25E5==++ja&&(ja=0),ra[fa++]=f;else if(k=Y(f.valueBits),k=f.vbase+k,0>k&&console.log("xxx distance"),0!=k){if(0==Y(1))f=3;else{f=4;for(h=2;1==Y(1);)f*=2,h++;f+=Y(h)}k=25E5-k+ja;k%=25E5;h=k+f;if(Math.abs(ja-k)>=f&&25E5>h&&25E5>ja+f)k=Z.subarray(k,h),Z.set(k,ja),ja+=f,ra.set(k,fa),fa+=f;else for(;0<f;)h=Z[k],25E5==++k&&(k=0),Z[ja]=h,25E5==++ja&&(ja=0),ra[fa++]=h,f--}else f=Y(15),va-=na,Aa=na=0,k=ba.subarray(ea,ea+f),M(k),ra.set(k,fa),ea+=f,fa+=f,va-=8*f;break}}65536<fa&&console.error("xx outputIndex:"+
fa);return ra.subarray(0,fa)}M(f);return f}},q=new function(){this.process=function(y){var M=y.getByte();if(224==M){var Y=0!=(y.getByte()&32);var A=y.getPosition(),Z=y.getEnd();M=O.decompress(y.getData().subarray(A,Z),Y);y.setPosition(Z)}else{225!=M&&console.log("Invalid descriptor:"+M);Z=y.getLittleEndian16();var ja=y.getLittleEndian32();M=new Uint8Array(ja);for(var ra=0,fa,va=0;va<Z;va++)fa=y.getLittleEndian32(),Y=0!=(y.getByte()&32),fa--,A=y.getPosition(),Y=O.decompress(y.getData().subarray(A,
A+fa),Y),M.set(Y,ra),ra+=Y.length,y.skipPosition(fa);ra!=ja&&console.error("wrong size, actual:"+ra+" expected:"+ja)}return new RdpBuffer(M,0,M.length)}},B=null,N=new rdpcodecs.RemoteFX(!1),t=0,R=[],F=new a;F.name="Microsoft::Windows::RDS::Graphics";var T=new function(y,M){var Y=[];this.push=function(A){A.osps=y.onsps;A.onfatalerror=y.onfatalerror;A.onplayerror=y.onplayerror;A.onuserinteract=y.onuserinteract;A.onmessage=y.onmessage;Y[A.id]=A};this.get=function(A){return Y[A]};this.getAll=function(){return Y};
this.delete=function(A){var Z=Y[A];Z&&(Z.onsps=null,Z.onfatalerror=null,Z.onplayerror=null,Y[A]=null)};this.reset=function(A){A=0;for(var Z=Y.length;A<Z;A++)Y[A]&&Y[A].reset()};this.close=function(){for(var A=0,Z=Y.length;A<Z;A++)Y[A]&&Y[A].close()};this.resumeVideo=function(){for(var A=0,Z=Y.length;A<Z;A++)Y[A]&&Y[A].resumeVideo()}}(F,e);F.drawable=new function(){this.draw=function(y,M,Y,A,Z){return(Z=T.get(Z))?Z.draw(y,M,Y,A):null};this.getSurfaces=function(){return T};this.onfocus=function(y){};
this.resumePlay=null};F.resumeVideo=function(){T.resumeVideo()};F.process=function(y){for(var M=q.process(y);M.has(8);){var Y=M.getLittleEndian16();M.getLittleEndian16();var A=M.getLittleEndian32(),Z=M.getPosition()+A-8;switch(Y){case 1:var ja=M,ra=ja.getLittleEndian16(),fa=ja.getLittleEndian16(),va=ja.getByte(),Aa=ja.getLittleEndian16(),na=ja.getLittleEndian16(),ea=ja.getLittleEndian16(),ba=ja.getLittleEndian16(),pa=ea-Aa,Ia=ba-na,f=ja.getLittleEndian32(),k=ja.getPosition()+f,h=T.get(ra);h||(F.onconfirm&&
F.onconfirm(),h=D(ra,e.width,e.height,va));switch(fa){case 0:var r=rdpcodecs.bitmap.byte2int(ja.getData(),f,ja.getPosition());h.setRGBs(Aa,na,pa,Ia,r,0,pa);break;case 3:for(var v=N.decode(ja,f),z=v.getRects(),J=v.getTiles(),C=v.getTileSize(),H=v.getRectSize(),W=0;W<C;W++){var E=J[W];if(H)for(var l=E.x+64,L=E.y+64,Q=0;Q<H;Q++){var S=z[Q],ca=S.x+S.width,ma=S.y+S.height;l<=ca?L<=ma?h.setRGBs(E.x+Aa,E.y+na,64,64,E.data,0,64):h.setRGBs(E.x+Aa,E.y+na,64,ma-E.y,E.data,0,64):L<=ma?h.setRGBs(E.x+Aa,E.y+na,
ca-E.x,64,E.data,0,64):h.setRGBs(E.x+Aa,E.y+na,ca-E.x,ma-E.y,E.data,0,64)}else h.setRGBs(E.x,E.y,64,64,E.data,0,4)}break;case 8:B||(B=new ClearDecoder);B.decode(ja,pa,Ia,h.getData(),Aa,na,h.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var ya=h,Ga=G(ja,f);ya.processAvc(Ga,!1);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:u(ja,f,!1,h);break;case 15:u(ja,f,!0,h);break;default:svGlobal.logger.warn("Invalid codec:"+fa)}ja.setPosition(k);h.postPaint(Aa,na,pa,Ia);break;
case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ca=M;svGlobal.logger.info("...soliFill");for(var Fa=Ca.getLittleEndian16(),za=-16777216|Ca.getByte()<<16|Ca.getByte()<<8|Ca.getByte()|Ca.getByte()<<24,Sa=Ca.getLittleEndian16(),ua=T.get(Fa),wa=0;wa<Sa;wa++){var Na=Ca.getLittleEndian16(),Xa=Ca.getLittleEndian16(),Za=Ca.getLittleEndian16()-Na,$a=Ca.getLittleEndian16()-Xa;ua.fillRect(Na,Xa,Za,$a,za);ua.postPaint(Na,
Xa,Za,$a)}break;case 5:var ab=M;svGlobal.logger.info("...surfaceToSurface");for(var ub=ab.getLittleEndian16(),Zc=ab.getLittleEndian16(),Ob=ab.getLittleEndian16(),Pb=ab.getLittleEndian16(),Qb=ab.getLittleEndian16()-Ob,tc=ab.getLittleEndian16()-Pb,Qd=ab.getLittleEndian16(),$c=T.get(ub),Rd=T.get(Zc),ad=ub==Zc?null:$c.getRGBs(Ob,Pb,Qb,tc),bd=0;bd<Qd;bd++){var cd=ab.getLittleEndian16(),dd=ab.getLittleEndian16();ad?Rd.setRGBs(cd,dd,Qb,tc,ad,0,Qb):$c.moveArea(Ob,Pb,Qb,tc,cd-Ob,dd-Pb)}break;case 6:var nb=
M;svGlobal.logger.info("...surfaceToCache");var Sd=nb.getLittleEndian16(),uc=nb.getLittleEndian32().toString(16),ed=nb.getLittleEndian32();0<ed&&(uc=ed.toString(16)+uc);var Td=nb.getLittleEndian16(),fd=nb.getLittleEndian16(),gd=nb.getLittleEndian16(),hd=nb.getLittleEndian16()-fd,id=nb.getLittleEndian16()-gd,Ud=T.get(Sd).getRGBs(fd,gd,hd,id);R[Td]=new g(Ud,hd,id,uc);break;case 7:var Db=M;svGlobal.logger.info("...cacheToSurface");for(var Vd=Db.getLittleEndian16(),Wd=Db.getLittleEndian16(),Xd=Db.getLittleEndian16(),
Rb=R[Vd],Yd=T.get(Wd),jd=0;jd<Xd;jd++){var Zd=Db.getLittleEndian16(),$d=Db.getLittleEndian16();Yd.setRGBs(Zd,$d,Rb.width,Rb.height,Rb.pixels,0,Rb.width)}break;case 8:var ae=M.getLittleEndian16();R[ae]=null;break;case 9:var Sb=M,be=Sb.getLittleEndian16(),ce=Sb.getLittleEndian16(),de=Sb.getLittleEndian16(),ee=Sb.getByte();D(be,ce,de,ee);break;case 10:var kd=M.getLittleEndian16();T.delete(kd);svGlobal.logger.info("delete surface id:"+kd);break;case 11:var ld=M;ld.getLittleEndian32();ld.getLittleEndian32();
break;case 12:var fe=M.getLittleEndian32();if(0==t){var md=new Uint8Array(20),xb=new RdpBuffer(md);xb.setLittleEndian16(13);xb.setLittleEndian16(0);xb.setLittleEndian32(20);xb.setLittleEndian32(4294967295);xb.setLittleEndian32(fe);t++;xb.setLittleEndian32(t);c&&F.send(md)}break;case 14:var Tb=M,nd=Tb.getLittleEndian32(),od=Tb.getLittleEndian32(),vc=Tb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+nd+" h:"+od+" monitors:"+vc);for(var pd=Array(vc),Ub=0;Ub<vc;Ub++){var wc=new I;wc.read(Tb);
pd[Ub]=wc;svGlobal.logger.info("MonitorDef "+Ub+": "+wc.toString())}var qd=new m(nd,od,pd);T.reset(qd);F.onresetgraphic&&F.onresetgraphic(qd);break;case 15:var Vb=M,rd=Vb.getLittleEndian16();Vb.skipPosition(2);var Eb=T.get(rd);Eb.outputOriginX=Vb.getLittleEndian32();Eb.outputOriginY=Vb.getLittleEndian32();F.onmapsurface&&F.onmapsurface(Eb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+rd+" outX:"+Eb.outputOriginX+" outY:"+Eb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");
break;case 19:w(M);break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var yb=M,sd=yb.getLittleEndian16();yb.skipPosition(2);var ib=T.get(sd);ib.outputOriginX=yb.getLittleEndian32();ib.outputOriginY=yb.getLittleEndian32();ib.targetWidth=yb.getLittleEndian32();ib.targetHeight=yb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+sd+" outX:"+ib.outputOriginX+" outY:"+ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);
F.onmapsurface&&F.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+Y);return}M.setPosition(Z)}};F.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var y=b?2:8,M=120*y,Y=new Uint8Array(M),A=new RdpBuffer(Y);A.setLittleEndian16(18);A.setLittleEndian16(0);A.setLittleEndian32(M);A.setLittleEndian16(y);A.setLittleEndian32(524292);A.setLittleEndian32(4);A.setLittleEndian32(1);A.setLittleEndian32(524549);A.setLittleEndian32(4);
A.setLittleEndian32(19);b||(A.setLittleEndian32(655362),A.setLittleEndian32(4),A.setLittleEndian32(0),A.setLittleEndian32(655872),A.setLittleEndian32(4),A.setLittleEndian32(0),A.setLittleEndian32(656129),A.setLittleEndian32(4),A.setLittleEndian32(0),A.setLittleEndian32(656384),A.setLittleEndian32(4),A.setLittleEndian32(0),A.setLittleEndian32(656642),A.setLittleEndian32(4),A.setLittleEndian32(0),A.setLittleEndian32(656896),A.setLittleEndian32(4),A.setLittleEndian32(0));A.markEnd();c&&F.send(Y)};F.onclose=
function(){T.close()};return F}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var n=navigator&&(navigator.language||navigator.userLanguage||""),K=Rdp.languageToKeyboard[n];if(!K){var V=n.indexOf("-");V&&(K=Rdp.languageToKeyboard[n.substring(0,V)])}K||(svGlobal.logger.info("No valid layout for "+n),K=1033);return K}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
