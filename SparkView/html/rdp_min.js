var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var K=0;return function(){return K<q.length?{done:!1,value:q[K++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.makeIterator=function(q){var K="undefined"!=typeof Symbol&&Symbol.iterator&&q[Symbol.iterator];return K?K.call(q):$jscomp.arrayIterator(q)};$jscomp.arrayFromIterator=function(q){for(var K,Y=[];!(K=q.next()).done;)Y.push(K.value);return Y};
$jscomp.arrayFromIterable=function(q){return q instanceof Array?q:$jscomp.arrayFromIterator($jscomp.makeIterator(q))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(q){var K=function(){};K.prototype=q;return new K};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,K,Y){if(q==Array.prototype||q==Object.prototype)return q;q[K]=Y.value;return q};$jscomp.getGlobal=function(q){q=["object"==typeof globalThis&&globalThis,q,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var K=0;K<q.length;++K){var Y=q[K];if(Y&&Y.Math==Math)return Y}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(q,K){var Y=$jscomp.propertyToPolyfillSymbol[K];if(null==Y)return q[K];Y=q[Y];return void 0!==Y?Y:q[K]};
$jscomp.polyfill=function(q,K,Y,na){K&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(q,K,Y,na):$jscomp.polyfillUnisolated(q,K,Y,na))};$jscomp.polyfillUnisolated=function(q,K,Y,na){Y=$jscomp.global;q=q.split(".");for(na=0;na<q.length-1;na++){var U=q[na];if(!(U in Y))return;Y=Y[U]}q=q[q.length-1];na=Y[q];K=K(na);K!=na&&null!=K&&$jscomp.defineProperty(Y,q,{configurable:!0,writable:!0,value:K})};
$jscomp.polyfillIsolated=function(q,K,Y,na){var U=q.split(".");q=1===U.length;na=U[0];na=!q&&na in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var va=0;va<U.length-1;va++){var da=U[va];if(!(da in na))return;na=na[da]}U=U[U.length-1];Y=$jscomp.IS_SYMBOL_NATIVE&&"es6"===Y?na[U]:null;K=K(Y);null!=K&&(q?$jscomp.defineProperty($jscomp.polyfills,U,{configurable:!0,writable:!0,value:K}):K!==Y&&($jscomp.propertyToPolyfillSymbol[U]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(U):$jscomp.POLYFILL_PREFIX+
U,U=$jscomp.propertyToPolyfillSymbol[U],$jscomp.defineProperty(na,U,{configurable:!0,writable:!0,value:K})))};
$jscomp.getConstructImplementation=function(){function q(){function Y(){}new Y;Reflect.construct(Y,[],function(){});return new Y instanceof Y}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(q())return Reflect.construct;var K=Reflect.construct;return function(Y,na,U){Y=K(Y,na);U&&Reflect.setPrototypeOf(Y,U.prototype);return Y}}return function(Y,na,U){void 0===U&&(U=Y);U=$jscomp.objectCreate(U.prototype||Object.prototype);return Function.prototype.apply.call(Y,U,na)||
U}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var q={a:!0},K={};try{return K.__proto__=q,K.a}catch(Y){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(q,K){q.__proto__=K;if(q.__proto__!==K)throw new TypeError(q+" is not extensible");return q}:null;
$jscomp.inherits=function(q,K){q.prototype=$jscomp.objectCreate(K.prototype);q.prototype.constructor=q;if($jscomp.setPrototypeOf){var Y=$jscomp.setPrototypeOf;Y(q,K)}else for(Y in K)if("prototype"!=Y)if(Object.defineProperties){var na=Object.getOwnPropertyDescriptor(K,Y);na&&Object.defineProperty(q,Y,na)}else q[Y]=K[Y];q.superClass_=K.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(q){if(!(q instanceof Object))throw new TypeError("Iterator result "+q+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(q){this.yieldResult=q};
$jscomp.generator.Context.prototype.throw_=function(q){this.abruptCompletion_={exception:q,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(q){this.abruptCompletion_={return:q};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(q){this.abruptCompletion_={jumpTo:q};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(q,K){this.nextAddress=K;return{value:q}};
$jscomp.generator.Context.prototype.yieldAll=function(q,K){q=$jscomp.makeIterator(q);var Y=q.next();$jscomp.generator.ensureIteratorResultIsObject_(Y);if(Y.done)this.yieldResult=Y.value,this.nextAddress=K;else return this.yieldAllIterator_=q,this.yield(Y.value,K)};$jscomp.generator.Context.prototype.jumpTo=function(q){this.nextAddress=q};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(q,K){this.catchAddress_=q;void 0!=K&&(this.finallyAddress_=K)};$jscomp.generator.Context.prototype.setFinallyBlock=function(q){this.catchAddress_=0;this.finallyAddress_=q||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(q,K){this.nextAddress=q;this.catchAddress_=K||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(q){this.catchAddress_=q||0;q=this.abruptCompletion_.exception;this.abruptCompletion_=null;return q};$jscomp.generator.Context.prototype.enterFinallyBlock=function(q,K,Y){Y?this.finallyContexts_[Y]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=q||0;this.finallyAddress_=K||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(q,K){K=this.finallyContexts_.splice(K||0)[0];if(K=this.abruptCompletion_=this.abruptCompletion_||K){if(K.isException)return this.jumpToErrorHandler_();void 0!=K.jumpTo&&this.finallyAddress_<K.jumpTo?(this.nextAddress=K.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=q};$jscomp.generator.Context.prototype.forIn=function(q){return new $jscomp.generator.Context.PropertyIterator(q)};
$jscomp.generator.Context.PropertyIterator=function(q){this.object_=q;this.properties_=[];for(var K in q)this.properties_.push(K);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var q=this.properties_.pop();if(q in this.object_)return q}return null};$jscomp.generator.Engine_=function(q){this.context_=new $jscomp.generator.Context;this.program_=q};
$jscomp.generator.Engine_.prototype.next_=function(q){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,q,this.context_.next_);this.context_.next_(q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(q){this.context_.start_();var K=this.context_.yieldAllIterator_;if(K)return this.yieldAllStep_("return"in K?K["return"]:function(Y){return{value:Y,done:!0}},q,this.context_.return);this.context_.return(q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(q){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],q,this.context_.next_);this.context_.throw_(q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(q,K,Y){try{var na=q.call(this.context_.yieldAllIterator_,K);$jscomp.generator.ensureIteratorResultIsObject_(na);if(!na.done)return this.context_.stop_(),na;var U=na.value}catch(va){return this.context_.yieldAllIterator_=null,this.context_.throw_(va),this.nextStep_()}this.context_.yieldAllIterator_=null;Y.call(this.context_,U);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var q=this.program_(this.context_);if(q)return this.context_.stop_(),{value:q.value,done:!1}}catch(K){this.context_.yieldResult=void 0,this.context_.throw_(K)}this.context_.stop_();if(this.context_.abruptCompletion_){q=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(q.isException)throw q.exception;return{value:q.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(q){this.next=function(K){return q.next_(K)};this.throw=function(K){return q.throw_(K)};this.return=function(K){return q.return_(K)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(q,K){K=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(K));$jscomp.setPrototypeOf&&q.prototype&&$jscomp.setPrototypeOf(K,q.prototype);return K};
$jscomp.asyncExecutePromiseGenerator=function(q){function K(na){return q.next(na)}function Y(na){return q.throw(na)}return new Promise(function(na,U){function va(da){da.done?na(da.value):Promise.resolve(da.value).then(K,Y).then(va,U)}va(q.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(q){return $jscomp.asyncExecutePromiseGenerator(q())};$jscomp.asyncExecutePromiseGeneratorProgram=function(q){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(q)))};
$jscomp.polyfill("Reflect",function(q){return q?q:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(q){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(q){if(q)return q;if($jscomp.setPrototypeOf){var K=$jscomp.setPrototypeOf;return function(Y,na){try{return K(Y,na),!0}catch(U){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(q){if(q)return q;var K=function(U,va){this.$jscomp$symbol$id_=U;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:va})};K.prototype.toString=function(){return this.$jscomp$symbol$id_};var Y=0,na=function(U){if(this instanceof na)throw new TypeError("Symbol is not a constructor");return new K("jscomp_symbol_"+(U||"")+"_"+Y++,U)};return na},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(q){if(q)return q;q=Symbol("Symbol.iterator");for(var K="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Y=0;Y<K.length;Y++){var na=$jscomp.global[K[Y]];"function"===typeof na&&"function"!=typeof na.prototype[q]&&$jscomp.defineProperty(na.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return q},"es6",
"es3");$jscomp.iteratorPrototype=function(q){q={next:q};q[Symbol.iterator]=function(){return this};return q};
$jscomp.polyfill("Promise",function(q){function K(){this.batch_=null}function Y(da){return da instanceof U?da:new U(function(ta,ea){ta(da)})}if(q&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return q;K.prototype.asyncExecute=function(da){if(null==this.batch_){this.batch_=[];var ta=this;this.asyncExecuteFunction(function(){ta.executeBatch_()})}this.batch_.push(da)};
var na=$jscomp.global.setTimeout;K.prototype.asyncExecuteFunction=function(da){na(da,0)};K.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var da=this.batch_;this.batch_=[];for(var ta=0;ta<da.length;++ta){var ea=da[ta];da[ta]=null;try{ea()}catch(la){this.asyncThrow_(la)}}}this.batch_=null};K.prototype.asyncThrow_=function(da){this.asyncExecuteFunction(function(){throw da;})};var U=function(da){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var ta=this.createResolveAndReject_();try{da(ta.resolve,ta.reject)}catch(ea){ta.reject(ea)}};U.prototype.createResolveAndReject_=function(){function da(la){return function(qa){ea||(ea=!0,la.call(ta,qa))}}var ta=this,ea=!1;return{resolve:da(this.resolveTo_),reject:da(this.reject_)}};U.prototype.resolveTo_=function(da){if(da===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(da instanceof U)this.settleSameAsPromise_(da);else{a:switch(typeof da){case "object":var ta=
null!=da;break a;case "function":ta=!0;break a;default:ta=!1}ta?this.resolveToNonPromiseObj_(da):this.fulfill_(da)}};U.prototype.resolveToNonPromiseObj_=function(da){var ta=void 0;try{ta=da.then}catch(ea){this.reject_(ea);return}"function"==typeof ta?this.settleSameAsThenable_(ta,da):this.fulfill_(da)};U.prototype.reject_=function(da){this.settle_(2,da)};U.prototype.fulfill_=function(da){this.settle_(1,da)};U.prototype.settle_=function(da,ta){if(0!=this.state_)throw Error("Cannot settle("+da+", "+
ta+"): Promise already settled in state"+this.state_);this.state_=da;this.result_=ta;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};U.prototype.scheduleUnhandledRejectionCheck_=function(){var da=this;na(function(){if(da.notifyUnhandledRejection_()){var ta=$jscomp.global.console;"undefined"!==typeof ta&&ta.error(da.result_)}},1)};U.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var da=$jscomp.global.CustomEvent,ta=$jscomp.global.Event,
ea=$jscomp.global.dispatchEvent;if("undefined"===typeof ea)return!0;"function"===typeof da?da=new da("unhandledrejection",{cancelable:!0}):"function"===typeof ta?da=new ta("unhandledrejection",{cancelable:!0}):(da=$jscomp.global.document.createEvent("CustomEvent"),da.initCustomEvent("unhandledrejection",!1,!0,da));da.promise=this;da.reason=this.result_;return ea(da)};U.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var da=0;da<this.onSettledCallbacks_.length;++da)va.asyncExecute(this.onSettledCallbacks_[da]);
this.onSettledCallbacks_=null}};var va=new K;U.prototype.settleSameAsPromise_=function(da){var ta=this.createResolveAndReject_();da.callWhenSettled_(ta.resolve,ta.reject)};U.prototype.settleSameAsThenable_=function(da,ta){var ea=this.createResolveAndReject_();try{da.call(ta,ea.resolve,ea.reject)}catch(la){ea.reject(la)}};U.prototype.then=function(da,ta){function ea(Oa,ua){return"function"==typeof Oa?function(tb){try{la(Oa(tb))}catch(pb){qa(pb)}}:ua}var la,qa,ya=new U(function(Oa,ua){la=Oa;qa=ua});
this.callWhenSettled_(ea(da,la),ea(ta,qa));return ya};U.prototype.catch=function(da){return this.then(void 0,da)};U.prototype.callWhenSettled_=function(da,ta){function ea(){switch(la.state_){case 1:da(la.result_);break;case 2:ta(la.result_);break;default:throw Error("Unexpected state: "+la.state_);}}var la=this;null==this.onSettledCallbacks_?va.asyncExecute(ea):this.onSettledCallbacks_.push(ea);this.isRejectionHandled_=!0};U.resolve=Y;U.reject=function(da){return new U(function(ta,ea){ea(da)})};U.race=
function(da){return new U(function(ta,ea){for(var la=$jscomp.makeIterator(da),qa=la.next();!qa.done;qa=la.next())Y(qa.value).callWhenSettled_(ta,ea)})};U.all=function(da){var ta=$jscomp.makeIterator(da),ea=ta.next();return ea.done?Y([]):new U(function(la,qa){function ya(tb){return function(pb){Oa[tb]=pb;ua--;0==ua&&la(Oa)}}var Oa=[],ua=0;do Oa.push(void 0),ua++,Y(ea.value).callWhenSettled_(ya(Oa.length-1),qa),ea=ta.next();while(!ea.done)})};return U},"es6","es3");
$jscomp.checkStringArgs=function(q,K,Y){if(null==q)throw new TypeError("The 'this' value for String.prototype."+Y+" must not be null or undefined");if(K instanceof RegExp)throw new TypeError("First argument to String.prototype."+Y+" must not be a regular expression");return q+""};
$jscomp.polyfill("String.prototype.startsWith",function(q){return q?q:function(K,Y){var na=$jscomp.checkStringArgs(this,K,"startsWith");K+="";var U=na.length,va=K.length;Y=Math.max(0,Math.min(Y|0,na.length));for(var da=0;da<va&&Y<U;)if(na[Y++]!=K[da++])return!1;return da>=va}},"es6","es3");
$jscomp.iteratorFromArray=function(q,K){q instanceof String&&(q+="");var Y=0,na=!1,U={next:function(){if(!na&&Y<q.length){var va=Y++;return{value:K(va,q[va]),done:!1}}na=!0;return{done:!0,value:void 0}}};U[Symbol.iterator]=function(){return U};return U};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(K){return K})}},"es6","es3");
$jscomp.polyfill("Array.from",function(q){return q?q:function(K,Y,na){Y=null!=Y?Y:function(ta){return ta};var U=[],va="undefined"!=typeof Symbol&&Symbol.iterator&&K[Symbol.iterator];if("function"==typeof va){K=va.call(K);for(var da=0;!(va=K.next()).done;)U.push(Y.call(na,va.value,da++))}else for(va=K.length,da=0;da<va;da++)U.push(Y.call(na,K[da],da));return U}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var q={},K=Object.create(new $jscomp.global.Proxy(q,{get:function(Y,na,U){return Y==q&&"q"==na&&U==K}}));return!0===K.q}catch(Y){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(q,K){return Object.prototype.hasOwnProperty.call(q,K)};
$jscomp.polyfill("WeakMap",function(q){function K(){if(!q||!Object.seal)return!1;try{var la=Object.seal({}),qa=Object.seal({}),ya=new q([[la,2],[qa,3]]);if(2!=ya.get(la)||3!=ya.get(qa))return!1;ya.delete(la);ya.set(qa,4);return!ya.has(la)&&4==ya.get(qa)}catch(Oa){return!1}}function Y(){}function na(la){var qa=typeof la;return"object"===qa&&null!==la||"function"===qa}function U(la){if(!$jscomp.owns(la,da)){var qa=new Y;$jscomp.defineProperty(la,da,{value:qa})}}function va(la){if(!$jscomp.ISOLATE_POLYFILLS){var qa=
Object[la];qa&&(Object[la]=function(ya){if(ya instanceof Y)return ya;Object.isExtensible(ya)&&U(ya);return qa(ya)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(q&&$jscomp.ES6_CONFORMANCE)return q}else if(K())return q;var da="$jscomp_hidden_"+Math.random();va("freeze");va("preventExtensions");va("seal");var ta=0,ea=function(la){this.id_=(ta+=Math.random()+1).toString();if(la){la=$jscomp.makeIterator(la);for(var qa;!(qa=la.next()).done;)qa=qa.value,this.set(qa[0],qa[1])}};ea.prototype.set=
function(la,qa){if(!na(la))throw Error("Invalid WeakMap key");U(la);if(!$jscomp.owns(la,da))throw Error("WeakMap key fail: "+la);la[da][this.id_]=qa;return this};ea.prototype.get=function(la){return na(la)&&$jscomp.owns(la,da)?la[da][this.id_]:void 0};ea.prototype.has=function(la){return na(la)&&$jscomp.owns(la,da)&&$jscomp.owns(la[da],this.id_)};ea.prototype.delete=function(la){return na(la)&&$jscomp.owns(la,da)&&$jscomp.owns(la[da],this.id_)?delete la[da][this.id_]:!1};return ea},"es6","es3");
$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(q){function K(){if($jscomp.ASSUME_NO_NATIVE_MAP||!q||"function"!=typeof q||!q.prototype.entries||"function"!=typeof Object.seal)return!1;try{var ea=Object.seal({x:4}),la=new q($jscomp.makeIterator([[ea,"s"]]));if("s"!=la.get(ea)||1!=la.size||la.get({x:4})||la.set({x:4},"t")!=la||2!=la.size)return!1;var qa=la.entries(),ya=qa.next();if(ya.done||ya.value[0]!=ea||"s"!=ya.value[1])return!1;ya=qa.next();return ya.done||4!=ya.value[0].x||"t"!=ya.value[1]||!qa.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(q&&$jscomp.ES6_CONFORMANCE)return q}else if(K())return q;var Y=new WeakMap,na=function(ea){this.data_={};this.head_=da();this.size=0;if(ea){ea=$jscomp.makeIterator(ea);for(var la;!(la=ea.next()).done;)la=la.value,this.set(la[0],la[1])}};na.prototype.set=function(ea,la){ea=0===ea?0:ea;var qa=U(this,ea);qa.list||(qa.list=this.data_[qa.id]=[]);qa.entry?qa.entry.value=la:(qa.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:ea,value:la},qa.list.push(qa.entry),this.head_.previous.next=qa.entry,this.head_.previous=qa.entry,this.size++);return this};na.prototype.delete=function(ea){ea=U(this,ea);return ea.entry&&ea.list?(ea.list.splice(ea.index,1),ea.list.length||delete this.data_[ea.id],ea.entry.previous.next=ea.entry.next,ea.entry.next.previous=ea.entry.previous,ea.entry.head=null,this.size--,!0):!1};na.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=da();this.size=0};na.prototype.has=
function(ea){return!!U(this,ea).entry};na.prototype.get=function(ea){return(ea=U(this,ea).entry)&&ea.value};na.prototype.entries=function(){return va(this,function(ea){return[ea.key,ea.value]})};na.prototype.keys=function(){return va(this,function(ea){return ea.key})};na.prototype.values=function(){return va(this,function(ea){return ea.value})};na.prototype.forEach=function(ea,la){for(var qa=this.entries(),ya;!(ya=qa.next()).done;)ya=ya.value,ea.call(la,ya[1],ya[0],this)};na.prototype[Symbol.iterator]=
na.prototype.entries;var U=function(ea,la){var qa=la&&typeof la;"object"==qa||"function"==qa?Y.has(la)?qa=Y.get(la):(qa=""+ ++ta,Y.set(la,qa)):qa="p_"+la;var ya=ea.data_[qa];if(ya&&$jscomp.owns(ea.data_,qa))for(ea=0;ea<ya.length;ea++){var Oa=ya[ea];if(la!==la&&Oa.key!==Oa.key||la===Oa.key)return{id:qa,list:ya,index:ea,entry:Oa}}return{id:qa,list:ya,index:-1,entry:void 0}},va=function(ea,la){var qa=ea.head_;return $jscomp.iteratorPrototype(function(){if(qa){for(;qa.head!=ea.head_;)qa=qa.previous;for(;qa.next!=
qa.head;)return qa=qa.next,{done:!1,value:la(qa)};qa=null}return{done:!0,value:void 0}})},da=function(){var ea={};return ea.previous=ea.next=ea.head=ea},ta=0;return na},"es6","es3");$jscomp.findInternal=function(q,K,Y){q instanceof String&&(q=String(q));for(var na=q.length,U=0;U<na;U++){var va=q[U];if(K.call(Y,va,U,q))return{i:U,v:va}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(q){return q?q:function(K,Y){return $jscomp.findInternal(this,K,Y).i}},"es6","es3");
var svManager={getInstance:function(){var q=window.$rdp;return q&&q.running&&q.running()?q:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(q){var K={};K.id=q.id;K.server=q.id;K.displayName=q.displayName||q.id;if(q=q.rdp){for(var Y in q)K[Y]=q[Y];K.user=q.username||"";K.pwd=q.password||"";K.useConsole=q.console||!1;K.legacyMode=q.leagacyMode||q.legacyMode||!1;K.server_bpp=q.color||16;K.exe=q.remoteProgram||"";K.args=q.remoteArgs||"";K.startProgram=0<K.exe.length?"app":K.command&&0<K.command.length?"shell":"noapp"}return K}
function Rdp2(q){q=svGlobal.util.getServerArgs(q);if(!q||!q.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var K=q.gateway||"",Y=0,na=0,U=16,va=1==q.useSSL||"true"==q.useSSL||"on"==q.useSSL||null;q.width&&(Y=parseInt(q.width,10));q.height&&(na=parseInt(q.height,10));q.color&&(U=parseInt(q.color,10));q.server_bpp&&(U=parseInt(q.server_bpp,10));q=hi5.browser.obj2url(q);null===va&&(va="https:"==location.protocol);return new Rdp((va?"wss://":"ws://")+K+"/RDP?"+q,Y,na,U)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(q,K,Y,na){function U(a){return"on"==a||"true"==a||1==a}function va(){var a=n.gateway;n.ongetgatewayaddress&&(a=n.ongetgatewayaddress(a));return a}function da(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ta(a,b){a=ka[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function ea(){return O.displayName||O.server||O.symlink||O.id||"undefined"}function la(a){n.loadbalanceToken||
(n.loadbalanceToken=ka.loadbalanceTokenName?ka.loadbalanceTokenName+"="+a:"")}function qa(a,b,c){n.ontitlechange&&(a=n.ontitlechange(a,c));n.setTitle&&a&&(b=b||window,b.document.title=a)}function ya(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return O.invitation||n.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(Ma?Ma.postMessage({type:0,cmd:1,data:a}):Ca&&Ca.setColor(a));return!0}function Oa(a,b,c,e){Ka=a;La=b;Wb=Xb=0;Yb=Ka-1;Zb=La-1;Va&&(Ka=(O.waWidth||
hi5.browser.getScreenWidth())|0,La=(O.waHeight||hi5.browser.getScreenHeight())|0);O.minWidth&&Ka<O.minWidth&&(Ka=O.minWidth|0);O.minHeight&&La<O.minHeight&&(La=O.minHeight|0);Ka&=-4;La&=-4;svGlobal.logger.warn("resolution changed, w:"+Ka+" h:"+La);var d=Ka,h=La;sa?sa.resize(d,h):sa=new yc(d,h);ia.setSize(Ka,La,Va?"hidden":null);if(c||Ka!=a||La!=b)Ma?Ma.postMessage({type:0,cmd:2,data:{w:Ka,h:La}}):Ca&&Ca.setResolution(Ka,La);if(n.onresolutionchange&&!e)n.onresolutionchange(a,b)}function ua(a){!bb&&
Ia&&(Ma?($b.data=a,"string"!=typeof a?Ma.postMessage($b,[a]):Ma.postMessage($b)):Ca.writeRawInput(a))}function tb(a){switch(a){case "\r":break;case "\n":n.writeScancode(28);break;case "\t":n.writeScancode(15);break;default:ua("86"+a)}}function pb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),h=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=h?5:9;c=new Uint8Array(e+c);c[0]=a;if(h)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{h=b.name;for(var p=Math.min(h.length,8),L=0;L<p;L++)c[1+L]=h.charCodeAt(L)}c.set(d,e);ua(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Gb(a){if(n){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};n.displayMsg&&n.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(n.onerror)n.onerror(a)}}function zc(a){if(n){var b=__svi18n.info[a];b||(b="info "+a);n.displayMsg&&n.showMessage(b);svGlobal.logger.info(b)}}function ac(){var a=Ia;qb=Ia=!1;
Ma?Ma.postMessage({type:0,cmd:3}):Ca&&Ca.resetStatus();a&&(Ia=a)}function bc(a){Na||(Na=new hi5.file.UploadManager(new hi5.file.WsFileService(ua)),Na.addEvent("beforeupload",function(b,c,e){if(n.beforeupload)return n.beforeupload(b,c,e)}),Na.addEvent("fileuploaded",function(b,c,e){if(n.onfileuploaded)n.onfileuploaded(b,c,e)}),Na.addEvent("uploaded",function(b,c){if(n.onuploaded)n.onuploaded(b,c)}),Na.addEvent("uploadingCancelled",function(){if(n.onuploadingCancelled)n.onuploadingCancelled()}));a.setFileHandler(Na)}
function Ac(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ia&&(e=!0,ua("8C5"+d.exe+"\t"+d.args+"\t"+n.sessionInfo.appInfo.session))}}function wd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Bc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Hb(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function xd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Cc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Dc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var h=[];e&1?h.push("usb"):e&2?h.push("nfc"):e&4?h.push("ble"):e&16?h.push("internal"):e&32&&h.push("hybrid");
d.transports=h}b.push(c)}}return b}function Cc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function yd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function zd(a,b){var c,e,d,h,p,L,A,E,J,x,z,P,t,y,B,r,F,I,S,X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){if(1==Q.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var oa=$jscomp.makeIterator(e),w=oa.next();!w.done;w=oa.next())w=w.value,"USB"==w.toUpperCase()||"NFC"==w.toUpperCase()||"BLE"==w.toUpperCase()||"INTERNAL"==w.toUpperCase()||w.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+ub(new Uint8Array(d))),p=Hb(d),h=p.attStmt;if(L=a.clientDataJSON)console.log("==== clientDataJson bytes: "+ub(new Uint8Array(L))),A=window.origin,E=(new TextDecoder).decode(L),J=JSON.parse(E),J.origin&&(J.origin=A);x=a.getAuthenticatorData();
if(!x)return Q.jumpTo(0);z=new Uint8Array(x);console.log("==== authenticatorData bytes: "+ub(z));return b?(P=b.id)?Q.yield(Ad(P),5):Q.jumpTo(0):Q.jumpTo(0)}t=Q.yieldResult;y=new Uint8Array(t);console.log("==== hash of realRpID: "+ub(y));B=new hi5.DataBuffer(new Uint8Array(z.byteLength));B.setBytes(y);r=z.slice?z.slice(32,z.length):z.subarray(32,z.length);B.setBytes(r);B.markEnd();F=B.getData();console.log("==== newAuthDataBytes: "+ub(new Uint8Array(F)));I={1:"packed",2:F,3:h};S=CBOR.encode(I);X=new hi5.DataBuffer(new Uint8Array(S.byteLength+
1));X.setByte(0);X.setBytes(S);X.markEnd();return Q.return(X.getData())})}function Ad(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Bd(b))})}function Bd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function ub(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function Cd(){var a=0,b=0,c=new n.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),h=e.getLittleEndian16(),p=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(p){case 1:case 4097:p=new RdpBuffer(new Uint8Array(6),0,6);p.setByte(6);p.setByte(1);p.setLittleEndian16(h);p.setLittleEndian16(0);p.markEnd();c.send(p);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:h=e.getLittleEndian16();a+=h;break;case 43:case 1065:case 1577:43==p&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(h);d.setLittleEndian16(43==p?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:h=e.getLittleEndian32();p=e.getLittleEndian32();
e=e.getLittleEndian32();cc={baseRTT:h,bandwidth:p,averageRTT:e};if(n.onnetworkresult)n.onnetworkresult(cc);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};n.addGatewayChannel(c)}function Dd(a,b,c,e,d){dc.set(a,b);ec.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=
a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ed(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ec(){var a="";O&&U(O.connectif)&&O.symlink&&"sessionStorage"in window&&(a="SV_"+O.symlink,O.domain&&(a+=O.domain),O.user&&(a+=O.user));return a}function Fd(){var a=hi5.appcfg.persistentId?
window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function fc(){if(!Ia){qb=!1;var a="";bb?Fa.init(!1,!0,!1,0,!1,!1):a=n.getRuntimeURL();void 0==ka.wsPost&&(ka.wsPost=!1);n.oncreatewebsocket&&(Ma=null);Ma?(bb&&(bb.onopen=gc,bb.onclose=Ab,bb.onmessage=function(c){hc.data=c.data;Ma.postMessage(hc,[hc.data])}),Ma.postMessage({type:0,cmd:0,data:{addr:a,width:Ka,height:La,
server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ka.wsPost}})):(Ca=new RdpGeneral(bb||a,Ka,La,fb,sa,!1,ka.wsPost),Ca.oncreatewebsocket=n.oncreatewebsocket,Ca.run());Ma?Ma.addEventListener("message",Fc,!1):(Ca.onopen=gc,Ca.onmessage=Gc,Ca.onclose=Ab,Ca.onerror=Gb,Ca.oninfo=zc,Ca.onloggedin=ic,Ca.onresolutionchange=function(c,e){Oa(c,e,!1,O.monitorDef&&0<=O.monitor?!0:!1)},Ca.onAltSecWindows=Hc,Ca.onMoveCursor=jc,Ca.onCloseSurface=Ic,Ca.onColorChange=ya,Ca.onHistoryReceived=function(){kc()},
Ca.onLockKeyState=function(c){if(n.onLockKeyState)n.onLockKeyState(c)});if(a=ia.getSurface(ia.size()-1))Va?a&&(a.remoteApp=new Ac(O.exe,O.args,"")):qa(ea(),a.getWindow());if(O.invitation&&!U(O.shadow)){var b=null;a&&(b=a.initChat(O.expert));Bb=new n.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,O.novice)};b&&(b.onchat=function(c){if(Ia){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();
Bb.send(e)}});n.addGatewayChannel(Bb)}}}function Fc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:gc();break;case 1:Ab(a.expected);break;case 2:Gb(a.code);break;case 3:zc(a.code);break;case 4:ic();break;case 5:Oa(a.w,a.h,!1,O.monitorDef&&0<=O.monitor?!0:!1);break;case 6:jc(a.x,a.y,!0);break;case 7:Ic();break;case 8:0==a.id&&kc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:ya(a.color);break;case 10:if(n.onLockKeyState)n.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:sa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:sa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:sa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:sa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:sa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:sa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Jc(a);break;case 10:Gc(a);break;case 11:Ua.attach(a.data,0,a.data.length);Hc(Ua,a.size);
break;case 12:sa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:sa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:sa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:sa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:sa.putFont(a.font,a.character,a.glyph);break;case 17:sa.putCursor(a.idx,
a.cursor);break;case 18:sa.setCursor(a.idx);break;case 19:sa.getHistory(ua,function(){Ma.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);sa.setHistory(a.order,Ua);break;case 21:sa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Kc(a){Qa&&Qa.check(a)}function gc(){Ia=!0;var a="87"+navigator.userAgent+"\t";Ib=hi5.tool.uuid();document.cookie=Ib+"=sv";ua(a+Ib);if(n.onopen)n.onopen();ka.joinCloseMode&&
n.setJoinCloseMode(ka.joinCloseMode)}function Ic(){ia&&ia.close()}function Gc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=jb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Da.tag=a.getLittleEndian16();Da.channels=a.getLittleEndian16();Da.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Da.bitsPerSample=a.getLittleEndian16();
svGlobal.logger.info("Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec);Ma&&Ma.postMessage({type:0,cmd:5,data:{tag:Da.tag,channels:Da.channels,samplePerSec:Da.samplePerSec,bitsPerSample:Da.bitsPerSample}});41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);lc(a,b,c,0);kb||(c+=Date.now()-e,ua("8A"+b+","+c))}Qa&&Qa.check();
break;case 56:Lc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Mc(Ua);break;case 62:Nc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Oc(Ua);Qa&&Qa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Fa[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Fa[b].newInstance?(Fa[a]=Fa[b].newInstance(),Fa[a].id=a):(Fa[b].id=a,Fa[a]=Fa[b]),Fa[a].onopen)Fa[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+
b+" id:"+a);break;case 3:Fa[a]&&Fa[a].process(b);break;case 4:if(Fa[a]&&Fa[a].onclose)Fa[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:Gd(Ua);break;default:if(n.onunknownmessage)n.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:ua("87"+navigator.userAgent);break;case 15:if(n){mc=!1;vb=n.reconnectTimes;(n&&0==n.mode||U(O.connectif))&&kc();b="";for(b in lb)if((c=lb[b])&&c.onopen)c.onopen();
for(b in jb)if((c=jb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&n&&(n.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(n.onnotify)n.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&n.onerror)n.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;n.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ia.drawLicense(a);
break;case 50:if(Ia)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Hd(a);break;case 2:Cb?(Cb.type==a?n.writeRawInput("881"+a+"\t"+Cb.text):n.writeRawInput("881ERROR\t"),Cb=null):!(b=ia.getFocused())||b.processClipReq(a)||!ka.clipWarnAlways&&Pc||!O||O.leagacyMode||(n.showMessage(__svi18n.info.menucopy,null,5E3),Pc=!0);break;case 5:(b=ia.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ia.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=va()+b[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+
a+" name:"+b[1]+" driver:"+b[2]);n.onprintingready&&n.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ia.getFocused())&&b.showPDF(a);break;case 56:Lc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ia.getWinById(parseInt(b[0]))){if(!ia.hasApp(b[1])){(c=ia.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(n.onremoteappstart)n.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&n.ontitlechange)n.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Id(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(cb&16||cb&65536)?(Jb=!1,Na=null):(cb&16&&(Jb=!0),Na||(a=ia.getFocused())&&bc(a));cb&64&&n.showMessage(__svi18n.info.recording);Na&&(Na.setUpload(!(cb&128)),Na.setDownload(!(cb&131072)),Na.canCopyFile=0!=(cb&65536));ia.execute("setFeature",[cb]);break;case 60:Mc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);ya(a.color);
(b=a.server)&&n&&(n.server=a.server);Qc=a.length;c=ia.getFocused();Va=1==a.isRail;c&&(1!=n.mode&&c.setAutoScale(!Va),b&&qa(ea(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Jb=!0,bc(c));if(n.onopened)n.onopened(a);break;case 1:a=a.duration;if(n.onprogress)n.onprogress(a,Qc);break;case 2:2==a.status?(ac(),Ia=!0):(b=0==a.status,b==sa.isPaused()||n.onsessionpause&&n.onsessionpause(b,a)||(sa.pause(b),b||ia.repaint(0,0,sa.width-1,sa.height-1),a.warn&&n.showMessage(b?
__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Nc(a);break;case 63:Oc(b64ToBuffer(a));break;default:if(n.onunknownmessage)n.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function kc(){if(!kb&&!Wa&&(Wa=!0,n&&(ka.pingInterval&&n.startPing(ka.pingInterval),n.onready)))n.onready()}function Gd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ua(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=
65536,ia.execute("setFeature",[cb]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(n.onLockKeyState)n.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();n.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=
a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);n.sessionInfo.appInfo.twoFAQR=a;n.ontwofaqr&&n.ontwofaqr(a)||2==b&&ia.execute("showTwoFAQR");break;case 1:sa.pause(!0,!0);if(n.ontwofacode&&n.ontwofacode())return;(a=ia.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!n.ontwofaresult||!n.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ia.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c=
"image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var h=new Uint8Array(2+d.length);h[0]=146;h[1]=8;h.set(d,2);ua(h.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Jd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var h=ia.getFocused();h&&Ia&&(h=h.getThumbnail(a))&&h.length!=d&&(ua("8E7"+h),d=h.length)},b))};this.stop=function(){clearInterval(c)}}function Kd(a,b){!Ya||Ya.width==
a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Jd(a,b));Ya.start()}function Oc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Nc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=n.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ac();Ia=!0;a=d.width;e=d.height;if(a==Ka&&e==La)break;Oa(a,e,!1,!1);break;case 1:d=JSON.parse(c);n.sessionInfo.joinedSessions.push(d.numericId);n.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||
ka.alertJoin)n.onsessionjoin&&(a=n.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&n.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);n.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=n.sessionInfo.joiners;c=0;for(var h=b.length;c<h;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ka.alertJoin)n.onsessionexit&&(a=n.onsessionexit(d)),!a&&__svi18n.info.exitsession&&n.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,
d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ia.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;n.ongivecontrol&&(a=n.ongivecontrol());if(a)break;n.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ia.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;n.ontakebackcontrol&&(a=n.ontakebackcontrol());if(a)break;
n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);n.onrequirecontrol&&(a=n.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;sa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));n.showMessage({title:a,msg:e,cbYes:function(){n.giveControl(d.numericId);this.destroy();sa.isPaused()&&n.pauseSession(n.sessionInfo.appInfo.numericId,!1)},cbNo:function(){n.refuseControl(d.numericId);this.destroy()},html:!0});
break;case 6:ia.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Oa(d.width,d.height,!0,O.monitorDef&&0<=O.monitor?!0:!1);d.color&&(ya(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(n.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);mc=!0;if(n.onrequestcredential&&n.onrequestcredential(d,Ra.reconnect))break;if(n.onautherror&&n.onautherror(d,Ra.reconnect))break;ia.getFocused().requestCredential(d,Ra.reconnect);break;
case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Kd(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);n.onrequirejoin&&(a=n.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);n.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){n.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){n.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&ic();break;case 14:if(d=JSON.parse(c),n.oncontrolchange)n.oncontrolchange(d)}}
function Mc(a){switch(a.getByte()){case 32:if(!sa.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,h=void 0;ka.noCursorName||(d=a.getLittleEndian32(),n.sessionInfo.appInfo&&(h=n.sessionInfo.appInfo.sessions[d]));jc(c,e,!0,h,d,b)}}}function jc(a,b,c,e,d,h){sa.isPaused()||ia.getFocused().moveCursor(a,b,c,e,d,h)}function Jc(a){ia.setCursor(a)}function Ld(a){var b=ka.page&&ka.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+
b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=va();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Lc(a){a=JSON.parse(a);nc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",nc),c.setItem("appInfo.numericId",b));la(a.appId);a.server||(a.server=ea());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?
1!=n.mode&&ia.execute("setAutoScale",[!0]):(n.mode=0,U(O.connectif)&&ia.setSize(Ka,La),ka.disableJoinedAppResize&&(n.windowState=0));var e=va();b=Ld("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),n.protocol="http"==c.substring(0,e)?"ws":"wss",n.gateway=c,b+="&gateway="+encodeURIComponent(c));b=n.modifyURL(b);a.joinLink=b;n.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Oa(Ka,La,!0,!0),qb||1==n.mode||ia.execute("setAutoScale",
[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ka.cursorNameOnly=a.isAssistance;if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function Id(a){if(Na){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Na.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Na.confirmId(c[0],c[1],c[2]);break;case 2:Na.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Na.close(c[0]);break;case 9:a='<a href="'+n.modifyURL(va()+
c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ia.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Na.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function lc(a,b,c,e){if(!Md||sa.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Da.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Da.tag)oc||(oc=new MSGSM),b=
oc.decode(b,d,e),d=0,e=b.length;var h=Da.bitsPerSample;var p=Math.floor(e/(h>>3));var L=c=e=0;a||(e=Math.pow(2,h-1)-1,c=-e-1,L=Math.pow(2,h));h=Da.channels;var A=Math.floor(p/h),E=Ta.getBuffer(A),J=E.getChannelData(0),x=E.getChannelData(1);p=0;if(a)for(;p<A;)1==h?x[p]=J[p]=b[d++]:(J[p]=b[d++],x[p]=b[d++]),p++;else for(;p<A;)a=b[d++]|b[d++]<<8,a>e?(a-=L,a/=-c):a/=e,1==h?J[p]=a:(J[p]=a,a=b[d++]|b[d++]<<8,a>e?(a-=L,a/=-c):a/=e),x[p]=a,p++;return Ta.playBuffer(E)}function Rc(a){if(!n.openLink||2E3<a.length)return!1;
var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:n.onurlredirection&&n.onurlredirection(b)?!0:(a=ia.getFocused())?a.processLink(b):!1:!1}function Nd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=
a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=n.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Hd(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(n.onservercopy&&n.onservercopy(a)||Rc(a))){var b=ia.getFocused();b&&b.copyToClip(Nd(a))}setTimeout(function(){ua("883")},999)}}function ic(a){if(!qb&&(setTimeout(function(){Ia&&ua("884")},333),n.onloggedin))n.onloggedin();pc=qb=!0;a&&a.sessionId&&(n.sessionInfo.sessionId=a.sessionId);Va&&1!=
n.mode&&ia.execute("setAutoScale",[!1]);Na&&(Na.enabled=!0);Kb&&!Va&&(sa.setContext(ia.getFocused().context),ia.repaint(0,0,sa.width-1,sa.height-1))}function Ab(a){if(n){hi5.browser.cookie.delete(Ib);svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));n.onagentmessage&&(n.onagentmessage=null);if(n.onagentclose)n.onagentclose();var b=Ec();b&&n.sessionInfo.appInfo&&0==n.mode&&(sessionStorage[b]=n.sessionInfo.appInfo.session);if(n&&(b=1!=n.mode,!Ia&&b&&Gb("connection"),
b=b&&(Ia||vb<n.reconnectTimes)&&0<vb&&!a,Wa=Ia=!1,b)){vb--;__svi18n.info.reconnecting&&n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-vb)+"/"+n.reconnectTimes,null,3E3);setTimeout(fc,ka.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+vb);return}if(mc)svGlobal.logger.info("Req credential");else{Qa&&(n.stopPing(),Qa=null);Ma&&(Ma.removeEventListener("message",Fc,!1),Ma.postMessage({type:0,cmd:4}),Ma.terminate(),Ma=null);Na&&(Na.release(),Na=null);Sa=q=null;Fa&&(Fa.close(),
Fa=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);n.player&&(n.player=null);Db=null;try{if(n.onclose)n.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ia&&(ia.close(),ia=null)}catch(c){svGlobal.logger.warn(c)}Ua=null;Ca&&(Ca.onopen=null,Ca.onmessage=null,Ca.onclose=null,Ca.onerror=null,Ca.close(),Ca=null);ia=Ra=null;sa&&(sa.release(),sa=null);hi5.browser.isChromeApp?
chrome.runtime.onSuspend.removeListener(n.close):window.removeEventListener("unload",n.close,!1);window&&window.$rdp==n&&(window.$rdp=null);n=null}}}function Sc(){Ca&&Ia?Ca.close():Ab(!0)}function Hc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),h=0;16>c&&(h=a.getLittleEndian16());var p=a.getLittleEndian16(),L=a.getLittleEndian16();a.getBytes(p);h&&
a.getBytes(h);if(8<=c&&(h=ia.getFocused())&&h.onremoteappicon){p=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();L=d+L;var A;a=a.getData();for(var E=0,J,x;d<L;)switch(c){case 16:(A=a[d++]|a[d++]<<8)?(x=A>>7&248,J=A>>2&248,A=A<<3&248,x|=x>>5,J|=J>>5,A|=A>>5,e[E++]=A,e[E++]=J,e[E++]=x,e[E++]=255):E+=4;break;case 32:e[E++]=a[d++],e[E++]=a[d++],e[E++]=a[d++],e[E++]=a[d++]}p.putPixels(e,0,e.length);a=ia.getWinById(b);h.onremoteappicon(a,p)}}else 0!=(c&2147483648)?
svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ia.delWin(b)):Od(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((h=ia.getOwnerSurfaceById(b))&&
h.railWin&&h.railWin.setActiveWinId(b,3==ka.windowState),ia.setTitle(b),sa.getContext()||(b=ia.getFocused())&&sa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ia.zOrders,c.length=b,h=0;h<b;h++)c[h]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[h])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Tc(a){var b=ia.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),
Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Od(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ia.getWinById(c);d?e=!0:d=new ia.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+
d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=
(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),
svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var h=d.showState;(2==h&&0!=ka.noMinimize||!e&&3==h&&5==ka.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(h=0!=(b&4)){var p=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(p,
!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=
a.getLittleEndian32());if(0!=(b&2048)){p=a.getLittleEndian32();var L=a.getLittleEndian32();d.winOffsetX=p;d.winOffsetY=L;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==n.windowState?Tc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(p=ia.getFocused())){p=p.getFreeSpace();var A=d.winWidth,E=d.winHeight;if(d.winOffsetX>p.width||d.winOffsetY>p.height||0>A+d.winOffsetX||0>E+d.winOffsetY){var J=(p.width-d.winWidth)/2|0,x=(p.height-d.winHeight)/2|0;0>J&&(J=0);0>x&&(x=0);setTimeout(function(){d.resize(J,x,A,E)},50)}}0!=(b&256)&&(p=a.getLittleEndian16(),0<p&&a.skipPosition(8*p));0!=(b&
4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ia.onWinChange(d);else ia.addWin(d);h&&ia.setTitle(c);c==ia.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ia.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function yc(a,b){function c(f,l,k,g,u){0<u.width?u.union(f,l,k,g):(u.x=f,u.y=l,u.width=k,u.height=g)}function e(f,
l,k,g){for(V=0;V<ja;V++){var u=oa[V];if(f>=u[0]&&l>=u[1]&&k<=u[2]&&g<=u[3])return w[V]}return null}function d(f,l,k,g){if(ja){var u=e(f,l,f+k-1,l+g-1);u&&c(f,l,k,g,u)}else c(f,l,k,g,y)}function h(f,l,k,g,u,v,D){for(var C=u*k+g,G=f.setRGB,aa=f.getRGB,N=0;N<D;N++){for(var m=0;m<v;m++){if(f){var M=aa(g+m,u+N);G(g+m,u+N,~M&16777215)}else l[C]=~l[C]&16777215;C++}C+=k-v}}function p(f,l,k,g,u,v,D,C,G,aa){l=aa*C+G;null==D&&(D=f);for(f=0;f<v;f++){for(G=0;G<u;G++)P[g+f][k+G]=P[g+f][k+G]&D[l]&16777215|4278190080,
l++;l+=C-u}}function L(f,l,k,g,u,v,D,C,G,aa){l=aa*C+G;G=f.setRGB;aa=f.getRGB;null==D&&(D=f);for(f=0;f<v;f++){for(var N=0;N<u;N++){var m=aa(k+N,g+f);G(k+N,g+f,m|D[l]&16777215);l++}l+=C-u}}function A(f,l,k,g){var u=ca;if(u){var v=u.getRGB(l,k);switch(f){case 0:u.setRGB(l,k,0);break;case 1:u.setRGB(l,k,~(v|g)&16777215);break;case 2:u.setRGB(l,k,v&~g&16777215);break;case 3:u.setRGB(l,k,~g&16777215);break;case 4:u.setRGB(l,k,16777215*(~v&g));break;case 5:u.setRGB(l,k,~v&16777215);break;case 6:u.setRGB(l,
k,v^g&16777215);break;case 7:u.setRGB(l,k,~v&g&16777215);break;case 8:u.setRGB(l,k,v&g&16777215);break;case 9:u.setRGB(l,k,v^~g&16777215);break;case 10:break;case 11:u.setRGB(l,k,v|~g&16777215);break;case 12:u.setRGB(l,k,g);break;case 13:u.setRGB(l,k,(~v|g)&16777215);break;case 14:u.setRGB(l,k,v|g&16777215);break;case 15:u.setRGB(l,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+f),u.setRGB(l,k,g)}}}function E(f,l,k,g,u,v,D,C,G){f>C||l>G||(k=f+k-1,k>C&&(k=C),f<v&&(f=v),
k=k-f+1,g=l+g-1,g>G&&(g=G),l<D&&(l=D),g=g-l+1,1>k||1>g||ca.fillRect(f,l,k,g,u))}function J(f,l,k,g,u,v,D,C,G,aa,N,m){if(!(l>N||k>m)){var M=l+g-1;M>N&&(M=N);G=l<G?G:l;M=M-l+1;N=k+u-1;N>m&&(N=m);aa=k<aa?aa:k;m=N-k+1;if(!(1>M||1>m)){N=128;var H=0;D|=4278190080;C|=4278190080;if(G==l&&aa==k&&M==g&&m==u)if(0==f)for(var T=0;T<u;T++){f=k+T;for(var ha=0;ha<g;ha++)0==N&&(H++,N=128),0!=(v[H]&N)&&(P[f][l+ha]=C),N>>=1;H++;N=128;H==v.length&&(H=0)}else for(T=0;T<u;T++){f=k+T;for(ha=0;ha<g;ha++)0==N&&(H++,N=128),
P[f][l+ha]=0!=(v[H]&N)?C:D,N>>=1;H++;N=128;H==v.length&&(H=0)}else if(0==f)for(T=0;T<m;T++){f=k+T;for(ha=0;ha<M;ha++)0==N&&(H++,N=128),l+ha>=G&&f>=aa&&0!=(v[H]&N)&&(P[f][l+ha]=C),N>>=1;H++;N=128;H==v.length&&(H=0)}else for(T=0;T<m;T++){f=k+T;for(ha=0;ha<M;ha++)0==N&&(H++,N=128),l+ha>=G&&k+T>=aa&&(P[f][l+ha]=0!=(v[H]&N)?C:D),N>>=1;H++;N=128;H==v.length&&(H=0)}}}}function x(f,l,k,g,u){this.offset=f;this.baseLine=l;this.width=k;this.height=g;this.fontData=u}function z(f,l,k,g,u,v,D,C,G){this.cache_idx=
f;this.rawData=l;this.none=!l;this.hotX=k;this.hotY=g;this.width=u;this.height=v;this.xorSize=C;this.andSize=G;this.result="";this.distance=0;this.bpp=D;this.system="";if(l){if(!this.distance){f=0;if(l){D=0;for(var aa=l.length;D<aa;D++)0!=l[D]&&(f+=D%u+(D/u|0))}this.distance=f}if(!this.system){a:switch(this.distance){case 507:f="text";break a;case 2046:case 4359:f="default";break a;default:f=""}this.system=f}}f="";if(!this.system&&l){D=u*v*4;f=62+D+C+G;aa=new Uint8Array(f);f=new hi5.DataBuffer(aa,
0,f);f.setLittleEndian16(0);f.setLittleEndian16(2);f.setLittleEndian16(1);f.setByte(u);f.setByte(v);f.setByte(0);f.setByte(0);f.setLittleEndian16(k);f.setLittleEndian16(g);f.setLittleEndian32(40+D+C+G);f.setLittleEndian32(22);f.setLittleEndian32(40);f.setLittleEndian32(u);f.setLittleEndian32(2*v);f.setLittleEndian16(1);f.setLittleEndian16(32);f.setLittleEndian32(0);f.setLittleEndian32(C+G);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);for(k=v-1;0<=k;k--)for(g=
0;g<u;g++)v=l[u*k+g],f.setByte(v&255),f.setByte(v>>8&255),f.setByte(v>>16&255),f.setByte(v>>24&255);f="data:image/x-icon;base64,"+hi5.Base64.enc(f.getData())}this.url=f}var P=[],t=null,y=new hi5.graphic.Rectangle(0,0,0,0),B="Uint8ClampedArray"in window,r=null,F=0,I=0,S=0,X=0,Q=null,oa,w,V=0,ja=0;this.width=a;this.height=b;var W=!1,ca=this,ba={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(f){r=f};this.getDirtyArea=function(){return y};this.setImgRect=function(f,l,k,g){F=f;I=
l;S=k;X=g};this.parseMonitorDef=function(f){var l=f.split(","),k=l.length,g=[];if(1<k){for(var u=!1,v=0;v<k;v++){var D=l[v].split(":");if(4==D.length)g[v]=Array(5),g[v][0]=parseInt(D[0]),g[v][1]=parseInt(D[1]),g[v][2]=parseInt(D[2]),g[v][3]=parseInt(D[3]),g[v][4]=0==g[v][0]&&0==g[v][1]?1:0;else{u=!0;break}}u&&(svGlobal.logger.warn("invaiid monitorDef:"+f),g.length=0)}return g};this.setMonitorLayout=function(f){var l=f.length,k=0;oa=f;for(w=Array(l);k<l;k++)w[k]=new hi5.graphic.Rectangle(0,0,0,0);
ja=l};this.setMonitorCount=function(f){ja=f};this.addImg=function(f){S&&(Q&&URL.revokeObjectURL(Q.src),Q=f)};this.flushImgs=function(){Q&&(URL.revokeObjectURL(Q.src),Q=null,S=0)};this.getData=function(){return P};this.pause=function(f,l){W=f;l&&t&&t.fillRect(0,0,a,b)};this.release=function(){y=null;hi5.Arrays.release(w);ca.flushImgs();P=t=ca=null;ba=ba.imgData=null};this.isPaused=function(){return W};this.setContext=function(f){f!=t&&(t||!f||f.createImageData(1,1).data.buffer||(B=!1),t=f,null!=t&&
(ba.imgData=t.createImageData(a,b)))};this.getContext=function(){return t};this.resize=function(f,l){if(P.length!=l||P[0].length!=f){for(var k=0;k<l;k++)P[k]=new Uint32Array(f);P.length=l;ca.width=a=f;ca.height=b=l;null!=t&&(ba.imgData=t.createImageData(a,b))}};ca.resize(a,b);this.getBuffer=function(){return P};this.setRGB=function(f,l,k){P[l][f]=k|4278190080};this.getRGB=function(f,l){return P[l][f]};this.setRGBs=function(f,l,k,g,u,v,D){var C=f+k,G=l+g;G>b&&(G=b);if(!(f>=a)){C>a&&(k-=C-a);for(C=
l;C<G;C++,v+=D)P[C].set(u.subarray(v,v+k),f);d(f,l,k,g)}};this.moveArea=function(f,l,k,g,u,v){if(0<v){var D=f+u,C=l+v,G;for(G=g-1;0<=G;G--)P[C+G].set(P[l+G].subarray(f,f+k),D)}else if(0>v)for(D=f+u,C=l+v,G=0;G<g;G++)P[C+G].set(P[l+G].subarray(f,f+k),D);else if(0<u){D=f+u;C=l+v;var aa;for(G=k-1;0<=G;G--){var N=D+G;var m=f+G;for(aa=0;aa<g;aa++)P[C+aa][N]=P[l+aa][m]}}else for(D=f+u,C=l+v,G=0;G<k;G++)for(N=D+G,m=f+G,aa=0;aa<g;aa++)P[C+aa][N]=P[l+aa][m];d(f+u,l+v,k,g)};this.getRGBs=function(f,l,k,g,u){var v=
new Uint32Array(k*g),D=f+k;g=l+g;for(var C=0;l<g;l++)v.set(P[l].subarray(f,D),C),C+=k;return u?(u(v),null):v};this.repaint=function(f,l,k,g){var u=ba.imgData.data,v=0,D,C;r&&r.begin("paint");0>f&&(k+=f,f=0);0>l&&(g+=l,l=0);f+k>a&&(k=a-f);l+g>b&&(g=b-l);var G=f+k;var aa=l+g;if(B)for(u=new Uint32Array(u.buffer),C=l;C<aa;C++)u.set(P[C].subarray(f,G),v),v+=a;else{var N=4*(a-k)|0;for(C=l;C<aa;C++){for(D=f;D<G;D++){var m=P[C][D];u[v++]=m&255;u[v++]=m>>8&255;u[v++]=m>>16&255;u[v++]=255}v+=N}}ba.left=f;ba.top=
l;ba.width=k;ba.height=g;r&&r.end("paint");return ba};this.postPaint=d;this.draw=function(f,l,k,g){if(!W&&t)if(Q&&Q.complete&&(t.drawImage(Q,F,I,S,X),URL.revokeObjectURL(Q.src),Q=null),ja){if(f=e(f,l,k,g),f.width)return ca.repaint(f.x,f.y,f.width,f.height),f.width=0,ba}else if(y.width)return ca.repaint(y.x,y.y,y.width,y.height),y.width=0,ba;return null};this.fillRect=function(f,l,k,g,u){var v=f+k,D=l+g;if(P[0].fill)for(var C,G=l;G<D;G++)P[G].fill(u,f,v);else for(G=l;G<D;G++)for(C=f;C<v;C++)P[G][C]=
u;d(f,l,k,g)};this.drawLine=function(f,l,k,g,u){if(l==g){if(f>k){var v=f;f=k;k=v}var D=P[l];k++;if(D.fill)D.fill(u,f,k);else for(v=f;v<k;v++)D[v]=u}else if(f==k)for(l>g&&(v=l,l=g,g=v),g++,v=l;v<g;v++)P[v][f]=u;else{var C=Math.abs(k-f),G=Math.abs(g-l);v=f;D=l;k=k>=f?f=1:f=-1;l=g>=l?g=1:g=-1;if(C>=G){l=f=0;var aa=C;var N=C/2|0;var m=G}else g=k=0,aa=G,N=G/2|0,m=C,C=G;if(!(1>C))for(C++,G=0;G<C;G++)P[D][v]=u,N+=m,N>=aa&&(N-=aa,v+=f,D+=g),v+=k,D+=l}};this.bitBlt=function(f,l,k,g,u,v,D,C,G,aa){var N=ca;
switch(f){case 0:C=N.setRGB;for(N=k;N<k+u;N++)for(G=g;G<g+v;G++)C(N,G,0);break;case 1:f=D;G=aa*C+G;aa=N.setRGB;l=N.getRGB;null==f&&(f=N);for(N=0;N<v;N++){for(D=0;D<u;D++)aa(k+u,g+v,~(l(k+u,g+v)|f[G])&16777215);G+=C-u}break;case 2:f=D;G=aa*C+G;aa=N.setRGB;l=N.getRGB;null==f&&(f=N);for(N=0;N<v;N++){for(D=0;D<u;D++){var m=l(k+u,g+v);aa(k+u,g+v,m&~f[G]&16777215);G++}G+=C-u}break;case 3:h(N,D,C,G,aa,u,v);D?N.setRGBs(k,g,u,v,D,aa*C+G,C):N.moveArea(G,aa,u,v,k-G,g-aa);break;case 4:h(N,null,l,k,g,u,v);p(N,
l,k,g,u,v,D,C,G,aa);break;case 5:h(N,null,l,k,g,u,v);break;case 6:f=D;G=aa*C+G;null==f&&(f=N);for(N=0;N<v;N++){for(aa=0;aa<u;aa++)P[g+N][k+aa]=P[g+N][k+aa]^f[G]&16777215|4278190080,G++;G+=C-u}break;case 7:f=D;G=aa*C+G;aa=N.setRGB;l=N.getRGB;null==f&&(f=N);for(N=0;N<v;N++){for(D=0;D<u;D++)m=l(k+D,g+N),aa(k+D,g+N,~(m&f[G])&16777215),G++;G+=C-u}break;case 8:p(N,l,k,g,u,v,D,C,G,aa);break;case 9:f=D;G=aa*C+G;aa=N.setRGB;l=N.getRGB;null==f&&(f=N);for(N=0;N<v;N++){for(D=0;D<u;D++)m=l(k+D,g+N),aa(k+D,g+N,
m^~f[G]&16777215),G++;G+=C-u}break;case 10:break;case 11:f=D;G=aa*C+G;aa=N.setRGB;l=N.getRGB;null==f&&(f=N);for(N=0;N<v;N++){for(D=0;D<u;D++)m=l(k+D,g+N),aa(k+D,g+N,m|~f[G]&16777215),G++;G+=C-u}break;case 12:D?N.setRGBs(k,g,u,v,D,aa*C+G,C):N.moveArea(G,aa,u,v,k-G,g-aa);break;case 13:h(N,null,l,k,g,u,v);L(N,l,k,g,u,v,D,C,G,aa);break;case 14:L(N,l,k,g,u,v,D,C,G,aa);break;case 15:C=N.setRGB;for(N=k;N<k+u;N++)for(G=g;G<g+v;G++)C(N,G,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+
f)}d(k,g,u,v)};this.drawLineExt=function(f,l,k,g,u,v){if(f==k||l==g){var D;if(l==g)if(k>f){var C=k-f;if(!(1>C))for(D=0;D<C;D++)A(v,f+D,l,u)}else{if(C=f-k,!(1>C))for(D=0;D<C;D++)A(v,k+D,l,u)}else if(g>l){if(C=g-l,!(1>C))for(D=0;D<C;D++)A(v,f,l+D,u)}else if(C=l-g,!(1>C))for(D=0;D<C;D++)A(v,f,g+D,u)}else{var G=Math.abs(k-f),aa=Math.abs(g-l);D=f;C=l;var N,m;var M=k>=f?N=1:N=-1;var H=g>=l?m=1:m=-1;if(G>=aa){H=N=0;var T=G;var ha=G/2>>0;var ra=aa}else m=M=0,T=aa,ha=aa/2>>0,ra=G,G=aa;if(1>G)return;for(aa=
0;aa<=G;aa++)A(v,D,C,u),ha+=ra,ha>=T&&(ha-=T,D+=N,C+=m),D+=M,C+=H}u=Math.min(f,k);f=Math.max(f,k);k=Math.min(l,g);l=Math.max(l,g);0>f-u||0>l-k||d(u,k,f-u+1,l-k+1)};this.drawText=function(f,l,k,g,u,v,D,C,G,aa,N,m,M,H,T,ha,ra,xa,Ea,Ja,Ga){var za=0;1<m?E(aa,N,m,M,u,xa,Ea,Ja,Ga):1==k&&E(v,D,C,G,u,xa,Ea,Ja,Ga);for(var Ha=ha,wa=0;wa<ha;)switch(ra[za+wa]){case 255:var Aa=ra[za+wa+2];if(Aa>Ha-za){wa=ha=0;break}Aa=ra.slice?ra.slice(za,za+Aa):ra.subarray(za,za+Aa);R[ra[za+wa+1]]=Aa;wa+=3;ha-=wa;za=wa;wa=0;
break;case 254:var Pa=(Aa=R[ra[za+wa+1]])?Aa:null;Pa&&0==Pa[1]&&0==(l&32)&&(0!=(l&4)?T+=ra[za+wa+2]:H+=ra[za+wa+2]);wa=wa+2<ha?wa+3:wa+2;ha-=wa;za=wa;wa=0;if(!Pa)break;for(var Za=Pa.length,$a=0;$a<Za;$a++){Aa=ma.getFont(f,Pa[$a]);if(0==(l&32)){var Xa=Pa[++$a];0!=(Xa&128)?(0!=(l&4)?T+=Pa[$a+1]|Pa[$a+2]<<8:H+=Pa[$a+1]|Pa[$a+2]<<8,$a+=2):0!=(l&4)?T+=Xa:H+=Xa}Aa&&(J(k,H+Aa.offset&65535,T+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,u,g,xa,Ea,Ja,Ga),0!=(l&32)&&(H+=Aa.width))}break;default:Aa=ma.getFont(f,
ra[za+wa]),0==(l&32)&&(Xa=ra[za+ ++wa],0!=(Xa&128)?(0!=(l&4)?T+=ra[za+wa+1]|ra[za+wa+2]<<8:H+=ra[za+wa+1]|ra[za+wa+2]<<8,wa+=2):0!=(l&4)?T+=Xa:H+=Xa),Aa&&(J(k,H+Aa.offset&65535,T+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,u,g,xa,Ea,Ja,Ga),0!=(l&32)&&(H+=Aa.width)),wa++}1<m?0<M&&d(aa,N,m,M):0<C&&0<G&&d(v,D,C,G)};this.drawBitmap=function(f,l,k,g,u,v,D,C,G){var aa=Ba.getBitmap(f,l);aa?(f=aa.width,l=aa.height,u>f&&(u=f),v>l&&(v=l),12==G?ca.setRGBs(k,g,u,v,aa.data,C*f+D,f):ca.bitBlt(G,a,k,g,u,v,
aa.data,f,D,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+f+" idx="+l)};this.saveDesktop=function(f,l,k,g,u){ca.getRGBs(f,l,k,g,function(v){fa.save(f,l,k,g,u,v)})};this.restoreDesktop=function(f,l,k,g,u){(u=fa.restore(f,l,k,g,u))?ca.setRGBs(f,l,k,g,u,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(f,l,k){ma.putFont(f,l,k)};this.putBitmap=function(f,l,k){Ba.putBitmap(f,l,k)};this.putCursor=function(f,l){Z.set(f,l)};this.setCursor=function(f){if(!W&&
-1!=f){var l=Z.get(f);if(l)ca.onSetCursor(l);else svGlobal.logger.warn("invalid cursor"+f)}};var pa=0;this.isSendingHistory=function(){return 2E3>Date.now()-pa};this.getHistory=function(f,l){var k=null;(k=Z.toPDU())&&f(k.buffer);if(ca.onGetGfxHistory)ca.onGetGfxHistory(f,l);else{r&&r.begin("his_bitmap");Ba.forEach(function(C,G,aa){if(C){var N=0,m=0;aa=0;for(var M=C.length;aa<M;aa++)C[aa]&&C[aa].data&&(N++,m+=C[aa].raw?C[aa].raw.length:4*C[aa].data.length);if(N&&m){k=new Uint8Array(m+20*N+8);k[0]=
29;k[2]=1;k[3]=4;m=new hi5.DataBuffer(k,4,k.length);m.setLittleEndian32(N);for(aa=0;aa<M;aa++)(N=C[aa])&&N.data&&(m.setLittleEndian16(G),m.setLittleEndian16(aa),m.setLittleEndian16(N.left),m.setLittleEndian16(N.top),m.setLittleEndian16(N.width),m.setLittleEndian16(N.height),m.setLittleEndian16(N.bitsperpixel),m.setLittleEndian16(N.codec),m.setLittleEndian32(N.raw?N.raw.length:4*N.data.length),m.setBytes(N.raw||new Uint8Array(N.data.buffer)));f(k.buffer)}}});r&&r.end("his_bitmap");r&&r.begin("his_font");
(k=ma.toPDU())&&f(k.buffer);r&&r.end("his_font");for(var g=4,u=0,v=R.length;u<v;u++)R[u]&&(g+=R[u].length+6);if(4<g){k=new Uint8Array(g);k[0]=29;k[2]=1;k[3]=7;var D=4;u=0;for(v=R.length;u<v;u++)R[u]&&R[u].length&&(k[D++]=u,k[D++]=u>>8,g=R[u].length,k[D++]=g,k[D++]=g>>8,k[D++]=g>>16,k[D++]=g>>24,k.set(R[u],D),D+=g);f(k.buffer)}(k=fa.toPDU())&&f(k.buffer);l();pa=Date.now()}};this.onHistoryDone=function(){ca.onGetGfxHistory&&n.reconnect(a,b,!0)};this.setHistory=function(f,l){svGlobal.logger.info("setHistory type:"+
f);switch(f){case 4:r&&r.begin("his_bitmap_dec");var k=l.getLittleEndian32();for(f=0;f<k;f++){var g=l.getLittleEndian16(),u=l.getLittleEndian16(),v=l.getLittleEndian16(),D=l.getLittleEndian16(),C=l.getLittleEndian16(),G=l.getLittleEndian16(),aa=l.getLittleEndian16(),N=l.getLittleEndian16(),m=l.getLittleEndian32(),M=new Uint8Array(l.getData().buffer,l.getPosition(),m),H=new Uint8Array(m);H.set(M);M=rdpcodecs.bitmap;switch(N){case 0:var T=new Uint32Array(H.buffer);l.skipPosition(m);break;case 1:switch(aa){case 16:T=
M.decompressInt16(C,G,m,H,0);break;case 24:T=M.decompressInt24(C,G,m,H,0);break;case 32:T=M.decompressInt32(C,G,m,H,0)}l.skipPosition(m);break;case 2:T=new rdpcodecs.NSCodec,T.process(l,aa,C,G),m=T.getData(),T=T.getDataSize(),T=new Uint32Array(T),rdpcodecs.flipimage(m,0,T,C,G,1)}Ba.putBitmap(g,u,new rdpcodecs.Bitmap(T,C,G,v,D,aa,0==N?null:H,N))}r&&r.end("his_bitmap_dec");break;case 5:ma.fromStream(l);break;case 6:Z.fromStream(l);break;case 7:for(;l.has(6);)if(f=l.getLittleEndian16(),m=l.getLittleEndian32())k=
l.getData().subarray(l.getPosition(),l.getPosition()+m),R[f]=k,l.skipPosition(m);break;case 9:fa.fromStream(l);break;default:if(ca.onSetGfxHistory)ca.onSetGfxHistory(f,l)}};var Z=new function(){var f=[],l=!1;this.useRemoteCursor=function(k){l=k};this.set=function(k,g){l&&(g.system="");f[k]=g};this.get=function(k){return f[k]};this.total=function(){return f.length};this.toPDU=function(){for(var k=2,g=2,u=0,v=0,D=f.length,C;v<D;v++)if(C=f[v])u++,g=g+7+(C.rawData?C.rawData.length:0);if(!u)return null;
g=new Uint32Array(g);g[0]=100728861;g[1]=u;for(v=0;v<D;v++)if(C=f[v])if(u=C.rawData?C.rawData.length:0,g[k++]=C.cache_idx|C.bpp<<16,g[k++]=C.hotX|C.hotY<<16,g[k++]=C.width|C.height<<16,g[k++]=C.xorSize,g[k++]=C.andSize,g[k++]=C.distance,g[k++]=u)g.set(C.rawData,k),k+=u;return g};this.fromStream=function(k){var g=k.getPosition();k=new Uint32Array(k.getData().buffer,g);var u=k[0],v=0;for(g=1;v<u;v++){var D=k[g]&65535;var C=k[g++]>>16;var G=k[g]&65535;var aa=k[g++]>>16;var N=k[g]&65535;var m=k[g++]>>
16;var M=k[g++];var H=k[g++];var T=k[g++];var ha=k[g++];var ra=null;ha&&(ra=new Uint32Array(ha),ra.set(k.subarray(g,g+ha)),g+=ha);C=new z(D,ra,G,aa,N,m,C,M,H);T&&(C.distance=T);l&&(C.system="");f[D]=C}}};Z.useRemoteCursor(!!ka.remoteCursor);var fa=new function(){function f(k,g,u,v,D,C){this.x=k;this.y=g;this.cx=u;this.cy=v;this.offset=D;this.data=C}var l=[];this.save=function(k,g,u,v,D,C){k=new f(k,g,u,v,D,C);g=0;for(u=l.length;g<u;g++)if(!l[g]){l[g]=k;return}l.push(k)};this.restore=function(k,g,
u,v,D){for(var C,G=0,aa=l.length;G<aa;G++)if((C=l[G])&&C.x==k&&C.y==g&&C.cx==u&&C.cy==v){if(C.offset==D)return k=C.data,l[G]=null,k;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var k=0,g=2,u=0,v=l.length;u<v;u++)l[u]&&(k++,g+=l[u].data.length+6);if(!k||!g)return null;g=new Uint32Array(g);var D=2;g[0]=151060509;g[1]=k;for(u=0;u<v;u++)if(k=l[u])g[D++]=k.x,g[D++]=k.y,g[D++]=k.cx,g[D++]=k.cy,g[D++]=k.offset,g[D++]=k.data.length,g.set(k.data,D),D+=k.data.length;return g};
this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());for(var g=1,u=k[0],v,D,C,G,aa,N,m,M=0;M<u;M++)v=k[g++],D=k[g++],C=k[g++],G=k[g++],aa=k[g++],N=k[g++],m=new Uint32Array(N),N=g+N,m.set(k.subarray(g,N)),g=N,this.save(v,D,C,G,aa,m)}},R=[],ma=new function(){var f=[];this.putFont=function(l,k,g){f[l]||(f[l]=[]);f[l][k]=g};this.getFont=function(l,k){return f[l]?f[l][k]:null};this.toPDU=function(){var l=0,k,g,u;var v=4;for(var D,C=f.length;l<C;l++)if((u=f[l])&&u.length)for(D=
u.length,k=0;k<D;k++)(g=u[k])&&(v+=15+g.fontData.length);if(5>v)return null;var G=new Uint8Array(v);v=new hi5.DataBuffer(G,0,v);G[0]=29;G[2]=1;G[3]=5;v.skipPosition(4);l=0;for(C=f.length;l<C;l++)if((u=f[l])&&u.length)for(D=u.length,k=0;k<D;k++)if(g=u[k])v.setByte(l),v.setLittleEndian16(k),v.setLittleEndian16(g.offset),v.setLittleEndian16(g.baseLine),v.setLittleEndian16(g.width),v.setLittleEndian16(g.height),v.setLittleEndian32(g.fontData.length),v.setBytes(g.fontData);return G};this.fromStream=function(l){for(;l.has(15);){var k=
l.getByte(),g=l.getLittleEndian16(),u=l.getLittleEndian16(),v=l.getLittleEndian16(),D=l.getLittleEndian16(),C=l.getLittleEndian16(),G=l.getLittleEndian32();G=l.getBytes(G);this.putFont(k,g,new x(u,v,D,C,G))}}},Ba=new function(){var f=[],l=[];this.putBitmap=function(k,g,u){if(32767==g)l[k]&&(l[k].data=null,l[k]=null),l[k]=u;else{var v=f[k];v?v[g]&&(v[g].data=null,v[g]=null):f[k]=v=[];v[g]=u}};this.getBitmap=function(k,g){return 32767==g?l[k]:f[k]?f[k][g]:null};this.forEach=function(k){for(var g=f.length,
u=0;u<g;u++)k(f[u],u,f)}}}function Lb(a){function b(m,M,H){M[H]=m>>24&255;M[H+1]=m>>16&255;M[H+2]=m>>8&255;M[H+3]=m&255}function c(m,M){var H=m.length;M=new Uint8Array(M?H+1:H);for(var T=0;T<H;T++)M[T]=m.charCodeAt(T);return M}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),h={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],
tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},p=this,L=1,A=a?48E3:9E4,E=1,J=!1,x=null;this.initTypes=function(){for(var m in h)h[m]=[m.charCodeAt(0),m.charCodeAt(1),m.charCodeAt(2),m.charCodeAt(3)];h.url=[117,114,108,32]};p.initTypes();this.reset=function(){J=!1;E=L=1};this.close=function(){p&&(p.reset(),p=null)};this.remux=function(m){m.id=L;m.isAudio=a;m.timeScale=a?m.audioHeader.sampleRate:A;if(!J){var M=new P(a),H=new t(m);x=new Uint8Array(M.data.length+H.data.length);
x.set(M.data,0);x.set(H.data,M.data.length);J=!0}m.sequenceNumber=E++;M=new u(m);H=new N(m);m=new Uint8Array(M.data.length+H.data.length);m.set(M.data,0);m.set(H.data,M.data.length);x&&(M=new Uint8Array(x.length+m.length),M.set(x,0),M.set(m,x.length),m=M,x=null);if(p.ondata)p.ondata(m)};var z=function(m){this.type=m;this.data=null};z.prototype.setData=function(){var m=Array.prototype.slice.call(arguments,0),M=m.length,H=8,T;for(T=0;T<M;T++)H+=m[T].byteLength;this.data=new Uint8Array(H);b(H,this.data,
0);this.data.set(this.type,4);H=8;for(T=0;T<M;T++)this.data.set(m[T],H),H+=m[T].byteLength};var P=function(m){var M=z.call(this,h.ftyp)||this;var H=c("mp42"),T=c("mp41"),ha=c("isom"),ra=c("avc1"),xa=c("iso5"),Ea=new Uint8Array([0,0,2,0]);m?M.setData(H,Ea,H,T,ha,xa):M.setData(ha,Ea,ha,T,xa,ra);return M};$jscomp.inherits(P,z);var t=function(m){var M=z.call(this,h.moov)||this;var H=new y(m),T=new B(m);m=new k(m);M.setData(H.data,T.data,m.data);return M};$jscomp.inherits(t,z);var y=function(m){m=z.call(this,
h.mvhd)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]),ha=new Uint8Array([0,0,0,0]),ra=new Uint8Array(4);b(1E3,ra,0);var xa=new Uint8Array([0,1,0,0]),Ea=new Uint8Array([1,0]),Ja=new Uint8Array(10),Ga=new Uint8Array(36);Ga[1]=1;Ga[17]=1;Ga[32]=64;var za=new Uint8Array(24),Ha=new Uint8Array([255,255,255,255]);m.setData(M,H,T,ha,ra,e,xa,Ea,Ja,Ga,za,Ha);return m};$jscomp.inherits(y,z);var B=function(m){var M=z.call(this,h.trak)||this;var H=new r(m);m=new F(m);M.setData(H.data,
m.data);return M};$jscomp.inherits(B,z);var r=function(m){var M=z.call(this,h.tkhd)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,7]),ha=new Uint8Array([0,0,0,0]),ra=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.id,xa,0);var Ea=new Uint8Array(4),Ja=new Uint8Array(8),Ga=new Uint8Array([0,0]),za=new Uint8Array([0,0]),Ha=m.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),wa=new Uint8Array(2),Aa=new Uint8Array(36);Aa[1]=1;Aa[17]=1;Aa[32]=64;var Pa=new Uint8Array(4);Pa[0]=m.width>>8&255;
Pa[1]=m.width&255;Pa[2]=0;Pa[3]=0;var Za=new Uint8Array(4);Za[0]=m.height>>8&255;Za[1]=m.height&255;Za[2]=0;Za[3]=0;M.setData(H,T,ha,ra,xa,Ea,e,Ja,Ga,za,Ha,wa,Aa,Pa,Za);return M};$jscomp.inherits(r,z);var F=function(m){var M=z.call(this,h.mdia)||this;var H=new I(m),T=new S(m);m=new X(m);M.setData(H.data,T.data,m.data);return M};$jscomp.inherits(F,z);var I=function(m){var M=z.call(this,h.mdhd)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array([0,0,0,0]),ra=new Uint8Array([0,
0,0,0]),xa=new Uint8Array(4);b(m.timeScale,xa,0);m=new Uint8Array([85,196]);var Ea=new Uint8Array(2);M.setData(H,T,ha,ra,xa,e,m,Ea);return M};$jscomp.inherits(I,z);var S=function(m){var M=z.call(this,h.hdlr)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array(4);m=m.isAudio?c("soun"):c("vide");var ra=new Uint8Array(12),xa=c("Remote Spark Handler",!0);M.setData(H,T,ha,m,ra,xa);return M};$jscomp.inherits(S,z);var X=function(m){var M=z.call(this,h.minf)||this;var H=new w,T=new W(m);
m.isAudio?(m=new oa,M.setData(m.data,H.data,T.data)):(m=new Q,M.setData(m.data,H.data,T.data));return M};$jscomp.inherits(X,z);var Q=function(){var m=z.call(this,h.vmhd)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,1]),T=new Uint8Array([0,0]),ha=new Uint8Array(6);m.setData(M,H,T,ha);return m};$jscomp.inherits(Q,z);var oa=function(){var m=z.call(this,h.smhd)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0]),ha=new Uint8Array(2);m.setData(M,H,T,ha);return m};
$jscomp.inherits(oa,z);var w=function(){var m=z.call(this,h.dinf)||this;var M=new V;m.setData(M.data);return m};$jscomp.inherits(w,z);var V=function(){var m=z.call(this,h.dref)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,1]),ha=new ja;m.setData(M,H,T,ha.data);return m};$jscomp.inherits(V,z);var ja=function(){var m=z.call(this,h.url)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,1]);m.setData(M,H);return m};$jscomp.inherits(ja,z);var W=function(m){var M=
z.call(this,h.stbl)||this;m=new ca(m);var H=new ma,T=new Ba,ha=new f,ra=new l;M.setData(m.data,H.data,T.data,ha.data,ra.data);return M};$jscomp.inherits(W,z);var ca=function(m){var M=z.call(this,h.stsd)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array([0,0,0,1]);m.isAudio?(m=new ba(m),M.setData(H,T,ha,m.data)):(m=new Z(m),M.setData(H,T,ha,m.data));return M};$jscomp.inherits(ca,z);var ba=function(m){var M=z.call(this,h.mp4a)||this;var H=new Uint8Array(6),T=new Uint8Array([0,
1]),ha=new Uint8Array(8),ra=new Uint8Array([0,2]),xa=new Uint8Array([0,16]),Ea=new Uint8Array([0,0]),Ja=new Uint8Array(2),Ga=m.audioHeader.sampleRate,za=new Uint8Array(4);za[0]=Ga>>8&255;za[1]=Ga&255;za[2]=0;za[3]=0;m=new pa(m);M.setData(H,T,ha,ra,xa,Ea,Ja,za,m.data);return M};$jscomp.inherits(ba,z);var pa=function(m){var M=z.call(this,h.esds)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array([3]),ra=new Uint8Array([25]),xa=new Uint8Array([0,0]),Ea=new Uint8Array([0]),Ja=
new Uint8Array([4]),Ga=new Uint8Array([17]),za=new Uint8Array([64]),Ha=new Uint8Array([21]),wa=new Uint8Array(3),Aa=m.bufferSizeDB;wa[0]=Aa>>16&255;wa[1]=Aa>>8&255;wa[2]=Aa&255;Aa=new Uint8Array(4);b(m.bitRate,Aa,0);var Pa=new Uint8Array(4);b(m.bitRate,Pa,0);var Za=new Uint8Array([5]),$a=new Uint8Array([2]),Xa=m.audioHeader.audioType||2,mb=m.audioHeader.frequencyIdx,wb=m.audioHeader.channelConfig;m=new Uint8Array(2);m[0]=Xa<<3|mb>>1&7;m[1]=(mb&1)<<7|wb<<3;Xa=new Uint8Array([6]);mb=new Uint8Array([1]);
wb=new Uint8Array([2]);M.setData(H,T,ha,ra,xa,Ea,Ja,Ga,za,Ha,wa,Aa,Pa,Za,$a,m,Xa,mb,wb);return M};$jscomp.inherits(pa,z);var Z=function(m){var M=z.call(this,h.avc1)||this;var H=new Uint8Array(6),T=new Uint8Array([0,1]),ha=new Uint8Array([0,0]),ra=new Uint8Array(2),xa=new Uint8Array(12),Ea=new Uint8Array(2);Ea[0]=m.width>>8&255;Ea[1]=m.width&255;var Ja=new Uint8Array(2);Ja[0]=m.height>>8&255;Ja[1]=m.height&255;var Ga=new Uint8Array([0,72,0,0]),za=new Uint8Array([0,72,0,0]),Ha=new Uint8Array(4),wa=
new Uint8Array([0,1]),Aa=c("SparkStreamPlayer"),Pa=new Uint8Array(32);Pa[0]=Aa.length;Pa.set(Aa,1);Aa=new Uint8Array([0,24]);var Za=new Uint8Array([255,255]);m=new fa(m);M.setData(H,T,ha,ra,xa,Ea,Ja,Ga,za,Ha,wa,Pa,Aa,Za,m.data);return M};$jscomp.inherits(Z,z);var fa=function(m){var M=z.call(this,h.avcC)||this;var H=new Uint8Array([1]),T=new Uint8Array([m.sps[1]]),ha=new Uint8Array([m.sps[2]]),ra=new Uint8Array([m.sps[3]]),xa=new Uint8Array([255]),Ea=new Uint8Array([225]),Ja=new Uint8Array(2),Ga=m.sps.byteLength;
Ja[0]=Ga>>8&255;Ja[1]=Ga&255;Ga=new Uint8Array(m.sps);var za=new Uint8Array([1]),Ha=new Uint8Array(2),wa=m.pps.byteLength;Ha[0]=wa>>8&255;Ha[1]=wa&255;m=new Uint8Array(m.pps);M.setData(H,T,ha,ra,xa,Ea,Ja,Ga,za,Ha,m);return M};$jscomp.inherits(fa,z);var R=function(){var m=z.call(this,h.btrt)||this;var M=new Uint8Array([0,28,156,128]),H=new Uint8Array([0,45,198,192]),T=new Uint8Array([0,45,198,192]);m.setData(M,H,T);return m};$jscomp.inherits(R,z);var ma=function(){var m=z.call(this,h.stts)||this;var M=
new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]);m.setData(M,H,T);return m};$jscomp.inherits(ma,z);var Ba=function(){var m=z.call(this,h.stsc)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]);m.setData(M,H,T);return m};$jscomp.inherits(Ba,z);var f=function(){var m=z.call(this,h.stsz)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]),ha=new Uint8Array([0,0,0,0]);m.setData(M,H,T,ha);return m};$jscomp.inherits(f,
z);var l=function(){var m=z.call(this,h.stco)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]);m.setData(M,H,T);return m};$jscomp.inherits(l,z);var k=function(m){var M=z.call(this,h.mvex)||this;m=new g(m);M.setData(m.data);return M};$jscomp.inherits(k,z);R=function(m){m=z.call(this,h.mehd)||this;var M=new Uint8Array([0]),H=new Uint8Array([0,0,0]);m.setData(M,H,d);return m};$jscomp.inherits(R,z);var g=function(m){var M=z.call(this,h.trex)||this;var H=new Uint8Array([0]),
T=new Uint8Array([0,0,0]),ha=new Uint8Array(4);b(m.id,ha,0);m=new Uint8Array([0,0,0,1]);var ra=new Uint8Array([0,0,0,0]),xa=new Uint8Array([0,0,0,0]),Ea=new Uint8Array([0,0,0,0]);M.setData(H,T,ha,m,ra,xa,Ea);return M};$jscomp.inherits(g,z);var u=function(m){var M=z.call(this,h.moof)||this;v.setSequenceNumber(m.sequenceNumber);m=new D(m);M.setData(v.data,m.data);return M};$jscomp.inherits(u,z);R=function(m){var M=z.call(this,h.mfhd)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array(4);
b(m,ha,0);M.setData(H,T,ha);return M};$jscomp.inherits(R,z);R.prototype.setSequenceNumber=function(m){b(m,this.data,12)};var v=new R(1),D=function(m){var M=z.call(this,h.traf)||this;C.setTrackId(m.id);C.setSampleDuration(m.frameDuration);G.setBaseMediaDecodeTime(m.samples[0].timestamp);var H=32+C.data.length+G.data.length;if(m.isAudio)m=new aa(m,null,H);else{for(var T=[],ha=0;ha<m.samples.length;ha++){var ra=m.samples[ha];T.push({size:ra.unitsLength+4*ra.units.length,duration:m.frameDuration||3E3,
compositionTimeOffset:0,flags:{isLeading:0,dependsOn:ra.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:ra.hasIDR?0:1,degradationPriority:0}})}m=new aa(m,T,H)}M.setData(C.data,G.data,m.data);return M};$jscomp.inherits(D,z);R=function(m,M){var H=z.call(this,h.tfhd)||this;H.isAudio=M;var T=new Uint8Array([0]),ha=M?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),ra=new Uint8Array(4);b(m,ra,0);M?(m=new Uint8Array([0,0,0,1]),M=new Uint8Array(4),b(1024,M,0),H.setData(T,ha,ra,m,M)):(m=new Uint8Array([0,
0,2,0,1,1,0,0]),H.setData(T,ha,ra,m));return H};$jscomp.inherits(R,z);R.prototype.setTrackId=function(m){b(m,this.data,12)};R.prototype.setSampleDuration=function(m){this.isAudio||b(m,this.data,16)};var C=new R(0,a);R=function(m){var M=z.call(this,h.tfdt)||this;var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array(4);b(m,ha,0);M.setData(H,T,ha);return M};$jscomp.inherits(R,z);R.prototype.setBaseMediaDecodeTime=function(m){b(m,this.data,12)};var G=new R(0),aa=function(m,M,H){var T=
z.call(this,h.trun)||this;var ha=new Uint8Array([0]),ra=m.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,15,1]),xa=m.isAudio?4:16;H+=xa*(m.isAudio?m.samples.length:M.length)+28;var Ea=new Uint8Array(4);m.isAudio?b(m.samples.length,Ea,0):b(M.length,Ea,0);var Ja=new Uint8Array(4);b(H,Ja,0);if(m.isAudio){H=new Uint8Array(xa*m.samples.length);for(var Ga=0;Ga<m.samples.length;Ga++)b(m.samples[Ga].aacData.byteLength,H,xa*Ga)}else for(H=new Uint8Array(xa*M.length),Ga=0;Ga<M.length;Ga++){m=M[Ga];var za=
xa*Ga;b(m.duration,H,za);b(m.size,H,za+4);var Ha=m.flags,wa=new Uint8Array(4);wa[0]=Ha.isLeading<<2|Ha.dependsOn;wa[1]=Ha.isDependedOn<<6|Ha.hasRedundancy<<4|0|Ha.isNonSync;wa[2]=Ha.degradationPriority&61440;wa[3]=Ha.degradationPriority&15;H.set(wa,za+8);b(m.compositionTimeOffset,H,za+12)}T.setData(ha,ra,Ea,Ja,H);return T};$jscomp.inherits(aa,z);R=function(m){var M=z.call(this,h.sdtp)||this;for(var H=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ha=new Uint8Array(m.length),ra=0;ra<m.length;ra++){var xa=
m[ra].flags;ha[ra]=xa.isLeading<<6|xa.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy}M.setData(H,T,ha);return M};$jscomp.inherits(R,z);var N=function(m){var M=z.call(this,h.mdat)||this;if(m.isAudio){for(var H=new Uint8Array(m.totalByteLength),T=0,ha=0;ha<m.samples.length;ha++){var ra=m.samples[ha].aacData;H.set(ra,T);T+=ra.byteLength}M.setData(H)}else{H=new Uint8Array(4*m.unitNum+m.totalByteLength);for(ha=T=0;ha<m.samples.length;ha++){ra=m.samples[ha];for(var xa=0;xa<ra.units.length;xa++){var Ea=
ra.units[xa],Ja=Ea.data.byteLength;b(Ja,H,T);T+=4;H.set(Ea.data,T);T+=Ja}}M.setData(H)}return M};$jscomp.inherits(N,z)}function qc(a){function b(E,J){this.aacData=E;this.timestamp=J}function c(E,J,x,z){this.audioType=E;this.frequencyIdx=J;this.sampleRate=x;this.channelConfig=z}var e=qc.SAMPLING_FREQUENCY,d=null,h=!0,p=this,L=0;this.reset=function(){L=0;d=null;A.audioHeader=null;a&&a.reset()};var A=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=
1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=function(E,J){var x=E.frequencyIdx;x||(x=e.indexOf(E.sampleRate));-1==x&&console.error("Invalid AAC sampel rate: "+E.sampleRate);d=new c(E.audioType||2,x,E.sampleRate,E.channels||E.channelConfig);A.audioHeader=d;h=!J;if(p.oncodec)p.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(E){if(h){var J=p.readADTSHeader(E);E=E.subarray(J)}J=new b(E,
L);L+=1024;A.samples.push(J);A.totalByteLength+=E.byteLength;E=1/(d.sampleRate/1024);A.duration=E;A.samples[0]&&(A.bitRate=8*A.samples[0].aacData.length/E|0);a&&a.remux(A);A.clear()};this.readADTSHeader=function(E){var J=E[1]&0?9:7,x=(E[2]>>6&3)+1,z=E[2]>>2&15,P=e[z];P||console.error("Invalid Sampling Frequency Index: "+z);var t=((E[2]&1)<<2)+(E[3]>>6&3),y=E[1]>>1&3;0!=y&&console.error("Invalid data format: layer is not 0x00: "+y.toString(16));E.length!=((E[3]&3)<<11)+(E[4]<<3)+(E[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+
E.length);if(d){if(z!=d.frequencyIdx&&(d.frequencyIdx=z,d.sampleRate=P,p.oncodec))p.oncodec("mp4a.40.2",d)}else if(d=new c(x,z,P,t),A.audioHeader=d,p.oncodec)p.oncodec("mp4a.40.2",d);return J}}function Uc(a){function b(){if(0==L)console.error("no more ExpGolomb data");else{var J=0,x=p-L;for(A=0;x<p;){var z=a[x];if(3!=z||0!=a[x-1]||0!=a[x-2])A=A<<8|z,J++;x++;if(4<=J)break}4>J&&(A<<=4-J);E=8*J;L=p-x}}function c(J){if(!(E>J)){J-=E;var x=J>>3;J-=x>>3;L-=x;b()}A<<=J;E-=J}function e(J){var x=Math.min(E,
J),z=A>>>32-x;32<J&&logger.error("Read more than 32 bits:"+J);E-=x;0<E?A<<=x:0<L&&b();x=J-x;return 0<x?z<<x|e(x):z}function d(){var J;for(J=0;J<E;++J)if(0!==(A&2147483648>>>J))return A<<=J,E-=J,J;b();return J+d()}function h(){c(1+d())}var p=a.byteLength,L=p,A=0,E=0;this.readUEG=function(){var J=d();return e(J+1)-1};this.readEG=function(){var J=this.readUEG();return 1&J?1+J>>>1:-1*(J>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};
this.readU32=function(){return e(32)};this.skipScalingList=function(J){var x=8,z=8,P;for(P=0;P<J;P++)0!==z&&(z=this.readEG(),z=(x+z+256)%256),x=0===z?x:z};this.readSPS=function(){var J=0,x=0,z=0,P=0,t=1,y,B=0,r=!0;if(7>a.length)return console.log("no enough SPS data"),null;var F=this.readU8();if(7!=(F&31))return console.error("Invalid SPS type: "+F,a),null;F=this.readU8();e(5);c(3);this.readU8();h();if(100===F||110===F||122===F||244===F||44===F||83===F||86===F||118===F||128===F||138===F||139===F||
134===F||135===F){var I=this.readUEG();3===I&&c(1);h();h();c(1);if(this.readBool()){var S=3!==I?8:12;for(y=0;y<S;y++)this.readBool()&&(6>y?this.skipScalingList(16):this.skipScalingList(64))}}h();y=this.readUEG();if(0===y)this.readUEG();else if(1===y)for(c(1),c(1+d()),c(1+d()),S=this.readUEG(),y=0;y<S;y++)c(1+d());h();c(1);var X=this.readUEG();y=this.readUEG();S=e(1);0===S&&c(1);c(1);this.readBool()&&(J=this.readUEG(),x=this.readUEG(),z=this.readUEG(),P=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var Q=
[1,1];break;case 2:Q=[12,11];break;case 3:Q=[10,11];break;case 4:Q=[16,11];break;case 5:Q=[40,33];break;case 6:Q=[24,11];break;case 7:Q=[20,11];break;case 8:Q=[32,11];break;case 9:Q=[80,33];break;case 10:Q=[18,11];break;case 11:Q=[15,11];break;case 12:Q=[64,33];break;case 13:Q=[160,99];break;case 14:Q=[4,3];break;case 15:Q=[3,2];break;case 16:Q=[2,1];break;case 255:Q=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}Q&&(t=Q[0]/Q[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&
c(24));this.readBool()&&(h(),h());this.readBool()&&(B=this.readU32(),Q=this.readU32(),r=this.readBool(),B=Q/(2*B))}t=Math.ceil((16*(X+1)-2*J-2*x)*t);Q=(2-S)*(y+1)*16-(S?2:4)*(z+P);y="avc1."+(0==a[1]?"00":a[1].toString(16));y+=0==a[2]?"00":a[2].toString(16);y+=0==a[3]?"00":a[3].toString(16);return{width:t,height:Q,profileIdc:F,chromaFormatIdc:I,frameCropLeftOffset:J,frameCropRightOffset:x,frameCropTopOffset:z,frameCropBottomOffset:P,fps:B,fixedFrameRate:r,codec:y}};this.readSliceType=function(){this.readU8();
this.readUEG();return this.readUEG()}}function Pd(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=L;this.unitsLength=A;this.timestamp=d;this.hasIDR=h}function e(){var z=!1;if(p&&J.sps){var P=new c;d+=J.frameDuration||3E3;J.samples.push(P);J.totalByteLength+=A;J.unitNum+=L.length;
J.sequence++;z=!0;if(P.hasIDR&&x.onkeyframe)x.onkeyframe(P)}p=h=!1;L=[];A=0;return z}var d=0,h=!1,p=!1,L=[],A=0,E=Lb.searchStartCode,J=null,x=this;J=new b;this.reset=function(){d=0;h=!1;L=[];A=0;J=new b;a&&a.reset()};this.close=function(){x&&(x.reset(),x=null)};this.parseH264Data=this.parse=function(z){for(var P=[],t=0,y,B,r,F=[0,0];t<z.byteLength;){F[0]=t;E(z,F);var I=F[0];if(-1==I)break;t=F[1];t=I+t;r=z[t];r&=31;y&&(y={type:B,data:z.subarray(y,I)},P.push(y));y=t;B=r}y&&(y={type:B,data:z.subarray(y,
z.byteLength)},P.push(y));for(z=0;z<P.length;z++)switch(F=P[z],t=F.type,t){case 1:case 2:case 3:case 4:L.push(F);A+=F.data.byteLength;p=!0;break;case 5:p=h=!0;L.push(F);A+=F.data.byteLength;break;case 6:break;case 7:t=new Uc(F.data);if(t=t.readSPS()){if(J.width=t.width,J.height=t.height,J.codec=t.codec,J.sps=F.data,t.fps&&(J.frameDuration=9E4/t.fps|0),L.push(F),A+=F.data.byteLength,x.oncodec)x.oncodec(J.codec,t)}else console.log("corrupted sps",F.data);break;case 8:J.pps=F.data;L.push(F);A+=F.data.byteLength;
break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+t)}e()&&J.sps&&(a.remux(J),J.clear())}}function Mb(a,b,c){function e(){for(;A;){if(B.updating){A=!1;break}var I=L.shift();if(!I)break;try{B.appendBuffer(I),E=0}catch(S){L.unshift(I);if("QuotaExceededError"==S.name)if(p(!0))continue;else{if(J.onerror)J.onerror(S);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),J.close();break}E++;console.error("Failed to append buffer, retry "+E,S);if(2<E){if(J.onerror)J.onerror(S);
break}}}}function d(){A=!0;e()}function h(){B=y.addSourceBuffer(x);B.mode="sequence";B.addEventListener("updateend",d);B.addEventListener("error",function(I){console.error(I)});A=!0;J.play(!1);e()}function p(I){var S=Math.min(a.played.end(0),B.buffered.end(0)),X=0,Q=t.length,oa=!1,w=0;if(c)w=S-180,0>w&&console.warn("Not possible, time played secs: "+S);else if(1<Q){var V=Q-2;for(S=9E4*S|0;X<Q;){if(t[X]>S){V=X-2;break}X++}0<=V&&(w=(t[V]+1E3)/9E4)}if(0<w)try{B.remove(0,w),t.splice(0,V+1),oa=!0,console.info("Buffer removed "+
w+" isAudio: "+c)}catch(ja){console.warn("Buffer removal "+w+" failed, retry, isAudio: "+c)}I||(P=setTimeout(p,18E4));return oa}var L=[],A=!1,E=0,J=this,x="",z=null,P=0,t=[],y=null,B=null,r=null,F=null;a.autoplay=!0;this.getKeyFrames=function(){return t};r=new Lb(c);r.ondata=function(I){L.push(I);e()};F=c?new qc(r):new Pd(r);F.onkeyframe=function(I){t.push(I.timestamp)};F.oncodec=function(I,S){var X=c?"audio/mp4;codecs=":"video/mp4;codecs=";X+=I;if(X!=x||(c?z.sampleRate!=S.sampleRate:z.width!=S.width||
z.height!=S.height))if(x=X,z=S,A=!1,B=null,y=new MediaSource,y.addEventListener("sourceopen",h),a.src=URL.createObjectURL(y),J.onsps)J.onsps(S)};b.onvideoframe=function(I){F.parse(I.bitstream)};b.onaudioframe=function(I){F.parse(I)};b.onendofstream=function(){J.reset()};this.play=function(I){a.play().catch(function(S){if(!I&&(console.error(S),J.onplayerror))J.onplayerror(S)})};this.reset=function(){console.log("Reset player");P&&(clearTimeout(P),P=0);t.length=0;A=!1;x="";z=null;F&&F.reset();L.length=
0};this.close=function(){J&&(J.reset(),y&&"open"==y.readyState&&(y.endOfStream(),a.src=null),F&&F.close&&F.close(),r&&r.close&&r.close(),J=null)};this.setMediaFormat=function(I,S){F.setMediaFormat&&F.setMediaFormat(I,S)};this.getMediaSource=function(){return y};this.getMediaSourceBuffer=function(){return B};a.addEventListener("ended",function(I){console.warn(".... ended");P&&(clearTimeout(P),P=0)});a.addEventListener("emptied",function(I){A=!!B});a.addEventListener("pause",function(I){console.warn(".... paused");
A=!!B;var S=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+S)}).catch(function(X){console.error(X)})});a.addEventListener("waiting",function(I){A=!!B})}function Qd(a,b,c){function e(y,B){var r,F,I,S,X,Q,oa,w,V,ja,W,ca,ba,pa,Z,fa,R,ma,Ba,f,l,k,g,u,v,D,C;return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){if(1==G.nextAddress)return r=y.allocationSize(),F=new Uint8Array(r),G.yield(y.copyTo(F),2);I=z;S=y.codedWidth;X=(S+1)/2|0;Q=y.codedHeight;oa=(Q+
1)/2|0;w=S*Q;V=w+X*oa;ja=2*w;W=I.subarray(w,ja);ca=I.subarray(ja);ma=R=fa=Z=pa=ba=0;k=l=f=Ba=null;g=F.subarray(0,w);u=F.subarray(w,V);v=F.subarray(V);for(pa=0;pa<Q;pa++)for(R=pa*S,ma=R+S,Ba=g.subarray(R,ma),l=W.subarray(R,ma),k=ca.subarray(R,ma),ba=0;ba<X;ba++)fa=2*ba+1,l[fa]=Ba[ba],k[fa]=Ba[ba+X];D=(X+1)/2|0;if(B)for(C=F.subarray(w),pa=0;pa<oa;pa++)for(R=pa*S,ma=R+X,Ba=C.subarray(R,ma),R=ma,ma=R+X,f=C.subarray(R,ma),R=(2*pa+1)*S,ma=R+S,l=W.subarray(R,ma),k=ca.subarray(R,ma),ba=0;ba<X;ba++)Z=2*ba,
l[Z]=Ba[ba],k[Z]=f[ba];else for(pa=0;pa<oa;pa++)for(R=pa*X,ma=R+X,Ba=u.subarray(R,ma),f=v.subarray(R,ma),R=(2*pa+1)*S,ma=R+S,l=W.subarray(R,ma),k=ca.subarray(R,ma),ba=0;ba<D;ba++)Z=4*ba,l[Z]=Ba[ba],k[Z]=Ba[ba+D],Z+=2,l[Z]=f[ba],k[Z]=f[ba+D];G.jumpToEnd()})}function d(y,B,r){var F,I,S,X,Q,oa,w,V,ja,W,ca,ba,pa,Z,fa,R,ma,Ba,f,l,k,g,u,v;return $jscomp.asyncExecutePromiseGeneratorProgram(function(D){if(1==D.nextAddress)return F=new Uint8Array(y.allocationSize()),D.yield(y.copyTo(F),2);I=y.codedWidth;S=
y.codedHeight;X=(I+1)/2|0;Q=(S+1)/2|0;oa=I*S;w=oa+X*Q;V=F.subarray(oa,w);ja=F.subarray(w);W=2*oa;B||(B=new Uint8Array(3*oa));ca=B.subarray(oa,W);ba=B.subarray(W);B.set(F.subarray(0,oa),0);f=Ba=ma=R=fa=Z=pa=0;u=g=k=l=null;if(r)for(v=F.subarray(oa),Z=0;Z<Q;Z++){R=Z*I;ma=R+I;l=v.subarray(R,ma);R=2*Z*I;ma=R+I;g=ca.subarray(R,ma);u=ba.subarray(R,ma);for(pa=0;pa<X;pa++)fa=2*pa,Ba=l[fa],g[fa]=Ba,g[fa+1]=Ba,f=l[fa+1],u[fa]=f,u[fa+1]=f;R+=I;ca.set(g,R);ba.set(u,R)}else for(Z=0;Z<Q;Z++){R=Z*X;ma=R+X;l=V.subarray(R,
ma);k=ja.subarray(R,ma);R=2*Z*I;ma=R+I;g=ca.subarray(R,ma);u=ba.subarray(R,ma);for(pa=0;pa<X;pa++)fa=2*pa,Ba=l[pa],g[fa]=Ba,g[fa+1]=Ba,f=k[pa],u[fa]=f,u[fa+1]=f;R+=I;ca.set(g,R);ba.set(u,R)}return D.return(B)})}function h(y){var B,r;return $jscomp.asyncExecutePromiseGeneratorProgram(function(F){switch(F.nextAddress){case 1:if(!t){if(1E3==y.duration)A.onframedecoded(y);F.jumpTo(2);break}z||(P="NV12"==y.format);return 1E3==y.duration?F.yield(d(y,z,P),6):F.yield(e(y,P),4);case 6:z=F.yieldResult;case 4:B=
{timestamp:y.timestamp,codedWidth:y.codedWidth,codedHeight:y.codedHeight,duration:y.duration,format:"I444"},r=new VideoFrame(z,B),A.onframedecoded(r),r.close();case 2:y.close(),F.jumpToEnd()}})}function p(y){var B=y.codec;if(B!=L||(b?J.sampleRate!=y.sampleRate:J.width!=y.width||J.height!=y.height))if(console.log("Codec: "+B+" audio: "+b),L=B,J=y,E||(E=new VideoDecoder({output:function(r){h(r)},error:function(r){console.error("VideoDecoder error:",r);if(A.onerror)A.onerror(r)}})),B={codec:L,codedWidth:y.width,
codedHeight:y.height,hardwareAcceleration:c||"no-preference"},console.log(B),E.configure(B),A.onsps)A.onsps(y)}var L=null,A=this,E,J=null,x={type:"delta",data:null,timestamp:0,duration:0},z=null,P=!1,t=hi5.browser.supportsI444;a.onvideoframe=function(y){var B=y.bitstream;var r=0,F=[0,0],I=B.length;var S=!1;var X=null;for(var Q=!1,oa=0,w=0;r<I;){F[0]=r;Lb.searchStartCode(B,F);var V=F[0];if(-1==V){w=F[1];break}V+=F[1];r=V+1;oa=B[V]&31;switch(oa){case 5:S=!0;break;case 7:(X=(new Uc(B.subarray(V))).readSPS())||
(Q=!0)}}r=I-r;F=null;7>r&&(F=B.subarray(0,I-(r+(w+1))),7==oa&&(Q=!1));B=F;Q&&console.log("corrupted: "+y.timestamp,y.bitstream);X&&p(X);J&&(B&&(y.bitstream=B),x.type=S?"key":"delta",x.data=y.bitstream,x.timestamp=y.timestamp,x.duration=y.isChroma?77:1E3,y=new EncodedVideoChunk(x),E.decode(y))};this.play=function(y){};this.reset=function(){console.log("Reset MediaDecoder");z=J=L=null;E&&E.reset()&&E.close();E=null};this.close=function(){A.reset();E&&(E.close(),E=null)}}this.displayMsg=this.reconnectOnResize=
!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Kb=!1,lb={},jb={},Bb=null,n=this,mc=!1,Wa=!1,cb=0,Cb=null,Vc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ka=hi5.appcfg,Ib="";this.setConfig=function(a){ka=a};var bb="object"==typeof q?q:null,O=bb?{}:hi5.tool.queryToObj(q.substring(q.indexOf("?")+
1));void 0==O.mapClipboard&&ka.clipboard&&void 0!=ka.clipboard.enabled&&(O.mapClipboard=ka.clipboard.enabled);O.hardwareAcceleration||(O.hardwareAcceleration=ka.hardwareAcceleration);void 0==ka.enableDVCAudio&&(ka.enableDVCAudio=!0);var Ka=0,La=0,fb=(na||O.color||O.server_bpp||16)|0,oc=null,Wc=null,Qa=null,cc=null,Xc="/DOWNLOAD?",Yc="/CLIP?";24==fb&&(fb=16);var Va="app"==O.startProgram,Jb=U(O.mapDisk),nb=0;this.setLinks=function(a){a.download&&(Xc=a.download);a.clipboard&&(Yc=a.clipboard)};this.protocol=
bb?"":q.substring(0,q.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return U(O.smartCard)||U(O.mapSmartCard)||U(O.passwordIsPin)};this.enableWebAuthn=function(){return U(O.enableWebAuthn)||U(O.useWebAuthn)};this.hasScanner=function(){return U(O.scanner)};this.hasUSB=function(){return U(O.mapUSB)&&!!navigator.usb};this.getUSB=function(){return O.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},
{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Wc=a};this.getProfiler=function(){return Wc};this.gateway=function(){if(bb)return"";var a=q.lastIndexOf("/RDP?");-1==a&&(a=q.lastIndexOf("/JOIN?"));-1==a&&(a=q.lastIndexOf("/PLAY?"));return q.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=va;var kb="object"==typeof q||0<q.indexOf("/PLAY?"),rc=!kb&&
0<q.indexOf("invitation=");if(rc){var sc=decodeURIComponent(q),Nb=sc.indexOf(' USERNAME="');if(0<Nb){Nb+=11;var Rd=sc.substring(Nb,sc.indexOf('"',Nb));q+="&novice="+Rd}q+="&mapClipboard=on";O.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,bb?q="":(Ka=640,La=480),q+="&touchpad=on",O.touchpad="on",this.reconnectOnResize=!1;else if(0<q.indexOf("/JOIN?")||rc)this.mode=2,this.reconnectOnResize=!1;var tc=U(O.gfx)||U(O.remotefx)||0<n.mode;tc&&(Va||rc?(tc=!1,O.remotefx=!1):fb=32);K?Ka=parseInt(K):
O.width&&(Ka=parseInt(O.width));Y?La=parseInt(Y):O.height&&(La=parseInt(O.height));-1==Ka&&(Ka=hi5.browser.getScreenWidth());-1==La&&(La=hi5.browser.getScreenHeight());O.symlink&&O.parameters&&hi5.tool.queryToObj(O.parameters,O);O.gateway||(q+="&gateway="+encodeURIComponent(n.gateway));!O.minWidth&&ka.minWidth&&(O.minWidth=ka.minWidth);!O.minHeight&&ka.minHeight&&(O.minHeight=ka.minHeight);O.minWidth&&(O.minWidth=parseInt(O.minWidth));O.minHeight&&(O.minHeight=parseInt(O.minHeight));O.waWidth=O.waWidth?
parseInt(O.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;O.waWidth&=-4;O.waHeight=O.waHeight?parseInt(O.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;O.waHeight&=-4;"useSSL"in O||(q+="&useSSL="+("wss"==n.protocol));hi5.storage.isAvailable&&(U(O.shareClipboard)||O.shareClipboardId)&&(q+="&shareClipboardId="+(O.shareClipboardId||da()));ka&&(void 0!=ka.displayMsg?this.displayMsg=ka.displayMsg:
ka.displayMsg=this.displayMsg,ka.appTimeout&&(this.appTimeout=ka.appTimeout),void 0!=ka.reconnectOnResize&&(this.reconnectOnResize=ka.reconnectOnResize),ka.reconnectTimes&&(this.reconnectTimes=ka.reconnectTimes),void 0!=ka.windowState&&(this.windowState=ka.windowState),void 0!=ka.openLink&&(this.openLink=ka.openLink),void 0!=ka.setTitle&&(this.setTitle=ka.setTitle),"boolean"==typeof ka.useWSS&&(q=(ka.useWSS?"wss":"ws")+q.substring(q.indexOf("://"))),"boolean"==typeof ka.remoteAppLogin&&(this.remoteAppLogin=
ka.remoteAppLogin,Kb=!ka.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ka.hideLogin&&(Kb=ka.hideLogin),void 0!=ka.localPrinter&&void 0==O.localPrinter&&(O.localPrinter=ka.localPrinter));var Na=null;void 0==ka.useWorker&&(ka.useWorker=!1);ka.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ka.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=
!0);var Ma=ka.useWorker?new Worker(ta("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,vb=this.reconnectTimes,$b=Ma?{type:5,data:null}:null;this.getDisplayName=ea;this.server=ea();this.port=parseInt(O.port,10);this.loadbalanceToken="";ka.loadbalanceTokenName&&(O[ka.loadbalanceTokenName]?la(O[ka.loadbalanceTokenName]):!1!==ka.randomAppId?la(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){n.loadbalanceToken&&(a+=-1==a.indexOf("?")?
"?"+n.loadbalanceToken:"&"+n.loadbalanceToken,a+="&loadbalanceTokenName="+ka.loadbalanceTokenName);return a};this.getURL=function(){return q};this.getRuntimeURL=function(){var a=q+"&width="+Ka+"&height="+La+"&server_bpp="+fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Ec(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=O.monitorDef,d=O.monitor,h=0;b=ia.size();var p=Array(b);c=Array(b);var L=0,A=0,E=0,J=0,x=0,z=0,P="";if(e){c=sa.parseMonitorDef(e);for(b=c.length;h<b;h++){var t=
c[h];t[0]<E&&(E=t[0]);t[1]<J&&(J=t[1]);t[2]>x&&(x=t[2]);t[3]>z&&(z=t[3])}0>E&&(L=-E);0>J&&(A=-J);t=0>d?[E,J,x,z]:c[d];O.width=t[2]-t[0]+1;O.height=t[3]-t[1]+1;h=ia.getSurface(0);h.setMonitor(t[0],t[1],t[2],t[3]);if(L||A)for(t=h.getMousePosition(),t.left+=L,t.right+=L,t.top+=A,t.bottom+=A,h=0;h<b;h++)t=c[h],t[0]+=L,t[1]+=A,t[2]+=L,t[3]+=A;sa.setMonitorLayout(c);0>d&&sa.setMonitorCount(0);n.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+O.width+"&height="+O.height}else{if(1<b&&!Va){for(ia.verifyMonitors();h<
b;h++)e=ia.getSurface(h),t=e.getMousePosition(),t.left<E&&(E=t.left),t.top<J&&(J=t.top),t.right>x&&(x=t.right),t.bottom>z&&(z=t.bottom),p[h]=t,P&&(P+=","),P+=t.left+":"+t.top+":"+t.right+":"+t.bottom;0>E&&(L=-E);0>J&&(A=-J);for(h=0;h<b;h++){t=ia.getSurface(h).getMousePosition();if(L||A)t.left+=L,t.right+=L,t.top+=A,t.bottom+=A;c[h]=[t.left,t.top,t.right,t.bottom,t.left==L&&t.top==A?1:0]}sa.setMonitorLayout(c);n.reconnectOnResize=!1}P&&(svGlobal.logger.warn("MonitorDef:"+P),O.width=x-E+1,O.height=
z-J+1,P="&monitorDef="+P+"&width="+O.width+"&height="+O.height);b=P}a+=b;0>q.indexOf("waWidth")&&(b=(b=ia.getFocused())?b.getWindow():window,a+="&waWidth="+O.waWidth+"&waHeight="+O.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;O.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());O.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==O.soundPref&&(O.soundPref=0,a+="&soundPref=0");L=c=b="";for(L in lb)A=
lb[L],"flags"in A&&(b&&(b+=",",c+=","),b+=A.name,c+=A.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(L in jb)A=jb[L],"flags"in A&&(b&&(b+=","),b+=A.name);b&&(a+="&gwChannelName="+b);if(c=wd())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);O.audioRecord=U(O.audioRecord)&&hi5.audio.recordable;Fa.init(b,tc,O.audioRecord,O.soundPref,U(O.mapCamera)&&!!navigator.mediaDevices,U(O.mapUSB)&&!!navigator.usb);
O.audioRecord&&(a+="&audioRecord=on");O.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Fa.count&&(a+="&dvcChannels="+Fa.names.join(","));a+="&binary=on";ka.existingFile&&(a+="&existingFile="+ka.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(va());a=n.modifyURL(a);ka.copyTextOnly&&U(O.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);
U(O.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Fd()};this.getColor=function(){return fb};this.changeTitle=qa;hi5.browser.isTouch&&Math.max(Ka,La)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Ca=null,Ia=!1,qb=!1,pc=!1,Ta=new function(){function a(A){c&&(d&&d.disconnect(),h&&h.disconnect());hi5.audio.releaseAudioContext();A||(L&&(L.close(),L=null),p&&(p.pause(),p=null))}function b(A){console.error("play error: ",
A)}var c=null;this.supportWebAudio=this.available=!1;(0==O.playSound||0<n.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(A){return c.createBuffer(2,A,Da.samplePerSec)};var e=0,d=null,h=null;this.setVolume=function(A){1==A?d=null:(d||(d=c.createGain()),d.gain.value=A)};this.playBuffer=function(A){h=c.createBufferSource();h.buffer=A;d?(h.connect(d),d.connect(c.destination)):h.connect(c.destination);
var E=c.currentTime,J=0<e?e:E;J<E&&(J=E);e=J+A.duration;h.start?h.start(J):h.noteOn(J);return e-E};this.iOSFix=function(){if(c){var A=this.getBuffer(1024),E=c.createBufferSource();E.buffer=A;E.connect(c.destination);E.start?E.start(0):E.noteOn(0)}};this.close=a;var p=null,L=null;this.onaudioframe=null;this.initMediaPlayer=function(A,E,J){a(!0);p||(p=document.createElement("audio"));L||(L=new Mb(p,A,!0),L.onplayerror=b,L.onerror=function(x){console.error("Not possible audio error",x)},svGlobal.logger.info("MediaPlayer init, headerless: "+
J+" sampleRate:"+E.sampleRate));L.setMediaFormat(E,J);L.play(!1)}},Md=Ta.available,sa=new yc(200,200);sa.onSetCursor=Jc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Xb=0,Wb=0,Yb=Ka-1,Zb=La-1,nc="";window.$rdp||(window.$rdp=this);ya(fb);this.setResolution=Oa;this.running=function(){return Ia};this.setJoinMode=function(a){Ia&&ua("8E1"+a)};this.setJoinCloseMode=function(a){Ia&&ua("8EB3\t"+a)};this.refuseControl=function(a){Ia&&ua("8E3"+a)};this.giveControl=function(a){Ia&&
ua("8E4"+a)};this.pauseSession=function(a,b){Ia&&ua("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ia&&ua("8EB2\t"+a)};this.requestControl=function(){Ia&&ua("8E2")};this.saveSession=function(a){Ia&&ua("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ia&&ua("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(c&&0<c.length){var h=c.shift();h.key?Db.sendSingleKey(h.down,h.key):h.char&&tb(h.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,
space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(h,p){var L=b[p.toLowerCase()];L?n.writeScancode(h,L):(L=p.length,
0!=L&&(1==L?n.writeKeyCode(h,p.toUpperCase().charCodeAt(0)):h&&n.writeText(p)))};var c=null,e=0,d=null;this.sendKeyComb=function(h,p,L){if(Wa){h=h.split("+");var A=h.length,E;if(0!=A){var J=null,x=[];for(E=0;E<A;E++){var z=h[E];""==z&&""==J&&(z="Add");""!=z&&x.push({key:z,down:!0});J=z}A=x.length;for(E=A-1;0<=E;E--)x.push({key:x[E].key,down:!1});if(p)c=x,e=p,d=L,a();else for(E=0,A=x.length;E<A;E++)Db.sendSingleKey(x[E].down,x[E].key)}}};this.sendText=function(h,p,L){for(var A=[],E=0,J=h.length;E<
J;E++)A.push({"char":h.charAt(E)});c=A;e=p;d=L;a()}};this.writeKeyComb=function(a,b,c){Wa&&Db.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Wa)if(b)Db.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)tb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),n.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ia=new function(a,b){function c(){function d(x){for(;0<x.ownerWinid;){var z=E.getWinById(x.ownerWinid);if(z&&z.isVisible())x=z;else break}return x}function h(x){for(var z=
"";x;)x.titleInfo&&(z=x.titleInfo),x=E.getWinById(x.ownerWinid);return z}var p=[],L=[],A=0,E=this;this.mainWin=null;this.appId="";var J=0;this.getActiveWinId=function(){return J};this.setActiveWinId=function(x,z){svGlobal.logger.info("setActiveWinId: "+x+" old: "+J+" max: "+z);if(J!=x){var P=0==J;J=x;(x=E.getMainByWinId(x))&&x.isMainWin()&&E.mainWin!=x&&(E.mainWin=x);P&&z&&(z=ia.getFocused())&&(z=z.getFreeSpace(),x=z.width,n.resetSize(x,z.height))}};this.onchange=function(x){x.isVisible()||x!=E.mainWin?
x.isVisible()&&!E.mainWin&&x.isMainWin()&&(E.mainWin=x,3==a.windowState&&x.exeCommand(61488)):E.mainWin=null};this.addWin=function(x){for(var z=p.length,P=!1,t=0;t<z;t++)if(x.id==p[t].id){p[t]=x;P=!0;break}P||p.push(x);1==p.length&&(A=Date.now());z=x.isMainWin();svGlobal.logger.info("is mainwin:"+z+" id:"+x.id);z&&!E.mainWin&&(E.mainWin=x)};this.popWins=function(x){x=E.getWinById(x);var z=[];if(x){x=0<x.ownerWinid?x.ownerWinid:x.id;for(var P=p.length-1;0<=P;P--)if(p[P].ownerWinid==x||p[P].id==x)z.push(p[P]),
p.splice(P,1)}return z};this.hasApp=function(x){return-1!=L.indexOf(x)};this.addApp=function(x){return-1==L.indexOf(x)?(L.push(x),!0):!1};this.isNew=function(){return 3E4>Date.now()-A};this.getAll=function(){return p};this.hasWin=function(x){return 0<=p.indexOf(x)};this.close=function(){for(var x=0,z=p.length;x<z;x++)p[x].close()};this.clear=function(){p.length=0};this.delWin=function(x){for(var z=0,P=p.length;z<P;z++)if(p[z].id==x)return p.splice(z,1),z;return-1};this.isRunning=function(){var x=
p.length;if(1>x)return!1;var z=0;for(x=p.length;z<x;z++){var P=p[z];if(P.showState)return!0}return!1};this.getWinById=function(x){var z=p.length;if(1>z)return null;for(var P=0;P<z;P++){var t=p[P];if(t.id==x)return t}return null};this.getMainWinByAppId=function(x){var z=null,P=0;for(len=p.length;P<len;){z=p[P];if(z.appId==x&&z.isVisible()&&1>z.ownerWinid)break;P++}return z};this.getTopWin=function(x){var z=null,P,t=x.length;for(P=0;P<t&&(!(z=E.getWinById(x[P]))||!z.isVisible());P++)z=null;if(!z)for(svGlobal.logger.warn("No win found"),
t=p.length,P=t-1;0<=P&&(z=p[P],!z.isVisible());P--)z=null;return z};this.getMain=function(x){return(x=E.getTopWin(x))?d(x):null};this.getMainByWinId=function(x){return(x=E.getWinById(x))?d(x):null};this.getOtherApps=function(x,z,P){var t=p.length;if(0!=t&&p[t-1])if(t=p[t-1].appId,P||!t)setTimeout(function(){E.getOtherApps(x,z)},P||3E3);else{P=[];if(t=E.getTopWin(x)){var y=0<t.ownerWinid?t.ownerWinid:t.id,B=[],r=0;for(t=p.length;r<t;r++)p[r].ownerWinid!=y&&p[r].id!=y&&p[r].isVisible()&&B.push(p[r]);
r=0;for(t=B.length;r<t;r++)B[r].ownerWinid!=y&&B[r].id!=y&&(P.push({title:h(B[r]),win:d(B[r])}),y=0<B[r].ownerWinid?B[r].ownerWinid:B[r].id)}z(P)}};this.getFullTitle=function(x){for(var z,P="";;){z=E.getWinById(x);if(!z)break;z.titleInfo&&z.isVisible()&&(P&&(P=" > "+P),P=z.titleInfo+P);if(1>x)break;x=z.ownerWinid}return P}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,h=0;h<d;h++)e[h].railWin&&e[h].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,
h=Array(d),p=0;p<d;p++)e[p].configMonitor(),h[p]=e[p].getMousePosition();h.sort(function(E,J){var x=E.left-J.left;return 0!=x?x:E.top-J.top});var L=h.findIndex(function(E){return 0==E.left&&0==E.top});svGlobal.logger.info("monitor layout",h,L);-1==L&&(n.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",h));for(p=L-1;0<=p;){if(h[p].right<h[p+1].left){var A=h[p+1].left-h[p].right-1;0<A&&(h[p].right+=
A,h[p].left+=A)}h[p].bottom<h[p+1].top&&(A=h[p+1].top-h[p].bottom-1,0<A&&(h[p].top+=A,h[p].bottom+=A));p--}for(p=L+1;p<d;)h[p-1].right<h[p].left&&(A=h[p].left-h[p-1].right-1,0<A&&(h[p].right-=A,h[p].left-=A)),h[p-1].bottom<h[p].top&&(A=h[p].top-h[p-1].bottom-1,0<A&&(h[p].top-=A,h[p].bottom-=A)),p++};this.repaint=function(d,h,p,L){for(var A=0,E=e.length;A<E;A++)e[A].repaint(d,h,p,L)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};
this.hasSurface=function(d){for(var h=e.length,p=0;p<h;p++)if(e[p].equals(d))return!0;return!1};this.getMonitorSurface=function(d,h,p,L){var A=e.length;if(1==A)return e[0];for(var E=0;E<A;E++)if(e[E].isMonitor(d,h,p,L))return e[E];return null};this.fromSyncedSurface=function(d){var h=e.length;Date.now();for(var p=0;p<h;p++)if(e[p].isClipSynced(d))return!0;return!1};this.setSize=function(d,h,p){for(var L=0,A=e.length;L<A;L++)e[L].setSize(d,h,p)};this.zOrders=[];this.drawLicense=function(d){for(var h=
0,p=e.length;h<p;h++)e[h].drawLicense(d)};this.setReadOnly=function(d,h){for(var p=0,L=e.length;p<L;p++)e[p].setReadOnly(d,h)};this.setVisible=function(d,h){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var h=0,p=e.length;h<p;h++)e[h]&&e[h].setCursor(d)};this.hide=function(d){d=0;for(var h=e.length;d<h;d++)e[d]&&e[d].hide()};this.execute=function(d,h){for(var p=0,L=e.length;p<L;p++)e[p][d].apply(e[p],h)};this.addWin=function(d){var h=this.getFocused();h||(svGlobal.logger.warn("Focused surface not found!"),
h=e[e.length-1]);h?(Va=!0,h.railWin||(h.railWin=new c,h.onunload=function(){hi5.appcfg.closeRemoteApp&&h.railWin&&h.railWin.close();h.remoteApp&&h.remoteApp.close();h.railWin&&(h.railWin.clear(),h.railWin=null);e.removeElm(h)}),h.context&&b.setContext(h.context),h.railWin.addWin(d),h.railWin.mainWin==d&&(setTimeout(function(){var p=h.getFreeSpace();a.writeRawInput("8C661441\t"+p.width+"\t"+p.height);svGlobal.logger.info("-- main win dp change:"+p.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);
svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&h.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var h,p=e.length-1;0<=p;p--){var L=e[p];h=L.railWin;var A=h.getWinById(d),E=A&&A.appId&&-1!=A.appId.toLowerCase().indexOf("runonce");if(0<=h.delWin(d)){A==h.mainWin&&(h.mainWin=null);if(L.toolbar){d=
"win"+d;var J=L.toolbar.querySelector("#"+d);J&&L.toolbar.removeChild(J)}if(!h.isRunning()&&0==n.mode){if(A.isMainWin()&&L.onremoteappclose)L.onremoteappclose(A);A=a.appTimeout;if(E||h.isNew())A*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(x){return function(){svGlobal.logger.info("Start del:"+Date.now());x.railWin&&x.railWin.isRunning()||(x.remoteApp&&x.remoteApp.close(),ia&&ia.delSurface(x))}}(L),A)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):
[]};this.getWinById=function(d){for(var h,p=0,L=e.length;p<L;p++)if(e[p]&&e[p].railWin&&(h=e[p].railWin.getWinById(d)))return h;return null};this.getMainWinByAppId=function(d){for(var h,p=0,L=e.length;p<L;p++)if(e[p].railWin&&(h=e[p].railWin.getMainWinByAppId(d)))return h;return null};this.onWinChange=function(d){for(var h,p=0,L=e.length;p<L;p++)if(e[p].railWin&&(h=e[p].railWin.getWinById(d.id)))e[p].railWin.onchange(d)};this.setTitle=function(d){for(var h,p=0,L=e.length;p<L;p++)if(e[p].railWin){h=
e[p].railWin.getWinById(d);var A=e[p].railWin.getFullTitle(d);if(A){a.changeTitle(A,e[p].getWindow(),h.appId);break}}};this.hasApp=function(d){for(var h=0,p=e.length;h<p;h++)if(e[h].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var h=0,p=e.length;h<p;h++)if(e[h].railWin&&e[h].railWin.hasWin(d))return e[h];return null};
this.getOwnerSurfaceById=function(d){for(var h,p=0,L=e.length;p<L;p++)if(e[p].railWin&&(h=e[p].railWin.getWinById(d)))return e[p];return null};this.getFocused=function(){for(var d=e.length,h=0;h<d;h++)if(e[h].focused)return e[h];return e[d-1]};this.close=function(){for(var d=0,h=e.length;d<h;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function h(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var p=this;this.resizable=function(){return p.isVisible?
0!=(p.style&262144)||0!=(p.style&65536)||0!=(p.style&16777216)||3==p.showState:!1};this.setShowState=function(L){p.showState=L};this.parent=function(){return ia.getWinById(p.ownerWinid)};this.resize=function(L,A,E,J){svGlobal.logger.info("www resize, l "+L+" w "+E);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+p.id+"\t"+L+"\t"+A+"\t"+E+"\t"+J)};this.exeCommand=function(L){svGlobal.logger.info("www exeCommand, cmd "+L);a.writeRawInput("8C4"+d+"\t"+L)};this.activate=function(L){svGlobal.logger.info("www activate, enable "+
L+" id:"+d);2==p.showState?(p.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+L)},50)):a.writeRawInput("8C3"+d+"\t"+L)};this.close=function(){svGlobal.logger.info("www close");p.exeCommand(61536)};this.getAppId=h;this.isVisible=function(){return p.winWidth&&p.winHeight&&p.showState&&45<p.winHeight&&45<p.winWidth};this.isMainWin=function(){if(!(p.isVisible()&&p.winWidth&&p.winHeight&&45<p.winHeight&&45<p.winWidth))return!1;var L=1>p.ownerWinid;if(!L)return L;var A=p.style;if(0!=
(A&4194304))return!0;if(0!=(A&2147483648)&&(0==(A&8388608)||0==(A&12582912)))return!1;var E=0!=(p.extStyle&128);(L=L&&!E)&&0!=(A&2147483648)&&0==(A&2156396544)&&(L=!1);return L};h()}}(n,sa);this.getSurfaces=function(){return ia};this.hide=function(){ia&&ia.hide()};this.getFileUrl=function(a,b,c){var e=va(),d=Xc,h=d.indexOf("://");e=(0<h&&11>h?d:e+d)+"s="+nc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return n.modifyURL(e)};this.listFiles=function(a,b){Na&&Wa&&Na.list(a,b)};
this.writeRawInput=function(a){if(Wa){ua(a);if(n.onactivity)n.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);ua(e.buffer)};var Zc=0;if(ka.numLock||ka.numlock||U(O.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Zc|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;
this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;
this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var h=d.getFreeSpace(),p=h.width;h=h.height;Ra.checkLockFlags=!0;ka.scale?d.scaleTo(p,h,!1):a.resetSize(p,h)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,h){this.reqCopyTime=Date.now();var p=a.getGatewayAddr(),L=Yc,A=L.indexOf("://");p=(0<A&&11>A?L:p+
L)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(p),h);this.reqCopyTime=Date.now();Rc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,h,p){a.reconnectOnResize=!1;var L=a.getFileUrl(d,h,p);n.ondownload&&n.ondownload({fileName:d,url:L,source:h,action:p})||window.open(L)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return q};this.reconnect=function(d,h,p){O.symlink?(d="user="+d+"&pwd="+h,p&&(d+="&domain="+p),q=hi5.tool.replaceQuery(q,
"parameters",d)):(q=hi5.tool.replaceQuery(q,"user",d),q=hi5.tool.replaceQuery(q,"pwd",h),q=hi5.tool.replaceQuery(q,"domain",p));a.run()};this.sendKeyboardSyncFlags=function(d,h){return Wa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},h||333),!0):!1};this.sendKeyboardSynchronize=function(d,h,p){var L=0;p&&(L|=4);h&&(L|=2);d&&(L|=1);this.sendKeyboardSyncFlags(L)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",
20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,h){a.authWithCode(d,h)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(n,Zc),Sd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,h){return a.repaint(c,e,d-c+1,h-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&
e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+c.id))}}(sa,ia);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new pb(143)};this.GatewayChannel=function(){return new pb(28)};this.DynamicChannel=function(){return new pb(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Fa.names.push(a.name);Fa[a.name]=a;Fa.count++};
var Sa=null,Fa={count:0,names:[],usbChannel:null,close:function(){for(var a=Fa.names,b=0,c=a.length;b<c;b++)Fa[a[b]].onclose&&(Fa[a[b]].onclose(),Fa[a[b]]=null);a.length=0;Fa.usbChannel=null},init:function(a,b,c,e,d,h){function p(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=
this.formatTag=0;this.extenstion=null;var t=this;this.fromBuffer=function(y,B){t.formatTag=y.getLittleEndian16();t.nChannels=y.getLittleEndian16();t.nSamplesPerSec=y.getLittleEndian32();t.nAvgBytesPerSec=y.getLittleEndian32();t.nBlockAlign=y.getLittleEndian16();t.bitsPerSample=y.getLittleEndian16();var r=y.getLittleEndian16();t.cbSize=r;0<r&&!0!==B&&(t.extenstion=Array(r),y.copyToByteArray(t.extenstion,0,y.getPosition(),r),y.skipPosition(r))};this.toBuffer=function(y){y.setLittleEndian16(t.formatTag);
y.setLittleEndian16(t.nChannels);y.setLittleEndian32(t.nSamplesPerSec);y.setLittleEndian32(t.nAvgBytesPerSec);y.setLittleEndian16(t.nBlockAlign);y.setLittleEndian16(t.bitsPerSample);y.setLittleEndian16(t.cbSize);0<t.cbSize&&y.setBytes(t.extenstion)};this.getSize=function(){return 18+t.cbSize};this.toString=function(){return"Audio Format, tag="+t.formatTag+" nChannels="+t.nChannels+" nSamplesPerSec="+t.nSamplesPerSec+" nAvgBytesPerSec="+t.nAvgBytesPerSec+" nBlockAlign="+t.nBlockAlign+" bitsPerSample="+
t.bitsPerSample+" cbSize="+t.cbSize}}function L(){Sa=new n.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(t){var y=t.getLittleEndian32();t.getLittleEndian32();switch(y){case 5:y=t.getLittleEndian32(),Sa.maxMonitorAreaFactorA=t.getLittleEndian32(),Sa.maxMonitorAreaFactorB=t.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+y+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),t=new Uint8Array(2),
t[0]=146,t[1]=4,ua(t.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(t,y){if(Sa.enabled){var B=new Uint8Array(56),r=new RdpBuffer(B,0,56);t=t>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:t&-4;y=y>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:y&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);r.setLittleEndian32(0);r.setLittleEndian32(0);r.setLittleEndian32(t);r.setLittleEndian32(y);
r.setLittleEndian32(.26458*t|0);r.setLittleEndian32(.26458*y|0);r.setLittleEndian32(t>y?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);Sa.send(B);svGlobal.logger.warn("Display control: "+t+"x"+y)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!ka.disableDVC){if(ka.enableEcho){var A=new n.DynamicChannel;A.name="ECHO";A.process=function(t){var y=t.getPosition(),B=t.getEnd(),r=new Uint8Array(B-y);r.set(t.getData().subarray(y,B));A.send(r)};n.addDynamicChannel(A)}if(a){var E=
new n.DynamicChannel;E.name="Microsoft::Windows::RDS::Input";E.process=function(t){var y=t.getLittleEndian16();t.getLittleEndian32();switch(y){case 1:t.skipPosition(4),t=new RdpBuffer(new Uint8Array(16),0,16),t.setLittleEndian16(2),t.setLittleEndian32(16),t.setLittleEndian32(3),t.setLittleEndian32(65536),t.setLittleEndian16(256),t.markEnd(),E.send(t);case 5:ia.execute("setTouchRemoting",[!0]);Fa.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ia.execute("setTouchRemoting",
[!1]),Fa.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(E)}if(c){svGlobal.logger.warn("Audio input on");var J=new n.DynamicChannel;(function(){function t(w){var V=new RdpBuffer(new Uint8Array(5),0,5);V.setByte(7);V.setLittleEndian32(w);V.markEnd();J.send(V)}function y(w){var V=w.getLittleEndian32(),ja=w.getLittleEndian32(),W=new p;W.fromBuffer(w,!0);var ca=0,ba=0;0<W.cbSize&&(22==W.cbSize?(ca=w.getLittleEndian16(),ba=w.getLittleEndian32(),w.skipPosition(16)):
(svGlobal.logger.warn("Wrong cbsize: "+W.cbSize),w.skipPosition(W.cbSize)));w=r[ja];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+V+" initial: "+ja+", "+w.toString());svGlobal.logger.info("Open fmt: "+W.toString()+" validBits:"+ca+" mask:"+ba);I=!0;S=n.reconnectOnResize;n.reconnectOnResize=!1;oa.onopen||(oa.onopen=function(pa){if(Ia){B=pa;n.reconnectOnResize=S;t(ja);var Z=new RdpBuffer(new Uint8Array(5),0,5);Z.setByte(4);Z.setLittleEndian32(pa?0:1);Z.markEnd();J.send(Z)}});oa.ondata||
(oa.ondata=function(pa,Z){B&&(X.length!=Z+1&&(X=new Uint8Array(Z+1),X[0]=6),J.send(F),X.set(pa,1),J.send(X))});oa.start(w,V)}J.name="AUDIO_INPUT";J.process=function(w){var V=w.getByte();switch(V){case 1:w=w.getLittleEndian32();V=new RdpBuffer(new Uint8Array(5),0,5);V.setByte(1);V.setLittleEndian32(w);V.markEnd();J.send(V);break;case 2:var ja=w.getLittleEndian32();w.getLittleEndian32();var W=hi5.audio.getAudioContext().sampleRate;for(V=r.length=0;V<ja;V++){var ca=new p;ca.fromBuffer(w);svGlobal.logger.info("Server rec fmt "+
V+":"+ca.toString());0==e&&49==ca.formatTag&&22050==ca.nSamplesPerSec?r.push(ca):1==ca.formatTag&&ca.nSamplesPerSec<=W&&r.push(ca)}J.send(F);ja=0;w=r.length;for(V=0;V<w;V++)ja+=r[V].getSize();W=new RdpBuffer(new Uint8Array(1024),0,1024);W.setByte(2);W.setLittleEndian32(w);W.setLittleEndian32(ja+9);for(V=0;V<w;V++)r[V].toBuffer(W),svGlobal.logger.info("Client rec fmt: "+r[V].toString());W.skipPosition(1024-ja-9);W.markEnd();J.send(W);break;case 3:y(w);break;case 7:V=w.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+
r[V].toString()+" by client:"+I);I||(t(V),I=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+V)}};var B=!1,r=[];J.onclose=function(){B=!1;oa&&oa.close()};var F=new Uint8Array(1);F[0]=5;var I=!1,S=n.reconnectOnResize,X=new Uint8Array(0),Q=ta("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),oa=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),Q):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();n.addDynamicChannel(J)}n.addDynamicChannel(function(){var t=
new n.DynamicChannel;t.name="TSMF";var y={type:"image/jpeg"},B=Array(1);t.process=function(r){r.getPosition();var F=r.getLittleEndian32()&1073741823;var I=r.getLittleEndian32();var S=r.getLittleEndian32();switch(F){case 2:if(256==S){r.getLittleEndian32();S=new Uint8Array(16);var X=new RdpBuffer(S,0,16);X.setLittleEndian32(2);X.setLittleEndian32(I);X.setLittleEndian32(1);X.setLittleEndian32(0);t.send(S)}break;case 0:switch(S){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:F=r.getPosition();
X=r.getLittleEndian32();for(S=0;S<X;S++){r.getLittleEndian32();var Q=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(Q-4)}S=r.getPosition()-F;X=S+8+4;S=new Uint8Array(X);X=new RdpBuffer(S,0,X);X.setLittleEndian32(-2147483648);X.setLittleEndian32(I);S.set(r.getData().subarray(F,r.getPosition()),8);t.send(S);break;case 261:r.getBytes(16);r.getLittleEndian32();break;case 264:F=r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();Q=r.getBytes(16);var oa=r.getBytes(16);r.getLittleEndian32();
r.getLittleEndian32();r.getLittleEndian32();var w=r.getBytes(16);S=r.getLittleEndian32();r.skipPosition(S);S=new Uint8Array(20);X=new RdpBuffer(S,0,20);X.setLittleEndian32(-2147483648);X.setLittleEndian32(I);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],Q)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],oa)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],w)?X.setLittleEndian32(1):(X.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),
svGlobal.logger.warn(Q),svGlobal.logger.warn(oa),svGlobal.logger.warn(w));X.setLittleEndian32(F);t.send(S);break;case 258:r.getBytes(16);r.getLittleEndian32();F=r.getLittleEndian32();r.skipPosition(F);break;case 263:r.getBytes(16),S=new Uint8Array(16),X=new RdpBuffer(S,0,16),X.setLittleEndian32(-2147483648),X.setLittleEndian32(I),X.setLittleEndian32(1),t.send(S);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);sa.flushImgs();sa.setImgRect(0,0,0,0);S=new Uint8Array(12);X=
new RdpBuffer(S,0,12);X.setLittleEndian32(-2147483648);X.setLittleEndian32(I);t.send(S);break;case 278:r.getBytes(16);I=r.getLittleEndian32();S=r.getLittleEndian32();F=r.getLittleEndian32();r=r.getLittleEndian32();sa.setImgRect(I,S,F-I,r-S);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);break;case 268:r.getBytes(16);break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);
r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);S=r.getLittleEndian32();I=new Image;F=r.getPosition();B[0]=r.getData().subarray(F,F+S);r=new Blob(B,y);I.src=URL.createObjectURL(r);sa.addImg(I);break;case 270:sa.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);S=r.getLittleEndian32();F=r.getPosition()+S;r.skipPosition(8);I=r.getLittleEndian32();svGlobal.logger.info("window state:"+I);X=r.getLittleEndian32();Q=r.getLittleEndian32();I=r.getLittleEndian32();S=r.getLittleEndian32();
r.skipPosition(8);oa=r.getLittleEndian32();w=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+I+" top:"+S+" w:"+X+" h:"+Q+" cl:"+oa+" ct:"+w);r.setPosition(F);F=r.getLittleEndian32();for(F=r.getPosition()+F;r.getPosition()<F;){oa=r.getLittleEndian32();w=r.getLittleEndian32();var V=r.getLittleEndian32(),ja=r.getLittleEndian32();svGlobal.logger.info("visible region, l:"+w+" t:"+oa+" r:"+ja+" b:"+V)}sa.setImgRect(I,S,X,Q);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+
S)}break;default:svGlobal.logger.warn("unkown interface:"+F)}};return t}());kb||n.addDynamicChannel(L());ka.enableDVCAudio&&n.addDynamicChannel(function(t){var y=!1,B=0,r=0,F=0,I=0,S=[],X=new Uint8Array(4),Q=new n.DynamicChannel;Q.name="AUDIO_PLAYBACK_DVC";Q.onclose=function(){};Q.process=function(oa){function w(fa){fa.skipPosition(14);var R=fa.getLittleEndian16();fa.getByte();var ma=fa.getLittleEndian16();fa.skipPosition(1);for(var Ba,f=S.length=0;f<R;f++){var l=new p;l.fromBuffer(fa);(Ba=22050<=
l.nSamplesPerSec&&(1==l.formatTag||49==l.formatTag&&22050==l.nSamplesPerSec&&0==t||41222==l.formatTag))&&S.push(l)}l=20;fa=S.length;for(f=0;f<fa;f++)l+=S[f].getSize();f=l+4;R=new RdpBuffer(new Uint8Array(f),0,f);R.setByte(7);R.setByte(2);R.setLittleEndian16(l);R.setLittleEndian32(3);R.setLittleEndian32(4294967295);R.setLittleEndian32(0);R.setLittleEndian16(0);R.setLittleEndian16(fa);R.skipPosition(1);R.setLittleEndian16(ma);R.setByte(124);for(f=0;f<fa;f++)l=S[f],l.toBuffer(R);R.markEnd();Q.send(R);
5<ma&&(R=new RdpBuffer(new Uint8Array(8),0,8),R.setByte(12),R.skipPosition(1),R.setLittleEndian16(4),R.setLittleEndian16(0),R.setLittleEndian16(0),R.markEnd(),Q.send(R))}function V(fa){var R=fa.getLittleEndian16();fa=fa.getLittleEndian16();var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(6);ma.setByte(35);ma.setLittleEndian16(4);ma.setLittleEndian16(R);ma.setLittleEndian16(fa);ma.markEnd();Q.send(ma)}function ja(){var fa=S[F];if(fa.formatTag!=Da.tag||fa.nSamplesPerSec!=Da.samplePerSec||Da.channels!=
fa.nChannels)Da.tag=fa.formatTag,Da.channels=fa.nChannels,Da.samplePerSec=fa.nSamplesPerSec,Da.bitsPerSample=49==fa.formatTag?8:fa.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec),41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!0))}function W(fa){r=fa.getLittleEndian16();F=fa.getLittleEndian16();I=fa.getByte();fa.skipPosition(3);X.set(fa.getSubarray(4));y=!0;ja()}
function ca(fa,R){var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(5);ma.skipPosition(1);ma.setLittleEndian16(4);ma.setLittleEndian16(fa);ma.setByte(R);ma.skipPosition(1);ma.markEnd();Q.send(ma)}function ba(fa){y=!1;var R=B-8,ma=Date.now();fa.copyFromByteArray(X,0,fa.getPosition(),4);lc(fa,I,r,R);fa=r+(Date.now()-ma);ca(fa,I)}function pa(fa){var R=Date.now();r=fa.getLittleEndian16();F=fa.getLittleEndian16();I=fa.getByte();fa.skipPosition(7);ja();fa=lc(fa,I,r,0);fa*=1E3;R=r+(Date.now()-R)+fa;
ca(R,I)}if(y)ba(oa);else{var Z=oa.getByte();oa.skipPosition(1);B=oa.getLittleEndian16();switch(Z){case 7:w(oa);break;case 6:V(oa);break;case 2:W(oa);break;case 3:oa.getLittleEndian16();oa.getLittleEndian16();break;case 13:pa(oa)}}};return Q}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var x=svGlobal.DCVC_EXTENSION;x.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(t,y){svGlobal.logger.info("activate webcam");x.videoMedia.resolutions?
t():hi5.webcam.resolutions(function(B){svGlobal.logger.info("cam resolutions:",B);B.length?(x.videoMedia.resolutions=B,t()):y()})},deactivate:function(){var t=x.videoMedia;t.track&&(t.track.stop(),t.track=null);t.ctx=null;t.canvas=null;t.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(t,y,B,r,F){svGlobal.logger.info("startStream, width:"+t+" height:"+y+" frameRate:"+B);var I=x.videoMedia,S=I.track;if(S){var X=S.getSettings();if("live"==S.readyState)if(t!=X.width||y!=X.height||
B!=X.frameRate&&2!=I.type)S.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==I.type?I.minFrameRate:B,width:{exact:t},height:{exact:y}}}).then(function(Q){var oa=document.createElement("video");oa.srcObject=Q;oa.play();if(window.OffscreenCanvas)var w=new OffscreenCanvas(100,100);else w=document.createElement("canvas"),w.style.position="absolute",w.style.left=0,w.style.top=0;I.track=Q.getVideoTracks()[0];I.canvas=w;I.ctx=w.getContext("2d");I.video=oa;Q=I.track.getSettings();
I.canvas.width=Q.width;I.canvas.height=Q.height;r()}).catch(function(Q){svGlobal.logger.warn(Q);F()})},stopStream:function(){svGlobal.logger.info("stopStream");var t=x.videoMedia;t.track&&"live"==t.track.readyState&&t.track.stop()},grabFrame:function(t){function y(r){r.arrayBuffer().then(t)}var B=x.videoMedia;B.ctx.drawImage(B.video,0,0);B=B.canvas;B.convertToBlob?B.convertToBlob({type:"image/jpeg",quality:.6}).then(y):B.toBlob(y,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,
max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,
capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};x.WEBAUTHN=function(t){function y(){if(F){var I=Error("Cancelling existing WebAuthn API call for new one");I.name="WebAuthnAbortError";F.abort(I)}F=new AbortController;return F.signal}function B(){if(F){var I=Error("Manually cancelling existing WebAuthn API call");I.name="WebAuthnAbortError";F.abort(I);F=void 0}}var r=new t;r.name="WebAuthN_Channel";r.newInstance=function(){return x.WEBAUTHN(t)};
r.onopen=function(){svGlobal.logger.info("webAuthn open")};r.onclose=function(){svGlobal.logger.info("webAuthn close")};var F=null;r.process=function(I){var S=I.getEnd()-I.getPosition();I=I.getBytes(S);var X=Hb(I),Q=X.command;S=X.flags;I=X.timeout;var oa=X.webAuthNPara;if(Q)switch(console.log("==== command: "+X.command),Q){case 5:if(X.request)switch(Q=X.request[0],console.log("==== webAuth cmdType = "+Q),console.log("==== webAuth request bytes: "+ub(X.request.slice(1,X.request.length))),Q){case 1:X=
X.request.slice(1,X.request.length);var w=Hb(X);X=w[1];var V=w[2],ja=w[3],W=w[4],ca=w[5];Q=w[6];var ba=w[7];w={};var pa=yd(oa);pa&&(pa.attestation&&(w.attestation=pa.attestation),pa.attestationFormats&&(w.attestationFormats=pa.attestationFormats));if(S=xd(S,oa,ba))w.authenticatorSelection=S;w.challenge=X;ca&&(w.excludeCredentials=Dc(ca));w.rpId=V.id;w.rp=V;w.extensions=Q?Q:{};w.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};W&&(w.pubKeyCredParams=
W);I&&(w.timeout=I);w.user=ja;I={};I.signal=y();I.publicKey=w;navigator.credentials.create(I).then(function(Z){zd(Z.response,V).then(function(fa){var R={},ma={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},Ba=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);ma.aaGuid=Ba.buffer;ma.residentKey=!0;R.deviceInfo=ma;
R.status=0;R.response=fa;fa=CBOR.encode(R);R=new hi5.DataBuffer(new Uint8Array(4+fa.byteLength));R.setLittleEndian32(0);R.setBytes(fa);R.markEnd();r.send(R)})}).catch(function(Z){console.log("WebAuthN MakeCredential failed with error code ["+Z.code+"], msg: "+Z.message);Z=new hi5.DataBuffer(new Uint8Array(4));Z.setLittleEndian32(1);Z.markEnd();r.send(Z)});break;case 2:X=X.request.slice(1,X.request.length);w=Hb(X);X=w[2];ja=w[3];Q=w[4];ba=w[5];w={};ja&&(w.allowCredentials=Dc(ja));w.challenge=X;Q&&
(w.extensions=Q);w.rp=window.location.hostname;I&&(w.timeout=I);if(I=Cc(S,oa,ba))w.userVerification=I;I={};I.signal=y();I.publicKey=w;navigator.credentials.get(I).then(function(Z){Z=new hi5.DataBuffer(new Uint8Array(void 0));Z.markEnd();r.send(Z)}).catch(function(Z){console.log("WebAuthN GetAssertion failed with error code ["+Z.code+"], msg: "+Z.message);Z=new hi5.DataBuffer(new Uint8Array(4));Z.setLittleEndian32(1);Z.markEnd();r.send(Z)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+
Q)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:I=new hi5.DataBuffer(new Uint8Array(8));I.setLittleEndian32(0);S=Bc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;S?I.setLittleEndian32(1):I.setLittleEndian32(0);I.markEnd();r.send(I);break;case 7:B();I=new hi5.DataBuffer(new Uint8Array(4));I.setLittleEndian32(0);I.markEnd();r.send(I);break;case 8:I=new hi5.DataBuffer(new Uint8Array(8));I.setLittleEndian32(0);I.setLittleEndian32(4);
I.markEnd();r.send(I);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+Q)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return r};n.enableWebAuthn()&&Bc()&&(a=x.WEBAUTHN(n.DynamicChannel),n.addDynamicChannel(a));x.WEBCAM=function(t){var y=new t;y.name="RDCamera_Device_0";y.version=2;y.newInstance=function(){return x.WEBCAM(t)};y.onopen=function(){svGlobal.logger.info("cam open")};y.onclose=function(){svGlobal.logger.info("cam close")};y.sendSucess=
function(){var B=new hi5.DataBuffer(new Uint8Array(2));B.setByte(y.version);B.setByte(1);B.markEnd();y.send(B)};y.sendError=function(B){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(y.version);r.setByte(2);r.setLittleEndian32(B||1);r.markEnd();y.send(r)};y.sendSteamListResp=function(){var B=new hi5.DataBuffer(new Uint8Array(7));B.setByte(y.version);B.setByte(10);B.setLittleEndian16(1);B.setByte(1);B.setByte(1);B.setByte(0);B.markEnd();y.send(B)};y.sendMediaTypeListResp=function(B){var r=x.videoMedia.resolutions,
F=r.length,I=new hi5.DataBuffer(new Uint8Array(2+26*F));I.setByte(y.version);I.setByte(12);for(var S=1==B,X=0;X<F;X++){I.setByte(B);var Q=r[X];I.setLittleEndian32(Q.width);I.setLittleEndian32(Q.height);I.setLittleEndian32(S?Q.frameRate:x.videoMedia.minFrameRate);I.setLittleEndian32(1);I.setLittleEndian32(1);I.setLittleEndian32(1);I.setByte(1)}I.markEnd();y.send(I)};y.sendCurrentMediaType=function(B,r){var F=new hi5.DataBuffer(new Uint8Array(28));F.setByte(y.version);F.setByte(14);r=x.videoMedia.resolutions[r];
F.setByte(B);F.setLittleEndian32(r.width);F.setLittleEndian32(r.height);F.setLittleEndian32(1==B?r.frameRate:x.videoMedia.minFrameRate);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setByte(1);F.markEnd();y.send(F)};y.sendSampleResp=function(B){x.videoMedia.grabFrame(function(r){var F=new hi5.DataBuffer(new Uint8Array(r.byteLength+3));F.setByte(y.version);F.setByte(18);F.setByte(B);F.setBytes(new Uint8Array(r));F.markEnd();y.send(F)})};y.sendPropertyListResp=function(){for(var B=
0,r,F,I=x.videoMedia.propertyList,S=0;2>S;S++){F=I[S];r=F.length;for(var X=0;X<r;X++)null!=F[X]&&B++}var Q=new hi5.DataBuffer(new Uint8Array(2+19*B));Q.setByte(y.version);Q.setByte(21);for(S=0;2>S;S++){F=I[S];r=F.length;var oa=S+1;for(X=0;X<r;X++)B=F[X],null!=B&&(Q.setByte(oa),Q.setByte(B.propertyId),Q.setByte(B.capabilities),Q.setLittleEndian32(B.min),Q.setLittleEndian32(B.max),Q.setLittleEndian32(B.step),Q.setLittleEndian32(B.default))}Q.markEnd();y.send(Q)};y.sendPropertyValueResp=function(B,r){(B=
x.videoMedia.propertyList[B-1][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(y.version),r.setByte(23),r.setByte(B.capabilities),r.setLittleEndian32(B.default),r.markEnd(),y.send(r)):y.sendError(8)};y.setPropertyValue=function(B,r,F){if(B=x.videoMedia.propertyList[B-1][r-1])B.default=F};y.process=function(B){B.getByte();var r=B.getByte();switch(r){case 7:x.videoMedia.activate(y.sendSucess,y.sendError);break;case 8:x.videoMedia.deactivate();y.sendSucess();break;case 9:y.sendSteamListResp();
break;case 11:B=B.getByte();0!=B&&svGlobal.logger.warn("Invalid stream index: "+B);y.sendMediaTypeListResp(x.videoMedia.type);break;case 13:B=B.getByte();y.sendCurrentMediaType(x.videoMedia.type,B);break;case 15:B.getByte();r=B.getByte();if(r!=x.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);y.sendError(6);break}r=B.getLittleEndian32();var F=B.getLittleEndian32();B=B.getLittleEndian32()/B.getLittleEndian32();x.videoMedia.startStream(r,F,B,y.sendSucess,y.sendError);break;case 16:x.videoMedia.stopStream();
y.sendSucess();break;case 17:B=B.getByte();0!=B&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+B);y.sendSampleResp(B);break;case 20:y.sendPropertyListResp();break;case 22:r=B.getByte();F=B.getByte();y.sendPropertyValueResp(r,F);break;case 24:r=B.getByte();F=B.getByte();var I=B.getByte();B=B.getLittleEndian32();1==I&&y.setPropertyValue(r,F,B);y.sendSucess();break;default:y.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+r)}};return y};x.WEBCAM_ENUM=function(t,y){var B=new t;
B.name="RDCamera_Device_Enumerator";B.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));r.setByte(y.version);r.setByte(3);r.markEnd();B.send(r);svGlobal.logger.info("camEnum open")};B.onclose=function(){svGlobal.logger.info("camEnum closed");x.videoMedia.deactivate()};B.addDevice=function(r){r+="\x00";var F=y.name+"\x00",I=new hi5.DataBuffer(new Uint8Array(2+2*r.length+F.length));I.setByte(y.version);I.setByte(5);I.setUnicodeString(r);I.setAscllString(F);I.markEnd();B.send(I)};B.process=
function(r){var F=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+F);y.version=F;B.addDevice(hi5.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return B};d&&(d=x.WEBCAM(n.DynamicChannel),a=x.WEBCAM_ENUM(n.DynamicChannel,d),n.addDynamicChannel(a),n.addDynamicChannel(d));h&&(svGlobal.logger.info("Mapping USB..."),n.addDynamicChannel(Fa.usbChannel));if(b&&x.GFX){var z=function(){P.drawable.resumePlay||(P.drawable.resumePlay=
function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();P.resumeVideo()})},P=x.GFX(n.DynamicChannel,U(O.remotefx)&&!U(O.gfx),0==n.mode,sa,O.hardwareAcceleration);P.onmessage=function(t){n.showMessage(t)};z();P.onuserinteract=function(t){ia.execute("showPlay");z();svGlobal.logger.info("resumePlay");return!0};P.onfatalerror=function(t,y){n.reconnect(t.width,t.height,!0)};P.onsps=function(t){t.fps&&n.setFPS(t.fps)};P.onresetgraphic=function(t){n.setResolution(t.width,t.height)};P.onmapsurface=function(t){P.onconfirm();
var y=ia.getMonitorSurface(t.outputOriginX,t.outputOriginY,t.targetWidth+t.outputOriginX-1,t.targetHeight+t.outputOriginY-1);y?(y.setId(t.id),y.setSize(t.targetWidth,t.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+t.outputOriginX+" y:"+t.outputOriginY)};P.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ia.execute("setDrawable",[P.drawable])};n.addDynamicChannel(P)}x.VOR&&(b=x.VOR(n.DynamicChannel),n.addDynamicChannel(b[0]),n.addDynamicChannel(b[1]),n.addDynamicChannel(x.GT(n.DynamicChannel)))}}},
db=null;svGlobal.DCVC_EXTENSION&&!kb&&(n.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Fa.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(n.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(n.GatewayChannel),n.addGatewayChannel(db)));this.getPrinters=function(a){if(!n.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();n.onagentmessage(b.getData());db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,
n)};this.showError=Gb;this.resetStatus=ac;this.exeAppCmd=function(a){var b=ia.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ia.getWinById(a):ia.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ka.forceReconnect||!1);if(!Ia&&!c)return!1;O.minWidth&&a<O.minWidth&&(a<O.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+O.minWidth),a=O.minWidth);O.minHeight&&
b<O.minHeight&&(b<O.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+O.minHeight),b=O.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ka)&&4>Math.abs(b-La))return!1;if(Sa&&Sa.enabled&&!1!==ka.displayVC)Sa.applyResolution(a,b);else if(pc&&qb||c||Wa&&!pc)qb=!1,svGlobal.logger.info("reconnecting..."),ua("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ua(a)};this.getUploadManager=function(){return Na};
this.setFPS=function(a){ia.execute("setFPS",[a])};this.addSurface=function(a){if(!ia.hasSurface(a)&&(Kb||sa.setContext(a.context),!ia.hasSurface(a)||!a.railWin)){kb&&a.setPlayerMode();O.mouseMoveEmu&&(a.mouseMoveEmu=U(O.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ka&&(Ka=b.width);0==La&&(La=b.height);a.setConfig(ka);ia.addSurface(a);Oa(Ka,La,!0,O.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Sd);a.setTouchpad(U(O.touchpad));var c=b=U(O.mapClipboard),e=b;void 0!=O.copyToLocal?
c=U(O.copyToLocal):void 0!=ka.copyToLocal&&(c=ka.copyToLocal);void 0!=O.copyToRemote?e=U(O.copyToRemote):void 0!=ka.copyToRemote&&(e=ka.copyToRemote);a.setClipboard(b,c,e);Jb&&bc(a);O.invitation&&!U(O.control)&&(ia.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=O.ctrlToWin?U(O.ctrlToWin):void 0!=ka.ctrlToWin?ka.ctrlToWin:!0;c=void 0!=O.cmdToCtrl?U(O.cmdToCtrl):void 0!=ka.cmdToCtrl?ka.cmdToCtrl:!0;a.run(parseInt(O.keyboard||1033,10),b,!!ka.noKeyStuck,c)}};this.getRunninApps=
this.getRunningApps=function(){for(var a=[],b=0,c=ia.size();b<c;b++)ia.getSurface(b).railWin.getMain(ia.zOrders)&&a.push(ia.getSurface(b).railWin.getMain(ia.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ua("8C2"+a+"\t"+b+"\t"+c);var e=ia.getSurface(ia.size()-1);e&&(e.remoteApp=new Ac(a,b,c))};this.startExitingApp=function(a){a=ia.popWins(a);for(var b=a.length-1;0<=b;b--)ia.addWin(a[b])};var xb=new n.DynamicChannel;xb.name="PNPDR";xb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};
xb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),xb.send(a)}};xb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};n.addDynamicChannel(xb);var gb=null;U(O.scanner)&&(gb=new n.DynamicChannel,gb.name="SCANNERDVC",gb.onopen=
function(){svGlobal.logger.info("scanner DVC onopen().")},gb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(n.onagentmessage)n.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(n.onagentmessage)n.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();
b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(n.onagentmessage)n.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},gb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addDynamicChannel(gb));var ab=null;n.hasSmartCard()&&(ab=new n.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(n.onagentmessage)n.onagentmessage(a);
U(O.passwordIsPin)&&n.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(n.onagentmessage)n.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;yb&&(b+=yb.length);eb&&(b+=eb.length);b=new hi5.DataBuffer(new Uint8Array(b));
b.setByte(3);b.setByte(9);yb?(b.setLittleEndian32(yb.length),b.setBytes(yb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(n.onagentmessage)n.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(n.onagentmessage)n.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+
a[1]+"].")}break;case 2:if(ab)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),n.onagentmessage)n.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addGatewayChannel(ab));ka.detectNetwork&&(q+="&connectType=7",
Cd());this.getNetworkResult=function(){return cc};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var dc=new Map,ec=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));
switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:dc.clear();ec.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",
b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var h=b.getLittleEndian32();h=b.getAscllString(h,!1);var p=b.getLittleEndian32();p=b.getAscllString(p,!1);var L=b.getLittleEndian32();b.getAscllString(L,!1);L=b.getLittleEndian64();L=(new Date(1E3*
L)).toDateString();d=Dd(a,d,p,h,L);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var A,E=document.querySelector('input[name="scard_name"]:checked');E&&(A=parseInt(E.value));yb=dc.get(A);rb=ec.get(A);A=document.getElementById("userPin").value;
eb=(new TextEncoder("utf-8")).encode(A);A=2;A=eb?A+4+eb.length:A+4;A=rb?A+4+rb.length:A+4;A=new Uint8Array(A);A=new hi5.DataBuffer(A);A.setByte(1);A.setByte(2);eb?(A.setLittleEndian32(eb.length),A.setBytes(eb)):A.setLittleEndian32(0);rb?(A.setLittleEndian32(rb.length),A.setAsciiString(rb,rb.length)):A.setLittleEndian32(0);ab&&ab.send(A)};document.getElementById("userPin").addEventListener("keypress",function(A){"Enter"===A.key&&(A.preventDefault(),document.getElementById("continue_button").click())});
b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(gb)switch(a[1]){case 2:b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML=
"<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,n.onagentmessage)n.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=
b.getAscllString(41,!0),d=Ed(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var A=0,E=document.querySelector('input[name="ds_name"]:checked');E&&(A=E.value);E=new Uint8Array(3);E[0]=4;E[1]=5;E[2]=A;if(n.onagentmessage)n.onagentmessage(E)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));gb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();n.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>
b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=n.getAgentLink(),hi5.notifications.notify({title:b,html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)h=b.getLittleEndian32(),d=b.getUnicodeString(h),h=b.getLittleEndian32(),h=b.getUnicodeString(h),c.push({name:d,driver:h});
db&&db.listCallback&&(db.listCallback(c),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var yb,eb,rb,hc={type:6,data:null};this.setAgentStatus=function(a){Vc=a};this.getAgentStatus=function(){return Vc};this.run=function(){var a;if(a=null==n.onagentmessage)a=1==n.mode?!1:n.hasSmartCard()||n.hasScanner()||U(O.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(n):(n.hasUSB()?ia.getFocused().requestUsbDevices(n.getUSB(),
function(b){Fa.usbChannel.openDevices(b);fc()}):fc(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return sa};this.mouseDown=function(a,b,c){Wa&&ua("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Wa&&ua("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Wa&&ua("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Wa&&ua("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Wa&&("number"==typeof a?(ua("840\t"+a),ua("8449152\t"+a)):ua("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,
b){n.reconnectOnResize&&(Va?(nb&&(clearTimeout(nb),nb=0),a&=-4,b&=-4,nb=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){n.writeRawInput("8C661441\t"+a+"\t"+b);3==n.windowState&&Tc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):n.running()&&(nb&&(clearTimeout(nb),nb=0),nb=setTimeout(function(){document.hidden||n.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!n.sessionInfo.suppressOutput)return!1;
void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Xb,b[4]=Xb>>8,b[5]=Wb,b[6]=Wb>>8,b[7]=Yb,b[8]=Yb>>8,b[9]=Zb,b[10]=Zb>>8);ua(b.buffer);return!0};this.refreshOutput=function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ua(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ua(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||
(Qa=new hi5.tool.ResponseMonitor(function(){Wa&&n.sendPing()},function(){if(Wa&&n.onnoresponse)return n.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;ua(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ma?Ma.postMessage({type:0,cmd:6,start:1}):(Ca.onSlowPath=Ca.onFastPath=Kc,Ca.onReqHistory=function(){Kc(15555)})};this.stopPing=function(){Qa&&Qa.stop();Ma?Ma.postMessage({type:0,cmd:6,start:0}):Ca.onSlowPath=Ca.onFastPath=Ca.onReqHistory=null};
var Ya=null,Qc=0;this.play=function(){ua("F3")};this.pause=function(){ua("F2")};this.scan=function(a){ua("F4"+(a?"1":"0"))};this.seek=function(a){var b=ia.getFocused();b&&Ia&&(ua("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),sa.pause(!0))};var Da={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();
this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Pc=!1;this.showMessage=function(a,b,c){n&&n.displayMsg&&a&&((b=b||ia.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(){svGlobal.logger.info("closing...");Ia&&Va&&ia&&ka.closeRemoteApp&&ia.tryCloseRemoteApps();sa&&sa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),
setTimeout(Sc,2222)):Sc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(n.close):window.addEventListener("unload",n.close,!1);Lb.searchStartCode=function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};qc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Mb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
Mb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d){function h(w,V,ja,W){this.pixels=w;this.width=V;this.height=ja;this.key=W}function p(){this.bottom=this.right=this.top=this.left=0;this.read=function(w){this.left=w.getLittleEndian16();this.top=w.getLittleEndian16();this.right=w.getLittleEndian16();this.bottom=w.getLittleEndian16()};this.toString=
function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function L(){this.qualityVal=this.p=this.qb=0;this.read=function(w){var V=w.getByte();this.qp=V&63;this.p=V>>7&1;this.qualityVal=w.getByte()}}function A(w,V,ja){this.bitstream=w;this.regionRects=V;this.isChroma=ja;this.timestamp=0}function E(w,V,ja){this.width=w;this.height=V;this.monitors=ja}function J(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(w){this.left=w.getLittleEndian32();
this.top=w.getLittleEndian32();this.right=w.getLittleEndian32();this.bottom=w.getLittleEndian32();this.flags=w.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function x(w,V,ja,W){function ca(){R=!1;ma.drawable=Z._video;Z._player=ba?new Qd(Z,!1,W):new Mb(ma.drawable,Z,!1);Z._player.onsps=function(f){ba&&(Z._video.width=f.width,Z._video.height=f.height);Z.onsps&&Z.onsps(f)};Z._player.onerror=
function(f){Z.onfatalerror&&Z.onfatalerror(Z,f)};Z._player.onplayerror=function(f){function l(){ma={drawable:Z._video};Z.player.play(!0)}ma=null;if((!Z.onuserinteract||!Z.onuserinteract(l,"video"))&&Z.onmessage)Z.onmessage({msg:"Please click Yes to continue.<br>"+f,cbYes:function(){Z.player.play(!0);this.destroy()}})};Z._player.onframedecoded=function(f){pa.drawImage(f,0,0)}}this.id=w;this.width=V;this.height=ja;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=V;this.targetHeight=
ja;this._player=null;var ba="no-decoder"==W?!1:!!window.VideoDecoder;this._video=ba?new OffscreenCanvas(V,ja):document.createElement("video");var pa=ba?this._video.getContext("2d"):null,Z=this,fa=null,R=!0,ma={drawable:null},Ba=10;ba&&svGlobal.logger.info("...MediaDecoder in use: "+W);this.resumeVideo=function(){Z._player&&Z._player.play(!0)};this.setDisplayBuffer=function(f){fa=f};this.draw=function(f,l,k,g){return R?fa.draw(f,l,k,g):ma};this.processAvc=function(f){R&&ca();if(ba)f.timestamp=Ba,Ba+=
10;else if(f.isChroma)return;Z.onvideoframe(f)};this.reset=function(f,l){Z&&Z._player&&Z._player.reset()};this.close=function(){Z&&Z._player&&(Z._player.close(),Z._player=null);Z=null};this.setRGBs=function(f,l,k,g,u,v,D){fa.setRGBs(f,l,k,g,u,v,D)};this.getRGBs=function(f,l,k,g){return fa.getRGBs(f,l,k,g)};this.moveArea=function(f,l,k,g,u,v){fa.moveArea(f,l,k,g,u,v)};this.fillRect=function(f,l,k,g,u){fa.fillRect(f,l,k,g,u)};this.postPaint=function(f,l,k,g){R&&fa.postPaint(f,l,k,g)}}function z(w,V,
ja,W){var ca=new x(w,V,ja,d);ca.pixelFormat=W||33;ca.setDisplayBuffer(e);oa.push(ca);Q.oncreatesurface&&Q.oncreatesurface(ca);svGlobal.logger.info("create surface id:"+w+" w:"+V+" h:"+ja+" pixelFmt:"+ca.pixelFormat);return ca}function P(w,V,ja){for(var W=w.getPosition(),ca=w.getLittleEndian32(),ba=Array(ca),pa=0;pa<ca;pa++){var Z=new p;Z.read(w);ba[pa]=Z}Z=Array(ca);for(pa=0;pa<ca;pa++){var fa=new L;fa.read(w);Z[pa]=fa}w=w.getBytes(V-(w.getPosition()-W));return new A(w,ba,ja)}function t(w,V,ja,W){ja=
w.getLittleEndian32();var ca=ja>>>30;ja&=1073741823;switch(ca){case 0:var ba=P(w,ja,!1);var pa=P(w,V-ja-4,!0);break;case 1:ba=P(w,ja,!1);break;case 2:V=w.getEnd()-w.getPosition();pa=P(w,V,!0);break;default:throw Error("Invalid LC: "+ca);}ba&&W.processAvc(ba);pa&&W.processAvc(pa)}function y(w){var V=w.getLittleEndian32(),ja=w.getLittleEndian32();w=w.getLittleEndian32();var W=!1;switch(V){case 524292:W=!1;0==(w&1)&&(F=new ClearDecoder);break;case 524549:(W=0!=(w&16))||0!=(w&1)||(F=new ClearDecoder);
break;default:W=0==(w&32)}e.onGetGfxHistory=function(ca,ba){var pa=B.toPDU();pa&&ca(pa);ba();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(ca,ba){svGlobal.logger.info("Set GFX Histroy");10==ca?B.fromStream(ba):svGlobal.logger.error("Invalid GFX histroy type: "+ca)};svGlobal.logger.info("Gfx Cap, Ver:"+V.toString(16)+" len:"+ja+" flags:"+w+" h264:"+W);Q.onconfirm&&Q.onconfirm();return W}var B=new function(){function w(g,u,v,D,C){this.len=g;this.code=u;this.valueBits=v;this.type=
D;this.vbase=C}function V(g){var u=25E5-ba,v=g.length;if(u>=v)ca.set(g,ba),ba=u>v?ba+v:0;else if(25E5>=v)ca.set(g.subarray(0,u),ba),ca.set(g.subarray(u),0),ba=v-u;else{u=(v-u)%25E5;var D=v-u,C=g.subarray(D);g=g.subarray(v-25E5,D);ca.set(g,25E5-g.length);ca.set(C,0);ba=u}}function ja(g){for(;ma<g;)R<<=8,Ba<l?R+=f[Ba++]:console.log("--- end"),ma+=8;fa-=g;ma-=g;g=R>>ma;R&=(1<<ma)-1;return g}var W=[new w(1,0,8,0,0),new w(5,17,5,1,0),new w(5,18,7,1,32),new w(5,19,9,1,160),new w(5,20,10,1,672),new w(5,
21,12,1,1696),new w(5,24,0,0,0),new w(5,25,0,0,1),new w(6,44,14,1,5792),new w(6,45,15,1,22176),new w(6,52,0,0,2),new w(6,53,0,0,3),new w(6,54,0,0,255),new w(7,92,18,1,54944),new w(7,93,20,1,317088),new w(7,110,0,0,4),new w(7,111,0,0,5),new w(7,112,0,0,6),new w(7,113,0,0,7),new w(7,114,0,0,8),new w(7,115,0,0,9),new w(7,116,0,0,10),new w(7,117,0,0,11),new w(7,118,0,0,58),new w(7,119,0,0,59),new w(7,120,0,0,60),new w(7,121,0,0,61),new w(7,122,0,0,62),new w(7,123,0,0,63),new w(7,124,0,0,64),new w(7,125,
0,0,128),new w(8,188,20,1,1365664),new w(8,189,21,1,2414240),new w(8,252,0,0,12),new w(8,253,0,0,56),new w(8,254,0,0,57),new w(8,255,0,0,102),new w(9,380,22,1,4511392),new w(9,381,23,1,8705696),new w(9,382,24,1,17094304)],ca=new Uint8Array(25E5),ba=0,pa=new Uint8Array(65536),Z=0,fa=0,R=0,ma=0,Ba=0,f=null,l=0,k=!0;this.toPDU=function(){if(k)return null;var g=new Uint8Array(2500008);g[0]=29;g[2]=1;g[3]=10;g[4]=ba;g[5]=ba>>8;g[6]=ba>>16;g[7]=ba>>24;g.set(ca,8);return g};this.fromStream=function(g){ba=
g.getLittleEndian32();ca.set(g.getSubarray(25E5))};this.decompress=function(g,u){if(u){f=g;k&&(k=!1);l=f.length-1;fa=8*l-f[l];for(Z=Ba=ma=R=0;0<fa;)for(var v=u=0,D=0;D<W.length;D++){for(g=W[D];u<g.len;)v=(v<<1)+ja(1),u++;0>v&&console.log("xxx inPrefix");if(v==g.code){if(0==g.type)g=g.vbase+ja(g.valueBits),(0>g||255<g)&&console.log("xxx do c"),g&=255,ca[ba]=g,25E5==++ba&&(ba=0),pa[Z++]=g;else if(u=ja(g.valueBits),u=g.vbase+u,0>u&&console.log("xxx distance"),0!=u){if(0==ja(1))g=3;else{g=4;for(v=2;1==
ja(1);)g*=2,v++;g+=ja(v)}u=25E5-u+ba;u%=25E5;v=u+g;if(Math.abs(ba-u)>=g&&25E5>v&&25E5>ba+g)u=ca.subarray(u,v),ca.set(u,ba),ba+=g,pa.set(u,Z),Z+=g;else for(;0<g;)v=ca[u],25E5==++u&&(u=0),ca[ba]=v,25E5==++ba&&(ba=0),pa[Z++]=v,g--}else g=ja(15),fa-=ma,R=ma=0,u=f.subarray(Ba,Ba+g),V(u),pa.set(u,Z),Ba+=g,Z+=g,fa-=8*g;break}}65536<Z&&console.error("xx outputIndex:"+Z);return pa.subarray(0,Z)}V(g);return g}},r=new function(){this.process=function(w){var V=w.getByte();if(224==V){var ja=0!=(w.getByte()&32);
var W=w.getPosition(),ca=w.getEnd();V=B.decompress(w.getData().subarray(W,ca),ja);w.setPosition(ca)}else{225!=V&&console.log("Invalid descriptor:"+V);ca=w.getLittleEndian16();var ba=w.getLittleEndian32();V=new Uint8Array(ba);for(var pa=0,Z,fa=0;fa<ca;fa++)Z=w.getLittleEndian32(),ja=0!=(w.getByte()&32),Z--,W=w.getPosition(),ja=B.decompress(w.getData().subarray(W,W+Z),ja),V.set(ja,pa),pa+=ja.length,w.skipPosition(Z);pa!=ba&&console.error("wrong size, actual:"+pa+" expected:"+ba)}return new RdpBuffer(V,
0,V.length)}},F=null,I=new rdpcodecs.RemoteFX(!1),S=0,X=[],Q=new a;Q.name="Microsoft::Windows::RDS::Graphics";var oa=new function(w,V){var ja=[];this.push=function(W){W.onsps=w.onsps;W.onfatalerror=w.onfatalerror;W.onplayerror=w.onplayerror;W.onuserinteract=w.onuserinteract;W.onmessage=w.onmessage;ja[W.id]=W};this.get=function(W){return ja[W]};this.getAll=function(){return ja};this.delete=function(W){var ca=ja[W];ca&&(ca.onsps=null,ca.onfatalerror=null,ca.onplayerror=null,ja[W]=null)};this.reset=
function(W){W=0;for(var ca=ja.length;W<ca;W++)ja[W]&&ja[W].reset()};this.close=function(){for(var W=0,ca=ja.length;W<ca;W++)ja[W]&&ja[W].close()};this.resumeVideo=function(){for(var W=0,ca=ja.length;W<ca;W++)ja[W]&&ja[W].resumeVideo()}}(Q,e);Q.drawable=new function(){this.draw=function(w,V,ja,W,ca){return(ca=oa.get(ca))?ca.draw(w,V,ja,W):null};this.getSurfaces=function(){return oa};this.onfocus=function(w){};this.resumePlay=null};Q.resumeVideo=function(){oa.resumeVideo()};Q.process=function(w){for(var V=
r.process(w);V.has(8);){var ja=V.getLittleEndian16();V.getLittleEndian16();var W=V.getLittleEndian32(),ca=V.getPosition()+W-8;switch(ja){case 1:var ba=V,pa=ba.getLittleEndian16(),Z=ba.getLittleEndian16(),fa=ba.getByte(),R=ba.getLittleEndian16(),ma=ba.getLittleEndian16(),Ba=ba.getLittleEndian16(),f=ba.getLittleEndian16(),l=Ba-R,k=f-ma,g=ba.getLittleEndian32(),u=ba.getPosition()+g,v=oa.get(pa);v||(Q.onconfirm&&Q.onconfirm(),v=z(pa,e.width,e.height,fa));switch(Z){case 0:var D=rdpcodecs.bitmap.byte2int(ba.getData(),
g,ba.getPosition());v.setRGBs(R,ma,l,k,D,0,l);break;case 3:for(var C=I.decode(ba,g),G=C.getRects(),aa=C.getTiles(),N=C.getTileSize(),m=C.getRectSize(),M=0;M<N;M++){var H=aa[M];if(m)for(var T=H.x+64,ha=H.y+64,ra=0;ra<m;ra++){var xa=G[ra],Ea=xa.x+xa.width,Ja=xa.y+xa.height;T<=Ea?ha<=Ja?v.setRGBs(H.x+R,H.y+ma,64,64,H.data,0,64):v.setRGBs(H.x+R,H.y+ma,64,Ja-H.y,H.data,0,64):ha<=Ja?v.setRGBs(H.x+R,H.y+ma,Ea-H.x,64,H.data,0,64):v.setRGBs(H.x+R,H.y+ma,Ea-H.x,Ja-H.y,H.data,0,64)}else v.setRGBs(H.x,H.y,64,
64,H.data,0,4)}break;case 8:F||(F=new ClearDecoder);F.decode(ba,l,k,v.getData(),R,ma,v.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Ga=v,za=P(ba,g,!1);Ga.processAvc(za);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:t(ba,g,!1,v);break;case 15:t(ba,g,!0,v);break;default:svGlobal.logger.warn("Invalid codec:"+Z)}ba.setPosition(u);v.postPaint(R,ma,l,k);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");
break;case 4:var Ha=V;svGlobal.logger.info("...soliFill");for(var wa=Ha.getLittleEndian16(),Aa=-16777216|Ha.getByte()<<16|Ha.getByte()<<8|Ha.getByte()|Ha.getByte()<<24,Pa=Ha.getLittleEndian16(),Za=oa.get(wa),$a=0;$a<Pa;$a++){var Xa=Ha.getLittleEndian16(),mb=Ha.getLittleEndian16(),wb=Ha.getLittleEndian16()-Xa,$c=Ha.getLittleEndian16()-mb;Za.fillRect(Xa,mb,wb,$c,Aa);Za.postPaint(Xa,mb,wb,$c)}break;case 5:var hb=V;svGlobal.logger.info("...surfaceToSurface");for(var ad=hb.getLittleEndian16(),bd=hb.getLittleEndian16(),
Ob=hb.getLittleEndian16(),Pb=hb.getLittleEndian16(),Qb=hb.getLittleEndian16()-Ob,uc=hb.getLittleEndian16()-Pb,Td=hb.getLittleEndian16(),cd=oa.get(ad),Ud=oa.get(bd),dd=ad==bd?null:cd.getRGBs(Ob,Pb,Qb,uc),ed=0;ed<Td;ed++){var fd=hb.getLittleEndian16(),gd=hb.getLittleEndian16();dd?Ud.setRGBs(fd,gd,Qb,uc,dd,0,Qb):cd.moveArea(Ob,Pb,Qb,uc,fd-Ob,gd-Pb)}break;case 6:var ob=V;svGlobal.logger.info("...surfaceToCache");var Vd=ob.getLittleEndian16(),vc=ob.getLittleEndian32().toString(16),hd=ob.getLittleEndian32();
0<hd&&(vc=hd.toString(16)+vc);var Wd=ob.getLittleEndian16(),id=ob.getLittleEndian16(),jd=ob.getLittleEndian16(),kd=ob.getLittleEndian16()-id,ld=ob.getLittleEndian16()-jd,Xd=oa.get(Vd).getRGBs(id,jd,kd,ld);X[Wd]=new h(Xd,kd,ld,vc);break;case 7:var Eb=V;svGlobal.logger.info("...cacheToSurface");for(var Yd=Eb.getLittleEndian16(),Zd=Eb.getLittleEndian16(),$d=Eb.getLittleEndian16(),Rb=X[Yd],ae=oa.get(Zd),md=0;md<$d;md++){var be=Eb.getLittleEndian16(),ce=Eb.getLittleEndian16();ae.setRGBs(be,ce,Rb.width,
Rb.height,Rb.pixels,0,Rb.width)}break;case 8:var de=V.getLittleEndian16();X[de]=null;break;case 9:var Sb=V,ee=Sb.getLittleEndian16(),fe=Sb.getLittleEndian16(),ge=Sb.getLittleEndian16(),he=Sb.getByte();z(ee,fe,ge,he);break;case 10:var nd=V.getLittleEndian16();oa.delete(nd);svGlobal.logger.info("delete surface id:"+nd);break;case 11:var od=V;od.getLittleEndian32();od.getLittleEndian32();break;case 12:var ie=V.getLittleEndian32();if(0==S){var pd=new Uint8Array(20),sb=new RdpBuffer(pd);sb.setLittleEndian16(13);
sb.setLittleEndian16(0);sb.setLittleEndian32(20);sb.setLittleEndian32(4294967295);sb.setLittleEndian32(ie);S++;sb.setLittleEndian32(S);sb.markEnd();c&&Q.send(pd)}break;case 14:var Tb=V,qd=Tb.getLittleEndian32(),rd=Tb.getLittleEndian32(),wc=Tb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+qd+" h:"+rd+" monitors:"+wc);for(var sd=Array(wc),Ub=0;Ub<wc;Ub++){var xc=new J;xc.read(Tb);sd[Ub]=xc;svGlobal.logger.info("MonitorDef "+Ub+": "+xc.toString())}var td=new E(qd,rd,sd);oa.reset(td);Q.onresetgraphic&&
Q.onresetgraphic(td);break;case 15:var Vb=V,ud=Vb.getLittleEndian16();Vb.skipPosition(2);var Fb=oa.get(ud);Fb.outputOriginX=Vb.getLittleEndian32();Fb.outputOriginY=Vb.getLittleEndian32();Q.onmapsurface&&Q.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+ud+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:y(V);break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;
case 23:var zb=V,vd=zb.getLittleEndian16();zb.skipPosition(2);var ib=oa.get(vd);ib.outputOriginX=zb.getLittleEndian32();ib.outputOriginY=zb.getLittleEndian32();ib.targetWidth=zb.getLittleEndian32();ib.targetHeight=zb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+vd+" outX:"+ib.outputOriginX+" outY:"+ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);Q.onmapsurface&&Q.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");
break;default:svGlobal.logger.warn("xxx gfx:"+ja);return}V.setPosition(ca)}};Q.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var w=b?2:8,V=10+12*w,ja=new Uint8Array(V),W=new RdpBuffer(ja);W.setLittleEndian16(18);W.setLittleEndian16(0);W.setLittleEndian32(V);W.setLittleEndian16(w);W.setLittleEndian32(524292);W.setLittleEndian32(4);W.setLittleEndian32(b?1:0);W.setLittleEndian32(524549);W.setLittleEndian32(4);W.setLittleEndian32(b?19:0);b||(W.setLittleEndian32(655362),W.setLittleEndian32(4),
W.setLittleEndian32(0),W.setLittleEndian32(655872),W.setLittleEndian32(4),W.setLittleEndian32(0),W.setLittleEndian32(656129),W.setLittleEndian32(4),W.setLittleEndian32(0),W.setLittleEndian32(656384),W.setLittleEndian32(4),W.setLittleEndian32(0),W.setLittleEndian32(656642),W.setLittleEndian32(4),W.setLittleEndian32(0),W.setLittleEndian32(656896),W.setLittleEndian32(4),W.setLittleEndian32(0));W.markEnd();c&&Q.send(ja)};Q.onclose=function(){oa.close()};return Q}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var q=navigator&&(navigator.language||navigator.userLanguage||""),K=Rdp.languageToKeyboard[q];if(!K){var Y=q.indexOf("-");Y&&(K=Rdp.languageToKeyboard[q.substring(0,Y)])}K||(svGlobal.logger.info("No valid layout for "+q),K=1033);return K}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
