var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(p){var I=0;return function(){return I<p.length?{done:!1,value:p[I++]}:{done:!0}}};$jscomp.arrayIterator=function(p){return{next:$jscomp.arrayIteratorImpl(p)}};$jscomp.makeIterator=function(p){var I="undefined"!=typeof Symbol&&Symbol.iterator&&p[Symbol.iterator];return I?I.call(p):$jscomp.arrayIterator(p)};$jscomp.arrayFromIterator=function(p){for(var I,T=[];!(I=p.next()).done;)T.push(I.value);return T};
$jscomp.arrayFromIterable=function(p){return p instanceof Array?p:$jscomp.arrayFromIterator($jscomp.makeIterator(p))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(p){var I=function(){};I.prototype=p;return new I};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(p,I,T){if(p==Array.prototype||p==Object.prototype)return p;p[I]=T.value;return p};$jscomp.getGlobal=function(p){p=["object"==typeof globalThis&&globalThis,p,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var I=0;I<p.length;++I){var T=p[I];if(T&&T.Math==Math)return T}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(p,I){var T=$jscomp.propertyToPolyfillSymbol[I];if(null==T)return p[I];T=p[T];return void 0!==T?T:p[I]};
$jscomp.polyfill=function(p,I,T,ka){I&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(p,I,T,ka):$jscomp.polyfillUnisolated(p,I,T,ka))};$jscomp.polyfillUnisolated=function(p,I,T,ka){T=$jscomp.global;p=p.split(".");for(ka=0;ka<p.length-1;ka++){var R=p[ka];if(!(R in T))return;T=T[R]}p=p[p.length-1];ka=T[p];I=I(ka);I!=ka&&null!=I&&$jscomp.defineProperty(T,p,{configurable:!0,writable:!0,value:I})};
$jscomp.polyfillIsolated=function(p,I,T,ka){var R=p.split(".");p=1===R.length;ka=R[0];ka=!p&&ka in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var va=0;va<R.length-1;va++){var Z=R[va];if(!(Z in ka))return;ka=ka[Z]}R=R[R.length-1];T=$jscomp.IS_SYMBOL_NATIVE&&"es6"===T?ka[R]:null;I=I(T);null!=I&&(p?$jscomp.defineProperty($jscomp.polyfills,R,{configurable:!0,writable:!0,value:I}):I!==T&&($jscomp.propertyToPolyfillSymbol[R]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(R):$jscomp.POLYFILL_PREFIX+
R,R=$jscomp.propertyToPolyfillSymbol[R],$jscomp.defineProperty(ka,R,{configurable:!0,writable:!0,value:I})))};
$jscomp.getConstructImplementation=function(){function p(){function T(){}new T;Reflect.construct(T,[],function(){});return new T instanceof T}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(p())return Reflect.construct;var I=Reflect.construct;return function(T,ka,R){T=I(T,ka);R&&Reflect.setPrototypeOf(T,R.prototype);return T}}return function(T,ka,R){void 0===R&&(R=T);R=$jscomp.objectCreate(R.prototype||Object.prototype);return Function.prototype.apply.call(T,R,ka)||
R}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var p={a:!0},I={};try{return I.__proto__=p,I.a}catch(T){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(p,I){p.__proto__=I;if(p.__proto__!==I)throw new TypeError(p+" is not extensible");return p}:null;
$jscomp.inherits=function(p,I){p.prototype=$jscomp.objectCreate(I.prototype);p.prototype.constructor=p;if($jscomp.setPrototypeOf){var T=$jscomp.setPrototypeOf;T(p,I)}else for(T in I)if("prototype"!=T)if(Object.defineProperties){var ka=Object.getOwnPropertyDescriptor(I,T);ka&&Object.defineProperty(p,T,ka)}else p[T]=I[T];p.superClass_=I.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(p){if(!(p instanceof Object))throw new TypeError("Iterator result "+p+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(p){this.yieldResult=p};
$jscomp.generator.Context.prototype.throw_=function(p){this.abruptCompletion_={exception:p,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(p){this.abruptCompletion_={return:p};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(p){this.abruptCompletion_={jumpTo:p};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(p,I){this.nextAddress=I;return{value:p}};
$jscomp.generator.Context.prototype.yieldAll=function(p,I){p=$jscomp.makeIterator(p);var T=p.next();$jscomp.generator.ensureIteratorResultIsObject_(T);if(T.done)this.yieldResult=T.value,this.nextAddress=I;else return this.yieldAllIterator_=p,this.yield(T.value,I)};$jscomp.generator.Context.prototype.jumpTo=function(p){this.nextAddress=p};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(p,I){this.catchAddress_=p;void 0!=I&&(this.finallyAddress_=I)};$jscomp.generator.Context.prototype.setFinallyBlock=function(p){this.catchAddress_=0;this.finallyAddress_=p||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(p,I){this.nextAddress=p;this.catchAddress_=I||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(p){this.catchAddress_=p||0;p=this.abruptCompletion_.exception;this.abruptCompletion_=null;return p};$jscomp.generator.Context.prototype.enterFinallyBlock=function(p,I,T){T?this.finallyContexts_[T]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=p||0;this.finallyAddress_=I||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(p,I){I=this.finallyContexts_.splice(I||0)[0];if(I=this.abruptCompletion_=this.abruptCompletion_||I){if(I.isException)return this.jumpToErrorHandler_();void 0!=I.jumpTo&&this.finallyAddress_<I.jumpTo?(this.nextAddress=I.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=p};$jscomp.generator.Context.prototype.forIn=function(p){return new $jscomp.generator.Context.PropertyIterator(p)};
$jscomp.generator.Context.PropertyIterator=function(p){this.object_=p;this.properties_=[];for(var I in p)this.properties_.push(I);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var p=this.properties_.pop();if(p in this.object_)return p}return null};$jscomp.generator.Engine_=function(p){this.context_=new $jscomp.generator.Context;this.program_=p};
$jscomp.generator.Engine_.prototype.next_=function(p){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,p,this.context_.next_);this.context_.next_(p);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(p){this.context_.start_();var I=this.context_.yieldAllIterator_;if(I)return this.yieldAllStep_("return"in I?I["return"]:function(T){return{value:T,done:!0}},p,this.context_.return);this.context_.return(p);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(p){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],p,this.context_.next_);this.context_.throw_(p);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(p,I,T){try{var ka=p.call(this.context_.yieldAllIterator_,I);$jscomp.generator.ensureIteratorResultIsObject_(ka);if(!ka.done)return this.context_.stop_(),ka;var R=ka.value}catch(va){return this.context_.yieldAllIterator_=null,this.context_.throw_(va),this.nextStep_()}this.context_.yieldAllIterator_=null;T.call(this.context_,R);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var p=this.program_(this.context_);if(p)return this.context_.stop_(),{value:p.value,done:!1}}catch(I){this.context_.yieldResult=void 0,this.context_.throw_(I)}this.context_.stop_();if(this.context_.abruptCompletion_){p=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(p.isException)throw p.exception;return{value:p.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(p){this.next=function(I){return p.next_(I)};this.throw=function(I){return p.throw_(I)};this.return=function(I){return p.return_(I)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(p,I){I=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(I));$jscomp.setPrototypeOf&&p.prototype&&$jscomp.setPrototypeOf(I,p.prototype);return I};
$jscomp.asyncExecutePromiseGenerator=function(p){function I(ka){return p.next(ka)}function T(ka){return p.throw(ka)}return new Promise(function(ka,R){function va(Z){Z.done?ka(Z.value):Promise.resolve(Z.value).then(I,T).then(va,R)}va(p.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(p){return $jscomp.asyncExecutePromiseGenerator(p())};$jscomp.asyncExecutePromiseGeneratorProgram=function(p){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(p)))};
$jscomp.polyfill("Reflect",function(p){return p?p:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(p){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(p){if(p)return p;if($jscomp.setPrototypeOf){var I=$jscomp.setPrototypeOf;return function(T,ka){try{return I(T,ka),!0}catch(R){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(p){if(p)return p;var I=function(R,va){this.$jscomp$symbol$id_=R;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:va})};I.prototype.toString=function(){return this.$jscomp$symbol$id_};var T=0,ka=function(R){if(this instanceof ka)throw new TypeError("Symbol is not a constructor");return new I("jscomp_symbol_"+(R||"")+"_"+T++,R)};return ka},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(p){if(p)return p;p=Symbol("Symbol.iterator");for(var I="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),T=0;T<I.length;T++){var ka=$jscomp.global[I[T]];"function"===typeof ka&&"function"!=typeof ka.prototype[p]&&$jscomp.defineProperty(ka.prototype,p,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return p},"es6",
"es3");$jscomp.iteratorPrototype=function(p){p={next:p};p[Symbol.iterator]=function(){return this};return p};
$jscomp.polyfill("Promise",function(p){function I(){this.batch_=null}function T(Z){return Z instanceof R?Z:new R(function(sa,ba){sa(Z)})}if(p&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return p;I.prototype.asyncExecute=function(Z){if(null==this.batch_){this.batch_=[];var sa=this;this.asyncExecuteFunction(function(){sa.executeBatch_()})}this.batch_.push(Z)};
var ka=$jscomp.global.setTimeout;I.prototype.asyncExecuteFunction=function(Z){ka(Z,0)};I.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var Z=this.batch_;this.batch_=[];for(var sa=0;sa<Z.length;++sa){var ba=Z[sa];Z[sa]=null;try{ba()}catch(ia){this.asyncThrow_(ia)}}}this.batch_=null};I.prototype.asyncThrow_=function(Z){this.asyncExecuteFunction(function(){throw Z;})};var R=function(Z){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var sa=this.createResolveAndReject_();try{Z(sa.resolve,sa.reject)}catch(ba){sa.reject(ba)}};R.prototype.createResolveAndReject_=function(){function Z(ia){return function(ma){ba||(ba=!0,ia.call(sa,ma))}}var sa=this,ba=!1;return{resolve:Z(this.resolveTo_),reject:Z(this.reject_)}};R.prototype.resolveTo_=function(Z){if(Z===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(Z instanceof R)this.settleSameAsPromise_(Z);else{a:switch(typeof Z){case "object":var sa=null!=Z;break a;
case "function":sa=!0;break a;default:sa=!1}sa?this.resolveToNonPromiseObj_(Z):this.fulfill_(Z)}};R.prototype.resolveToNonPromiseObj_=function(Z){var sa=void 0;try{sa=Z.then}catch(ba){this.reject_(ba);return}"function"==typeof sa?this.settleSameAsThenable_(sa,Z):this.fulfill_(Z)};R.prototype.reject_=function(Z){this.settle_(2,Z)};R.prototype.fulfill_=function(Z){this.settle_(1,Z)};R.prototype.settle_=function(Z,sa){if(0!=this.state_)throw Error("Cannot settle("+Z+", "+sa+"): Promise already settled in state"+
this.state_);this.state_=Z;this.result_=sa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};R.prototype.scheduleUnhandledRejectionCheck_=function(){var Z=this;ka(function(){if(Z.notifyUnhandledRejection_()){var sa=$jscomp.global.console;"undefined"!==typeof sa&&sa.error(Z.result_)}},1)};R.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var Z=$jscomp.global.CustomEvent,sa=$jscomp.global.Event,ba=$jscomp.global.dispatchEvent;
if("undefined"===typeof ba)return!0;"function"===typeof Z?Z=new Z("unhandledrejection",{cancelable:!0}):"function"===typeof sa?Z=new sa("unhandledrejection",{cancelable:!0}):(Z=$jscomp.global.document.createEvent("CustomEvent"),Z.initCustomEvent("unhandledrejection",!1,!0,Z));Z.promise=this;Z.reason=this.result_;return ba(Z)};R.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var Z=0;Z<this.onSettledCallbacks_.length;++Z)va.asyncExecute(this.onSettledCallbacks_[Z]);
this.onSettledCallbacks_=null}};var va=new I;R.prototype.settleSameAsPromise_=function(Z){var sa=this.createResolveAndReject_();Z.callWhenSettled_(sa.resolve,sa.reject)};R.prototype.settleSameAsThenable_=function(Z,sa){var ba=this.createResolveAndReject_();try{Z.call(sa,ba.resolve,ba.reject)}catch(ia){ba.reject(ia)}};R.prototype.then=function(Z,sa){function ba(Oa,ua){return"function"==typeof Oa?function(sb){try{ia(Oa(sb))}catch(pb){ma(pb)}}:ua}var ia,ma,ya=new R(function(Oa,ua){ia=Oa;ma=ua});this.callWhenSettled_(ba(Z,
ia),ba(sa,ma));return ya};R.prototype.catch=function(Z){return this.then(void 0,Z)};R.prototype.callWhenSettled_=function(Z,sa){function ba(){switch(ia.state_){case 1:Z(ia.result_);break;case 2:sa(ia.result_);break;default:throw Error("Unexpected state: "+ia.state_);}}var ia=this;null==this.onSettledCallbacks_?va.asyncExecute(ba):this.onSettledCallbacks_.push(ba);this.isRejectionHandled_=!0};R.resolve=T;R.reject=function(Z){return new R(function(sa,ba){ba(Z)})};R.race=function(Z){return new R(function(sa,
ba){for(var ia=$jscomp.makeIterator(Z),ma=ia.next();!ma.done;ma=ia.next())T(ma.value).callWhenSettled_(sa,ba)})};R.all=function(Z){var sa=$jscomp.makeIterator(Z),ba=sa.next();return ba.done?T([]):new R(function(ia,ma){function ya(sb){return function(pb){Oa[sb]=pb;ua--;0==ua&&ia(Oa)}}var Oa=[],ua=0;do Oa.push(void 0),ua++,T(ba.value).callWhenSettled_(ya(Oa.length-1),ma),ba=sa.next();while(!ba.done)})};return R},"es6","es3");
$jscomp.checkStringArgs=function(p,I,T){if(null==p)throw new TypeError("The 'this' value for String.prototype."+T+" must not be null or undefined");if(I instanceof RegExp)throw new TypeError("First argument to String.prototype."+T+" must not be a regular expression");return p+""};
$jscomp.polyfill("String.prototype.startsWith",function(p){return p?p:function(I,T){var ka=$jscomp.checkStringArgs(this,I,"startsWith");I+="";var R=ka.length,va=I.length;T=Math.max(0,Math.min(T|0,ka.length));for(var Z=0;Z<va&&T<R;)if(ka[T++]!=I[Z++])return!1;return Z>=va}},"es6","es3");
$jscomp.iteratorFromArray=function(p,I){p instanceof String&&(p+="");var T=0,ka=!1,R={next:function(){if(!ka&&T<p.length){var va=T++;return{value:I(va,p[va]),done:!1}}ka=!0;return{done:!0,value:void 0}}};R[Symbol.iterator]=function(){return R};return R};$jscomp.polyfill("Array.prototype.keys",function(p){return p?p:function(){return $jscomp.iteratorFromArray(this,function(I){return I})}},"es6","es3");
$jscomp.polyfill("Array.from",function(p){return p?p:function(I,T,ka){T=null!=T?T:function(sa){return sa};var R=[],va="undefined"!=typeof Symbol&&Symbol.iterator&&I[Symbol.iterator];if("function"==typeof va){I=va.call(I);for(var Z=0;!(va=I.next()).done;)R.push(T.call(ka,va.value,Z++))}else for(va=I.length,Z=0;Z<va;Z++)R.push(T.call(ka,I[Z],Z));return R}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var p={},I=Object.create(new $jscomp.global.Proxy(p,{get:function(T,ka,R){return T==p&&"q"==ka&&R==I}}));return!0===I.q}catch(T){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(p,I){return Object.prototype.hasOwnProperty.call(p,I)};
$jscomp.polyfill("WeakMap",function(p){function I(){if(!p||!Object.seal)return!1;try{var ia=Object.seal({}),ma=Object.seal({}),ya=new p([[ia,2],[ma,3]]);if(2!=ya.get(ia)||3!=ya.get(ma))return!1;ya.delete(ia);ya.set(ma,4);return!ya.has(ia)&&4==ya.get(ma)}catch(Oa){return!1}}function T(){}function ka(ia){var ma=typeof ia;return"object"===ma&&null!==ia||"function"===ma}function R(ia){if(!$jscomp.owns(ia,Z)){var ma=new T;$jscomp.defineProperty(ia,Z,{value:ma})}}function va(ia){if(!$jscomp.ISOLATE_POLYFILLS){var ma=
Object[ia];ma&&(Object[ia]=function(ya){if(ya instanceof T)return ya;Object.isExtensible(ya)&&R(ya);return ma(ya)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(p&&$jscomp.ES6_CONFORMANCE)return p}else if(I())return p;var Z="$jscomp_hidden_"+Math.random();va("freeze");va("preventExtensions");va("seal");var sa=0,ba=function(ia){this.id_=(sa+=Math.random()+1).toString();if(ia){ia=$jscomp.makeIterator(ia);for(var ma;!(ma=ia.next()).done;)ma=ma.value,this.set(ma[0],ma[1])}};ba.prototype.set=function(ia,
ma){if(!ka(ia))throw Error("Invalid WeakMap key");R(ia);if(!$jscomp.owns(ia,Z))throw Error("WeakMap key fail: "+ia);ia[Z][this.id_]=ma;return this};ba.prototype.get=function(ia){return ka(ia)&&$jscomp.owns(ia,Z)?ia[Z][this.id_]:void 0};ba.prototype.has=function(ia){return ka(ia)&&$jscomp.owns(ia,Z)&&$jscomp.owns(ia[Z],this.id_)};ba.prototype.delete=function(ia){return ka(ia)&&$jscomp.owns(ia,Z)&&$jscomp.owns(ia[Z],this.id_)?delete ia[Z][this.id_]:!1};return ba},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(p){function I(){if($jscomp.ASSUME_NO_NATIVE_MAP||!p||"function"!=typeof p||!p.prototype.entries||"function"!=typeof Object.seal)return!1;try{var ba=Object.seal({x:4}),ia=new p($jscomp.makeIterator([[ba,"s"]]));if("s"!=ia.get(ba)||1!=ia.size||ia.get({x:4})||ia.set({x:4},"t")!=ia||2!=ia.size)return!1;var ma=ia.entries(),ya=ma.next();if(ya.done||ya.value[0]!=ba||"s"!=ya.value[1])return!1;ya=ma.next();return ya.done||4!=ya.value[0].x||"t"!=ya.value[1]||!ma.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(p&&$jscomp.ES6_CONFORMANCE)return p}else if(I())return p;var T=new WeakMap,ka=function(ba){this.data_={};this.head_=Z();this.size=0;if(ba){ba=$jscomp.makeIterator(ba);for(var ia;!(ia=ba.next()).done;)ia=ia.value,this.set(ia[0],ia[1])}};ka.prototype.set=function(ba,ia){ba=0===ba?0:ba;var ma=R(this,ba);ma.list||(ma.list=this.data_[ma.id]=[]);ma.entry?ma.entry.value=ia:(ma.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:ba,value:ia},ma.list.push(ma.entry),this.head_.previous.next=ma.entry,this.head_.previous=ma.entry,this.size++);return this};ka.prototype.delete=function(ba){ba=R(this,ba);return ba.entry&&ba.list?(ba.list.splice(ba.index,1),ba.list.length||delete this.data_[ba.id],ba.entry.previous.next=ba.entry.next,ba.entry.next.previous=ba.entry.previous,ba.entry.head=null,this.size--,!0):!1};ka.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Z();this.size=0};ka.prototype.has=
function(ba){return!!R(this,ba).entry};ka.prototype.get=function(ba){return(ba=R(this,ba).entry)&&ba.value};ka.prototype.entries=function(){return va(this,function(ba){return[ba.key,ba.value]})};ka.prototype.keys=function(){return va(this,function(ba){return ba.key})};ka.prototype.values=function(){return va(this,function(ba){return ba.value})};ka.prototype.forEach=function(ba,ia){for(var ma=this.entries(),ya;!(ya=ma.next()).done;)ya=ya.value,ba.call(ia,ya[1],ya[0],this)};ka.prototype[Symbol.iterator]=
ka.prototype.entries;var R=function(ba,ia){var ma=ia&&typeof ia;"object"==ma||"function"==ma?T.has(ia)?ma=T.get(ia):(ma=""+ ++sa,T.set(ia,ma)):ma="p_"+ia;var ya=ba.data_[ma];if(ya&&$jscomp.owns(ba.data_,ma))for(ba=0;ba<ya.length;ba++){var Oa=ya[ba];if(ia!==ia&&Oa.key!==Oa.key||ia===Oa.key)return{id:ma,list:ya,index:ba,entry:Oa}}return{id:ma,list:ya,index:-1,entry:void 0}},va=function(ba,ia){var ma=ba.head_;return $jscomp.iteratorPrototype(function(){if(ma){for(;ma.head!=ba.head_;)ma=ma.previous;for(;ma.next!=
ma.head;)return ma=ma.next,{done:!1,value:ia(ma)};ma=null}return{done:!0,value:void 0}})},Z=function(){var ba={};return ba.previous=ba.next=ba.head=ba},sa=0;return ka},"es6","es3");$jscomp.findInternal=function(p,I,T){p instanceof String&&(p=String(p));for(var ka=p.length,R=0;R<ka;R++){var va=p[R];if(I.call(T,va,R,p))return{i:R,v:va}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(p){return p?p:function(I,T){return $jscomp.findInternal(this,I,T).i}},"es6","es3");
var svManager={getInstance:function(){var p=window.$rdp;return p&&p.running&&p.running()?p:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(p){var I={};I.id=p.id;I.server=p.id;I.displayName=p.displayName||p.id;if(p=p.rdp){for(var T in p)I[T]=p[T];I.user=p.username||"";I.pwd=p.password||"";I.useConsole=p.console||!1;I.legacyMode=p.leagacyMode||p.legacyMode||!1;I.server_bpp=p.color||16;I.exe=p.remoteProgram||"";I.args=p.remoteArgs||"";I.startProgram=0<I.exe.length?"app":I.command&&0<I.command.length?"shell":"noapp"}return I}
function Rdp2(p){p=svGlobal.util.getServerArgs(p);if(!p||!p.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var I=p.gateway||"",T=0,ka=0,R=16,va=1==p.useSSL||"true"==p.useSSL||"on"==p.useSSL||null;p.width&&(T=parseInt(p.width,10));p.height&&(ka=parseInt(p.height,10));p.color&&(R=parseInt(p.color,10));p.server_bpp&&(R=parseInt(p.server_bpp,10));p=hi5.browser.obj2url(p);null===va&&(va="https:"==location.protocol);return new Rdp((va?"wss://":"ws://")+I+"/RDP?"+p,T,ka,R)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(p,I,T,ka){function R(a){return"on"==a||"true"==a||1==a}function va(){var a=q.gateway;q.ongetgatewayaddress&&(a=q.ongetgatewayaddress(a));return a}function Z(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function sa(a,b){a=ha[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function ba(){return L.displayName||L.server||L.symlink||L.id||"undefined"}function ia(a){q.loadbalanceToken||
(q.loadbalanceToken=ha.loadbalanceTokenName?ha.loadbalanceTokenName+"="+a:"")}function ma(a,b,c){q.ontitlechange&&(a=q.ontitlechange(a,c));q.setTitle&&a&&(b=b||window,b.document.title=a)}function ya(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return L.invitation||q.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(La?La.postMessage({type:0,cmd:1,data:a}):Ba&&Ba.setColor(a));return!0}function Oa(a,b,c,e){Ja=a;Ka=b;Xb=Yb=0;Zb=Ja-1;$b=Ka-1;Va&&(Ja=(L.waWidth||
hi5.browser.getScreenWidth())|0,Ka=(L.waHeight||hi5.browser.getScreenHeight())|0);L.minWidth&&Ja<L.minWidth&&(Ja=L.minWidth|0);L.minHeight&&Ka<L.minHeight&&(Ka=L.minHeight|0);Ja&=-4;Ka&=-4;svGlobal.logger.warn("resolution changed, w:"+Ja+" h:"+Ka);var d=Ja,g=Ka;qa?qa.resize(d,g):qa=new yc(d,g);ea.setSize(Ja,Ka,Va?"hidden":null);if(c||Ja!=a||Ka!=b)La?La.postMessage({type:0,cmd:2,data:{w:Ja,h:Ka}}):Ba&&Ba.setResolution(Ja,Ka);if(q.onresolutionchange&&!e)q.onresolutionchange(a,b)}function ua(a){!bb&&
Ha&&(La?(ac.data=a,"string"!=typeof a?La.postMessage(ac,[a]):La.postMessage(ac)):Ba.writeRawInput(a))}function sb(a){switch(a){case "\r":break;case "\n":q.writeScancode(28);break;case "\t":q.writeScancode(15);break;default:ua("86"+a)}}function pb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),g=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=g?5:9;c=new Uint8Array(e+c);c[0]=a;if(g)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{g=b.name;for(var n=Math.min(g.length,8),H=0;H<n;H++)c[1+H]=g.charCodeAt(H)}c.set(d,e);ua(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Gb(a){if(q){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};q.displayMsg&&q.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(q.onerror)q.onerror(a)}}function zc(a){if(q){var b=__svi18n.info[a];b||(b="info "+a);q.displayMsg&&q.showMessage(b);svGlobal.logger.info(b)}}function bc(){var a=Ha;qb=Ha=!1;
La?La.postMessage({type:0,cmd:3}):Ba&&Ba.resetStatus();a&&(Ha=a)}function cc(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(ua)),Ma.addEvent("beforeupload",function(b,c,e){if(q.beforeupload)return q.beforeupload(b,c,e)}),Ma.addEvent("fileuploaded",function(b,c,e){if(q.onfileuploaded)q.onfileuploaded(b,c,e)}),Ma.addEvent("uploaded",function(b,c){if(q.onuploaded)q.onuploaded(b,c)}),Ma.addEvent("uploadingCancelled",function(){if(q.onuploadingCancelled)q.onuploadingCancelled()}));a.setFileHandler(Ma)}
function Ac(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ha&&(e=!0,ua("8C5"+d.exe+"\t"+d.args+"\t"+q.sessionInfo.appInfo.session))}}function wd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Bc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Hb(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function xd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Cc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Dc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var g=[];e&1?g.push("usb"):e&2?g.push("nfc"):e&4?g.push("ble"):e&16?g.push("internal"):e&32&&g.push("hybrid");
d.transports=g}b.push(c)}}return b}function Cc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function yd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function zd(a,b){var c,e,d,g,n,H,z,E,C,w,y,O,r,D,K,u,P,N,U,aa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(S){if(1==S.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var pa=$jscomp.makeIterator(e),x=pa.next();!x.done;x=pa.next())x=x.value,"USB"==x.toUpperCase()||"NFC"==x.toUpperCase()||"BLE"==x.toUpperCase()||"INTERNAL"==x.toUpperCase()||x.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+tb(new Uint8Array(d))),n=Hb(d),g=n.attStmt;if(H=a.clientDataJSON)console.log("==== clientDataJson bytes: "+tb(new Uint8Array(H))),z=window.origin,E=(new TextDecoder).decode(H),C=JSON.parse(E),C.origin&&(C.origin=z);w=a.getAuthenticatorData();
if(!w)return S.jumpTo(0);y=new Uint8Array(w);console.log("==== authenticatorData bytes: "+tb(y));return b?(O=b.id)?S.yield(Ad(O),5):S.jumpTo(0):S.jumpTo(0)}r=S.yieldResult;D=new Uint8Array(r);console.log("==== hash of realRpID: "+tb(D));K=new hi5.DataBuffer(new Uint8Array(y.byteLength));K.setBytes(D);u=y.slice?y.slice(32,y.length):y.subarray(32,y.length);K.setBytes(u);K.markEnd();P=K.getData();console.log("==== newAuthDataBytes: "+tb(new Uint8Array(P)));N={1:"packed",2:P,3:g};U=CBOR.encode(N);aa=
new hi5.DataBuffer(new Uint8Array(U.byteLength+1));aa.setByte(0);aa.setBytes(U);aa.markEnd();return S.return(aa.getData())})}function Ad(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Bd(b))})}function Bd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function tb(a){return Array.from(a,function(b){return("0"+
(b&255).toString(16)).slice(-2)}).join(", ")}function Cd(){var a=0,b=0,c=new q.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),g=e.getLittleEndian16(),n=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(n){case 1:case 4097:n=new RdpBuffer(new Uint8Array(6),0,6);n.setByte(6);n.setByte(1);n.setLittleEndian16(g);
n.setLittleEndian16(0);n.markEnd();c.send(n);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:g=e.getLittleEndian16();a+=g;break;case 43:case 1065:case 1577:43==n&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(g);d.setLittleEndian16(43==n?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:g=
e.getLittleEndian32();n=e.getLittleEndian32();e=e.getLittleEndian32();Ib={baseRTT:g,bandwidth:n,averageRTT:e};if(q.onnetworkresult)q.onnetworkresult(Ib);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Ib);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};q.addGatewayChannel(c)}function Dd(a,b,c,e,d){dc.set(a,b);ec.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+
d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ed(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ec(){var a="";L&&R(L.connectif)&&L.symlink&&"sessionStorage"in window&&(a=
"SV_"+L.symlink,L.domain&&(a+=L.domain),L.user&&(a+=L.user));return a}function Fd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function fc(){if(!Ha){qb=!1;var a="";bb?Ea.init(!1,!0,!1,0,!1,!1):a=q.getRuntimeURL();void 0==ha.wsPost&&(ha.wsPost=!1);q.oncreatewebsocket&&(La=null);La?(bb&&(bb.onopen=gc,bb.onclose=Ab,bb.onmessage=
function(c){hc.data=c.data;La.postMessage(hc,[hc.data])}),La.postMessage({type:0,cmd:0,data:{addr:a,width:Ja,height:Ka,server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ha.wsPost}})):(Ba=new RdpGeneral(bb||a,Ja,Ka,fb,qa,!1,ha.wsPost),Ba.oncreatewebsocket=q.oncreatewebsocket,Ba.run());La?La.addEventListener("message",Fc,!1):(Ba.onopen=gc,Ba.onmessage=Gc,Ba.onclose=Ab,Ba.onerror=Gb,Ba.oninfo=zc,Ba.onloggedin=ic,Ba.onresolutionchange=function(c,e){Oa(c,e,!1,L.monitorDef&&0<=L.monitor?!0:!1)},
Ba.onAltSecWindows=Hc,Ba.onMoveCursor=jc,Ba.onCloseSurface=Ic,Ba.onColorChange=ya,Ba.onHistoryReceived=function(){kc()},Ba.onLockKeyState=function(c){if(q.onLockKeyState)q.onLockKeyState(c)});if(a=ea.getSurface(ea.size()-1))Va?a&&(a.remoteApp=new Ac(L.exe,L.args,"")):ma(ba(),a.getWindow());if(L.invitation&&!R(L.shadow)){var b=null;a&&(b=a.initChat(L.expert));Bb=new q.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,L.novice)};b&&
(b.onchat=function(c){if(Ha){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();Bb.send(e)}});q.addGatewayChannel(Bb)}}}function Fc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:gc();break;case 1:Ab(a.expected);break;case 2:Gb(a.code);break;case 3:zc(a.code);break;case 4:ic();break;case 5:Oa(a.w,a.h,!1,L.monitorDef&&0<=L.monitor?!0:!1);break;case 6:jc(a.x,a.y,!0);break;case 7:Ic();break;case 8:0==a.id&&kc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:ya(a.color);
break;case 10:if(q.onLockKeyState)q.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:qa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:qa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:qa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:qa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:qa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:qa.drawLineExt(a.x1,a.y1,a.x2,a.y2,
a.color,a.opcode);break;case 9:Jc(a);break;case 10:Gc(a);break;case 11:Ua.attach(a.data,0,a.data.length);Hc(Ua,a.size);break;case 12:qa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:qa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:qa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:qa.restoreDesktop(a.x,
a.y,a.cx,a.cy,a.offset);break;case 16:qa.putFont(a.font,a.character,a.glyph);break;case 17:qa.putCursor(a.idx,a.cursor);break;case 18:qa.setCursor(a.idx);break;case 19:qa.getHistory(ua,function(){La.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);qa.setHistory(a.order,Ua);break;case 21:qa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Kc(a){Qa&&Qa.check(a)}function gc(){Ha=!0;var a=
"87"+navigator.userAgent+"\t";Jb=hi5.tool.uuid();document.cookie=Jb+"=sv";ua(a+Jb);if(q.onopen)q.onopen();ha.joinCloseMode&&q.setJoinCloseMode(ha.joinCloseMode)}function Ic(){ea&&ea.close()}function Gc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=jb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Ca.tag=a.getLittleEndian16();
Ca.channels=a.getLittleEndian16();Ca.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Ca.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ca.tag+" channels="+Ca.channels+" bitsPerSample="+Ca.bitsPerSample+" samplePerSec="+Ca.samplePerSec);La&&La.postMessage({type:0,cmd:5,data:{tag:Ca.tag,channels:Ca.channels,samplePerSec:Ca.samplePerSec,bitsPerSample:Ca.bitsPerSample}});41222==Ca.tag&&(Ca.sampleRate=Ca.samplePerSec,Ta.initMediaPlayer(Ta,Ca,!1));break;case 1:b=a.getByte();
c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);lc(a,b,c,0);kb||(c+=Date.now()-e,ua("8A"+b+","+c))}Qa&&Qa.check();break;case 56:Lc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Mc(Ua);break;case 62:Nc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Oc(Ua);Qa&&Qa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ea[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ea[b].newInstance?
(Ea[a]=Ea[b].newInstance(),Ea[a].id=a):(Ea[b].id=a,Ea[a]=Ea[b]),Ea[a].onopen)Ea[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ea[a]&&Ea[a].process(b);break;case 4:if(Ea[a]&&Ea[a].onclose)Ea[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:Gd(Ua);break;default:if(q.onunknownmessage)q.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:ua("87"+
navigator.userAgent);break;case 15:if(q){mc=!1;ub=q.reconnectTimes;(q&&0==q.mode||R(L.connectif))&&kc();b="";for(b in lb)if((c=lb[b])&&c.onopen)c.onopen();for(b in jb)if((c=jb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&q&&(q.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(q.onnotify)q.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&q.onerror)q.onerror(b);
if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;q.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ea.drawLicense(a);break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Hd(a);break;case 2:Cb?(Cb.type==a?q.writeRawInput("881"+a+"\t"+Cb.text):q.writeRawInput("881ERROR\t"),Cb=null):!(b=ea.getFocused())||b.processClipReq(a)||!ha.clipWarnAlways&&Pc||!L||L.leagacyMode||(q.showMessage(__svi18n.info.menucopy,null,5E3),Pc=!0);
break;case 5:(b=ea.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ea.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=va()+b[0];a=q.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);q.onprintingready&&q.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ea.getFocused())&&b.showPDF(a);break;case 56:Lc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ea.getWinById(parseInt(b[0]))){if(!ea.hasApp(b[1])){(c=ea.getOwnerSurface(a))&&
c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(q.onremoteappstart)q.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&q.ontitlechange)q.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Id(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(cb&16||cb&65536)?(Kb=!1,Ma=null):(cb&16&&(Kb=!0),Ma||(a=ea.getFocused())&&cc(a));cb&64&&q.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(cb&128)),Ma.setDownload(!(cb&
131072)),Ma.canCopyFile=0!=(cb&65536));ea.execute("setFeature",[cb]);break;case 60:Mc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);ya(a.color);(b=a.server)&&q&&(q.server=a.server);Qc=a.length;c=ea.getFocused();Va=1==a.isRail;c&&(1!=q.mode&&c.setAutoScale(!Va),b&&ma(ba(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Kb=!0,cc(c));if(q.onopened)q.onopened(a);break;case 1:a=a.duration;if(q.onprogress)q.onprogress(a,
Qc);break;case 2:2==a.status?(bc(),Ha=!0):(b=0==a.status,b==qa.isPaused()||q.onsessionpause&&q.onsessionpause(b,a)||(qa.pause(b),b||ea.repaint(0,0,qa.width-1,qa.height-1),a.warn&&q.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Nc(a);break;case 63:Oc(b64ToBuffer(a));break;default:if(q.onunknownmessage)q.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function kc(){if(!kb&&!Wa&&(Wa=!0,q&&(ha.pingInterval&&q.startPing(ha.pingInterval),q.onready)))q.onready()}
function Gd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ua(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=65536,ea.execute("setFeature",[cb]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(q.onLockKeyState)q.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&
2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();q.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);q.sessionInfo.appInfo.twoFAQR=a;q.ontwofaqr&&q.ontwofaqr(a)||2==b&&ea.execute("showTwoFAQR");break;case 1:qa.pause(!0,!0);if(q.ontwofacode&&q.ontwofacode())return;(a=ea.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!q.ontwofaresult||
!q.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ea.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var g=new Uint8Array(2+d.length);g[0]=146;g[1]=8;g.set(d,2);ua(g.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Jd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var g=
ea.getFocused();g&&Ha&&(g=g.getThumbnail(a))&&g.length!=d&&(ua("8E7"+g),d=g.length)},b))};this.stop=function(){clearInterval(c)}}function Kd(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Jd(a,b));Ya.start()}function Oc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Nc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=q.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);bc();Ha=!0;a=d.width;e=d.height;if(a==Ja&&e==Ka)break;Oa(a,
e,!1,!1);break;case 1:d=JSON.parse(c);q.sessionInfo.joinedSessions.push(d.numericId);q.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||ha.alertJoin)q.onsessionjoin&&(a=q.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&q.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);q.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=q.sessionInfo.joiners;c=0;for(var g=b.length;c<g;c++)if(b[c].numericId==
d.numericId){b.splice(c,1);break}if(!e.joined||ha.alertJoin)q.onsessionexit&&(a=q.onsessionexit(d)),!a&&__svi18n.info.exitsession&&q.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ea.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;q.ongivecontrol&&(a=q.ongivecontrol());if(a)break;q.showMessage(__svi18n.info.givecontrol,
null,5E3);break;case 4:d=JSON.parse(c);ea.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;q.ontakebackcontrol&&(a=q.ontakebackcontrol());if(a)break;q.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);q.onrequirecontrol&&(a=q.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;qa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));q.showMessage({title:a,msg:e,cbYes:function(){q.giveControl(d.numericId);
this.destroy();qa.isPaused()&&q.pauseSession(q.sessionInfo.appInfo.numericId,!1)},cbNo:function(){q.refuseControl(d.numericId);this.destroy()},html:!0});break;case 6:ea.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Oa(d.width,d.height,!0,L.monitorDef&&0<=L.monitor?!0:!1);d.color&&(ya(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(q.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);mc=!0;if(q.onrequestcredential&&
q.onrequestcredential(d,Ra.reconnect))break;if(q.onautherror&&q.onautherror(d,Ra.reconnect))break;ea.getFocused().requestCredential(d,Ra.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Kd(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);q.onrequirejoin&&(a=q.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);q.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){q.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){q.allowJoin(d.numericId,
!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&ic();break;case 14:if(d=JSON.parse(c),q.oncontrolchange)q.oncontrolchange(d)}}function Mc(a){switch(a.getByte()){case 32:if(!qa.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,g=void 0;ha.noCursorName||(d=a.getLittleEndian32(),q.sessionInfo.appInfo&&(g=q.sessionInfo.appInfo.sessions[d]));jc(c,e,!0,g,d,b)}}}function jc(a,b,c,e,d,g){qa.isPaused()||ea.getFocused().moveCursor(a,b,c,e,
d,g)}function Jc(a){ea.setCursor(a)}function Ld(a){var b=ha.page&&ha.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=va();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Lc(a){a=JSON.parse(a);nc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",
nc),c.setItem("appInfo.numericId",b));ia(a.appId);a.server||(a.server=ba());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=q.mode&&ea.execute("setAutoScale",[!0]):(q.mode=0,R(L.connectif)&&ea.setSize(Ja,Ka),ha.disableJoinedAppResize&&(q.windowState=0));var e=va();b=Ld("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),q.protocol="http"==c.substring(0,e)?"ws":"wss",
q.gateway=c,b+="&gateway="+encodeURIComponent(c));b=q.modifyURL(b);a.joinLink=b;q.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Oa(Ja,Ka,!0,!0),qb||1==q.mode||ea.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ha.cursorNameOnly=a.isAssistance;if(q.onsessionstart)q.onsessionstart(q.sessionInfo)}function Id(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var c=
a.split("\t");switch(b){case 1:Ma.confirmId(c[0],c[1],c[2]);break;case 2:Ma.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Ma.close(c[0]);break;case 9:a='<a href="'+q.modifyURL(va()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ea.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Ma.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function lc(a,
b,c,e){if(!Md||qa.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ca.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ca.tag)oc||(oc=new MSGSM),b=oc.decode(b,d,e),d=0,e=b.length;var g=Ca.bitsPerSample;var n=Math.floor(e/(g>>3));var H=c=e=0;a||(e=Math.pow(2,g-1)-1,c=-e-1,H=Math.pow(2,g));g=Ca.channels;var z=Math.floor(n/g),E=Ta.getBuffer(z),C=E.getChannelData(0),w=E.getChannelData(1);n=0;if(a)for(;n<z;)1==g?w[n]=C[n]=b[d++]:(C[n]=b[d++],w[n]=b[d++]),n++;else for(;n<
z;)a=b[d++]|b[d++]<<8,a>e?(a-=H,a/=-c):a/=e,1==g?C[n]=a:(C[n]=a,a=b[d++]|b[d++]<<8,a>e?(a-=H,a/=-c):a/=e),w[n]=a,n++;return Ta.playBuffer(E)}function Rc(a){if(!q.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));
return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:q.onurlredirection&&q.onurlredirection(b)?!0:(a=ea.getFocused())?a.processLink(b):!1:!1}function Nd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=q.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Hd(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(q.onservercopy&&q.onservercopy(a)||Rc(a))){var b=ea.getFocused();b&&b.copyToClip(Nd(a))}setTimeout(function(){ua("883")},
999)}}function ic(a){if(!qb&&(setTimeout(function(){Ha&&ua("884")},333),q.onloggedin))q.onloggedin();pc=qb=!0;a&&a.sessionId&&(q.sessionInfo.sessionId=a.sessionId);Va&&1!=q.mode&&ea.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Lb&&!Va&&(qa.setContext(ea.getFocused().context),ea.repaint(0,0,qa.width-1,qa.height-1))}function Ab(a){if(q){hi5.browser.cookie.delete(Jb);svGlobal.logger.warn("closed "+(q.sessionInfo.appInfo?q.sessionInfo.appInfo.numericId:0));q.onagentmessage&&(q.onagentmessage=null);
if(q.onagentclose)q.onagentclose();var b=Ec();b&&q.sessionInfo.appInfo&&0==q.mode&&(sessionStorage[b]=q.sessionInfo.appInfo.session);if(q&&(b=1!=q.mode,!Ha&&b&&Gb("connection"),b=b&&(Ha||ub<q.reconnectTimes)&&0<ub&&!a,Wa=Ha=!1,b)){ub--;__svi18n.info.reconnecting&&q.showMessage(__svi18n.info.reconnecting+" "+(q.reconnectTimes-ub)+"/"+q.reconnectTimes,null,3E3);setTimeout(fc,ha.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+ub);return}if(mc)svGlobal.logger.info("Req credential");else{Qa&&
(q.stopPing(),Qa=null);La&&(La.removeEventListener("message",Fc,!1),La.postMessage({type:0,cmd:4}),La.terminate(),La=null);Ma&&(Ma.release(),Ma=null);Sa=p=null;Ea&&(Ea.close(),Ea=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);q.player&&(q.player=null);Db=null;try{if(q.onclose)q.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ea&&(ea.close(),ea=null)}catch(c){svGlobal.logger.warn(c)}Ua=
null;Ba&&(Ba.onopen=null,Ba.onmessage=null,Ba.onclose=null,Ba.onerror=null,Ba.close(),Ba=null);ea=Ra=null;qa&&(qa.release(),qa=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(q.close):window.removeEventListener("unload",q.close,!1);window&&window.$rdp==q&&(window.$rdp=null);q=null}}}function Sc(){Ba&&Ha?Ba.close():Ab(!0)}function Hc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();
var e=a.getLittleEndian16(),d=a.getLittleEndian16(),g=0;16>c&&(g=a.getLittleEndian16());var n=a.getLittleEndian16(),H=a.getLittleEndian16();a.getBytes(n);g&&a.getBytes(g);if(8<=c&&(g=ea.getFocused())&&g.onremoteappicon){n=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();H=d+H;var z;a=a.getData();for(var E=0,C,w;d<H;)switch(c){case 16:(z=a[d++]|a[d++]<<8)?(w=z>>7&248,C=z>>2&248,z=z<<3&248,w|=w>>5,C|=C>>5,z|=z>>5,e[E++]=z,e[E++]=C,e[E++]=w,e[E++]=255):E+=4;break;
case 32:e[E++]=a[d++],e[E++]=a[d++],e[E++]=a[d++],e[E++]=a[d++]}n.putPixels(e,0,e.length);a=ea.getWinById(b);g.onremoteappicon(a,n)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ea.delWin(b)):Od(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+
c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((g=ea.getOwnerSurfaceById(b))&&g.railWin&&g.railWin.setActiveWinId(b,3==ha.windowState),ea.setTitle(b),qa.getContext()||(b=ea.getFocused())&&qa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ea.zOrders,c.length=b,g=0;g<b;g++)c[g]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[g])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Tc(a){var b=
ea.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Od(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ea.getWinById(c);d?e=!0:d=new ea.LocalWin(c);
svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+
(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&
2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var g=d.showState;(2==g&&0!=ha.noMinimize||
!e&&3==g&&5==ha.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(g=0!=(b&4)){var n=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(n,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){n=a.getLittleEndian32();var H=a.getLittleEndian32();d.winOffsetX=n;d.winOffsetY=H;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+
d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==q.windowState?Tc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(n=ea.getFocused())){n=n.getFreeSpace();var z=d.winWidth,E=d.winHeight;if(d.winOffsetX>n.width||d.winOffsetY>n.height||0>z+d.winOffsetX||0>E+d.winOffsetY){var C=(n.width-d.winWidth)/2|0,w=(n.height-d.winHeight)/2|0;
0>C&&(C=0);0>w&&(w=0);setTimeout(function(){d.resize(C,w,z,E)},50)}}0!=(b&256)&&(n=a.getLittleEndian16(),0<n&&a.skipPosition(8*n));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ea.onWinChange(d);else ea.addWin(d);g&&ea.setTitle(c);c==ea.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ea.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+
c)}function yc(a,b){function c(k,l,h,f,t){0<t.width?t.union(k,l,h,f):(t.x=k,t.y=l,t.width=h,t.height=f)}function e(k,l,h,f){for(X=0;X<ja;X++){var t=pa[X];if(k>=t[0]&&l>=t[1]&&h<=t[2]&&f<=t[3])return x[X]}return null}function d(k,l,h,f){if(ja){var t=e(k,l,k+h-1,l+f-1);t&&c(k,l,h,f,t)}else c(k,l,h,f,D)}function g(k,l,h,f,t,v,A){for(var B=t*h+f,F=k.setRGB,W=k.getRGB,M=0;M<A;M++){for(var m=0;m<v;m++){if(k){var J=W(f+m,t+M);F(f+m,t+M,~J&16777215)}else l[B]=~l[B]&16777215;B++}B+=h-v}}function n(k,l,h,f,
t,v,A,B,F,W){l=W*B+F;null==A&&(A=k);for(k=0;k<v;k++){for(F=0;F<t;F++)O[f+k][h+F]=O[f+k][h+F]&A[l]&16777215|4278190080,l++;l+=B-t}}function H(k,l,h,f,t,v,A,B,F,W){l=W*B+F;F=k.setRGB;W=k.getRGB;null==A&&(A=k);for(k=0;k<v;k++){for(var M=0;M<t;M++){var m=W(h+M,f+k);F(h+M,f+k,m|A[l]&16777215);l++}l+=B-t}}function z(k,l,h,f){var t=fa;if(t){var v=t.getRGB(l,h);switch(k){case 0:t.setRGB(l,h,0);break;case 1:t.setRGB(l,h,~(v|f)&16777215);break;case 2:t.setRGB(l,h,v&~f&16777215);break;case 3:t.setRGB(l,h,~f&
16777215);break;case 4:t.setRGB(l,h,16777215*(~v&f));break;case 5:t.setRGB(l,h,~v&16777215);break;case 6:t.setRGB(l,h,v^f&16777215);break;case 7:t.setRGB(l,h,~v&f&16777215);break;case 8:t.setRGB(l,h,v&f&16777215);break;case 9:t.setRGB(l,h,v^~f&16777215);break;case 10:break;case 11:t.setRGB(l,h,v|~f&16777215);break;case 12:t.setRGB(l,h,f);break;case 13:t.setRGB(l,h,(~v|f)&16777215);break;case 14:t.setRGB(l,h,v|f&16777215);break;case 15:t.setRGB(l,h,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+
k),t.setRGB(l,h,f)}}}function E(k,l,h,f,t,v,A,B,F){k>B||l>F||(h=k+h-1,h>B&&(h=B),k<v&&(k=v),h=h-k+1,f=l+f-1,f>F&&(f=F),l<A&&(l=A),f=f-l+1,1>h||1>f||fa.fillRect(k,l,h,f,t))}function C(k,l,h,f,t,v,A,B,F,W,M,m){if(!(l>M||h>m)){var J=l+f-1;J>M&&(J=M);F=l<F?F:l;J=J-l+1;M=h+t-1;M>m&&(M=m);W=h<W?W:h;m=M-h+1;if(!(1>J||1>m)){M=128;var G=0;A|=4278190080;B|=4278190080;if(F==l&&W==h&&J==f&&m==t)if(0==k)for(var Q=0;Q<t;Q++){k=h+Q;for(var ca=0;ca<f;ca++)0==M&&(G++,M=128),0!=(v[G]&M)&&(O[k][l+ca]=B),M>>=1;G++;M=
128;G==v.length&&(G=0)}else for(Q=0;Q<t;Q++){k=h+Q;for(ca=0;ca<f;ca++)0==M&&(G++,M=128),O[k][l+ca]=0!=(v[G]&M)?B:A,M>>=1;G++;M=128;G==v.length&&(G=0)}else if(0==k)for(Q=0;Q<m;Q++){k=h+Q;for(ca=0;ca<J;ca++)0==M&&(G++,M=128),l+ca>=F&&k>=W&&0!=(v[G]&M)&&(O[k][l+ca]=B),M>>=1;G++;M=128;G==v.length&&(G=0)}else for(Q=0;Q<m;Q++){k=h+Q;for(ca=0;ca<J;ca++)0==M&&(G++,M=128),l+ca>=F&&h+Q>=W&&(O[k][l+ca]=0!=(v[G]&M)?B:A),M>>=1;G++;M=128;G==v.length&&(G=0)}}}}function w(k,l,h,f,t){this.offset=k;this.baseLine=l;
this.width=h;this.height=f;this.fontData=t}function y(k,l,h,f,t,v,A,B,F){this.cache_idx=k;this.rawData=l;this.none=!l;this.hotX=h;this.hotY=f;this.width=t;this.height=v;this.xorSize=B;this.andSize=F;this.result="";this.distance=0;this.bpp=A;this.system="";if(l){if(!this.distance){k=0;if(l){A=0;for(var W=l.length;A<W;A++)0!=l[A]&&(k+=A%t+(A/t|0))}this.distance=k}if(!this.system){a:switch(this.distance){case 507:k="text";break a;case 2046:case 4359:k="default";break a;default:k=""}this.system=k}}k=
"";if(!this.system&&l){A=t*v*4;k=62+A+B+F;W=new Uint8Array(k);k=new hi5.DataBuffer(W,0,k);k.setLittleEndian16(0);k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(t);k.setByte(v);k.setByte(0);k.setByte(0);k.setLittleEndian16(h);k.setLittleEndian16(f);k.setLittleEndian32(40+A+B+F);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(t);k.setLittleEndian32(2*v);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(B+F);k.setLittleEndian32(0);
k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);for(h=v-1;0<=h;h--)for(f=0;f<t;f++)v=l[t*h+f],k.setByte(v&255),k.setByte(v>>8&255),k.setByte(v>>16&255),k.setByte(v>>24&255);k="data:image/x-icon;base64,"+hi5.Base64.enc(k.getData())}this.url=k}var O=[],r=null,D=new hi5.graphic.Rectangle(0,0,0,0),K="Uint8ClampedArray"in window,u=null,P=0,N=0,U=0,aa=0,S=null,pa,x,X=0,ja=0;this.width=a;this.height=b;var V=!1,fa=this,la={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=
function(k){u=k};this.getDirtyArea=function(){return D};this.setImgRect=function(k,l,h,f){P=k;N=l;U=h;aa=f};this.parseMonitorDef=function(k){var l=k.split(","),h=l.length,f=[];if(1<h){for(var t=!1,v=0;v<h;v++){var A=l[v].split(":");if(4==A.length)f[v]=Array(5),f[v][0]=parseInt(A[0]),f[v][1]=parseInt(A[1]),f[v][2]=parseInt(A[2]),f[v][3]=parseInt(A[3]),f[v][4]=0==f[v][0]&&0==f[v][1]?1:0;else{t=!0;break}}t&&(svGlobal.logger.warn("invaiid monitorDef:"+k),f.length=0)}return f};this.setMonitorLayout=function(k){var l=
k.length,h=0;pa=k;for(x=Array(l);h<l;h++)x[h]=new hi5.graphic.Rectangle(0,0,0,0);ja=l};this.setMonitorCount=function(k){ja=k};this.addImg=function(k){U&&(S&&URL.revokeObjectURL(S.src),S=k)};this.flushImgs=function(){S&&(URL.revokeObjectURL(S.src),S=null,U=0)};this.getData=function(){return O};this.pause=function(k,l){V=k;l&&r&&r.fillRect(0,0,a,b)};this.release=function(){D=null;hi5.Arrays.release(x);fa.flushImgs();O=r=fa=null;la=la.imgData=null};this.isPaused=function(){return V};this.setContext=
function(k){k!=r&&(r||!k||k.createImageData(1,1).data.buffer||(K=!1),r=k,null!=r&&(la.imgData=r.createImageData(a,b)))};this.getContext=function(){return r};this.resize=function(k,l){if(O.length!=l||O[0].length!=k){for(var h=0;h<l;h++)O[h]=new Uint32Array(k);O.length=l;fa.width=a=k;fa.height=b=l;null!=r&&(la.imgData=r.createImageData(a,b))}};fa.resize(a,b);this.getBuffer=function(){return O};this.setRGB=function(k,l,h){O[l][k]=h|4278190080};this.getRGB=function(k,l){return O[l][k]};this.setRGBs=function(k,
l,h,f,t,v,A){var B=k+h,F=l+f;F>b&&(F=b);if(!(k>=a)){B>a&&(h-=B-a);for(B=l;B<F;B++,v+=A)O[B].set(t.subarray(v,v+h),k);d(k,l,h,f)}};this.moveArea=function(k,l,h,f,t,v){if(0<v){var A=k+t,B=l+v,F;for(F=f-1;0<=F;F--)O[B+F].set(O[l+F].subarray(k,k+h),A)}else if(0>v)for(A=k+t,B=l+v,F=0;F<f;F++)O[B+F].set(O[l+F].subarray(k,k+h),A);else if(0<t){A=k+t;B=l+v;var W;for(F=h-1;0<=F;F--){var M=A+F;var m=k+F;for(W=0;W<f;W++)O[B+W][M]=O[l+W][m]}}else for(A=k+t,B=l+v,F=0;F<h;F++)for(M=A+F,m=k+F,W=0;W<f;W++)O[B+W][M]=
O[l+W][m];d(k+t,l+v,h,f)};this.getRGBs=function(k,l,h,f,t){var v=new Uint32Array(h*f),A=k+h;f=l+f;for(var B=0;l<f;l++)v.set(O[l].subarray(k,A),B),B+=h;return t?(t(v),null):v};this.repaint=function(k,l,h,f){var t=la.imgData.data,v=0,A,B;u&&u.begin("paint");0>k&&(h+=k,k=0);0>l&&(f+=l,l=0);k+h>a&&(h=a-k);l+f>b&&(f=b-l);var F=k+h;var W=l+f;if(K)for(t=new Uint32Array(t.buffer),B=l;B<W;B++)t.set(O[B].subarray(k,F),v),v+=a;else{var M=4*(a-h)|0;for(B=l;B<W;B++){for(A=k;A<F;A++){var m=O[B][A];t[v++]=m&255;
t[v++]=m>>8&255;t[v++]=m>>16&255;t[v++]=255}v+=M}}la.left=k;la.top=l;la.width=h;la.height=f;u&&u.end("paint");return la};this.postPaint=d;this.draw=function(k,l,h,f){if(!V&&r)if(S&&S.complete&&(r.drawImage(S,P,N,U,aa),URL.revokeObjectURL(S.src),S=null),ja){if(k=e(k,l,h,f),k.width)return fa.repaint(k.x,k.y,k.width,k.height),k.width=0,la}else if(D.width)return fa.repaint(D.x,D.y,D.width,D.height),D.width=0,la;return null};this.fillRect=function(k,l,h,f,t){var v=k+h,A=l+f;if(O[0].fill)for(var B,F=l;F<
A;F++)O[F].fill(t,k,v);else for(F=l;F<A;F++)for(B=k;B<v;B++)O[F][B]=t;d(k,l,h,f)};this.drawLine=function(k,l,h,f,t){if(l==f){if(k>h){var v=k;k=h;h=v}var A=O[l];h++;if(A.fill)A.fill(t,k,h);else for(v=k;v<h;v++)A[v]=t}else if(k==h)for(l>f&&(v=l,l=f,f=v),f++,v=l;v<f;v++)O[v][k]=t;else{var B=Math.abs(h-k),F=Math.abs(f-l);v=k;A=l;h=h>=k?k=1:k=-1;l=f>=l?f=1:f=-1;if(B>=F){l=k=0;var W=B;var M=B/2|0;var m=F}else f=h=0,W=F,M=F/2|0,m=B,B=F;if(!(1>B))for(B++,F=0;F<B;F++)O[A][v]=t,M+=m,M>=W&&(M-=W,v+=k,A+=f),
v+=h,A+=l}};this.bitBlt=function(k,l,h,f,t,v,A,B,F,W){var M=fa;switch(k){case 0:B=M.setRGB;for(M=h;M<h+t;M++)for(F=f;F<f+v;F++)B(M,F,0);break;case 1:k=A;F=W*B+F;W=M.setRGB;l=M.getRGB;null==k&&(k=M);for(M=0;M<v;M++){for(A=0;A<t;A++)W(h+t,f+v,~(l(h+t,f+v)|k[F])&16777215);F+=B-t}break;case 2:k=A;F=W*B+F;W=M.setRGB;l=M.getRGB;null==k&&(k=M);for(M=0;M<v;M++){for(A=0;A<t;A++){var m=l(h+t,f+v);W(h+t,f+v,m&~k[F]&16777215);F++}F+=B-t}break;case 3:g(M,A,B,F,W,t,v);A?M.setRGBs(h,f,t,v,A,W*B+F,B):M.moveArea(F,
W,t,v,h-F,f-W);break;case 4:g(M,null,l,h,f,t,v);n(M,l,h,f,t,v,A,B,F,W);break;case 5:g(M,null,l,h,f,t,v);break;case 6:k=A;F=W*B+F;null==k&&(k=M);for(M=0;M<v;M++){for(W=0;W<t;W++)O[f+M][h+W]=O[f+M][h+W]^k[F]&16777215|4278190080,F++;F+=B-t}break;case 7:k=A;F=W*B+F;W=M.setRGB;l=M.getRGB;null==k&&(k=M);for(M=0;M<v;M++){for(A=0;A<t;A++)m=l(h+A,f+M),W(h+A,f+M,~(m&k[F])&16777215),F++;F+=B-t}break;case 8:n(M,l,h,f,t,v,A,B,F,W);break;case 9:k=A;F=W*B+F;W=M.setRGB;l=M.getRGB;null==k&&(k=M);for(M=0;M<v;M++){for(A=
0;A<t;A++)m=l(h+A,f+M),W(h+A,f+M,m^~k[F]&16777215),F++;F+=B-t}break;case 10:break;case 11:k=A;F=W*B+F;W=M.setRGB;l=M.getRGB;null==k&&(k=M);for(M=0;M<v;M++){for(A=0;A<t;A++)m=l(h+A,f+M),W(h+A,f+M,m|~k[F]&16777215),F++;F+=B-t}break;case 12:A?M.setRGBs(h,f,t,v,A,W*B+F,B):M.moveArea(F,W,t,v,h-F,f-W);break;case 13:g(M,null,l,h,f,t,v);H(M,l,h,f,t,v,A,B,F,W);break;case 14:H(M,l,h,f,t,v,A,B,F,W);break;case 15:B=M.setRGB;for(M=h;M<h+t;M++)for(F=f;F<f+v;F++)B(M,F,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+
k)}d(h,f,t,v)};this.drawLineExt=function(k,l,h,f,t,v){if(k==h||l==f){var A;if(l==f)if(h>k){var B=h-k;if(!(1>B))for(A=0;A<B;A++)z(v,k+A,l,t)}else{if(B=k-h,!(1>B))for(A=0;A<B;A++)z(v,h+A,l,t)}else if(f>l){if(B=f-l,!(1>B))for(A=0;A<B;A++)z(v,k,l+A,t)}else if(B=l-f,!(1>B))for(A=0;A<B;A++)z(v,k,f+A,t)}else{var F=Math.abs(h-k),W=Math.abs(f-l);A=k;B=l;var M,m;var J=h>=k?M=1:M=-1;var G=f>=l?m=1:m=-1;if(F>=W){G=M=0;var Q=F;var ca=F/2>>0;var na=W}else m=J=0,Q=W,ca=W/2>>0,na=F,F=W;if(1>F)return;for(W=0;W<=F;W++)z(v,
A,B,t),ca+=na,ca>=Q&&(ca-=Q,A+=M,B+=m),A+=J,B+=G}t=Math.min(k,h);k=Math.max(k,h);h=Math.min(l,f);l=Math.max(l,f);0>k-t||0>l-h||d(t,h,k-t+1,l-h+1)};this.drawText=function(k,l,h,f,t,v,A,B,F,W,M,m,J,G,Q,ca,na,xa,Da,Ia,Fa){var za=0;1<m?E(W,M,m,J,t,xa,Da,Ia,Fa):1==h&&E(v,A,B,F,t,xa,Da,Ia,Fa);for(var Ga=ca,wa=0;wa<ca;)switch(na[za+wa]){case 255:var Aa=na[za+wa+2];if(Aa>Ga-za){wa=ca=0;break}Aa=na.slice?na.slice(za,za+Aa):na.subarray(za,za+Aa);da[na[za+wa+1]]=Aa;wa+=3;ca-=wa;za=wa;wa=0;break;case 254:var Pa=
(Aa=da[na[za+wa+1]])?Aa:null;Pa&&0==Pa[1]&&0==(l&32)&&(0!=(l&4)?Q+=na[za+wa+2]:G+=na[za+wa+2]);wa=wa+2<ca?wa+3:wa+2;ca-=wa;za=wa;wa=0;if(!Pa)break;for(var Za=Pa.length,$a=0;$a<Za;$a++){Aa=ra.getFont(k,Pa[$a]);if(0==(l&32)){var Xa=Pa[++$a];0!=(Xa&128)?(0!=(l&4)?Q+=Pa[$a+1]|Pa[$a+2]<<8:G+=Pa[$a+1]|Pa[$a+2]<<8,$a+=2):0!=(l&4)?Q+=Xa:G+=Xa}Aa&&(C(h,G+Aa.offset&65535,Q+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,t,f,xa,Da,Ia,Fa),0!=(l&32)&&(G+=Aa.width))}break;default:Aa=ra.getFont(k,na[za+wa]),0==
(l&32)&&(Xa=na[za+ ++wa],0!=(Xa&128)?(0!=(l&4)?Q+=na[za+wa+1]|na[za+wa+2]<<8:G+=na[za+wa+1]|na[za+wa+2]<<8,wa+=2):0!=(l&4)?Q+=Xa:G+=Xa),Aa&&(C(h,G+Aa.offset&65535,Q+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,t,f,xa,Da,Ia,Fa),0!=(l&32)&&(G+=Aa.width)),wa++}1<m?0<J&&d(W,M,m,J):0<B&&0<F&&d(v,A,B,F)};this.drawBitmap=function(k,l,h,f,t,v,A,B,F){var W=Na.getBitmap(k,l);W?(k=W.width,l=W.height,t>k&&(t=k),v>l&&(v=l),12==F?fa.setRGBs(h,f,t,v,W.data,B*k+A,k):fa.bitBlt(F,a,h,f,t,v,W.data,k,A,B)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
k+" idx="+l)};this.saveDesktop=function(k,l,h,f,t){fa.getRGBs(k,l,h,f,function(v){Y.save(k,l,h,f,t,v)})};this.restoreDesktop=function(k,l,h,f,t){(t=Y.restore(k,l,h,f,t))?fa.setRGBs(k,l,h,f,t,0,h):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(k,l,h){ra.putFont(k,l,h)};this.putBitmap=function(k,l,h){Na.putBitmap(k,l,h)};this.putCursor=function(k,l){oa.set(k,l)};this.setCursor=function(k){if(!V&&-1!=k){var l=oa.get(k);if(l)fa.onSetCursor(l);else svGlobal.logger.warn("invalid cursor"+
k)}};var ta=0;this.isSendingHistory=function(){return 2E3>Date.now()-ta};this.getHistory=function(k,l){var h=null;(h=oa.toPDU())&&k(h.buffer);if(fa.onGetGfxHistory)fa.onGetGfxHistory(k,l);else{u&&u.begin("his_bitmap");Na.forEach(function(B,F,W){if(B){var M=0,m=0;W=0;for(var J=B.length;W<J;W++)B[W]&&B[W].data&&(M++,m+=B[W].raw?B[W].raw.length:4*B[W].data.length);if(M&&m){h=new Uint8Array(m+20*M+8);h[0]=29;h[2]=1;h[3]=4;m=new hi5.DataBuffer(h,4,h.length);m.setLittleEndian32(M);for(W=0;W<J;W++)(M=B[W])&&
M.data&&(m.setLittleEndian16(F),m.setLittleEndian16(W),m.setLittleEndian16(M.left),m.setLittleEndian16(M.top),m.setLittleEndian16(M.width),m.setLittleEndian16(M.height),m.setLittleEndian16(M.bitsperpixel),m.setLittleEndian16(M.codec),m.setLittleEndian32(M.raw?M.raw.length:4*M.data.length),m.setBytes(M.raw||new Uint8Array(M.data.buffer)));k(h.buffer)}}});u&&u.end("his_bitmap");u&&u.begin("his_font");(h=ra.toPDU())&&k(h.buffer);u&&u.end("his_font");for(var f=4,t=0,v=da.length;t<v;t++)da[t]&&(f+=da[t].length+
6);if(4<f){h=new Uint8Array(f);h[0]=29;h[2]=1;h[3]=7;var A=4;t=0;for(v=da.length;t<v;t++)da[t]&&da[t].length&&(h[A++]=t,h[A++]=t>>8,f=da[t].length,h[A++]=f,h[A++]=f>>8,h[A++]=f>>16,h[A++]=f>>24,h.set(da[t],A),A+=f);k(h.buffer)}(h=Y.toPDU())&&k(h.buffer);l();ta=Date.now()}};this.onHistoryDone=function(){fa.onGetGfxHistory&&q.reconnect(a,b,!0)};this.setHistory=function(k,l){svGlobal.logger.info("setHistory type:"+k);switch(k){case 4:u&&u.begin("his_bitmap_dec");var h=l.getLittleEndian32();for(k=0;k<
h;k++){var f=l.getLittleEndian16(),t=l.getLittleEndian16(),v=l.getLittleEndian16(),A=l.getLittleEndian16(),B=l.getLittleEndian16(),F=l.getLittleEndian16(),W=l.getLittleEndian16(),M=l.getLittleEndian16(),m=l.getLittleEndian32(),J=new Uint8Array(l.getData().buffer,l.getPosition(),m),G=new Uint8Array(m);G.set(J);J=rdpcodecs.bitmap;switch(M){case 0:var Q=new Uint32Array(G.buffer);l.skipPosition(m);break;case 1:switch(W){case 16:Q=J.decompressInt16(B,F,m,G,0);break;case 24:Q=J.decompressInt24(B,F,m,G,
0);break;case 32:Q=J.decompressInt32(B,F,m,G,0)}l.skipPosition(m);break;case 2:Q=new rdpcodecs.NSCodec,Q.process(l,W,B,F),m=Q.getData(),Q=Q.getDataSize(),Q=new Uint32Array(Q),rdpcodecs.flipimage(m,0,Q,B,F,1)}Na.putBitmap(f,t,new rdpcodecs.Bitmap(Q,B,F,v,A,W,0==M?null:G,M))}u&&u.end("his_bitmap_dec");break;case 5:ra.fromStream(l);break;case 6:oa.fromStream(l);break;case 7:for(;l.has(6);)if(k=l.getLittleEndian16(),m=l.getLittleEndian32())h=l.getData().subarray(l.getPosition(),l.getPosition()+m),da[k]=
h,l.skipPosition(m);break;case 9:Y.fromStream(l);break;default:if(fa.onSetGfxHistory)fa.onSetGfxHistory(k,l)}};var oa=new function(){var k=[],l=!1;this.useRemoteCursor=function(h){l=h};this.set=function(h,f){l&&(f.system="");k[h]=f};this.get=function(h){return k[h]};this.total=function(){return k.length};this.toPDU=function(){for(var h=2,f=2,t=0,v=0,A=k.length,B;v<A;v++)if(B=k[v])t++,f=f+7+(B.rawData?B.rawData.length:0);if(!t)return null;f=new Uint32Array(f);f[0]=100728861;f[1]=t;for(v=0;v<A;v++)if(B=
k[v])if(t=B.rawData?B.rawData.length:0,f[h++]=B.cache_idx|B.bpp<<16,f[h++]=B.hotX|B.hotY<<16,f[h++]=B.width|B.height<<16,f[h++]=B.xorSize,f[h++]=B.andSize,f[h++]=B.distance,f[h++]=t)f.set(B.rawData,h),h+=t;return f};this.fromStream=function(h){var f=h.getPosition();h=new Uint32Array(h.getData().buffer,f);var t=h[0],v=0;for(f=1;v<t;v++){var A=h[f]&65535;var B=h[f++]>>16;var F=h[f]&65535;var W=h[f++]>>16;var M=h[f]&65535;var m=h[f++]>>16;var J=h[f++];var G=h[f++];var Q=h[f++];var ca=h[f++];var na=null;
ca&&(na=new Uint32Array(ca),na.set(h.subarray(f,f+ca)),f+=ca);B=new y(A,na,F,W,M,m,B,J,G);Q&&(B.distance=Q);l&&(B.system="");k[A]=B}}};oa.useRemoteCursor(!!ha.remoteCursor);var Y=new function(){function k(h,f,t,v,A,B){this.x=h;this.y=f;this.cx=t;this.cy=v;this.offset=A;this.data=B}var l=[];this.save=function(h,f,t,v,A,B){h=new k(h,f,t,v,A,B);f=0;for(t=l.length;f<t;f++)if(!l[f]){l[f]=h;return}l.push(h)};this.restore=function(h,f,t,v,A){for(var B,F=0,W=l.length;F<W;F++)if((B=l[F])&&B.x==h&&B.y==f&&
B.cx==t&&B.cy==v){if(B.offset==A)return h=B.data,l[F]=null,h;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var h=0,f=2,t=0,v=l.length;t<v;t++)l[t]&&(h++,f+=l[t].data.length+6);if(!h||!f)return null;f=new Uint32Array(f);var A=2;f[0]=151060509;f[1]=h;for(t=0;t<v;t++)if(h=l[t])f[A++]=h.x,f[A++]=h.y,f[A++]=h.cx,f[A++]=h.cy,f[A++]=h.offset,f[A++]=h.data.length,f.set(h.data,A),A+=h.data.length;return f};this.fromStream=function(h){h=new Uint32Array(h.getData().buffer,h.getPosition());
for(var f=1,t=h[0],v,A,B,F,W,M,m,J=0;J<t;J++)v=h[f++],A=h[f++],B=h[f++],F=h[f++],W=h[f++],M=h[f++],m=new Uint32Array(M),M=f+M,m.set(h.subarray(f,M)),f=M,this.save(v,A,B,F,W,m)}},da=[],ra=new function(){var k=[];this.putFont=function(l,h,f){k[l]||(k[l]=[]);k[l][h]=f};this.getFont=function(l,h){return k[l]?k[l][h]:null};this.toPDU=function(){var l=0,h,f,t;var v=4;for(var A,B=k.length;l<B;l++)if((t=k[l])&&t.length)for(A=t.length,h=0;h<A;h++)(f=t[h])&&(v+=15+f.fontData.length);if(5>v)return null;var F=
new Uint8Array(v);v=new hi5.DataBuffer(F,0,v);F[0]=29;F[2]=1;F[3]=5;v.skipPosition(4);l=0;for(B=k.length;l<B;l++)if((t=k[l])&&t.length)for(A=t.length,h=0;h<A;h++)if(f=t[h])v.setByte(l),v.setLittleEndian16(h),v.setLittleEndian16(f.offset),v.setLittleEndian16(f.baseLine),v.setLittleEndian16(f.width),v.setLittleEndian16(f.height),v.setLittleEndian32(f.fontData.length),v.setBytes(f.fontData);return F};this.fromStream=function(l){for(;l.has(15);){var h=l.getByte(),f=l.getLittleEndian16(),t=l.getLittleEndian16(),
v=l.getLittleEndian16(),A=l.getLittleEndian16(),B=l.getLittleEndian16(),F=l.getLittleEndian32();F=l.getBytes(F);this.putFont(h,f,new w(t,v,A,B,F))}}},Na=new function(){var k=[],l=[];this.putBitmap=function(h,f,t){if(32767==f)l[h]&&(l[h].data=null,l[h]=null),l[h]=t;else{var v=k[h];v?v[f]&&(v[f].data=null,v[f]=null):k[h]=v=[];v[f]=t}};this.getBitmap=function(h,f){return 32767==f?l[h]:k[h]?k[h][f]:null};this.forEach=function(h){for(var f=k.length,t=0;t<f;t++)h(k[t],t,k)}}}function Mb(a){function b(m,
J,G){J[G]=m>>24&255;J[G+1]=m>>16&255;J[G+2]=m>>8&255;J[G+3]=m&255}function c(m,J){var G=m.length;J=new Uint8Array(J?G+1:G);for(var Q=0;Q<G;Q++)J[Q]=m.charCodeAt(Q);return J}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),g={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],
smhd:[],mehd:[]},n=this,H=1,z=a?48E3:9E4,E=1,C=!1,w=null;this.initTypes=function(){for(var m in g)g[m]=[m.charCodeAt(0),m.charCodeAt(1),m.charCodeAt(2),m.charCodeAt(3)];g.url=[117,114,108,32]};n.initTypes();this.reset=function(){C=!1;E=H=1};this.close=function(){n&&(n.reset(),n=null)};this.remux=function(m){m.id=H;m.isAudio=a;m.timeScale=a?m.audioHeader.sampleRate:z;if(!C){var J=new O(a),G=new r(m);w=new Uint8Array(J.data.length+G.data.length);w.set(J.data,0);w.set(G.data,J.data.length);C=!0}m.sequenceNumber=
E++;J=new t(m);G=new M(m);m=new Uint8Array(J.data.length+G.data.length);m.set(J.data,0);m.set(G.data,J.data.length);w&&(J=new Uint8Array(w.length+m.length),J.set(w,0),J.set(m,w.length),m=J,w=null);if(n.ondata)n.ondata(m)};var y=function(m){this.type=m;this.data=null};y.prototype.setData=function(){var m=Array.prototype.slice.call(arguments,0),J=m.length,G=8,Q;for(Q=0;Q<J;Q++)G+=m[Q].byteLength;this.data=new Uint8Array(G);b(G,this.data,0);this.data.set(this.type,4);G=8;for(Q=0;Q<J;Q++)this.data.set(m[Q],
G),G+=m[Q].byteLength};var O=function(m){var J=y.call(this,g.ftyp)||this;var G=c("mp42"),Q=c("mp41"),ca=c("isom"),na=c("avc1"),xa=c("iso5"),Da=new Uint8Array([0,0,2,0]);m?J.setData(G,Da,G,Q,ca,xa):J.setData(ca,Da,ca,Q,xa,na);return J};$jscomp.inherits(O,y);var r=function(m){var J=y.call(this,g.moov)||this;var G=new D(m),Q=new K(m);m=new h(m);J.setData(G.data,Q.data,m.data);return J};$jscomp.inherits(r,y);var D=function(m){m=y.call(this,g.mvhd)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,
0]),Q=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]),na=new Uint8Array(4);b(1E3,na,0);var xa=new Uint8Array([0,1,0,0]),Da=new Uint8Array([1,0]),Ia=new Uint8Array(10),Fa=new Uint8Array(36);Fa[1]=1;Fa[17]=1;Fa[32]=64;var za=new Uint8Array(24),Ga=new Uint8Array([255,255,255,255]);m.setData(J,G,Q,ca,na,e,xa,Da,Ia,Fa,za,Ga);return m};$jscomp.inherits(D,y);var K=function(m){var J=y.call(this,g.trak)||this;var G=new u(m);m=new P(m);J.setData(G.data,m.data);return J};$jscomp.inherits(K,y);var u=function(m){var J=
y.call(this,g.tkhd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,7]),ca=new Uint8Array([0,0,0,0]),na=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.id,xa,0);var Da=new Uint8Array(4),Ia=new Uint8Array(8),Fa=new Uint8Array([0,0]),za=new Uint8Array([0,0]),Ga=m.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),wa=new Uint8Array(2),Aa=new Uint8Array(36);Aa[1]=1;Aa[17]=1;Aa[32]=64;var Pa=new Uint8Array(4);Pa[0]=m.width>>8&255;Pa[1]=m.width&255;Pa[2]=0;Pa[3]=0;var Za=new Uint8Array(4);Za[0]=
m.height>>8&255;Za[1]=m.height&255;Za[2]=0;Za[3]=0;J.setData(G,Q,ca,na,xa,Da,e,Ia,Fa,za,Ga,wa,Aa,Pa,Za);return J};$jscomp.inherits(u,y);var P=function(m){var J=y.call(this,g.mdia)||this;var G=new N(m),Q=new U(m);m=new aa(m);J.setData(G.data,Q.data,m.data);return J};$jscomp.inherits(P,y);var N=function(m){var J=y.call(this,g.mdhd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,0]),na=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.timeScale,xa,0);m=new Uint8Array([85,
196]);var Da=new Uint8Array(2);J.setData(G,Q,ca,na,xa,e,m,Da);return J};$jscomp.inherits(N,y);var U=function(m){var J=y.call(this,g.hdlr)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array(4);m=m.isAudio?c("soun"):c("vide");var na=new Uint8Array(12),xa=c("Remote Spark Handler",!0);J.setData(G,Q,ca,m,na,xa);return J};$jscomp.inherits(U,y);var aa=function(m){var J=y.call(this,g.minf)||this;var G=new x,Q=new V(m);m.isAudio?(m=new pa,J.setData(m.data,G.data,Q.data)):(m=new S,
J.setData(m.data,G.data,Q.data));return J};$jscomp.inherits(aa,y);var S=function(){var m=y.call(this,g.vmhd)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,1]),Q=new Uint8Array([0,0]),ca=new Uint8Array(6);m.setData(J,G,Q,ca);return m};$jscomp.inherits(S,y);var pa=function(){var m=y.call(this,g.smhd)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0]),ca=new Uint8Array(2);m.setData(J,G,Q,ca);return m};$jscomp.inherits(pa,y);var x=function(){var m=y.call(this,g.dinf)||
this;var J=new X;m.setData(J.data);return m};$jscomp.inherits(x,y);var X=function(){var m=y.call(this,g.dref)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,1]),ca=new ja;m.setData(J,G,Q,ca.data);return m};$jscomp.inherits(X,y);var ja=function(){var m=y.call(this,g.url)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,1]);m.setData(J,G);return m};$jscomp.inherits(ja,y);var V=function(m){var J=y.call(this,g.stbl)||this;m=new fa(m);var G=new ra,Q=new Na,ca=new k,
na=new l;J.setData(m.data,G.data,Q.data,ca.data,na.data);return J};$jscomp.inherits(V,y);var fa=function(m){var J=y.call(this,g.stsd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,1]);m.isAudio?(m=new la(m),J.setData(G,Q,ca,m.data)):(m=new oa(m),J.setData(G,Q,ca,m.data));return J};$jscomp.inherits(fa,y);var la=function(m){var J=y.call(this,g.mp4a)||this;var G=new Uint8Array(6),Q=new Uint8Array([0,1]),ca=new Uint8Array(8),na=new Uint8Array([0,2]),xa=new Uint8Array([0,
16]),Da=new Uint8Array([0,0]),Ia=new Uint8Array(2),Fa=m.audioHeader.sampleRate,za=new Uint8Array(4);za[0]=Fa>>8&255;za[1]=Fa&255;za[2]=0;za[3]=0;m=new ta(m);J.setData(G,Q,ca,na,xa,Da,Ia,za,m.data);return J};$jscomp.inherits(la,y);var ta=function(m){var J=y.call(this,g.esds)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array([3]),na=new Uint8Array([25]),xa=new Uint8Array([0,0]),Da=new Uint8Array([0]),Ia=new Uint8Array([4]),Fa=new Uint8Array([17]),za=new Uint8Array([64]),Ga=
new Uint8Array([21]),wa=new Uint8Array(3),Aa=m.bufferSizeDB;wa[0]=Aa>>16&255;wa[1]=Aa>>8&255;wa[2]=Aa&255;Aa=new Uint8Array(4);b(m.bitRate,Aa,0);var Pa=new Uint8Array(4);b(m.bitRate,Pa,0);var Za=new Uint8Array([5]),$a=new Uint8Array([2]),Xa=m.audioHeader.audioType||2,mb=m.audioHeader.frequencyIdx,vb=m.audioHeader.channelConfig;m=new Uint8Array(2);m[0]=Xa<<3|mb>>1&7;m[1]=(mb&1)<<7|vb<<3;Xa=new Uint8Array([6]);mb=new Uint8Array([1]);vb=new Uint8Array([2]);J.setData(G,Q,ca,na,xa,Da,Ia,Fa,za,Ga,wa,Aa,
Pa,Za,$a,m,Xa,mb,vb);return J};$jscomp.inherits(ta,y);var oa=function(m){var J=y.call(this,g.avc1)||this;var G=new Uint8Array(6),Q=new Uint8Array([0,1]),ca=new Uint8Array([0,0]),na=new Uint8Array(2),xa=new Uint8Array(12),Da=new Uint8Array(2);Da[0]=m.width>>8&255;Da[1]=m.width&255;var Ia=new Uint8Array(2);Ia[0]=m.height>>8&255;Ia[1]=m.height&255;var Fa=new Uint8Array([0,72,0,0]),za=new Uint8Array([0,72,0,0]),Ga=new Uint8Array(4),wa=new Uint8Array([0,1]),Aa=c("SparkStreamPlayer"),Pa=new Uint8Array(32);
Pa[0]=Aa.length;Pa.set(Aa,1);Aa=new Uint8Array([0,24]);var Za=new Uint8Array([255,255]);m=new Y(m);J.setData(G,Q,ca,na,xa,Da,Ia,Fa,za,Ga,wa,Pa,Aa,Za,m.data);return J};$jscomp.inherits(oa,y);var Y=function(m){var J=y.call(this,g.avcC)||this;var G=new Uint8Array([1]),Q=new Uint8Array([m.sps[1]]),ca=new Uint8Array([m.sps[2]]),na=new Uint8Array([m.sps[3]]),xa=new Uint8Array([255]),Da=new Uint8Array([225]),Ia=new Uint8Array(2),Fa=m.sps.byteLength;Ia[0]=Fa>>8&255;Ia[1]=Fa&255;Fa=new Uint8Array(m.sps);var za=
new Uint8Array([1]),Ga=new Uint8Array(2),wa=m.pps.byteLength;Ga[0]=wa>>8&255;Ga[1]=wa&255;m=new Uint8Array(m.pps);J.setData(G,Q,ca,na,xa,Da,Ia,Fa,za,Ga,m);return J};$jscomp.inherits(Y,y);var da=function(){var m=y.call(this,g.btrt)||this;var J=new Uint8Array([0,28,156,128]),G=new Uint8Array([0,45,198,192]),Q=new Uint8Array([0,45,198,192]);m.setData(J,G,Q);return m};$jscomp.inherits(da,y);var ra=function(){var m=y.call(this,g.stts)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,
0,0,0]);m.setData(J,G,Q);return m};$jscomp.inherits(ra,y);var Na=function(){var m=y.call(this,g.stsc)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]);m.setData(J,G,Q);return m};$jscomp.inherits(Na,y);var k=function(){var m=y.call(this,g.stsz)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]);m.setData(J,G,Q,ca);return m};$jscomp.inherits(k,y);var l=function(){var m=y.call(this,g.stco)||this;var J=
new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]);m.setData(J,G,Q);return m};$jscomp.inherits(l,y);var h=function(m){var J=y.call(this,g.mvex)||this;m=new f(m);J.setData(m.data);return J};$jscomp.inherits(h,y);da=function(m){m=y.call(this,g.mehd)||this;var J=new Uint8Array([0]),G=new Uint8Array([0,0,0]);m.setData(J,G,d);return m};$jscomp.inherits(da,y);var f=function(m){var J=y.call(this,g.trex)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array(4);
b(m.id,ca,0);m=new Uint8Array([0,0,0,1]);var na=new Uint8Array([0,0,0,0]),xa=new Uint8Array([0,0,0,0]),Da=new Uint8Array([0,0,0,0]);J.setData(G,Q,ca,m,na,xa,Da);return J};$jscomp.inherits(f,y);var t=function(m){var J=y.call(this,g.moof)||this;v.setSequenceNumber(m.sequenceNumber);m=new A(m);J.setData(v.data,m.data);return J};$jscomp.inherits(t,y);da=function(m){var J=y.call(this,g.mfhd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(m,ca,0);J.setData(G,Q,ca);return J};
$jscomp.inherits(da,y);da.prototype.setSequenceNumber=function(m){b(m,this.data,12)};var v=new da(1),A=function(m){var J=y.call(this,g.traf)||this;B.setTrackId(m.id);B.setSampleDuration(m.frameDuration);F.setBaseMediaDecodeTime(m.samples[0].timestamp);var G=32+B.data.length+F.data.length;if(m.isAudio)m=new W(m,null,G);else{for(var Q=[],ca=0;ca<m.samples.length;ca++){var na=m.samples[ca];Q.push({size:na.unitsLength+4*na.units.length,duration:m.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,
dependsOn:na.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:na.hasIDR?0:1,degradationPriority:0}})}m=new W(m,Q,G)}J.setData(B.data,F.data,m.data);return J};$jscomp.inherits(A,y);da=function(m,J){var G=y.call(this,g.tfhd)||this;G.isAudio=J;var Q=new Uint8Array([0]),ca=J?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),na=new Uint8Array(4);b(m,na,0);J?(m=new Uint8Array([0,0,0,1]),J=new Uint8Array(4),b(1024,J,0),G.setData(Q,ca,na,m,J)):(m=new Uint8Array([0,0,2,0,1,1,0,0]),G.setData(Q,ca,na,m));
return G};$jscomp.inherits(da,y);da.prototype.setTrackId=function(m){b(m,this.data,12)};da.prototype.setSampleDuration=function(m){this.isAudio||b(m,this.data,16)};var B=new da(0,a);da=function(m){var J=y.call(this,g.tfdt)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(m,ca,0);J.setData(G,Q,ca);return J};$jscomp.inherits(da,y);da.prototype.setBaseMediaDecodeTime=function(m){b(m,this.data,12)};var F=new da(0),W=function(m,J,G){var Q=y.call(this,g.trun)||this;var ca=
new Uint8Array([0]),na=m.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,15,1]),xa=m.isAudio?4:16;G+=xa*(m.isAudio?m.samples.length:J.length)+28;var Da=new Uint8Array(4);m.isAudio?b(m.samples.length,Da,0):b(J.length,Da,0);var Ia=new Uint8Array(4);b(G,Ia,0);if(m.isAudio){G=new Uint8Array(xa*m.samples.length);for(var Fa=0;Fa<m.samples.length;Fa++)b(m.samples[Fa].aacData.byteLength,G,xa*Fa)}else for(G=new Uint8Array(xa*J.length),Fa=0;Fa<J.length;Fa++){m=J[Fa];var za=xa*Fa;b(m.duration,G,za);b(m.size,
G,za+4);var Ga=m.flags,wa=new Uint8Array(4);wa[0]=Ga.isLeading<<2|Ga.dependsOn;wa[1]=Ga.isDependedOn<<6|Ga.hasRedundancy<<4|0|Ga.isNonSync;wa[2]=Ga.degradationPriority&61440;wa[3]=Ga.degradationPriority&15;G.set(wa,za+8);b(m.compositionTimeOffset,G,za+12)}Q.setData(ca,na,Da,Ia,G);return Q};$jscomp.inherits(W,y);da=function(m){var J=y.call(this,g.sdtp)||this;for(var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ca=new Uint8Array(m.length),na=0;na<m.length;na++){var xa=m[na].flags;ca[na]=xa.isLeading<<
6|xa.dependsOn<<4|Q.isDependedOn<<2|Q.hasRedundancy}J.setData(G,Q,ca);return J};$jscomp.inherits(da,y);var M=function(m){var J=y.call(this,g.mdat)||this;if(m.isAudio){for(var G=new Uint8Array(m.totalByteLength),Q=0,ca=0;ca<m.samples.length;ca++){var na=m.samples[ca].aacData;G.set(na,Q);Q+=na.byteLength}J.setData(G)}else{G=new Uint8Array(4*m.unitNum+m.totalByteLength);for(ca=Q=0;ca<m.samples.length;ca++){na=m.samples[ca];for(var xa=0;xa<na.units.length;xa++){var Da=na.units[xa],Ia=Da.data.byteLength;
b(Ia,G,Q);Q+=4;G.set(Da.data,Q);Q+=Ia}}J.setData(G)}return J};$jscomp.inherits(M,y)}function qc(a){function b(E,C){this.aacData=E;this.timestamp=C}function c(E,C,w,y){this.audioType=E;this.frequencyIdx=C;this.sampleRate=w;this.channelConfig=y}var e=qc.SAMPLING_FREQUENCY,d=null,g=!0,n=this,H=0;this.reset=function(){H=0;d=null;z.audioHeader=null;a&&a.reset()};var z=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=
this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=function(E,C){var w=E.frequencyIdx;w||(w=e.indexOf(E.sampleRate));-1==w&&console.error("Invalid AAC sampel rate: "+E.sampleRate);d=new c(E.audioType||2,w,E.sampleRate,E.channels||E.channelConfig);z.audioHeader=d;g=!C;if(n.oncodec)n.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(E){if(g){var C=n.readADTSHeader(E);E=E.subarray(C)}C=new b(E,H);H+=1024;z.samples.push(C);
z.totalByteLength+=E.byteLength;E=1/(d.sampleRate/1024);z.duration=E;z.samples[0]&&(z.bitRate=8*z.samples[0].aacData.length/E|0);a&&a.remux(z);z.clear()};this.readADTSHeader=function(E){var C=E[1]&0?9:7,w=(E[2]>>6&3)+1,y=E[2]>>2&15,O=e[y];O||console.error("Invalid Sampling Frequency Index: "+y);var r=((E[2]&1)<<2)+(E[3]>>6&3),D=E[1]>>1&3;0!=D&&console.error("Invalid data format: layer is not 0x00: "+D.toString(16));E.length!=((E[3]&3)<<11)+(E[4]<<3)+(E[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+
E.length);if(d){if(y!=d.frequencyIdx&&(d.frequencyIdx=y,d.sampleRate=O,n.oncodec))n.oncodec("mp4a.40.2",d)}else if(d=new c(w,y,O,r),z.audioHeader=d,n.oncodec)n.oncodec("mp4a.40.2",d);return C}}function Uc(a){function b(){if(0==H)console.error("no more ExpGolomb data");else{var C=0,w=n-H;for(z=0;w<n;){var y=a[w];if(3!=y||0!=a[w-1]||0!=a[w-2])z=z<<8|y,C++;w++;if(4<=C)break}4>C&&(z<<=4-C);E=8*C;H=n-w}}function c(C){if(!(E>C)){C-=E;var w=C>>3;C-=w>>3;H-=w;b()}z<<=C;E-=C}function e(C){var w=Math.min(E,
C),y=z>>>32-w;32<C&&logger.error("Read more than 32 bits:"+C);E-=w;0<E?z<<=w:0<H&&b();w=C-w;return 0<w?y<<w|e(w):y}function d(){var C;for(C=0;C<E;++C)if(0!==(z&2147483648>>>C))return z<<=C,E-=C,C;b();return C+d()}function g(){c(1+d())}var n=a.byteLength,H=n,z=0,E=0;this.readUEG=function(){var C=d();return e(C+1)-1};this.readEG=function(){var C=this.readUEG();return 1&C?1+C>>>1:-1*(C>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};
this.readU32=function(){return e(32)};this.skipScalingList=function(C){var w=8,y=8,O;for(O=0;O<C;O++)0!==y&&(y=this.readEG(),y=(w+y+256)%256),w=0===y?w:y};this.readSPS=function(){var C=0,w=0,y=0,O=0,r=1,D,K=0,u=!0;if(7>a.length)return console.log("no enought SPS data"),null;var P=this.readU8();if(7!=(P&31))return console.error("Invalid SPS type: "+P,a),null;P=this.readU8();e(5);c(3);this.readU8();g();if(100===P||110===P||122===P||244===P||44===P||83===P||86===P||118===P||128===P||138===P||139===P||
134===P||135===P){var N=this.readUEG();3===N&&c(1);g();g();c(1);if(this.readBool()){var U=3!==N?8:12;for(D=0;D<U;D++)this.readBool()&&(6>D?this.skipScalingList(16):this.skipScalingList(64))}}g();D=this.readUEG();if(0===D)this.readUEG();else if(1===D)for(c(1),c(1+d()),c(1+d()),U=this.readUEG(),D=0;D<U;D++)c(1+d());g();c(1);var aa=this.readUEG();D=this.readUEG();U=e(1);0===U&&c(1);c(1);this.readBool()&&(C=this.readUEG(),w=this.readUEG(),y=this.readUEG(),O=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var S=
[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}S&&(r=S[0]/S[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&
c(24));this.readBool()&&(g(),g());this.readBool()&&(K=this.readU32(),S=this.readU32(),u=this.readBool(),K=S/(2*K))}r=Math.ceil((16*(aa+1)-2*C-2*w)*r);S=(2-U)*(D+1)*16-(U?2:4)*(y+O);D="avc1."+(0==a[1]?"00":a[1].toString(16));D+=0==a[2]?"00":a[2].toString(16);D+=0==a[3]?"00":a[3].toString(16);return{width:r,height:S,profileIdc:P,chromaFormatIdc:N,frameCropLeftOffset:C,frameCropRightOffset:w,frameCropTopOffset:y,frameCropBottomOffset:O,fps:K,fixedFrameRate:u,codec:D}};this.readSliceType=function(){this.readU8();
this.readUEG();return this.readUEG()}}function Pd(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=H;this.unitsLength=z;this.timestamp=d;this.hasIDR=g}function e(){var y=!1;if(n&&C.sps){var O=new c;d+=C.frameDuration||3E3;C.samples.push(O);C.totalByteLength+=z;C.unitNum+=H.length;
C.sequence++;y=!0;if(O.hasIDR&&w.onkeyframe)w.onkeyframe(O)}n=g=!1;H=[];z=0;return y}var d=0,g=!1,n=!1,H=[],z=0,E=Mb.searchStartCode,C=null,w=this;C=new b;this.reset=function(){d=0;g=!1;H=[];z=0;C=new b;a&&a.reset()};this.close=function(){w&&(w.reset(),w=null)};this.parseH264Data=this.parse=function(y){for(var O=[],r=0,D,K,u,P=[0,0];r<y.byteLength;){P[0]=r;E(y,P);var N=P[0];if(-1==N)break;r=P[1];r=N+r;u=y[r];u&=31;D&&(D={type:K,data:y.subarray(D,N)},O.push(D));D=r;K=u}D&&(D={type:K,data:y.subarray(D,
y.byteLength)},O.push(D));for(y=0;y<O.length;y++)switch(P=O[y],r=P.type,r){case 1:case 2:case 3:case 4:H.push(P);z+=P.data.byteLength;n=!0;break;case 5:n=g=!0;H.push(P);z+=P.data.byteLength;break;case 6:break;case 7:r=new Uc(P.data);if(r=r.readSPS()){if(C.width=r.width,C.height=r.height,C.codec=r.codec,C.sps=P.data,r.fps&&(C.frameDuration=9E4/r.fps|0),H.push(P),z+=P.data.byteLength,w.oncodec)w.oncodec(C.codec,r)}else console.log("corrupted sps",P.data);break;case 8:C.pps=P.data;H.push(P);z+=P.data.byteLength;
break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+r)}e()&&C.sps&&(a.remux(C),C.clear())}}function Nb(a,b,c){function e(){for(;z;){if(K.updating){z=!1;break}var N=H.shift();if(!N)break;try{K.appendBuffer(N),E=0}catch(U){H.unshift(N);if("QuotaExceededError"==U.name)if(n(!0))continue;else{if(C.onerror)C.onerror(U);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),C.close();break}E++;console.error("Failed to append buffer, retry "+E,U);if(2<E){if(C.onerror)C.onerror(U);
break}}}}function d(){z=!0;e()}function g(){K=D.addSourceBuffer(w);K.mode="sequence";K.addEventListener("updateend",d);K.addEventListener("error",function(N){console.error(N)});z=!0;C.play(!1);e()}function n(N){var U=Math.min(a.played.end(0),K.buffered.end(0)),aa=0,S=r.length,pa=!1,x=0;if(c)x=U-180,0>x&&console.warn("Not possible, time played secs: "+U);else if(1<S){var X=S-2;for(U=9E4*U|0;aa<S;){if(r[aa]>U){X=aa-2;break}aa++}0<=X&&(x=(r[X]+1E3)/9E4)}if(0<x)try{K.remove(0,x),r.splice(0,X+1),pa=!0,
console.info("Buffer removed "+x+" isAudio: "+c)}catch(ja){console.warn("Buffer removal "+x+" failed, retry, isAudio: "+c)}N||(O=setTimeout(n,18E4));return pa}var H=[],z=!1,E=0,C=this,w="",y=null,O=0,r=[],D=null,K=null,u=null,P=null;a.autoplay=!0;this.getKeyFrames=function(){return r};u=new Mb(c);u.ondata=function(N){H.push(N);e()};P=c?new qc(u):new Pd(u);P.onkeyframe=function(N){r.push(N.timestamp)};P.oncodec=function(N,U){var aa=c?"audio/mp4;codecs=":"video/mp4;codecs=";aa+=N;if(aa!=w||(c?y.sampleRate!=
U.sampleRate:y.width!=U.width||y.height!=U.height))if(w=aa,y=U,z=!1,K=null,D=new MediaSource,D.addEventListener("sourceopen",g),a.src=URL.createObjectURL(D),C.onsps)C.onsps(U)};b.onvideoframe=function(N){P.parse(N.bitstream)};b.onaudioframe=function(N){P.parse(N)};b.onendofstream=function(){C.reset()};this.play=function(N){a.play().catch(function(U){if(!N&&(console.error(U),C.onplayerror))C.onplayerror(U)})};this.reset=function(){console.log("Reset player");O&&(clearTimeout(O),O=0);r.length=0;z=!1;
w="";y=null;P&&P.reset();H.length=0};this.close=function(){C&&(C.reset(),D&&"open"==D.readyState&&(D.endOfStream(),a.src=null),P&&P.close&&P.close(),u&&u.close&&u.close(),C=null)};this.setMediaFormat=function(N,U){P.setMediaFormat&&P.setMediaFormat(N,U)};this.getMediaSource=function(){return D};this.getMediaSourceBuffer=function(){return K};a.addEventListener("ended",function(N){console.warn(".... ended");O&&(clearTimeout(O),O=0)});a.addEventListener("emptied",function(N){z=!!K});a.addEventListener("pause",
function(N){console.warn(".... paused");z=!!K;var U=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+U)}).catch(function(aa){console.error(aa)})});a.addEventListener("waiting",function(N){z=!!K})}function Qd(a,b,c){function e(C){var w=C.codec;if(w!=d||(b?H.sampleRate!=C.sampleRate:H.width!=C.width||H.height!=C.height))if(console.log("Codec: "+w+" audio: "+b),d=w,H=C,n||(n=new VideoDecoder({output:function(y){if(7!=y.duration)g.onframedecoded(y);y.close()},error:function(y){console.error("VideoDecoder error:",
y);if(g.onerror)g.onerror(y)}})),n.configure({codec:d,codedWidth:C.width,codedHeight:C.height,hardwareAcceleration:c||"no-preference"}),g.onsps)g.onsps(C)}var d=null,g=this,n,H=null,z={type:"delta",data:null,timestamp:0,duration:0},E=null;a.onvideoframe=function(C){var w=C.bitstream;var y=0,O=[0,0],r=w.length,D=!1;var K=null;for(var u=!1;y<r;){O[0]=y;Mb.searchStartCode(w,O);var P=O[0];if(-1==P)break;P+=O[1];y=P+1;var N=w[P]&31;switch(N){case 1:case 2:case 3:case 4:break;case 5:D=!0;break;case 6:break;
case 7:(K=(new Uc(w.subarray(P))).readSPS())||(u=!0);break;case 8:break;case 9:break;default:console.log("nal type:"+N)}}w=D;u?console.log("corrupted: "+C.timestamp,C.bitstream):(K&&e(K),H&&(z.type=w?"key":"delta",z.data=C.bitstream,z.timestamp=C.timestamp,z.duration=C.isChroma?7:1E3,C=new EncodedVideoChunk(z),n.decode(C)))};this.play=function(C){};this.reset=function(){console.log("Reset MediaDecoder");H=d=null;E&&(E.close(),E=null);n&&n.reset()&&n.close();n=null};this.close=function(){g.reset();
n&&(n.close(),n=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Lb=!1,lb={},jb={},Bb=null,q=this,mc=!1,Wa=!1,cb=0,Cb=null,Vc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ha=hi5.appcfg,Jb="";this.setConfig=function(a){ha=a};var bb=
"object"==typeof p?p:null,L=bb?{}:hi5.tool.queryToObj(p.substring(p.indexOf("?")+1));void 0==L.mapClipboard&&ha.clipboard&&void 0!=ha.clipboard.enabled&&(L.mapClipboard=ha.clipboard.enabled);L.hardwareAcceleration||(L.hardwareAcceleration=ha.hardwareAcceleration);L.hardwareAcceleration||(L.hardwareAcceleration="prefer-software");void 0==ha.enableDVCAudio&&(ha.enableDVCAudio=!0);var Ja=0,Ka=0,fb=(ka||L.color||L.server_bpp||16)|0,oc=null,Wc=null,Qa=null,Ib=null,Xc="/DOWNLOAD?",Yc="/CLIP?";24==fb&&(fb=
16);var Va="app"==L.startProgram,Kb=R(L.mapDisk),nb=0;this.setLinks=function(a){a.download&&(Xc=a.download);a.clipboard&&(Yc=a.clipboard)};this.protocol=bb?"":p.substring(0,p.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return R(L.smartCard)||R(L.mapSmartCard)||R(L.passwordIsPin)};this.enableWebAuthn=function(){return R(L.enableWebAuthn)||R(L.useWebAuthn)};this.hasScanner=function(){return R(L.scanner)};this.hasUSB=function(){return R(L.mapUSB)&&!!navigator.usb};this.getUSB=function(){return L.usb||
hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Wc=a};this.getProfiler=function(){return Wc};this.gateway=function(){if(bb)return"";var a=p.lastIndexOf("/RDP?");-1==a&&(a=p.lastIndexOf("/JOIN?"));-1==a&&(a=p.lastIndexOf("/PLAY?"));return p.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+
svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=va;var kb="object"==typeof p||0<p.indexOf("/PLAY?"),rc=!kb&&0<p.indexOf("invitation=");if(rc){var sc=decodeURIComponent(p),Ob=sc.indexOf(' USERNAME="');if(0<Ob){Ob+=11;var Rd=sc.substring(Ob,sc.indexOf('"',Ob));p+="&novice="+Rd}p+="&mapClipboard=on";L.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,bb?p="":(Ja=640,Ka=480),p+="&touchpad=on",L.touchpad="on",this.reconnectOnResize=!1;else if(0<p.indexOf("/JOIN?")||rc)this.mode=
2,this.reconnectOnResize=!1;var tc=R(L.gfx)||R(L.remotefx)||0<q.mode;tc&&(Va||rc?(tc=!1,L.remotefx=!1):fb=32);I?Ja=parseInt(I):L.width&&(Ja=parseInt(L.width));T?Ka=parseInt(T):L.height&&(Ka=parseInt(L.height));-1==Ja&&(Ja=hi5.browser.getScreenWidth());-1==Ka&&(Ka=hi5.browser.getScreenHeight());L.symlink&&L.parameters&&hi5.tool.queryToObj(L.parameters,L);L.gateway||(p+="&gateway="+encodeURIComponent(q.gateway));!L.minWidth&&ha.minWidth&&(L.minWidth=ha.minWidth);!L.minHeight&&ha.minHeight&&(L.minHeight=
ha.minHeight);L.minWidth&&(L.minWidth=parseInt(L.minWidth));L.minHeight&&(L.minHeight=parseInt(L.minHeight));L.waWidth=L.waWidth?parseInt(L.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;L.waWidth&=-4;L.waHeight=L.waHeight?parseInt(L.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;L.waHeight&=-4;"useSSL"in L||(p+="&useSSL="+("wss"==q.protocol));hi5.storage.isAvailable&&(R(L.shareClipboard)||
L.shareClipboardId)&&(p+="&shareClipboardId="+(L.shareClipboardId||Z()));ha&&(void 0!=ha.displayMsg?this.displayMsg=ha.displayMsg:ha.displayMsg=this.displayMsg,ha.appTimeout&&(this.appTimeout=ha.appTimeout),void 0!=ha.reconnectOnResize&&(this.reconnectOnResize=ha.reconnectOnResize),ha.reconnectTimes&&(this.reconnectTimes=ha.reconnectTimes),void 0!=ha.windowState&&(this.windowState=ha.windowState),void 0!=ha.openLink&&(this.openLink=ha.openLink),void 0!=ha.setTitle&&(this.setTitle=ha.setTitle),"boolean"==
typeof ha.useWSS&&(p=(ha.useWSS?"wss":"ws")+p.substring(p.indexOf("://"))),"boolean"==typeof ha.remoteAppLogin&&(this.remoteAppLogin=ha.remoteAppLogin,Lb=!ha.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ha.hideLogin&&(Lb=ha.hideLogin),void 0!=ha.localPrinter&&void 0==L.localPrinter&&(L.localPrinter=ha.localPrinter));var Ma=null;void 0==ha.useWorker&&(ha.useWorker=!1);ha.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&
!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ha.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var La=ha.useWorker?new Worker(sa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,ub=this.reconnectTimes,ac=La?{type:5,data:null}:null;this.getDisplayName=ba;this.server=ba();this.port=parseInt(L.port,10);this.loadbalanceToken="";ha.loadbalanceTokenName&&(L[ha.loadbalanceTokenName]?ia(L[ha.loadbalanceTokenName]):!1!==ha.randomAppId?ia(hi5.tool.uuid()):
svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){q.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+q.loadbalanceToken:"&"+q.loadbalanceToken,a+="&loadbalanceTokenName="+ha.loadbalanceTokenName);return a};this.getURL=function(){return p};this.getRuntimeURL=function(){var a=p+"&width="+Ja+"&height="+Ka+"&server_bpp="+fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Ec(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=L.monitorDef,d=L.monitor,g=0;b=
ea.size();var n=Array(b);c=Array(b);var H=0,z=0,E=0,C=0,w=0,y=0,O="";if(e){c=qa.parseMonitorDef(e);for(b=c.length;g<b;g++){var r=c[g];r[0]<E&&(E=r[0]);r[1]<C&&(C=r[1]);r[2]>w&&(w=r[2]);r[3]>y&&(y=r[3])}0>E&&(H=-E);0>C&&(z=-C);r=0>d?[E,C,w,y]:c[d];L.width=r[2]-r[0]+1;L.height=r[3]-r[1]+1;g=ea.getSurface(0);g.setMonitor(r[0],r[1],r[2],r[3]);if(H||z)for(r=g.getMousePosition(),r.left+=H,r.right+=H,r.top+=z,r.bottom+=z,g=0;g<b;g++)r=c[g],r[0]+=H,r[1]+=z,r[2]+=H,r[3]+=z;qa.setMonitorLayout(c);0>d&&qa.setMonitorCount(0);
q.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+L.width+"&height="+L.height}else{if(1<b&&!Va){for(ea.verifyMonitors();g<b;g++)e=ea.getSurface(g),r=e.getMousePosition(),r.left<E&&(E=r.left),r.top<C&&(C=r.top),r.right>w&&(w=r.right),r.bottom>y&&(y=r.bottom),n[g]=r,O&&(O+=","),O+=r.left+":"+r.top+":"+r.right+":"+r.bottom;0>E&&(H=-E);0>C&&(z=-C);for(g=0;g<b;g++){r=ea.getSurface(g).getMousePosition();if(H||z)r.left+=H,r.right+=H,r.top+=z,r.bottom+=z;c[g]=[r.left,r.top,r.right,r.bottom,r.left==H&&r.top==
z?1:0]}qa.setMonitorLayout(c);q.reconnectOnResize=!1}O&&(svGlobal.logger.warn("MonitorDef:"+O),L.width=w-E+1,L.height=y-C+1,O="&monitorDef="+O+"&width="+L.width+"&height="+L.height);b=O}a+=b;0>p.indexOf("waWidth")&&(b=(b=ea.getFocused())?b.getWindow():window,a+="&waWidth="+L.waWidth+"&waHeight="+L.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;L.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());L.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));
a+="&time="+b.getTime();void 0==L.soundPref&&(L.soundPref=0,a+="&soundPref=0");H=c=b="";for(H in lb)z=lb[H],"flags"in z&&(b&&(b+=",",c+=","),b+=z.name,c+=z.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(H in jb)z=jb[H],"flags"in z&&(b&&(b+=","),b+=z.name);b&&(a+="&gwChannelName="+b);if(c=wd())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);L.audioRecord=R(L.audioRecord)&&hi5.audio.recordable;
Ea.init(b,tc,L.audioRecord,L.soundPref,R(L.mapCamera)&&!!navigator.mediaDevices,R(L.mapUSB)&&!!navigator.usb);L.audioRecord&&(a+="&audioRecord=on");L.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ea.count&&(a+="&dvcChannels="+Ea.names.join(","));a+="&binary=on";ha.existingFile&&(a+="&existingFile="+ha.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(va());a=q.modifyURL(a);ha.copyTextOnly&&R(L.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&
(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);R(L.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Fd()};this.getColor=function(){return fb};this.changeTitle=ma;hi5.browser.isTouch&&Math.max(Ja,Ka)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Ba=null,Ha=!1,qb=!1,pc=!1,Ta=new function(){function a(z){c&&(d&&d.disconnect(),
g&&g.disconnect());hi5.audio.releaseAudioContext();z||(H&&(H.close(),H=null),n&&(n.pause(),n=null))}function b(z){console.error("play error: ",z)}var c=null;this.supportWebAudio=this.available=!1;(0==L.playSound||0<q.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(z){return c.createBuffer(2,z,Ca.samplePerSec)};var e=0,d=null,g=null;this.setVolume=function(z){1==z?d=null:(d||(d=c.createGain()),
d.gain.value=z)};this.playBuffer=function(z){g=c.createBufferSource();g.buffer=z;d?(g.connect(d),d.connect(c.destination)):g.connect(c.destination);var E=c.currentTime,C=0<e?e:E;C<E&&(C=E);e=C+z.duration;g.start?g.start(C):g.noteOn(C);return e-E};this.iOSFix=function(){if(c){var z=this.getBuffer(1024),E=c.createBufferSource();E.buffer=z;E.connect(c.destination);E.start?E.start(0):E.noteOn(0)}};this.close=a;var n=null,H=null;this.onaudioframe=null;this.initMediaPlayer=function(z,E,C){a(!0);n||(n=document.createElement("audio"));
H||(H=new Nb(n,z,!0),H.onplayerror=b,H.onerror=function(w){console.error("Not possible audio error",w)},svGlobal.logger.info("MediaPlayer init, headerless: "+C+" sampleRate:"+E.sampleRate));H.setMediaFormat(E,C);H.play(!1)}},Md=Ta.available,qa=new yc(200,200);qa.onSetCursor=Jc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Yb=0,Xb=0,Zb=Ja-1,$b=Ka-1,nc="";window.$rdp||(window.$rdp=this);ya(fb);this.setResolution=Oa;this.running=function(){return Ha};this.setJoinMode=
function(a){Ha&&ua("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&ua("8EB3\t"+a)};this.refuseControl=function(a){Ha&&ua("8E3"+a)};this.giveControl=function(a){Ha&&ua("8E4"+a)};this.pauseSession=function(a,b){Ha&&ua("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ha&&ua("8EB2\t"+a)};this.requestControl=function(){Ha&&ua("8E2")};this.saveSession=function(a){Ha&&ua("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&ua("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(c&&
0<c.length){var g=c.shift();g.key?Db.sendSingleKey(g.down,g.key):g.char&&sb(g.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,
f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(g,n){var H=b[n.toLowerCase()];H?q.writeScancode(g,H):(H=n.length,0!=H&&(1==H?q.writeKeyCode(g,n.toUpperCase().charCodeAt(0)):g&&q.writeText(n)))};var c=null,e=0,d=null;this.sendKeyComb=function(g,n,H){if(Wa){g=g.split("+");var z=g.length,E;if(0!=z){var C=null,w=[];for(E=0;E<z;E++){var y=g[E];""==y&&""==C&&(y="Add");""!=y&&w.push({key:y,down:!0});C=y}z=w.length;for(E=z-1;0<=E;E--)w.push({key:w[E].key,down:!1});if(n)c=w,e=n,
d=H,a();else for(E=0,z=w.length;E<z;E++)Db.sendSingleKey(w[E].down,w[E].key)}}};this.sendText=function(g,n,H){for(var z=[],E=0,C=g.length;E<C;E++)z.push({"char":g.charAt(E)});c=z;e=n;d=H;a()}};this.writeKeyComb=function(a,b,c){Wa&&Db.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Wa)if(b)Db.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)sb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),q.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ea=new function(a,
b){function c(){function d(w){for(;0<w.ownerWinid;){var y=E.getWinById(w.ownerWinid);if(y&&y.isVisible())w=y;else break}return w}function g(w){for(var y="";w;)w.titleInfo&&(y=w.titleInfo),w=E.getWinById(w.ownerWinid);return y}var n=[],H=[],z=0,E=this;this.mainWin=null;this.appId="";var C=0;this.getActiveWinId=function(){return C};this.setActiveWinId=function(w,y){svGlobal.logger.info("setActiveWinId: "+w+" old: "+C+" max: "+y);if(C!=w){var O=0==C;C=w;(w=E.getMainByWinId(w))&&w.isMainWin()&&E.mainWin!=
w&&(E.mainWin=w);O&&y&&(y=ea.getFocused())&&(y=y.getFreeSpace(),w=y.width,q.resetSize(w,y.height))}};this.onchange=function(w){w.isVisible()||w!=E.mainWin?w.isVisible()&&!E.mainWin&&w.isMainWin()&&(E.mainWin=w,3==a.windowState&&w.exeCommand(61488)):E.mainWin=null};this.addWin=function(w){for(var y=n.length,O=!1,r=0;r<y;r++)if(w.id==n[r].id){n[r]=w;O=!0;break}O||n.push(w);1==n.length&&(z=Date.now());y=w.isMainWin();svGlobal.logger.info("is mainwin:"+y+" id:"+w.id);y&&!E.mainWin&&(E.mainWin=w)};this.popWins=
function(w){w=E.getWinById(w);var y=[];if(w){w=0<w.ownerWinid?w.ownerWinid:w.id;for(var O=n.length-1;0<=O;O--)if(n[O].ownerWinid==w||n[O].id==w)y.push(n[O]),n.splice(O,1)}return y};this.hasApp=function(w){return-1!=H.indexOf(w)};this.addApp=function(w){return-1==H.indexOf(w)?(H.push(w),!0):!1};this.isNew=function(){return 3E4>Date.now()-z};this.getAll=function(){return n};this.hasWin=function(w){return 0<=n.indexOf(w)};this.close=function(){for(var w=0,y=n.length;w<y;w++)n[w].close()};this.clear=
function(){n.length=0};this.delWin=function(w){for(var y=0,O=n.length;y<O;y++)if(n[y].id==w)return n.splice(y,1),y;return-1};this.isRunning=function(){var w=n.length;if(1>w)return!1;var y=0;for(w=n.length;y<w;y++){var O=n[y];if(O.showState)return!0}return!1};this.getWinById=function(w){var y=n.length;if(1>y)return null;for(var O=0;O<y;O++){var r=n[O];if(r.id==w)return r}return null};this.getMainWinByAppId=function(w){var y=null,O=0;for(len=n.length;O<len;){y=n[O];if(y.appId==w&&y.isVisible()&&1>y.ownerWinid)break;
O++}return y};this.getTopWin=function(w){var y=null,O,r=w.length;for(O=0;O<r&&(!(y=E.getWinById(w[O]))||!y.isVisible());O++)y=null;if(!y)for(svGlobal.logger.warn("No win found"),r=n.length,O=r-1;0<=O&&(y=n[O],!y.isVisible());O--)y=null;return y};this.getMain=function(w){return(w=E.getTopWin(w))?d(w):null};this.getMainByWinId=function(w){return(w=E.getWinById(w))?d(w):null};this.getOtherApps=function(w,y,O){var r=n.length;if(0!=r&&n[r-1])if(r=n[r-1].appId,O||!r)setTimeout(function(){E.getOtherApps(w,
y)},O||3E3);else{O=[];if(r=E.getTopWin(w)){var D=0<r.ownerWinid?r.ownerWinid:r.id,K=[],u=0;for(r=n.length;u<r;u++)n[u].ownerWinid!=D&&n[u].id!=D&&n[u].isVisible()&&K.push(n[u]);u=0;for(r=K.length;u<r;u++)K[u].ownerWinid!=D&&K[u].id!=D&&(O.push({title:g(K[u]),win:d(K[u])}),D=0<K[u].ownerWinid?K[u].ownerWinid:K[u].id)}y(O)}};this.getFullTitle=function(w){for(var y,O="";;){y=E.getWinById(w);if(!y)break;y.titleInfo&&y.isVisible()&&(O&&(O=" > "+O),O=y.titleInfo+O);if(1>w)break;w=y.ownerWinid}return O}}
var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,g=0;g<d;g++)e[g].railWin&&e[g].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,g=Array(d),n=0;n<d;n++)e[n].configMonitor(),g[n]=e[n].getMousePosition();g.sort(function(E,C){var w=E.left-C.left;return 0!=w?w:E.top-C.top});var H=g.findIndex(function(E){return 0==E.left&&0==E.top});svGlobal.logger.info("monitor layout",g,H);-1==H&&(q.showMessage("* Primary monitor not found. Please make your browser window full screen."),
svGlobal.logger.warn("Primary monitor not found (left=top=0)",g));for(n=H-1;0<=n;){if(g[n].right<g[n+1].left){var z=g[n+1].left-g[n].right-1;0<z&&(g[n].right+=z,g[n].left+=z)}g[n].bottom<g[n+1].top&&(z=g[n+1].top-g[n].bottom-1,0<z&&(g[n].top+=z,g[n].bottom+=z));n--}for(n=H+1;n<d;)g[n-1].right<g[n].left&&(z=g[n].left-g[n-1].right-1,0<z&&(g[n].right-=z,g[n].left-=z)),g[n-1].bottom<g[n].top&&(z=g[n].top-g[n-1].bottom-1,0<z&&(g[n].top-=z,g[n].bottom-=z)),n++};this.repaint=function(d,g,n,H){for(var z=
0,E=e.length;z<E;z++)e[z].repaint(d,g,n,H)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var g=e.length,n=0;n<g;n++)if(e[n].equals(d))return!0;return!1};this.getMonitorSurface=function(d,g,n,H){var z=e.length;if(1==z)return e[0];for(var E=0;E<z;E++)if(e[E].isMonitor(d,g,n,H))return e[E];return null};this.fromSyncedSurface=function(d){var g=e.length;Date.now();for(var n=0;n<g;n++)if(e[n].isClipSynced(d))return!0;
return!1};this.setSize=function(d,g,n){for(var H=0,z=e.length;H<z;H++)e[H].setSize(d,g,n)};this.zOrders=[];this.drawLicense=function(d){for(var g=0,n=e.length;g<n;g++)e[g].drawLicense(d)};this.setReadOnly=function(d,g){for(var n=0,H=e.length;n<H;n++)e[n].setReadOnly(d,g)};this.setVisible=function(d,g){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var g=0,n=e.length;g<n;g++)e[g]&&e[g].setCursor(d)};this.hide=function(d){d=0;for(var g=e.length;d<g;d++)e[d]&&e[d].hide()};this.execute=
function(d,g){for(var n=0,H=e.length;n<H;n++)e[n][d].apply(e[n],g)};this.addWin=function(d){var g=this.getFocused();g||(svGlobal.logger.warn("Focused surface not found!"),g=e[e.length-1]);g?(Va=!0,g.railWin||(g.railWin=new c,g.onunload=function(){hi5.appcfg.closeRemoteApp&&g.railWin&&g.railWin.close();g.remoteApp&&g.remoteApp.close();g.railWin&&(g.railWin.clear(),g.railWin=null);e.removeElm(g)}),g.context&&b.setContext(g.context),g.railWin.addWin(d),g.railWin.mainWin==d&&(setTimeout(function(){var n=
g.getFreeSpace();a.writeRawInput("8C661441\t"+n.width+"\t"+n.height);svGlobal.logger.info("-- main win dp change:"+n.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&g.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var g,
n=e.length-1;0<=n;n--){var H=e[n];g=H.railWin;var z=g.getWinById(d),E=z&&z.appId&&-1!=z.appId.toLowerCase().indexOf("runonce");if(0<=g.delWin(d)){z==g.mainWin&&(g.mainWin=null);if(H.toolbar){d="win"+d;var C=H.toolbar.querySelector("#"+d);C&&H.toolbar.removeChild(C)}if(!g.isRunning()&&0==q.mode){if(z.isMainWin()&&H.onremoteappclose)H.onremoteappclose(z);z=a.appTimeout;if(E||g.isNew())z*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(w){return function(){svGlobal.logger.info("Start del:"+
Date.now());w.railWin&&w.railWin.isRunning()||(w.remoteApp&&w.remoteApp.close(),ea&&ea.delSurface(w))}}(H),z)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var g,n=0,H=e.length;n<H;n++)if(e[n]&&e[n].railWin&&(g=e[n].railWin.getWinById(d)))return g;return null};this.getMainWinByAppId=function(d){for(var g,n=0,H=e.length;n<H;n++)if(e[n].railWin&&(g=e[n].railWin.getMainWinByAppId(d)))return g;return null};this.onWinChange=function(d){for(var g,
n=0,H=e.length;n<H;n++)if(e[n].railWin&&(g=e[n].railWin.getWinById(d.id)))e[n].railWin.onchange(d)};this.setTitle=function(d){for(var g,n=0,H=e.length;n<H;n++)if(e[n].railWin){g=e[n].railWin.getWinById(d);var z=e[n].railWin.getFullTitle(d);if(z){a.changeTitle(z,e[n].getWindow(),g.appId);break}}};this.hasApp=function(d){for(var g=0,n=e.length;g<n;g++)if(e[g].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),
e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var g=0,n=e.length;g<n;g++)if(e[g].railWin&&e[g].railWin.hasWin(d))return e[g];return null};this.getOwnerSurfaceById=function(d){for(var g,n=0,H=e.length;n<H;n++)if(e[n].railWin&&(g=e[n].railWin.getWinById(d)))return e[n];return null};this.getFocused=function(){for(var d=e.length,g=0;g<d;g++)if(e[g].focused)return e[g];return e[d-1]};this.close=function(){for(var d=0,g=e.length;d<g;d++)e[d]&&(e[d].remoteApp&&
e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function g(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var n=this;this.resizable=function(){return n.isVisible?0!=(n.style&262144)||0!=(n.style&65536)||0!=(n.style&16777216)||3==n.showState:!1};this.setShowState=function(H){n.showState=H};this.parent=function(){return ea.getWinById(n.ownerWinid)};this.resize=function(H,z,E,C){svGlobal.logger.info("www resize, l "+H+" w "+E);hi5.appcfg.disableJoinedAppResize&&2==a.mode||
a.writeRawInput("8C1"+n.id+"\t"+H+"\t"+z+"\t"+E+"\t"+C)};this.exeCommand=function(H){svGlobal.logger.info("www exeCommand, cmd "+H);a.writeRawInput("8C4"+d+"\t"+H)};this.activate=function(H){svGlobal.logger.info("www activate, enable "+H+" id:"+d);2==n.showState?(n.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+H)},50)):a.writeRawInput("8C3"+d+"\t"+H)};this.close=function(){svGlobal.logger.info("www close");n.exeCommand(61536)};this.getAppId=g;this.isVisible=function(){return n.winWidth&&
n.winHeight&&n.showState&&45<n.winHeight&&45<n.winWidth};this.isMainWin=function(){if(!(n.isVisible()&&n.winWidth&&n.winHeight&&45<n.winHeight&&45<n.winWidth))return!1;var H=1>n.ownerWinid;if(!H)return H;var z=n.style;if(0!=(z&4194304))return!0;if(0!=(z&2147483648)&&(0==(z&8388608)||0==(z&12582912)))return!1;var E=0!=(n.extStyle&128);(H=H&&!E)&&0!=(z&2147483648)&&0==(z&2156396544)&&(H=!1);return H};g()}}(q,qa);this.getSurfaces=function(){return ea};this.hide=function(){ea&&ea.hide()};this.getFileUrl=
function(a,b,c){var e=va(),d=Xc,g=d.indexOf("://");e=(0<g&&11>g?d:e+d)+"s="+nc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return q.modifyURL(e)};this.listFiles=function(a,b){Ma&&Wa&&Ma.list(a,b)};this.writeRawInput=function(a){if(Wa){ua(a);if(q.onactivity)q.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);ua(e.buffer)};var Zc=0;if(ha.numLock||
ha.numlock||R(L.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Zc|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=
c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var g=d.getFreeSpace(),n=g.width;g=g.height;Ra.checkLockFlags=!0;ha.scale?d.scaleTo(n,g,!1):a.resetSize(n,
g)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,g){this.reqCopyTime=Date.now();var n=a.getGatewayAddr(),H=Yc,z=H.indexOf("://");n=(0<z&&11>z?H:n+H)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(n),g);this.reqCopyTime=Date.now();Rc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,g,n){a.reconnectOnResize=!1;var H=a.getFileUrl(d,g,n);q.ondownload&&q.ondownload({fileName:d,url:H,
source:g,action:n})||window.open(H)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return p};this.reconnect=function(d,g,n){L.symlink?(d="user="+d+"&pwd="+g,n&&(d+="&domain="+n),p=hi5.tool.replaceQuery(p,"parameters",d)):(p=hi5.tool.replaceQuery(p,"user",d),p=hi5.tool.replaceQuery(p,"pwd",g),p=hi5.tool.replaceQuery(p,"domain",n));a.run()};this.sendKeyboardSyncFlags=function(d,g){return Wa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},g||333),
!0):!1};this.sendKeyboardSynchronize=function(d,g,n){var H=0;n&&(H|=4);g&&(H|=2);d&&(H|=1);this.sendKeyboardSyncFlags(H)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,g){a.authWithCode(d,g)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(q,
Zc),Sd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,g){return a.repaint(c,e,d-c+1,g-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+c.id))}}(qa,ea);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new pb(143)};this.GatewayChannel=function(){return new pb(28)};
this.DynamicChannel=function(){return new pb(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Ea.names.push(a.name);Ea[a.name]=a;Ea.count++};var Sa=null,Ea={count:0,names:[],usbChannel:null,close:function(){for(var a=Ea.names,b=0,c=a.length;b<c;b++)Ea[a[b]].onclose&&(Ea[a[b]].onclose(),Ea[a[b]]=null);a.length=0;Ea.usbChannel=null},init:function(a,b,c,e,d,g){function n(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=
2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var r=this;this.fromBuffer=function(D,K){r.formatTag=D.getLittleEndian16();r.nChannels=D.getLittleEndian16();r.nSamplesPerSec=D.getLittleEndian32();r.nAvgBytesPerSec=D.getLittleEndian32();r.nBlockAlign=D.getLittleEndian16();r.bitsPerSample=
D.getLittleEndian16();var u=D.getLittleEndian16();r.cbSize=u;0<u&&!0!==K&&(r.extenstion=Array(u),D.copyToByteArray(r.extenstion,0,D.getPosition(),u),D.skipPosition(u))};this.toBuffer=function(D){D.setLittleEndian16(r.formatTag);D.setLittleEndian16(r.nChannels);D.setLittleEndian32(r.nSamplesPerSec);D.setLittleEndian32(r.nAvgBytesPerSec);D.setLittleEndian16(r.nBlockAlign);D.setLittleEndian16(r.bitsPerSample);D.setLittleEndian16(r.cbSize);0<r.cbSize&&D.setBytes(r.extenstion)};this.getSize=function(){return 18+
r.cbSize};this.toString=function(){return"Audio Format, tag="+r.formatTag+" nChannels="+r.nChannels+" nSamplesPerSec="+r.nSamplesPerSec+" nAvgBytesPerSec="+r.nAvgBytesPerSec+" nBlockAlign="+r.nBlockAlign+" bitsPerSample="+r.bitsPerSample+" cbSize="+r.cbSize}}function H(){Sa=new q.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(r){var D=r.getLittleEndian32();r.getLittleEndian32();switch(D){case 5:D=r.getLittleEndian32(),Sa.maxMonitorAreaFactorA=r.getLittleEndian32(),
Sa.maxMonitorAreaFactorB=r.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+D+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),r=new Uint8Array(2),r[0]=146,r[1]=4,ua(r.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(r,D){if(Sa.enabled){var K=new Uint8Array(56),u=new RdpBuffer(K,0,56);r=r>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:r&-4;D=D>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:
D&-4;u.setLittleEndian32(2);u.setLittleEndian32(56);u.setLittleEndian32(40);u.setLittleEndian32(1);u.setLittleEndian32(1);u.setLittleEndian32(0);u.setLittleEndian32(0);u.setLittleEndian32(r);u.setLittleEndian32(D);u.setLittleEndian32(.26458*r|0);u.setLittleEndian32(.26458*D|0);u.setLittleEndian32(r>D?0:90);u.setLittleEndian32(100);u.setLittleEndian32(100);Sa.send(K);svGlobal.logger.warn("Display control: "+r+"x"+D)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!ha.disableDVC){if(ha.enableEcho){var z=
new q.DynamicChannel;z.name="ECHO";z.process=function(r){var D=r.getPosition(),K=r.getEnd(),u=new Uint8Array(K-D);u.set(r.getData().subarray(D,K));z.send(u)};q.addDynamicChannel(z)}if(a){var E=new q.DynamicChannel;E.name="Microsoft::Windows::RDS::Input";E.process=function(r){var D=r.getLittleEndian16();r.getLittleEndian32();switch(D){case 1:r.skipPosition(4),r=new RdpBuffer(new Uint8Array(16),0,16),r.setLittleEndian16(2),r.setLittleEndian32(16),r.setLittleEndian32(3),r.setLittleEndian32(65536),r.setLittleEndian16(256),
r.markEnd(),E.send(r);case 5:ea.execute("setTouchRemoting",[!0]);Ea.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ea.execute("setTouchRemoting",[!1]),Ea.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};q.addDynamicChannel(E)}if(c){svGlobal.logger.warn("Audio input on");var C=new q.DynamicChannel;(function(){function r(x){var X=new RdpBuffer(new Uint8Array(5),0,5);X.setByte(7);X.setLittleEndian32(x);X.markEnd();C.send(X)}function D(x){var X=x.getLittleEndian32(),
ja=x.getLittleEndian32(),V=new n;V.fromBuffer(x,!0);var fa=0,la=0;0<V.cbSize&&(22==V.cbSize?(fa=x.getLittleEndian16(),la=x.getLittleEndian32(),x.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+V.cbSize),x.skipPosition(V.cbSize)));x=u[ja];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+X+" initial: "+ja+", "+x.toString());svGlobal.logger.info("Open fmt: "+V.toString()+" validBits:"+fa+" mask:"+la);N=!0;U=q.reconnectOnResize;q.reconnectOnResize=!1;pa.onopen||(pa.onopen=function(ta){if(Ha){K=
ta;q.reconnectOnResize=U;r(ja);var oa=new RdpBuffer(new Uint8Array(5),0,5);oa.setByte(4);oa.setLittleEndian32(ta?0:1);oa.markEnd();C.send(oa)}});pa.ondata||(pa.ondata=function(ta,oa){K&&(aa.length!=oa+1&&(aa=new Uint8Array(oa+1),aa[0]=6),C.send(P),aa.set(ta,1),C.send(aa))});pa.start(x,X)}C.name="AUDIO_INPUT";C.process=function(x){var X=x.getByte();switch(X){case 1:x=x.getLittleEndian32();X=new RdpBuffer(new Uint8Array(5),0,5);X.setByte(1);X.setLittleEndian32(x);X.markEnd();C.send(X);break;case 2:var ja=
x.getLittleEndian32();x.getLittleEndian32();var V=hi5.audio.getAudioContext().sampleRate;for(X=u.length=0;X<ja;X++){var fa=new n;fa.fromBuffer(x);svGlobal.logger.info("Server rec fmt "+X+":"+fa.toString());0==e&&49==fa.formatTag&&22050==fa.nSamplesPerSec?u.push(fa):1==fa.formatTag&&fa.nSamplesPerSec<=V&&u.push(fa)}C.send(P);ja=0;x=u.length;for(X=0;X<x;X++)ja+=u[X].getSize();V=new RdpBuffer(new Uint8Array(1024),0,1024);V.setByte(2);V.setLittleEndian32(x);V.setLittleEndian32(ja+9);for(X=0;X<x;X++)u[X].toBuffer(V),
svGlobal.logger.info("Client rec fmt: "+u[X].toString());V.skipPosition(1024-ja-9);V.markEnd();C.send(V);break;case 3:D(x);break;case 7:X=x.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+u[X].toString()+" by client:"+N);N||(r(X),N=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+X)}};var K=!1,u=[];C.onclose=function(){K=!1;pa&&pa.close()};var P=new Uint8Array(1);P[0]=5;var N=!1,U=q.reconnectOnResize,aa=new Uint8Array(0),S=sa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":
"audiorecorder.js?v=0"),pa=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),S):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();q.addDynamicChannel(C)}q.addDynamicChannel(function(){var r=new q.DynamicChannel;r.name="TSMF";var D={type:"image/jpeg"},K=Array(1);r.process=function(u){u.getPosition();var P=u.getLittleEndian32()&1073741823;var N=u.getLittleEndian32();var U=u.getLittleEndian32();switch(P){case 2:if(256==U){u.getLittleEndian32();U=new Uint8Array(16);
var aa=new RdpBuffer(U,0,16);aa.setLittleEndian32(2);aa.setLittleEndian32(N);aa.setLittleEndian32(1);aa.setLittleEndian32(0);r.send(U)}break;case 0:switch(U){case 257:u.getBytes(16);u.getLittleEndian32();break;case 256:P=u.getPosition();aa=u.getLittleEndian32();for(U=0;U<aa;U++){u.getLittleEndian32();var S=u.getLittleEndian32();u.getLittleEndian32();u.skipPosition(S-4)}U=u.getPosition()-P;aa=U+8+4;U=new Uint8Array(aa);aa=new RdpBuffer(U,0,aa);aa.setLittleEndian32(-2147483648);aa.setLittleEndian32(N);
U.set(u.getData().subarray(P,u.getPosition()),8);r.send(U);break;case 261:u.getBytes(16);u.getLittleEndian32();break;case 264:P=u.getLittleEndian32();u.skipPosition(4);u.getLittleEndian32();S=u.getBytes(16);var pa=u.getBytes(16);u.getLittleEndian32();u.getLittleEndian32();u.getLittleEndian32();var x=u.getBytes(16);U=u.getLittleEndian32();u.skipPosition(U);U=new Uint8Array(20);aa=new RdpBuffer(U,0,20);aa.setLittleEndian32(-2147483648);aa.setLittleEndian32(N);hi5.Arrays.equals([118,105,100,115,0,0,
16,0,128,0,0,170,0,56,155,113],S)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],pa)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],x)?aa.setLittleEndian32(1):(aa.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(S),svGlobal.logger.warn(pa),svGlobal.logger.warn(x));aa.setLittleEndian32(P);r.send(U);break;case 258:u.getBytes(16);u.getLittleEndian32();P=u.getLittleEndian32();u.skipPosition(P);break;case 263:u.getBytes(16),
U=new Uint8Array(16),aa=new RdpBuffer(U,0,16),aa.setLittleEndian32(-2147483648),aa.setLittleEndian32(N),aa.setLittleEndian32(1),r.send(U);case 277:u.getBytes(16);u.getLittleEndian32();break;case 262:u.getBytes(16);qa.flushImgs();qa.setImgRect(0,0,0,0);U=new Uint8Array(12);aa=new RdpBuffer(U,0,12);aa.setLittleEndian32(-2147483648);aa.setLittleEndian32(N);r.send(U);break;case 278:u.getBytes(16);N=u.getLittleEndian32();U=u.getLittleEndian32();P=u.getLittleEndian32();u=u.getLittleEndian32();qa.setImgRect(N,
U,P-N,u-U);break;case 265:u.getBytes(16);u.getLittleEndian64();u.getLittleEndian32();break;case 266:u.getBytes(16);break;case 268:u.getBytes(16);break;case 267:u.getBytes(16);break;case 269:u.getBytes(16);u.getLittleEndian32();break;case 274:break;case 275:break;case 259:u.getBytes(16);u.getLittleEndian32();u.getLittleEndian32();u.skipPosition(32);U=u.getLittleEndian32();N=new Image;P=u.getPosition();K[0]=u.getData().subarray(P,P+U);u=new Blob(K,D);N.src=URL.createObjectURL(u);qa.addImg(N);break;
case 270:qa.flushImgs();break;case 273:break;case 260:break;case 276:u.getBytes(16);U=u.getLittleEndian32();P=u.getPosition()+U;u.skipPosition(8);N=u.getLittleEndian32();svGlobal.logger.info("window state:"+N);aa=u.getLittleEndian32();S=u.getLittleEndian32();N=u.getLittleEndian32();U=u.getLittleEndian32();u.skipPosition(8);pa=u.getLittleEndian32();x=u.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+N+" top:"+U+" w:"+aa+" h:"+S+" cl:"+pa+" ct:"+x);u.setPosition(P);P=u.getLittleEndian32();
for(P=u.getPosition()+P;u.getPosition()<P;){pa=u.getLittleEndian32();x=u.getLittleEndian32();var X=u.getLittleEndian32(),ja=u.getLittleEndian32();svGlobal.logger.info("visible region, l:"+x+" t:"+pa+" r:"+ja+" b:"+X)}qa.setImgRect(N,U,aa,S);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+U)}break;default:svGlobal.logger.warn("unkown interface:"+P)}};return r}());kb||q.addDynamicChannel(H());ha.enableDVCAudio&&q.addDynamicChannel(function(r){var D=!1,K=0,u=0,P=0,N=0,U=[],
aa=new Uint8Array(4),S=new q.DynamicChannel;S.name="AUDIO_PLAYBACK_DVC";S.onclose=function(){};S.process=function(pa){function x(Y){Y.skipPosition(14);var da=Y.getLittleEndian16();Y.getByte();var ra=Y.getLittleEndian16();Y.skipPosition(1);for(var Na,k=U.length=0;k<da;k++){var l=new n;l.fromBuffer(Y);(Na=22050<=l.nSamplesPerSec&&(1==l.formatTag||49==l.formatTag&&22050==l.nSamplesPerSec&&0==r||41222==l.formatTag))&&U.push(l)}l=20;Y=U.length;for(k=0;k<Y;k++)l+=U[k].getSize();k=l+4;da=new RdpBuffer(new Uint8Array(k),
0,k);da.setByte(7);da.setByte(2);da.setLittleEndian16(l);da.setLittleEndian32(3);da.setLittleEndian32(4294967295);da.setLittleEndian32(0);da.setLittleEndian16(0);da.setLittleEndian16(Y);da.skipPosition(1);da.setLittleEndian16(ra);da.setByte(124);for(k=0;k<Y;k++)l=U[k],l.toBuffer(da);da.markEnd();S.send(da);5<ra&&(da=new RdpBuffer(new Uint8Array(8),0,8),da.setByte(12),da.skipPosition(1),da.setLittleEndian16(4),da.setLittleEndian16(0),da.setLittleEndian16(0),da.markEnd(),S.send(da))}function X(Y){var da=
Y.getLittleEndian16();Y=Y.getLittleEndian16();var ra=new RdpBuffer(new Uint8Array(8),0,8);ra.setByte(6);ra.setByte(35);ra.setLittleEndian16(4);ra.setLittleEndian16(da);ra.setLittleEndian16(Y);ra.markEnd();S.send(ra)}function ja(){var Y=U[P];if(Y.formatTag!=Ca.tag||Y.nSamplesPerSec!=Ca.samplePerSec||Ca.channels!=Y.nChannels)Ca.tag=Y.formatTag,Ca.channels=Y.nChannels,Ca.samplePerSec=Y.nSamplesPerSec,Ca.bitsPerSample=49==Y.formatTag?8:Y.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ca.tag+
" channels="+Ca.channels+" bitsPerSample="+Ca.bitsPerSample+" samplePerSec="+Ca.samplePerSec),41222==Ca.tag&&(Ca.sampleRate=Ca.samplePerSec,Ta.initMediaPlayer(Ta,Ca,!0))}function V(Y){u=Y.getLittleEndian16();P=Y.getLittleEndian16();N=Y.getByte();Y.skipPosition(3);aa.set(Y.getSubarray(4));D=!0;ja()}function fa(Y,da){var ra=new RdpBuffer(new Uint8Array(8),0,8);ra.setByte(5);ra.skipPosition(1);ra.setLittleEndian16(4);ra.setLittleEndian16(Y);ra.setByte(da);ra.skipPosition(1);ra.markEnd();S.send(ra)}function la(Y){D=
!1;var da=K-8,ra=Date.now();Y.copyFromByteArray(aa,0,Y.getPosition(),4);lc(Y,N,u,da);Y=u+(Date.now()-ra);fa(Y,N)}function ta(Y){var da=Date.now();u=Y.getLittleEndian16();P=Y.getLittleEndian16();N=Y.getByte();Y.skipPosition(7);ja();Y=lc(Y,N,u,0);Y*=1E3;da=u+(Date.now()-da)+Y;fa(da,N)}if(D)la(pa);else{var oa=pa.getByte();pa.skipPosition(1);K=pa.getLittleEndian16();switch(oa){case 7:x(pa);break;case 6:X(pa);break;case 2:V(pa);break;case 3:pa.getLittleEndian16();pa.getLittleEndian16();break;case 13:ta(pa)}}};
return S}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var w=svGlobal.DCVC_EXTENSION;w.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(r,D){svGlobal.logger.info("activate webcam");w.videoMedia.resolutions?r():hi5.video.resolutions(function(K){K.length?(w.videoMedia.resolutions=K,r()):D()})},deactivate:function(){var r=w.videoMedia;r.track&&(r.track.stop(),r.track=null);r.ctx=null;r.canvas=null;r.video=null;svGlobal.logger.info("deactivate cam")},
startStream:function(r,D,K,u,P){svGlobal.logger.info("startStream, width:"+r+" height:"+D+" frameRate:"+K);var N=w.videoMedia,U=N.track;if(U){var aa=U.getSettings();if("live"==U.readyState)if(r!=aa.width||D!=aa.height||K!=aa.frameRate&&2!=N.type)U.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==N.type?N.minFrameRate:K,width:{exact:r},height:{exact:D}}}).then(function(S){var pa=document.createElement("video");pa.srcObject=S;pa.play();if(window.OffscreenCanvas)var x=new OffscreenCanvas(100,
100);else x=document.createElement("canvas"),x.style.position="absolute",x.style.left=0,x.style.top=0;N.track=S.getVideoTracks()[0];N.canvas=x;N.ctx=x.getContext("2d");N.video=pa;S=N.track.getSettings();N.canvas.width=S.width;N.canvas.height=S.height;u()}).catch(function(S){svGlobal.logger.warn(S);P()})},stopStream:function(){svGlobal.logger.info("stopStream");var r=w.videoMedia;r.track&&"live"==r.track.readyState&&r.track.stop()},grabFrame:function(r){function D(u){u.arrayBuffer().then(r)}var K=
w.videoMedia;K.ctx.drawImage(K.video,0,0);K=K.canvas;K.convertToBlob?K.convertToBlob({type:"image/jpeg",quality:.6}).then(D):K.toBlob(D,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,
step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};w.WEBAUTHN=function(r){function D(){if(P){var N=Error("Cancelling existing WebAuthn API call for new one");N.name="WebAuthnAbortError";P.abort(N)}P=new AbortController;
return P.signal}function K(){if(P){var N=Error("Manually cancelling existing WebAuthn API call");N.name="WebAuthnAbortError";P.abort(N);P=void 0}}var u=new r;u.name="WebAuthN_Channel";u.newInstance=function(){return w.WEBAUTHN(r)};u.onopen=function(){svGlobal.logger.info("webAuthn open")};u.onclose=function(){svGlobal.logger.info("webAuthn close")};var P=null;u.process=function(N){var U=N.getEnd()-N.getPosition();N=N.getBytes(U);var aa=Hb(N),S=aa.command;U=aa.flags;N=aa.timeout;var pa=aa.webAuthNPara;
if(S)switch(console.log("==== command: "+aa.command),S){case 5:if(aa.request)switch(S=aa.request[0],console.log("==== webAuth cmdType = "+S),console.log("==== webAuth request bytes: "+tb(aa.request.slice(1,aa.request.length))),S){case 1:aa=aa.request.slice(1,aa.request.length);var x=Hb(aa);aa=x[1];var X=x[2],ja=x[3],V=x[4],fa=x[5];S=x[6];var la=x[7];x={};var ta=yd(pa);ta&&(ta.attestation&&(x.attestation=ta.attestation),ta.attestationFormats&&(x.attestationFormats=ta.attestationFormats));if(U=xd(U,
pa,la))x.authenticatorSelection=U;x.challenge=aa;fa&&(x.excludeCredentials=Dc(fa));x.rpId=X.id;x.rp=X;x.extensions=S?S:{};x.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};V&&(x.pubKeyCredParams=V);N&&(x.timeout=N);x.user=ja;N={};N.signal=D();N.publicKey=x;navigator.credentials.create(N).then(function(oa){zd(oa.response,X).then(function(Y){var da={},ra={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",
devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},Na=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);ra.aaGuid=Na.buffer;ra.residentKey=!0;da.deviceInfo=ra;da.status=0;da.response=Y;Y=CBOR.encode(da);da=new hi5.DataBuffer(new Uint8Array(4+Y.byteLength));da.setLittleEndian32(0);da.setBytes(Y);da.markEnd();u.send(da)})}).catch(function(oa){console.log("WebAuthN MakeCredential failed with error code ["+oa.code+"], msg: "+
oa.message);oa=new hi5.DataBuffer(new Uint8Array(4));oa.setLittleEndian32(1);oa.markEnd();u.send(oa)});break;case 2:aa=aa.request.slice(1,aa.request.length);x=Hb(aa);aa=x[2];ja=x[3];S=x[4];la=x[5];x={};ja&&(x.allowCredentials=Dc(ja));x.challenge=aa;S&&(x.extensions=S);x.rp=window.location.hostname;N&&(x.timeout=N);if(N=Cc(U,pa,la))x.userVerification=N;N={};N.signal=D();N.publicKey=x;navigator.credentials.get(N).then(function(oa){oa=new hi5.DataBuffer(new Uint8Array(void 0));oa.markEnd();u.send(oa)}).catch(function(oa){console.log("WebAuthN GetAssertion failed with error code ["+
oa.code+"], msg: "+oa.message);oa=new hi5.DataBuffer(new Uint8Array(4));oa.setLittleEndian32(1);oa.markEnd();u.send(oa)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+S)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:N=new hi5.DataBuffer(new Uint8Array(8));N.setLittleEndian32(0);U=Bc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;U?N.setLittleEndian32(1):N.setLittleEndian32(0);N.markEnd();u.send(N);break;
case 7:K();N=new hi5.DataBuffer(new Uint8Array(4));N.setLittleEndian32(0);N.markEnd();u.send(N);break;case 8:N=new hi5.DataBuffer(new Uint8Array(8));N.setLittleEndian32(0);N.setLittleEndian32(4);N.markEnd();u.send(N);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+S)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return u};q.enableWebAuthn()&&Bc()&&(a=w.WEBAUTHN(q.DynamicChannel),q.addDynamicChannel(a));w.WEBCAM=function(r){var D=new r;D.name="RDCamera_Device_0";
D.version=2;D.newInstance=function(){return w.WEBCAM(r)};D.onopen=function(){svGlobal.logger.info("cam open")};D.onclose=function(){svGlobal.logger.info("cam close")};D.sendSucess=function(){var K=new hi5.DataBuffer(new Uint8Array(2));K.setByte(D.version);K.setByte(1);K.markEnd();D.send(K)};D.sendError=function(K){var u=new hi5.DataBuffer(new Uint8Array(6));u.setByte(D.version);u.setByte(2);u.setLittleEndian32(K||1);u.markEnd();D.send(u)};D.sendSteamListResp=function(){var K=new hi5.DataBuffer(new Uint8Array(7));
K.setByte(D.version);K.setByte(10);K.setLittleEndian16(1);K.setByte(1);K.setByte(1);K.setByte(0);K.markEnd();D.send(K)};D.sendMediaTypeListResp=function(K){var u=w.videoMedia.resolutions,P=u.length,N=new hi5.DataBuffer(new Uint8Array(2+26*P));N.setByte(D.version);N.setByte(12);for(var U=1==K,aa=0;aa<P;aa++){N.setByte(K);var S=u[aa];N.setLittleEndian32(S.width);N.setLittleEndian32(S.height);N.setLittleEndian32(U?S.frameRate:w.videoMedia.minFrameRate);N.setLittleEndian32(1);N.setLittleEndian32(1);N.setLittleEndian32(1);
N.setByte(1)}N.markEnd();D.send(N)};D.sendCurrentMediaType=function(K,u){var P=new hi5.DataBuffer(new Uint8Array(28));P.setByte(D.version);P.setByte(14);u=w.videoMedia.resolutions[u];P.setByte(K);P.setLittleEndian32(u.width);P.setLittleEndian32(u.height);P.setLittleEndian32(1==K?u.frameRate:w.videoMedia.minFrameRate);P.setLittleEndian32(1);P.setLittleEndian32(1);P.setLittleEndian32(1);P.setByte(1);P.markEnd();D.send(P)};D.sendSampleResp=function(K){w.videoMedia.grabFrame(function(u){var P=new hi5.DataBuffer(new Uint8Array(u.byteLength+
3));P.setByte(D.version);P.setByte(18);P.setByte(K);P.setBytes(new Uint8Array(u));P.markEnd();D.send(P)})};D.sendPropertyListResp=function(){for(var K=0,u,P,N=w.videoMedia.propertyList,U=0;2>U;U++){P=N[U];u=P.length;for(var aa=0;aa<u;aa++)null!=P[aa]&&K++}var S=new hi5.DataBuffer(new Uint8Array(2+19*K));S.setByte(D.version);S.setByte(21);for(U=0;2>U;U++)for(P=N[U],u=P.length,aa=0;aa<u;aa++)K=P[aa],null!=K&&(S.setByte(U+0),S.setByte(K.propertyId),S.setByte(K.capabilities),S.setLittleEndian32(K.min),
S.setLittleEndian32(K.max),S.setLittleEndian32(K.step),S.setLittleEndian32(K.default));S.markEnd();D.send(S)};D.sendPropertyValueResp=function(K,u){(K=w.videoMedia.propertyList[K][u-1])?(u=new hi5.DataBuffer(new Uint8Array(7)),u.setByte(D.version),u.setByte(23),u.setByte(1),u.setLittleEndian32(K.value||K.default),u.markEnd(),D.send(u)):D.sendError(8)};D.process=function(K){K.getByte();var u=K.getByte();switch(u){case 7:w.videoMedia.activate(D.sendSucess,D.sendError);break;case 8:w.videoMedia.deactivate();
D.sendSucess();break;case 9:D.sendSteamListResp();break;case 11:K=K.getByte();0!=K&&svGlobal.logger.warn("Invalid stream index: "+K);D.sendMediaTypeListResp(w.videoMedia.type);break;case 13:K=K.getByte();D.sendCurrentMediaType(w.videoMedia.type,K);break;case 15:K.getByte();u=K.getByte();if(u!=w.videoMedia.type){svGlobal.warn("Invalid video format req:"+u);D.sendError(6);break}u=K.getLittleEndian32();var P=K.getLittleEndian32();K=K.getLittleEndian32()/K.getLittleEndian32();w.videoMedia.startStream(u,
P,K,D.sendSucess,D.sendError);break;case 16:w.videoMedia.stopStream();D.sendSucess();break;case 17:K=K.getByte();0!=K&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+K);D.sendSampleResp(K);break;case 20:D.sendPropertyListResp();break;case 22:u=K.getByte();K=K.getByte();D.sendPropertyValueResp(u,K);break;case 24:D.sendError(10);break;default:D.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+u)}};return D};w.WEBCAM_ENUM=function(r,D){var K=new r;K.name="RDCamera_Device_Enumerator";
K.onopen=function(){var u=new hi5.DataBuffer(new Uint8Array(2));u.setByte(D.version);u.setByte(3);u.markEnd();K.send(u);svGlobal.logger.info("camEnum open")};K.onclose=function(){svGlobal.logger.info("camEnum closed");w.videoMedia.deactivate()};K.addDevice=function(u){u+="\x00";var P=D.name+"\x00",N=new hi5.DataBuffer(new Uint8Array(2+2*u.length+P.length));N.setByte(D.version);N.setByte(5);N.setUnicodeString(u);N.setAscllString(P);N.markEnd();K.send(N)};K.process=function(u){var P=u.getByte();u=u.getByte();
switch(u){case 4:svGlobal.logger.info("camEnum ver resp: "+P);D.version=P;K.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+u)}};return K};d&&(d=w.WEBCAM(q.DynamicChannel),a=w.WEBCAM_ENUM(q.DynamicChannel,d),q.addDynamicChannel(a),q.addDynamicChannel(d));g&&(svGlobal.logger.info("Mapping USB..."),q.addDynamicChannel(Ea.usbChannel));if(b&&w.GFX){var y=function(){O.drawable.resumePlay||(O.drawable.resumePlay=function(){Ta&&
Ta.supportWebAudio&&Ta.iOSFix();O.resumeVideo()})},O=w.GFX(q.DynamicChannel,R(L.remotefx)&&!R(L.gfx),0==q.mode,qa,L.hardwareAcceleration);O.onmessage=function(r){q.showMessage(r)};y();O.onuserinteract=function(r){ea.execute("showPlay");y();svGlobal.logger.info("resumePlay");return!0};O.onfatalerror=function(r,D){q.reconnect(r.width,r.height,!0)};O.onsps=function(r){r.fps&&q.setFPS(r.fps)};O.onresetgraphic=function(r){q.setResolution(r.width,r.height)};O.onmapsurface=function(r){O.onconfirm();var D=
ea.getMonitorSurface(r.outputOriginX,r.outputOriginY,r.targetWidth+r.outputOriginX-1,r.targetHeight+r.outputOriginY-1);D?(D.setId(r.id),D.setSize(r.targetWidth,r.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+r.outputOriginX+" y:"+r.outputOriginY)};O.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ea.execute("setDrawable",[O.drawable])};q.addDynamicChannel(O)}}}},db=null;svGlobal.DCVC_EXTENSION&&!kb&&(q.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ea.usbChannel=
svGlobal.DCVC_EXTENSION.WEBUSB(q.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(q.GatewayChannel),q.addGatewayChannel(db)));this.getPrinters=function(a){if(!q.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();q.onagentmessage(b.getData());db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,q)};this.showError=Gb;this.resetStatus=bc;this.exeAppCmd=function(a){var b=ea.getFocused();
b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ea.getWinById(a):ea.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ha.forceReconnect||!1);if(!Ha&&!c)return!1;L.minWidth&&a<L.minWidth&&(a<L.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+L.minWidth),a=L.minWidth);L.minHeight&&b<L.minHeight&&(b<L.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+
L.minHeight),b=L.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ja)&&4>Math.abs(b-Ka))return!1;if(Sa&&Sa.enabled&&!1!==ha.displayVC)Sa.applyResolution(a,b);else if(pc&&qb||c||Wa&&!pc)qb=!1,svGlobal.logger.info("reconnecting..."),ua("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ua(a)};this.getUploadManager=function(){return Ma};this.setFPS=function(a){ea.execute("setFPS",[a])};this.addSurface=function(a){if(!ea.hasSurface(a)&&
(Lb||qa.setContext(a.context),!ea.hasSurface(a)||!a.railWin)){kb&&a.setPlayerMode();L.mouseMoveEmu&&(a.mouseMoveEmu=R(L.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ja&&(Ja=b.width);0==Ka&&(Ka=b.height);a.setConfig(ha);ea.addSurface(a);Oa(Ja,Ka,!0,L.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Sd);a.setTouchpad(R(L.touchpad));var c=b=R(L.mapClipboard),e=b;void 0!=L.copyToLocal?c=R(L.copyToLocal):void 0!=ha.copyToLocal&&(c=ha.copyToLocal);void 0!=L.copyToRemote?e=R(L.copyToRemote):
void 0!=ha.copyToRemote&&(e=ha.copyToRemote);a.setClipboard(b,c,e);Kb&&cc(a);L.invitation&&!R(L.control)&&(ea.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=L.ctrlToWin?R(L.ctrlToWin):void 0!=ha.ctrlToWin?ha.ctrlToWin:!0;c=void 0!=L.cmdToCtrl?R(L.cmdToCtrl):void 0!=ha.cmdToCtrl?ha.cmdToCtrl:!0;a.run(parseInt(L.keyboard||1033,10),b,!!ha.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ea.size();b<c;b++)ea.getSurface(b).railWin.getMain(ea.zOrders)&&
a.push(ea.getSurface(b).railWin.getMain(ea.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ua("8C2"+a+"\t"+b+"\t"+c);var e=ea.getSurface(ea.size()-1);e&&(e.remoteApp=new Ac(a,b,c))};this.startExitingApp=function(a){a=ea.popWins(a);for(var b=a.length-1;0<=b;b--)ea.addWin(a[b])};var wb=new q.DynamicChannel;wb.name="PNPDR";wb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};wb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),
a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),wb.send(a)}};wb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};q.addDynamicChannel(wb);var gb=null;R(L.scanner)&&(gb=new q.DynamicChannel,gb.name="SCANNERDVC",gb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},gb.process=function(a){var b=a.getByte();switch(b){case 0:var c=
a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(q.onagentmessage)q.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(q.onagentmessage)q.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(q.onagentmessage)q.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+
b+'" received from DVC, ignored.')}},gb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(q.onagentmessage)q.onagentmessage(a)},q.addDynamicChannel(gb));var ab=null;q.hasSmartCard()&&(ab=new q.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(q.onagentmessage)q.onagentmessage(a);R(L.passwordIsPin)&&q.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",
type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(q.onagentmessage)q.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;xb&&(b+=xb.length);eb&&(b+=eb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);xb?(b.setLittleEndian32(xb.length),b.setBytes(xb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);
b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(q.onagentmessage)q.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(q.onagentmessage)q.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(ab)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),q.onagentmessage)q.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(q.onagentmessage)q.onagentmessage(a)},q.addGatewayChannel(ab));ha.detectNetwork&&(p+="&connectType=7",Cd());this.getNetworkResult=function(){return Ib};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":
-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var dc=new Map,ec=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:dc.clear();ec.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,
!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':
'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var n=b.getLittleEndian32();n=b.getAscllString(n,!1);var H=b.getLittleEndian32();b.getAscllString(H,!1);H=b.getLittleEndian64();H=(new Date(1E3*H)).toDateString();d=Dd(a,d,n,g,H);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");
a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var z,E=document.querySelector('input[name="scard_name"]:checked');E&&(z=parseInt(E.value));xb=dc.get(z);rb=ec.get(z);z=document.getElementById("userPin").value;eb=(new TextEncoder("utf-8")).encode(z);z=2;z=eb?z+4+eb.length:z+4;z=rb?z+4+rb.length:z+4;z=new Uint8Array(z);z=new hi5.DataBuffer(z);z.setByte(1);z.setByte(2);
eb?(z.setLittleEndian32(eb.length),z.setBytes(eb)):z.setLittleEndian32(0);rb?(z.setLittleEndian32(rb.length),z.setAsciiString(rb,rb.length)):z.setLittleEndian32(0);ab&&ab.send(z)};document.getElementById("userPin").addEventListener("keypress",function(z){"Enter"===z.key&&(z.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),
a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(gb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),
e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){q.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){q.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,q.onagentmessage)q.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Ed(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var z=0,E=document.querySelector('input[name="ds_name"]:checked');E&&(z=E.value);
E=new Uint8Array(3);E[0]=4;E[1]=5;E[2]=z;if(q.onagentmessage)q.onagentmessage(E)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));b.getLittleEndian16();q.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=q.getAgentLink(),hi5.notifications.notify({title:b,
html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)g=b.getLittleEndian32(),d=b.getUnicodeString(g),g=b.getLittleEndian32(),g=b.getUnicodeString(g),c.push({name:d,driver:g});db&&db.listCallback&&(db.listCallback(c),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var xb,eb,rb,hc=
{type:6,data:null};this.setAgentStatus=function(a){Vc=a};this.getAgentStatus=function(){return Vc};this.run=function(){var a;if(a=null==q.onagentmessage)a=1==q.mode?!1:q.hasSmartCard()||q.hasScanner()||R(L.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(q):(q.hasUSB()?ea.getFocused().requestUsbDevices(q.getUSB(),function(b){Ea.usbChannel.openDevices(b);fc()}):fc(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return qa};this.mouseDown=function(a,b,c){Wa&&ua("80"+a+"\t"+
b+"\t"+c)};this.mouseMove=function(a,b){Wa&&ua("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Wa&&ua("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Wa&&ua("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Wa&&("number"==typeof a?(ua("840\t"+a),ua("8449152\t"+a)):ua("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){q.reconnectOnResize&&(Va?(nb&&(clearTimeout(nb),nb=0),a&=-4,b&=-4,nb=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){q.writeRawInput("8C661441\t"+
a+"\t"+b);3==q.windowState&&Tc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):q.running()&&(nb&&(clearTimeout(nb),nb=0),nb=setTimeout(function(){document.hidden||q.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!q.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Yb,b[4]=Yb>>8,b[5]=Xb,b[6]=Xb>>8,b[7]=Zb,b[8]=Zb>>8,b[9]=$b,b[10]=$b>>8);ua(b.buffer);return!0};this.refreshOutput=
function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ua(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ua(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||(Qa=new hi5.tool.ResponseMonitor(function(){Wa&&q.sendPing()},function(){if(Wa&&q.onnoresponse)return q.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;
ua(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));La?La.postMessage({type:0,cmd:6,start:1}):(Ba.onSlowPath=Ba.onFastPath=Kc,Ba.onReqHistory=function(){Kc(15555)})};this.stopPing=function(){Qa&&Qa.stop();La?La.postMessage({type:0,cmd:6,start:0}):Ba.onSlowPath=Ba.onFastPath=Ba.onReqHistory=null};var Ya=null,Qc=0;this.play=function(){ua("F3")};this.pause=function(){ua("F2")};this.scan=function(a){ua("F4"+(a?"1":"0"))};this.seek=function(a){var b=ea.getFocused();b&&Ha&&(ua("F4"+(a?"1":"0")+
"\t"+(a/b.getScale().x|0)),qa.pause(!0))};var Ca={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Pc=!1;this.showMessage=function(a,b,c){q&&q.displayMsg&&a&&((b=
b||ea.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(){svGlobal.logger.info("closing...");Ha&&Va&&ea&&ha.closeRemoteApp&&ea.tryCloseRemoteApps();qa&&qa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Sc,2222)):Sc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(q.close):window.addEventListener("unload",q.close,!1);Mb.searchStartCode=
function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};qc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Nb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Nb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||
(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d){function g(x,X,ja,V){this.pixels=x;this.width=X;this.height=ja;this.key=V}function n(){this.bottom=this.right=this.top=this.left=0;this.read=function(x){this.left=x.getLittleEndian16();this.top=x.getLittleEndian16();this.right=x.getLittleEndian16();this.bottom=x.getLittleEndian16()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function H(){this.qualityVal=
this.p=this.qb=0;this.read=function(x){var X=x.getByte();this.qp=X&63;this.p=X>>7&1;this.qualityVal=x.getByte()}}function z(x,X,ja){this.bitstream=x;this.regionRects=X;this.isChroma=ja;this.timestamp=0}function E(x,X,ja){this.width=x;this.height=X;this.monitors=ja}function C(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(x){this.left=x.getLittleEndian32();this.top=x.getLittleEndian32();this.right=x.getLittleEndian32();this.bottom=x.getLittleEndian32();this.flags=x.getLittleEndian32()};
this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function w(x,X,ja,V){function fa(){var h=[],f=0;this.push=function(t){h.push(t)};this.getRects=function(t){for(var v=h.length;f<v;f++)if(h[f].timestamp==t)return t=h[f].rects,999<f&&(h.splice(0,f+1),f=0),t;return null}}function la(){ra=!1;Na.drawable=Y._video;Y._player=ta?new Qd(Y,!1,V):new Nb(Na.drawable,Y,!1);Y._player.onsps=function(h){ta&&(Y._video.width=h.width,
Y._video.height=h.height);Y.onsps&&Y.onsps(h)};Y._player.onerror=function(h){Y.onfatalerror&&Y.onfatalerror(Y,h)};Y._player.onplayerror=function(h){function f(){Na={drawable:Y._video};Y.player.play(!0)}Na=null;if((!Y.onuserinteract||!Y.onuserinteract(f,"video"))&&Y.onmessage)Y.onmessage({msg:"Please click Yes to continue.<br>"+h,cbYes:function(){Y.player.play(!0);this.destroy()}})};Y._player.onframedecoded=function(h){var f=l.getRects(h.timestamp),t=f.length;if(0<t)for(var v=0;v<t;v++){var A=f[v],
B=A.right-A.left,F=A.bottom-A.top;oa.drawImage(h,A.left,A.top,B,F,A.left,A.top,B,F)}else console.warn("No region rects"),oa.drawImage(h,0,0)}}this.id=x;this.width=X;this.height=ja;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=X;this.targetHeight=ja;this._player=null;var ta="no-decoder"==V?!1:!!window.VideoDecoder;this._video=ta?new OffscreenCanvas(X,ja):document.createElement("video");var oa=ta?this._video.getContext("2d"):null,Y=this,da=null,ra=!0,Na={drawable:null},
k=10,l=null;ta&&(l=new fa,svGlobal.logger.info("...MediaDecoder in use: "+V));this.resumeVideo=function(){Y._player&&Y._player.play(!0)};this.setDisplayBuffer=function(h){da=h};this.draw=function(h,f,t,v){return ra?da.draw(h,f,t,v):Na};this.processAvc=function(h){ra&&la();if(ta)l.push({timestamp:k,rects:h.regionRects}),h.timestamp=k,k+=10;else if(h.isChroma)return;Y.onvideoframe(h)};this.reset=function(h,f){Y&&Y._player&&Y._player.reset()};this.close=function(){Y&&Y._player&&(Y._player.close(),Y._player=
null);Y=null};this.setRGBs=function(h,f,t,v,A,B,F){da.setRGBs(h,f,t,v,A,B,F)};this.getRGBs=function(h,f,t,v){return da.getRGBs(h,f,t,v)};this.moveArea=function(h,f,t,v,A,B){da.moveArea(h,f,t,v,A,B)};this.fillRect=function(h,f,t,v,A){da.fillRect(h,f,t,v,A)};this.postPaint=function(h,f,t,v){ra&&da.postPaint(h,f,t,v)}}function y(x,X,ja,V){var fa=new w(x,X,ja,d);fa.pixelFormat=V||33;fa.setDisplayBuffer(e);pa.push(fa);S.oncreatesurface&&S.oncreatesurface(fa);svGlobal.logger.info("create surface id:"+x+
" w:"+X+" h:"+ja+" pixelFmt:"+fa.pixelFormat);return fa}function O(x,X,ja){for(var V=x.getPosition(),fa=x.getLittleEndian32(),la=Array(fa),ta=0;ta<fa;ta++){var oa=new n;oa.read(x);la[ta]=oa}oa=Array(fa);for(ta=0;ta<fa;ta++){var Y=new H;Y.read(x);oa[ta]=Y}x=x.getBytes(X-(x.getPosition()-V));return new z(x,la,ja)}function r(x,X,ja,V){ja=x.getLittleEndian32();var fa=ja>>>30;ja&=1073741823;switch(fa){case 0:var la=O(x,ja,!1);var ta=O(x,X-ja-4,!0);break;case 1:la=O(x,ja,!1);break;case 2:X=x.getEnd()-x.getPosition();
ta=O(x,X,!0);break;default:throw Error("Invalid LC: "+fa);}la&&V.processAvc(la);ta&&V.processAvc(ta)}function D(x){var X=x.getLittleEndian32(),ja=x.getLittleEndian32();x=x.getLittleEndian32();var V=!1;switch(X){case 524292:V=!1;0==(x&1)&&(P=new ClearDecoder);break;case 524549:(V=0!=(x&16))||0!=(x&1)||(P=new ClearDecoder);break;default:V=0==(x&32)}e.onGetGfxHistory=function(fa,la){var ta=K.toPDU();ta&&fa(ta);la();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(fa,la){svGlobal.logger.info("Set GFX Histroy");
10==fa?K.fromStream(la):svGlobal.logger.error("Invalid GFX histroy type: "+fa)};svGlobal.logger.info("Gfx Cap, Ver:"+X.toString(16)+" len:"+ja+" flags:"+x+" h264:"+V);S.onconfirm&&S.onconfirm();return V}var K=new function(){function x(f,t,v,A,B){this.len=f;this.code=t;this.valueBits=v;this.type=A;this.vbase=B}function X(f){var t=25E5-la,v=f.length;if(t>=v)fa.set(f,la),la=t>v?la+v:0;else if(25E5>=v)fa.set(f.subarray(0,t),la),fa.set(f.subarray(t),0),la=v-t;else{t=(v-t)%25E5;var A=v-t,B=f.subarray(A);
f=f.subarray(v-25E5,A);fa.set(f,25E5-f.length);fa.set(B,0);la=t}}function ja(f){for(;ra<f;)da<<=8,Na<l?da+=k[Na++]:console.log("--- end"),ra+=8;Y-=f;ra-=f;f=da>>ra;da&=(1<<ra)-1;return f}var V=[new x(1,0,8,0,0),new x(5,17,5,1,0),new x(5,18,7,1,32),new x(5,19,9,1,160),new x(5,20,10,1,672),new x(5,21,12,1,1696),new x(5,24,0,0,0),new x(5,25,0,0,1),new x(6,44,14,1,5792),new x(6,45,15,1,22176),new x(6,52,0,0,2),new x(6,53,0,0,3),new x(6,54,0,0,255),new x(7,92,18,1,54944),new x(7,93,20,1,317088),new x(7,
110,0,0,4),new x(7,111,0,0,5),new x(7,112,0,0,6),new x(7,113,0,0,7),new x(7,114,0,0,8),new x(7,115,0,0,9),new x(7,116,0,0,10),new x(7,117,0,0,11),new x(7,118,0,0,58),new x(7,119,0,0,59),new x(7,120,0,0,60),new x(7,121,0,0,61),new x(7,122,0,0,62),new x(7,123,0,0,63),new x(7,124,0,0,64),new x(7,125,0,0,128),new x(8,188,20,1,1365664),new x(8,189,21,1,2414240),new x(8,252,0,0,12),new x(8,253,0,0,56),new x(8,254,0,0,57),new x(8,255,0,0,102),new x(9,380,22,1,4511392),new x(9,381,23,1,8705696),new x(9,382,
24,1,17094304)],fa=new Uint8Array(25E5),la=0,ta=new Uint8Array(65536),oa=0,Y=0,da=0,ra=0,Na=0,k=null,l=0,h=!0;this.toPDU=function(){if(h)return null;var f=new Uint8Array(2500008);f[0]=29;f[2]=1;f[3]=10;f[4]=la;f[5]=la>>8;f[6]=la>>16;f[7]=la>>24;f.set(fa,8);return f};this.fromStream=function(f){la=f.getLittleEndian32();fa.set(f.getSubarray(25E5))};this.decompress=function(f,t){if(t){k=f;h&&(h=!1);l=k.length-1;Y=8*l-k[l];for(oa=Na=ra=da=0;0<Y;)for(var v=t=0,A=0;A<V.length;A++){for(f=V[A];t<f.len;)v=
(v<<1)+ja(1),t++;0>v&&console.log("xxx inPrefix");if(v==f.code){if(0==f.type)f=f.vbase+ja(f.valueBits),(0>f||255<f)&&console.log("xxx do c"),f&=255,fa[la]=f,25E5==++la&&(la=0),ta[oa++]=f;else if(t=ja(f.valueBits),t=f.vbase+t,0>t&&console.log("xxx distance"),0!=t){if(0==ja(1))f=3;else{f=4;for(v=2;1==ja(1);)f*=2,v++;f+=ja(v)}t=25E5-t+la;t%=25E5;v=t+f;if(Math.abs(la-t)>=f&&25E5>v&&25E5>la+f)t=fa.subarray(t,v),fa.set(t,la),la+=f,ta.set(t,oa),oa+=f;else for(;0<f;)v=fa[t],25E5==++t&&(t=0),fa[la]=v,25E5==
++la&&(la=0),ta[oa++]=v,f--}else f=ja(15),Y-=ra,da=ra=0,t=k.subarray(Na,Na+f),X(t),ta.set(t,oa),Na+=f,oa+=f,Y-=8*f;break}}65536<oa&&console.error("xx outputIndex:"+oa);return ta.subarray(0,oa)}X(f);return f}},u=new function(){this.process=function(x){var X=x.getByte();if(224==X){var ja=0!=(x.getByte()&32);var V=x.getPosition(),fa=x.getEnd();X=K.decompress(x.getData().subarray(V,fa),ja);x.setPosition(fa)}else{225!=X&&console.log("Invalid descriptor:"+X);fa=x.getLittleEndian16();var la=x.getLittleEndian32();
X=new Uint8Array(la);for(var ta=0,oa,Y=0;Y<fa;Y++)oa=x.getLittleEndian32(),ja=0!=(x.getByte()&32),oa--,V=x.getPosition(),ja=K.decompress(x.getData().subarray(V,V+oa),ja),X.set(ja,ta),ta+=ja.length,x.skipPosition(oa);ta!=la&&console.error("wrong size, actual:"+ta+" expected:"+la)}return new RdpBuffer(X,0,X.length)}},P=null,N=new rdpcodecs.RemoteFX(!1),U=0,aa=[],S=new a;S.name="Microsoft::Windows::RDS::Graphics";var pa=new function(x,X){var ja=[];this.push=function(V){V.osps=x.onsps;V.onfatalerror=
x.onfatalerror;V.onplayerror=x.onplayerror;V.onuserinteract=x.onuserinteract;V.onmessage=x.onmessage;ja[V.id]=V};this.get=function(V){return ja[V]};this.getAll=function(){return ja};this.delete=function(V){var fa=ja[V];fa&&(fa.onsps=null,fa.onfatalerror=null,fa.onplayerror=null,ja[V]=null)};this.reset=function(V){V=0;for(var fa=ja.length;V<fa;V++)ja[V]&&ja[V].reset()};this.close=function(){for(var V=0,fa=ja.length;V<fa;V++)ja[V]&&ja[V].close()};this.resumeVideo=function(){for(var V=0,fa=ja.length;V<
fa;V++)ja[V]&&ja[V].resumeVideo()}}(S,e);S.drawable=new function(){this.draw=function(x,X,ja,V,fa){return(fa=pa.get(fa))?fa.draw(x,X,ja,V):null};this.getSurfaces=function(){return pa};this.onfocus=function(x){};this.resumePlay=null};S.resumeVideo=function(){pa.resumeVideo()};S.process=function(x){for(var X=u.process(x);X.has(8);){var ja=X.getLittleEndian16();X.getLittleEndian16();var V=X.getLittleEndian32(),fa=X.getPosition()+V-8;switch(ja){case 1:var la=X,ta=la.getLittleEndian16(),oa=la.getLittleEndian16(),
Y=la.getByte(),da=la.getLittleEndian16(),ra=la.getLittleEndian16(),Na=la.getLittleEndian16(),k=la.getLittleEndian16(),l=Na-da,h=k-ra,f=la.getLittleEndian32(),t=la.getPosition()+f,v=pa.get(ta);v||(S.onconfirm&&S.onconfirm(),v=y(ta,e.width,e.height,Y));switch(oa){case 0:var A=rdpcodecs.bitmap.byte2int(la.getData(),f,la.getPosition());v.setRGBs(da,ra,l,h,A,0,l);break;case 3:for(var B=N.decode(la,f),F=B.getRects(),W=B.getTiles(),M=B.getTileSize(),m=B.getRectSize(),J=0;J<M;J++){var G=W[J];if(m)for(var Q=
G.x+64,ca=G.y+64,na=0;na<m;na++){var xa=F[na],Da=xa.x+xa.width,Ia=xa.y+xa.height;Q<=Da?ca<=Ia?v.setRGBs(G.x+da,G.y+ra,64,64,G.data,0,64):v.setRGBs(G.x+da,G.y+ra,64,Ia-G.y,G.data,0,64):ca<=Ia?v.setRGBs(G.x+da,G.y+ra,Da-G.x,64,G.data,0,64):v.setRGBs(G.x+da,G.y+ra,Da-G.x,Ia-G.y,G.data,0,64)}else v.setRGBs(G.x,G.y,64,64,G.data,0,4)}break;case 8:P||(P=new ClearDecoder);P.decode(la,l,h,v.getData(),da,ra,v.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Fa=v,za=O(la,f,!1);Fa.processAvc(za);
break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:r(la,f,!1,v);break;case 15:r(la,f,!0,v);break;default:svGlobal.logger.warn("Invalid codec:"+oa)}la.setPosition(t);v.postPaint(da,ra,l,h);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ga=X;svGlobal.logger.info("...soliFill");for(var wa=Ga.getLittleEndian16(),Aa=-16777216|Ga.getByte()<<16|Ga.getByte()<<8|Ga.getByte()|Ga.getByte()<<
24,Pa=Ga.getLittleEndian16(),Za=pa.get(wa),$a=0;$a<Pa;$a++){var Xa=Ga.getLittleEndian16(),mb=Ga.getLittleEndian16(),vb=Ga.getLittleEndian16()-Xa,$c=Ga.getLittleEndian16()-mb;Za.fillRect(Xa,mb,vb,$c,Aa);Za.postPaint(Xa,mb,vb,$c)}break;case 5:var hb=X;svGlobal.logger.info("...surfaceToSurface");for(var ad=hb.getLittleEndian16(),bd=hb.getLittleEndian16(),Pb=hb.getLittleEndian16(),Qb=hb.getLittleEndian16(),Rb=hb.getLittleEndian16()-Pb,uc=hb.getLittleEndian16()-Qb,Td=hb.getLittleEndian16(),cd=pa.get(ad),
Ud=pa.get(bd),dd=ad==bd?null:cd.getRGBs(Pb,Qb,Rb,uc),ed=0;ed<Td;ed++){var fd=hb.getLittleEndian16(),gd=hb.getLittleEndian16();dd?Ud.setRGBs(fd,gd,Rb,uc,dd,0,Rb):cd.moveArea(Pb,Qb,Rb,uc,fd-Pb,gd-Qb)}break;case 6:var ob=X;svGlobal.logger.info("...surfaceToCache");var Vd=ob.getLittleEndian16(),vc=ob.getLittleEndian32().toString(16),hd=ob.getLittleEndian32();0<hd&&(vc=hd.toString(16)+vc);var Wd=ob.getLittleEndian16(),id=ob.getLittleEndian16(),jd=ob.getLittleEndian16(),kd=ob.getLittleEndian16()-id,ld=
ob.getLittleEndian16()-jd,Xd=pa.get(Vd).getRGBs(id,jd,kd,ld);aa[Wd]=new g(Xd,kd,ld,vc);break;case 7:var Eb=X;svGlobal.logger.info("...cacheToSurface");for(var Yd=Eb.getLittleEndian16(),Zd=Eb.getLittleEndian16(),$d=Eb.getLittleEndian16(),Sb=aa[Yd],ae=pa.get(Zd),md=0;md<$d;md++){var be=Eb.getLittleEndian16(),ce=Eb.getLittleEndian16();ae.setRGBs(be,ce,Sb.width,Sb.height,Sb.pixels,0,Sb.width)}break;case 8:var de=X.getLittleEndian16();aa[de]=null;break;case 9:var Tb=X,ee=Tb.getLittleEndian16(),fe=Tb.getLittleEndian16(),
ge=Tb.getLittleEndian16(),he=Tb.getByte();y(ee,fe,ge,he);break;case 10:var nd=X.getLittleEndian16();pa.delete(nd);svGlobal.logger.info("delete surface id:"+nd);break;case 11:var od=X;od.getLittleEndian32();od.getLittleEndian32();break;case 12:var ie=X.getLittleEndian32();if(0==U){var pd=new Uint8Array(20),yb=new RdpBuffer(pd);yb.setLittleEndian16(13);yb.setLittleEndian16(0);yb.setLittleEndian32(20);yb.setLittleEndian32(4294967295);yb.setLittleEndian32(ie);U++;yb.setLittleEndian32(U);c&&S.send(pd)}break;
case 14:var Ub=X,qd=Ub.getLittleEndian32(),rd=Ub.getLittleEndian32(),wc=Ub.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+qd+" h:"+rd+" monitors:"+wc);for(var sd=Array(wc),Vb=0;Vb<wc;Vb++){var xc=new C;xc.read(Ub);sd[Vb]=xc;svGlobal.logger.info("MonitorDef "+Vb+": "+xc.toString())}var td=new E(qd,rd,sd);pa.reset(td);S.onresetgraphic&&S.onresetgraphic(td);break;case 15:var Wb=X,ud=Wb.getLittleEndian16();Wb.skipPosition(2);var Fb=pa.get(ud);Fb.outputOriginX=Wb.getLittleEndian32();Fb.outputOriginY=
Wb.getLittleEndian32();S.onmapsurface&&S.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+ud+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:D(X);break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var zb=X,vd=zb.getLittleEndian16();zb.skipPosition(2);var ib=pa.get(vd);ib.outputOriginX=zb.getLittleEndian32();ib.outputOriginY=zb.getLittleEndian32();
ib.targetWidth=zb.getLittleEndian32();ib.targetHeight=zb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+vd+" outX:"+ib.outputOriginX+" outY:"+ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);S.onmapsurface&&S.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+ja);return}X.setPosition(fa)}};S.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var x=
b?2:8,X=120*x,ja=new Uint8Array(X),V=new RdpBuffer(ja);V.setLittleEndian16(18);V.setLittleEndian16(0);V.setLittleEndian32(X);V.setLittleEndian16(x);V.setLittleEndian32(524292);V.setLittleEndian32(4);V.setLittleEndian32(1);V.setLittleEndian32(524549);V.setLittleEndian32(4);V.setLittleEndian32(19);b||(V.setLittleEndian32(655362),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(655872),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656129),V.setLittleEndian32(4),V.setLittleEndian32(0),
V.setLittleEndian32(656384),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656642),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656896),V.setLittleEndian32(4),V.setLittleEndian32(0));V.markEnd();c&&S.send(ja)};S.onclose=function(){pa.close()};return S}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var p=navigator&&(navigator.language||navigator.userLanguage||""),I=Rdp.languageToKeyboard[p];if(!I){var T=p.indexOf("-");T&&(I=Rdp.languageToKeyboard[p.substring(0,T)])}I||(svGlobal.logger.info("No valid layout for "+p),I=1033);return I}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
