var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var J=0;return function(){return J<q.length?{done:!1,value:q[J++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.makeIterator=function(q){var J="undefined"!=typeof Symbol&&Symbol.iterator&&q[Symbol.iterator];return J?J.call(q):$jscomp.arrayIterator(q)};$jscomp.arrayFromIterator=function(q){for(var J,U=[];!(J=q.next()).done;)U.push(J.value);return U};
$jscomp.arrayFromIterable=function(q){return q instanceof Array?q:$jscomp.arrayFromIterator($jscomp.makeIterator(q))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(q){var J=function(){};J.prototype=q;return new J};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,J,U){if(q==Array.prototype||q==Object.prototype)return q;q[J]=U.value;return q};$jscomp.getGlobal=function(q){q=["object"==typeof globalThis&&globalThis,q,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var J=0;J<q.length;++J){var U=q[J];if(U&&U.Math==Math)return U}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(q,J){var U=$jscomp.propertyToPolyfillSymbol[J];if(null==U)return q[J];U=q[U];return void 0!==U?U:q[J]};
$jscomp.polyfill=function(q,J,U,la){J&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(q,J,U,la):$jscomp.polyfillUnisolated(q,J,U,la))};$jscomp.polyfillUnisolated=function(q,J,U,la){U=$jscomp.global;q=q.split(".");for(la=0;la<q.length-1;la++){var R=q[la];if(!(R in U))return;U=U[R]}q=q[q.length-1];la=U[q];J=J(la);J!=la&&null!=J&&$jscomp.defineProperty(U,q,{configurable:!0,writable:!0,value:J})};
$jscomp.polyfillIsolated=function(q,J,U,la){var R=q.split(".");q=1===R.length;la=R[0];la=!q&&la in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ua=0;ua<R.length-1;ua++){var Y=R[ua];if(!(Y in la))return;la=la[Y]}R=R[R.length-1];U=$jscomp.IS_SYMBOL_NATIVE&&"es6"===U?la[R]:null;J=J(U);null!=J&&(q?$jscomp.defineProperty($jscomp.polyfills,R,{configurable:!0,writable:!0,value:J}):J!==U&&($jscomp.propertyToPolyfillSymbol[R]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(R):$jscomp.POLYFILL_PREFIX+
R,R=$jscomp.propertyToPolyfillSymbol[R],$jscomp.defineProperty(la,R,{configurable:!0,writable:!0,value:J})))};
$jscomp.getConstructImplementation=function(){function q(){function U(){}new U;Reflect.construct(U,[],function(){});return new U instanceof U}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(q())return Reflect.construct;var J=Reflect.construct;return function(U,la,R){U=J(U,la);R&&Reflect.setPrototypeOf(U,R.prototype);return U}}return function(U,la,R){void 0===R&&(R=U);R=$jscomp.objectCreate(R.prototype||Object.prototype);return Function.prototype.apply.call(U,R,la)||
R}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var q={a:!0},J={};try{return J.__proto__=q,J.a}catch(U){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(q,J){q.__proto__=J;if(q.__proto__!==J)throw new TypeError(q+" is not extensible");return q}:null;
$jscomp.inherits=function(q,J){q.prototype=$jscomp.objectCreate(J.prototype);q.prototype.constructor=q;if($jscomp.setPrototypeOf){var U=$jscomp.setPrototypeOf;U(q,J)}else for(U in J)if("prototype"!=U)if(Object.defineProperties){var la=Object.getOwnPropertyDescriptor(J,U);la&&Object.defineProperty(q,U,la)}else q[U]=J[U];q.superClass_=J.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(q){if(!(q instanceof Object))throw new TypeError("Iterator result "+q+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(q){this.yieldResult=q};
$jscomp.generator.Context.prototype.throw_=function(q){this.abruptCompletion_={exception:q,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(q){this.abruptCompletion_={return:q};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(q){this.abruptCompletion_={jumpTo:q};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(q,J){this.nextAddress=J;return{value:q}};
$jscomp.generator.Context.prototype.yieldAll=function(q,J){q=$jscomp.makeIterator(q);var U=q.next();$jscomp.generator.ensureIteratorResultIsObject_(U);if(U.done)this.yieldResult=U.value,this.nextAddress=J;else return this.yieldAllIterator_=q,this.yield(U.value,J)};$jscomp.generator.Context.prototype.jumpTo=function(q){this.nextAddress=q};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(q,J){this.catchAddress_=q;void 0!=J&&(this.finallyAddress_=J)};$jscomp.generator.Context.prototype.setFinallyBlock=function(q){this.catchAddress_=0;this.finallyAddress_=q||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(q,J){this.nextAddress=q;this.catchAddress_=J||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(q){this.catchAddress_=q||0;q=this.abruptCompletion_.exception;this.abruptCompletion_=null;return q};$jscomp.generator.Context.prototype.enterFinallyBlock=function(q,J,U){U?this.finallyContexts_[U]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=q||0;this.finallyAddress_=J||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(q,J){J=this.finallyContexts_.splice(J||0)[0];if(J=this.abruptCompletion_=this.abruptCompletion_||J){if(J.isException)return this.jumpToErrorHandler_();void 0!=J.jumpTo&&this.finallyAddress_<J.jumpTo?(this.nextAddress=J.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=q};$jscomp.generator.Context.prototype.forIn=function(q){return new $jscomp.generator.Context.PropertyIterator(q)};
$jscomp.generator.Context.PropertyIterator=function(q){this.object_=q;this.properties_=[];for(var J in q)this.properties_.push(J);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var q=this.properties_.pop();if(q in this.object_)return q}return null};$jscomp.generator.Engine_=function(q){this.context_=new $jscomp.generator.Context;this.program_=q};
$jscomp.generator.Engine_.prototype.next_=function(q){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,q,this.context_.next_);this.context_.next_(q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(q){this.context_.start_();var J=this.context_.yieldAllIterator_;if(J)return this.yieldAllStep_("return"in J?J["return"]:function(U){return{value:U,done:!0}},q,this.context_.return);this.context_.return(q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(q){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],q,this.context_.next_);this.context_.throw_(q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(q,J,U){try{var la=q.call(this.context_.yieldAllIterator_,J);$jscomp.generator.ensureIteratorResultIsObject_(la);if(!la.done)return this.context_.stop_(),la;var R=la.value}catch(ua){return this.context_.yieldAllIterator_=null,this.context_.throw_(ua),this.nextStep_()}this.context_.yieldAllIterator_=null;U.call(this.context_,R);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var q=this.program_(this.context_);if(q)return this.context_.stop_(),{value:q.value,done:!1}}catch(J){this.context_.yieldResult=void 0,this.context_.throw_(J)}this.context_.stop_();if(this.context_.abruptCompletion_){q=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(q.isException)throw q.exception;return{value:q.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(q){this.next=function(J){return q.next_(J)};this.throw=function(J){return q.throw_(J)};this.return=function(J){return q.return_(J)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(q,J){J=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(J));$jscomp.setPrototypeOf&&q.prototype&&$jscomp.setPrototypeOf(J,q.prototype);return J};
$jscomp.asyncExecutePromiseGenerator=function(q){function J(la){return q.next(la)}function U(la){return q.throw(la)}return new Promise(function(la,R){function ua(Y){Y.done?la(Y.value):Promise.resolve(Y.value).then(J,U).then(ua,R)}ua(q.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(q){return $jscomp.asyncExecutePromiseGenerator(q())};$jscomp.asyncExecutePromiseGeneratorProgram=function(q){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(q)))};
$jscomp.polyfill("Reflect",function(q){return q?q:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(q){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(q){if(q)return q;if($jscomp.setPrototypeOf){var J=$jscomp.setPrototypeOf;return function(U,la){try{return J(U,la),!0}catch(R){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(q){if(q)return q;var J=function(R,ua){this.$jscomp$symbol$id_=R;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ua})};J.prototype.toString=function(){return this.$jscomp$symbol$id_};var U=0,la=function(R){if(this instanceof la)throw new TypeError("Symbol is not a constructor");return new J("jscomp_symbol_"+(R||"")+"_"+U++,R)};return la},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(q){if(q)return q;q=Symbol("Symbol.iterator");for(var J="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),U=0;U<J.length;U++){var la=$jscomp.global[J[U]];"function"===typeof la&&"function"!=typeof la.prototype[q]&&$jscomp.defineProperty(la.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return q},"es6",
"es3");$jscomp.iteratorPrototype=function(q){q={next:q};q[Symbol.iterator]=function(){return this};return q};
$jscomp.polyfill("Promise",function(q){function J(){this.batch_=null}function U(Y){return Y instanceof R?Y:new R(function(sa,aa){sa(Y)})}if(q&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return q;J.prototype.asyncExecute=function(Y){if(null==this.batch_){this.batch_=[];var sa=this;this.asyncExecuteFunction(function(){sa.executeBatch_()})}this.batch_.push(Y)};
var la=$jscomp.global.setTimeout;J.prototype.asyncExecuteFunction=function(Y){la(Y,0)};J.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var Y=this.batch_;this.batch_=[];for(var sa=0;sa<Y.length;++sa){var aa=Y[sa];Y[sa]=null;try{aa()}catch(ia){this.asyncThrow_(ia)}}}this.batch_=null};J.prototype.asyncThrow_=function(Y){this.asyncExecuteFunction(function(){throw Y;})};var R=function(Y){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var sa=this.createResolveAndReject_();try{Y(sa.resolve,sa.reject)}catch(aa){sa.reject(aa)}};R.prototype.createResolveAndReject_=function(){function Y(ia){return function(na){aa||(aa=!0,ia.call(sa,na))}}var sa=this,aa=!1;return{resolve:Y(this.resolveTo_),reject:Y(this.reject_)}};R.prototype.resolveTo_=function(Y){if(Y===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(Y instanceof R)this.settleSameAsPromise_(Y);else{a:switch(typeof Y){case "object":var sa=null!=Y;break a;
case "function":sa=!0;break a;default:sa=!1}sa?this.resolveToNonPromiseObj_(Y):this.fulfill_(Y)}};R.prototype.resolveToNonPromiseObj_=function(Y){var sa=void 0;try{sa=Y.then}catch(aa){this.reject_(aa);return}"function"==typeof sa?this.settleSameAsThenable_(sa,Y):this.fulfill_(Y)};R.prototype.reject_=function(Y){this.settle_(2,Y)};R.prototype.fulfill_=function(Y){this.settle_(1,Y)};R.prototype.settle_=function(Y,sa){if(0!=this.state_)throw Error("Cannot settle("+Y+", "+sa+"): Promise already settled in state"+
this.state_);this.state_=Y;this.result_=sa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};R.prototype.scheduleUnhandledRejectionCheck_=function(){var Y=this;la(function(){if(Y.notifyUnhandledRejection_()){var sa=$jscomp.global.console;"undefined"!==typeof sa&&sa.error(Y.result_)}},1)};R.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var Y=$jscomp.global.CustomEvent,sa=$jscomp.global.Event,aa=$jscomp.global.dispatchEvent;
if("undefined"===typeof aa)return!0;"function"===typeof Y?Y=new Y("unhandledrejection",{cancelable:!0}):"function"===typeof sa?Y=new sa("unhandledrejection",{cancelable:!0}):(Y=$jscomp.global.document.createEvent("CustomEvent"),Y.initCustomEvent("unhandledrejection",!1,!0,Y));Y.promise=this;Y.reason=this.result_;return aa(Y)};R.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var Y=0;Y<this.onSettledCallbacks_.length;++Y)ua.asyncExecute(this.onSettledCallbacks_[Y]);
this.onSettledCallbacks_=null}};var ua=new J;R.prototype.settleSameAsPromise_=function(Y){var sa=this.createResolveAndReject_();Y.callWhenSettled_(sa.resolve,sa.reject)};R.prototype.settleSameAsThenable_=function(Y,sa){var aa=this.createResolveAndReject_();try{Y.call(sa,aa.resolve,aa.reject)}catch(ia){aa.reject(ia)}};R.prototype.then=function(Y,sa){function aa(Na,ta){return"function"==typeof Na?function(tb){try{ia(Na(tb))}catch(pb){na(pb)}}:ta}var ia,na,ya=new R(function(Na,ta){ia=Na;na=ta});this.callWhenSettled_(aa(Y,
ia),aa(sa,na));return ya};R.prototype.catch=function(Y){return this.then(void 0,Y)};R.prototype.callWhenSettled_=function(Y,sa){function aa(){switch(ia.state_){case 1:Y(ia.result_);break;case 2:sa(ia.result_);break;default:throw Error("Unexpected state: "+ia.state_);}}var ia=this;null==this.onSettledCallbacks_?ua.asyncExecute(aa):this.onSettledCallbacks_.push(aa);this.isRejectionHandled_=!0};R.resolve=U;R.reject=function(Y){return new R(function(sa,aa){aa(Y)})};R.race=function(Y){return new R(function(sa,
aa){for(var ia=$jscomp.makeIterator(Y),na=ia.next();!na.done;na=ia.next())U(na.value).callWhenSettled_(sa,aa)})};R.all=function(Y){var sa=$jscomp.makeIterator(Y),aa=sa.next();return aa.done?U([]):new R(function(ia,na){function ya(tb){return function(pb){Na[tb]=pb;ta--;0==ta&&ia(Na)}}var Na=[],ta=0;do Na.push(void 0),ta++,U(aa.value).callWhenSettled_(ya(Na.length-1),na),aa=sa.next();while(!aa.done)})};return R},"es6","es3");
$jscomp.checkStringArgs=function(q,J,U){if(null==q)throw new TypeError("The 'this' value for String.prototype."+U+" must not be null or undefined");if(J instanceof RegExp)throw new TypeError("First argument to String.prototype."+U+" must not be a regular expression");return q+""};
$jscomp.polyfill("String.prototype.startsWith",function(q){return q?q:function(J,U){var la=$jscomp.checkStringArgs(this,J,"startsWith");J+="";var R=la.length,ua=J.length;U=Math.max(0,Math.min(U|0,la.length));for(var Y=0;Y<ua&&U<R;)if(la[U++]!=J[Y++])return!1;return Y>=ua}},"es6","es3");
$jscomp.iteratorFromArray=function(q,J){q instanceof String&&(q+="");var U=0,la=!1,R={next:function(){if(!la&&U<q.length){var ua=U++;return{value:J(ua,q[ua]),done:!1}}la=!0;return{done:!0,value:void 0}}};R[Symbol.iterator]=function(){return R};return R};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(J){return J})}},"es6","es3");
$jscomp.polyfill("Array.from",function(q){return q?q:function(J,U,la){U=null!=U?U:function(sa){return sa};var R=[],ua="undefined"!=typeof Symbol&&Symbol.iterator&&J[Symbol.iterator];if("function"==typeof ua){J=ua.call(J);for(var Y=0;!(ua=J.next()).done;)R.push(U.call(la,ua.value,Y++))}else for(ua=J.length,Y=0;Y<ua;Y++)R.push(U.call(la,J[Y],Y));return R}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var q={},J=Object.create(new $jscomp.global.Proxy(q,{get:function(U,la,R){return U==q&&"q"==la&&R==J}}));return!0===J.q}catch(U){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(q,J){return Object.prototype.hasOwnProperty.call(q,J)};
$jscomp.polyfill("WeakMap",function(q){function J(){if(!q||!Object.seal)return!1;try{var ia=Object.seal({}),na=Object.seal({}),ya=new q([[ia,2],[na,3]]);if(2!=ya.get(ia)||3!=ya.get(na))return!1;ya.delete(ia);ya.set(na,4);return!ya.has(ia)&&4==ya.get(na)}catch(Na){return!1}}function U(){}function la(ia){var na=typeof ia;return"object"===na&&null!==ia||"function"===na}function R(ia){if(!$jscomp.owns(ia,Y)){var na=new U;$jscomp.defineProperty(ia,Y,{value:na})}}function ua(ia){if(!$jscomp.ISOLATE_POLYFILLS){var na=
Object[ia];na&&(Object[ia]=function(ya){if(ya instanceof U)return ya;Object.isExtensible(ya)&&R(ya);return na(ya)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(q&&$jscomp.ES6_CONFORMANCE)return q}else if(J())return q;var Y="$jscomp_hidden_"+Math.random();ua("freeze");ua("preventExtensions");ua("seal");var sa=0,aa=function(ia){this.id_=(sa+=Math.random()+1).toString();if(ia){ia=$jscomp.makeIterator(ia);for(var na;!(na=ia.next()).done;)na=na.value,this.set(na[0],na[1])}};aa.prototype.set=function(ia,
na){if(!la(ia))throw Error("Invalid WeakMap key");R(ia);if(!$jscomp.owns(ia,Y))throw Error("WeakMap key fail: "+ia);ia[Y][this.id_]=na;return this};aa.prototype.get=function(ia){return la(ia)&&$jscomp.owns(ia,Y)?ia[Y][this.id_]:void 0};aa.prototype.has=function(ia){return la(ia)&&$jscomp.owns(ia,Y)&&$jscomp.owns(ia[Y],this.id_)};aa.prototype.delete=function(ia){return la(ia)&&$jscomp.owns(ia,Y)&&$jscomp.owns(ia[Y],this.id_)?delete ia[Y][this.id_]:!1};return aa},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(q){function J(){if($jscomp.ASSUME_NO_NATIVE_MAP||!q||"function"!=typeof q||!q.prototype.entries||"function"!=typeof Object.seal)return!1;try{var aa=Object.seal({x:4}),ia=new q($jscomp.makeIterator([[aa,"s"]]));if("s"!=ia.get(aa)||1!=ia.size||ia.get({x:4})||ia.set({x:4},"t")!=ia||2!=ia.size)return!1;var na=ia.entries(),ya=na.next();if(ya.done||ya.value[0]!=aa||"s"!=ya.value[1])return!1;ya=na.next();return ya.done||4!=ya.value[0].x||"t"!=ya.value[1]||!na.next().done?
!1:!0}catch(Na){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(q&&$jscomp.ES6_CONFORMANCE)return q}else if(J())return q;var U=new WeakMap,la=function(aa){this.data_={};this.head_=Y();this.size=0;if(aa){aa=$jscomp.makeIterator(aa);for(var ia;!(ia=aa.next()).done;)ia=ia.value,this.set(ia[0],ia[1])}};la.prototype.set=function(aa,ia){aa=0===aa?0:aa;var na=R(this,aa);na.list||(na.list=this.data_[na.id]=[]);na.entry?na.entry.value=ia:(na.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:aa,value:ia},na.list.push(na.entry),this.head_.previous.next=na.entry,this.head_.previous=na.entry,this.size++);return this};la.prototype.delete=function(aa){aa=R(this,aa);return aa.entry&&aa.list?(aa.list.splice(aa.index,1),aa.list.length||delete this.data_[aa.id],aa.entry.previous.next=aa.entry.next,aa.entry.next.previous=aa.entry.previous,aa.entry.head=null,this.size--,!0):!1};la.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Y();this.size=0};la.prototype.has=
function(aa){return!!R(this,aa).entry};la.prototype.get=function(aa){return(aa=R(this,aa).entry)&&aa.value};la.prototype.entries=function(){return ua(this,function(aa){return[aa.key,aa.value]})};la.prototype.keys=function(){return ua(this,function(aa){return aa.key})};la.prototype.values=function(){return ua(this,function(aa){return aa.value})};la.prototype.forEach=function(aa,ia){for(var na=this.entries(),ya;!(ya=na.next()).done;)ya=ya.value,aa.call(ia,ya[1],ya[0],this)};la.prototype[Symbol.iterator]=
la.prototype.entries;var R=function(aa,ia){var na=ia&&typeof ia;"object"==na||"function"==na?U.has(ia)?na=U.get(ia):(na=""+ ++sa,U.set(ia,na)):na="p_"+ia;var ya=aa.data_[na];if(ya&&$jscomp.owns(aa.data_,na))for(aa=0;aa<ya.length;aa++){var Na=ya[aa];if(ia!==ia&&Na.key!==Na.key||ia===Na.key)return{id:na,list:ya,index:aa,entry:Na}}return{id:na,list:ya,index:-1,entry:void 0}},ua=function(aa,ia){var na=aa.head_;return $jscomp.iteratorPrototype(function(){if(na){for(;na.head!=aa.head_;)na=na.previous;for(;na.next!=
na.head;)return na=na.next,{done:!1,value:ia(na)};na=null}return{done:!0,value:void 0}})},Y=function(){var aa={};return aa.previous=aa.next=aa.head=aa},sa=0;return la},"es6","es3");$jscomp.findInternal=function(q,J,U){q instanceof String&&(q=String(q));for(var la=q.length,R=0;R<la;R++){var ua=q[R];if(J.call(U,ua,R,q))return{i:R,v:ua}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(q){return q?q:function(J,U){return $jscomp.findInternal(this,J,U).i}},"es6","es3");
var svManager={getInstance:function(){var q=window.$rdp;return q&&q.running&&q.running()?q:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(q){var J={};J.id=q.id;J.server=q.id;J.displayName=q.displayName||q.id;if(q=q.rdp){for(var U in q)J[U]=q[U];J.user=q.username||"";J.pwd=q.password||"";J.useConsole=q.console||!1;J.legacyMode=q.leagacyMode||q.legacyMode||!1;J.server_bpp=q.color||16;J.exe=q.remoteProgram||"";J.args=q.remoteArgs||"";J.startProgram=0<J.exe.length?"app":J.command&&0<J.command.length?"shell":"noapp"}return J}
function Rdp2(q){q=svGlobal.util.getServerArgs(q);if(!q||!q.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var J=q.gateway||"",U=0,la=0,R=16,ua=1==q.useSSL||"true"==q.useSSL||"on"==q.useSSL||null;q.width&&(U=parseInt(q.width,10));q.height&&(la=parseInt(q.height,10));q.color&&(R=parseInt(q.color,10));q.server_bpp&&(R=parseInt(q.server_bpp,10));q=hi5.browser.obj2url(q);null===ua&&(ua="https:"==location.protocol);return new Rdp((ua?"wss://":"ws://")+J+"/RDP?"+q,U,la,R)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(q,J,U,la){function R(a){return"on"==a||"true"==a||1==a}function ua(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function Y(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function sa(a,b){a=ha[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function aa(){return M.displayName||M.server||M.symlink||M.id||"undefined"}function ia(a){p.loadbalanceToken||
(p.loadbalanceToken=ha.loadbalanceTokenName?ha.loadbalanceTokenName+"="+a:"")}function na(a,b,c){p.ontitlechange&&(a=p.ontitlechange(a,c));p.setTitle&&a&&(b=b||window,b.document.title=a)}function ya(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return M.invitation||p.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(La?La.postMessage({type:0,cmd:1,data:a}):Ba&&Ba.setColor(a));return!0}function Na(a,b,c,e){Ja=a;Ka=b;Wb=Xb=0;Yb=Ja-1;Zb=Ka-1;Va&&(Ja=(M.waWidth||
hi5.browser.getScreenWidth())|0,Ka=(M.waHeight||hi5.browser.getScreenHeight())|0);M.minWidth&&Ja<M.minWidth&&(Ja=M.minWidth|0);M.minHeight&&Ka<M.minHeight&&(Ka=M.minHeight|0);Ja&=-4;Ka&=-4;svGlobal.logger.warn("resolution changed, w:"+Ja+" h:"+Ka);var d=Ja,f=Ka;ra?ra.resize(d,f):ra=new yc(d,f);ca.setSize(Ja,Ka,Va?"hidden":null);if(c||Ja!=a||Ka!=b)La?La.postMessage({type:0,cmd:2,data:{w:Ja,h:Ka}}):Ba&&Ba.setResolution(Ja,Ka);if(p.onresolutionchange&&!e)p.onresolutionchange(a,b)}function ta(a){!bb&&
Ha&&(La?($b.data=a,"string"!=typeof a?La.postMessage($b,[a]):La.postMessage($b)):Ba.writeRawInput(a))}function tb(a){switch(a){case "\r":break;case "\n":p.writeScancode(28);break;case "\t":p.writeScancode(15);break;default:ta("86"+a)}}function pb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),f=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=f?5:9;c=new Uint8Array(e+c);c[0]=a;if(f)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{f=b.name;for(var n=Math.min(f.length,8),H=0;H<n;H++)c[1+H]=f.charCodeAt(H)}c.set(d,e);ta(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Gb(a){if(p){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};p.displayMsg&&p.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(p.onerror)p.onerror(a)}}function zc(a){if(p){var b=__svi18n.info[a];b||(b="info "+a);p.displayMsg&&p.showMessage(b);svGlobal.logger.info(b)}}function ac(){var a=Ha;qb=Ha=!1;
La?La.postMessage({type:0,cmd:3}):Ba&&Ba.resetStatus();a&&(Ha=a)}function bc(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(ta)),Ma.addEvent("beforeupload",function(b,c,e){if(p.beforeupload)return p.beforeupload(b,c,e)}),Ma.addEvent("fileuploaded",function(b,c,e){if(p.onfileuploaded)p.onfileuploaded(b,c,e)}),Ma.addEvent("uploaded",function(b,c){if(p.onuploaded)p.onuploaded(b,c)}),Ma.addEvent("uploadingCancelled",function(){if(p.onuploadingCancelled)p.onuploadingCancelled()}));a.setFileHandler(Ma)}
function Ac(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ha&&(e=!0,ta("8C5"+d.exe+"\t"+d.args+"\t"+p.sessionInfo.appInfo.session))}}function wd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Bc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Hb(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function xd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Cc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Dc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var f=[];e&1?f.push("usb"):e&2?f.push("nfc"):e&4?f.push("ble"):e&16?f.push("internal"):e&32&&f.push("hybrid");
d.transports=f}b.push(c)}}return b}function Cc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function yd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function zd(a,b){var c,e,d,f,n,H,z,E,B,v,x,O,r,C,F,t,P,N,T,Z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(S){if(1==S.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var pa=$jscomp.makeIterator(e),y=pa.next();!y.done;y=pa.next())y=y.value,"USB"==y.toUpperCase()||"NFC"==y.toUpperCase()||"BLE"==y.toUpperCase()||"INTERNAL"==y.toUpperCase()||y.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+ub(new Uint8Array(d))),n=Hb(d),f=n.attStmt;if(H=a.clientDataJSON)console.log("==== clientDataJson bytes: "+ub(new Uint8Array(H))),z=window.origin,E=(new TextDecoder).decode(H),B=JSON.parse(E),B.origin&&(B.origin=z);v=a.getAuthenticatorData();
if(!v)return S.jumpTo(0);x=new Uint8Array(v);console.log("==== authenticatorData bytes: "+ub(x));return b?(O=b.id)?S.yield(Ad(O),5):S.jumpTo(0):S.jumpTo(0)}r=S.yieldResult;C=new Uint8Array(r);console.log("==== hash of realRpID: "+ub(C));F=new hi5.DataBuffer(new Uint8Array(x.byteLength));F.setBytes(C);t=x.slice?x.slice(32,x.length):x.subarray(32,x.length);F.setBytes(t);F.markEnd();P=F.getData();console.log("==== newAuthDataBytes: "+ub(new Uint8Array(P)));N={1:"packed",2:P,3:f};T=CBOR.encode(N);Z=new hi5.DataBuffer(new Uint8Array(T.byteLength+
1));Z.setByte(0);Z.setBytes(T);Z.markEnd();return S.return(Z.getData())})}function Ad(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Bd(b))})}function Bd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function ub(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function Cd(){var a=0,b=0,c=new p.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),f=e.getLittleEndian16(),n=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(n){case 1:case 4097:n=new RdpBuffer(new Uint8Array(6),0,6);n.setByte(6);n.setByte(1);n.setLittleEndian16(f);n.setLittleEndian16(0);n.markEnd();c.send(n);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:f=e.getLittleEndian16();a+=f;break;case 43:case 1065:case 1577:43==n&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(f);d.setLittleEndian16(43==n?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:f=e.getLittleEndian32();n=e.getLittleEndian32();
e=e.getLittleEndian32();cc={baseRTT:f,bandwidth:n,averageRTT:e};if(p.onnetworkresult)p.onnetworkresult(cc);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};p.addGatewayChannel(c)}function Dd(a,b,c,e,d){dc.set(a,b);ec.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=
a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ed(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ec(){var a="";M&&R(M.connectif)&&M.symlink&&"sessionStorage"in window&&(a="SV_"+M.symlink,M.domain&&(a+=M.domain),M.user&&(a+=M.user));return a}function Fd(){var a=hi5.appcfg.persistentId?
window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function fc(){if(!Ha){qb=!1;var a="";bb?Ea.init(!1,!0,!1,0,!1,!1):a=p.getRuntimeURL();void 0==ha.wsPost&&(ha.wsPost=!1);p.oncreatewebsocket&&(La=null);La?(bb&&(bb.onopen=gc,bb.onclose=Ab,bb.onmessage=function(c){hc.data=c.data;La.postMessage(hc,[hc.data])}),La.postMessage({type:0,cmd:0,data:{addr:a,width:Ja,height:Ka,
server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ha.wsPost}})):(Ba=new RdpGeneral(bb||a,Ja,Ka,fb,ra,!1,ha.wsPost),Ba.oncreatewebsocket=p.oncreatewebsocket,Ba.run());La?La.addEventListener("message",Fc,!1):(Ba.onopen=gc,Ba.onmessage=Gc,Ba.onclose=Ab,Ba.onerror=Gb,Ba.oninfo=zc,Ba.onloggedin=ic,Ba.onresolutionchange=function(c,e){Na(c,e,!1,M.monitorDef&&0<=M.monitor?!0:!1)},Ba.onAltSecWindows=Hc,Ba.onMoveCursor=jc,Ba.onCloseSurface=Ic,Ba.onColorChange=ya,Ba.onHistoryReceived=function(){kc()},
Ba.onLockKeyState=function(c){if(p.onLockKeyState)p.onLockKeyState(c)});if(a=ca.getSurface(ca.size()-1))Va?a&&(a.remoteApp=new Ac(M.exe,M.args,"")):na(aa(),a.getWindow());if(M.invitation&&!R(M.shadow)){var b=null;a&&(b=a.initChat(M.expert));Bb=new p.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,M.novice)};b&&(b.onchat=function(c){if(Ha){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();
Bb.send(e)}});p.addGatewayChannel(Bb)}}}function Fc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:gc();break;case 1:Ab(a.expected);break;case 2:Gb(a.code);break;case 3:zc(a.code);break;case 4:ic();break;case 5:Na(a.w,a.h,!1,M.monitorDef&&0<=M.monitor?!0:!1);break;case 6:jc(a.x,a.y,!0);break;case 7:Ic();break;case 8:0==a.id&&kc();Pa&&Pa.check(1<a.id?15555:0);break;case 9:ya(a.color);break;case 10:if(p.onLockKeyState)p.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:ra.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:ra.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:ra.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:ra.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:ra.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:ra.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Jc(a);break;case 10:Gc(a);break;case 11:Ua.attach(a.data,0,a.data.length);Hc(Ua,a.size);
break;case 12:ra.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:ra.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:ra.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:ra.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:ra.putFont(a.font,a.character,a.glyph);break;case 17:ra.putCursor(a.idx,
a.cursor);break;case 18:ra.setCursor(a.idx);break;case 19:ra.getHistory(ta,function(){La.postMessage({type:0,cmd:7})});Pa&&Pa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);ra.setHistory(a.order,Ua);break;case 21:ra.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Kc(a){Pa&&Pa.check(a)}function gc(){Ha=!0;var a="87"+navigator.userAgent+"\t";Ib=hi5.tool.uuid();document.cookie=Ib+"=sv";ta(a+Ib);if(p.onopen)p.onopen();ha.joinCloseMode&&
p.setJoinCloseMode(ha.joinCloseMode)}function Ic(){ca&&ca.close()}function Gc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=jb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Ca.tag=a.getLittleEndian16();Ca.channels=a.getLittleEndian16();Ca.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Ca.bitsPerSample=a.getLittleEndian16();
svGlobal.logger.info("Audio Format, tag="+Ca.tag+" channels="+Ca.channels+" bitsPerSample="+Ca.bitsPerSample+" samplePerSec="+Ca.samplePerSec);La&&La.postMessage({type:0,cmd:5,data:{tag:Ca.tag,channels:Ca.channels,samplePerSec:Ca.samplePerSec,bitsPerSample:Ca.bitsPerSample}});41222==Ca.tag&&(Ca.sampleRate=Ca.samplePerSec,Ta.initMediaPlayer(Ta,Ca,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);lc(a,b,c,0);kb||(c+=Date.now()-e,ta("8A"+b+","+c))}Pa&&Pa.check();
break;case 56:Lc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Mc(Ua);break;case 62:Nc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Oc(Ua);Pa&&Pa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ea[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ea[b].newInstance?(Ea[a]=Ea[b].newInstance(),Ea[a].id=a):(Ea[b].id=a,Ea[a]=Ea[b]),Ea[a].onopen)Ea[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+
b+" id:"+a);break;case 3:Ea[a]&&Ea[a].process(b);break;case 4:if(Ea[a]&&Ea[a].onclose)Ea[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Pa&&Pa.check();break;case 146:Gd(Ua);break;default:if(p.onunknownmessage)p.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:ta("87"+navigator.userAgent);break;case 15:if(p){mc=!1;vb=p.reconnectTimes;(p&&0==p.mode||R(M.connectif))&&kc();b="";for(b in lb)if((c=lb[b])&&c.onopen)c.onopen();
for(b in jb)if((c=jb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&p&&(p.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(p.onnotify)p.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&p.onerror)p.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;p.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ca.drawLicense(a);
break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Hd(a);break;case 2:Cb?(Cb.type==a?p.writeRawInput("881"+a+"\t"+Cb.text):p.writeRawInput("881ERROR\t"),Cb=null):!(b=ca.getFocused())||b.processClipReq(a)||!ha.clipWarnAlways&&Pc||!M||M.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Pc=!0);break;case 5:(b=ca.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ca.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=ua()+b[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+
a+" name:"+b[1]+" driver:"+b[2]);p.onprintingready&&p.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ca.getFocused())&&b.showPDF(a);break;case 56:Lc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ca.getWinById(parseInt(b[0]))){if(!ca.hasApp(b[1])){(c=ca.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(p.onremoteappstart)p.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&p.ontitlechange)p.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Id(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(cb&16||cb&65536)?(Jb=!1,Ma=null):(cb&16&&(Jb=!0),Ma||(a=ca.getFocused())&&bc(a));cb&64&&p.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(cb&128)),Ma.setDownload(!(cb&131072)),Ma.canCopyFile=0!=(cb&65536));ca.execute("setFeature",[cb]);break;case 60:Mc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Na(a.width,a.height,!0,!1);ya(a.color);
(b=a.server)&&p&&(p.server=a.server);Qc=a.length;c=ca.getFocused();Va=1==a.isRail;c&&(1!=p.mode&&c.setAutoScale(!Va),b&&na(aa(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Jb=!0,bc(c));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Qc);break;case 2:2==a.status?(ac(),Ha=!0):(b=0==a.status,b==ra.isPaused()||p.onsessionpause&&p.onsessionpause(b,a)||(ra.pause(b),b||ca.repaint(0,0,ra.width-1,ra.height-1),a.warn&&p.showMessage(b?
__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Nc(a);break;case 63:Oc(b64ToBuffer(a));break;default:if(p.onunknownmessage)p.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function kc(){if(!kb&&!Wa&&(Wa=!0,p&&(ha.pingInterval&&p.startPing(ha.pingInterval),p.onready)))p.onready()}function Gd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ta(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=
65536,ca.execute("setFeature",[cb]));break;case 6:Qa.remoteLockFlags=a.getLittleEndian32();Qa.checkLockFlags=!0;if(p.onLockKeyState)p.onLockKeyState({capsLock:0!=(Qa.remoteLockFlags&4),numLock:0!=(Qa.remoteLockFlags&2),scrollLock:0!=(Qa.remoteLockFlags&1)},{capsLock:0!=(Qa.localLockFlags&4),numLock:0!=(Qa.localLockFlags&2),scrollLock:0!=(Qa.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Qa.remoteLockFlags);break;case 7:b=a.getByte();p.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=
a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);p.sessionInfo.appInfo.twoFAQR=a;p.ontwofaqr&&p.ontwofaqr(a)||2==b&&ca.execute("showTwoFAQR");break;case 1:ra.pause(!0,!0);if(p.ontwofacode&&p.ontwofacode())return;(a=ca.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!p.ontwofaresult||!p.ontwofaresult(b,a))&&Qa.onauthcoderesult)Qa.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ca.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c=
"image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var f=new Uint8Array(2+d.length);f[0]=146;f[1]=8;f.set(d,2);ta(f.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Jd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var f=ca.getFocused();f&&Ha&&(f=f.getThumbnail(a))&&f.length!=d&&(ta("8E7"+f),d=f.length)},b))};this.stop=function(){clearInterval(c)}}function Kd(a,b){!Ya||Ya.width==
a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Jd(a,b));Ya.start()}function Oc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Nc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ac();Ha=!0;a=d.width;e=d.height;if(a==Ja&&e==Ka)break;Na(a,e,!1,!1);break;case 1:d=JSON.parse(c);p.sessionInfo.joinedSessions.push(d.numericId);p.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||
ha.alertJoin)p.onsessionjoin&&(a=p.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&p.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);p.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=p.sessionInfo.joiners;c=0;for(var f=b.length;c<f;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ha.alertJoin)p.onsessionexit&&(a=p.onsessionexit(d)),!a&&__svi18n.info.exitsession&&p.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,
d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ca.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ca.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;
p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);p.onrequirecontrol&&(a=p.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;ra.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));p.showMessage({title:a,msg:e,cbYes:function(){p.giveControl(d.numericId);this.destroy();ra.isPaused()&&p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(d.numericId);this.destroy()},html:!0});
break;case 6:ca.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Na(d.width,d.height,!0,M.monitorDef&&0<=M.monitor?!0:!1);d.color&&(ya(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(p.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);mc=!0;if(p.onrequestcredential&&p.onrequestcredential(d,Qa.reconnect))break;if(p.onautherror&&p.onautherror(d,Qa.reconnect))break;ca.getFocused().requestCredential(d,Qa.reconnect);break;
case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Kd(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);p.onrequirejoin&&(a=p.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);p.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&ic();break;case 14:if(d=JSON.parse(c),p.oncontrolchange)p.oncontrolchange(d)}}
function Mc(a){switch(a.getByte()){case 32:if(!ra.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,f=void 0;ha.noCursorName||(d=a.getLittleEndian32(),p.sessionInfo.appInfo&&(f=p.sessionInfo.appInfo.sessions[d]));jc(c,e,!0,f,d,b)}}}function jc(a,b,c,e,d,f){ra.isPaused()||ca.getFocused().moveCursor(a,b,c,e,d,f)}function Jc(a){ca.setCursor(a)}function Ld(a){var b=ha.page&&ha.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+
b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=ua();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Lc(a){a=JSON.parse(a);nc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",nc),c.setItem("appInfo.numericId",b));ia(a.appId);a.server||(a.server=aa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?
1!=p.mode&&ca.execute("setAutoScale",[!0]):(p.mode=0,R(M.connectif)&&ca.setSize(Ja,Ka),ha.disableJoinedAppResize&&(p.windowState=0));var e=ua();b=Ld("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),p.protocol="http"==c.substring(0,e)?"ws":"wss",p.gateway=c,b+="&gateway="+encodeURIComponent(c));b=p.modifyURL(b);a.joinLink=b;p.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Na(Ja,Ka,!0,!0),qb||1==p.mode||ca.execute("setAutoScale",
[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ha.cursorNameOnly=a.isAssistance;if(p.onsessionstart)p.onsessionstart(p.sessionInfo)}function Id(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Ma.confirmId(c[0],c[1],c[2]);break;case 2:Ma.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Ma.close(c[0]);break;case 9:a='<a href="'+p.modifyURL(ua()+
c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ca.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Ma.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function lc(a,b,c,e){if(!Md||ra.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ca.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ca.tag)oc||(oc=new MSGSM),b=
oc.decode(b,d,e),d=0,e=b.length;var f=Ca.bitsPerSample;var n=Math.floor(e/(f>>3));var H=c=e=0;a||(e=Math.pow(2,f-1)-1,c=-e-1,H=Math.pow(2,f));f=Ca.channels;var z=Math.floor(n/f),E=Ta.getBuffer(z),B=E.getChannelData(0),v=E.getChannelData(1);n=0;if(a)for(;n<z;)1==f?v[n]=B[n]=b[d++]:(B[n]=b[d++],v[n]=b[d++]),n++;else for(;n<z;)a=b[d++]|b[d++]<<8,a>e?(a-=H,a/=-c):a/=e,1==f?B[n]=a:(B[n]=a,a=b[d++]|b[d++]<<8,a>e?(a-=H,a/=-c):a/=e),v[n]=a,n++;return Ta.playBuffer(E)}function Rc(a){if(!p.openLink||2E3<a.length)return!1;
var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:p.onurlredirection&&p.onurlredirection(b)?!0:(a=ca.getFocused())?a.processLink(b):!1:!1}function Nd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=
a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=p.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Hd(a){if("text/plain;"!=a){if(1666<Date.now()-Qa.reqCopyTime&&!(p.onservercopy&&p.onservercopy(a)||Rc(a))){var b=ca.getFocused();b&&b.copyToClip(Nd(a))}setTimeout(function(){ta("883")},999)}}function ic(a){if(!qb&&(setTimeout(function(){Ha&&ta("884")},333),p.onloggedin))p.onloggedin();pc=qb=!0;a&&a.sessionId&&(p.sessionInfo.sessionId=a.sessionId);Va&&1!=
p.mode&&ca.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Kb&&!Va&&(ra.setContext(ca.getFocused().context),ca.repaint(0,0,ra.width-1,ra.height-1))}function Ab(a){if(p){hi5.browser.cookie.delete(Ib);svGlobal.logger.warn("closed "+(p.sessionInfo.appInfo?p.sessionInfo.appInfo.numericId:0));p.onagentmessage&&(p.onagentmessage=null);if(p.onagentclose)p.onagentclose();var b=Ec();b&&p.sessionInfo.appInfo&&0==p.mode&&(sessionStorage[b]=p.sessionInfo.appInfo.session);if(p&&(b=1!=p.mode,!Ha&&b&&Gb("connection"),
b=b&&(Ha||vb<p.reconnectTimes)&&0<vb&&!a,Wa=Ha=!1,b)){vb--;__svi18n.info.reconnecting&&p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-vb)+"/"+p.reconnectTimes,null,3E3);setTimeout(fc,ha.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+vb);return}if(mc)svGlobal.logger.info("Req credential");else{Pa&&(p.stopPing(),Pa=null);La&&(La.removeEventListener("message",Fc,!1),La.postMessage({type:0,cmd:4}),La.terminate(),La=null);Ma&&(Ma.release(),Ma=null);Ra=q=null;Ea&&(Ea.close(),
Ea=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);p.player&&(p.player=null);Db=null;try{if(p.onclose)p.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ca&&(ca.close(),ca=null)}catch(c){svGlobal.logger.warn(c)}Ua=null;Ba&&(Ba.onopen=null,Ba.onmessage=null,Ba.onclose=null,Ba.onerror=null,Ba.close(),Ba=null);ca=Qa=null;ra&&(ra.release(),ra=null);hi5.browser.isChromeApp?
chrome.runtime.onSuspend.removeListener(p.close):window.removeEventListener("unload",p.close,!1);window&&window.$rdp==p&&(window.$rdp=null);p=null}}}function Sc(){Ba&&Ha?Ba.close():Ab(!0)}function Hc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),f=0;16>c&&(f=a.getLittleEndian16());var n=a.getLittleEndian16(),H=a.getLittleEndian16();a.getBytes(n);f&&
a.getBytes(f);if(8<=c&&(f=ca.getFocused())&&f.onremoteappicon){n=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();H=d+H;var z;a=a.getData();for(var E=0,B,v;d<H;)switch(c){case 16:(z=a[d++]|a[d++]<<8)?(v=z>>7&248,B=z>>2&248,z=z<<3&248,v|=v>>5,B|=B>>5,z|=z>>5,e[E++]=z,e[E++]=B,e[E++]=v,e[E++]=255):E+=4;break;case 32:e[E++]=a[d++],e[E++]=a[d++],e[E++]=a[d++],e[E++]=a[d++]}n.putPixels(e,0,e.length);a=ca.getWinById(b);f.onremoteappicon(a,n)}}else 0!=(c&2147483648)?
svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ca.delWin(b)):Od(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((f=ca.getOwnerSurfaceById(b))&&
f.railWin&&f.railWin.setActiveWinId(b,3==ha.windowState),ca.setTitle(b),ra.getContext()||(b=ca.getFocused())&&ra.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ca.zOrders,c.length=b,f=0;f<b;f++)c[f]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[f])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Tc(a){var b=ca.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),
Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Od(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ca.getWinById(c);d?e=!0:d=new ca.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+
d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=
(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),
svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var f=d.showState;(2==f&&0!=ha.noMinimize||!e&&3==f&&5==ha.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(f=0!=(b&4)){var n=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(n,
!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=
a.getLittleEndian32());if(0!=(b&2048)){n=a.getLittleEndian32();var H=a.getLittleEndian32();d.winOffsetX=n;d.winOffsetY=H;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==p.windowState?Tc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(n=ca.getFocused())){n=n.getFreeSpace();var z=d.winWidth,E=d.winHeight;if(d.winOffsetX>n.width||d.winOffsetY>n.height||0>z+d.winOffsetX||0>E+d.winOffsetY){var B=(n.width-d.winWidth)/2|0,v=(n.height-d.winHeight)/2|0;0>B&&(B=0);0>v&&(v=0);setTimeout(function(){d.resize(B,v,z,E)},50)}}0!=(b&256)&&(n=a.getLittleEndian16(),0<n&&a.skipPosition(8*n));0!=(b&
4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ca.onWinChange(d);else ca.addWin(d);f&&ca.setTitle(c);c==ca.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ca.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function yc(a,b){function c(g,l,k,h,u){0<u.width?u.union(g,l,k,h):(u.x=g,u.y=l,u.width=k,u.height=h)}function e(g,
l,k,h){for(X=0;X<ja;X++){var u=pa[X];if(g>=u[0]&&l>=u[1]&&k<=u[2]&&h<=u[3])return y[X]}return null}function d(g,l,k,h){if(ja){var u=e(g,l,g+k-1,l+h-1);u&&c(g,l,k,h,u)}else c(g,l,k,h,C)}function f(g,l,k,h,u,w,D){for(var A=u*k+h,I=g.setRGB,W=g.getRGB,L=0;L<D;L++){for(var m=0;m<w;m++){if(g){var K=W(h+m,u+L);I(h+m,u+L,~K&16777215)}else l[A]=~l[A]&16777215;A++}A+=k-w}}function n(g,l,k,h,u,w,D,A,I,W){l=W*A+I;null==D&&(D=g);for(g=0;g<w;g++){for(I=0;I<u;I++)O[h+g][k+I]=O[h+g][k+I]&D[l]&16777215|4278190080,
l++;l+=A-u}}function H(g,l,k,h,u,w,D,A,I,W){l=W*A+I;I=g.setRGB;W=g.getRGB;null==D&&(D=g);for(g=0;g<w;g++){for(var L=0;L<u;L++){var m=W(k+L,h+g);I(k+L,h+g,m|D[l]&16777215);l++}l+=A-u}}function z(g,l,k,h){var u=da;if(u){var w=u.getRGB(l,k);switch(g){case 0:u.setRGB(l,k,0);break;case 1:u.setRGB(l,k,~(w|h)&16777215);break;case 2:u.setRGB(l,k,w&~h&16777215);break;case 3:u.setRGB(l,k,~h&16777215);break;case 4:u.setRGB(l,k,16777215*(~w&h));break;case 5:u.setRGB(l,k,~w&16777215);break;case 6:u.setRGB(l,k,
w^h&16777215);break;case 7:u.setRGB(l,k,~w&h&16777215);break;case 8:u.setRGB(l,k,w&h&16777215);break;case 9:u.setRGB(l,k,w^~h&16777215);break;case 10:break;case 11:u.setRGB(l,k,w|~h&16777215);break;case 12:u.setRGB(l,k,h);break;case 13:u.setRGB(l,k,(~w|h)&16777215);break;case 14:u.setRGB(l,k,w|h&16777215);break;case 15:u.setRGB(l,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+g),u.setRGB(l,k,h)}}}function E(g,l,k,h,u,w,D,A,I){g>A||l>I||(k=g+k-1,k>A&&(k=A),g<w&&(g=w),k=
k-g+1,h=l+h-1,h>I&&(h=I),l<D&&(l=D),h=h-l+1,1>k||1>h||da.fillRect(g,l,k,h,u))}function B(g,l,k,h,u,w,D,A,I,W,L,m){if(!(l>L||k>m)){var K=l+h-1;K>L&&(K=L);I=l<I?I:l;K=K-l+1;L=k+u-1;L>m&&(L=m);W=k<W?W:k;m=L-k+1;if(!(1>K||1>m)){L=128;var G=0;D|=4278190080;A|=4278190080;if(I==l&&W==k&&K==h&&m==u)if(0==g)for(var Q=0;Q<u;Q++){g=k+Q;for(var ba=0;ba<h;ba++)0==L&&(G++,L=128),0!=(w[G]&L)&&(O[g][l+ba]=A),L>>=1;G++;L=128;G==w.length&&(G=0)}else for(Q=0;Q<u;Q++){g=k+Q;for(ba=0;ba<h;ba++)0==L&&(G++,L=128),O[g][l+
ba]=0!=(w[G]&L)?A:D,L>>=1;G++;L=128;G==w.length&&(G=0)}else if(0==g)for(Q=0;Q<m;Q++){g=k+Q;for(ba=0;ba<K;ba++)0==L&&(G++,L=128),l+ba>=I&&g>=W&&0!=(w[G]&L)&&(O[g][l+ba]=A),L>>=1;G++;L=128;G==w.length&&(G=0)}else for(Q=0;Q<m;Q++){g=k+Q;for(ba=0;ba<K;ba++)0==L&&(G++,L=128),l+ba>=I&&k+Q>=W&&(O[g][l+ba]=0!=(w[G]&L)?A:D),L>>=1;G++;L=128;G==w.length&&(G=0)}}}}function v(g,l,k,h,u){this.offset=g;this.baseLine=l;this.width=k;this.height=h;this.fontData=u}function x(g,l,k,h,u,w,D,A,I){this.cache_idx=g;this.rawData=
l;this.none=!l;this.hotX=k;this.hotY=h;this.width=u;this.height=w;this.xorSize=A;this.andSize=I;this.result="";this.distance=0;this.bpp=D;this.system="";if(l){if(!this.distance){g=0;if(l){D=0;for(var W=l.length;D<W;D++)0!=l[D]&&(g+=D%u+(D/u|0))}this.distance=g}if(!this.system){a:switch(this.distance){case 507:g="text";break a;case 2046:case 4359:g="default";break a;default:g=""}this.system=g}}g="";if(!this.system&&l){D=u*w*4;g=62+D+A+I;W=new Uint8Array(g);g=new hi5.DataBuffer(W,0,g);g.setLittleEndian16(0);
g.setLittleEndian16(2);g.setLittleEndian16(1);g.setByte(u);g.setByte(w);g.setByte(0);g.setByte(0);g.setLittleEndian16(k);g.setLittleEndian16(h);g.setLittleEndian32(40+D+A+I);g.setLittleEndian32(22);g.setLittleEndian32(40);g.setLittleEndian32(u);g.setLittleEndian32(2*w);g.setLittleEndian16(1);g.setLittleEndian16(32);g.setLittleEndian32(0);g.setLittleEndian32(A+I);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);for(k=w-1;0<=k;k--)for(h=0;h<u;h++)w=l[u*k+h],
g.setByte(w&255),g.setByte(w>>8&255),g.setByte(w>>16&255),g.setByte(w>>24&255);g="data:image/x-icon;base64,"+hi5.Base64.enc(g.getData())}this.url=g}var O=[],r=null,C=new hi5.graphic.Rectangle(0,0,0,0),F="Uint8ClampedArray"in window,t=null,P=0,N=0,T=0,Z=0,S=null,pa,y,X=0,ja=0;this.width=a;this.height=b;var V=!1,da=this,ka={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(g){t=g};this.getDirtyArea=function(){return C};this.setImgRect=function(g,l,k,h){P=g;N=l;T=k;Z=h};this.parseMonitorDef=
function(g){var l=g.split(","),k=l.length,h=[];if(1<k){for(var u=!1,w=0;w<k;w++){var D=l[w].split(":");if(4==D.length)h[w]=Array(5),h[w][0]=parseInt(D[0]),h[w][1]=parseInt(D[1]),h[w][2]=parseInt(D[2]),h[w][3]=parseInt(D[3]),h[w][4]=0==h[w][0]&&0==h[w][1]?1:0;else{u=!0;break}}u&&(svGlobal.logger.warn("invaiid monitorDef:"+g),h.length=0)}return h};this.setMonitorLayout=function(g){var l=g.length,k=0;pa=g;for(y=Array(l);k<l;k++)y[k]=new hi5.graphic.Rectangle(0,0,0,0);ja=l};this.setMonitorCount=function(g){ja=
g};this.addImg=function(g){T&&(S&&URL.revokeObjectURL(S.src),S=g)};this.flushImgs=function(){S&&(URL.revokeObjectURL(S.src),S=null,T=0)};this.getData=function(){return O};this.pause=function(g,l){V=g;l&&r&&r.fillRect(0,0,a,b)};this.release=function(){C=null;hi5.Arrays.release(y);da.flushImgs();O=r=da=null;ka=ka.imgData=null};this.isPaused=function(){return V};this.setContext=function(g){g!=r&&(r||!g||g.createImageData(1,1).data.buffer||(F=!1),r=g,null!=r&&(ka.imgData=r.createImageData(a,b)))};this.getContext=
function(){return r};this.resize=function(g,l){if(O.length!=l||O[0].length!=g){for(var k=0;k<l;k++)O[k]=new Uint32Array(g);O.length=l;da.width=a=g;da.height=b=l;null!=r&&(ka.imgData=r.createImageData(a,b))}};da.resize(a,b);this.getBuffer=function(){return O};this.setRGB=function(g,l,k){O[l][g]=k|4278190080};this.getRGB=function(g,l){return O[l][g]};this.setRGBs=function(g,l,k,h,u,w,D){var A=g+k,I=l+h;I>b&&(I=b);if(!(g>=a)){A>a&&(k-=A-a);for(A=l;A<I;A++,w+=D)O[A].set(u.subarray(w,w+k),g);d(g,l,k,h)}};
this.moveArea=function(g,l,k,h,u,w){if(0<w){var D=g+u,A=l+w,I;for(I=h-1;0<=I;I--)O[A+I].set(O[l+I].subarray(g,g+k),D)}else if(0>w)for(D=g+u,A=l+w,I=0;I<h;I++)O[A+I].set(O[l+I].subarray(g,g+k),D);else if(0<u){D=g+u;A=l+w;var W;for(I=k-1;0<=I;I--){var L=D+I;var m=g+I;for(W=0;W<h;W++)O[A+W][L]=O[l+W][m]}}else for(D=g+u,A=l+w,I=0;I<k;I++)for(L=D+I,m=g+I,W=0;W<h;W++)O[A+W][L]=O[l+W][m];d(g+u,l+w,k,h)};this.getRGBs=function(g,l,k,h,u){var w=new Uint32Array(k*h),D=g+k;h=l+h;for(var A=0;l<h;l++)w.set(O[l].subarray(g,
D),A),A+=k;return u?(u(w),null):w};this.repaint=function(g,l,k,h){var u=ka.imgData.data,w=0,D,A;t&&t.begin("paint");0>g&&(k+=g,g=0);0>l&&(h+=l,l=0);g+k>a&&(k=a-g);l+h>b&&(h=b-l);var I=g+k;var W=l+h;if(F)for(u=new Uint32Array(u.buffer),A=l;A<W;A++)u.set(O[A].subarray(g,I),w),w+=a;else{var L=4*(a-k)|0;for(A=l;A<W;A++){for(D=g;D<I;D++){var m=O[A][D];u[w++]=m&255;u[w++]=m>>8&255;u[w++]=m>>16&255;u[w++]=255}w+=L}}ka.left=g;ka.top=l;ka.width=k;ka.height=h;t&&t.end("paint");return ka};this.postPaint=d;this.draw=
function(g,l,k,h){if(!V&&r)if(S&&S.complete&&(r.drawImage(S,P,N,T,Z),URL.revokeObjectURL(S.src),S=null),ja){if(g=e(g,l,k,h),g.width)return da.repaint(g.x,g.y,g.width,g.height),g.width=0,ka}else if(C.width)return da.repaint(C.x,C.y,C.width,C.height),C.width=0,ka;return null};this.fillRect=function(g,l,k,h,u){var w=g+k,D=l+h;if(O[0].fill)for(var A,I=l;I<D;I++)O[I].fill(u,g,w);else for(I=l;I<D;I++)for(A=g;A<w;A++)O[I][A]=u;d(g,l,k,h)};this.drawLine=function(g,l,k,h,u){if(l==h){if(g>k){var w=g;g=k;k=
w}var D=O[l];k++;if(D.fill)D.fill(u,g,k);else for(w=g;w<k;w++)D[w]=u}else if(g==k)for(l>h&&(w=l,l=h,h=w),h++,w=l;w<h;w++)O[w][g]=u;else{var A=Math.abs(k-g),I=Math.abs(h-l);w=g;D=l;k=k>=g?g=1:g=-1;l=h>=l?h=1:h=-1;if(A>=I){l=g=0;var W=A;var L=A/2|0;var m=I}else h=k=0,W=I,L=I/2|0,m=A,A=I;if(!(1>A))for(A++,I=0;I<A;I++)O[D][w]=u,L+=m,L>=W&&(L-=W,w+=g,D+=h),w+=k,D+=l}};this.bitBlt=function(g,l,k,h,u,w,D,A,I,W){var L=da;switch(g){case 0:A=L.setRGB;for(L=k;L<k+u;L++)for(I=h;I<h+w;I++)A(L,I,0);break;case 1:g=
D;I=W*A+I;W=L.setRGB;l=L.getRGB;null==g&&(g=L);for(L=0;L<w;L++){for(D=0;D<u;D++)W(k+u,h+w,~(l(k+u,h+w)|g[I])&16777215);I+=A-u}break;case 2:g=D;I=W*A+I;W=L.setRGB;l=L.getRGB;null==g&&(g=L);for(L=0;L<w;L++){for(D=0;D<u;D++){var m=l(k+u,h+w);W(k+u,h+w,m&~g[I]&16777215);I++}I+=A-u}break;case 3:f(L,D,A,I,W,u,w);D?L.setRGBs(k,h,u,w,D,W*A+I,A):L.moveArea(I,W,u,w,k-I,h-W);break;case 4:f(L,null,l,k,h,u,w);n(L,l,k,h,u,w,D,A,I,W);break;case 5:f(L,null,l,k,h,u,w);break;case 6:g=D;I=W*A+I;null==g&&(g=L);for(L=
0;L<w;L++){for(W=0;W<u;W++)O[h+L][k+W]=O[h+L][k+W]^g[I]&16777215|4278190080,I++;I+=A-u}break;case 7:g=D;I=W*A+I;W=L.setRGB;l=L.getRGB;null==g&&(g=L);for(L=0;L<w;L++){for(D=0;D<u;D++)m=l(k+D,h+L),W(k+D,h+L,~(m&g[I])&16777215),I++;I+=A-u}break;case 8:n(L,l,k,h,u,w,D,A,I,W);break;case 9:g=D;I=W*A+I;W=L.setRGB;l=L.getRGB;null==g&&(g=L);for(L=0;L<w;L++){for(D=0;D<u;D++)m=l(k+D,h+L),W(k+D,h+L,m^~g[I]&16777215),I++;I+=A-u}break;case 10:break;case 11:g=D;I=W*A+I;W=L.setRGB;l=L.getRGB;null==g&&(g=L);for(L=
0;L<w;L++){for(D=0;D<u;D++)m=l(k+D,h+L),W(k+D,h+L,m|~g[I]&16777215),I++;I+=A-u}break;case 12:D?L.setRGBs(k,h,u,w,D,W*A+I,A):L.moveArea(I,W,u,w,k-I,h-W);break;case 13:f(L,null,l,k,h,u,w);H(L,l,k,h,u,w,D,A,I,W);break;case 14:H(L,l,k,h,u,w,D,A,I,W);break;case 15:A=L.setRGB;for(L=k;L<k+u;L++)for(I=h;I<h+w;I++)A(L,I,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+g)}d(k,h,u,w)};this.drawLineExt=function(g,l,k,h,u,w){if(g==k||l==h){var D;if(l==h)if(k>g){var A=k-g;if(!(1>A))for(D=0;D<
A;D++)z(w,g+D,l,u)}else{if(A=g-k,!(1>A))for(D=0;D<A;D++)z(w,k+D,l,u)}else if(h>l){if(A=h-l,!(1>A))for(D=0;D<A;D++)z(w,g,l+D,u)}else if(A=l-h,!(1>A))for(D=0;D<A;D++)z(w,g,h+D,u)}else{var I=Math.abs(k-g),W=Math.abs(h-l);D=g;A=l;var L,m;var K=k>=g?L=1:L=-1;var G=h>=l?m=1:m=-1;if(I>=W){G=L=0;var Q=I;var ba=I/2>>0;var oa=W}else m=K=0,Q=W,ba=W/2>>0,oa=I,I=W;if(1>I)return;for(W=0;W<=I;W++)z(w,D,A,u),ba+=oa,ba>=Q&&(ba-=Q,D+=L,A+=m),D+=K,A+=G}u=Math.min(g,k);g=Math.max(g,k);k=Math.min(l,h);l=Math.max(l,h);
0>g-u||0>l-k||d(u,k,g-u+1,l-k+1)};this.drawText=function(g,l,k,h,u,w,D,A,I,W,L,m,K,G,Q,ba,oa,xa,Da,Ia,Fa){var za=0;1<m?E(W,L,m,K,u,xa,Da,Ia,Fa):1==k&&E(w,D,A,I,u,xa,Da,Ia,Fa);for(var Ga=ba,wa=0;wa<ba;)switch(oa[za+wa]){case 255:var Aa=oa[za+wa+2];if(Aa>Ga-za){wa=ba=0;break}Aa=oa.slice?oa.slice(za,za+Aa):oa.subarray(za,za+Aa);ea[oa[za+wa+1]]=Aa;wa+=3;ba-=wa;za=wa;wa=0;break;case 254:var Oa=(Aa=ea[oa[za+wa+1]])?Aa:null;Oa&&0==Oa[1]&&0==(l&32)&&(0!=(l&4)?Q+=oa[za+wa+2]:G+=oa[za+wa+2]);wa=wa+2<ba?wa+
3:wa+2;ba-=wa;za=wa;wa=0;if(!Oa)break;for(var Za=Oa.length,$a=0;$a<Za;$a++){Aa=qa.getFont(g,Oa[$a]);if(0==(l&32)){var Xa=Oa[++$a];0!=(Xa&128)?(0!=(l&4)?Q+=Oa[$a+1]|Oa[$a+2]<<8:G+=Oa[$a+1]|Oa[$a+2]<<8,$a+=2):0!=(l&4)?Q+=Xa:G+=Xa}Aa&&(B(k,G+Aa.offset&65535,Q+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,u,h,xa,Da,Ia,Fa),0!=(l&32)&&(G+=Aa.width))}break;default:Aa=qa.getFont(g,oa[za+wa]),0==(l&32)&&(Xa=oa[za+ ++wa],0!=(Xa&128)?(0!=(l&4)?Q+=oa[za+wa+1]|oa[za+wa+2]<<8:G+=oa[za+wa+1]|oa[za+wa+2]<<8,wa+=
2):0!=(l&4)?Q+=Xa:G+=Xa),Aa&&(B(k,G+Aa.offset&65535,Q+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,u,h,xa,Da,Ia,Fa),0!=(l&32)&&(G+=Aa.width)),wa++}1<m?0<K&&d(W,L,m,K):0<A&&0<I&&d(w,D,A,I)};this.drawBitmap=function(g,l,k,h,u,w,D,A,I){var W=Sa.getBitmap(g,l);W?(g=W.width,l=W.height,u>g&&(u=g),w>l&&(w=l),12==I?da.setRGBs(k,h,u,w,W.data,A*g+D,g):da.bitBlt(I,a,k,h,u,w,W.data,g,D,A)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+g+" idx="+l)};this.saveDesktop=function(g,l,k,h,u){da.getRGBs(g,
l,k,h,function(w){ma.save(g,l,k,h,u,w)})};this.restoreDesktop=function(g,l,k,h,u){(u=ma.restore(g,l,k,h,u))?da.setRGBs(g,l,k,h,u,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(g,l,k){qa.putFont(g,l,k)};this.putBitmap=function(g,l,k){Sa.putBitmap(g,l,k)};this.putCursor=function(g,l){fa.set(g,l)};this.setCursor=function(g){if(!V&&-1!=g){var l=fa.get(g);if(l)da.onSetCursor(l);else svGlobal.logger.warn("invalid cursor"+g)}};var va=0;this.isSendingHistory=function(){return 2E3>
Date.now()-va};this.getHistory=function(g,l){var k=null;(k=fa.toPDU())&&g(k.buffer);if(da.onGetGfxHistory)da.onGetGfxHistory(g,l);else{t&&t.begin("his_bitmap");Sa.forEach(function(A,I,W){if(A){var L=0,m=0;W=0;for(var K=A.length;W<K;W++)A[W]&&A[W].data&&(L++,m+=A[W].raw?A[W].raw.length:4*A[W].data.length);if(L&&m){k=new Uint8Array(m+20*L+8);k[0]=29;k[2]=1;k[3]=4;m=new hi5.DataBuffer(k,4,k.length);m.setLittleEndian32(L);for(W=0;W<K;W++)(L=A[W])&&L.data&&(m.setLittleEndian16(I),m.setLittleEndian16(W),
m.setLittleEndian16(L.left),m.setLittleEndian16(L.top),m.setLittleEndian16(L.width),m.setLittleEndian16(L.height),m.setLittleEndian16(L.bitsperpixel),m.setLittleEndian16(L.codec),m.setLittleEndian32(L.raw?L.raw.length:4*L.data.length),m.setBytes(L.raw||new Uint8Array(L.data.buffer)));g(k.buffer)}}});t&&t.end("his_bitmap");t&&t.begin("his_font");(k=qa.toPDU())&&g(k.buffer);t&&t.end("his_font");for(var h=4,u=0,w=ea.length;u<w;u++)ea[u]&&(h+=ea[u].length+6);if(4<h){k=new Uint8Array(h);k[0]=29;k[2]=1;
k[3]=7;var D=4;u=0;for(w=ea.length;u<w;u++)ea[u]&&ea[u].length&&(k[D++]=u,k[D++]=u>>8,h=ea[u].length,k[D++]=h,k[D++]=h>>8,k[D++]=h>>16,k[D++]=h>>24,k.set(ea[u],D),D+=h);g(k.buffer)}(k=ma.toPDU())&&g(k.buffer);l();va=Date.now()}};this.onHistoryDone=function(){da.onGetGfxHistory&&p.reconnect(a,b,!0)};this.setHistory=function(g,l){svGlobal.logger.info("setHistory type:"+g);switch(g){case 4:t&&t.begin("his_bitmap_dec");var k=l.getLittleEndian32();for(g=0;g<k;g++){var h=l.getLittleEndian16(),u=l.getLittleEndian16(),
w=l.getLittleEndian16(),D=l.getLittleEndian16(),A=l.getLittleEndian16(),I=l.getLittleEndian16(),W=l.getLittleEndian16(),L=l.getLittleEndian16(),m=l.getLittleEndian32(),K=new Uint8Array(l.getData().buffer,l.getPosition(),m),G=new Uint8Array(m);G.set(K);K=rdpcodecs.bitmap;switch(L){case 0:var Q=new Uint32Array(G.buffer);l.skipPosition(m);break;case 1:switch(W){case 16:Q=K.decompressInt16(A,I,m,G,0);break;case 24:Q=K.decompressInt24(A,I,m,G,0);break;case 32:Q=K.decompressInt32(A,I,m,G,0)}l.skipPosition(m);
break;case 2:Q=new rdpcodecs.NSCodec,Q.process(l,W,A,I),m=Q.getData(),Q=Q.getDataSize(),Q=new Uint32Array(Q),rdpcodecs.flipimage(m,0,Q,A,I,1)}Sa.putBitmap(h,u,new rdpcodecs.Bitmap(Q,A,I,w,D,W,0==L?null:G,L))}t&&t.end("his_bitmap_dec");break;case 5:qa.fromStream(l);break;case 6:fa.fromStream(l);break;case 7:for(;l.has(6);)if(g=l.getLittleEndian16(),m=l.getLittleEndian32())k=l.getData().subarray(l.getPosition(),l.getPosition()+m),ea[g]=k,l.skipPosition(m);break;case 9:ma.fromStream(l);break;default:if(da.onSetGfxHistory)da.onSetGfxHistory(g,
l)}};var fa=new function(){var g=[],l=!1;this.useRemoteCursor=function(k){l=k};this.set=function(k,h){l&&(h.system="");g[k]=h};this.get=function(k){return g[k]};this.total=function(){return g.length};this.toPDU=function(){for(var k=2,h=2,u=0,w=0,D=g.length,A;w<D;w++)if(A=g[w])u++,h=h+7+(A.rawData?A.rawData.length:0);if(!u)return null;h=new Uint32Array(h);h[0]=100728861;h[1]=u;for(w=0;w<D;w++)if(A=g[w])if(u=A.rawData?A.rawData.length:0,h[k++]=A.cache_idx|A.bpp<<16,h[k++]=A.hotX|A.hotY<<16,h[k++]=A.width|
A.height<<16,h[k++]=A.xorSize,h[k++]=A.andSize,h[k++]=A.distance,h[k++]=u)h.set(A.rawData,k),k+=u;return h};this.fromStream=function(k){var h=k.getPosition();k=new Uint32Array(k.getData().buffer,h);var u=k[0],w=0;for(h=1;w<u;w++){var D=k[h]&65535;var A=k[h++]>>16;var I=k[h]&65535;var W=k[h++]>>16;var L=k[h]&65535;var m=k[h++]>>16;var K=k[h++];var G=k[h++];var Q=k[h++];var ba=k[h++];var oa=null;ba&&(oa=new Uint32Array(ba),oa.set(k.subarray(h,h+ba)),h+=ba);A=new x(D,oa,I,W,L,m,A,K,G);Q&&(A.distance=
Q);l&&(A.system="");g[D]=A}}};fa.useRemoteCursor(!!ha.remoteCursor);var ma=new function(){function g(k,h,u,w,D,A){this.x=k;this.y=h;this.cx=u;this.cy=w;this.offset=D;this.data=A}var l=[];this.save=function(k,h,u,w,D,A){k=new g(k,h,u,w,D,A);h=0;for(u=l.length;h<u;h++)if(!l[h]){l[h]=k;return}l.push(k)};this.restore=function(k,h,u,w,D){for(var A,I=0,W=l.length;I<W;I++)if((A=l[I])&&A.x==k&&A.y==h&&A.cx==u&&A.cy==w){if(A.offset==D)return k=A.data,l[I]=null,k;svGlobal.logger.warn("TODO: offset")}return null};
this.toPDU=function(){for(var k=0,h=2,u=0,w=l.length;u<w;u++)l[u]&&(k++,h+=l[u].data.length+6);if(!k||!h)return null;h=new Uint32Array(h);var D=2;h[0]=151060509;h[1]=k;for(u=0;u<w;u++)if(k=l[u])h[D++]=k.x,h[D++]=k.y,h[D++]=k.cx,h[D++]=k.cy,h[D++]=k.offset,h[D++]=k.data.length,h.set(k.data,D),D+=k.data.length;return h};this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());for(var h=1,u=k[0],w,D,A,I,W,L,m,K=0;K<u;K++)w=k[h++],D=k[h++],A=k[h++],I=k[h++],W=k[h++],L=k[h++],
m=new Uint32Array(L),L=h+L,m.set(k.subarray(h,L)),h=L,this.save(w,D,A,I,W,m)}},ea=[],qa=new function(){var g=[];this.putFont=function(l,k,h){g[l]||(g[l]=[]);g[l][k]=h};this.getFont=function(l,k){return g[l]?g[l][k]:null};this.toPDU=function(){var l=0,k,h,u;var w=4;for(var D,A=g.length;l<A;l++)if((u=g[l])&&u.length)for(D=u.length,k=0;k<D;k++)(h=u[k])&&(w+=15+h.fontData.length);if(5>w)return null;var I=new Uint8Array(w);w=new hi5.DataBuffer(I,0,w);I[0]=29;I[2]=1;I[3]=5;w.skipPosition(4);l=0;for(A=g.length;l<
A;l++)if((u=g[l])&&u.length)for(D=u.length,k=0;k<D;k++)if(h=u[k])w.setByte(l),w.setLittleEndian16(k),w.setLittleEndian16(h.offset),w.setLittleEndian16(h.baseLine),w.setLittleEndian16(h.width),w.setLittleEndian16(h.height),w.setLittleEndian32(h.fontData.length),w.setBytes(h.fontData);return I};this.fromStream=function(l){for(;l.has(15);){var k=l.getByte(),h=l.getLittleEndian16(),u=l.getLittleEndian16(),w=l.getLittleEndian16(),D=l.getLittleEndian16(),A=l.getLittleEndian16(),I=l.getLittleEndian32();
I=l.getBytes(I);this.putFont(k,h,new v(u,w,D,A,I))}}},Sa=new function(){var g=[],l=[];this.putBitmap=function(k,h,u){if(32767==h)l[k]&&(l[k].data=null,l[k]=null),l[k]=u;else{var w=g[k];w?w[h]&&(w[h].data=null,w[h]=null):g[k]=w=[];w[h]=u}};this.getBitmap=function(k,h){return 32767==h?l[k]:g[k]?g[k][h]:null};this.forEach=function(k){for(var h=g.length,u=0;u<h;u++)k(g[u],u,g)}}}function Lb(a){function b(m,K,G){K[G]=m>>24&255;K[G+1]=m>>16&255;K[G+2]=m>>8&255;K[G+3]=m&255}function c(m,K){var G=m.length;
K=new Uint8Array(K?G+1:G);for(var Q=0;Q<G;Q++)K[Q]=m.charCodeAt(Q);return K}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),f={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},n=this,H=1,z=a?48E3:9E4,E=1,B=!1,v=null;this.initTypes=function(){for(var m in f)f[m]=
[m.charCodeAt(0),m.charCodeAt(1),m.charCodeAt(2),m.charCodeAt(3)];f.url=[117,114,108,32]};n.initTypes();this.reset=function(){B=!1;E=H=1};this.close=function(){n&&(n.reset(),n=null)};this.remux=function(m){m.id=H;m.isAudio=a;m.timeScale=a?m.audioHeader.sampleRate:z;if(!B){var K=new O(a),G=new r(m);v=new Uint8Array(K.data.length+G.data.length);v.set(K.data,0);v.set(G.data,K.data.length);B=!0}m.sequenceNumber=E++;K=new u(m);G=new L(m);m=new Uint8Array(K.data.length+G.data.length);m.set(K.data,0);m.set(G.data,
K.data.length);v&&(K=new Uint8Array(v.length+m.length),K.set(v,0),K.set(m,v.length),m=K,v=null);if(n.ondata)n.ondata(m)};var x=function(m){this.type=m;this.data=null};x.prototype.setData=function(){var m=Array.prototype.slice.call(arguments,0),K=m.length,G=8,Q;for(Q=0;Q<K;Q++)G+=m[Q].byteLength;this.data=new Uint8Array(G);b(G,this.data,0);this.data.set(this.type,4);G=8;for(Q=0;Q<K;Q++)this.data.set(m[Q],G),G+=m[Q].byteLength};var O=function(m){var K=x.call(this,f.ftyp)||this;var G=c("mp42"),Q=c("mp41"),
ba=c("isom"),oa=c("avc1"),xa=c("iso5"),Da=new Uint8Array([0,0,2,0]);m?K.setData(G,Da,G,Q,ba,xa):K.setData(ba,Da,ba,Q,xa,oa);return K};$jscomp.inherits(O,x);var r=function(m){var K=x.call(this,f.moov)||this;var G=new C(m),Q=new F(m);m=new k(m);K.setData(G.data,Q.data,m.data);return K};$jscomp.inherits(r,x);var C=function(m){m=x.call(this,f.mvhd)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]),oa=new Uint8Array(4);b(1E3,oa,0);var xa=
new Uint8Array([0,1,0,0]),Da=new Uint8Array([1,0]),Ia=new Uint8Array(10),Fa=new Uint8Array(36);Fa[1]=1;Fa[17]=1;Fa[32]=64;var za=new Uint8Array(24),Ga=new Uint8Array([255,255,255,255]);m.setData(K,G,Q,ba,oa,e,xa,Da,Ia,Fa,za,Ga);return m};$jscomp.inherits(C,x);var F=function(m){var K=x.call(this,f.trak)||this;var G=new t(m);m=new P(m);K.setData(G.data,m.data);return K};$jscomp.inherits(F,x);var t=function(m){var K=x.call(this,f.tkhd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,7]),ba=new Uint8Array([0,
0,0,0]),oa=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.id,xa,0);var Da=new Uint8Array(4),Ia=new Uint8Array(8),Fa=new Uint8Array([0,0]),za=new Uint8Array([0,0]),Ga=m.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),wa=new Uint8Array(2),Aa=new Uint8Array(36);Aa[1]=1;Aa[17]=1;Aa[32]=64;var Oa=new Uint8Array(4);Oa[0]=m.width>>8&255;Oa[1]=m.width&255;Oa[2]=0;Oa[3]=0;var Za=new Uint8Array(4);Za[0]=m.height>>8&255;Za[1]=m.height&255;Za[2]=0;Za[3]=0;K.setData(G,Q,ba,oa,xa,Da,e,Ia,Fa,za,Ga,wa,Aa,
Oa,Za);return K};$jscomp.inherits(t,x);var P=function(m){var K=x.call(this,f.mdia)||this;var G=new N(m),Q=new T(m);m=new Z(m);K.setData(G.data,Q.data,m.data);return K};$jscomp.inherits(P,x);var N=function(m){var K=x.call(this,f.mdhd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,0]),oa=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.timeScale,xa,0);m=new Uint8Array([85,196]);var Da=new Uint8Array(2);K.setData(G,Q,ba,oa,xa,e,m,Da);return K};$jscomp.inherits(N,
x);var T=function(m){var K=x.call(this,f.hdlr)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array(4);m=m.isAudio?c("soun"):c("vide");var oa=new Uint8Array(12),xa=c("Remote Spark Handler",!0);K.setData(G,Q,ba,m,oa,xa);return K};$jscomp.inherits(T,x);var Z=function(m){var K=x.call(this,f.minf)||this;var G=new y,Q=new V(m);m.isAudio?(m=new pa,K.setData(m.data,G.data,Q.data)):(m=new S,K.setData(m.data,G.data,Q.data));return K};$jscomp.inherits(Z,x);var S=function(){var m=x.call(this,
f.vmhd)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,1]),Q=new Uint8Array([0,0]),ba=new Uint8Array(6);m.setData(K,G,Q,ba);return m};$jscomp.inherits(S,x);var pa=function(){var m=x.call(this,f.smhd)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0]),ba=new Uint8Array(2);m.setData(K,G,Q,ba);return m};$jscomp.inherits(pa,x);var y=function(){var m=x.call(this,f.dinf)||this;var K=new X;m.setData(K.data);return m};$jscomp.inherits(y,x);var X=function(){var m=x.call(this,
f.dref)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,1]),ba=new ja;m.setData(K,G,Q,ba.data);return m};$jscomp.inherits(X,x);var ja=function(){var m=x.call(this,f.url)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,1]);m.setData(K,G);return m};$jscomp.inherits(ja,x);var V=function(m){var K=x.call(this,f.stbl)||this;m=new da(m);var G=new qa,Q=new Sa,ba=new g,oa=new l;K.setData(m.data,G.data,Q.data,ba.data,oa.data);return K};$jscomp.inherits(V,x);var da=function(m){var K=
x.call(this,f.stsd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,1]);m.isAudio?(m=new ka(m),K.setData(G,Q,ba,m.data)):(m=new fa(m),K.setData(G,Q,ba,m.data));return K};$jscomp.inherits(da,x);var ka=function(m){var K=x.call(this,f.mp4a)||this;var G=new Uint8Array(6),Q=new Uint8Array([0,1]),ba=new Uint8Array(8),oa=new Uint8Array([0,2]),xa=new Uint8Array([0,16]),Da=new Uint8Array([0,0]),Ia=new Uint8Array(2),Fa=m.audioHeader.sampleRate,za=new Uint8Array(4);za[0]=Fa>>
8&255;za[1]=Fa&255;za[2]=0;za[3]=0;m=new va(m);K.setData(G,Q,ba,oa,xa,Da,Ia,za,m.data);return K};$jscomp.inherits(ka,x);var va=function(m){var K=x.call(this,f.esds)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array([3]),oa=new Uint8Array([25]),xa=new Uint8Array([0,0]),Da=new Uint8Array([0]),Ia=new Uint8Array([4]),Fa=new Uint8Array([17]),za=new Uint8Array([64]),Ga=new Uint8Array([21]),wa=new Uint8Array(3),Aa=m.bufferSizeDB;wa[0]=Aa>>16&255;wa[1]=Aa>>8&255;wa[2]=Aa&255;Aa=
new Uint8Array(4);b(m.bitRate,Aa,0);var Oa=new Uint8Array(4);b(m.bitRate,Oa,0);var Za=new Uint8Array([5]),$a=new Uint8Array([2]),Xa=m.audioHeader.audioType||2,mb=m.audioHeader.frequencyIdx,wb=m.audioHeader.channelConfig;m=new Uint8Array(2);m[0]=Xa<<3|mb>>1&7;m[1]=(mb&1)<<7|wb<<3;Xa=new Uint8Array([6]);mb=new Uint8Array([1]);wb=new Uint8Array([2]);K.setData(G,Q,ba,oa,xa,Da,Ia,Fa,za,Ga,wa,Aa,Oa,Za,$a,m,Xa,mb,wb);return K};$jscomp.inherits(va,x);var fa=function(m){var K=x.call(this,f.avc1)||this;var G=
new Uint8Array(6),Q=new Uint8Array([0,1]),ba=new Uint8Array([0,0]),oa=new Uint8Array(2),xa=new Uint8Array(12),Da=new Uint8Array(2);Da[0]=m.width>>8&255;Da[1]=m.width&255;var Ia=new Uint8Array(2);Ia[0]=m.height>>8&255;Ia[1]=m.height&255;var Fa=new Uint8Array([0,72,0,0]),za=new Uint8Array([0,72,0,0]),Ga=new Uint8Array(4),wa=new Uint8Array([0,1]),Aa=c("SparkStreamPlayer"),Oa=new Uint8Array(32);Oa[0]=Aa.length;Oa.set(Aa,1);Aa=new Uint8Array([0,24]);var Za=new Uint8Array([255,255]);m=new ma(m);K.setData(G,
Q,ba,oa,xa,Da,Ia,Fa,za,Ga,wa,Oa,Aa,Za,m.data);return K};$jscomp.inherits(fa,x);var ma=function(m){var K=x.call(this,f.avcC)||this;var G=new Uint8Array([1]),Q=new Uint8Array([m.sps[1]]),ba=new Uint8Array([m.sps[2]]),oa=new Uint8Array([m.sps[3]]),xa=new Uint8Array([255]),Da=new Uint8Array([225]),Ia=new Uint8Array(2),Fa=m.sps.byteLength;Ia[0]=Fa>>8&255;Ia[1]=Fa&255;Fa=new Uint8Array(m.sps);var za=new Uint8Array([1]),Ga=new Uint8Array(2),wa=m.pps.byteLength;Ga[0]=wa>>8&255;Ga[1]=wa&255;m=new Uint8Array(m.pps);
K.setData(G,Q,ba,oa,xa,Da,Ia,Fa,za,Ga,m);return K};$jscomp.inherits(ma,x);var ea=function(){var m=x.call(this,f.btrt)||this;var K=new Uint8Array([0,28,156,128]),G=new Uint8Array([0,45,198,192]),Q=new Uint8Array([0,45,198,192]);m.setData(K,G,Q);return m};$jscomp.inherits(ea,x);var qa=function(){var m=x.call(this,f.stts)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]);m.setData(K,G,Q);return m};$jscomp.inherits(qa,x);var Sa=function(){var m=x.call(this,f.stsc)||
this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]);m.setData(K,G,Q);return m};$jscomp.inherits(Sa,x);var g=function(){var m=x.call(this,f.stsz)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]);m.setData(K,G,Q,ba);return m};$jscomp.inherits(g,x);var l=function(){var m=x.call(this,f.stco)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]),Q=new Uint8Array([0,0,0,0]);m.setData(K,G,Q);return m};
$jscomp.inherits(l,x);var k=function(m){var K=x.call(this,f.mvex)||this;m=new h(m);K.setData(m.data);return K};$jscomp.inherits(k,x);ea=function(m){m=x.call(this,f.mehd)||this;var K=new Uint8Array([0]),G=new Uint8Array([0,0,0]);m.setData(K,G,d);return m};$jscomp.inherits(ea,x);var h=function(m){var K=x.call(this,f.trex)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m.id,ba,0);m=new Uint8Array([0,0,0,1]);var oa=new Uint8Array([0,0,0,0]),xa=new Uint8Array([0,0,0,0]),
Da=new Uint8Array([0,0,0,0]);K.setData(G,Q,ba,m,oa,xa,Da);return K};$jscomp.inherits(h,x);var u=function(m){var K=x.call(this,f.moof)||this;w.setSequenceNumber(m.sequenceNumber);m=new D(m);K.setData(w.data,m.data);return K};$jscomp.inherits(u,x);ea=function(m){var K=x.call(this,f.mfhd)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m,ba,0);K.setData(G,Q,ba);return K};$jscomp.inherits(ea,x);ea.prototype.setSequenceNumber=function(m){b(m,this.data,12)};var w=new ea(1),
D=function(m){var K=x.call(this,f.traf)||this;A.setTrackId(m.id);A.setSampleDuration(m.frameDuration);I.setBaseMediaDecodeTime(m.samples[0].timestamp);var G=32+A.data.length+I.data.length;if(m.isAudio)m=new W(m,null,G);else{for(var Q=[],ba=0;ba<m.samples.length;ba++){var oa=m.samples[ba];Q.push({size:oa.unitsLength+4*oa.units.length,duration:m.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:oa.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:oa.hasIDR?0:1,degradationPriority:0}})}m=
new W(m,Q,G)}K.setData(A.data,I.data,m.data);return K};$jscomp.inherits(D,x);ea=function(m,K){var G=x.call(this,f.tfhd)||this;G.isAudio=K;var Q=new Uint8Array([0]),ba=K?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),oa=new Uint8Array(4);b(m,oa,0);K?(m=new Uint8Array([0,0,0,1]),K=new Uint8Array(4),b(1024,K,0),G.setData(Q,ba,oa,m,K)):(m=new Uint8Array([0,0,2,0,1,1,0,0]),G.setData(Q,ba,oa,m));return G};$jscomp.inherits(ea,x);ea.prototype.setTrackId=function(m){b(m,this.data,12)};ea.prototype.setSampleDuration=
function(m){this.isAudio||b(m,this.data,16)};var A=new ea(0,a);ea=function(m){var K=x.call(this,f.tfdt)||this;var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m,ba,0);K.setData(G,Q,ba);return K};$jscomp.inherits(ea,x);ea.prototype.setBaseMediaDecodeTime=function(m){b(m,this.data,12)};var I=new ea(0),W=function(m,K,G){var Q=x.call(this,f.trun)||this;var ba=new Uint8Array([0]),oa=m.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,15,1]),xa=m.isAudio?4:16;G+=xa*(m.isAudio?
m.samples.length:K.length)+28;var Da=new Uint8Array(4);m.isAudio?b(m.samples.length,Da,0):b(K.length,Da,0);var Ia=new Uint8Array(4);b(G,Ia,0);if(m.isAudio){G=new Uint8Array(xa*m.samples.length);for(var Fa=0;Fa<m.samples.length;Fa++)b(m.samples[Fa].aacData.byteLength,G,xa*Fa)}else for(G=new Uint8Array(xa*K.length),Fa=0;Fa<K.length;Fa++){m=K[Fa];var za=xa*Fa;b(m.duration,G,za);b(m.size,G,za+4);var Ga=m.flags,wa=new Uint8Array(4);wa[0]=Ga.isLeading<<2|Ga.dependsOn;wa[1]=Ga.isDependedOn<<6|Ga.hasRedundancy<<
4|0|Ga.isNonSync;wa[2]=Ga.degradationPriority&61440;wa[3]=Ga.degradationPriority&15;G.set(wa,za+8);b(m.compositionTimeOffset,G,za+12)}Q.setData(ba,oa,Da,Ia,G);return Q};$jscomp.inherits(W,x);ea=function(m){var K=x.call(this,f.sdtp)||this;for(var G=new Uint8Array([0]),Q=new Uint8Array([0,0,0]),ba=new Uint8Array(m.length),oa=0;oa<m.length;oa++){var xa=m[oa].flags;ba[oa]=xa.isLeading<<6|xa.dependsOn<<4|Q.isDependedOn<<2|Q.hasRedundancy}K.setData(G,Q,ba);return K};$jscomp.inherits(ea,x);var L=function(m){var K=
x.call(this,f.mdat)||this;if(m.isAudio){for(var G=new Uint8Array(m.totalByteLength),Q=0,ba=0;ba<m.samples.length;ba++){var oa=m.samples[ba].aacData;G.set(oa,Q);Q+=oa.byteLength}K.setData(G)}else{G=new Uint8Array(4*m.unitNum+m.totalByteLength);for(ba=Q=0;ba<m.samples.length;ba++){oa=m.samples[ba];for(var xa=0;xa<oa.units.length;xa++){var Da=oa.units[xa],Ia=Da.data.byteLength;b(Ia,G,Q);Q+=4;G.set(Da.data,Q);Q+=Ia}}K.setData(G)}return K};$jscomp.inherits(L,x)}function qc(a){function b(E,B){this.aacData=
E;this.timestamp=B}function c(E,B,v,x){this.audioType=E;this.frequencyIdx=B;this.sampleRate=v;this.channelConfig=x}var e=qc.SAMPLING_FREQUENCY,d=null,f=!0,n=this,H=0;this.reset=function(){H=0;d=null;z.audioHeader=null;a&&a.reset()};var z=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=
function(E,B){var v=E.frequencyIdx;v||(v=e.indexOf(E.sampleRate));-1==v&&console.error("Invalid AAC sampel rate: "+E.sampleRate);d=new c(E.audioType||2,v,E.sampleRate,E.channels||E.channelConfig);z.audioHeader=d;f=!B;if(n.oncodec)n.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(E){if(f){var B=n.readADTSHeader(E);E=E.subarray(B)}B=new b(E,H);H+=1024;z.samples.push(B);z.totalByteLength+=E.byteLength;E=1/(d.sampleRate/1024);z.duration=E;z.samples[0]&&(z.bitRate=8*z.samples[0].aacData.length/
E|0);a&&a.remux(z);z.clear()};this.readADTSHeader=function(E){var B=E[1]&0?9:7,v=(E[2]>>6&3)+1,x=E[2]>>2&15,O=e[x];O||console.error("Invalid Sampling Frequency Index: "+x);var r=((E[2]&1)<<2)+(E[3]>>6&3),C=E[1]>>1&3;0!=C&&console.error("Invalid data format: layer is not 0x00: "+C.toString(16));E.length!=((E[3]&3)<<11)+(E[4]<<3)+(E[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+E.length);if(d){if(x!=d.frequencyIdx&&(d.frequencyIdx=x,d.sampleRate=O,n.oncodec))n.oncodec("mp4a.40.2",
d)}else if(d=new c(v,x,O,r),z.audioHeader=d,n.oncodec)n.oncodec("mp4a.40.2",d);return B}}function Uc(a){function b(){if(0==H)console.error("no more ExpGolomb data");else{var B=0,v=n-H;for(z=0;v<n;){var x=a[v];if(3!=x||0!=a[v-1]||0!=a[v-2])z=z<<8|x,B++;v++;if(4<=B)break}4>B&&(z<<=4-B);E=8*B;H=n-v}}function c(B){if(!(E>B)){B-=E;var v=B>>3;B-=v>>3;H-=v;b()}z<<=B;E-=B}function e(B){var v=Math.min(E,B),x=z>>>32-v;32<B&&logger.error("Read more than 32 bits:"+B);E-=v;0<E?z<<=v:0<H&&b();v=B-v;return 0<v?
x<<v|e(v):x}function d(){var B;for(B=0;B<E;++B)if(0!==(z&2147483648>>>B))return z<<=B,E-=B,B;b();return B+d()}function f(){c(1+d())}var n=a.byteLength,H=n,z=0,E=0;this.readUEG=function(){var B=d();return e(B+1)-1};this.readEG=function(){var B=this.readUEG();return 1&B?1+B>>>1:-1*(B>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(B){var v=8,x=8,O;for(O=0;O<B;O++)0!==
x&&(x=this.readEG(),x=(v+x+256)%256),v=0===x?v:x};this.readSPS=function(){var B=0,v=0,x=0,O=0,r=1,C,F=0,t=!0;if(7>a.length)return console.log("no enought SPS data"),null;var P=this.readU8();if(7!=(P&31))return console.error("Invalid SPS type: "+P,a),null;P=this.readU8();e(5);c(3);this.readU8();f();if(100===P||110===P||122===P||244===P||44===P||83===P||86===P||118===P||128===P||138===P||139===P||134===P||135===P){var N=this.readUEG();3===N&&c(1);f();f();c(1);if(this.readBool()){var T=3!==N?8:12;for(C=
0;C<T;C++)this.readBool()&&(6>C?this.skipScalingList(16):this.skipScalingList(64))}}f();C=this.readUEG();if(0===C)this.readUEG();else if(1===C)for(c(1),c(1+d()),c(1+d()),T=this.readUEG(),C=0;C<T;C++)c(1+d());f();c(1);var Z=this.readUEG();C=this.readUEG();T=e(1);0===T&&c(1);c(1);this.readBool()&&(B=this.readUEG(),v=this.readUEG(),x=this.readUEG(),O=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=
[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}S&&(r=S[0]/S[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&c(24));this.readBool()&&(f(),f());this.readBool()&&(F=this.readU32(),
S=this.readU32(),t=this.readBool(),F=S/(2*F))}r=Math.ceil((16*(Z+1)-2*B-2*v)*r);S=(2-T)*(C+1)*16-(T?2:4)*(x+O);C="avc1."+(0==a[1]?"00":a[1].toString(16));C+=0==a[2]?"00":a[2].toString(16);C+=0==a[3]?"00":a[3].toString(16);return{width:r,height:S,profileIdc:P,chromaFormatIdc:N,frameCropLeftOffset:B,frameCropRightOffset:v,frameCropTopOffset:x,frameCropBottomOffset:O,fps:F,fixedFrameRate:t,codec:C}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Pd(a){function b(){this.height=
this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=H;this.unitsLength=z;this.timestamp=d;this.hasIDR=f}function e(){var x=!1;if(n&&B.sps){var O=new c;d+=B.frameDuration||3E3;B.samples.push(O);B.totalByteLength+=z;B.unitNum+=H.length;B.sequence++;x=!0;if(O.hasIDR&&v.onkeyframe)v.onkeyframe(O)}n=f=!1;H=[];z=0;return x}
var d=0,f=!1,n=!1,H=[],z=0,E=Lb.searchStartCode,B=null,v=this;B=new b;this.reset=function(){d=0;f=!1;H=[];z=0;B=new b;a&&a.reset()};this.close=function(){v&&(v.reset(),v=null)};this.parseH264Data=this.parse=function(x){for(var O=[],r=0,C,F,t,P=[0,0];r<x.byteLength;){P[0]=r;E(x,P);var N=P[0];if(-1==N)break;r=P[1];r=N+r;t=x[r];t&=31;C&&(C={type:F,data:x.subarray(C,N)},O.push(C));C=r;F=t}C&&(C={type:F,data:x.subarray(C,x.byteLength)},O.push(C));for(x=0;x<O.length;x++)switch(P=O[x],r=P.type,r){case 1:case 2:case 3:case 4:H.push(P);
z+=P.data.byteLength;n=!0;break;case 5:n=f=!0;H.push(P);z+=P.data.byteLength;break;case 6:break;case 7:r=new Uc(P.data);if(r=r.readSPS()){if(B.width=r.width,B.height=r.height,B.codec=r.codec,B.sps=P.data,r.fps&&(B.frameDuration=9E4/r.fps|0),H.push(P),z+=P.data.byteLength,v.oncodec)v.oncodec(B.codec,r)}else console.log("corrupted sps",P.data);break;case 8:B.pps=P.data;H.push(P);z+=P.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+r)}e()&&B.sps&&(a.remux(B),
B.clear())}}function Mb(a,b,c){function e(){for(;z;){if(F.updating){z=!1;break}var N=H.shift();if(!N)break;try{F.appendBuffer(N),E=0}catch(T){H.unshift(N);if("QuotaExceededError"==T.name)if(n(!0))continue;else{if(B.onerror)B.onerror(T);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),B.close();break}E++;console.error("Failed to append buffer, retry "+E,T);if(2<E){if(B.onerror)B.onerror(T);break}}}}function d(){z=!0;e()}function f(){F=C.addSourceBuffer(v);F.mode="sequence";F.addEventListener("updateend",
d);F.addEventListener("error",function(N){console.error(N)});z=!0;B.play(!1);e()}function n(N){var T=Math.min(a.played.end(0),F.buffered.end(0)),Z=0,S=r.length,pa=!1,y=0;if(c)y=T-180,0>y&&console.warn("Not possible, time played secs: "+T);else if(1<S){var X=S-2;for(T=9E4*T|0;Z<S;){if(r[Z]>T){X=Z-2;break}Z++}0<=X&&(y=(r[X]+1E3)/9E4)}if(0<y)try{F.remove(0,y),r.splice(0,X+1),pa=!0,console.info("Buffer removed "+y+" isAudio: "+c)}catch(ja){console.warn("Buffer removal "+y+" failed, retry, isAudio: "+
c)}N||(O=setTimeout(n,18E4));return pa}var H=[],z=!1,E=0,B=this,v="",x=null,O=0,r=[],C=null,F=null,t=null,P=null;a.autoplay=!0;this.getKeyFrames=function(){return r};t=new Lb(c);t.ondata=function(N){H.push(N);e()};P=c?new qc(t):new Pd(t);P.onkeyframe=function(N){r.push(N.timestamp)};P.oncodec=function(N,T){var Z=c?"audio/mp4;codecs=":"video/mp4;codecs=";Z+=N;if(Z!=v||(c?x.sampleRate!=T.sampleRate:x.width!=T.width||x.height!=T.height))if(v=Z,x=T,z=!1,F=null,C=new MediaSource,C.addEventListener("sourceopen",
f),a.src=URL.createObjectURL(C),B.onsps)B.onsps(T)};b.onvideoframe=function(N){P.parse(N.bitstream)};b.onaudioframe=function(N){P.parse(N)};b.onendofstream=function(){B.reset()};this.play=function(N){a.play().catch(function(T){if(!N&&(console.error(T),B.onplayerror))B.onplayerror(T)})};this.reset=function(){console.log("Reset player");O&&(clearTimeout(O),O=0);r.length=0;z=!1;v="";x=null;P&&P.reset();H.length=0};this.close=function(){B&&(B.reset(),C&&"open"==C.readyState&&(C.endOfStream(),a.src=null),
P&&P.close&&P.close(),t&&t.close&&t.close(),B=null)};this.setMediaFormat=function(N,T){P.setMediaFormat&&P.setMediaFormat(N,T)};this.getMediaSource=function(){return C};this.getMediaSourceBuffer=function(){return F};a.addEventListener("ended",function(N){console.warn(".... ended");O&&(clearTimeout(O),O=0)});a.addEventListener("emptied",function(N){z=!!F});a.addEventListener("pause",function(N){console.warn(".... paused");z=!!F;var T=a.currentTime;a.play().then(function(){console.warn("... played: "+
a.currentTime+" t: "+T)}).catch(function(Z){console.error(Z)})});a.addEventListener("waiting",function(N){z=!!F})}function Qd(a,b,c){function e(B){var v=B.codec;if(v!=d||(b?H.sampleRate!=B.sampleRate:H.width!=B.width||H.height!=B.height))if(console.log("Codec: "+v+" audio: "+b),d=v,H=B,n||(n=new VideoDecoder({output:function(x){if(1E3==x.duration)f.onframedecoded(x);x.close()},error:function(x){console.error("VideoDecoder error:",x);if(f.onerror)f.onerror(x)}})),v={codec:d,codedWidth:B.width,codedHeight:B.height,
hardwareAcceleration:c||"no-preference"},console.log(v),n.configure(v),f.onsps)f.onsps(B)}var d=null,f=this,n,H=null,z={type:"delta",data:null,timestamp:0,duration:0},E=null;a.onvideoframe=function(B){var v=B.bitstream;var x=0,O=[0,0],r=v.length;var C=!1;var F=null;for(var t=!1,P=0,N=0;x<r;){O[0]=x;Lb.searchStartCode(v,O);var T=O[0];if(-1==T){N=O[1];break}T+=O[1];x=T+1;P=v[T]&31;switch(P){case 5:C=!0;break;case 7:(F=(new Uc(v.subarray(T))).readSPS())||(t=!0)}}x=r-x;O=null;7>x&&(O=v.subarray(0,r-(x+
(N+1))),7==P&&(t=!1));v=O;t&&console.log("corrupted: "+B.timestamp,B.bitstream);F&&e(F);H&&(v&&(B.bitstream=v),z.type=C?"key":"delta",z.data=B.bitstream,z.timestamp=B.timestamp,z.duration=B.isChroma?77:1E3,B=new EncodedVideoChunk(z),n.decode(B))};this.play=function(B){};this.reset=function(){console.log("Reset MediaDecoder");H=d=null;E&&(E.close(),E=null);n&&n.reset()&&n.close();n=null};this.close=function(){f.reset();n&&(n.close(),n=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=
1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Kb=!1,lb={},jb={},Bb=null,p=this,mc=!1,Wa=!1,cb=0,Cb=null,Vc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ha=hi5.appcfg,Ib="";this.setConfig=function(a){ha=a};var bb="object"==typeof q?q:null,M=bb?{}:hi5.tool.queryToObj(q.substring(q.indexOf("?")+
1));void 0==M.mapClipboard&&ha.clipboard&&void 0!=ha.clipboard.enabled&&(M.mapClipboard=ha.clipboard.enabled);M.hardwareAcceleration||(M.hardwareAcceleration=ha.hardwareAcceleration);void 0==ha.enableDVCAudio&&(ha.enableDVCAudio=!0);var Ja=0,Ka=0,fb=(la||M.color||M.server_bpp||16)|0,oc=null,Wc=null,Pa=null,cc=null,Xc="/DOWNLOAD?",Yc="/CLIP?";24==fb&&(fb=16);var Va="app"==M.startProgram,Jb=R(M.mapDisk),nb=0;this.setLinks=function(a){a.download&&(Xc=a.download);a.clipboard&&(Yc=a.clipboard)};this.protocol=
bb?"":q.substring(0,q.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return R(M.smartCard)||R(M.mapSmartCard)||R(M.passwordIsPin)};this.enableWebAuthn=function(){return R(M.enableWebAuthn)||R(M.useWebAuthn)};this.hasScanner=function(){return R(M.scanner)};this.hasUSB=function(){return R(M.mapUSB)&&!!navigator.usb};this.getUSB=function(){return M.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},
{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Wc=a};this.getProfiler=function(){return Wc};this.gateway=function(){if(bb)return"";var a=q.lastIndexOf("/RDP?");-1==a&&(a=q.lastIndexOf("/JOIN?"));-1==a&&(a=q.lastIndexOf("/PLAY?"));return q.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ua;var kb="object"==typeof q||0<q.indexOf("/PLAY?"),rc=!kb&&
0<q.indexOf("invitation=");if(rc){var sc=decodeURIComponent(q),Nb=sc.indexOf(' USERNAME="');if(0<Nb){Nb+=11;var Rd=sc.substring(Nb,sc.indexOf('"',Nb));q+="&novice="+Rd}q+="&mapClipboard=on";M.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,bb?q="":(Ja=640,Ka=480),q+="&touchpad=on",M.touchpad="on",this.reconnectOnResize=!1;else if(0<q.indexOf("/JOIN?")||rc)this.mode=2,this.reconnectOnResize=!1;var tc=R(M.gfx)||R(M.remotefx)||0<p.mode;tc&&(Va||rc?(tc=!1,M.remotefx=!1):fb=32);J?Ja=parseInt(J):
M.width&&(Ja=parseInt(M.width));U?Ka=parseInt(U):M.height&&(Ka=parseInt(M.height));-1==Ja&&(Ja=hi5.browser.getScreenWidth());-1==Ka&&(Ka=hi5.browser.getScreenHeight());M.symlink&&M.parameters&&hi5.tool.queryToObj(M.parameters,M);M.gateway||(q+="&gateway="+encodeURIComponent(p.gateway));!M.minWidth&&ha.minWidth&&(M.minWidth=ha.minWidth);!M.minHeight&&ha.minHeight&&(M.minHeight=ha.minHeight);M.minWidth&&(M.minWidth=parseInt(M.minWidth));M.minHeight&&(M.minHeight=parseInt(M.minHeight));M.waWidth=M.waWidth?
parseInt(M.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;M.waWidth&=-4;M.waHeight=M.waHeight?parseInt(M.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;M.waHeight&=-4;"useSSL"in M||(q+="&useSSL="+("wss"==p.protocol));hi5.storage.isAvailable&&(R(M.shareClipboard)||M.shareClipboardId)&&(q+="&shareClipboardId="+(M.shareClipboardId||Y()));ha&&(void 0!=ha.displayMsg?this.displayMsg=ha.displayMsg:
ha.displayMsg=this.displayMsg,ha.appTimeout&&(this.appTimeout=ha.appTimeout),void 0!=ha.reconnectOnResize&&(this.reconnectOnResize=ha.reconnectOnResize),ha.reconnectTimes&&(this.reconnectTimes=ha.reconnectTimes),void 0!=ha.windowState&&(this.windowState=ha.windowState),void 0!=ha.openLink&&(this.openLink=ha.openLink),void 0!=ha.setTitle&&(this.setTitle=ha.setTitle),"boolean"==typeof ha.useWSS&&(q=(ha.useWSS?"wss":"ws")+q.substring(q.indexOf("://"))),"boolean"==typeof ha.remoteAppLogin&&(this.remoteAppLogin=
ha.remoteAppLogin,Kb=!ha.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ha.hideLogin&&(Kb=ha.hideLogin),void 0!=ha.localPrinter&&void 0==M.localPrinter&&(M.localPrinter=ha.localPrinter));var Ma=null;void 0==ha.useWorker&&(ha.useWorker=!1);ha.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ha.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=
!0);var La=ha.useWorker?new Worker(sa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,vb=this.reconnectTimes,$b=La?{type:5,data:null}:null;this.getDisplayName=aa;this.server=aa();this.port=parseInt(M.port,10);this.loadbalanceToken="";ha.loadbalanceTokenName&&(M[ha.loadbalanceTokenName]?ia(M[ha.loadbalanceTokenName]):!1!==ha.randomAppId?ia(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){p.loadbalanceToken&&(a+=-1==a.indexOf("?")?
"?"+p.loadbalanceToken:"&"+p.loadbalanceToken,a+="&loadbalanceTokenName="+ha.loadbalanceTokenName);return a};this.getURL=function(){return q};this.getRuntimeURL=function(){var a=q+"&width="+Ja+"&height="+Ka+"&server_bpp="+fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Ec(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=M.monitorDef,d=M.monitor,f=0;b=ca.size();var n=Array(b);c=Array(b);var H=0,z=0,E=0,B=0,v=0,x=0,O="";if(e){c=ra.parseMonitorDef(e);for(b=c.length;f<b;f++){var r=
c[f];r[0]<E&&(E=r[0]);r[1]<B&&(B=r[1]);r[2]>v&&(v=r[2]);r[3]>x&&(x=r[3])}0>E&&(H=-E);0>B&&(z=-B);r=0>d?[E,B,v,x]:c[d];M.width=r[2]-r[0]+1;M.height=r[3]-r[1]+1;f=ca.getSurface(0);f.setMonitor(r[0],r[1],r[2],r[3]);if(H||z)for(r=f.getMousePosition(),r.left+=H,r.right+=H,r.top+=z,r.bottom+=z,f=0;f<b;f++)r=c[f],r[0]+=H,r[1]+=z,r[2]+=H,r[3]+=z;ra.setMonitorLayout(c);0>d&&ra.setMonitorCount(0);p.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+M.width+"&height="+M.height}else{if(1<b&&!Va){for(ca.verifyMonitors();f<
b;f++)e=ca.getSurface(f),r=e.getMousePosition(),r.left<E&&(E=r.left),r.top<B&&(B=r.top),r.right>v&&(v=r.right),r.bottom>x&&(x=r.bottom),n[f]=r,O&&(O+=","),O+=r.left+":"+r.top+":"+r.right+":"+r.bottom;0>E&&(H=-E);0>B&&(z=-B);for(f=0;f<b;f++){r=ca.getSurface(f).getMousePosition();if(H||z)r.left+=H,r.right+=H,r.top+=z,r.bottom+=z;c[f]=[r.left,r.top,r.right,r.bottom,r.left==H&&r.top==z?1:0]}ra.setMonitorLayout(c);p.reconnectOnResize=!1}O&&(svGlobal.logger.warn("MonitorDef:"+O),M.width=v-E+1,M.height=
x-B+1,O="&monitorDef="+O+"&width="+M.width+"&height="+M.height);b=O}a+=b;0>q.indexOf("waWidth")&&(b=(b=ca.getFocused())?b.getWindow():window,a+="&waWidth="+M.waWidth+"&waHeight="+M.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;M.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());M.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==M.soundPref&&(M.soundPref=0,a+="&soundPref=0");H=c=b="";for(H in lb)z=
lb[H],"flags"in z&&(b&&(b+=",",c+=","),b+=z.name,c+=z.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(H in jb)z=jb[H],"flags"in z&&(b&&(b+=","),b+=z.name);b&&(a+="&gwChannelName="+b);if(c=wd())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);M.audioRecord=R(M.audioRecord)&&hi5.audio.recordable;Ea.init(b,tc,M.audioRecord,M.soundPref,R(M.mapCamera)&&!!navigator.mediaDevices,R(M.mapUSB)&&!!navigator.usb);
M.audioRecord&&(a+="&audioRecord=on");M.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ea.count&&(a+="&dvcChannels="+Ea.names.join(","));a+="&binary=on";ha.existingFile&&(a+="&existingFile="+ha.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ua());a=p.modifyURL(a);ha.copyTextOnly&&R(M.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);
R(M.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Fd()};this.getColor=function(){return fb};this.changeTitle=na;hi5.browser.isTouch&&Math.max(Ja,Ka)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Ba=null,Ha=!1,qb=!1,pc=!1,Ta=new function(){function a(z){c&&(d&&d.disconnect(),f&&f.disconnect());hi5.audio.releaseAudioContext();z||(H&&(H.close(),H=null),n&&(n.pause(),n=null))}function b(z){console.error("play error: ",
z)}var c=null;this.supportWebAudio=this.available=!1;(0==M.playSound||0<p.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(z){return c.createBuffer(2,z,Ca.samplePerSec)};var e=0,d=null,f=null;this.setVolume=function(z){1==z?d=null:(d||(d=c.createGain()),d.gain.value=z)};this.playBuffer=function(z){f=c.createBufferSource();f.buffer=z;d?(f.connect(d),d.connect(c.destination)):f.connect(c.destination);
var E=c.currentTime,B=0<e?e:E;B<E&&(B=E);e=B+z.duration;f.start?f.start(B):f.noteOn(B);return e-E};this.iOSFix=function(){if(c){var z=this.getBuffer(1024),E=c.createBufferSource();E.buffer=z;E.connect(c.destination);E.start?E.start(0):E.noteOn(0)}};this.close=a;var n=null,H=null;this.onaudioframe=null;this.initMediaPlayer=function(z,E,B){a(!0);n||(n=document.createElement("audio"));H||(H=new Mb(n,z,!0),H.onplayerror=b,H.onerror=function(v){console.error("Not possible audio error",v)},svGlobal.logger.info("MediaPlayer init, headerless: "+
B+" sampleRate:"+E.sampleRate));H.setMediaFormat(E,B);H.play(!1)}},Md=Ta.available,ra=new yc(200,200);ra.onSetCursor=Jc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Xb=0,Wb=0,Yb=Ja-1,Zb=Ka-1,nc="";window.$rdp||(window.$rdp=this);ya(fb);this.setResolution=Na;this.running=function(){return Ha};this.setJoinMode=function(a){Ha&&ta("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&ta("8EB3\t"+a)};this.refuseControl=function(a){Ha&&ta("8E3"+a)};this.giveControl=function(a){Ha&&
ta("8E4"+a)};this.pauseSession=function(a,b){Ha&&ta("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ha&&ta("8EB2\t"+a)};this.requestControl=function(){Ha&&ta("8E2")};this.saveSession=function(a){Ha&&ta("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&ta("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(c&&0<c.length){var f=c.shift();f.key?Db.sendSingleKey(f.down,f.key):f.char&&tb(f.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,
space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(f,n){var H=b[n.toLowerCase()];H?p.writeScancode(f,H):(H=n.length,
0!=H&&(1==H?p.writeKeyCode(f,n.toUpperCase().charCodeAt(0)):f&&p.writeText(n)))};var c=null,e=0,d=null;this.sendKeyComb=function(f,n,H){if(Wa){f=f.split("+");var z=f.length,E;if(0!=z){var B=null,v=[];for(E=0;E<z;E++){var x=f[E];""==x&&""==B&&(x="Add");""!=x&&v.push({key:x,down:!0});B=x}z=v.length;for(E=z-1;0<=E;E--)v.push({key:v[E].key,down:!1});if(n)c=v,e=n,d=H,a();else for(E=0,z=v.length;E<z;E++)Db.sendSingleKey(v[E].down,v[E].key)}}};this.sendText=function(f,n,H){for(var z=[],E=0,B=f.length;E<
B;E++)z.push({"char":f.charAt(E)});c=z;e=n;d=H;a()}};this.writeKeyComb=function(a,b,c){Wa&&Db.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Wa)if(b)Db.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)tb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),p.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ca=new function(a,b){function c(){function d(v){for(;0<v.ownerWinid;){var x=E.getWinById(v.ownerWinid);if(x&&x.isVisible())v=x;else break}return v}function f(v){for(var x=
"";v;)v.titleInfo&&(x=v.titleInfo),v=E.getWinById(v.ownerWinid);return x}var n=[],H=[],z=0,E=this;this.mainWin=null;this.appId="";var B=0;this.getActiveWinId=function(){return B};this.setActiveWinId=function(v,x){svGlobal.logger.info("setActiveWinId: "+v+" old: "+B+" max: "+x);if(B!=v){var O=0==B;B=v;(v=E.getMainByWinId(v))&&v.isMainWin()&&E.mainWin!=v&&(E.mainWin=v);O&&x&&(x=ca.getFocused())&&(x=x.getFreeSpace(),v=x.width,p.resetSize(v,x.height))}};this.onchange=function(v){v.isVisible()||v!=E.mainWin?
v.isVisible()&&!E.mainWin&&v.isMainWin()&&(E.mainWin=v,3==a.windowState&&v.exeCommand(61488)):E.mainWin=null};this.addWin=function(v){for(var x=n.length,O=!1,r=0;r<x;r++)if(v.id==n[r].id){n[r]=v;O=!0;break}O||n.push(v);1==n.length&&(z=Date.now());x=v.isMainWin();svGlobal.logger.info("is mainwin:"+x+" id:"+v.id);x&&!E.mainWin&&(E.mainWin=v)};this.popWins=function(v){v=E.getWinById(v);var x=[];if(v){v=0<v.ownerWinid?v.ownerWinid:v.id;for(var O=n.length-1;0<=O;O--)if(n[O].ownerWinid==v||n[O].id==v)x.push(n[O]),
n.splice(O,1)}return x};this.hasApp=function(v){return-1!=H.indexOf(v)};this.addApp=function(v){return-1==H.indexOf(v)?(H.push(v),!0):!1};this.isNew=function(){return 3E4>Date.now()-z};this.getAll=function(){return n};this.hasWin=function(v){return 0<=n.indexOf(v)};this.close=function(){for(var v=0,x=n.length;v<x;v++)n[v].close()};this.clear=function(){n.length=0};this.delWin=function(v){for(var x=0,O=n.length;x<O;x++)if(n[x].id==v)return n.splice(x,1),x;return-1};this.isRunning=function(){var v=
n.length;if(1>v)return!1;var x=0;for(v=n.length;x<v;x++){var O=n[x];if(O.showState)return!0}return!1};this.getWinById=function(v){var x=n.length;if(1>x)return null;for(var O=0;O<x;O++){var r=n[O];if(r.id==v)return r}return null};this.getMainWinByAppId=function(v){var x=null,O=0;for(len=n.length;O<len;){x=n[O];if(x.appId==v&&x.isVisible()&&1>x.ownerWinid)break;O++}return x};this.getTopWin=function(v){var x=null,O,r=v.length;for(O=0;O<r&&(!(x=E.getWinById(v[O]))||!x.isVisible());O++)x=null;if(!x)for(svGlobal.logger.warn("No win found"),
r=n.length,O=r-1;0<=O&&(x=n[O],!x.isVisible());O--)x=null;return x};this.getMain=function(v){return(v=E.getTopWin(v))?d(v):null};this.getMainByWinId=function(v){return(v=E.getWinById(v))?d(v):null};this.getOtherApps=function(v,x,O){var r=n.length;if(0!=r&&n[r-1])if(r=n[r-1].appId,O||!r)setTimeout(function(){E.getOtherApps(v,x)},O||3E3);else{O=[];if(r=E.getTopWin(v)){var C=0<r.ownerWinid?r.ownerWinid:r.id,F=[],t=0;for(r=n.length;t<r;t++)n[t].ownerWinid!=C&&n[t].id!=C&&n[t].isVisible()&&F.push(n[t]);
t=0;for(r=F.length;t<r;t++)F[t].ownerWinid!=C&&F[t].id!=C&&(O.push({title:f(F[t]),win:d(F[t])}),C=0<F[t].ownerWinid?F[t].ownerWinid:F[t].id)}x(O)}};this.getFullTitle=function(v){for(var x,O="";;){x=E.getWinById(v);if(!x)break;x.titleInfo&&x.isVisible()&&(O&&(O=" > "+O),O=x.titleInfo+O);if(1>v)break;v=x.ownerWinid}return O}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,f=0;f<d;f++)e[f].railWin&&e[f].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,
f=Array(d),n=0;n<d;n++)e[n].configMonitor(),f[n]=e[n].getMousePosition();f.sort(function(E,B){var v=E.left-B.left;return 0!=v?v:E.top-B.top});var H=f.findIndex(function(E){return 0==E.left&&0==E.top});svGlobal.logger.info("monitor layout",f,H);-1==H&&(p.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",f));for(n=H-1;0<=n;){if(f[n].right<f[n+1].left){var z=f[n+1].left-f[n].right-1;0<z&&(f[n].right+=
z,f[n].left+=z)}f[n].bottom<f[n+1].top&&(z=f[n+1].top-f[n].bottom-1,0<z&&(f[n].top+=z,f[n].bottom+=z));n--}for(n=H+1;n<d;)f[n-1].right<f[n].left&&(z=f[n].left-f[n-1].right-1,0<z&&(f[n].right-=z,f[n].left-=z)),f[n-1].bottom<f[n].top&&(z=f[n].top-f[n-1].bottom-1,0<z&&(f[n].top-=z,f[n].bottom-=z)),n++};this.repaint=function(d,f,n,H){for(var z=0,E=e.length;z<E;z++)e[z].repaint(d,f,n,H)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};
this.hasSurface=function(d){for(var f=e.length,n=0;n<f;n++)if(e[n].equals(d))return!0;return!1};this.getMonitorSurface=function(d,f,n,H){var z=e.length;if(1==z)return e[0];for(var E=0;E<z;E++)if(e[E].isMonitor(d,f,n,H))return e[E];return null};this.fromSyncedSurface=function(d){var f=e.length;Date.now();for(var n=0;n<f;n++)if(e[n].isClipSynced(d))return!0;return!1};this.setSize=function(d,f,n){for(var H=0,z=e.length;H<z;H++)e[H].setSize(d,f,n)};this.zOrders=[];this.drawLicense=function(d){for(var f=
0,n=e.length;f<n;f++)e[f].drawLicense(d)};this.setReadOnly=function(d,f){for(var n=0,H=e.length;n<H;n++)e[n].setReadOnly(d,f)};this.setVisible=function(d,f){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var f=0,n=e.length;f<n;f++)e[f]&&e[f].setCursor(d)};this.hide=function(d){d=0;for(var f=e.length;d<f;d++)e[d]&&e[d].hide()};this.execute=function(d,f){for(var n=0,H=e.length;n<H;n++)e[n][d].apply(e[n],f)};this.addWin=function(d){var f=this.getFocused();f||(svGlobal.logger.warn("Focused surface not found!"),
f=e[e.length-1]);f?(Va=!0,f.railWin||(f.railWin=new c,f.onunload=function(){hi5.appcfg.closeRemoteApp&&f.railWin&&f.railWin.close();f.remoteApp&&f.remoteApp.close();f.railWin&&(f.railWin.clear(),f.railWin=null);e.removeElm(f)}),f.context&&b.setContext(f.context),f.railWin.addWin(d),f.railWin.mainWin==d&&(setTimeout(function(){var n=f.getFreeSpace();a.writeRawInput("8C661441\t"+n.width+"\t"+n.height);svGlobal.logger.info("-- main win dp change:"+n.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);
svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Qa.sendKeyboardSyncFlags(Qa.localLockFlags,500)),hi5.browser.isIE&&f.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var f,n=e.length-1;0<=n;n--){var H=e[n];f=H.railWin;var z=f.getWinById(d),E=z&&z.appId&&-1!=z.appId.toLowerCase().indexOf("runonce");if(0<=f.delWin(d)){z==f.mainWin&&(f.mainWin=null);if(H.toolbar){d=
"win"+d;var B=H.toolbar.querySelector("#"+d);B&&H.toolbar.removeChild(B)}if(!f.isRunning()&&0==p.mode){if(z.isMainWin()&&H.onremoteappclose)H.onremoteappclose(z);z=a.appTimeout;if(E||f.isNew())z*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(v){return function(){svGlobal.logger.info("Start del:"+Date.now());v.railWin&&v.railWin.isRunning()||(v.remoteApp&&v.remoteApp.close(),ca&&ca.delSurface(v))}}(H),z)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):
[]};this.getWinById=function(d){for(var f,n=0,H=e.length;n<H;n++)if(e[n]&&e[n].railWin&&(f=e[n].railWin.getWinById(d)))return f;return null};this.getMainWinByAppId=function(d){for(var f,n=0,H=e.length;n<H;n++)if(e[n].railWin&&(f=e[n].railWin.getMainWinByAppId(d)))return f;return null};this.onWinChange=function(d){for(var f,n=0,H=e.length;n<H;n++)if(e[n].railWin&&(f=e[n].railWin.getWinById(d.id)))e[n].railWin.onchange(d)};this.setTitle=function(d){for(var f,n=0,H=e.length;n<H;n++)if(e[n].railWin){f=
e[n].railWin.getWinById(d);var z=e[n].railWin.getFullTitle(d);if(z){a.changeTitle(z,e[n].getWindow(),f.appId);break}}};this.hasApp=function(d){for(var f=0,n=e.length;f<n;f++)if(e[f].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var f=0,n=e.length;f<n;f++)if(e[f].railWin&&e[f].railWin.hasWin(d))return e[f];return null};
this.getOwnerSurfaceById=function(d){for(var f,n=0,H=e.length;n<H;n++)if(e[n].railWin&&(f=e[n].railWin.getWinById(d)))return e[n];return null};this.getFocused=function(){for(var d=e.length,f=0;f<d;f++)if(e[f].focused)return e[f];return e[d-1]};this.close=function(){for(var d=0,f=e.length;d<f;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function f(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var n=this;this.resizable=function(){return n.isVisible?
0!=(n.style&262144)||0!=(n.style&65536)||0!=(n.style&16777216)||3==n.showState:!1};this.setShowState=function(H){n.showState=H};this.parent=function(){return ca.getWinById(n.ownerWinid)};this.resize=function(H,z,E,B){svGlobal.logger.info("www resize, l "+H+" w "+E);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+n.id+"\t"+H+"\t"+z+"\t"+E+"\t"+B)};this.exeCommand=function(H){svGlobal.logger.info("www exeCommand, cmd "+H);a.writeRawInput("8C4"+d+"\t"+H)};this.activate=function(H){svGlobal.logger.info("www activate, enable "+
H+" id:"+d);2==n.showState?(n.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+H)},50)):a.writeRawInput("8C3"+d+"\t"+H)};this.close=function(){svGlobal.logger.info("www close");n.exeCommand(61536)};this.getAppId=f;this.isVisible=function(){return n.winWidth&&n.winHeight&&n.showState&&45<n.winHeight&&45<n.winWidth};this.isMainWin=function(){if(!(n.isVisible()&&n.winWidth&&n.winHeight&&45<n.winHeight&&45<n.winWidth))return!1;var H=1>n.ownerWinid;if(!H)return H;var z=n.style;if(0!=
(z&4194304))return!0;if(0!=(z&2147483648)&&(0==(z&8388608)||0==(z&12582912)))return!1;var E=0!=(n.extStyle&128);(H=H&&!E)&&0!=(z&2147483648)&&0==(z&2156396544)&&(H=!1);return H};f()}}(p,ra);this.getSurfaces=function(){return ca};this.hide=function(){ca&&ca.hide()};this.getFileUrl=function(a,b,c){var e=ua(),d=Xc,f=d.indexOf("://");e=(0<f&&11>f?d:e+d)+"s="+nc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return p.modifyURL(e)};this.listFiles=function(a,b){Ma&&Wa&&Ma.list(a,b)};
this.writeRawInput=function(a){if(Wa){ta(a);if(p.onactivity)p.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);ta(e.buffer)};var Zc=0;if(ha.numLock||ha.numlock||R(M.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Zc|=2;var Qa=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;
this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;
this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var f=d.getFreeSpace(),n=f.width;f=f.height;Qa.checkLockFlags=!0;ha.scale?d.scaleTo(n,f,!1):a.resetSize(n,f)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,f){this.reqCopyTime=Date.now();var n=a.getGatewayAddr(),H=Yc,z=H.indexOf("://");n=(0<z&&11>z?H:n+
H)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(n),f);this.reqCopyTime=Date.now();Rc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,f,n){a.reconnectOnResize=!1;var H=a.getFileUrl(d,f,n);p.ondownload&&p.ondownload({fileName:d,url:H,source:f,action:n})||window.open(H)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return q};this.reconnect=function(d,f,n){M.symlink?(d="user="+d+"&pwd="+f,n&&(d+="&domain="+n),q=hi5.tool.replaceQuery(q,
"parameters",d)):(q=hi5.tool.replaceQuery(q,"user",d),q=hi5.tool.replaceQuery(q,"pwd",f),q=hi5.tool.replaceQuery(q,"domain",n));a.run()};this.sendKeyboardSyncFlags=function(d,f){return Wa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},f||333),!0):!1};this.sendKeyboardSynchronize=function(d,f,n){var H=0;n&&(H|=4);f&&(H|=2);d&&(H|=1);this.sendKeyboardSyncFlags(H)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",
20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,f){a.authWithCode(d,f)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(p,Zc),Sd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,f){return a.repaint(c,e,d-c+1,f-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&
e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+c.id))}}(ra,ca);this.sendKeyboardSynchronize=function(a,b,c){Qa.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new pb(143)};this.GatewayChannel=function(){return new pb(28)};this.DynamicChannel=function(){return new pb(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Ea.names.push(a.name);Ea[a.name]=a;Ea.count++};
var Ra=null,Ea={count:0,names:[],usbChannel:null,close:function(){for(var a=Ea.names,b=0,c=a.length;b<c;b++)Ea[a[b]].onclose&&(Ea[a[b]].onclose(),Ea[a[b]]=null);a.length=0;Ea.usbChannel=null},init:function(a,b,c,e,d,f){function n(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=
this.formatTag=0;this.extenstion=null;var r=this;this.fromBuffer=function(C,F){r.formatTag=C.getLittleEndian16();r.nChannels=C.getLittleEndian16();r.nSamplesPerSec=C.getLittleEndian32();r.nAvgBytesPerSec=C.getLittleEndian32();r.nBlockAlign=C.getLittleEndian16();r.bitsPerSample=C.getLittleEndian16();var t=C.getLittleEndian16();r.cbSize=t;0<t&&!0!==F&&(r.extenstion=Array(t),C.copyToByteArray(r.extenstion,0,C.getPosition(),t),C.skipPosition(t))};this.toBuffer=function(C){C.setLittleEndian16(r.formatTag);
C.setLittleEndian16(r.nChannels);C.setLittleEndian32(r.nSamplesPerSec);C.setLittleEndian32(r.nAvgBytesPerSec);C.setLittleEndian16(r.nBlockAlign);C.setLittleEndian16(r.bitsPerSample);C.setLittleEndian16(r.cbSize);0<r.cbSize&&C.setBytes(r.extenstion)};this.getSize=function(){return 18+r.cbSize};this.toString=function(){return"Audio Format, tag="+r.formatTag+" nChannels="+r.nChannels+" nSamplesPerSec="+r.nSamplesPerSec+" nAvgBytesPerSec="+r.nAvgBytesPerSec+" nBlockAlign="+r.nBlockAlign+" bitsPerSample="+
r.bitsPerSample+" cbSize="+r.cbSize}}function H(){Ra=new p.DynamicChannel;Ra.name="Microsoft::Windows::RDS::DisplayControl";Ra.enabled=!1;Ra.process=function(r){var C=r.getLittleEndian32();r.getLittleEndian32();switch(C){case 5:C=r.getLittleEndian32(),Ra.maxMonitorAreaFactorA=r.getLittleEndian32(),Ra.maxMonitorAreaFactorB=r.getLittleEndian32(),Ra.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+C+" factorA:"+Ra.maxMonitorAreaFactorA+" factorB:"+Ra.maxMonitorAreaFactorB),r=new Uint8Array(2),
r[0]=146,r[1]=4,ta(r.buffer),Pa&&setTimeout(function(){Pa&&Pa.check(5E3)},1900)}};Ra.applyResolution=function(r,C){if(Ra.enabled){var F=new Uint8Array(56),t=new RdpBuffer(F,0,56);r=r>Ra.maxMonitorAreaFactorA?Ra.maxMonitorAreaFactorA:r&-4;C=C>Ra.maxMonitorAreaFactorB?Ra.maxMonitorAreaFactorB:C&-4;t.setLittleEndian32(2);t.setLittleEndian32(56);t.setLittleEndian32(40);t.setLittleEndian32(1);t.setLittleEndian32(1);t.setLittleEndian32(0);t.setLittleEndian32(0);t.setLittleEndian32(r);t.setLittleEndian32(C);
t.setLittleEndian32(.26458*r|0);t.setLittleEndian32(.26458*C|0);t.setLittleEndian32(r>C?0:90);t.setLittleEndian32(100);t.setLittleEndian32(100);Ra.send(F);svGlobal.logger.warn("Display control: "+r+"x"+C)}else svGlobal.logger.warn("Display control disabled.")};return Ra}if(!ha.disableDVC){if(ha.enableEcho){var z=new p.DynamicChannel;z.name="ECHO";z.process=function(r){var C=r.getPosition(),F=r.getEnd(),t=new Uint8Array(F-C);t.set(r.getData().subarray(C,F));z.send(t)};p.addDynamicChannel(z)}if(a){var E=
new p.DynamicChannel;E.name="Microsoft::Windows::RDS::Input";E.process=function(r){var C=r.getLittleEndian16();r.getLittleEndian32();switch(C){case 1:r.skipPosition(4),r=new RdpBuffer(new Uint8Array(16),0,16),r.setLittleEndian16(2),r.setLittleEndian32(16),r.setLittleEndian32(3),r.setLittleEndian32(65536),r.setLittleEndian16(256),r.markEnd(),E.send(r);case 5:ca.execute("setTouchRemoting",[!0]);Ea.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ca.execute("setTouchRemoting",
[!1]),Ea.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};p.addDynamicChannel(E)}if(c){svGlobal.logger.warn("Audio input on");var B=new p.DynamicChannel;(function(){function r(y){var X=new RdpBuffer(new Uint8Array(5),0,5);X.setByte(7);X.setLittleEndian32(y);X.markEnd();B.send(X)}function C(y){var X=y.getLittleEndian32(),ja=y.getLittleEndian32(),V=new n;V.fromBuffer(y,!0);var da=0,ka=0;0<V.cbSize&&(22==V.cbSize?(da=y.getLittleEndian16(),ka=y.getLittleEndian32(),y.skipPosition(16)):
(svGlobal.logger.warn("Wrong cbsize: "+V.cbSize),y.skipPosition(V.cbSize)));y=t[ja];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+X+" initial: "+ja+", "+y.toString());svGlobal.logger.info("Open fmt: "+V.toString()+" validBits:"+da+" mask:"+ka);N=!0;T=p.reconnectOnResize;p.reconnectOnResize=!1;pa.onopen||(pa.onopen=function(va){if(Ha){F=va;p.reconnectOnResize=T;r(ja);var fa=new RdpBuffer(new Uint8Array(5),0,5);fa.setByte(4);fa.setLittleEndian32(va?0:1);fa.markEnd();B.send(fa)}});pa.ondata||
(pa.ondata=function(va,fa){F&&(Z.length!=fa+1&&(Z=new Uint8Array(fa+1),Z[0]=6),B.send(P),Z.set(va,1),B.send(Z))});pa.start(y,X)}B.name="AUDIO_INPUT";B.process=function(y){var X=y.getByte();switch(X){case 1:y=y.getLittleEndian32();X=new RdpBuffer(new Uint8Array(5),0,5);X.setByte(1);X.setLittleEndian32(y);X.markEnd();B.send(X);break;case 2:var ja=y.getLittleEndian32();y.getLittleEndian32();var V=hi5.audio.getAudioContext().sampleRate;for(X=t.length=0;X<ja;X++){var da=new n;da.fromBuffer(y);svGlobal.logger.info("Server rec fmt "+
X+":"+da.toString());0==e&&49==da.formatTag&&22050==da.nSamplesPerSec?t.push(da):1==da.formatTag&&da.nSamplesPerSec<=V&&t.push(da)}B.send(P);ja=0;y=t.length;for(X=0;X<y;X++)ja+=t[X].getSize();V=new RdpBuffer(new Uint8Array(1024),0,1024);V.setByte(2);V.setLittleEndian32(y);V.setLittleEndian32(ja+9);for(X=0;X<y;X++)t[X].toBuffer(V),svGlobal.logger.info("Client rec fmt: "+t[X].toString());V.skipPosition(1024-ja-9);V.markEnd();B.send(V);break;case 3:C(y);break;case 7:X=y.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+
t[X].toString()+" by client:"+N);N||(r(X),N=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+X)}};var F=!1,t=[];B.onclose=function(){F=!1;pa&&pa.close()};var P=new Uint8Array(1);P[0]=5;var N=!1,T=p.reconnectOnResize,Z=new Uint8Array(0),S=sa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),pa=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),S):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();p.addDynamicChannel(B)}p.addDynamicChannel(function(){var r=
new p.DynamicChannel;r.name="TSMF";var C={type:"image/jpeg"},F=Array(1);r.process=function(t){t.getPosition();var P=t.getLittleEndian32()&1073741823;var N=t.getLittleEndian32();var T=t.getLittleEndian32();switch(P){case 2:if(256==T){t.getLittleEndian32();T=new Uint8Array(16);var Z=new RdpBuffer(T,0,16);Z.setLittleEndian32(2);Z.setLittleEndian32(N);Z.setLittleEndian32(1);Z.setLittleEndian32(0);r.send(T)}break;case 0:switch(T){case 257:t.getBytes(16);t.getLittleEndian32();break;case 256:P=t.getPosition();
Z=t.getLittleEndian32();for(T=0;T<Z;T++){t.getLittleEndian32();var S=t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(S-4)}T=t.getPosition()-P;Z=T+8+4;T=new Uint8Array(Z);Z=new RdpBuffer(T,0,Z);Z.setLittleEndian32(-2147483648);Z.setLittleEndian32(N);T.set(t.getData().subarray(P,t.getPosition()),8);r.send(T);break;case 261:t.getBytes(16);t.getLittleEndian32();break;case 264:P=t.getLittleEndian32();t.skipPosition(4);t.getLittleEndian32();S=t.getBytes(16);var pa=t.getBytes(16);t.getLittleEndian32();
t.getLittleEndian32();t.getLittleEndian32();var y=t.getBytes(16);T=t.getLittleEndian32();t.skipPosition(T);T=new Uint8Array(20);Z=new RdpBuffer(T,0,20);Z.setLittleEndian32(-2147483648);Z.setLittleEndian32(N);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],S)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],pa)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],y)?Z.setLittleEndian32(1):(Z.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),
svGlobal.logger.warn(S),svGlobal.logger.warn(pa),svGlobal.logger.warn(y));Z.setLittleEndian32(P);r.send(T);break;case 258:t.getBytes(16);t.getLittleEndian32();P=t.getLittleEndian32();t.skipPosition(P);break;case 263:t.getBytes(16),T=new Uint8Array(16),Z=new RdpBuffer(T,0,16),Z.setLittleEndian32(-2147483648),Z.setLittleEndian32(N),Z.setLittleEndian32(1),r.send(T);case 277:t.getBytes(16);t.getLittleEndian32();break;case 262:t.getBytes(16);ra.flushImgs();ra.setImgRect(0,0,0,0);T=new Uint8Array(12);Z=
new RdpBuffer(T,0,12);Z.setLittleEndian32(-2147483648);Z.setLittleEndian32(N);r.send(T);break;case 278:t.getBytes(16);N=t.getLittleEndian32();T=t.getLittleEndian32();P=t.getLittleEndian32();t=t.getLittleEndian32();ra.setImgRect(N,T,P-N,t-T);break;case 265:t.getBytes(16);t.getLittleEndian64();t.getLittleEndian32();break;case 266:t.getBytes(16);break;case 268:t.getBytes(16);break;case 267:t.getBytes(16);break;case 269:t.getBytes(16);t.getLittleEndian32();break;case 274:break;case 275:break;case 259:t.getBytes(16);
t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(32);T=t.getLittleEndian32();N=new Image;P=t.getPosition();F[0]=t.getData().subarray(P,P+T);t=new Blob(F,C);N.src=URL.createObjectURL(t);ra.addImg(N);break;case 270:ra.flushImgs();break;case 273:break;case 260:break;case 276:t.getBytes(16);T=t.getLittleEndian32();P=t.getPosition()+T;t.skipPosition(8);N=t.getLittleEndian32();svGlobal.logger.info("window state:"+N);Z=t.getLittleEndian32();S=t.getLittleEndian32();N=t.getLittleEndian32();T=t.getLittleEndian32();
t.skipPosition(8);pa=t.getLittleEndian32();y=t.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+N+" top:"+T+" w:"+Z+" h:"+S+" cl:"+pa+" ct:"+y);t.setPosition(P);P=t.getLittleEndian32();for(P=t.getPosition()+P;t.getPosition()<P;){pa=t.getLittleEndian32();y=t.getLittleEndian32();var X=t.getLittleEndian32(),ja=t.getLittleEndian32();svGlobal.logger.info("visible region, l:"+y+" t:"+pa+" r:"+ja+" b:"+X)}ra.setImgRect(N,T,Z,S);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+
T)}break;default:svGlobal.logger.warn("unkown interface:"+P)}};return r}());kb||p.addDynamicChannel(H());ha.enableDVCAudio&&p.addDynamicChannel(function(r){var C=!1,F=0,t=0,P=0,N=0,T=[],Z=new Uint8Array(4),S=new p.DynamicChannel;S.name="AUDIO_PLAYBACK_DVC";S.onclose=function(){};S.process=function(pa){function y(ma){ma.skipPosition(14);var ea=ma.getLittleEndian16();ma.getByte();var qa=ma.getLittleEndian16();ma.skipPosition(1);for(var Sa,g=T.length=0;g<ea;g++){var l=new n;l.fromBuffer(ma);(Sa=22050<=
l.nSamplesPerSec&&(1==l.formatTag||49==l.formatTag&&22050==l.nSamplesPerSec&&0==r||41222==l.formatTag))&&T.push(l)}l=20;ma=T.length;for(g=0;g<ma;g++)l+=T[g].getSize();g=l+4;ea=new RdpBuffer(new Uint8Array(g),0,g);ea.setByte(7);ea.setByte(2);ea.setLittleEndian16(l);ea.setLittleEndian32(3);ea.setLittleEndian32(4294967295);ea.setLittleEndian32(0);ea.setLittleEndian16(0);ea.setLittleEndian16(ma);ea.skipPosition(1);ea.setLittleEndian16(qa);ea.setByte(124);for(g=0;g<ma;g++)l=T[g],l.toBuffer(ea);ea.markEnd();
S.send(ea);5<qa&&(ea=new RdpBuffer(new Uint8Array(8),0,8),ea.setByte(12),ea.skipPosition(1),ea.setLittleEndian16(4),ea.setLittleEndian16(0),ea.setLittleEndian16(0),ea.markEnd(),S.send(ea))}function X(ma){var ea=ma.getLittleEndian16();ma=ma.getLittleEndian16();var qa=new RdpBuffer(new Uint8Array(8),0,8);qa.setByte(6);qa.setByte(35);qa.setLittleEndian16(4);qa.setLittleEndian16(ea);qa.setLittleEndian16(ma);qa.markEnd();S.send(qa)}function ja(){var ma=T[P];if(ma.formatTag!=Ca.tag||ma.nSamplesPerSec!=
Ca.samplePerSec||Ca.channels!=ma.nChannels)Ca.tag=ma.formatTag,Ca.channels=ma.nChannels,Ca.samplePerSec=ma.nSamplesPerSec,Ca.bitsPerSample=49==ma.formatTag?8:ma.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ca.tag+" channels="+Ca.channels+" bitsPerSample="+Ca.bitsPerSample+" samplePerSec="+Ca.samplePerSec),41222==Ca.tag&&(Ca.sampleRate=Ca.samplePerSec,Ta.initMediaPlayer(Ta,Ca,!0))}function V(ma){t=ma.getLittleEndian16();P=ma.getLittleEndian16();N=ma.getByte();ma.skipPosition(3);Z.set(ma.getSubarray(4));
C=!0;ja()}function da(ma,ea){var qa=new RdpBuffer(new Uint8Array(8),0,8);qa.setByte(5);qa.skipPosition(1);qa.setLittleEndian16(4);qa.setLittleEndian16(ma);qa.setByte(ea);qa.skipPosition(1);qa.markEnd();S.send(qa)}function ka(ma){C=!1;var ea=F-8,qa=Date.now();ma.copyFromByteArray(Z,0,ma.getPosition(),4);lc(ma,N,t,ea);ma=t+(Date.now()-qa);da(ma,N)}function va(ma){var ea=Date.now();t=ma.getLittleEndian16();P=ma.getLittleEndian16();N=ma.getByte();ma.skipPosition(7);ja();ma=lc(ma,N,t,0);ma*=1E3;ea=t+(Date.now()-
ea)+ma;da(ea,N)}if(C)ka(pa);else{var fa=pa.getByte();pa.skipPosition(1);F=pa.getLittleEndian16();switch(fa){case 7:y(pa);break;case 6:X(pa);break;case 2:V(pa);break;case 3:pa.getLittleEndian16();pa.getLittleEndian16();break;case 13:va(pa)}}};return S}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var v=svGlobal.DCVC_EXTENSION;v.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(r,C){svGlobal.logger.info("activate webcam");v.videoMedia.resolutions?
r():hi5.video.resolutions(function(F){svGlobal.logger.info("cam resolutions:",F);F.length?(v.videoMedia.resolutions=F,r()):C()})},deactivate:function(){var r=v.videoMedia;r.track&&(r.track.stop(),r.track=null);r.ctx=null;r.canvas=null;r.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(r,C,F,t,P){svGlobal.logger.info("startStream, width:"+r+" height:"+C+" frameRate:"+F);var N=v.videoMedia,T=N.track;if(T){var Z=T.getSettings();if("live"==T.readyState)if(r!=Z.width||C!=Z.height||
F!=Z.frameRate&&2!=N.type)T.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==N.type?N.minFrameRate:F,width:{exact:r},height:{exact:C}}}).then(function(S){var pa=document.createElement("video");pa.srcObject=S;pa.play();if(window.OffscreenCanvas)var y=new OffscreenCanvas(100,100);else y=document.createElement("canvas"),y.style.position="absolute",y.style.left=0,y.style.top=0;N.track=S.getVideoTracks()[0];N.canvas=y;N.ctx=y.getContext("2d");N.video=pa;S=N.track.getSettings();
N.canvas.width=S.width;N.canvas.height=S.height;t()}).catch(function(S){svGlobal.logger.warn(S);P()})},stopStream:function(){svGlobal.logger.info("stopStream");var r=v.videoMedia;r.track&&"live"==r.track.readyState&&r.track.stop()},grabFrame:function(r){function C(t){t.arrayBuffer().then(r)}var F=v.videoMedia;F.ctx.drawImage(F.video,0,0);F=F.canvas;F.convertToBlob?F.convertToBlob({type:"image/jpeg",quality:.6}).then(C):F.toBlob(C,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,
max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,
capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};v.WEBAUTHN=function(r){function C(){if(P){var N=Error("Cancelling existing WebAuthn API call for new one");N.name="WebAuthnAbortError";P.abort(N)}P=new AbortController;return P.signal}function F(){if(P){var N=Error("Manually cancelling existing WebAuthn API call");N.name="WebAuthnAbortError";P.abort(N);P=void 0}}var t=new r;t.name="WebAuthN_Channel";t.newInstance=function(){return v.WEBAUTHN(r)};
t.onopen=function(){svGlobal.logger.info("webAuthn open")};t.onclose=function(){svGlobal.logger.info("webAuthn close")};var P=null;t.process=function(N){var T=N.getEnd()-N.getPosition();N=N.getBytes(T);var Z=Hb(N),S=Z.command;T=Z.flags;N=Z.timeout;var pa=Z.webAuthNPara;if(S)switch(console.log("==== command: "+Z.command),S){case 5:if(Z.request)switch(S=Z.request[0],console.log("==== webAuth cmdType = "+S),console.log("==== webAuth request bytes: "+ub(Z.request.slice(1,Z.request.length))),S){case 1:Z=
Z.request.slice(1,Z.request.length);var y=Hb(Z);Z=y[1];var X=y[2],ja=y[3],V=y[4],da=y[5];S=y[6];var ka=y[7];y={};var va=yd(pa);va&&(va.attestation&&(y.attestation=va.attestation),va.attestationFormats&&(y.attestationFormats=va.attestationFormats));if(T=xd(T,pa,ka))y.authenticatorSelection=T;y.challenge=Z;da&&(y.excludeCredentials=Dc(da));y.rpId=X.id;y.rp=X;y.extensions=S?S:{};y.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};V&&(y.pubKeyCredParams=
V);N&&(y.timeout=N);y.user=ja;N={};N.signal=C();N.publicKey=y;navigator.credentials.create(N).then(function(fa){zd(fa.response,X).then(function(ma){var ea={},qa={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},Sa=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);qa.aaGuid=Sa.buffer;qa.residentKey=!0;ea.deviceInfo=
qa;ea.status=0;ea.response=ma;ma=CBOR.encode(ea);ea=new hi5.DataBuffer(new Uint8Array(4+ma.byteLength));ea.setLittleEndian32(0);ea.setBytes(ma);ea.markEnd();t.send(ea)})}).catch(function(fa){console.log("WebAuthN MakeCredential failed with error code ["+fa.code+"], msg: "+fa.message);fa=new hi5.DataBuffer(new Uint8Array(4));fa.setLittleEndian32(1);fa.markEnd();t.send(fa)});break;case 2:Z=Z.request.slice(1,Z.request.length);y=Hb(Z);Z=y[2];ja=y[3];S=y[4];ka=y[5];y={};ja&&(y.allowCredentials=Dc(ja));
y.challenge=Z;S&&(y.extensions=S);y.rp=window.location.hostname;N&&(y.timeout=N);if(N=Cc(T,pa,ka))y.userVerification=N;N={};N.signal=C();N.publicKey=y;navigator.credentials.get(N).then(function(fa){fa=new hi5.DataBuffer(new Uint8Array(void 0));fa.markEnd();t.send(fa)}).catch(function(fa){console.log("WebAuthN GetAssertion failed with error code ["+fa.code+"], msg: "+fa.message);fa=new hi5.DataBuffer(new Uint8Array(4));fa.setLittleEndian32(1);fa.markEnd();t.send(fa)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+
S)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:N=new hi5.DataBuffer(new Uint8Array(8));N.setLittleEndian32(0);T=Bc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;T?N.setLittleEndian32(1):N.setLittleEndian32(0);N.markEnd();t.send(N);break;case 7:F();N=new hi5.DataBuffer(new Uint8Array(4));N.setLittleEndian32(0);N.markEnd();t.send(N);break;case 8:N=new hi5.DataBuffer(new Uint8Array(8));N.setLittleEndian32(0);N.setLittleEndian32(4);
N.markEnd();t.send(N);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+S)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return t};p.enableWebAuthn()&&Bc()&&(a=v.WEBAUTHN(p.DynamicChannel),p.addDynamicChannel(a));v.WEBCAM=function(r){var C=new r;C.name="RDCamera_Device_0";C.version=2;C.newInstance=function(){return v.WEBCAM(r)};C.onopen=function(){svGlobal.logger.info("cam open")};C.onclose=function(){svGlobal.logger.info("cam close")};C.sendSucess=
function(){var F=new hi5.DataBuffer(new Uint8Array(2));F.setByte(C.version);F.setByte(1);F.markEnd();C.send(F)};C.sendError=function(F){var t=new hi5.DataBuffer(new Uint8Array(6));t.setByte(C.version);t.setByte(2);t.setLittleEndian32(F||1);t.markEnd();C.send(t)};C.sendSteamListResp=function(){var F=new hi5.DataBuffer(new Uint8Array(7));F.setByte(C.version);F.setByte(10);F.setLittleEndian16(1);F.setByte(1);F.setByte(1);F.setByte(0);F.markEnd();C.send(F)};C.sendMediaTypeListResp=function(F){var t=v.videoMedia.resolutions,
P=t.length,N=new hi5.DataBuffer(new Uint8Array(2+26*P));N.setByte(C.version);N.setByte(12);for(var T=1==F,Z=0;Z<P;Z++){N.setByte(F);var S=t[Z];N.setLittleEndian32(S.width);N.setLittleEndian32(S.height);N.setLittleEndian32(T?S.frameRate:v.videoMedia.minFrameRate);N.setLittleEndian32(1);N.setLittleEndian32(1);N.setLittleEndian32(1);N.setByte(1)}N.markEnd();C.send(N)};C.sendCurrentMediaType=function(F,t){var P=new hi5.DataBuffer(new Uint8Array(28));P.setByte(C.version);P.setByte(14);t=v.videoMedia.resolutions[t];
P.setByte(F);P.setLittleEndian32(t.width);P.setLittleEndian32(t.height);P.setLittleEndian32(1==F?t.frameRate:v.videoMedia.minFrameRate);P.setLittleEndian32(1);P.setLittleEndian32(1);P.setLittleEndian32(1);P.setByte(1);P.markEnd();C.send(P)};C.sendSampleResp=function(F){v.videoMedia.grabFrame(function(t){var P=new hi5.DataBuffer(new Uint8Array(t.byteLength+3));P.setByte(C.version);P.setByte(18);P.setByte(F);P.setBytes(new Uint8Array(t));P.markEnd();C.send(P)})};C.sendPropertyListResp=function(){for(var F=
0,t,P,N=v.videoMedia.propertyList,T=0;2>T;T++){P=N[T];t=P.length;for(var Z=0;Z<t;Z++)null!=P[Z]&&F++}var S=new hi5.DataBuffer(new Uint8Array(2+19*F));S.setByte(C.version);S.setByte(21);for(T=0;2>T;T++){P=N[T];t=P.length;var pa=T+1;for(Z=0;Z<t;Z++)F=P[Z],null!=F&&(S.setByte(pa),S.setByte(F.propertyId),S.setByte(F.capabilities),S.setLittleEndian32(F.min),S.setLittleEndian32(F.max),S.setLittleEndian32(F.step),S.setLittleEndian32(F.default))}S.markEnd();C.send(S)};C.sendPropertyValueResp=function(F,t){(F=
v.videoMedia.propertyList[F-1][t-1])?(t=new hi5.DataBuffer(new Uint8Array(7)),t.setByte(C.version),t.setByte(23),t.setByte(F.capabilities),t.setLittleEndian32(F.default),t.markEnd(),C.send(t)):C.sendError(8)};C.setPropertyValue=function(F,t,P){if(F=v.videoMedia.propertyList[F-1][t-1])F.default=P};C.process=function(F){F.getByte();var t=F.getByte();switch(t){case 7:v.videoMedia.activate(C.sendSucess,C.sendError);break;case 8:v.videoMedia.deactivate();C.sendSucess();break;case 9:C.sendSteamListResp();
break;case 11:F=F.getByte();0!=F&&svGlobal.logger.warn("Invalid stream index: "+F);C.sendMediaTypeListResp(v.videoMedia.type);break;case 13:F=F.getByte();C.sendCurrentMediaType(v.videoMedia.type,F);break;case 15:F.getByte();t=F.getByte();if(t!=v.videoMedia.type){svGlobal.warn("Invalid video format req:"+t);C.sendError(6);break}t=F.getLittleEndian32();var P=F.getLittleEndian32();F=F.getLittleEndian32()/F.getLittleEndian32();v.videoMedia.startStream(t,P,F,C.sendSucess,C.sendError);break;case 16:v.videoMedia.stopStream();
C.sendSucess();break;case 17:F=F.getByte();0!=F&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+F);C.sendSampleResp(F);break;case 20:C.sendPropertyListResp();break;case 22:t=F.getByte();P=F.getByte();C.sendPropertyValueResp(t,P);break;case 24:t=F.getByte();P=F.getByte();var N=F.getByte();F=F.getLittleEndian32();1==N&&C.setPropertyValue(t,P,F);C.sendSucess();break;default:C.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+t)}};return C};v.WEBCAM_ENUM=function(r,C){var F=new r;
F.name="RDCamera_Device_Enumerator";F.onopen=function(){var t=new hi5.DataBuffer(new Uint8Array(2));t.setByte(C.version);t.setByte(3);t.markEnd();F.send(t);svGlobal.logger.info("camEnum open")};F.onclose=function(){svGlobal.logger.info("camEnum closed");v.videoMedia.deactivate()};F.addDevice=function(t){t+="\x00";var P=C.name+"\x00",N=new hi5.DataBuffer(new Uint8Array(2+2*t.length+P.length));N.setByte(C.version);N.setByte(5);N.setUnicodeString(t);N.setAscllString(P);N.markEnd();F.send(N)};F.process=
function(t){var P=t.getByte();t=t.getByte();switch(t){case 4:svGlobal.logger.info("camEnum ver resp: "+P);C.version=P;F.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+t)}};return F};d&&(d=v.WEBCAM(p.DynamicChannel),a=v.WEBCAM_ENUM(p.DynamicChannel,d),p.addDynamicChannel(a),p.addDynamicChannel(d));f&&(svGlobal.logger.info("Mapping USB..."),p.addDynamicChannel(Ea.usbChannel));if(b&&v.GFX){var x=function(){O.drawable.resumePlay||
(O.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();O.resumeVideo()})},O=v.GFX(p.DynamicChannel,R(M.remotefx)&&!R(M.gfx),0==p.mode,ra,M.hardwareAcceleration);O.onmessage=function(r){p.showMessage(r)};x();O.onuserinteract=function(r){ca.execute("showPlay");x();svGlobal.logger.info("resumePlay");return!0};O.onfatalerror=function(r,C){p.reconnect(r.width,r.height,!0)};O.onsps=function(r){r.fps&&p.setFPS(r.fps)};O.onresetgraphic=function(r){p.setResolution(r.width,r.height)};O.onmapsurface=
function(r){O.onconfirm();var C=ca.getMonitorSurface(r.outputOriginX,r.outputOriginY,r.targetWidth+r.outputOriginX-1,r.targetHeight+r.outputOriginY-1);C?(C.setId(r.id),C.setSize(r.targetWidth,r.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+r.outputOriginX+" y:"+r.outputOriginY)};O.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ca.execute("setDrawable",[O.drawable])};p.addDynamicChannel(O)}v.VOR&&(b=v.VOR(p.DynamicChannel),p.addDynamicChannel(b[0]),p.addDynamicChannel(b[1]),
p.addDynamicChannel(v.GT(p.DynamicChannel)))}}},db=null;svGlobal.DCVC_EXTENSION&&!kb&&(p.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ea.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(p.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(p.GatewayChannel),p.addGatewayChannel(db)));this.getPrinters=function(a){if(!p.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();p.onagentmessage(b.getData());db.listCallback=a};
this.attachPrinter=function(a){db&&db.attachPrinter(a,p)};this.showError=Gb;this.resetStatus=ac;this.exeAppCmd=function(a){var b=ca.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ca.getWinById(a):ca.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ha.forceReconnect||!1);if(!Ha&&!c)return!1;M.minWidth&&a<M.minWidth&&(a<M.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+
M.minWidth),a=M.minWidth);M.minHeight&&b<M.minHeight&&(b<M.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+M.minHeight),b=M.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ja)&&4>Math.abs(b-Ka))return!1;if(Ra&&Ra.enabled&&!1!==ha.displayVC)Ra.applyResolution(a,b);else if(pc&&qb||c||Wa&&!pc)qb=!1,svGlobal.logger.info("reconnecting..."),ta("8E0"+a+"\t"+b),Qa&&(Qa.remoteLockFlags=0,Qa.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ta(a)};
this.getUploadManager=function(){return Ma};this.setFPS=function(a){ca.execute("setFPS",[a])};this.addSurface=function(a){if(!ca.hasSurface(a)&&(Kb||ra.setContext(a.context),!ca.hasSurface(a)||!a.railWin)){kb&&a.setPlayerMode();M.mouseMoveEmu&&(a.mouseMoveEmu=R(M.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ja&&(Ja=b.width);0==Ka&&(Ka=b.height);a.setConfig(ha);ca.addSurface(a);Na(Ja,Ka,!0,M.monitorDef?!0:!1);a.setController(Qa);a.setDrawable(Sd);a.setTouchpad(R(M.touchpad));
var c=b=R(M.mapClipboard),e=b;void 0!=M.copyToLocal?c=R(M.copyToLocal):void 0!=ha.copyToLocal&&(c=ha.copyToLocal);void 0!=M.copyToRemote?e=R(M.copyToRemote):void 0!=ha.copyToRemote&&(e=ha.copyToRemote);a.setClipboard(b,c,e);Jb&&bc(a);M.invitation&&!R(M.control)&&(ca.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=M.ctrlToWin?R(M.ctrlToWin):void 0!=ha.ctrlToWin?ha.ctrlToWin:!0;c=void 0!=M.cmdToCtrl?R(M.cmdToCtrl):void 0!=ha.cmdToCtrl?ha.cmdToCtrl:!0;a.run(parseInt(M.keyboard||
1033,10),b,!!ha.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ca.size();b<c;b++)ca.getSurface(b).railWin.getMain(ca.zOrders)&&a.push(ca.getSurface(b).railWin.getMain(ca.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ta("8C2"+a+"\t"+b+"\t"+c);var e=ca.getSurface(ca.size()-1);e&&(e.remoteApp=new Ac(a,b,c))};this.startExitingApp=function(a){a=ca.popWins(a);for(var b=a.length-1;0<=b;b--)ca.addWin(a[b])};var xb=new p.DynamicChannel;xb.name=
"PNPDR";xb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};xb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),xb.send(a)}};xb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};p.addDynamicChannel(xb);var gb=null;
R(M.scanner)&&(gb=new p.DynamicChannel,gb.name="SCANNERDVC",gb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},gb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(p.onagentmessage)p.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(p.onagentmessage)p.onagentmessage(b);
break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(p.onagentmessage)p.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},gb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addDynamicChannel(gb));var ab=null;p.hasSmartCard()&&(ab=new p.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=
1;if(p.onagentmessage)p.onagentmessage(a);R(M.passwordIsPin)&&p.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(p.onagentmessage)p.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;yb&&(b+=yb.length);eb&&(b+=eb.length);
b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);yb?(b.setLittleEndian32(yb.length),b.setBytes(yb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(p.onagentmessage)p.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(p.onagentmessage)p.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+
a[1]+"].")}break;case 2:if(ab)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),p.onagentmessage)p.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addGatewayChannel(ab));ha.detectNetwork&&(q+="&connectType=7",
Cd());this.getNetworkResult=function(){return cc};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var dc=new Map,ec=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));
switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:dc.clear();ec.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",
b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var f=b.getLittleEndian32();f=b.getAscllString(f,!1);var n=b.getLittleEndian32();n=b.getAscllString(n,!1);var H=b.getLittleEndian32();b.getAscllString(H,!1);H=b.getLittleEndian64();H=(new Date(1E3*
H)).toDateString();d=Dd(a,d,n,f,H);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var z,E=document.querySelector('input[name="scard_name"]:checked');E&&(z=parseInt(E.value));yb=dc.get(z);rb=ec.get(z);z=document.getElementById("userPin").value;
eb=(new TextEncoder("utf-8")).encode(z);z=2;z=eb?z+4+eb.length:z+4;z=rb?z+4+rb.length:z+4;z=new Uint8Array(z);z=new hi5.DataBuffer(z);z.setByte(1);z.setByte(2);eb?(z.setLittleEndian32(eb.length),z.setBytes(eb)):z.setLittleEndian32(0);rb?(z.setLittleEndian32(rb.length),z.setAsciiString(rb,rb.length)):z.setLittleEndian32(0);ab&&ab.send(z)};document.getElementById("userPin").addEventListener("keypress",function(z){"Enter"===z.key&&(z.preventDefault(),document.getElementById("continue_button").click())});
b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(gb)switch(a[1]){case 2:b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML=
"<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,p.onagentmessage)p.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=
b.getAscllString(41,!0),d=Ed(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var z=0,E=document.querySelector('input[name="ds_name"]:checked');E&&(z=E.value);E=new Uint8Array(3);E[0]=4;E[1]=5;E[2]=z;if(p.onagentmessage)p.onagentmessage(E)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));gb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();p.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>
b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=p.getAgentLink(),hi5.notifications.notify({title:b,html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)f=b.getLittleEndian32(),d=b.getUnicodeString(f),f=b.getLittleEndian32(),f=b.getUnicodeString(f),c.push({name:d,driver:f});
db&&db.listCallback&&(db.listCallback(c),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var yb,eb,rb,hc={type:6,data:null};this.setAgentStatus=function(a){Vc=a};this.getAgentStatus=function(){return Vc};this.run=function(){var a;if(a=null==p.onagentmessage)a=1==p.mode?!1:p.hasSmartCard()||p.hasScanner()||R(M.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(p):(p.hasUSB()?ca.getFocused().requestUsbDevices(p.getUSB(),
function(b){Ea.usbChannel.openDevices(b);fc()}):fc(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return ra};this.mouseDown=function(a,b,c){Wa&&ta("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Wa&&ta("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Wa&&ta("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Wa&&ta("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Wa&&("number"==typeof a?(ta("840\t"+a),ta("8449152\t"+a)):ta("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,
b){p.reconnectOnResize&&(Va?(nb&&(clearTimeout(nb),nb=0),a&=-4,b&=-4,nb=setTimeout(function(){document.hidden||(Ra&&Ra.enabled&&Ra.applyResolution(a,b),setTimeout(function(){p.writeRawInput("8C661441\t"+a+"\t"+b);3==p.windowState&&Tc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):p.running()&&(nb&&(clearTimeout(nb),nb=0),nb=setTimeout(function(){document.hidden||p.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!p.sessionInfo.suppressOutput)return!1;
void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Xb,b[4]=Xb>>8,b[5]=Wb,b[6]=Wb>>8,b[7]=Yb,b[8]=Yb>>8,b[9]=Zb,b[10]=Zb>>8);ta(b.buffer);return!0};this.refreshOutput=function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ta(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ta(b.buffer)};this.startPing=function(a,b){b=b||0;Pa||
(Pa=new hi5.tool.ResponseMonitor(function(){Wa&&p.sendPing()},function(){if(Wa&&p.onnoresponse)return p.onnoresponse()}));Pa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;ta(c.buffer);setTimeout(function(){Pa&&Pa.check()},1E3*(a+b));La?La.postMessage({type:0,cmd:6,start:1}):(Ba.onSlowPath=Ba.onFastPath=Kc,Ba.onReqHistory=function(){Kc(15555)})};this.stopPing=function(){Pa&&Pa.stop();La?La.postMessage({type:0,cmd:6,start:0}):Ba.onSlowPath=Ba.onFastPath=Ba.onReqHistory=null};
var Ya=null,Qc=0;this.play=function(){ta("F3")};this.pause=function(){ta("F2")};this.scan=function(a){ta("F4"+(a?"1":"0"))};this.seek=function(a){var b=ca.getFocused();b&&Ha&&(ta("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),ra.pause(!0))};var Ca={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();
this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Pc=!1;this.showMessage=function(a,b,c){p&&p.displayMsg&&a&&((b=b||ca.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(){svGlobal.logger.info("closing...");Ha&&Va&&ca&&ha.closeRemoteApp&&ca.tryCloseRemoteApps();ra&&ra.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),
setTimeout(Sc,2222)):Sc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(p.close):window.addEventListener("unload",p.close,!1);Lb.searchStartCode=function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};qc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Mb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
Mb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d){function f(y,X,ja,V){this.pixels=y;this.width=X;this.height=ja;this.key=V}function n(){this.bottom=this.right=this.top=this.left=0;this.read=function(y){this.left=y.getLittleEndian16();this.top=y.getLittleEndian16();this.right=y.getLittleEndian16();this.bottom=y.getLittleEndian16()};this.toString=
function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function H(){this.qualityVal=this.p=this.qb=0;this.read=function(y){var X=y.getByte();this.qp=X&63;this.p=X>>7&1;this.qualityVal=y.getByte()}}function z(y,X,ja){this.bitstream=y;this.regionRects=X;this.isChroma=ja;this.timestamp=0}function E(y,X,ja){this.width=y;this.height=X;this.monitors=ja}function B(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(y){this.left=y.getLittleEndian32();
this.top=y.getLittleEndian32();this.right=y.getLittleEndian32();this.bottom=y.getLittleEndian32();this.flags=y.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function v(y,X,ja,V){function da(){ea=!1;qa.drawable=fa._video;fa._player=ka?new Qd(fa,!1,V):new Mb(qa.drawable,fa,!1);fa._player.onsps=function(g){ka&&(fa._video.width=g.width,fa._video.height=g.height);fa.onsps&&fa.onsps(g)};fa._player.onerror=
function(g){fa.onfatalerror&&fa.onfatalerror(fa,g)};fa._player.onplayerror=function(g){function l(){qa={drawable:fa._video};fa.player.play(!0)}qa=null;if((!fa.onuserinteract||!fa.onuserinteract(l,"video"))&&fa.onmessage)fa.onmessage({msg:"Please click Yes to continue.<br>"+g,cbYes:function(){fa.player.play(!0);this.destroy()}})};fa._player.onframedecoded=function(g){va.drawImage(g,0,0)}}this.id=y;this.width=X;this.height=ja;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=
X;this.targetHeight=ja;this._player=null;var ka="no-decoder"==V?!1:!!window.VideoDecoder;this._video=ka?new OffscreenCanvas(X,ja):document.createElement("video");var va=ka?this._video.getContext("2d"):null,fa=this,ma=null,ea=!0,qa={drawable:null},Sa=10;ka&&svGlobal.logger.info("...MediaDecoder in use: "+V);this.resumeVideo=function(){fa._player&&fa._player.play(!0)};this.setDisplayBuffer=function(g){ma=g};this.draw=function(g,l,k,h){return ea?ma.draw(g,l,k,h):qa};this.processAvc=function(g){ea&&da();
if(ka)g.timestamp=Sa,Sa+=10;else if(g.isChroma)return;fa.onvideoframe(g)};this.reset=function(g,l){fa&&fa._player&&fa._player.reset()};this.close=function(){fa&&fa._player&&(fa._player.close(),fa._player=null);fa=null};this.setRGBs=function(g,l,k,h,u,w,D){ma.setRGBs(g,l,k,h,u,w,D)};this.getRGBs=function(g,l,k,h){return ma.getRGBs(g,l,k,h)};this.moveArea=function(g,l,k,h,u,w){ma.moveArea(g,l,k,h,u,w)};this.fillRect=function(g,l,k,h,u){ma.fillRect(g,l,k,h,u)};this.postPaint=function(g,l,k,h){ea&&ma.postPaint(g,
l,k,h)}}function x(y,X,ja,V){var da=new v(y,X,ja,d);da.pixelFormat=V||33;da.setDisplayBuffer(e);pa.push(da);S.oncreatesurface&&S.oncreatesurface(da);svGlobal.logger.info("create surface id:"+y+" w:"+X+" h:"+ja+" pixelFmt:"+da.pixelFormat);return da}function O(y,X,ja){for(var V=y.getPosition(),da=y.getLittleEndian32(),ka=Array(da),va=0;va<da;va++){var fa=new n;fa.read(y);ka[va]=fa}fa=Array(da);for(va=0;va<da;va++){var ma=new H;ma.read(y);fa[va]=ma}y=y.getBytes(X-(y.getPosition()-V));return new z(y,
ka,ja)}function r(y,X,ja,V){ja=y.getLittleEndian32();var da=ja>>>30;ja&=1073741823;switch(da){case 0:var ka=O(y,ja,!1);var va=O(y,X-ja-4,!0);break;case 1:ka=O(y,ja,!1);break;case 2:X=y.getEnd()-y.getPosition();va=O(y,X,!0);break;default:throw Error("Invalid LC: "+da);}ka&&V.processAvc(ka);va&&V.processAvc(va)}function C(y){var X=y.getLittleEndian32(),ja=y.getLittleEndian32();y=y.getLittleEndian32();var V=!1;switch(X){case 524292:V=!1;0==(y&1)&&(P=new ClearDecoder);break;case 524549:(V=0!=(y&16))||
0!=(y&1)||(P=new ClearDecoder);break;default:V=0==(y&32)}e.onGetGfxHistory=function(da,ka){var va=F.toPDU();va&&da(va);ka();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(da,ka){svGlobal.logger.info("Set GFX Histroy");10==da?F.fromStream(ka):svGlobal.logger.error("Invalid GFX histroy type: "+da)};svGlobal.logger.info("Gfx Cap, Ver:"+X.toString(16)+" len:"+ja+" flags:"+y+" h264:"+V);S.onconfirm&&S.onconfirm();return V}var F=new function(){function y(h,u,w,D,A){this.len=h;this.code=
u;this.valueBits=w;this.type=D;this.vbase=A}function X(h){var u=25E5-ka,w=h.length;if(u>=w)da.set(h,ka),ka=u>w?ka+w:0;else if(25E5>=w)da.set(h.subarray(0,u),ka),da.set(h.subarray(u),0),ka=w-u;else{u=(w-u)%25E5;var D=w-u,A=h.subarray(D);h=h.subarray(w-25E5,D);da.set(h,25E5-h.length);da.set(A,0);ka=u}}function ja(h){for(;qa<h;)ea<<=8,Sa<l?ea+=g[Sa++]:console.log("--- end"),qa+=8;ma-=h;qa-=h;h=ea>>qa;ea&=(1<<qa)-1;return h}var V=[new y(1,0,8,0,0),new y(5,17,5,1,0),new y(5,18,7,1,32),new y(5,19,9,1,160),
new y(5,20,10,1,672),new y(5,21,12,1,1696),new y(5,24,0,0,0),new y(5,25,0,0,1),new y(6,44,14,1,5792),new y(6,45,15,1,22176),new y(6,52,0,0,2),new y(6,53,0,0,3),new y(6,54,0,0,255),new y(7,92,18,1,54944),new y(7,93,20,1,317088),new y(7,110,0,0,4),new y(7,111,0,0,5),new y(7,112,0,0,6),new y(7,113,0,0,7),new y(7,114,0,0,8),new y(7,115,0,0,9),new y(7,116,0,0,10),new y(7,117,0,0,11),new y(7,118,0,0,58),new y(7,119,0,0,59),new y(7,120,0,0,60),new y(7,121,0,0,61),new y(7,122,0,0,62),new y(7,123,0,0,63),
new y(7,124,0,0,64),new y(7,125,0,0,128),new y(8,188,20,1,1365664),new y(8,189,21,1,2414240),new y(8,252,0,0,12),new y(8,253,0,0,56),new y(8,254,0,0,57),new y(8,255,0,0,102),new y(9,380,22,1,4511392),new y(9,381,23,1,8705696),new y(9,382,24,1,17094304)],da=new Uint8Array(25E5),ka=0,va=new Uint8Array(65536),fa=0,ma=0,ea=0,qa=0,Sa=0,g=null,l=0,k=!0;this.toPDU=function(){if(k)return null;var h=new Uint8Array(2500008);h[0]=29;h[2]=1;h[3]=10;h[4]=ka;h[5]=ka>>8;h[6]=ka>>16;h[7]=ka>>24;h.set(da,8);return h};
this.fromStream=function(h){ka=h.getLittleEndian32();da.set(h.getSubarray(25E5))};this.decompress=function(h,u){if(u){g=h;k&&(k=!1);l=g.length-1;ma=8*l-g[l];for(fa=Sa=qa=ea=0;0<ma;)for(var w=u=0,D=0;D<V.length;D++){for(h=V[D];u<h.len;)w=(w<<1)+ja(1),u++;0>w&&console.log("xxx inPrefix");if(w==h.code){if(0==h.type)h=h.vbase+ja(h.valueBits),(0>h||255<h)&&console.log("xxx do c"),h&=255,da[ka]=h,25E5==++ka&&(ka=0),va[fa++]=h;else if(u=ja(h.valueBits),u=h.vbase+u,0>u&&console.log("xxx distance"),0!=u){if(0==
ja(1))h=3;else{h=4;for(w=2;1==ja(1);)h*=2,w++;h+=ja(w)}u=25E5-u+ka;u%=25E5;w=u+h;if(Math.abs(ka-u)>=h&&25E5>w&&25E5>ka+h)u=da.subarray(u,w),da.set(u,ka),ka+=h,va.set(u,fa),fa+=h;else for(;0<h;)w=da[u],25E5==++u&&(u=0),da[ka]=w,25E5==++ka&&(ka=0),va[fa++]=w,h--}else h=ja(15),ma-=qa,ea=qa=0,u=g.subarray(Sa,Sa+h),X(u),va.set(u,fa),Sa+=h,fa+=h,ma-=8*h;break}}65536<fa&&console.error("xx outputIndex:"+fa);return va.subarray(0,fa)}X(h);return h}},t=new function(){this.process=function(y){var X=y.getByte();
if(224==X){var ja=0!=(y.getByte()&32);var V=y.getPosition(),da=y.getEnd();X=F.decompress(y.getData().subarray(V,da),ja);y.setPosition(da)}else{225!=X&&console.log("Invalid descriptor:"+X);da=y.getLittleEndian16();var ka=y.getLittleEndian32();X=new Uint8Array(ka);for(var va=0,fa,ma=0;ma<da;ma++)fa=y.getLittleEndian32(),ja=0!=(y.getByte()&32),fa--,V=y.getPosition(),ja=F.decompress(y.getData().subarray(V,V+fa),ja),X.set(ja,va),va+=ja.length,y.skipPosition(fa);va!=ka&&console.error("wrong size, actual:"+
va+" expected:"+ka)}return new RdpBuffer(X,0,X.length)}},P=null,N=new rdpcodecs.RemoteFX(!1),T=0,Z=[],S=new a;S.name="Microsoft::Windows::RDS::Graphics";var pa=new function(y,X){var ja=[];this.push=function(V){V.osps=y.onsps;V.onfatalerror=y.onfatalerror;V.onplayerror=y.onplayerror;V.onuserinteract=y.onuserinteract;V.onmessage=y.onmessage;ja[V.id]=V};this.get=function(V){return ja[V]};this.getAll=function(){return ja};this.delete=function(V){var da=ja[V];da&&(da.onsps=null,da.onfatalerror=null,da.onplayerror=
null,ja[V]=null)};this.reset=function(V){V=0;for(var da=ja.length;V<da;V++)ja[V]&&ja[V].reset()};this.close=function(){for(var V=0,da=ja.length;V<da;V++)ja[V]&&ja[V].close()};this.resumeVideo=function(){for(var V=0,da=ja.length;V<da;V++)ja[V]&&ja[V].resumeVideo()}}(S,e);S.drawable=new function(){this.draw=function(y,X,ja,V,da){return(da=pa.get(da))?da.draw(y,X,ja,V):null};this.getSurfaces=function(){return pa};this.onfocus=function(y){};this.resumePlay=null};S.resumeVideo=function(){pa.resumeVideo()};
S.process=function(y){for(var X=t.process(y);X.has(8);){var ja=X.getLittleEndian16();X.getLittleEndian16();var V=X.getLittleEndian32(),da=X.getPosition()+V-8;switch(ja){case 1:var ka=X,va=ka.getLittleEndian16(),fa=ka.getLittleEndian16(),ma=ka.getByte(),ea=ka.getLittleEndian16(),qa=ka.getLittleEndian16(),Sa=ka.getLittleEndian16(),g=ka.getLittleEndian16(),l=Sa-ea,k=g-qa,h=ka.getLittleEndian32(),u=ka.getPosition()+h,w=pa.get(va);w||(S.onconfirm&&S.onconfirm(),w=x(va,e.width,e.height,ma));switch(fa){case 0:var D=
rdpcodecs.bitmap.byte2int(ka.getData(),h,ka.getPosition());w.setRGBs(ea,qa,l,k,D,0,l);break;case 3:for(var A=N.decode(ka,h),I=A.getRects(),W=A.getTiles(),L=A.getTileSize(),m=A.getRectSize(),K=0;K<L;K++){var G=W[K];if(m)for(var Q=G.x+64,ba=G.y+64,oa=0;oa<m;oa++){var xa=I[oa],Da=xa.x+xa.width,Ia=xa.y+xa.height;Q<=Da?ba<=Ia?w.setRGBs(G.x+ea,G.y+qa,64,64,G.data,0,64):w.setRGBs(G.x+ea,G.y+qa,64,Ia-G.y,G.data,0,64):ba<=Ia?w.setRGBs(G.x+ea,G.y+qa,Da-G.x,64,G.data,0,64):w.setRGBs(G.x+ea,G.y+qa,Da-G.x,Ia-
G.y,G.data,0,64)}else w.setRGBs(G.x,G.y,64,64,G.data,0,4)}break;case 8:P||(P=new ClearDecoder);P.decode(ka,l,k,w.getData(),ea,qa,w.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Fa=w,za=O(ka,h,!1);Fa.processAvc(za);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:r(ka,h,!1,w);break;case 15:r(ka,h,!0,w);break;default:svGlobal.logger.warn("Invalid codec:"+fa)}ka.setPosition(u);w.postPaint(ea,qa,l,k);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");
break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ga=X;svGlobal.logger.info("...soliFill");for(var wa=Ga.getLittleEndian16(),Aa=-16777216|Ga.getByte()<<16|Ga.getByte()<<8|Ga.getByte()|Ga.getByte()<<24,Oa=Ga.getLittleEndian16(),Za=pa.get(wa),$a=0;$a<Oa;$a++){var Xa=Ga.getLittleEndian16(),mb=Ga.getLittleEndian16(),wb=Ga.getLittleEndian16()-Xa,$c=Ga.getLittleEndian16()-mb;Za.fillRect(Xa,mb,wb,$c,Aa);Za.postPaint(Xa,mb,wb,$c)}break;case 5:var hb=X;svGlobal.logger.info("...surfaceToSurface");
for(var ad=hb.getLittleEndian16(),bd=hb.getLittleEndian16(),Ob=hb.getLittleEndian16(),Pb=hb.getLittleEndian16(),Qb=hb.getLittleEndian16()-Ob,uc=hb.getLittleEndian16()-Pb,Td=hb.getLittleEndian16(),cd=pa.get(ad),Ud=pa.get(bd),dd=ad==bd?null:cd.getRGBs(Ob,Pb,Qb,uc),ed=0;ed<Td;ed++){var fd=hb.getLittleEndian16(),gd=hb.getLittleEndian16();dd?Ud.setRGBs(fd,gd,Qb,uc,dd,0,Qb):cd.moveArea(Ob,Pb,Qb,uc,fd-Ob,gd-Pb)}break;case 6:var ob=X;svGlobal.logger.info("...surfaceToCache");var Vd=ob.getLittleEndian16(),
vc=ob.getLittleEndian32().toString(16),hd=ob.getLittleEndian32();0<hd&&(vc=hd.toString(16)+vc);var Wd=ob.getLittleEndian16(),id=ob.getLittleEndian16(),jd=ob.getLittleEndian16(),kd=ob.getLittleEndian16()-id,ld=ob.getLittleEndian16()-jd,Xd=pa.get(Vd).getRGBs(id,jd,kd,ld);Z[Wd]=new f(Xd,kd,ld,vc);break;case 7:var Eb=X;svGlobal.logger.info("...cacheToSurface");for(var Yd=Eb.getLittleEndian16(),Zd=Eb.getLittleEndian16(),$d=Eb.getLittleEndian16(),Rb=Z[Yd],ae=pa.get(Zd),md=0;md<$d;md++){var be=Eb.getLittleEndian16(),
ce=Eb.getLittleEndian16();ae.setRGBs(be,ce,Rb.width,Rb.height,Rb.pixels,0,Rb.width)}break;case 8:var de=X.getLittleEndian16();Z[de]=null;break;case 9:var Sb=X,ee=Sb.getLittleEndian16(),fe=Sb.getLittleEndian16(),ge=Sb.getLittleEndian16(),he=Sb.getByte();x(ee,fe,ge,he);break;case 10:var nd=X.getLittleEndian16();pa.delete(nd);svGlobal.logger.info("delete surface id:"+nd);break;case 11:var od=X;od.getLittleEndian32();od.getLittleEndian32();break;case 12:var ie=X.getLittleEndian32();if(0==T){var pd=new Uint8Array(20),
sb=new RdpBuffer(pd);sb.setLittleEndian16(13);sb.setLittleEndian16(0);sb.setLittleEndian32(20);sb.setLittleEndian32(4294967295);sb.setLittleEndian32(ie);T++;sb.setLittleEndian32(T);sb.markEnd();c&&S.send(pd)}break;case 14:var Tb=X,qd=Tb.getLittleEndian32(),rd=Tb.getLittleEndian32(),wc=Tb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+qd+" h:"+rd+" monitors:"+wc);for(var sd=Array(wc),Ub=0;Ub<wc;Ub++){var xc=new B;xc.read(Tb);sd[Ub]=xc;svGlobal.logger.info("MonitorDef "+Ub+": "+xc.toString())}var td=
new E(qd,rd,sd);pa.reset(td);S.onresetgraphic&&S.onresetgraphic(td);break;case 15:var Vb=X,ud=Vb.getLittleEndian16();Vb.skipPosition(2);var Fb=pa.get(ud);Fb.outputOriginX=Vb.getLittleEndian32();Fb.outputOriginY=Vb.getLittleEndian32();S.onmapsurface&&S.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+ud+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:C(X);break;case 21:svGlobal.logger.info("mapSurfaceToWin");
break;case 22:break;case 23:var zb=X,vd=zb.getLittleEndian16();zb.skipPosition(2);var ib=pa.get(vd);ib.outputOriginX=zb.getLittleEndian32();ib.outputOriginY=zb.getLittleEndian32();ib.targetWidth=zb.getLittleEndian32();ib.targetHeight=zb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+vd+" outX:"+ib.outputOriginX+" outY:"+ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);S.onmapsurface&&S.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");
break;default:svGlobal.logger.warn("xxx gfx:"+ja);return}X.setPosition(da)}};S.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var y=b?2:8,X=10+12*y,ja=new Uint8Array(X),V=new RdpBuffer(ja);V.setLittleEndian16(18);V.setLittleEndian16(0);V.setLittleEndian32(X);V.setLittleEndian16(y);V.setLittleEndian32(524292);V.setLittleEndian32(4);V.setLittleEndian32(b?1:0);V.setLittleEndian32(524549);V.setLittleEndian32(4);V.setLittleEndian32(b?19:0);b||(V.setLittleEndian32(655362),V.setLittleEndian32(4),
V.setLittleEndian32(0),V.setLittleEndian32(655872),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656129),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656384),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656642),V.setLittleEndian32(4),V.setLittleEndian32(0),V.setLittleEndian32(656896),V.setLittleEndian32(4),V.setLittleEndian32(0));V.markEnd();c&&S.send(ja)};S.onclose=function(){pa.close()};return S}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var q=navigator&&(navigator.language||navigator.userLanguage||""),J=Rdp.languageToKeyboard[q];if(!J){var U=q.indexOf("-");U&&(J=Rdp.languageToKeyboard[q.substring(0,U)])}J||(svGlobal.logger.info("No valid layout for "+q),J=1033);return J}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
