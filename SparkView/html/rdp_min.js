var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(r){var L=0;return function(){return L<r.length?{done:!1,value:r[L++]}:{done:!0}}};$jscomp.arrayIterator=function(r){return{next:$jscomp.arrayIteratorImpl(r)}};$jscomp.makeIterator=function(r){var L="undefined"!=typeof Symbol&&Symbol.iterator&&r[Symbol.iterator];return L?L.call(r):$jscomp.arrayIterator(r)};$jscomp.arrayFromIterator=function(r){for(var L,aa=[];!(L=r.next()).done;)aa.push(L.value);return aa};
$jscomp.arrayFromIterable=function(r){return r instanceof Array?r:$jscomp.arrayFromIterator($jscomp.makeIterator(r))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(r){var L=function(){};L.prototype=r;return new L};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(r,L,aa){if(r==Array.prototype||r==Object.prototype)return r;r[L]=aa.value;return r};$jscomp.getGlobal=function(r){r=["object"==typeof globalThis&&globalThis,r,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var L=0;L<r.length;++L){var aa=r[L];if(aa&&aa.Math==Math)return aa}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(r,L){var aa=$jscomp.propertyToPolyfillSymbol[L];if(null==aa)return r[L];aa=r[aa];return void 0!==aa?aa:r[L]};
$jscomp.polyfill=function(r,L,aa,na){L&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(r,L,aa,na):$jscomp.polyfillUnisolated(r,L,aa,na))};$jscomp.polyfillUnisolated=function(r,L,aa,na){aa=$jscomp.global;r=r.split(".");for(na=0;na<r.length-1;na++){var U=r[na];if(!(U in aa))return;aa=aa[U]}r=r[r.length-1];na=aa[r];L=L(na);L!=na&&null!=L&&$jscomp.defineProperty(aa,r,{configurable:!0,writable:!0,value:L})};
$jscomp.polyfillIsolated=function(r,L,aa,na){var U=r.split(".");r=1===U.length;na=U[0];na=!r&&na in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var xa=0;xa<U.length-1;xa++){var ca=U[xa];if(!(ca in na))return;na=na[ca]}U=U[U.length-1];aa=$jscomp.IS_SYMBOL_NATIVE&&"es6"===aa?na[U]:null;L=L(aa);null!=L&&(r?$jscomp.defineProperty($jscomp.polyfills,U,{configurable:!0,writable:!0,value:L}):L!==aa&&($jscomp.propertyToPolyfillSymbol[U]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(U):$jscomp.POLYFILL_PREFIX+
U,U=$jscomp.propertyToPolyfillSymbol[U],$jscomp.defineProperty(na,U,{configurable:!0,writable:!0,value:L})))};
$jscomp.getConstructImplementation=function(){function r(){function aa(){}new aa;Reflect.construct(aa,[],function(){});return new aa instanceof aa}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(r())return Reflect.construct;var L=Reflect.construct;return function(aa,na,U){aa=L(aa,na);U&&Reflect.setPrototypeOf(aa,U.prototype);return aa}}return function(aa,na,U){void 0===U&&(U=aa);U=$jscomp.objectCreate(U.prototype||Object.prototype);return Function.prototype.apply.call(aa,
U,na)||U}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var r={a:!0},L={};try{return L.__proto__=r,L.a}catch(aa){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(r,L){r.__proto__=L;if(r.__proto__!==L)throw new TypeError(r+" is not extensible");return r}:null;
$jscomp.inherits=function(r,L){r.prototype=$jscomp.objectCreate(L.prototype);r.prototype.constructor=r;if($jscomp.setPrototypeOf){var aa=$jscomp.setPrototypeOf;aa(r,L)}else for(aa in L)if("prototype"!=aa)if(Object.defineProperties){var na=Object.getOwnPropertyDescriptor(L,aa);na&&Object.defineProperty(r,aa,na)}else r[aa]=L[aa];r.superClass_=L.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(r){if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(r){this.yieldResult=r};
$jscomp.generator.Context.prototype.throw_=function(r){this.abruptCompletion_={exception:r,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(r){this.abruptCompletion_={return:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(r){this.abruptCompletion_={jumpTo:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(r,L){this.nextAddress=L;return{value:r}};
$jscomp.generator.Context.prototype.yieldAll=function(r,L){r=$jscomp.makeIterator(r);var aa=r.next();$jscomp.generator.ensureIteratorResultIsObject_(aa);if(aa.done)this.yieldResult=aa.value,this.nextAddress=L;else return this.yieldAllIterator_=r,this.yield(aa.value,L)};$jscomp.generator.Context.prototype.jumpTo=function(r){this.nextAddress=r};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(r,L){this.catchAddress_=r;void 0!=L&&(this.finallyAddress_=L)};$jscomp.generator.Context.prototype.setFinallyBlock=function(r){this.catchAddress_=0;this.finallyAddress_=r||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(r,L){this.nextAddress=r;this.catchAddress_=L||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(r){this.catchAddress_=r||0;r=this.abruptCompletion_.exception;this.abruptCompletion_=null;return r};$jscomp.generator.Context.prototype.enterFinallyBlock=function(r,L,aa){aa?this.finallyContexts_[aa]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=r||0;this.finallyAddress_=L||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(r,L){L=this.finallyContexts_.splice(L||0)[0];if(L=this.abruptCompletion_=this.abruptCompletion_||L){if(L.isException)return this.jumpToErrorHandler_();void 0!=L.jumpTo&&this.finallyAddress_<L.jumpTo?(this.nextAddress=L.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=r};$jscomp.generator.Context.prototype.forIn=function(r){return new $jscomp.generator.Context.PropertyIterator(r)};
$jscomp.generator.Context.PropertyIterator=function(r){this.object_=r;this.properties_=[];for(var L in r)this.properties_.push(L);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var r=this.properties_.pop();if(r in this.object_)return r}return null};$jscomp.generator.Engine_=function(r){this.context_=new $jscomp.generator.Context;this.program_=r};
$jscomp.generator.Engine_.prototype.next_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,r,this.context_.next_);this.context_.next_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(r){this.context_.start_();var L=this.context_.yieldAllIterator_;if(L)return this.yieldAllStep_("return"in L?L["return"]:function(aa){return{value:aa,done:!0}},r,this.context_.return);this.context_.return(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],r,this.context_.next_);this.context_.throw_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(r,L,aa){try{var na=r.call(this.context_.yieldAllIterator_,L);$jscomp.generator.ensureIteratorResultIsObject_(na);if(!na.done)return this.context_.stop_(),na;var U=na.value}catch(xa){return this.context_.yieldAllIterator_=null,this.context_.throw_(xa),this.nextStep_()}this.context_.yieldAllIterator_=null;aa.call(this.context_,U);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var r=this.program_(this.context_);if(r)return this.context_.stop_(),{value:r.value,done:!1}}catch(L){this.context_.yieldResult=void 0,this.context_.throw_(L)}this.context_.stop_();if(this.context_.abruptCompletion_){r=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(r.isException)throw r.exception;return{value:r.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(r){this.next=function(L){return r.next_(L)};this.throw=function(L){return r.throw_(L)};this.return=function(L){return r.return_(L)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(r,L){L=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(L));$jscomp.setPrototypeOf&&r.prototype&&$jscomp.setPrototypeOf(L,r.prototype);return L};
$jscomp.asyncExecutePromiseGenerator=function(r){function L(na){return r.next(na)}function aa(na){return r.throw(na)}return new Promise(function(na,U){function xa(ca){ca.done?na(ca.value):Promise.resolve(ca.value).then(L,aa).then(xa,U)}xa(r.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(r){return $jscomp.asyncExecutePromiseGenerator(r())};$jscomp.asyncExecutePromiseGeneratorProgram=function(r){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(r)))};
$jscomp.polyfill("Reflect",function(r){return r?r:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(r){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(r){if(r)return r;if($jscomp.setPrototypeOf){var L=$jscomp.setPrototypeOf;return function(aa,na){try{return L(aa,na),!0}catch(U){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(r){if(r)return r;var L=function(U,xa){this.$jscomp$symbol$id_=U;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:xa})};L.prototype.toString=function(){return this.$jscomp$symbol$id_};var aa=0,na=function(U){if(this instanceof na)throw new TypeError("Symbol is not a constructor");return new L("jscomp_symbol_"+(U||"")+"_"+aa++,U)};return na},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(r){if(r)return r;r=Symbol("Symbol.iterator");for(var L="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),aa=0;aa<L.length;aa++){var na=$jscomp.global[L[aa]];"function"===typeof na&&"function"!=typeof na.prototype[r]&&$jscomp.defineProperty(na.prototype,r,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return r},
"es6","es3");$jscomp.iteratorPrototype=function(r){r={next:r};r[Symbol.iterator]=function(){return this};return r};
$jscomp.polyfill("Promise",function(r){function L(){this.batch_=null}function aa(ca){return ca instanceof U?ca:new U(function(ta,ea){ta(ca)})}if(r&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return r;L.prototype.asyncExecute=function(ca){if(null==this.batch_){this.batch_=[];var ta=this;this.asyncExecuteFunction(function(){ta.executeBatch_()})}this.batch_.push(ca)};
var na=$jscomp.global.setTimeout;L.prototype.asyncExecuteFunction=function(ca){na(ca,0)};L.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var ca=this.batch_;this.batch_=[];for(var ta=0;ta<ca.length;++ta){var ea=ca[ta];ca[ta]=null;try{ea()}catch(ma){this.asyncThrow_(ma)}}}this.batch_=null};L.prototype.asyncThrow_=function(ca){this.asyncExecuteFunction(function(){throw ca;})};var U=function(ca){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var ta=this.createResolveAndReject_();try{ca(ta.resolve,ta.reject)}catch(ea){ta.reject(ea)}};U.prototype.createResolveAndReject_=function(){function ca(ma){return function(ra){ea||(ea=!0,ma.call(ta,ra))}}var ta=this,ea=!1;return{resolve:ca(this.resolveTo_),reject:ca(this.reject_)}};U.prototype.resolveTo_=function(ca){if(ca===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(ca instanceof U)this.settleSameAsPromise_(ca);else{a:switch(typeof ca){case "object":var ta=
null!=ca;break a;case "function":ta=!0;break a;default:ta=!1}ta?this.resolveToNonPromiseObj_(ca):this.fulfill_(ca)}};U.prototype.resolveToNonPromiseObj_=function(ca){var ta=void 0;try{ta=ca.then}catch(ea){this.reject_(ea);return}"function"==typeof ta?this.settleSameAsThenable_(ta,ca):this.fulfill_(ca)};U.prototype.reject_=function(ca){this.settle_(2,ca)};U.prototype.fulfill_=function(ca){this.settle_(1,ca)};U.prototype.settle_=function(ca,ta){if(0!=this.state_)throw Error("Cannot settle("+ca+", "+
ta+"): Promise already settled in state"+this.state_);this.state_=ca;this.result_=ta;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};U.prototype.scheduleUnhandledRejectionCheck_=function(){var ca=this;na(function(){if(ca.notifyUnhandledRejection_()){var ta=$jscomp.global.console;"undefined"!==typeof ta&&ta.error(ca.result_)}},1)};U.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var ca=$jscomp.global.CustomEvent,ta=$jscomp.global.Event,
ea=$jscomp.global.dispatchEvent;if("undefined"===typeof ea)return!0;"function"===typeof ca?ca=new ca("unhandledrejection",{cancelable:!0}):"function"===typeof ta?ca=new ta("unhandledrejection",{cancelable:!0}):(ca=$jscomp.global.document.createEvent("CustomEvent"),ca.initCustomEvent("unhandledrejection",!1,!0,ca));ca.promise=this;ca.reason=this.result_;return ea(ca)};U.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var ca=0;ca<this.onSettledCallbacks_.length;++ca)xa.asyncExecute(this.onSettledCallbacks_[ca]);
this.onSettledCallbacks_=null}};var xa=new L;U.prototype.settleSameAsPromise_=function(ca){var ta=this.createResolveAndReject_();ca.callWhenSettled_(ta.resolve,ta.reject)};U.prototype.settleSameAsThenable_=function(ca,ta){var ea=this.createResolveAndReject_();try{ca.call(ta,ea.resolve,ea.reject)}catch(ma){ea.reject(ma)}};U.prototype.then=function(ca,ta){function ea(Pa,wa){return"function"==typeof Pa?function(tb){try{ma(Pa(tb))}catch(pb){ra(pb)}}:wa}var ma,ra,Da=new U(function(Pa,wa){ma=Pa;ra=wa});
this.callWhenSettled_(ea(ca,ma),ea(ta,ra));return Da};U.prototype.catch=function(ca){return this.then(void 0,ca)};U.prototype.callWhenSettled_=function(ca,ta){function ea(){switch(ma.state_){case 1:ca(ma.result_);break;case 2:ta(ma.result_);break;default:throw Error("Unexpected state: "+ma.state_);}}var ma=this;null==this.onSettledCallbacks_?xa.asyncExecute(ea):this.onSettledCallbacks_.push(ea);this.isRejectionHandled_=!0};U.resolve=aa;U.reject=function(ca){return new U(function(ta,ea){ea(ca)})};
U.race=function(ca){return new U(function(ta,ea){for(var ma=$jscomp.makeIterator(ca),ra=ma.next();!ra.done;ra=ma.next())aa(ra.value).callWhenSettled_(ta,ea)})};U.all=function(ca){var ta=$jscomp.makeIterator(ca),ea=ta.next();return ea.done?aa([]):new U(function(ma,ra){function Da(tb){return function(pb){Pa[tb]=pb;wa--;0==wa&&ma(Pa)}}var Pa=[],wa=0;do Pa.push(void 0),wa++,aa(ea.value).callWhenSettled_(Da(Pa.length-1),ra),ea=ta.next();while(!ea.done)})};return U},"es6","es3");
$jscomp.checkStringArgs=function(r,L,aa){if(null==r)throw new TypeError("The 'this' value for String.prototype."+aa+" must not be null or undefined");if(L instanceof RegExp)throw new TypeError("First argument to String.prototype."+aa+" must not be a regular expression");return r+""};
$jscomp.polyfill("String.prototype.startsWith",function(r){return r?r:function(L,aa){var na=$jscomp.checkStringArgs(this,L,"startsWith");L+="";var U=na.length,xa=L.length;aa=Math.max(0,Math.min(aa|0,na.length));for(var ca=0;ca<xa&&aa<U;)if(na[aa++]!=L[ca++])return!1;return ca>=xa}},"es6","es3");
$jscomp.iteratorFromArray=function(r,L){r instanceof String&&(r+="");var aa=0,na=!1,U={next:function(){if(!na&&aa<r.length){var xa=aa++;return{value:L(xa,r[xa]),done:!1}}na=!0;return{done:!0,value:void 0}}};U[Symbol.iterator]=function(){return U};return U};$jscomp.polyfill("Array.prototype.keys",function(r){return r?r:function(){return $jscomp.iteratorFromArray(this,function(L){return L})}},"es6","es3");
$jscomp.polyfill("Array.from",function(r){return r?r:function(L,aa,na){aa=null!=aa?aa:function(ta){return ta};var U=[],xa="undefined"!=typeof Symbol&&Symbol.iterator&&L[Symbol.iterator];if("function"==typeof xa){L=xa.call(L);for(var ca=0;!(xa=L.next()).done;)U.push(aa.call(na,xa.value,ca++))}else for(xa=L.length,ca=0;ca<xa;ca++)U.push(aa.call(na,L[ca],ca));return U}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var r={},L=Object.create(new $jscomp.global.Proxy(r,{get:function(aa,na,U){return aa==r&&"q"==na&&U==L}}));return!0===L.q}catch(aa){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(r,L){return Object.prototype.hasOwnProperty.call(r,L)};
$jscomp.polyfill("WeakMap",function(r){function L(){if(!r||!Object.seal)return!1;try{var ma=Object.seal({}),ra=Object.seal({}),Da=new r([[ma,2],[ra,3]]);if(2!=Da.get(ma)||3!=Da.get(ra))return!1;Da.delete(ma);Da.set(ra,4);return!Da.has(ma)&&4==Da.get(ra)}catch(Pa){return!1}}function aa(){}function na(ma){var ra=typeof ma;return"object"===ra&&null!==ma||"function"===ra}function U(ma){if(!$jscomp.owns(ma,ca)){var ra=new aa;$jscomp.defineProperty(ma,ca,{value:ra})}}function xa(ma){if(!$jscomp.ISOLATE_POLYFILLS){var ra=
Object[ma];ra&&(Object[ma]=function(Da){if(Da instanceof aa)return Da;Object.isExtensible(Da)&&U(Da);return ra(Da)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(L())return r;var ca="$jscomp_hidden_"+Math.random();xa("freeze");xa("preventExtensions");xa("seal");var ta=0,ea=function(ma){this.id_=(ta+=Math.random()+1).toString();if(ma){ma=$jscomp.makeIterator(ma);for(var ra;!(ra=ma.next()).done;)ra=ra.value,this.set(ra[0],ra[1])}};ea.prototype.set=
function(ma,ra){if(!na(ma))throw Error("Invalid WeakMap key");U(ma);if(!$jscomp.owns(ma,ca))throw Error("WeakMap key fail: "+ma);ma[ca][this.id_]=ra;return this};ea.prototype.get=function(ma){return na(ma)&&$jscomp.owns(ma,ca)?ma[ca][this.id_]:void 0};ea.prototype.has=function(ma){return na(ma)&&$jscomp.owns(ma,ca)&&$jscomp.owns(ma[ca],this.id_)};ea.prototype.delete=function(ma){return na(ma)&&$jscomp.owns(ma,ca)&&$jscomp.owns(ma[ca],this.id_)?delete ma[ca][this.id_]:!1};return ea},"es6","es3");
$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(r){function L(){if($jscomp.ASSUME_NO_NATIVE_MAP||!r||"function"!=typeof r||!r.prototype.entries||"function"!=typeof Object.seal)return!1;try{var ea=Object.seal({x:4}),ma=new r($jscomp.makeIterator([[ea,"s"]]));if("s"!=ma.get(ea)||1!=ma.size||ma.get({x:4})||ma.set({x:4},"t")!=ma||2!=ma.size)return!1;var ra=ma.entries(),Da=ra.next();if(Da.done||Da.value[0]!=ea||"s"!=Da.value[1])return!1;Da=ra.next();return Da.done||4!=Da.value[0].x||"t"!=Da.value[1]||!ra.next().done?
!1:!0}catch(Pa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(L())return r;var aa=new WeakMap,na=function(ea){this.data_={};this.head_=ca();this.size=0;if(ea){ea=$jscomp.makeIterator(ea);for(var ma;!(ma=ea.next()).done;)ma=ma.value,this.set(ma[0],ma[1])}};na.prototype.set=function(ea,ma){ea=0===ea?0:ea;var ra=U(this,ea);ra.list||(ra.list=this.data_[ra.id]=[]);ra.entry?ra.entry.value=ma:(ra.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:ea,value:ma},ra.list.push(ra.entry),this.head_.previous.next=ra.entry,this.head_.previous=ra.entry,this.size++);return this};na.prototype.delete=function(ea){ea=U(this,ea);return ea.entry&&ea.list?(ea.list.splice(ea.index,1),ea.list.length||delete this.data_[ea.id],ea.entry.previous.next=ea.entry.next,ea.entry.next.previous=ea.entry.previous,ea.entry.head=null,this.size--,!0):!1};na.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=ca();this.size=0};na.prototype.has=
function(ea){return!!U(this,ea).entry};na.prototype.get=function(ea){return(ea=U(this,ea).entry)&&ea.value};na.prototype.entries=function(){return xa(this,function(ea){return[ea.key,ea.value]})};na.prototype.keys=function(){return xa(this,function(ea){return ea.key})};na.prototype.values=function(){return xa(this,function(ea){return ea.value})};na.prototype.forEach=function(ea,ma){for(var ra=this.entries(),Da;!(Da=ra.next()).done;)Da=Da.value,ea.call(ma,Da[1],Da[0],this)};na.prototype[Symbol.iterator]=
na.prototype.entries;var U=function(ea,ma){var ra=ma&&typeof ma;"object"==ra||"function"==ra?aa.has(ma)?ra=aa.get(ma):(ra=""+ ++ta,aa.set(ma,ra)):ra="p_"+ma;var Da=ea.data_[ra];if(Da&&$jscomp.owns(ea.data_,ra))for(ea=0;ea<Da.length;ea++){var Pa=Da[ea];if(ma!==ma&&Pa.key!==Pa.key||ma===Pa.key)return{id:ra,list:Da,index:ea,entry:Pa}}return{id:ra,list:Da,index:-1,entry:void 0}},xa=function(ea,ma){var ra=ea.head_;return $jscomp.iteratorPrototype(function(){if(ra){for(;ra.head!=ea.head_;)ra=ra.previous;
for(;ra.next!=ra.head;)return ra=ra.next,{done:!1,value:ma(ra)};ra=null}return{done:!0,value:void 0}})},ca=function(){var ea={};return ea.previous=ea.next=ea.head=ea},ta=0;return na},"es6","es3");$jscomp.findInternal=function(r,L,aa){r instanceof String&&(r=String(r));for(var na=r.length,U=0;U<na;U++){var xa=r[U];if(L.call(aa,xa,U,r))return{i:U,v:xa}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(r){return r?r:function(L,aa){return $jscomp.findInternal(this,L,aa).i}},"es6","es3");var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var L={};L.id=r.id;L.server=r.id;L.displayName=r.displayName||r.id;if(r=r.rdp){for(var aa in r)L[aa]=r[aa];L.user=r.username||"";L.pwd=r.password||"";L.useConsole=r.console||!1;L.legacyMode=r.leagacyMode||r.legacyMode||!1;L.server_bpp=r.color||16;L.exe=r.remoteProgram||"";L.args=r.remoteArgs||"";L.startProgram=0<L.exe.length?"app":L.command&&0<L.command.length?"shell":"noapp"}return L}
function Rdp2(r){r=svGlobal.util.getServerArgs(r);if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var L=r.gateway||"",aa=0,na=0,U=16,xa=1==r.useSSL||"true"==r.useSSL||"on"==r.useSSL||null;r.width&&(aa=parseInt(r.width,10));r.height&&(na=parseInt(r.height,10));r.color&&(U=parseInt(r.color,10));r.server_bpp&&(U=parseInt(r.server_bpp,10));r=hi5.browser.obj2url(r);null===xa&&(xa="https:"==location.protocol);return new Rdp((xa?"wss://":"ws://")+L+"/RDP?"+r,aa,na,U)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(r,L,aa,na){function U(a){return"on"==a||"true"==a||1==a}function xa(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function ca(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ta(a,b){a=ja[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function ea(){return O.displayName||O.server||O.symlink||O.id||"undefined"}function ma(a){p.loadbalanceToken||
(p.loadbalanceToken=ja.loadbalanceTokenName?ja.loadbalanceTokenName+"="+a:"")}function ra(a,b,c){p.ontitlechange&&(a=p.ontitlechange(a,c));p.setTitle&&a&&(b=b||window,b.document.title=a)}function Da(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return O.invitation||p.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(Ma?Ma.postMessage({type:0,cmd:1,data:a}):Fa&&Fa.setColor(a));return!0}function Pa(a,b,c,e){Ka=a;La=b;Yb=Zb=0;$b=Ka-1;ac=La-1;Va&&(Ka=(O.waWidth||
hi5.browser.getScreenWidth())|0,La=(O.waHeight||hi5.browser.getScreenHeight())|0);O.minWidth&&Ka<O.minWidth&&(Ka=O.minWidth|0);O.minHeight&&La<O.minHeight&&(La=O.minHeight|0);Ka&=-4;La&=-4;svGlobal.logger.warn("resolution changed, w:"+Ka+" h:"+La);var d=Ka,h=La;sa?sa.resize(d,h):sa=new Bc(d,h);ia.setSize(Ka,La,Va?"hidden":null);if(c||Ka!=a||La!=b)Ma?Ma.postMessage({type:0,cmd:2,data:{w:Ka,h:La}}):Fa&&Fa.setResolution(Ka,La);if(p.onresolutionchange&&!e)p.onresolutionchange(a,b)}function wa(a){!bb&&
Ja&&(Ma?(bc.data=a,"string"!=typeof a?Ma.postMessage(bc,[a]):Ma.postMessage(bc)):Fa.writeRawInput(a))}function tb(a){switch(a){case "\r":break;case "\n":p.writeScancode(28);break;case "\t":p.writeScancode(15);break;default:wa("86"+a)}}function pb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),h=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=h?5:9;c=new Uint8Array(e+c);c[0]=a;if(h)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{h=b.name;for(var q=Math.min(h.length,8),M=0;M<q;M++)c[1+M]=h.charCodeAt(M)}c.set(d,e);wa(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Hb(a){if(p){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};p.displayMsg&&p.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(p.onerror)p.onerror(a)}}function Cc(a){if(p){var b=__svi18n.info[a];b||(b="info "+a);p.displayMsg&&p.showMessage(b);svGlobal.logger.info(b)}}function cc(){var a=Ja;qb=Ja=!1;
Ma?Ma.postMessage({type:0,cmd:3}):Fa&&Fa.resetStatus();a&&(Ja=a)}function dc(a){Oa||(Oa=new hi5.file.UploadManager(new hi5.file.WsFileService(wa)),Oa.addEvent("beforeupload",function(b,c,e){if(p.beforeupload)return p.beforeupload(b,c,e)}),Oa.addEvent("fileuploaded",function(b,c,e){if(p.onfileuploaded)p.onfileuploaded(b,c,e)}),Oa.addEvent("uploaded",function(b,c){if(p.onuploaded)p.onuploaded(b,c)}),Oa.addEvent("uploadingCancelled",function(){if(p.onuploadingCancelled)p.onuploadingCancelled()}));a.setFileHandler(Oa)}
function Dc(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ja&&(e=!0,wa("8C5"+d.exe+"\t"+d.args+"\t"+p.sessionInfo.appInfo.session))}}function Ad(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ec(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Ib(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function Bd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Fc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Gc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var h=[];e&1?h.push("usb"):e&2?h.push("nfc"):e&4?h.push("ble"):e&16?h.push("internal"):e&32&&h.push("hybrid");
d.transports=h}b.push(c)}}return b}function Fc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function Cd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function Dd(a,b){var c,e,d,h,q,M,A,G,J,x,y,S,n,z,B,u,K,D,P,Y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){if(1==T.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var pa=$jscomp.makeIterator(e),w=pa.next();!w.done;w=pa.next())w=w.value,"USB"==w.toUpperCase()||"NFC"==w.toUpperCase()||"BLE"==w.toUpperCase()||"INTERNAL"==w.toUpperCase()||w.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+ub(new Uint8Array(d))),q=Ib(d),h=q.attStmt;if(M=a.clientDataJSON)console.log("==== clientDataJson bytes: "+ub(new Uint8Array(M))),A=window.origin,G=(new TextDecoder).decode(M),J=JSON.parse(G),J.origin&&(J.origin=A);x=a.getAuthenticatorData();
if(!x)return T.jumpTo(0);y=new Uint8Array(x);console.log("==== authenticatorData bytes: "+ub(y));return b?(S=b.id)?T.yield(Ed(S),5):T.jumpTo(0):T.jumpTo(0)}n=T.yieldResult;z=new Uint8Array(n);console.log("==== hash of realRpID: "+ub(z));B=new hi5.DataBuffer(new Uint8Array(y.byteLength));B.setBytes(z);u=y.slice?y.slice(32,y.length):y.subarray(32,y.length);B.setBytes(u);B.markEnd();K=B.getData();console.log("==== newAuthDataBytes: "+ub(new Uint8Array(K)));D={1:"packed",2:K,3:h};P=CBOR.encode(D);Y=new hi5.DataBuffer(new Uint8Array(P.byteLength+
1));Y.setByte(0);Y.setBytes(P);Y.markEnd();return T.return(Y.getData())})}function Ed(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Fd(b))})}function Fd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function ub(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function Gd(){var a=0,b=0,c=new p.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),h=e.getLittleEndian16(),q=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(q){case 1:case 4097:q=new RdpBuffer(new Uint8Array(6),0,6);q.setByte(6);q.setByte(1);q.setLittleEndian16(h);q.setLittleEndian16(0);q.markEnd();c.send(q);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:h=e.getLittleEndian16();a+=h;break;case 43:case 1065:case 1577:43==q&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(h);d.setLittleEndian16(43==q?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:h=e.getLittleEndian32();q=e.getLittleEndian32();
e=e.getLittleEndian32();ec={baseRTT:h,bandwidth:q,averageRTT:e};if(p.onnetworkresult)p.onnetworkresult(ec);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};p.addGatewayChannel(c)}function Hd(a,b,c,e,d){fc.set(a,b);gc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=
a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Id(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Hc(){var a="";O&&U(O.connectif)&&O.symlink&&"sessionStorage"in window&&(a="SV_"+O.symlink,O.domain&&(a+=O.domain),O.user&&(a+=O.user));return a}function Jd(){var a=hi5.appcfg.persistentId?
window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function hc(){if(!Ja){qb=!1;var a="";bb?Ha.init(!1,!0,!1,0,!1,!1):a=p.getRuntimeURL();void 0==ja.wsPost&&(ja.wsPost=!1);p.oncreatewebsocket&&(Ma=null);Ma?(bb&&(bb.onopen=ic,bb.onclose=Ab,bb.onmessage=function(c){jc.data=c.data;Ma.postMessage(jc,[jc.data])}),Ma.postMessage({type:0,cmd:0,data:{addr:a,width:Ka,height:La,
server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ja.wsPost}})):(Fa=new RdpGeneral(bb||a,Ka,La,fb,sa,!1,ja.wsPost),Fa.oncreatewebsocket=p.oncreatewebsocket,Fa.run());Ma?Ma.addEventListener("message",Ic,!1):(Fa.onopen=ic,Fa.onmessage=Jc,Fa.onclose=Ab,Fa.onerror=Hb,Fa.oninfo=Cc,Fa.onloggedin=kc,Fa.onresolutionchange=function(c,e){Pa(c,e,!1,O.monitorDef&&0<=O.monitor?!0:!1)},Fa.onAltSecWindows=Kc,Fa.onMoveCursor=lc,Fa.onCloseSurface=Lc,Fa.onColorChange=Da,Fa.onHistoryReceived=function(){mc()},
Fa.onLockKeyState=function(c){if(p.onLockKeyState)p.onLockKeyState(c)});if(a=ia.getSurface(ia.size()-1))Va?a&&(a.remoteApp=new Dc(O.exe,O.args,"")):ra(ea(),a.getWindow());if(O.invitation&&!U(O.shadow)){var b=null;a&&(b=a.initChat(O.expert));Bb=new p.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,O.novice)};b&&(b.onchat=function(c){if(Ja){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();
Bb.send(e)}});p.addGatewayChannel(Bb)}}}function Ic(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:ic();break;case 1:Ab(a.expected);break;case 2:Hb(a.code);break;case 3:Cc(a.code);break;case 4:kc();break;case 5:Pa(a.w,a.h,!1,O.monitorDef&&0<=O.monitor?!0:!1);break;case 6:lc(a.x,a.y,!0);break;case 7:Lc();break;case 8:0==a.id&&mc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:Da(a.color);break;case 10:if(p.onLockKeyState)p.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:sa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:sa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:sa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:sa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:sa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:sa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Mc(a);break;case 10:Jc(a);break;case 11:Ua.attach(a.data,0,a.data.length);Kc(Ua,a.size);
break;case 12:sa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:sa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:sa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:sa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:sa.putFont(a.font,a.character,a.glyph);break;case 17:sa.putCursor(a.idx,
a.cursor);break;case 18:sa.setCursor(a.idx);break;case 19:sa.getHistory(wa,function(){Ma.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);sa.setHistory(a.order,Ua);break;case 21:sa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Nc(a){Qa&&Qa.check(a)}function ic(){Ja=!0;var a="87"+navigator.userAgent+"\t";Jb=hi5.tool.uuid();document.cookie=Jb+"=sv";wa(a+Jb);if(p.onopen)p.onopen();ja.joinCloseMode&&
p.setJoinCloseMode(ja.joinCloseMode)}function Lc(){ia&&ia.close()}function Jc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=jb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Ga.tag=a.getLittleEndian16();Ga.channels=a.getLittleEndian16();Ga.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Ga.bitsPerSample=a.getLittleEndian16();
svGlobal.logger.info("Audio Format, tag="+Ga.tag+" channels="+Ga.channels+" bitsPerSample="+Ga.bitsPerSample+" samplePerSec="+Ga.samplePerSec);Ma&&Ma.postMessage({type:0,cmd:5,data:{tag:Ga.tag,channels:Ga.channels,samplePerSec:Ga.samplePerSec,bitsPerSample:Ga.bitsPerSample}});41222==Ga.tag&&(Ga.sampleRate=Ga.samplePerSec,Ta.initMediaPlayer(Ta,Ga,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);nc(a,b,c,0);kb||(c+=Date.now()-e,wa("8A"+b+","+c))}Qa&&Qa.check();
break;case 56:Oc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Pc(Ua);break;case 62:Qc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Rc(Ua);Qa&&Qa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ha[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ha[b].newInstance?(Ha[a]=Ha[b].newInstance(),Ha[a].id=a):(Ha[b].id=a,Ha[a]=Ha[b]),Ha[a].onopen)Ha[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+
b+" id:"+a);break;case 3:Ha[a]&&Ha[a].process(b);break;case 4:if(Ha[a]&&Ha[a].onclose)Ha[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:Kd(Ua);break;default:if(p.onunknownmessage)p.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:wa("87"+navigator.userAgent);break;case 15:if(p){oc=!1;vb=p.reconnectTimes;(p&&0==p.mode||U(O.connectif))&&mc();b="";for(b in lb)if((c=lb[b])&&c.onopen)c.onopen();
for(b in jb)if((c=jb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&p&&(p.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(p.onnotify)p.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&p.onerror)p.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;p.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ia.drawLicense(a);
break;case 50:if(Ja)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Ld(a);break;case 2:Cb?(Cb.type==a?p.writeRawInput("881"+a+"\t"+Cb.text):p.writeRawInput("881ERROR\t"),Cb=null):!(b=ia.getFocused())||b.processClipReq(a)||!ja.clipWarnAlways&&Sc||!O||O.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Sc=!0);break;case 5:(b=ia.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ia.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=xa()+b[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+
a+" name:"+b[1]+" driver:"+b[2]);p.onprintingready&&p.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ia.getFocused())&&b.showPDF(a);break;case 56:Oc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ia.getWinById(parseInt(b[0]))){if(!ia.hasApp(b[1])){(c=ia.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(p.onremoteappstart)p.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&p.ontitlechange)p.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Md(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(cb&16||cb&65536)?(Kb=!1,Oa=null):(cb&16&&(Kb=!0),Oa||(a=ia.getFocused())&&dc(a));cb&64&&p.showMessage(__svi18n.info.recording);Oa&&(Oa.setUpload(!(cb&128)),Oa.setDownload(!(cb&131072)),Oa.canCopyFile=0!=(cb&65536));ia.execute("setFeature",[cb]);break;case 60:Pc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Pa(a.width,a.height,!0,!1);Da(a.color);
(b=a.server)&&p&&(p.server=a.server);Tc=a.length;c=ia.getFocused();Va=1==a.isRail;c&&(1!=p.mode&&c.setAutoScale(!Va),b&&ra(ea(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Kb=!0,dc(c));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Tc);break;case 2:2==a.status?(cc(),Ja=!0):(b=0==a.status,b==sa.isPaused()||p.onsessionpause&&p.onsessionpause(b,a)||(sa.pause(b),b||ia.repaint(0,0,sa.width-1,sa.height-1),a.warn&&p.showMessage(b?
__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Qc(a);break;case 63:Rc(b64ToBuffer(a));break;default:if(p.onunknownmessage)p.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function mc(){if(!kb&&!Xa&&(Xa=!0,p&&(ja.pingInterval&&p.startPing(ja.pingInterval),p.onready)))p.onready()}function Kd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;wa(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=
65536,ia.execute("setFeature",[cb]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(p.onLockKeyState)p.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();p.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=
a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);p.sessionInfo.appInfo.twoFAQR=a;p.ontwofaqr&&p.ontwofaqr(a)||2==b&&ia.execute("showTwoFAQR");break;case 1:sa.pause(!0,!0);if(p.ontwofacode&&p.ontwofacode())return;(a=ia.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!p.ontwofaresult||!p.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ia.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c=
"image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var h=new Uint8Array(2+d.length);h[0]=146;h[1]=8;h.set(d,2);wa(h.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Nd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var h=ia.getFocused();h&&Ja&&(h=h.getThumbnail(a))&&h.length!=d&&(wa("8E7"+h),d=h.length)},b))};this.stop=function(){clearInterval(c)}}function Od(a,b){!$a||$a.width==
a&&$a.interval==b||($a.stop(),$a=null);$a||($a=new Nd(a,b));$a.start()}function Rc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Qc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);cc();Ja=!0;a=d.width;e=d.height;if(a==Ka&&e==La)break;Pa(a,e,!1,!1);break;case 1:d=JSON.parse(c);p.sessionInfo.joinedSessions.push(d.numericId);p.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||
ja.alertJoin)p.onsessionjoin&&(a=p.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&p.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);p.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=p.sessionInfo.joiners;c=0;for(var h=b.length;c<h;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ja.alertJoin)p.onsessionexit&&(a=p.onsessionexit(d)),!a&&__svi18n.info.exitsession&&p.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,
d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ia.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ia.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;
p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);p.onrequirecontrol&&(a=p.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;sa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));p.showMessage({title:a,msg:e,cbYes:function(){p.giveControl(d.numericId);this.destroy();sa.isPaused()&&p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(d.numericId);this.destroy()},html:!0});
break;case 6:ia.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Pa(d.width,d.height,!0,O.monitorDef&&0<=O.monitor?!0:!1);d.color&&(Da(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(p.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);oc=!0;if(p.onrequestcredential&&p.onrequestcredential(d,Ra.reconnect))break;if(p.onautherror&&p.onautherror(d,Ra.reconnect))break;ia.getFocused().requestCredential(d,Ra.reconnect);break;
case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Od(d.width,d.interval):$a&&($a.stop(),$a=null);break;case 11:d=JSON.parse(c);p.onrequirejoin&&(a=p.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);p.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&kc();break;case 14:if(d=JSON.parse(c),p.oncontrolchange)p.oncontrolchange(d)}}
function Pc(a){switch(a.getByte()){case 32:if(!sa.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,h=void 0;ja.noCursorName||(d=a.getLittleEndian32(),p.sessionInfo.appInfo&&(h=p.sessionInfo.appInfo.sessions[d]));lc(c,e,!0,h,d,b)}}}function lc(a,b,c,e,d,h){sa.isPaused()||ia.getFocused().moveCursor(a,b,c,e,d,h)}function Mc(a){ia.setCursor(a)}function Pd(a){var b=ja.page&&ja.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+
b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=xa();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Oc(a){a=JSON.parse(a);pc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",pc),c.setItem("appInfo.numericId",b));ma(a.appId);a.server||(a.server=ea());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?
1!=p.mode&&ia.execute("setAutoScale",[!0]):(p.mode=0,U(O.connectif)&&ia.setSize(Ka,La),ja.disableJoinedAppResize&&(p.windowState=0));var e=xa();b=Pd("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),p.protocol="http"==c.substring(0,e)?"ws":"wss",p.gateway=c,b+="&gateway="+encodeURIComponent(c));b=p.modifyURL(b);a.joinLink=b;p.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Pa(Ka,La,!0,!0),qb||1==p.mode||ia.execute("setAutoScale",
[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ja.cursorNameOnly=a.isAssistance;if(p.onsessionstart)p.onsessionstart(p.sessionInfo)}function Md(a){if(Oa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Oa.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Oa.confirmId(c[0],c[1],c[2]);break;case 2:Oa.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Oa.close(c[0]);break;case 9:a='<a href="'+p.modifyURL(xa()+
c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ia.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Oa.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function nc(a,b,c,e){if(!Qd||sa.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ga.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ga.tag)qc||(qc=new MSGSM),b=
qc.decode(b,d,e),d=0,e=b.length;var h=Ga.bitsPerSample;var q=Math.floor(e/(h>>3));var M=c=e=0;a||(e=Math.pow(2,h-1)-1,c=-e-1,M=Math.pow(2,h));h=Ga.channels;var A=Math.floor(q/h),G=Ta.getBuffer(A),J=G.getChannelData(0),x=G.getChannelData(1);q=0;if(a)for(;q<A;)1==h?x[q]=J[q]=b[d++]:(J[q]=b[d++],x[q]=b[d++]),q++;else for(;q<A;)a=b[d++]|b[d++]<<8,a>e?(a-=M,a/=-c):a/=e,1==h?J[q]=a:(J[q]=a,a=b[d++]|b[d++]<<8,a>e?(a-=M,a/=-c):a/=e),x[q]=a,q++;return Ta.playBuffer(G)}function Uc(a){if(!p.openLink||2E3<a.length)return!1;
var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:p.onurlredirection&&p.onurlredirection(b)?!0:(a=ia.getFocused())?a.processLink(b):!1:!1}function Rd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=
a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=p.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Ld(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(p.onservercopy&&p.onservercopy(a)||Uc(a))){var b=ia.getFocused();b&&b.copyToClip(Rd(a))}setTimeout(function(){wa("883")},999)}}function kc(a){if(!qb&&(setTimeout(function(){Ja&&wa("884")},333),p.onloggedin))p.onloggedin();rc=qb=!0;a&&a.sessionId&&(p.sessionInfo.sessionId=a.sessionId);Va&&1!=
p.mode&&ia.execute("setAutoScale",[!1]);Oa&&(Oa.enabled=!0);Lb&&!Va&&(sa.setContext(ia.getFocused().context),ia.repaint(0,0,sa.width-1,sa.height-1))}function Ab(a){if(p){hi5.browser.cookie.delete(Jb);svGlobal.logger.warn("closed "+(p.sessionInfo.appInfo?p.sessionInfo.appInfo.numericId:0));p.onagentmessage&&(p.onagentmessage=null);if(p.onagentclose)p.onagentclose();var b=Hc();b&&p.sessionInfo.appInfo&&0==p.mode&&(sessionStorage[b]=p.sessionInfo.appInfo.session);if(p&&(b=1!=p.mode,!Ja&&b&&Hb("connection"),
b=b&&(Ja||vb<p.reconnectTimes)&&0<vb&&!a,Xa=Ja=!1,b)){vb--;__svi18n.info.reconnecting&&p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-vb)+"/"+p.reconnectTimes,null,3E3);setTimeout(hc,ja.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+vb);return}if(oc)svGlobal.logger.info("Req credential");else{Qa&&(p.stopPing(),Qa=null);Ma&&(Ma.removeEventListener("message",Ic,!1),Ma.postMessage({type:0,cmd:4}),Ma.terminate(),Ma=null);Oa&&(Oa.release(),Oa=null);Sa=r=null;Ha&&(Ha.close(),
Ha=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);$a&&($a.stop(),$a=null);Ta&&(Ta.close(),Ta=null);p.player&&(p.player=null);Db=null;try{if(p.onclose)p.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ia&&(ia.close(),ia=null)}catch(c){svGlobal.logger.warn(c)}Ua=null;Fa&&(Fa.onopen=null,Fa.onmessage=null,Fa.onclose=null,Fa.onerror=null,Fa.close(),Fa=null);ia=Ra=null;sa&&(sa.release(),sa=null);hi5.browser.isChromeApp?
chrome.runtime.onSuspend.removeListener(p.close):window.removeEventListener("unload",p.close,!1);window&&window.$rdp==p&&(window.$rdp=null);p=null}}}function Vc(){Fa&&Ja?Fa.close():Ab(!0)}function Kc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),h=0;16>c&&(h=a.getLittleEndian16());var q=a.getLittleEndian16(),M=a.getLittleEndian16();a.getBytes(q);h&&
a.getBytes(h);if(8<=c&&(h=ia.getFocused())&&h.onremoteappicon){q=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();M=d+M;var A;a=a.getData();for(var G=0,J,x;d<M;)switch(c){case 16:(A=a[d++]|a[d++]<<8)?(x=A>>7&248,J=A>>2&248,A=A<<3&248,x|=x>>5,J|=J>>5,A|=A>>5,e[G++]=A,e[G++]=J,e[G++]=x,e[G++]=255):G+=4;break;case 32:e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++]}q.putPixels(e,0,e.length);a=ia.getWinById(b);h.onremoteappicon(a,q)}}else 0!=(c&2147483648)?
svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ia.delWin(b)):Sd(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((h=ia.getOwnerSurfaceById(b))&&
h.railWin&&h.railWin.setActiveWinId(b,3==ja.windowState),ia.setTitle(b),sa.getContext()||(b=ia.getFocused())&&sa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ia.zOrders,c.length=b,h=0;h<b;h++)c[h]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[h])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Wc(a){var b=ia.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),
Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Sd(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ia.getWinById(c);d?e=!0:d=new ia.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+
d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=
(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),
svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var h=d.showState;(2==h&&0!=ja.noMinimize||!e&&3==h&&5==ja.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(h=0!=(b&4)){var q=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(q,
!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=
a.getLittleEndian32());if(0!=(b&2048)){q=a.getLittleEndian32();var M=a.getLittleEndian32();d.winOffsetX=q;d.winOffsetY=M;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==p.windowState?Wc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(q=ia.getFocused())){q=q.getFreeSpace();var A=d.winWidth,G=d.winHeight;if(d.winOffsetX>q.width||d.winOffsetY>q.height||0>A+d.winOffsetX||0>G+d.winOffsetY){var J=(q.width-d.winWidth)/2|0,x=(q.height-d.winHeight)/2|0;0>J&&(J=0);0>x&&(x=0);setTimeout(function(){d.resize(J,x,A,G)},50)}}0!=(b&256)&&(q=a.getLittleEndian16(),0<q&&a.skipPosition(8*q));0!=(b&
4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ia.onWinChange(d);else ia.addWin(d);h&&ia.setTitle(c);c==ia.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ia.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function Bc(a,b){function c(l,g,k,f,t){0<t.width?t.union(l,g,k,f):(t.x=l,t.y=g,t.width=k,t.height=f)}function e(l,
g,k,f){for(X=0;X<ha;X++){var t=pa[X];if(l>=t[0]&&g>=t[1]&&k<=t[2]&&f<=t[3])return w[X]}return null}function d(l,g,k,f){if(ha){var t=e(l,g,l+k-1,g+f-1);t&&c(l,g,k,f,t)}else c(l,g,k,f,z)}function h(l,g,k,f,t,v,E){for(var C=t*k+f,F=l.setRGB,W=l.getRGB,N=0;N<E;N++){for(var m=0;m<v;m++){if(l){var I=W(f+m,t+N);F(f+m,t+N,~I&16777215)}else g[C]=~g[C]&16777215;C++}C+=k-v}}function q(l,g,k,f,t,v,E,C,F,W){g=W*C+F;null==E&&(E=l);for(l=0;l<v;l++){for(F=0;F<t;F++)S[f+l][k+F]=S[f+l][k+F]&E[g]&16777215|4278190080,
g++;g+=C-t}}function M(l,g,k,f,t,v,E,C,F,W){g=W*C+F;F=l.setRGB;W=l.getRGB;null==E&&(E=l);for(l=0;l<v;l++){for(var N=0;N<t;N++){var m=W(k+N,f+l);F(k+N,f+l,m|E[g]&16777215);g++}g+=C-t}}function A(l,g,k,f){var t=fa;if(t){var v=t.getRGB(g,k);switch(l){case 0:t.setRGB(g,k,0);break;case 1:t.setRGB(g,k,~(v|f)&16777215);break;case 2:t.setRGB(g,k,v&~f&16777215);break;case 3:t.setRGB(g,k,~f&16777215);break;case 4:t.setRGB(g,k,16777215*(~v&f));break;case 5:t.setRGB(g,k,~v&16777215);break;case 6:t.setRGB(g,k,
v^f&16777215);break;case 7:t.setRGB(g,k,~v&f&16777215);break;case 8:t.setRGB(g,k,v&f&16777215);break;case 9:t.setRGB(g,k,v^~f&16777215);break;case 10:break;case 11:t.setRGB(g,k,v|~f&16777215);break;case 12:t.setRGB(g,k,f);break;case 13:t.setRGB(g,k,(~v|f)&16777215);break;case 14:t.setRGB(g,k,v|f&16777215);break;case 15:t.setRGB(g,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+l),t.setRGB(g,k,f)}}}function G(l,g,k,f,t,v,E,C,F){l>C||g>F||(k=l+k-1,k>C&&(k=C),l<v&&(l=v),k=
k-l+1,f=g+f-1,f>F&&(f=F),g<E&&(g=E),f=f-g+1,1>k||1>f||fa.fillRect(l,g,k,f,t))}function J(l,g,k,f,t,v,E,C,F,W,N,m){if(!(g>N||k>m)){var I=g+f-1;I>N&&(I=N);F=g<F?F:g;I=I-g+1;N=k+t-1;N>m&&(N=m);W=k<W?W:k;m=N-k+1;if(!(1>I||1>m)){N=128;var H=0;E|=4278190080;C|=4278190080;if(F==g&&W==k&&I==f&&m==t)if(0==l)for(var R=0;R<t;R++){l=k+R;for(var ba=0;ba<f;ba++)0==N&&(H++,N=128),0!=(v[H]&N)&&(S[l][g+ba]=C),N>>=1;H++;N=128;H==v.length&&(H=0)}else for(R=0;R<t;R++){l=k+R;for(ba=0;ba<f;ba++)0==N&&(H++,N=128),S[l][g+
ba]=0!=(v[H]&N)?C:E,N>>=1;H++;N=128;H==v.length&&(H=0)}else if(0==l)for(R=0;R<m;R++){l=k+R;for(ba=0;ba<I;ba++)0==N&&(H++,N=128),g+ba>=F&&l>=W&&0!=(v[H]&N)&&(S[l][g+ba]=C),N>>=1;H++;N=128;H==v.length&&(H=0)}else for(R=0;R<m;R++){l=k+R;for(ba=0;ba<I;ba++)0==N&&(H++,N=128),g+ba>=F&&k+R>=W&&(S[l][g+ba]=0!=(v[H]&N)?C:E),N>>=1;H++;N=128;H==v.length&&(H=0)}}}}function x(l,g,k,f,t){this.offset=l;this.baseLine=g;this.width=k;this.height=f;this.fontData=t}function y(l,g,k,f,t,v,E,C,F){this.cache_idx=l;this.rawData=
g;this.none=!g;this.hotX=k;this.hotY=f;this.width=t;this.height=v;this.xorSize=C;this.andSize=F;this.result="";this.distance=0;this.bpp=E;this.system="";if(g){if(!this.distance){l=0;if(g){E=0;for(var W=g.length;E<W;E++)0!=g[E]&&(l+=E%t+(E/t|0))}this.distance=l}if(!this.system){a:switch(this.distance){case 507:l="text";break a;case 2046:case 4359:l="default";break a;default:l=""}this.system=l}}l="";if(!this.system&&g){E=t*v*4;l=62+E+C+F;W=new Uint8Array(l);l=new hi5.DataBuffer(W,0,l);l.setLittleEndian16(0);
l.setLittleEndian16(2);l.setLittleEndian16(1);l.setByte(t);l.setByte(v);l.setByte(0);l.setByte(0);l.setLittleEndian16(k);l.setLittleEndian16(f);l.setLittleEndian32(40+E+C+F);l.setLittleEndian32(22);l.setLittleEndian32(40);l.setLittleEndian32(t);l.setLittleEndian32(2*v);l.setLittleEndian16(1);l.setLittleEndian16(32);l.setLittleEndian32(0);l.setLittleEndian32(C+F);l.setLittleEndian32(0);l.setLittleEndian32(0);l.setLittleEndian32(0);l.setLittleEndian32(0);for(k=v-1;0<=k;k--)for(f=0;f<t;f++)v=g[t*k+f],
l.setByte(v&255),l.setByte(v>>8&255),l.setByte(v>>16&255),l.setByte(v>>24&255);l="data:image/x-icon;base64,"+hi5.Base64.enc(l.getData())}this.url=l}var S=[],n=null,z=new hi5.graphic.Rectangle(0,0,0,0),B="Uint8ClampedArray"in window,u=null,K=0,D=0,P=0,Y=0,T=null,pa,w,X=0,ha=0;this.width=a;this.height=b;var Z=!1,fa=this,da={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(l){u=l};this.getDirtyArea=function(){return z};this.setImgRect=function(l,g,k,f){K=l;D=g;P=k;Y=f};this.parseMonitorDef=
function(l){var g=l.split(","),k=g.length,f=[];if(1<k){for(var t=!1,v=0;v<k;v++){var E=g[v].split(":");if(4==E.length)f[v]=Array(5),f[v][0]=parseInt(E[0]),f[v][1]=parseInt(E[1]),f[v][2]=parseInt(E[2]),f[v][3]=parseInt(E[3]),f[v][4]=0==f[v][0]&&0==f[v][1]?1:0;else{t=!0;break}}t&&(svGlobal.logger.warn("invaiid monitorDef:"+l),f.length=0)}return f};this.setMonitorLayout=function(l){var g=l.length,k=0;pa=l;for(w=Array(g);k<g;k++)w[k]=new hi5.graphic.Rectangle(0,0,0,0);ha=g};this.setMonitorCount=function(l){ha=
l};this.addImg=function(l){P&&(T&&URL.revokeObjectURL(T.src),T=l)};this.flushImgs=function(){T&&(URL.revokeObjectURL(T.src),T=null,P=0)};this.getData=function(){return S};this.pause=function(l,g){Z=l;g&&n&&n.fillRect(0,0,a,b)};this.release=function(){z=null;hi5.Arrays.release(w);fa.flushImgs();S=n=fa=null;da=da.imgData=null};this.isPaused=function(){return Z};this.setContext=function(l){l!=n&&(n||!l||l.createImageData(1,1).data.buffer||(B=!1),n=l,null!=n&&(da.imgData=n.createImageData(a,b)))};this.getContext=
function(){return n};this.resize=function(l,g){if(S.length!=g||S[0].length!=l){for(var k=0;k<g;k++)S[k]=new Uint32Array(l);S.length=g;fa.width=a=l;fa.height=b=g;null!=n&&(da.imgData=n.createImageData(a,b))}};fa.resize(a,b);this.getBuffer=function(){return S};this.setRGB=function(l,g,k){S[g][l]=k|4278190080};this.getRGB=function(l,g){return S[g][l]};this.setRGBs=function(l,g,k,f,t,v,E){var C=l+k,F=g+f;F>b&&(F=b);if(!(l>=a)){C>a&&(k-=C-a);for(C=g;C<F;C++,v+=E)S[C].set(t.subarray(v,v+k),l);d(l,g,k,f)}};
this.moveArea=function(l,g,k,f,t,v){if(0<v){var E=l+t,C=g+v,F;for(F=f-1;0<=F;F--)S[C+F].set(S[g+F].subarray(l,l+k),E)}else if(0>v)for(E=l+t,C=g+v,F=0;F<f;F++)S[C+F].set(S[g+F].subarray(l,l+k),E);else if(0<t){E=l+t;C=g+v;var W;for(F=k-1;0<=F;F--){var N=E+F;var m=l+F;for(W=0;W<f;W++)S[C+W][N]=S[g+W][m]}}else for(E=l+t,C=g+v,F=0;F<k;F++)for(N=E+F,m=l+F,W=0;W<f;W++)S[C+W][N]=S[g+W][m];d(l+t,g+v,k,f)};this.getRGBs=function(l,g,k,f,t){var v=new Uint32Array(k*f),E=l+k;f=g+f;for(var C=0;g<f;g++)v.set(S[g].subarray(l,
E),C),C+=k;return t?(t(v),null):v};this.repaint=function(l,g,k,f){var t=da.imgData.data,v=0,E,C;u&&u.begin("paint");0>l&&(k+=l,l=0);0>g&&(f+=g,g=0);l+k>a&&(k=a-l);g+f>b&&(f=b-g);var F=l+k;var W=g+f;if(B)for(t=new Uint32Array(t.buffer),C=g;C<W;C++)t.set(S[C].subarray(l,F),v),v+=a;else{var N=4*(a-k)|0;for(C=g;C<W;C++){for(E=l;E<F;E++){var m=S[C][E];t[v++]=m&255;t[v++]=m>>8&255;t[v++]=m>>16&255;t[v++]=255}v+=N}}da.left=l;da.top=g;da.width=k;da.height=f;u&&u.end("paint");return da};this.postPaint=d;this.draw=
function(l,g,k,f){if(!Z&&n)if(T&&T.complete&&(n.drawImage(T,K,D,P,Y),URL.revokeObjectURL(T.src),T=null),ha){if(l=e(l,g,k,f),l.width)return fa.repaint(l.x,l.y,l.width,l.height),l.width=0,da}else if(z.width)return fa.repaint(z.x,z.y,z.width,z.height),z.width=0,da;return null};this.fillRect=function(l,g,k,f,t){var v=l+k,E=g+f;if(S[0].fill)for(var C,F=g;F<E;F++)S[F].fill(t,l,v);else for(F=g;F<E;F++)for(C=l;C<v;C++)S[F][C]=t;d(l,g,k,f)};this.drawLine=function(l,g,k,f,t){if(g==f){if(l>k){var v=l;l=k;k=
v}var E=S[g];k++;if(E.fill)E.fill(t,l,k);else for(v=l;v<k;v++)E[v]=t}else if(l==k)for(g>f&&(v=g,g=f,f=v),f++,v=g;v<f;v++)S[v][l]=t;else{var C=Math.abs(k-l),F=Math.abs(f-g);v=l;E=g;k=k>=l?l=1:l=-1;g=f>=g?f=1:f=-1;if(C>=F){g=l=0;var W=C;var N=C/2|0;var m=F}else f=k=0,W=F,N=F/2|0,m=C,C=F;if(!(1>C))for(C++,F=0;F<C;F++)S[E][v]=t,N+=m,N>=W&&(N-=W,v+=l,E+=f),v+=k,E+=g}};this.bitBlt=function(l,g,k,f,t,v,E,C,F,W){var N=fa;switch(l){case 0:C=N.setRGB;for(N=k;N<k+t;N++)for(F=f;F<f+v;F++)C(N,F,0);break;case 1:l=
E;F=W*C+F;W=N.setRGB;g=N.getRGB;null==l&&(l=N);for(N=0;N<v;N++){for(E=0;E<t;E++)W(k+t,f+v,~(g(k+t,f+v)|l[F])&16777215);F+=C-t}break;case 2:l=E;F=W*C+F;W=N.setRGB;g=N.getRGB;null==l&&(l=N);for(N=0;N<v;N++){for(E=0;E<t;E++){var m=g(k+t,f+v);W(k+t,f+v,m&~l[F]&16777215);F++}F+=C-t}break;case 3:h(N,E,C,F,W,t,v);E?N.setRGBs(k,f,t,v,E,W*C+F,C):N.moveArea(F,W,t,v,k-F,f-W);break;case 4:h(N,null,g,k,f,t,v);q(N,g,k,f,t,v,E,C,F,W);break;case 5:h(N,null,g,k,f,t,v);break;case 6:l=E;F=W*C+F;null==l&&(l=N);for(N=
0;N<v;N++){for(W=0;W<t;W++)S[f+N][k+W]=S[f+N][k+W]^l[F]&16777215|4278190080,F++;F+=C-t}break;case 7:l=E;F=W*C+F;W=N.setRGB;g=N.getRGB;null==l&&(l=N);for(N=0;N<v;N++){for(E=0;E<t;E++)m=g(k+E,f+N),W(k+E,f+N,~(m&l[F])&16777215),F++;F+=C-t}break;case 8:q(N,g,k,f,t,v,E,C,F,W);break;case 9:l=E;F=W*C+F;W=N.setRGB;g=N.getRGB;null==l&&(l=N);for(N=0;N<v;N++){for(E=0;E<t;E++)m=g(k+E,f+N),W(k+E,f+N,m^~l[F]&16777215),F++;F+=C-t}break;case 10:break;case 11:l=E;F=W*C+F;W=N.setRGB;g=N.getRGB;null==l&&(l=N);for(N=
0;N<v;N++){for(E=0;E<t;E++)m=g(k+E,f+N),W(k+E,f+N,m|~l[F]&16777215),F++;F+=C-t}break;case 12:E?N.setRGBs(k,f,t,v,E,W*C+F,C):N.moveArea(F,W,t,v,k-F,f-W);break;case 13:h(N,null,g,k,f,t,v);M(N,g,k,f,t,v,E,C,F,W);break;case 14:M(N,g,k,f,t,v,E,C,F,W);break;case 15:C=N.setRGB;for(N=k;N<k+t;N++)for(F=f;F<f+v;F++)C(N,F,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+l)}d(k,f,t,v)};this.drawLineExt=function(l,g,k,f,t,v){if(l==k||g==f){var E;if(g==f)if(k>l){var C=k-l;if(!(1>C))for(E=0;E<
C;E++)A(v,l+E,g,t)}else{if(C=l-k,!(1>C))for(E=0;E<C;E++)A(v,k+E,g,t)}else if(f>g){if(C=f-g,!(1>C))for(E=0;E<C;E++)A(v,l,g+E,t)}else if(C=g-f,!(1>C))for(E=0;E<C;E++)A(v,l,f+E,t)}else{var F=Math.abs(k-l),W=Math.abs(f-g);E=l;C=g;var N,m;var I=k>=l?N=1:N=-1;var H=f>=g?m=1:m=-1;if(F>=W){H=N=0;var R=F;var ba=F/2>>0;var qa=W}else m=I=0,R=W,ba=W/2>>0,qa=F,F=W;if(1>F)return;for(W=0;W<=F;W++)A(v,E,C,t),ba+=qa,ba>=R&&(ba-=R,E+=N,C+=m),E+=I,C+=H}t=Math.min(l,k);l=Math.max(l,k);k=Math.min(g,f);g=Math.max(g,f);
0>l-t||0>g-k||d(t,k,l-t+1,g-k+1)};this.drawText=function(l,g,k,f,t,v,E,C,F,W,N,m,I,H,R,ba,qa,ua,Aa,Ea,Ba){var ya=0;1<m?G(W,N,m,I,t,ua,Aa,Ea,Ba):1==k&&G(v,E,C,F,t,ua,Aa,Ea,Ba);for(var Ia=ba,va=0;va<ba;)switch(qa[ya+va]){case 255:var za=qa[ya+va+2];if(za>Ia-ya){va=ba=0;break}za=qa.slice?qa.slice(ya,ya+za):qa.subarray(ya,ya+za);Q[qa[ya+va+1]]=za;va+=3;ba-=va;ya=va;va=0;break;case 254:var Na=(za=Q[qa[ya+va+1]])?za:null;Na&&0==Na[1]&&0==(g&32)&&(0!=(g&4)?R+=qa[ya+va+2]:H+=qa[ya+va+2]);va=va+2<ba?va+3:
va+2;ba-=va;ya=va;va=0;if(!Na)break;for(var Ya=Na.length,Za=0;Za<Ya;Za++){za=la.getFont(l,Na[Za]);if(0==(g&32)){var Wa=Na[++Za];0!=(Wa&128)?(0!=(g&4)?R+=Na[Za+1]|Na[Za+2]<<8:H+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(g&4)?R+=Wa:H+=Wa}za&&(J(k,H+za.offset&65535,R+za.baseLine&65535,za.width,za.height,za.fontData,t,f,ua,Aa,Ea,Ba),0!=(g&32)&&(H+=za.width))}break;default:za=la.getFont(l,qa[ya+va]),0==(g&32)&&(Wa=qa[ya+ ++va],0!=(Wa&128)?(0!=(g&4)?R+=qa[ya+va+1]|qa[ya+va+2]<<8:H+=qa[ya+va+1]|qa[ya+va+2]<<8,va+=
2):0!=(g&4)?R+=Wa:H+=Wa),za&&(J(k,H+za.offset&65535,R+za.baseLine&65535,za.width,za.height,za.fontData,t,f,ua,Aa,Ea,Ba),0!=(g&32)&&(H+=za.width)),va++}1<m?0<I&&d(W,N,m,I):0<C&&0<F&&d(v,E,C,F)};this.drawBitmap=function(l,g,k,f,t,v,E,C,F){var W=Ca.getBitmap(l,g);W?(l=W.width,g=W.height,t>l&&(t=l),v>g&&(v=g),12==F?fa.setRGBs(k,f,t,v,W.data,C*l+E,l):fa.bitBlt(F,a,k,f,t,v,W.data,l,E,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+l+" idx="+g)};this.saveDesktop=function(l,g,k,f,t){fa.getRGBs(l,
g,k,f,function(v){V.save(l,g,k,f,t,v)})};this.restoreDesktop=function(l,g,k,f,t){(t=V.restore(l,g,k,f,t))?fa.setRGBs(l,g,k,f,t,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(l,g,k){la.putFont(l,g,k)};this.putBitmap=function(l,g,k){Ca.putBitmap(l,g,k)};this.putCursor=function(l,g){ka.set(l,g)};this.setCursor=function(l){if(!Z&&-1!=l){var g=ka.get(l);if(g)fa.onSetCursor(g);else svGlobal.logger.warn("invalid cursor"+l)}};var oa=0;this.isSendingHistory=function(){return 2E3>
Date.now()-oa};this.getHistory=function(l,g){var k=null;(k=ka.toPDU())&&l(k.buffer);if(fa.onGetGfxHistory)fa.onGetGfxHistory(l,g);else{u&&u.begin("his_bitmap");Ca.forEach(function(C,F,W){if(C){var N=0,m=0;W=0;for(var I=C.length;W<I;W++)C[W]&&C[W].data&&(N++,m+=C[W].raw?C[W].raw.length:4*C[W].data.length);if(N&&m){k=new Uint8Array(m+20*N+8);k[0]=29;k[2]=1;k[3]=4;m=new hi5.DataBuffer(k,4,k.length);m.setLittleEndian32(N);for(W=0;W<I;W++)(N=C[W])&&N.data&&(m.setLittleEndian16(F),m.setLittleEndian16(W),
m.setLittleEndian16(N.left),m.setLittleEndian16(N.top),m.setLittleEndian16(N.width),m.setLittleEndian16(N.height),m.setLittleEndian16(N.bitsperpixel),m.setLittleEndian16(N.codec),m.setLittleEndian32(N.raw?N.raw.length:4*N.data.length),m.setBytes(N.raw||new Uint8Array(N.data.buffer)));l(k.buffer)}}});u&&u.end("his_bitmap");u&&u.begin("his_font");(k=la.toPDU())&&l(k.buffer);u&&u.end("his_font");for(var f=4,t=0,v=Q.length;t<v;t++)Q[t]&&(f+=Q[t].length+6);if(4<f){k=new Uint8Array(f);k[0]=29;k[2]=1;k[3]=
7;var E=4;t=0;for(v=Q.length;t<v;t++)Q[t]&&Q[t].length&&(k[E++]=t,k[E++]=t>>8,f=Q[t].length,k[E++]=f,k[E++]=f>>8,k[E++]=f>>16,k[E++]=f>>24,k.set(Q[t],E),E+=f);l(k.buffer)}(k=V.toPDU())&&l(k.buffer);g();oa=Date.now()}};this.onHistoryDone=function(){fa.onGetGfxHistory&&p.reconnect(a,b,!0)};this.setHistory=function(l,g){svGlobal.logger.info("setHistory type:"+l);switch(l){case 4:u&&u.begin("his_bitmap_dec");var k=g.getLittleEndian32();for(l=0;l<k;l++){var f=g.getLittleEndian16(),t=g.getLittleEndian16(),
v=g.getLittleEndian16(),E=g.getLittleEndian16(),C=g.getLittleEndian16(),F=g.getLittleEndian16(),W=g.getLittleEndian16(),N=g.getLittleEndian16(),m=g.getLittleEndian32(),I=new Uint8Array(g.getData().buffer,g.getPosition(),m),H=new Uint8Array(m);H.set(I);I=rdpcodecs.bitmap;switch(N){case 0:var R=new Uint32Array(H.buffer);g.skipPosition(m);break;case 1:switch(W){case 16:R=I.decompressInt16(C,F,m,H,0);break;case 24:R=I.decompressInt24(C,F,m,H,0);break;case 32:R=I.decompressInt32(C,F,m,H,0)}g.skipPosition(m);
break;case 2:R=new rdpcodecs.NSCodec,R.process(g,W,C,F),m=R.getData(),R=R.getDataSize(),R=new Uint32Array(R),rdpcodecs.flipimage(m,0,R,C,F,1)}Ca.putBitmap(f,t,new rdpcodecs.Bitmap(R,C,F,v,E,W,0==N?null:H,N))}u&&u.end("his_bitmap_dec");break;case 5:la.fromStream(g);break;case 6:ka.fromStream(g);break;case 7:for(;g.has(6);)if(l=g.getLittleEndian16(),m=g.getLittleEndian32())k=g.getData().subarray(g.getPosition(),g.getPosition()+m),Q[l]=k,g.skipPosition(m);break;case 9:V.fromStream(g);break;default:if(fa.onSetGfxHistory)fa.onSetGfxHistory(l,
g)}};var ka=new function(){var l=[],g=!1;this.useRemoteCursor=function(k){g=k};this.set=function(k,f){g&&(f.system="");l[k]=f};this.get=function(k){return l[k]};this.total=function(){return l.length};this.toPDU=function(){for(var k=2,f=2,t=0,v=0,E=l.length,C;v<E;v++)if(C=l[v])t++,f=f+7+(C.rawData?C.rawData.length:0);if(!t)return null;f=new Uint32Array(f);f[0]=100728861;f[1]=t;for(v=0;v<E;v++)if(C=l[v])if(t=C.rawData?C.rawData.length:0,f[k++]=C.cache_idx|C.bpp<<16,f[k++]=C.hotX|C.hotY<<16,f[k++]=C.width|
C.height<<16,f[k++]=C.xorSize,f[k++]=C.andSize,f[k++]=C.distance,f[k++]=t)f.set(C.rawData,k),k+=t;return f};this.fromStream=function(k){var f=k.getPosition();k=new Uint32Array(k.getData().buffer,f);var t=k[0],v=0;for(f=1;v<t;v++){var E=k[f]&65535;var C=k[f++]>>16;var F=k[f]&65535;var W=k[f++]>>16;var N=k[f]&65535;var m=k[f++]>>16;var I=k[f++];var H=k[f++];var R=k[f++];var ba=k[f++];var qa=null;ba&&(qa=new Uint32Array(ba),qa.set(k.subarray(f,f+ba)),f+=ba);C=new y(E,qa,F,W,N,m,C,I,H);R&&(C.distance=
R);g&&(C.system="");l[E]=C}}};ka.useRemoteCursor(!!ja.remoteCursor);var V=new function(){function l(k,f,t,v,E,C){this.x=k;this.y=f;this.cx=t;this.cy=v;this.offset=E;this.data=C}var g=[];this.save=function(k,f,t,v,E,C){k=new l(k,f,t,v,E,C);f=0;for(t=g.length;f<t;f++)if(!g[f]){g[f]=k;return}g.push(k)};this.restore=function(k,f,t,v,E){for(var C,F=0,W=g.length;F<W;F++)if((C=g[F])&&C.x==k&&C.y==f&&C.cx==t&&C.cy==v){if(C.offset==E)return k=C.data,g[F]=null,k;svGlobal.logger.warn("TODO: offset")}return null};
this.toPDU=function(){for(var k=0,f=2,t=0,v=g.length;t<v;t++)g[t]&&(k++,f+=g[t].data.length+6);if(!k||!f)return null;f=new Uint32Array(f);var E=2;f[0]=151060509;f[1]=k;for(t=0;t<v;t++)if(k=g[t])f[E++]=k.x,f[E++]=k.y,f[E++]=k.cx,f[E++]=k.cy,f[E++]=k.offset,f[E++]=k.data.length,f.set(k.data,E),E+=k.data.length;return f};this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());for(var f=1,t=k[0],v,E,C,F,W,N,m,I=0;I<t;I++)v=k[f++],E=k[f++],C=k[f++],F=k[f++],W=k[f++],N=k[f++],
m=new Uint32Array(N),N=f+N,m.set(k.subarray(f,N)),f=N,this.save(v,E,C,F,W,m)}},Q=[],la=new function(){var l=[];this.putFont=function(g,k,f){l[g]||(l[g]=[]);l[g][k]=f};this.getFont=function(g,k){return l[g]?l[g][k]:null};this.toPDU=function(){var g=0,k,f,t;var v=4;for(var E,C=l.length;g<C;g++)if((t=l[g])&&t.length)for(E=t.length,k=0;k<E;k++)(f=t[k])&&(v+=15+f.fontData.length);if(5>v)return null;var F=new Uint8Array(v);v=new hi5.DataBuffer(F,0,v);F[0]=29;F[2]=1;F[3]=5;v.skipPosition(4);g=0;for(C=l.length;g<
C;g++)if((t=l[g])&&t.length)for(E=t.length,k=0;k<E;k++)if(f=t[k])v.setByte(g),v.setLittleEndian16(k),v.setLittleEndian16(f.offset),v.setLittleEndian16(f.baseLine),v.setLittleEndian16(f.width),v.setLittleEndian16(f.height),v.setLittleEndian32(f.fontData.length),v.setBytes(f.fontData);return F};this.fromStream=function(g){for(;g.has(15);){var k=g.getByte(),f=g.getLittleEndian16(),t=g.getLittleEndian16(),v=g.getLittleEndian16(),E=g.getLittleEndian16(),C=g.getLittleEndian16(),F=g.getLittleEndian32();
F=g.getBytes(F);this.putFont(k,f,new x(t,v,E,C,F))}}},Ca=new function(){var l=[],g=[];this.putBitmap=function(k,f,t){if(32767==f)g[k]&&(g[k].data=null,g[k]=null),g[k]=t;else{var v=l[k];v?v[f]&&(v[f].data=null,v[f]=null):l[k]=v=[];v[f]=t}};this.getBitmap=function(k,f){return 32767==f?g[k]:l[k]?l[k][f]:null};this.forEach=function(k){for(var f=l.length,t=0;t<f;t++)k(l[t],t,l)}}}function Mb(a){function b(m,I,H){I[H]=m>>24&255;I[H+1]=m>>16&255;I[H+2]=m>>8&255;I[H+3]=m&255}function c(m,I){var H=m.length;
I=new Uint8Array(I?H+1:H);for(var R=0;R<H;R++)I[R]=m.charCodeAt(R);return I}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),h={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},q=this,M=1,A=a?48E3:9E4,G=1,J=!1,x=null;this.initTypes=function(){for(var m in h)h[m]=
[m.charCodeAt(0),m.charCodeAt(1),m.charCodeAt(2),m.charCodeAt(3)];h.url=[117,114,108,32]};q.initTypes();this.reset=function(){J=!1;G=M=1};this.close=function(){q&&(q.reset(),q=null)};this.remux=function(m){m.id=M;m.isAudio=a;m.timeScale=a?m.audioHeader.sampleRate:A;if(!J){var I=new S(a),H=new n(m);x=new Uint8Array(I.data.length+H.data.length);x.set(I.data,0);x.set(H.data,I.data.length);J=!0}m.sequenceNumber=G++;I=new t(m);H=new N(m);m=new Uint8Array(I.data.length+H.data.length);m.set(I.data,0);m.set(H.data,
I.data.length);x&&(I=new Uint8Array(x.length+m.length),I.set(x,0),I.set(m,x.length),m=I,x=null);if(q.ondata)q.ondata(m)};var y=function(m){this.type=m;this.data=null};y.prototype.setData=function(){var m=Array.prototype.slice.call(arguments,0),I=m.length,H=8,R;for(R=0;R<I;R++)H+=m[R].byteLength;this.data=new Uint8Array(H);b(H,this.data,0);this.data.set(this.type,4);H=8;for(R=0;R<I;R++)this.data.set(m[R],H),H+=m[R].byteLength};var S=function(m){var I=y.call(this,h.ftyp)||this;var H=c("mp42"),R=c("mp41"),
ba=c("isom"),qa=c("avc1"),ua=c("iso5"),Aa=new Uint8Array([0,0,2,0]);m?I.setData(H,Aa,H,R,ba,ua):I.setData(ba,Aa,ba,R,ua,qa);return I};$jscomp.inherits(S,y);var n=function(m){var I=y.call(this,h.moov)||this;var H=new z(m),R=new B(m);m=new k(m);I.setData(H.data,R.data,m.data);return I};$jscomp.inherits(n,y);var z=function(m){m=y.call(this,h.mvhd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]),qa=new Uint8Array(4);b(1E3,qa,0);var ua=
new Uint8Array([0,1,0,0]),Aa=new Uint8Array([1,0]),Ea=new Uint8Array(10),Ba=new Uint8Array(36);Ba[1]=1;Ba[17]=1;Ba[32]=64;var ya=new Uint8Array(24),Ia=new Uint8Array([255,255,255,255]);m.setData(I,H,R,ba,qa,e,ua,Aa,Ea,Ba,ya,Ia);return m};$jscomp.inherits(z,y);var B=function(m){var I=y.call(this,h.trak)||this;var H=new u(m);m=new K(m);I.setData(H.data,m.data);return I};$jscomp.inherits(B,y);var u=function(m){var I=y.call(this,h.tkhd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,7]),ba=new Uint8Array([0,
0,0,0]),qa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(m.id,ua,0);var Aa=new Uint8Array(4),Ea=new Uint8Array(8),Ba=new Uint8Array([0,0]),ya=new Uint8Array([0,0]),Ia=m.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),va=new Uint8Array(2),za=new Uint8Array(36);za[1]=1;za[17]=1;za[32]=64;var Na=new Uint8Array(4);Na[0]=m.width>>8&255;Na[1]=m.width&255;Na[2]=0;Na[3]=0;var Ya=new Uint8Array(4);Ya[0]=m.height>>8&255;Ya[1]=m.height&255;Ya[2]=0;Ya[3]=0;I.setData(H,R,ba,qa,ua,Aa,e,Ea,Ba,ya,Ia,va,za,
Na,Ya);return I};$jscomp.inherits(u,y);var K=function(m){var I=y.call(this,h.mdia)||this;var H=new D(m),R=new P(m);m=new Y(m);I.setData(H.data,R.data,m.data);return I};$jscomp.inherits(K,y);var D=function(m){var I=y.call(this,h.mdhd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,0]),qa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(m.timeScale,ua,0);m=new Uint8Array([85,196]);var Aa=new Uint8Array(2);I.setData(H,R,ba,qa,ua,e,m,Aa);return I};$jscomp.inherits(D,
y);var P=function(m){var I=y.call(this,h.hdlr)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array(4);m=m.isAudio?c("soun"):c("vide");var qa=new Uint8Array(12),ua=c("Remote Spark Handler",!0);I.setData(H,R,ba,m,qa,ua);return I};$jscomp.inherits(P,y);var Y=function(m){var I=y.call(this,h.minf)||this;var H=new w,R=new Z(m);m.isAudio?(m=new pa,I.setData(m.data,H.data,R.data)):(m=new T,I.setData(m.data,H.data,R.data));return I};$jscomp.inherits(Y,y);var T=function(){var m=y.call(this,
h.vmhd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,1]),R=new Uint8Array([0,0]),ba=new Uint8Array(6);m.setData(I,H,R,ba);return m};$jscomp.inherits(T,y);var pa=function(){var m=y.call(this,h.smhd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0]),ba=new Uint8Array(2);m.setData(I,H,R,ba);return m};$jscomp.inherits(pa,y);var w=function(){var m=y.call(this,h.dinf)||this;var I=new X;m.setData(I.data);return m};$jscomp.inherits(w,y);var X=function(){var m=y.call(this,
h.dref)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,1]),ba=new ha;m.setData(I,H,R,ba.data);return m};$jscomp.inherits(X,y);var ha=function(){var m=y.call(this,h.url)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,1]);m.setData(I,H);return m};$jscomp.inherits(ha,y);var Z=function(m){var I=y.call(this,h.stbl)||this;m=new fa(m);var H=new la,R=new Ca,ba=new l,qa=new g;I.setData(m.data,H.data,R.data,ba.data,qa.data);return I};$jscomp.inherits(Z,y);var fa=function(m){var I=
y.call(this,h.stsd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,1]);m.isAudio?(m=new da(m),I.setData(H,R,ba,m.data)):(m=new ka(m),I.setData(H,R,ba,m.data));return I};$jscomp.inherits(fa,y);var da=function(m){var I=y.call(this,h.mp4a)||this;var H=new Uint8Array(6),R=new Uint8Array([0,1]),ba=new Uint8Array(8),qa=new Uint8Array([0,2]),ua=new Uint8Array([0,16]),Aa=new Uint8Array([0,0]),Ea=new Uint8Array(2),Ba=m.audioHeader.sampleRate,ya=new Uint8Array(4);ya[0]=Ba>>
8&255;ya[1]=Ba&255;ya[2]=0;ya[3]=0;m=new oa(m);I.setData(H,R,ba,qa,ua,Aa,Ea,ya,m.data);return I};$jscomp.inherits(da,y);var oa=function(m){var I=y.call(this,h.esds)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array([3]),qa=new Uint8Array([25]),ua=new Uint8Array([0,0]),Aa=new Uint8Array([0]),Ea=new Uint8Array([4]),Ba=new Uint8Array([17]),ya=new Uint8Array([64]),Ia=new Uint8Array([21]),va=new Uint8Array(3),za=m.bufferSizeDB;va[0]=za>>16&255;va[1]=za>>8&255;va[2]=za&255;za=
new Uint8Array(4);b(m.bitRate,za,0);var Na=new Uint8Array(4);b(m.bitRate,Na,0);var Ya=new Uint8Array([5]),Za=new Uint8Array([2]),Wa=m.audioHeader.audioType||2,mb=m.audioHeader.frequencyIdx,wb=m.audioHeader.channelConfig;m=new Uint8Array(2);m[0]=Wa<<3|mb>>1&7;m[1]=(mb&1)<<7|wb<<3;Wa=new Uint8Array([6]);mb=new Uint8Array([1]);wb=new Uint8Array([2]);I.setData(H,R,ba,qa,ua,Aa,Ea,Ba,ya,Ia,va,za,Na,Ya,Za,m,Wa,mb,wb);return I};$jscomp.inherits(oa,y);var ka=function(m){var I=y.call(this,h.avc1)||this;var H=
new Uint8Array(6),R=new Uint8Array([0,1]),ba=new Uint8Array([0,0]),qa=new Uint8Array(2),ua=new Uint8Array(12),Aa=new Uint8Array(2);Aa[0]=m.width>>8&255;Aa[1]=m.width&255;var Ea=new Uint8Array(2);Ea[0]=m.height>>8&255;Ea[1]=m.height&255;var Ba=new Uint8Array([0,72,0,0]),ya=new Uint8Array([0,72,0,0]),Ia=new Uint8Array(4),va=new Uint8Array([0,1]),za=c("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=za.length;Na.set(za,1);za=new Uint8Array([0,24]);var Ya=new Uint8Array([255,255]);m=new V(m);I.setData(H,
R,ba,qa,ua,Aa,Ea,Ba,ya,Ia,va,Na,za,Ya,m.data);return I};$jscomp.inherits(ka,y);var V=function(m){var I=y.call(this,h.avcC)||this;var H=new Uint8Array([1]),R=new Uint8Array([m.sps[1]]),ba=new Uint8Array([m.sps[2]]),qa=new Uint8Array([m.sps[3]]),ua=new Uint8Array([255]),Aa=new Uint8Array([225]),Ea=new Uint8Array(2),Ba=m.sps.byteLength;Ea[0]=Ba>>8&255;Ea[1]=Ba&255;Ba=new Uint8Array(m.sps);var ya=new Uint8Array([1]),Ia=new Uint8Array(2),va=m.pps.byteLength;Ia[0]=va>>8&255;Ia[1]=va&255;m=new Uint8Array(m.pps);
I.setData(H,R,ba,qa,ua,Aa,Ea,Ba,ya,Ia,m);return I};$jscomp.inherits(V,y);var Q=function(){var m=y.call(this,h.btrt)||this;var I=new Uint8Array([0,28,156,128]),H=new Uint8Array([0,45,198,192]),R=new Uint8Array([0,45,198,192]);m.setData(I,H,R);return m};$jscomp.inherits(Q,y);var la=function(){var m=y.call(this,h.stts)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);m.setData(I,H,R);return m};$jscomp.inherits(la,y);var Ca=function(){var m=y.call(this,h.stsc)||this;
var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);m.setData(I,H,R);return m};$jscomp.inherits(Ca,y);var l=function(){var m=y.call(this,h.stsz)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]);m.setData(I,H,R,ba);return m};$jscomp.inherits(l,y);var g=function(){var m=y.call(this,h.stco)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);m.setData(I,H,R);return m};$jscomp.inherits(g,
y);var k=function(m){var I=y.call(this,h.mvex)||this;m=new f(m);I.setData(m.data);return I};$jscomp.inherits(k,y);Q=function(m){m=y.call(this,h.mehd)||this;var I=new Uint8Array([0]),H=new Uint8Array([0,0,0]);m.setData(I,H,d);return m};$jscomp.inherits(Q,y);var f=function(m){var I=y.call(this,h.trex)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m.id,ba,0);m=new Uint8Array([0,0,0,1]);var qa=new Uint8Array([0,0,0,0]),ua=new Uint8Array([0,0,0,0]),Aa=new Uint8Array([0,
0,0,0]);I.setData(H,R,ba,m,qa,ua,Aa);return I};$jscomp.inherits(f,y);var t=function(m){var I=y.call(this,h.moof)||this;v.setSequenceNumber(m.sequenceNumber);m=new E(m);I.setData(v.data,m.data);return I};$jscomp.inherits(t,y);Q=function(m){var I=y.call(this,h.mfhd)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m,ba,0);I.setData(H,R,ba);return I};$jscomp.inherits(Q,y);Q.prototype.setSequenceNumber=function(m){b(m,this.data,12)};var v=new Q(1),E=function(m){var I=y.call(this,
h.traf)||this;C.setTrackId(m.id);C.setSampleDuration(m.frameDuration);F.setBaseMediaDecodeTime(m.samples[0].timestamp);var H=32+C.data.length+F.data.length;if(m.isAudio)m=new W(m,null,H);else{for(var R=[],ba=0;ba<m.samples.length;ba++){var qa=m.samples[ba];R.push({size:qa.unitsLength+4*qa.units.length,duration:m.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:qa.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:qa.hasIDR?0:1,degradationPriority:0}})}m=new W(m,R,H)}I.setData(C.data,
F.data,m.data);return I};$jscomp.inherits(E,y);Q=function(m,I){var H=y.call(this,h.tfhd)||this;H.isAudio=I;var R=new Uint8Array([0]),ba=I?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),qa=new Uint8Array(4);b(m,qa,0);I?(m=new Uint8Array([0,0,0,1]),I=new Uint8Array(4),b(1024,I,0),H.setData(R,ba,qa,m,I)):(m=new Uint8Array([0,0,2,0,1,1,0,0]),H.setData(R,ba,qa,m));return H};$jscomp.inherits(Q,y);Q.prototype.setTrackId=function(m){b(m,this.data,12)};Q.prototype.setSampleDuration=function(m){this.isAudio||
b(m,this.data,16)};var C=new Q(0,a);Q=function(m){var I=y.call(this,h.tfdt)||this;var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m,ba,0);I.setData(H,R,ba);return I};$jscomp.inherits(Q,y);Q.prototype.setBaseMediaDecodeTime=function(m){b(m,this.data,12)};var F=new Q(0),W=function(m,I,H){var R=y.call(this,h.trun)||this;var ba=new Uint8Array([0]),qa=m.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,15,1]),ua=m.isAudio?4:16;H+=ua*(m.isAudio?m.samples.length:I.length)+28;var Aa=
new Uint8Array(4);m.isAudio?b(m.samples.length,Aa,0):b(I.length,Aa,0);var Ea=new Uint8Array(4);b(H,Ea,0);if(m.isAudio){H=new Uint8Array(ua*m.samples.length);for(var Ba=0;Ba<m.samples.length;Ba++)b(m.samples[Ba].aacData.byteLength,H,ua*Ba)}else for(H=new Uint8Array(ua*I.length),Ba=0;Ba<I.length;Ba++){m=I[Ba];var ya=ua*Ba;b(m.duration,H,ya);b(m.size,H,ya+4);var Ia=m.flags,va=new Uint8Array(4);va[0]=Ia.isLeading<<2|Ia.dependsOn;va[1]=Ia.isDependedOn<<6|Ia.hasRedundancy<<4|0|Ia.isNonSync;va[2]=Ia.degradationPriority&
61440;va[3]=Ia.degradationPriority&15;H.set(va,ya+8);b(m.compositionTimeOffset,H,ya+12)}R.setData(ba,qa,Aa,Ea,H);return R};$jscomp.inherits(W,y);Q=function(m){var I=y.call(this,h.sdtp)||this;for(var H=new Uint8Array([0]),R=new Uint8Array([0,0,0]),ba=new Uint8Array(m.length),qa=0;qa<m.length;qa++){var ua=m[qa].flags;ba[qa]=ua.isLeading<<6|ua.dependsOn<<4|R.isDependedOn<<2|R.hasRedundancy}I.setData(H,R,ba);return I};$jscomp.inherits(Q,y);var N=function(m){var I=y.call(this,h.mdat)||this;if(m.isAudio){for(var H=
new Uint8Array(m.totalByteLength),R=0,ba=0;ba<m.samples.length;ba++){var qa=m.samples[ba].aacData;H.set(qa,R);R+=qa.byteLength}I.setData(H)}else{H=new Uint8Array(4*m.unitNum+m.totalByteLength);for(ba=R=0;ba<m.samples.length;ba++){qa=m.samples[ba];for(var ua=0;ua<qa.units.length;ua++){var Aa=qa.units[ua],Ea=Aa.data.byteLength;b(Ea,H,R);R+=4;H.set(Aa.data,R);R+=Ea}}I.setData(H)}return I};$jscomp.inherits(N,y)}function sc(a){function b(G,J){this.aacData=G;this.timestamp=J}function c(G,J,x,y){this.audioType=
G;this.frequencyIdx=J;this.sampleRate=x;this.channelConfig=y}var e=sc.SAMPLING_FREQUENCY,d=null,h=!0,q=this,M=0;this.reset=function(){M=0;d=null;A.audioHeader=null;a&&a.reset()};var A=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=function(G,J){var x=G.frequencyIdx;x||(x=e.indexOf(G.sampleRate));
-1==x&&console.error("Invalid AAC sampel rate: "+G.sampleRate);d=new c(G.audioType||2,x,G.sampleRate,G.channels||G.channelConfig);A.audioHeader=d;h=!J;if(q.oncodec)q.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(G){if(h){var J=q.readADTSHeader(G);G=G.subarray(J)}J=new b(G,M);M+=1024;A.samples.push(J);A.totalByteLength+=G.byteLength;G=1/(d.sampleRate/1024);A.duration=G;A.samples[0]&&(A.bitRate=8*A.samples[0].aacData.length/G|0);a&&a.remux(A);A.clear()};this.readADTSHeader=function(G){var J=
G[1]&0?9:7,x=(G[2]>>6&3)+1,y=G[2]>>2&15,S=e[y];S||console.error("Invalid Sampling Frequency Index: "+y);var n=((G[2]&1)<<2)+(G[3]>>6&3),z=G[1]>>1&3;0!=z&&console.error("Invalid data format: layer is not 0x00: "+z.toString(16));G.length!=((G[3]&3)<<11)+(G[4]<<3)+(G[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+G.length);if(d){if(y!=d.frequencyIdx&&(d.frequencyIdx=y,d.sampleRate=S,q.oncodec))q.oncodec("mp4a.40.2",d)}else if(d=new c(x,y,S,n),A.audioHeader=d,q.oncodec)q.oncodec("mp4a.40.2",
d);return J}}function Xc(a){function b(){if(0==M)console.error("no more ExpGolomb data");else{var J=0,x=q-M;for(A=0;x<q;){var y=a[x];if(3!=y||0!=a[x-1]||0!=a[x-2])A=A<<8|y,J++;x++;if(4<=J)break}4>J&&(A<<=4-J);G=8*J;M=q-x}}function c(J){if(!(G>J)){J-=G;var x=J>>3;J-=x>>3;M-=x;b()}A<<=J;G-=J}function e(J){var x=Math.min(G,J),y=A>>>32-x;32<J&&logger.error("Read more than 32 bits:"+J);G-=x;0<G?A<<=x:0<M&&b();x=J-x;return 0<x?y<<x|e(x):y}function d(){var J;for(J=0;J<G;++J)if(0!==(A&2147483648>>>J))return A<<=
J,G-=J,J;b();return J+d()}function h(){c(1+d())}var q=a.byteLength,M=q,A=0,G=0;this.readUEG=function(){var J=d();return e(J+1)-1};this.readEG=function(){var J=this.readUEG();return 1&J?1+J>>>1:-1*(J>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(J){var x=8,y=8,S;for(S=0;S<J;S++)0!==y&&(y=this.readEG(),y=(x+y+256)%256),x=0===y?x:y};this.readSPS=function(){var J=
0,x=0,y=0,S=0,n=1,z,B=0,u=!0;if(7>a.length)return console.log("no enough SPS data"),null;var K=this.readU8();if(7!=(K&31))return console.error("Invalid SPS type: "+K,a),null;K=this.readU8();e(5);c(3);this.readU8();h();if(100===K||110===K||122===K||244===K||44===K||83===K||86===K||118===K||128===K||138===K||139===K||134===K||135===K){var D=this.readUEG();3===D&&c(1);h();h();c(1);if(this.readBool()){var P=3!==D?8:12;for(z=0;z<P;z++)this.readBool()&&(6>z?this.skipScalingList(16):this.skipScalingList(64))}}h();
z=this.readUEG();if(0===z)this.readUEG();else if(1===z)for(c(1),c(1+d()),c(1+d()),P=this.readUEG(),z=0;z<P;z++)c(1+d());h();c(1);var Y=this.readUEG();z=this.readUEG();P=e(1);0===P&&c(1);c(1);this.readBool()&&(J=this.readUEG(),x=this.readUEG(),y=this.readUEG(),S=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;
case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}T&&(n=T[0]/T[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&c(24));this.readBool()&&(h(),h());this.readBool()&&(B=this.readU32(),T=this.readU32(),u=this.readBool(),B=T/(2*B))}n=Math.ceil((16*(Y+1)-2*
J-2*x)*n);T=(2-P)*(z+1)*16-(P?2:4)*(y+S);z="avc1."+(0==a[1]?"00":a[1].toString(16));z+=0==a[2]?"00":a[2].toString(16);z+=0==a[3]?"00":a[3].toString(16);return{width:n,height:T,profileIdc:K,chromaFormatIdc:D,frameCropLeftOffset:J,frameCropRightOffset:x,frameCropTopOffset:y,frameCropBottomOffset:S,fps:B,fixedFrameRate:u,codec:z}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Td(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;
this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=M;this.unitsLength=A;this.timestamp=d;this.hasIDR=h}function e(){var y=!1;if(q&&J.sps){var S=new c;d+=J.frameDuration||3E3;J.samples.push(S);J.totalByteLength+=A;J.unitNum+=M.length;J.sequence++;y=!0;if(S.hasIDR&&x.onkeyframe)x.onkeyframe(S)}q=h=!1;M=[];A=0;return y}var d=0,h=!1,q=!1,M=[],A=0,G=Mb.searchStartCode,
J=null,x=this;J=new b;this.reset=function(){d=0;h=!1;M=[];A=0;J=new b;a&&a.reset()};this.close=function(){x&&(x.reset(),x=null)};this.parseH264Data=this.parse=function(y){for(var S=[],n=0,z,B,u,K=[0,0];n<y.byteLength;){K[0]=n;G(y,K);var D=K[0];if(-1==D)break;n=K[1];n=D+n;u=y[n];u&=31;z&&(z={type:B,data:y.subarray(z,D)},S.push(z));z=n;B=u}z&&(z={type:B,data:y.subarray(z,y.byteLength)},S.push(z));for(y=0;y<S.length;y++)switch(K=S[y],n=K.type,n){case 1:case 2:case 3:case 4:M.push(K);A+=K.data.byteLength;
q=!0;break;case 5:q=h=!0;M.push(K);A+=K.data.byteLength;break;case 6:break;case 7:n=new Xc(K.data);if(n=n.readSPS()){if(J.width=n.width,J.height=n.height,J.codec=n.codec,J.sps=K.data,n.fps&&(J.frameDuration=9E4/n.fps|0),M.push(K),A+=K.data.byteLength,x.oncodec)x.oncodec(J.codec,n)}else console.log("corrupted sps",K.data);break;case 8:J.pps=K.data;M.push(K);A+=K.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+n)}e()&&J.sps&&(a.remux(J),J.clear())}}function Nb(a,
b,c){function e(){for(;A;){if(B.updating){A=!1;break}var D=M.shift();if(!D)break;try{B.appendBuffer(D),G=0}catch(P){M.unshift(D);if("QuotaExceededError"==P.name)if(q(!0))continue;else{if(J.onerror)J.onerror(P);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),J.close();break}G++;console.error("Failed to append buffer, retry "+G,P);if(2<G){if(J.onerror)J.onerror(P);break}}}}function d(){A=!0;e()}function h(){B=z.addSourceBuffer(x);B.mode="sequence";B.addEventListener("updateend",
d);B.addEventListener("error",function(D){console.error(D)});A=!0;J.play(!1);e()}function q(D){var P=Math.min(a.played.end(0),B.buffered.end(0)),Y=0,T=n.length,pa=!1,w=0;if(c)w=P-180,0>w&&console.warn("Not possible, time played secs: "+P);else if(1<T){var X=T-2;for(P=9E4*P|0;Y<T;){if(n[Y]>P){X=Y-2;break}Y++}0<=X&&(w=(n[X]+1E3)/9E4)}if(0<w)try{B.remove(0,w),n.splice(0,X+1),pa=!0,console.info("Buffer removed "+w+" isAudio: "+c)}catch(ha){console.warn("Buffer removal "+w+" failed, retry, isAudio: "+
c)}D||(S=setTimeout(q,18E4));return pa}var M=[],A=!1,G=0,J=this,x="",y=null,S=0,n=[],z=null,B=null,u=null,K=null;a.autoplay=!0;this.getKeyFrames=function(){return n};u=new Mb(c);u.ondata=function(D){M.push(D);e()};K=c?new sc(u):new Td(u);K.onkeyframe=function(D){n.push(D.timestamp)};K.oncodec=function(D,P){var Y=c?"audio/mp4;codecs=":"video/mp4;codecs=";Y+=D;if(Y!=x||(c?y.sampleRate!=P.sampleRate:y.width!=P.width||y.height!=P.height))if(x=Y,y=P,A=!1,B=null,z=new MediaSource,z.addEventListener("sourceopen",
h),a.src=URL.createObjectURL(z),J.onsps)J.onsps(P)};b.onvideoframe=function(D){K.parse(D.bitstream)};b.onaudioframe=function(D){K.parse(D)};b.onendofstream=function(){J.reset()};this.play=function(D){a.play().catch(function(P){if(!D&&(console.error(P),J.onplayerror))J.onplayerror(P)})};this.reset=function(){console.log("Reset player");S&&(clearTimeout(S),S=0);n.length=0;A=!1;x="";y=null;K&&K.reset();M.length=0};this.close=function(){J&&(J.reset(),z&&"open"==z.readyState&&(z.endOfStream(),a.src=null),
K&&K.close&&K.close(),u&&u.close&&u.close(),J=null)};this.setMediaFormat=function(D,P){K.setMediaFormat&&K.setMediaFormat(D,P)};this.getMediaSource=function(){return z};this.getMediaSourceBuffer=function(){return B};a.addEventListener("ended",function(D){console.warn(".... ended");S&&(clearTimeout(S),S=0)});a.addEventListener("emptied",function(D){A=!!B});a.addEventListener("pause",function(D){console.warn(".... paused");A=!!B;var P=a.currentTime;a.play().then(function(){console.warn("... played: "+
a.currentTime+" t: "+P)}).catch(function(Y){console.error(Y)})});a.addEventListener("waiting",function(D){A=!!B})}function Ud(a,b,c,e){function d(n,z,B,u){var K,D,P,Y,T,pa,w,X,ha,Z,fa,da,oa,ka,V,Q,la,Ca,l,g,k,f,t,v,E,C,F,W,N,m,I,H,R,ba,qa,ua,Aa,Ea,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ya){if(1==ya.nextAddress)return K=n.allocationSize(),D=new Uint8Array(K),ya.yield(n.copyTo(D),2);P=n.codedWidth;Y=(P+1)/2|0;T=n.codedHeight;pa=(T+1)/2|0;w=P*T;X=w+Y*pa;ha=2*w;Z=z.subarray(w,
ha);fa=z.subarray(ha);la=Q=V=ka=oa=da=0;k=g=l=Ca=null;f=D.subarray(0,w);t=D.subarray(w,X);v=D.subarray(X);E=0;for(C=u.length;E<C;E++){F=u[E];W=F.left;N=F.top;m=F.right;I=F.bottom;H=W/2|0;R=N/2|0;ba=m/2|0;qa=I/2|0;ua=H/2|0;Aa=ba/2|0;for(oa=N;oa<I;oa++)for(Q=oa*P,la=Q+P,Ca=f.subarray(Q,la),g=Z.subarray(Q,la),k=fa.subarray(Q,la),da=H;da<ba;da++)V=2*da+1,g[V]=Ca[da],k[V]=Ca[da+Y];Ea=(Y+1)/2|0;if(B)for(Ba=D.subarray(w),oa=R;oa<qa;oa++)for(Q=oa*P,la=Q+Y,Ca=Ba.subarray(Q,la),Q=la,la=Q+Y,l=Ba.subarray(Q,
la),Q=(2*oa+1)*P,la=Q+P,g=Z.subarray(Q,la),k=fa.subarray(Q,la),da=H;da<ba;da++)ka=2*da,g[ka]=Ca[da],k[ka]=l[da];else for(oa=R;oa<qa;oa++)for(Q=oa*Y,la=Q+Y,Ca=t.subarray(Q,la),l=v.subarray(Q,la),Q=(2*oa+1)*P,la=Q+P,g=Z.subarray(Q,la),k=fa.subarray(Q,la),da=ua;da<Aa;da++)ka=4*da,g[ka]=Ca[da],k[ka]=Ca[da+Ea],ka+=2,g[ka]=l[da],k[ka]=l[da+Ea]}ya.jumpToEnd()})}function h(n,z,B,u){var K,D,P,Y,T,pa,w,X,ha,Z,fa,da,oa,ka,V,Q,la,Ca,l,g,k,f,t,v,E,C,F,W,N,m,I,H,R,ba,qa,ua,Aa,Ea,Ba,ya,Ia,va,za,Na,Ya,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==
Wa.nextAddress)return K=new Uint8Array(n.allocationSize()),Wa.yield(n.copyTo(K),2);D=n.codedWidth;P=n.codedHeight;Y=(D+1)/2|0;T=(P+1)/2|0;pa=D*P;w=pa+Y*T;X=K.subarray(pa,w);ha=K.subarray(w);Z=2*pa;fa=z.subarray(pa,Z);da=z.subarray(Z);l=Ca=la=Q=V=ka=oa=0;t=f=k=g=null;v=0;for(E=u.length;v<E;v++){C=u[v];F=C.left;W=C.top;N=C.right;m=C.bottom;I=N-F;H=m-W;R=W*D+F;ba=K.subarray(R,pa);qa=z.subarray(R,pa);ua=fa.subarray(R);Aa=da.subarray(R);Ea=F/2|0;Ba=W/2|0;ya=N/2|0;Ia=m/2|0;va=ya-Ea;za=Ia-Ba;for(ka=0;ka<
H;ka++)Q=ka*D,la=Q+I,g=ba.subarray(Q,la),qa.set(g,Q);if(B)for(R=Ba*D+F,Na=K.subarray(pa+R),ka=0;ka<za;ka++){Q=ka*D;la=Q+I;g=Na.subarray(Q,la);Q=2*ka*D;la=Q+I;f=ua.subarray(Q,la);t=Aa.subarray(Q,la);for(oa=0;oa<va;oa++)V=2*oa,Ca=g[V],f[V]=Ca,f[V+1]=Ca,l=g[V+1],t[V]=l,t[V+1]=l,void 0==l&&console.log("undefined v: "+V,oa,ka,Q,la,I,va,za);Q+=D;ua.set(f,Q);Aa.set(t,Q)}else for(R=Ba*Y+Ea,Ya=X.subarray(R),Za=ha.subarray(R),ka=0;ka<za;ka++){Q=ka*Y;la=Q+va;g=Ya.subarray(Q,la);k=Za.subarray(Q,la);Q=2*ka*D;
la=Q+I;f=ua.subarray(Q,la);t=Aa.subarray(Q,la);for(oa=0;oa<va;oa++)V=2*oa,Ca=g[oa],f[V]=Ca,f[V+1]=Ca,l=k[oa],t[V]=l,t[V+1]=l;Q+=D;ua.set(f,Q);Aa.set(t,Q)}}return Wa.return(z)})}function q(n){var z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(B){switch(B.nextAddress){case 1:if(!e){if(1E3==n.duration)G.onframedecoded(n);B.jumpTo(2);break}z=null;return 1E3==n.duration?B.yield(S.setYuv420Frame(n),6):B.yield(S.getCombinedFrame(n),5);case 5:z=B.yieldResult;B.jumpTo(4);break;case 6:z=B.yieldResult;
case 4:G.onframedecoded(z),z.close();case 2:n.close(),B.jumpToEnd()}})}function M(n){var z=n.codec;if(z!=A||(b?x.sampleRate!=n.sampleRate:x.width!=n.width||x.height!=n.height))if(console.log("Codec: "+z+" audio: "+b),A=z,x=n,J||(J=new VideoDecoder({output:function(B){q(B)},error:function(B){console.error("VideoDecoder error:",B);if(G.onerror)G.onerror(B)}})),z={codec:A,codedWidth:n.width,codedHeight:n.height,hardwareAcceleration:c||"no-preference"},console.log(z),J.configure(z),G.onsps)G.onsps(n)}
var A=null,G=this,J,x=null,y={type:"delta",data:null,timestamp:0,duration:0},S=new function(){function n(D){for(;;){var P=z.shift();if(P){if(P.timestamp==D)return P.rects;if(P.timestamp>D){console.log("not possible, time: "+D+" option.timestamp: "+P.timestamp);break}}else break}return null}var z=[],B=null,u=!1,K={timestamp:0,codedWidth:0,codedHeight:9,duration:0,format:"I444"};this.pushRects=function(D){z.push(D)};this.setYuv420Frame=function(D){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){if(1==
P.nextAddress)return B||(B=new Uint8Array(2*D.allocationSize()),u="NV12"==D.format,K.codedWidth=D.codedWidth,K.codedHeight=D.codedHeight,console.log("isNV12: "+u+" supportsI444: "+e)),P.yield(h(D,B,u,n(D.timestamp)),2);K.duration=D.duration;K.timestamp=D.timestamp;return P.return(new VideoFrame(B,K))})};this.getCombinedFrame=function(D){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){if(1==P.nextAddress)return P.yield(d(D,B,u,n(D.timestamp)),2);K.duration=D.duration;K.timestamp=D.timestamp;
return P.return(new VideoFrame(B,K))})};this.close=function(){B&&(B=null)}};a.onvideoframe=function(n){var z=n.bitstream;var B=0,u=[0,0],K=z.length;var D=!1;var P=null;for(var Y=!1,T=0,pa=0;B<K;){u[0]=B;Mb.searchStartCode(z,u);var w=u[0];if(-1==w){pa=u[1];break}w+=u[1];B=w+1;T=z[w]&31;switch(T){case 5:D=!0;break;case 7:(P=(new Xc(z.subarray(w))).readSPS())||(Y=!0)}}B=K-B;u=null;7>B&&(u=z.subarray(0,K-(B+(pa+1))),7==T&&(Y=!1));z=u;Y&&console.log("corrupted: "+n.timestamp,n.bitstream);P&&M(P);x&&(S.pushRects({timestamp:n.timestamp,
rects:n.regionRects}),z&&(n.bitstream=z),y.type=D?"key":"delta",y.data=n.bitstream,y.timestamp=n.timestamp,y.duration=n.isChroma?77:1E3,n=new EncodedVideoChunk(y),J.decode(n))};this.play=function(n){};this.reset=function(){console.log("Reset MediaDecoder");x=A=null;S.close();J&&J.reset()&&J.close();J=null};this.close=function(){G.reset();J&&(J.close(),J=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo=
{domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Lb=!1,lb={},jb={},Bb=null,p=this,oc=!1,Xa=!1,cb=0,Cb=null,Yc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ja=hi5.appcfg,Jb="";this.setConfig=function(a){ja=a};var bb="object"==typeof r?r:null,O=bb?{}:hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));void 0==O.mapClipboard&&ja.clipboard&&void 0!=ja.clipboard.enabled&&(O.mapClipboard=ja.clipboard.enabled);
O.hardwareAcceleration||(O.hardwareAcceleration=ja.hardwareAcceleration);void 0==O.yuv444&&(O.yuv444=ja.yuv444);void 0==ja.enableDVCAudio&&(ja.enableDVCAudio=!0);var Ka=0,La=0,fb=(na||O.color||O.server_bpp||16)|0,qc=null,Zc=null,Qa=null,ec=null,$c="/DOWNLOAD?",ad="/CLIP?";24==fb&&(fb=16);var Va="app"==O.startProgram,Kb=U(O.mapDisk),nb=0;this.setLinks=function(a){a.download&&($c=a.download);a.clipboard&&(ad=a.clipboard)};this.protocol=bb?"":r.substring(0,r.indexOf("://")).toLowerCase();this.hasSmartCard=
function(){return U(O.smartCard)||U(O.mapSmartCard)||U(O.passwordIsPin)};this.enableWebAuthn=function(){return U(O.enableWebAuthn)||U(O.useWebAuthn)};this.hasScanner=function(){return U(O.scanner)};this.hasUSB=function(){return U(O.mapUSB)&&!!navigator.usb};this.getUSB=function(){return O.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=
function(a){Zc=a};this.getProfiler=function(){return Zc};this.gateway=function(){if(bb)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=xa;var kb="object"==typeof r||0<r.indexOf("/PLAY?"),tc=!kb&&0<r.indexOf("invitation=");if(tc){var uc=decodeURIComponent(r),Ob=
uc.indexOf(' USERNAME="');if(0<Ob){Ob+=11;var Vd=uc.substring(Ob,uc.indexOf('"',Ob));r+="&novice="+Vd}r+="&mapClipboard=on";O.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,bb?r="":(Ka=640,La=480),r+="&touchpad=on",O.touchpad="on",this.reconnectOnResize=!1;else if(0<r.indexOf("/JOIN?")||tc)this.mode=2,this.reconnectOnResize=!1;var vc=U(O.gfx)||U(O.remotefx)||0<p.mode;vc&&(Va||tc?(vc=!1,O.remotefx=!1):fb=32);L?Ka=parseInt(L):O.width&&(Ka=parseInt(O.width));aa?La=parseInt(aa):O.height&&
(La=parseInt(O.height));-1==Ka&&(Ka=hi5.browser.getScreenWidth());-1==La&&(La=hi5.browser.getScreenHeight());O.symlink&&O.parameters&&hi5.tool.queryToObj(O.parameters,O);O.gateway||(r+="&gateway="+encodeURIComponent(p.gateway));!O.minWidth&&ja.minWidth&&(O.minWidth=ja.minWidth);!O.minHeight&&ja.minHeight&&(O.minHeight=ja.minHeight);O.minWidth&&(O.minWidth=parseInt(O.minWidth));O.minHeight&&(O.minHeight=parseInt(O.minHeight));O.waWidth=O.waWidth?parseInt(O.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?
Math.max(screen.width,screen.height):screen.width;O.waWidth&=-4;O.waHeight=O.waHeight?parseInt(O.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;O.waHeight&=-4;"useSSL"in O||(r+="&useSSL="+("wss"==p.protocol));hi5.storage.isAvailable&&(U(O.shareClipboard)||O.shareClipboardId)&&(r+="&shareClipboardId="+(O.shareClipboardId||ca()));ja&&(void 0!=ja.displayMsg?this.displayMsg=ja.displayMsg:ja.displayMsg=this.displayMsg,ja.appTimeout&&(this.appTimeout=
ja.appTimeout),void 0!=ja.reconnectOnResize&&(this.reconnectOnResize=ja.reconnectOnResize),ja.reconnectTimes&&(this.reconnectTimes=ja.reconnectTimes),void 0!=ja.windowState&&(this.windowState=ja.windowState),void 0!=ja.openLink&&(this.openLink=ja.openLink),void 0!=ja.setTitle&&(this.setTitle=ja.setTitle),"boolean"==typeof ja.useWSS&&(r=(ja.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),"boolean"==typeof ja.remoteAppLogin&&(this.remoteAppLogin=ja.remoteAppLogin,Lb=!ja.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),
"boolean"==typeof ja.hideLogin&&(Lb=ja.hideLogin),void 0!=ja.localPrinter&&void 0==O.localPrinter&&(O.localPrinter=ja.localPrinter));var Oa=null;void 0==ja.useWorker&&(ja.useWorker=!1);ja.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ja.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ma=ja.useWorker?new Worker(ta("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,vb=this.reconnectTimes,
bc=Ma?{type:5,data:null}:null;this.getDisplayName=ea;this.server=ea();this.port=parseInt(O.port,10);this.loadbalanceToken="";ja.loadbalanceTokenName&&(O[ja.loadbalanceTokenName]?ma(O[ja.loadbalanceTokenName]):!1!==ja.randomAppId?ma(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){p.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+p.loadbalanceToken:"&"+p.loadbalanceToken,a+="&loadbalanceTokenName="+ja.loadbalanceTokenName);return a};this.getURL=function(){return r};
this.getRuntimeURL=function(){var a=r+"&width="+Ka+"&height="+La+"&server_bpp="+fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Hc(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=O.monitorDef,d=O.monitor,h=0;b=ia.size();var q=Array(b);c=Array(b);var M=0,A=0,G=0,J=0,x=0,y=0,S="";if(e){c=sa.parseMonitorDef(e);for(b=c.length;h<b;h++){var n=c[h];n[0]<G&&(G=n[0]);n[1]<J&&(J=n[1]);n[2]>x&&(x=n[2]);n[3]>y&&(y=n[3])}0>G&&(M=-G);0>J&&(A=-J);n=0>d?[G,J,x,y]:c[d];O.width=n[2]-n[0]+1;O.height=
n[3]-n[1]+1;h=ia.getSurface(0);h.setMonitor(n[0],n[1],n[2],n[3]);if(M||A)for(n=h.getMousePosition(),n.left+=M,n.right+=M,n.top+=A,n.bottom+=A,h=0;h<b;h++)n=c[h],n[0]+=M,n[1]+=A,n[2]+=M,n[3]+=A;sa.setMonitorLayout(c);0>d&&sa.setMonitorCount(0);p.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+O.width+"&height="+O.height}else{if(1<b&&!Va){for(ia.verifyMonitors();h<b;h++)e=ia.getSurface(h),n=e.getMousePosition(),n.left<G&&(G=n.left),n.top<J&&(J=n.top),n.right>x&&(x=n.right),n.bottom>y&&(y=n.bottom),
q[h]=n,S&&(S+=","),S+=n.left+":"+n.top+":"+n.right+":"+n.bottom;0>G&&(M=-G);0>J&&(A=-J);for(h=0;h<b;h++){n=ia.getSurface(h).getMousePosition();if(M||A)n.left+=M,n.right+=M,n.top+=A,n.bottom+=A;c[h]=[n.left,n.top,n.right,n.bottom,n.left==M&&n.top==A?1:0]}sa.setMonitorLayout(c);p.reconnectOnResize=!1}S&&(svGlobal.logger.warn("MonitorDef:"+S),O.width=x-G+1,O.height=y-J+1,S="&monitorDef="+S+"&width="+O.width+"&height="+O.height);b=S}a+=b;0>r.indexOf("waWidth")&&(b=(b=ia.getFocused())?b.getWindow():window,
a+="&waWidth="+O.waWidth+"&waHeight="+O.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;O.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());O.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==O.soundPref&&(O.soundPref=0,a+="&soundPref=0");M=c=b="";for(M in lb)A=lb[M],"flags"in A&&(b&&(b+=",",c+=","),b+=A.name,c+=A.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(M in jb)A=jb[M],"flags"in
A&&(b&&(b+=","),b+=A.name);b&&(a+="&gwChannelName="+b);if(c=Ad())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);O.audioRecord=U(O.audioRecord)&&hi5.audio.recordable;Ha.init(b,vc,O.audioRecord,O.soundPref,U(O.mapCamera)&&!!navigator.mediaDevices,U(O.mapUSB)&&!!navigator.usb);O.audioRecord&&(a+="&audioRecord=on");O.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ha.count&&(a+="&dvcChannels="+Ha.names.join(","));
a+="&binary=on";ja.existingFile&&(a+="&existingFile="+ja.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(xa());a=p.modifyURL(a);ja.copyTextOnly&&U(O.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);U(O.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Jd()};this.getColor=function(){return fb};this.changeTitle=
ra;hi5.browser.isTouch&&Math.max(Ka,La)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Fa=null,Ja=!1,qb=!1,rc=!1,Ta=new function(){function a(A){c&&(d&&d.disconnect(),h&&h.disconnect());hi5.audio.releaseAudioContext();A||(M&&(M.close(),M=null),q&&(q.pause(),q=null))}function b(A){console.error("play error: ",A)}var c=null;this.supportWebAudio=this.available=!1;(0==O.playSound||0<p.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&
(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(A){return c.createBuffer(2,A,Ga.samplePerSec)};var e=0,d=null,h=null;this.setVolume=function(A){1==A?d=null:(d||(d=c.createGain()),d.gain.value=A)};this.playBuffer=function(A){h=c.createBufferSource();h.buffer=A;d?(h.connect(d),d.connect(c.destination)):h.connect(c.destination);var G=c.currentTime,J=0<e?e:G;J<G&&(J=G);e=J+A.duration;h.start?h.start(J):h.noteOn(J);return e-G};this.iOSFix=function(){if(c){var A=
this.getBuffer(1024),G=c.createBufferSource();G.buffer=A;G.connect(c.destination);G.start?G.start(0):G.noteOn(0)}};this.close=a;var q=null,M=null;this.onaudioframe=null;this.initMediaPlayer=function(A,G,J){a(!0);q||(q=document.createElement("audio"));M||(M=new Nb(q,A,!0),M.onplayerror=b,M.onerror=function(x){console.error("Not possible audio error",x)},svGlobal.logger.info("MediaPlayer init, headerless: "+J+" sampleRate:"+G.sampleRate));M.setMediaFormat(G,J);M.play(!1)}},Qd=Ta.available,sa=new Bc(200,
200);sa.onSetCursor=Mc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Zb=0,Yb=0,$b=Ka-1,ac=La-1,pc="";window.$rdp||(window.$rdp=this);Da(fb);this.setResolution=Pa;this.running=function(){return Ja};this.setJoinMode=function(a){Ja&&wa("8E1"+a)};this.setJoinCloseMode=function(a){Ja&&wa("8EB3\t"+a)};this.refuseControl=function(a){Ja&&wa("8E3"+a)};this.giveControl=function(a){Ja&&wa("8E4"+a)};this.pauseSession=function(a,b){Ja&&wa("8EB"+(b?1:0)+"\t"+a)};this.closeSession=
function(a){Ja&&wa("8EB2\t"+a)};this.requestControl=function(){Ja&&wa("8E2")};this.saveSession=function(a){Ja&&wa("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ja&&wa("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(c&&0<c.length){var h=c.shift();h.key?Db.sendSingleKey(h.down,h.key):h.char&&tb(h.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,
down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(h,q){var M=b[q.toLowerCase()];M?p.writeScancode(h,M):(M=q.length,0!=M&&(1==M?p.writeKeyCode(h,q.toUpperCase().charCodeAt(0)):h&&p.writeText(q)))};var c=null,e=
0,d=null;this.sendKeyComb=function(h,q,M){if(Xa){h=h.split("+");var A=h.length,G;if(0!=A){var J=null,x=[];for(G=0;G<A;G++){var y=h[G];""==y&&""==J&&(y="Add");""!=y&&x.push({key:y,down:!0});J=y}A=x.length;for(G=A-1;0<=G;G--)x.push({key:x[G].key,down:!1});if(q)c=x,e=q,d=M,a();else for(G=0,A=x.length;G<A;G++)Db.sendSingleKey(x[G].down,x[G].key)}}};this.sendText=function(h,q,M){for(var A=[],G=0,J=h.length;G<J;G++)A.push({"char":h.charAt(G)});c=A;e=q;d=M;a()}};this.writeKeyComb=function(a,b,c){Xa&&Db.sendKeyComb(a,
b,c)};this.writeText=function(a,b,c){if(Xa)if(b)Db.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)tb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),p.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ia=new function(a,b){function c(){function d(x){for(;0<x.ownerWinid;){var y=G.getWinById(x.ownerWinid);if(y&&y.isVisible())x=y;else break}return x}function h(x){for(var y="";x;)x.titleInfo&&(y=x.titleInfo),x=G.getWinById(x.ownerWinid);return y}var q=[],M=[],A=
0,G=this;this.mainWin=null;this.appId="";var J=0;this.getActiveWinId=function(){return J};this.setActiveWinId=function(x,y){svGlobal.logger.info("setActiveWinId: "+x+" old: "+J+" max: "+y);if(J!=x){var S=0==J;J=x;(x=G.getMainByWinId(x))&&x.isMainWin()&&G.mainWin!=x&&(G.mainWin=x);S&&y&&(y=ia.getFocused())&&(y=y.getFreeSpace(),x=y.width,p.resetSize(x,y.height))}};this.onchange=function(x){x.isVisible()||x!=G.mainWin?x.isVisible()&&!G.mainWin&&x.isMainWin()&&(G.mainWin=x,3==a.windowState&&x.exeCommand(61488)):
G.mainWin=null};this.addWin=function(x){for(var y=q.length,S=!1,n=0;n<y;n++)if(x.id==q[n].id){q[n]=x;S=!0;break}S||q.push(x);1==q.length&&(A=Date.now());y=x.isMainWin();svGlobal.logger.info("is mainwin:"+y+" id:"+x.id);y&&!G.mainWin&&(G.mainWin=x)};this.popWins=function(x){x=G.getWinById(x);var y=[];if(x){x=0<x.ownerWinid?x.ownerWinid:x.id;for(var S=q.length-1;0<=S;S--)if(q[S].ownerWinid==x||q[S].id==x)y.push(q[S]),q.splice(S,1)}return y};this.hasApp=function(x){return-1!=M.indexOf(x)};this.addApp=
function(x){return-1==M.indexOf(x)?(M.push(x),!0):!1};this.isNew=function(){return 3E4>Date.now()-A};this.getAll=function(){return q};this.hasWin=function(x){return 0<=q.indexOf(x)};this.close=function(){for(var x=0,y=q.length;x<y;x++)q[x].close()};this.clear=function(){q.length=0};this.delWin=function(x){for(var y=0,S=q.length;y<S;y++)if(q[y].id==x)return q.splice(y,1),y;return-1};this.isRunning=function(){var x=q.length;if(1>x)return!1;var y=0;for(x=q.length;y<x;y++){var S=q[y];if(S.showState)return!0}return!1};
this.getWinById=function(x){var y=q.length;if(1>y)return null;for(var S=0;S<y;S++){var n=q[S];if(n.id==x)return n}return null};this.getMainWinByAppId=function(x){var y=null,S=0;for(len=q.length;S<len;){y=q[S];if(y.appId==x&&y.isVisible()&&1>y.ownerWinid)break;S++}return y};this.getTopWin=function(x){var y=null,S,n=x.length;for(S=0;S<n&&(!(y=G.getWinById(x[S]))||!y.isVisible());S++)y=null;if(!y)for(svGlobal.logger.warn("No win found"),n=q.length,S=n-1;0<=S&&(y=q[S],!y.isVisible());S--)y=null;return y};
this.getMain=function(x){return(x=G.getTopWin(x))?d(x):null};this.getMainByWinId=function(x){return(x=G.getWinById(x))?d(x):null};this.getOtherApps=function(x,y,S){var n=q.length;if(0!=n&&q[n-1])if(n=q[n-1].appId,S||!n)setTimeout(function(){G.getOtherApps(x,y)},S||3E3);else{S=[];if(n=G.getTopWin(x)){var z=0<n.ownerWinid?n.ownerWinid:n.id,B=[],u=0;for(n=q.length;u<n;u++)q[u].ownerWinid!=z&&q[u].id!=z&&q[u].isVisible()&&B.push(q[u]);u=0;for(n=B.length;u<n;u++)B[u].ownerWinid!=z&&B[u].id!=z&&(S.push({title:h(B[u]),
win:d(B[u])}),z=0<B[u].ownerWinid?B[u].ownerWinid:B[u].id)}y(S)}};this.getFullTitle=function(x){for(var y,S="";;){y=G.getWinById(x);if(!y)break;y.titleInfo&&y.isVisible()&&(S&&(S=" > "+S),S=y.titleInfo+S);if(1>x)break;x=y.ownerWinid}return S}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,h=0;h<d;h++)e[h].railWin&&e[h].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,h=Array(d),q=0;q<d;q++)e[q].configMonitor(),h[q]=e[q].getMousePosition();h.sort(function(G,
J){var x=G.left-J.left;return 0!=x?x:G.top-J.top});var M=h.findIndex(function(G){return 0==G.left&&0==G.top});svGlobal.logger.info("monitor layout",h,M);-1==M&&(p.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",h));for(q=M-1;0<=q;){if(h[q].right<h[q+1].left){var A=h[q+1].left-h[q].right-1;0<A&&(h[q].right+=A,h[q].left+=A)}h[q].bottom<h[q+1].top&&(A=h[q+1].top-h[q].bottom-1,0<A&&(h[q].top+=A,h[q].bottom+=
A));q--}for(q=M+1;q<d;)h[q-1].right<h[q].left&&(A=h[q].left-h[q-1].right-1,0<A&&(h[q].right-=A,h[q].left-=A)),h[q-1].bottom<h[q].top&&(A=h[q].top-h[q-1].bottom-1,0<A&&(h[q].top-=A,h[q].bottom-=A)),q++};this.repaint=function(d,h,q,M){for(var A=0,G=e.length;A<G;A++)e[A].repaint(d,h,q,M)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var h=e.length,q=0;q<h;q++)if(e[q].equals(d))return!0;return!1};
this.getMonitorSurface=function(d,h,q,M){var A=e.length;if(1==A)return e[0];for(var G=0;G<A;G++)if(e[G].isMonitor(d,h,q,M))return e[G];return null};this.fromSyncedSurface=function(d){var h=e.length;Date.now();for(var q=0;q<h;q++)if(e[q].isClipSynced(d))return!0;return!1};this.setSize=function(d,h,q){for(var M=0,A=e.length;M<A;M++)e[M].setSize(d,h,q)};this.zOrders=[];this.drawLicense=function(d){for(var h=0,q=e.length;h<q;h++)e[h].drawLicense(d)};this.setReadOnly=function(d,h){for(var q=0,M=e.length;q<
M;q++)e[q].setReadOnly(d,h)};this.setVisible=function(d,h){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var h=0,q=e.length;h<q;h++)e[h]&&e[h].setCursor(d)};this.hide=function(d){d=0;for(var h=e.length;d<h;d++)e[d]&&e[d].hide()};this.execute=function(d,h){for(var q=0,M=e.length;q<M;q++)e[q][d].apply(e[q],h)};this.addWin=function(d){var h=this.getFocused();h||(svGlobal.logger.warn("Focused surface not found!"),h=e[e.length-1]);h?(Va=!0,h.railWin||(h.railWin=new c,h.onunload=
function(){hi5.appcfg.closeRemoteApp&&h.railWin&&h.railWin.close();h.remoteApp&&h.remoteApp.close();h.railWin&&(h.railWin.clear(),h.railWin=null);e.removeElm(h)}),h.context&&b.setContext(h.context),h.railWin.addWin(d),h.railWin.mainWin==d&&(setTimeout(function(){var q=h.getFreeSpace();a.writeRawInput("8C661441\t"+q.width+"\t"+q.height);svGlobal.logger.info("-- main win dp change:"+q.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):
5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&h.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var h,q=e.length-1;0<=q;q--){var M=e[q];h=M.railWin;var A=h.getWinById(d),G=A&&A.appId&&-1!=A.appId.toLowerCase().indexOf("runonce");if(0<=h.delWin(d)){A==h.mainWin&&(h.mainWin=null);if(M.toolbar){d="win"+d;var J=M.toolbar.querySelector("#"+
d);J&&M.toolbar.removeChild(J)}if(!h.isRunning()&&0==p.mode){if(A.isMainWin()&&M.onremoteappclose)M.onremoteappclose(A);A=a.appTimeout;if(G||h.isNew())A*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(x){return function(){svGlobal.logger.info("Start del:"+Date.now());x.railWin&&x.railWin.isRunning()||(x.remoteApp&&x.remoteApp.close(),ia&&ia.delSurface(x))}}(M),A)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var h,
q=0,M=e.length;q<M;q++)if(e[q]&&e[q].railWin&&(h=e[q].railWin.getWinById(d)))return h;return null};this.getMainWinByAppId=function(d){for(var h,q=0,M=e.length;q<M;q++)if(e[q].railWin&&(h=e[q].railWin.getMainWinByAppId(d)))return h;return null};this.onWinChange=function(d){for(var h,q=0,M=e.length;q<M;q++)if(e[q].railWin&&(h=e[q].railWin.getWinById(d.id)))e[q].railWin.onchange(d)};this.setTitle=function(d){for(var h,q=0,M=e.length;q<M;q++)if(e[q].railWin){h=e[q].railWin.getWinById(d);var A=e[q].railWin.getFullTitle(d);
if(A){a.changeTitle(A,e[q].getWindow(),h.appId);break}}};this.hasApp=function(d){for(var h=0,q=e.length;h<q;h++)if(e[h].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var h=0,q=e.length;h<q;h++)if(e[h].railWin&&e[h].railWin.hasWin(d))return e[h];return null};this.getOwnerSurfaceById=function(d){for(var h,q=0,M=e.length;q<
M;q++)if(e[q].railWin&&(h=e[q].railWin.getWinById(d)))return e[q];return null};this.getFocused=function(){for(var d=e.length,h=0;h<d;h++)if(e[h].focused)return e[h];return e[d-1]};this.close=function(){for(var d=0,h=e.length;d<h;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function h(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var q=this;this.resizable=function(){return q.isVisible?0!=(q.style&262144)||0!=(q.style&65536)||0!=(q.style&
16777216)||3==q.showState:!1};this.setShowState=function(M){q.showState=M};this.parent=function(){return ia.getWinById(q.ownerWinid)};this.resize=function(M,A,G,J){svGlobal.logger.info("www resize, l "+M+" w "+G);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+q.id+"\t"+M+"\t"+A+"\t"+G+"\t"+J)};this.exeCommand=function(M){svGlobal.logger.info("www exeCommand, cmd "+M);a.writeRawInput("8C4"+d+"\t"+M)};this.activate=function(M){svGlobal.logger.info("www activate, enable "+M+" id:"+
d);2==q.showState?(q.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+M)},50)):a.writeRawInput("8C3"+d+"\t"+M)};this.close=function(){svGlobal.logger.info("www close");q.exeCommand(61536)};this.getAppId=h;this.isVisible=function(){return q.winWidth&&q.winHeight&&q.showState&&45<q.winHeight&&45<q.winWidth};this.isMainWin=function(){if(!(q.isVisible()&&q.winWidth&&q.winHeight&&45<q.winHeight&&45<q.winWidth))return!1;var M=1>q.ownerWinid;if(!M)return M;var A=q.style;if(0!=(A&4194304))return!0;
if(0!=(A&2147483648)&&(0==(A&8388608)||0==(A&12582912)))return!1;var G=0!=(q.extStyle&128);(M=M&&!G)&&0!=(A&2147483648)&&0==(A&2156396544)&&(M=!1);return M};h()}}(p,sa);this.getSurfaces=function(){return ia};this.hide=function(){ia&&ia.hide()};this.getFileUrl=function(a,b,c){var e=xa(),d=$c,h=d.indexOf("://");e=(0<h&&11>h?d:e+d)+"s="+pc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return p.modifyURL(e)};this.listFiles=function(a,b){Oa&&Xa&&Oa.list(a,b)};this.writeRawInput=function(a){if(Xa){wa(a);
if(p.onactivity)p.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);wa(e.buffer)};var bd=0;if(ja.numLock||ja.numlock||U(O.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)bd|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=
b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};
this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var h=d.getFreeSpace(),q=h.width;h=h.height;Ra.checkLockFlags=!0;ja.scale?d.scaleTo(q,h,!1):a.resetSize(q,h)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,h){this.reqCopyTime=Date.now();var q=a.getGatewayAddr(),M=ad,A=M.indexOf("://");q=(0<A&&11>A?M:q+M)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+
d;d=hi5.httpGet(a.modifyURL(q),h);this.reqCopyTime=Date.now();Uc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,h,q){a.reconnectOnResize=!1;var M=a.getFileUrl(d,h,q);p.ondownload&&p.ondownload({fileName:d,url:M,source:h,action:q})||window.open(M)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return r};this.reconnect=function(d,h,q){O.symlink?(d="user="+d+"&pwd="+h,q&&(d+="&domain="+q),r=hi5.tool.replaceQuery(r,"parameters",d)):(r=hi5.tool.replaceQuery(r,"user",d),
r=hi5.tool.replaceQuery(r,"pwd",h),r=hi5.tool.replaceQuery(r,"domain",q));a.run()};this.sendKeyboardSyncFlags=function(d,h){return Xa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},h||333),!0):!1};this.sendKeyboardSynchronize=function(d,h,q){var M=0;q&&(M|=4);h&&(M|=2);d&&(M|=1);this.sendKeyboardSyncFlags(M)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(d,
10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,h){a.authWithCode(d,h)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(p,bd),Wd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,h){return a.repaint(c,e,d-c+1,h-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),c.activate(1),
svGlobal.logger.info("Activate win:"+c.id))}}(sa,ia);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new pb(143)};this.GatewayChannel=function(){return new pb(28)};this.DynamicChannel=function(){return new pb(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Ha.names.push(a.name);Ha[a.name]=a;Ha.count++};var Sa=null,Ha={count:0,names:[],usbChannel:null,
close:function(){for(var a=Ha.names,b=0,c=a.length;b<c;b++)Ha[a[b]].onclose&&(Ha[a[b]].onclose(),Ha[a[b]]=null);a.length=0;Ha.usbChannel=null},init:function(a,b,c,e,d,h){function q(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;
var n=this;this.fromBuffer=function(z,B){n.formatTag=z.getLittleEndian16();n.nChannels=z.getLittleEndian16();n.nSamplesPerSec=z.getLittleEndian32();n.nAvgBytesPerSec=z.getLittleEndian32();n.nBlockAlign=z.getLittleEndian16();n.bitsPerSample=z.getLittleEndian16();var u=z.getLittleEndian16();n.cbSize=u;0<u&&!0!==B&&(n.extenstion=Array(u),z.copyToByteArray(n.extenstion,0,z.getPosition(),u),z.skipPosition(u))};this.toBuffer=function(z){z.setLittleEndian16(n.formatTag);z.setLittleEndian16(n.nChannels);
z.setLittleEndian32(n.nSamplesPerSec);z.setLittleEndian32(n.nAvgBytesPerSec);z.setLittleEndian16(n.nBlockAlign);z.setLittleEndian16(n.bitsPerSample);z.setLittleEndian16(n.cbSize);0<n.cbSize&&z.setBytes(n.extenstion)};this.getSize=function(){return 18+n.cbSize};this.toString=function(){return"Audio Format, tag="+n.formatTag+" nChannels="+n.nChannels+" nSamplesPerSec="+n.nSamplesPerSec+" nAvgBytesPerSec="+n.nAvgBytesPerSec+" nBlockAlign="+n.nBlockAlign+" bitsPerSample="+n.bitsPerSample+" cbSize="+n.cbSize}}
function M(){Sa=new p.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(n){var z=n.getLittleEndian32();n.getLittleEndian32();switch(z){case 5:z=n.getLittleEndian32(),Sa.maxMonitorAreaFactorA=n.getLittleEndian32(),Sa.maxMonitorAreaFactorB=n.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+z+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),n=new Uint8Array(2),n[0]=146,n[1]=4,wa(n.buffer),
Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(n,z){if(Sa.enabled){var B=new Uint8Array(56),u=new RdpBuffer(B,0,56);n=n>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:n&-4;z=z>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:z&-4;u.setLittleEndian32(2);u.setLittleEndian32(56);u.setLittleEndian32(40);u.setLittleEndian32(1);u.setLittleEndian32(1);u.setLittleEndian32(0);u.setLittleEndian32(0);u.setLittleEndian32(n);u.setLittleEndian32(z);u.setLittleEndian32(.26458*
n|0);u.setLittleEndian32(.26458*z|0);u.setLittleEndian32(n>z?0:90);u.setLittleEndian32(100);u.setLittleEndian32(100);Sa.send(B);svGlobal.logger.warn("Display control: "+n+"x"+z)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!ja.disableDVC){if(ja.enableEcho){var A=new p.DynamicChannel;A.name="ECHO";A.process=function(n){var z=n.getPosition(),B=n.getEnd(),u=new Uint8Array(B-z);u.set(n.getData().subarray(z,B));A.send(u)};p.addDynamicChannel(A)}if(a){var G=new p.DynamicChannel;
G.name="Microsoft::Windows::RDS::Input";G.process=function(n){var z=n.getLittleEndian16();n.getLittleEndian32();switch(z){case 1:n.skipPosition(4),n=new RdpBuffer(new Uint8Array(16),0,16),n.setLittleEndian16(2),n.setLittleEndian32(16),n.setLittleEndian32(3),n.setLittleEndian32(65536),n.setLittleEndian16(256),n.markEnd(),G.send(n);case 5:ia.execute("setTouchRemoting",[!0]);Ha.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ia.execute("setTouchRemoting",[!1]),Ha.isTouchReady=
!1,svGlobal.logger.info("Touch remoting suspend")}};p.addDynamicChannel(G)}if(c){svGlobal.logger.warn("Audio input on");var J=new p.DynamicChannel;(function(){function n(w){var X=new RdpBuffer(new Uint8Array(5),0,5);X.setByte(7);X.setLittleEndian32(w);X.markEnd();J.send(X)}function z(w){var X=w.getLittleEndian32(),ha=w.getLittleEndian32(),Z=new q;Z.fromBuffer(w,!0);var fa=0,da=0;0<Z.cbSize&&(22==Z.cbSize?(fa=w.getLittleEndian16(),da=w.getLittleEndian32(),w.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+
Z.cbSize),w.skipPosition(Z.cbSize)));w=u[ha];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+X+" initial: "+ha+", "+w.toString());svGlobal.logger.info("Open fmt: "+Z.toString()+" validBits:"+fa+" mask:"+da);D=!0;P=p.reconnectOnResize;p.reconnectOnResize=!1;pa.onopen||(pa.onopen=function(oa){if(Ja){B=oa;p.reconnectOnResize=P;n(ha);var ka=new RdpBuffer(new Uint8Array(5),0,5);ka.setByte(4);ka.setLittleEndian32(oa?0:1);ka.markEnd();J.send(ka)}});pa.ondata||(pa.ondata=function(oa,ka){B&&(Y.length!=
ka+1&&(Y=new Uint8Array(ka+1),Y[0]=6),J.send(K),Y.set(oa,1),J.send(Y))});pa.start(w,X)}J.name="AUDIO_INPUT";J.process=function(w){var X=w.getByte();switch(X){case 1:w=w.getLittleEndian32();X=new RdpBuffer(new Uint8Array(5),0,5);X.setByte(1);X.setLittleEndian32(w);X.markEnd();J.send(X);break;case 2:var ha=w.getLittleEndian32();w.getLittleEndian32();var Z=hi5.audio.getAudioContext().sampleRate;for(X=u.length=0;X<ha;X++){var fa=new q;fa.fromBuffer(w);svGlobal.logger.info("Server rec fmt "+X+":"+fa.toString());
0==e&&49==fa.formatTag&&22050==fa.nSamplesPerSec?u.push(fa):1==fa.formatTag&&fa.nSamplesPerSec<=Z&&u.push(fa)}J.send(K);ha=0;w=u.length;for(X=0;X<w;X++)ha+=u[X].getSize();Z=new RdpBuffer(new Uint8Array(1024),0,1024);Z.setByte(2);Z.setLittleEndian32(w);Z.setLittleEndian32(ha+9);for(X=0;X<w;X++)u[X].toBuffer(Z),svGlobal.logger.info("Client rec fmt: "+u[X].toString());Z.skipPosition(1024-ha-9);Z.markEnd();J.send(Z);break;case 3:z(w);break;case 7:X=w.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+
u[X].toString()+" by client:"+D);D||(n(X),D=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+X)}};var B=!1,u=[];J.onclose=function(){B=!1;pa&&pa.close()};var K=new Uint8Array(1);K[0]=5;var D=!1,P=p.reconnectOnResize,Y=new Uint8Array(0),T=ta("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),pa=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),T):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();p.addDynamicChannel(J)}p.addDynamicChannel(function(){var n=
new p.DynamicChannel;n.name="TSMF";var z={type:"image/jpeg"},B=Array(1);n.process=function(u){u.getPosition();var K=u.getLittleEndian32()&1073741823;var D=u.getLittleEndian32();var P=u.getLittleEndian32();switch(K){case 2:if(256==P){u.getLittleEndian32();P=new Uint8Array(16);var Y=new RdpBuffer(P,0,16);Y.setLittleEndian32(2);Y.setLittleEndian32(D);Y.setLittleEndian32(1);Y.setLittleEndian32(0);n.send(P)}break;case 0:switch(P){case 257:u.getBytes(16);u.getLittleEndian32();break;case 256:K=u.getPosition();
Y=u.getLittleEndian32();for(P=0;P<Y;P++){u.getLittleEndian32();var T=u.getLittleEndian32();u.getLittleEndian32();u.skipPosition(T-4)}P=u.getPosition()-K;Y=P+8+4;P=new Uint8Array(Y);Y=new RdpBuffer(P,0,Y);Y.setLittleEndian32(-2147483648);Y.setLittleEndian32(D);P.set(u.getData().subarray(K,u.getPosition()),8);n.send(P);break;case 261:u.getBytes(16);u.getLittleEndian32();break;case 264:K=u.getLittleEndian32();u.skipPosition(4);u.getLittleEndian32();T=u.getBytes(16);var pa=u.getBytes(16);u.getLittleEndian32();
u.getLittleEndian32();u.getLittleEndian32();var w=u.getBytes(16);P=u.getLittleEndian32();u.skipPosition(P);P=new Uint8Array(20);Y=new RdpBuffer(P,0,20);Y.setLittleEndian32(-2147483648);Y.setLittleEndian32(D);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],T)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],pa)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],w)?Y.setLittleEndian32(1):(Y.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),
svGlobal.logger.warn(T),svGlobal.logger.warn(pa),svGlobal.logger.warn(w));Y.setLittleEndian32(K);n.send(P);break;case 258:u.getBytes(16);u.getLittleEndian32();K=u.getLittleEndian32();u.skipPosition(K);break;case 263:u.getBytes(16),P=new Uint8Array(16),Y=new RdpBuffer(P,0,16),Y.setLittleEndian32(-2147483648),Y.setLittleEndian32(D),Y.setLittleEndian32(1),n.send(P);case 277:u.getBytes(16);u.getLittleEndian32();break;case 262:u.getBytes(16);sa.flushImgs();sa.setImgRect(0,0,0,0);P=new Uint8Array(12);Y=
new RdpBuffer(P,0,12);Y.setLittleEndian32(-2147483648);Y.setLittleEndian32(D);n.send(P);break;case 278:u.getBytes(16);D=u.getLittleEndian32();P=u.getLittleEndian32();K=u.getLittleEndian32();u=u.getLittleEndian32();sa.setImgRect(D,P,K-D,u-P);break;case 265:u.getBytes(16);u.getLittleEndian64();u.getLittleEndian32();break;case 266:u.getBytes(16);break;case 268:u.getBytes(16);break;case 267:u.getBytes(16);break;case 269:u.getBytes(16);u.getLittleEndian32();break;case 274:break;case 275:break;case 259:u.getBytes(16);
u.getLittleEndian32();u.getLittleEndian32();u.skipPosition(32);P=u.getLittleEndian32();D=new Image;K=u.getPosition();B[0]=u.getData().subarray(K,K+P);u=new Blob(B,z);D.src=URL.createObjectURL(u);sa.addImg(D);break;case 270:sa.flushImgs();break;case 273:break;case 260:break;case 276:u.getBytes(16);P=u.getLittleEndian32();K=u.getPosition()+P;u.skipPosition(8);D=u.getLittleEndian32();svGlobal.logger.info("window state:"+D);Y=u.getLittleEndian32();T=u.getLittleEndian32();D=u.getLittleEndian32();P=u.getLittleEndian32();
u.skipPosition(8);pa=u.getLittleEndian32();w=u.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+D+" top:"+P+" w:"+Y+" h:"+T+" cl:"+pa+" ct:"+w);u.setPosition(K);K=u.getLittleEndian32();for(K=u.getPosition()+K;u.getPosition()<K;){pa=u.getLittleEndian32();w=u.getLittleEndian32();var X=u.getLittleEndian32(),ha=u.getLittleEndian32();svGlobal.logger.info("visible region, l:"+w+" t:"+pa+" r:"+ha+" b:"+X)}sa.setImgRect(D,P,Y,T);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+
P)}break;default:svGlobal.logger.warn("unkown interface:"+K)}};return n}());kb||p.addDynamicChannel(M());ja.enableDVCAudio&&p.addDynamicChannel(function(n){var z=!1,B=0,u=0,K=0,D=0,P=[],Y=new Uint8Array(4),T=new p.DynamicChannel;T.name="AUDIO_PLAYBACK_DVC";T.onclose=function(){};T.process=function(pa){function w(V){V.skipPosition(14);var Q=V.getLittleEndian16();V.getByte();var la=V.getLittleEndian16();V.skipPosition(1);for(var Ca,l=P.length=0;l<Q;l++){var g=new q;g.fromBuffer(V);(Ca=22050<=g.nSamplesPerSec&&
(1==g.formatTag||49==g.formatTag&&22050==g.nSamplesPerSec&&0==n||41222==g.formatTag))&&P.push(g)}g=20;V=P.length;for(l=0;l<V;l++)g+=P[l].getSize();l=g+4;Q=new RdpBuffer(new Uint8Array(l),0,l);Q.setByte(7);Q.setByte(2);Q.setLittleEndian16(g);Q.setLittleEndian32(3);Q.setLittleEndian32(4294967295);Q.setLittleEndian32(0);Q.setLittleEndian16(0);Q.setLittleEndian16(V);Q.skipPosition(1);Q.setLittleEndian16(la);Q.setByte(124);for(l=0;l<V;l++)g=P[l],g.toBuffer(Q);Q.markEnd();T.send(Q);5<la&&(Q=new RdpBuffer(new Uint8Array(8),
0,8),Q.setByte(12),Q.skipPosition(1),Q.setLittleEndian16(4),Q.setLittleEndian16(0),Q.setLittleEndian16(0),Q.markEnd(),T.send(Q))}function X(V){var Q=V.getLittleEndian16();V=V.getLittleEndian16();var la=new RdpBuffer(new Uint8Array(8),0,8);la.setByte(6);la.setByte(35);la.setLittleEndian16(4);la.setLittleEndian16(Q);la.setLittleEndian16(V);la.markEnd();T.send(la)}function ha(){var V=P[K];if(V.formatTag!=Ga.tag||V.nSamplesPerSec!=Ga.samplePerSec||Ga.channels!=V.nChannels)Ga.tag=V.formatTag,Ga.channels=
V.nChannels,Ga.samplePerSec=V.nSamplesPerSec,Ga.bitsPerSample=49==V.formatTag?8:V.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ga.tag+" channels="+Ga.channels+" bitsPerSample="+Ga.bitsPerSample+" samplePerSec="+Ga.samplePerSec),41222==Ga.tag&&(Ga.sampleRate=Ga.samplePerSec,Ta.initMediaPlayer(Ta,Ga,!0))}function Z(V){u=V.getLittleEndian16();K=V.getLittleEndian16();D=V.getByte();V.skipPosition(3);Y.set(V.getSubarray(4));z=!0;ha()}function fa(V,Q){var la=new RdpBuffer(new Uint8Array(8),
0,8);la.setByte(5);la.skipPosition(1);la.setLittleEndian16(4);la.setLittleEndian16(V);la.setByte(Q);la.skipPosition(1);la.markEnd();T.send(la)}function da(V){z=!1;var Q=B-8,la=Date.now();V.copyFromByteArray(Y,0,V.getPosition(),4);nc(V,D,u,Q);V=u+(Date.now()-la);fa(V,D)}function oa(V){var Q=Date.now();u=V.getLittleEndian16();K=V.getLittleEndian16();D=V.getByte();V.skipPosition(7);ha();V=nc(V,D,u,0);V*=1E3;Q=u+(Date.now()-Q)+V;fa(Q,D)}if(z)da(pa);else{var ka=pa.getByte();pa.skipPosition(1);B=pa.getLittleEndian16();
switch(ka){case 7:w(pa);break;case 6:X(pa);break;case 2:Z(pa);break;case 3:pa.getLittleEndian16();pa.getLittleEndian16();break;case 13:oa(pa)}}};return T}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var x=svGlobal.DCVC_EXTENSION;x.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(n,z){svGlobal.logger.info("activate webcam");x.videoMedia.resolutions?n():hi5.webcam.resolutions(function(B){svGlobal.logger.info("cam resolutions:",
B);B.length?(x.videoMedia.resolutions=B,n()):z()})},deactivate:function(){var n=x.videoMedia;n.track&&(n.track.stop(),n.track=null);n.ctx=null;n.canvas=null;n.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(n,z,B,u,K){svGlobal.logger.info("startStream, width:"+n+" height:"+z+" frameRate:"+B);var D=x.videoMedia,P=D.track;if(P){var Y=P.getSettings();if("live"==P.readyState)if(n!=Y.width||z!=Y.height||B!=Y.frameRate&&2!=D.type)P.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==
D.type?D.minFrameRate:B,width:{exact:n},height:{exact:z}}}).then(function(T){var pa=document.createElement("video");pa.srcObject=T;pa.play();if(window.OffscreenCanvas)var w=new OffscreenCanvas(100,100);else w=document.createElement("canvas"),w.style.position="absolute",w.style.left=0,w.style.top=0;D.track=T.getVideoTracks()[0];D.canvas=w;D.ctx=w.getContext("2d");D.video=pa;T=D.track.getSettings();D.canvas.width=T.width;D.canvas.height=T.height;u()}).catch(function(T){svGlobal.logger.warn(T);K()})},
stopStream:function(){svGlobal.logger.info("stopStream");var n=x.videoMedia;n.track&&"live"==n.track.readyState&&n.track.stop()},grabFrame:function(n){function z(u){u.arrayBuffer().then(n)}var B=x.videoMedia;B.ctx.drawImage(B.video,0,0);B=B.canvas;B.convertToBlob?B.convertToBlob({type:"image/jpeg",quality:.6}).then(z):B.toBlob(z,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,
step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,
min:2800,max:6500,step:1,default:4600}]]};x.WEBAUTHN=function(n){function z(){if(K){var D=Error("Cancelling existing WebAuthn API call for new one");D.name="WebAuthnAbortError";K.abort(D)}K=new AbortController;return K.signal}function B(){if(K){var D=Error("Manually cancelling existing WebAuthn API call");D.name="WebAuthnAbortError";K.abort(D);K=void 0}}var u=new n;u.name="WebAuthN_Channel";u.newInstance=function(){return x.WEBAUTHN(n)};u.onopen=function(){svGlobal.logger.info("webAuthn open")};u.onclose=
function(){svGlobal.logger.info("webAuthn close")};var K=null;u.process=function(D){var P=D.getEnd()-D.getPosition();D=D.getBytes(P);var Y=Ib(D),T=Y.command;P=Y.flags;D=Y.timeout;var pa=Y.webAuthNPara;if(T)switch(console.log("==== command: "+Y.command),T){case 5:if(Y.request)switch(T=Y.request[0],console.log("==== webAuth cmdType = "+T),console.log("==== webAuth request bytes: "+ub(Y.request.slice(1,Y.request.length))),T){case 1:Y=Y.request.slice(1,Y.request.length);var w=Ib(Y);Y=w[1];var X=w[2],
ha=w[3],Z=w[4],fa=w[5];T=w[6];var da=w[7];w={};var oa=Cd(pa);oa&&(oa.attestation&&(w.attestation=oa.attestation),oa.attestationFormats&&(w.attestationFormats=oa.attestationFormats));if(P=Bd(P,pa,da))w.authenticatorSelection=P;w.challenge=Y;fa&&(w.excludeCredentials=Gc(fa));w.rpId=X.id;w.rp=X;w.extensions=T?T:{};w.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};Z&&(w.pubKeyCredParams=Z);D&&(w.timeout=D);w.user=ha;D={};D.signal=z();D.publicKey=
w;navigator.credentials.create(D).then(function(ka){Dd(ka.response,X).then(function(V){var Q={},la={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},Ca=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);la.aaGuid=Ca.buffer;la.residentKey=!0;Q.deviceInfo=la;Q.status=0;Q.response=V;V=CBOR.encode(Q);Q=new hi5.DataBuffer(new Uint8Array(4+
V.byteLength));Q.setLittleEndian32(0);Q.setBytes(V);Q.markEnd();u.send(Q)})}).catch(function(ka){console.log("WebAuthN MakeCredential failed with error code ["+ka.code+"], msg: "+ka.message);ka=new hi5.DataBuffer(new Uint8Array(4));ka.setLittleEndian32(1);ka.markEnd();u.send(ka)});break;case 2:Y=Y.request.slice(1,Y.request.length);w=Ib(Y);Y=w[2];ha=w[3];T=w[4];da=w[5];w={};ha&&(w.allowCredentials=Gc(ha));w.challenge=Y;T&&(w.extensions=T);w.rp=window.location.hostname;D&&(w.timeout=D);if(D=Fc(P,pa,
da))w.userVerification=D;D={};D.signal=z();D.publicKey=w;navigator.credentials.get(D).then(function(ka){ka=new hi5.DataBuffer(new Uint8Array(void 0));ka.markEnd();u.send(ka)}).catch(function(ka){console.log("WebAuthN GetAssertion failed with error code ["+ka.code+"], msg: "+ka.message);ka=new hi5.DataBuffer(new Uint8Array(4));ka.setLittleEndian32(1);ka.markEnd();u.send(ka)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+T)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");
break;case 6:D=new hi5.DataBuffer(new Uint8Array(8));D.setLittleEndian32(0);P=Ec()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;P?D.setLittleEndian32(1):D.setLittleEndian32(0);D.markEnd();u.send(D);break;case 7:B();D=new hi5.DataBuffer(new Uint8Array(4));D.setLittleEndian32(0);D.markEnd();u.send(D);break;case 8:D=new hi5.DataBuffer(new Uint8Array(8));D.setLittleEndian32(0);D.setLittleEndian32(4);D.markEnd();u.send(D);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+
T)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return u};p.enableWebAuthn()&&Ec()&&(a=x.WEBAUTHN(p.DynamicChannel),p.addDynamicChannel(a));x.WEBCAM=function(n){var z=new n;z.name="RDCamera_Device_0";z.version=2;z.newInstance=function(){return x.WEBCAM(n)};z.onopen=function(){svGlobal.logger.info("cam open")};z.onclose=function(){svGlobal.logger.info("cam close")};z.sendSucess=function(){var B=new hi5.DataBuffer(new Uint8Array(2));B.setByte(z.version);B.setByte(1);B.markEnd();z.send(B)};
z.sendError=function(B){var u=new hi5.DataBuffer(new Uint8Array(6));u.setByte(z.version);u.setByte(2);u.setLittleEndian32(B||1);u.markEnd();z.send(u)};z.sendSteamListResp=function(){var B=new hi5.DataBuffer(new Uint8Array(7));B.setByte(z.version);B.setByte(10);B.setLittleEndian16(1);B.setByte(1);B.setByte(1);B.setByte(0);B.markEnd();z.send(B)};z.sendMediaTypeListResp=function(B){var u=x.videoMedia.resolutions,K=u.length,D=new hi5.DataBuffer(new Uint8Array(2+26*K));D.setByte(z.version);D.setByte(12);
for(var P=1==B,Y=0;Y<K;Y++){D.setByte(B);var T=u[Y];D.setLittleEndian32(T.width);D.setLittleEndian32(T.height);D.setLittleEndian32(P?T.frameRate:x.videoMedia.minFrameRate);D.setLittleEndian32(1);D.setLittleEndian32(1);D.setLittleEndian32(1);D.setByte(1)}D.markEnd();z.send(D)};z.sendCurrentMediaType=function(B,u){var K=new hi5.DataBuffer(new Uint8Array(28));K.setByte(z.version);K.setByte(14);u=x.videoMedia.resolutions[u];K.setByte(B);K.setLittleEndian32(u.width);K.setLittleEndian32(u.height);K.setLittleEndian32(1==
B?u.frameRate:x.videoMedia.minFrameRate);K.setLittleEndian32(1);K.setLittleEndian32(1);K.setLittleEndian32(1);K.setByte(1);K.markEnd();z.send(K)};z.sendSampleResp=function(B){x.videoMedia.grabFrame(function(u){var K=new hi5.DataBuffer(new Uint8Array(u.byteLength+3));K.setByte(z.version);K.setByte(18);K.setByte(B);K.setBytes(new Uint8Array(u));K.markEnd();z.send(K)})};z.sendPropertyListResp=function(){for(var B=0,u,K,D=x.videoMedia.propertyList,P=0;2>P;P++){K=D[P];u=K.length;for(var Y=0;Y<u;Y++)null!=
K[Y]&&B++}var T=new hi5.DataBuffer(new Uint8Array(2+19*B));T.setByte(z.version);T.setByte(21);for(P=0;2>P;P++){K=D[P];u=K.length;var pa=P+1;for(Y=0;Y<u;Y++)B=K[Y],null!=B&&(T.setByte(pa),T.setByte(B.propertyId),T.setByte(B.capabilities),T.setLittleEndian32(B.min),T.setLittleEndian32(B.max),T.setLittleEndian32(B.step),T.setLittleEndian32(B.default))}T.markEnd();z.send(T)};z.sendPropertyValueResp=function(B,u){(B=x.videoMedia.propertyList[B-1][u-1])?(u=new hi5.DataBuffer(new Uint8Array(7)),u.setByte(z.version),
u.setByte(23),u.setByte(B.capabilities),u.setLittleEndian32(B.default),u.markEnd(),z.send(u)):z.sendError(8)};z.setPropertyValue=function(B,u,K){if(B=x.videoMedia.propertyList[B-1][u-1])B.default=K};z.process=function(B){B.getByte();var u=B.getByte();switch(u){case 7:x.videoMedia.activate(z.sendSucess,z.sendError);break;case 8:x.videoMedia.deactivate();z.sendSucess();break;case 9:z.sendSteamListResp();break;case 11:B=B.getByte();0!=B&&svGlobal.logger.warn("Invalid stream index: "+B);z.sendMediaTypeListResp(x.videoMedia.type);
break;case 13:B=B.getByte();z.sendCurrentMediaType(x.videoMedia.type,B);break;case 15:B.getByte();u=B.getByte();if(u!=x.videoMedia.type){svGlobal.warn("Invalid video format req:"+u);z.sendError(6);break}u=B.getLittleEndian32();var K=B.getLittleEndian32();B=B.getLittleEndian32()/B.getLittleEndian32();x.videoMedia.startStream(u,K,B,z.sendSucess,z.sendError);break;case 16:x.videoMedia.stopStream();z.sendSucess();break;case 17:B=B.getByte();0!=B&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+
B);z.sendSampleResp(B);break;case 20:z.sendPropertyListResp();break;case 22:u=B.getByte();K=B.getByte();z.sendPropertyValueResp(u,K);break;case 24:u=B.getByte();K=B.getByte();var D=B.getByte();B=B.getLittleEndian32();1==D&&z.setPropertyValue(u,K,B);z.sendSucess();break;default:z.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+u)}};return z};x.WEBCAM_ENUM=function(n,z){var B=new n;B.name="RDCamera_Device_Enumerator";B.onopen=function(){var u=new hi5.DataBuffer(new Uint8Array(2));u.setByte(z.version);
u.setByte(3);u.markEnd();B.send(u);svGlobal.logger.info("camEnum open")};B.onclose=function(){svGlobal.logger.info("camEnum closed");x.videoMedia.deactivate()};B.addDevice=function(u){u+="\x00";var K=z.name+"\x00",D=new hi5.DataBuffer(new Uint8Array(2+2*u.length+K.length));D.setByte(z.version);D.setByte(5);D.setUnicodeString(u);D.setAscllString(K);D.markEnd();B.send(D)};B.process=function(u){var K=u.getByte();u=u.getByte();switch(u){case 4:svGlobal.logger.info("camEnum ver resp: "+K);z.version=K;
B.addDevice(hi5.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+u)}};return B};d&&(d=x.WEBCAM(p.DynamicChannel),a=x.WEBCAM_ENUM(p.DynamicChannel,d),p.addDynamicChannel(a),p.addDynamicChannel(d));h&&(svGlobal.logger.info("Mapping USB..."),p.addDynamicChannel(Ha.usbChannel));if(b&&x.GFX){var y=function(){S.drawable.resumePlay||(S.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();S.resumeVideo()})},S=x.GFX(p.DynamicChannel,U(O.remotefx)&&
!U(O.gfx),0==p.mode,sa,O.hardwareAcceleration,U(O.yuv444)&&hi5.browser.supportsI444);S.onmessage=function(n){p.showMessage(n)};y();S.onuserinteract=function(n){ia.execute("showPlay");y();svGlobal.logger.info("resumePlay");return!0};S.onfatalerror=function(n,z){p.reconnect(n.width,n.height,!0)};S.onsps=function(n){n.fps&&p.setFPS(n.fps)};S.onresetgraphic=function(n){p.setResolution(n.width,n.height)};S.onmapsurface=function(n){S.onconfirm();var z=ia.getMonitorSurface(n.outputOriginX,n.outputOriginY,
n.targetWidth+n.outputOriginX-1,n.targetHeight+n.outputOriginY-1);z?(z.setId(n.id),z.setSize(n.targetWidth,n.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+n.outputOriginX+" y:"+n.outputOriginY)};S.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ia.execute("setDrawable",[S.drawable])};p.addDynamicChannel(S)}x.VOR&&(b=x.VOR(p.DynamicChannel),p.addDynamicChannel(b[0]),p.addDynamicChannel(b[1]),p.addDynamicChannel(x.GT(p.DynamicChannel)))}}},db=null;svGlobal.DCVC_EXTENSION&&
!kb&&(p.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ha.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(p.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(p.GatewayChannel),p.addGatewayChannel(db)));this.getPrinters=function(a){if(!p.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();p.onagentmessage(b.getData());db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,p)};this.showError=Hb;this.resetStatus=
cc;this.exeAppCmd=function(a){var b=ia.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ia.getWinById(a):ia.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ja.forceReconnect||!1);if(!Ja&&!c)return!1;O.minWidth&&a<O.minWidth&&(a<O.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+O.minWidth),a=O.minWidth);O.minHeight&&b<O.minHeight&&(b<O.minHeight&&svGlobal.logger.warn("Height "+
b+" is samller than minHeight "+O.minHeight),b=O.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ka)&&4>Math.abs(b-La))return!1;if(Sa&&Sa.enabled&&!1!==ja.displayVC)Sa.applyResolution(a,b);else if(rc&&qb||c||Xa&&!rc)qb=!1,svGlobal.logger.info("reconnecting..."),wa("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));wa(a)};this.getUploadManager=function(){return Oa};this.setFPS=function(a){ia.execute("setFPS",[a])};this.addSurface=
function(a){if(!ia.hasSurface(a)&&(Lb||sa.setContext(a.context),!ia.hasSurface(a)||!a.railWin)){kb&&a.setPlayerMode();O.mouseMoveEmu&&(a.mouseMoveEmu=U(O.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ka&&(Ka=b.width);0==La&&(La=b.height);a.setConfig(ja);ia.addSurface(a);Pa(Ka,La,!0,O.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Wd);a.setTouchpad(U(O.touchpad));var c=b=U(O.mapClipboard),e=b;void 0!=O.copyToLocal?c=U(O.copyToLocal):void 0!=ja.copyToLocal&&(c=ja.copyToLocal);
void 0!=O.copyToRemote?e=U(O.copyToRemote):void 0!=ja.copyToRemote&&(e=ja.copyToRemote);a.setClipboard(b,c,e);Kb&&dc(a);O.invitation&&!U(O.control)&&(ia.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=O.ctrlToWin?U(O.ctrlToWin):void 0!=ja.ctrlToWin?ja.ctrlToWin:!0;c=void 0!=O.cmdToCtrl?U(O.cmdToCtrl):void 0!=ja.cmdToCtrl?ja.cmdToCtrl:!0;a.run(parseInt(O.keyboard||1033,10),b,!!ja.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ia.size();b<
c;b++)ia.getSurface(b).railWin.getMain(ia.zOrders)&&a.push(ia.getSurface(b).railWin.getMain(ia.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";wa("8C2"+a+"\t"+b+"\t"+c);var e=ia.getSurface(ia.size()-1);e&&(e.remoteApp=new Dc(a,b,c))};this.startExitingApp=function(a){a=ia.popWins(a);for(var b=a.length-1;0<=b;b--)ia.addWin(a[b])};var xb=new p.DynamicChannel;xb.name="PNPDR";xb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};xb.process=function(a){a.getLittleEndian32();
var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),xb.send(a)}};xb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};p.addDynamicChannel(xb);var gb=null;U(O.scanner)&&(gb=new p.DynamicChannel,gb.name="SCANNERDVC",gb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},
gb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(p.onagentmessage)p.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(p.onagentmessage)p.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),
3);if(p.onagentmessage)p.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},gb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addDynamicChannel(gb));var ab=null;p.hasSmartCard()&&(ab=new p.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(p.onagentmessage)p.onagentmessage(a);U(O.passwordIsPin)&&p.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||
"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(p.onagentmessage)p.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;yb&&(b+=yb.length);eb&&(b+=eb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);yb?(b.setLittleEndian32(yb.length),b.setBytes(yb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),
b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(p.onagentmessage)p.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(p.onagentmessage)p.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(ab)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),p.onagentmessage)p.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addGatewayChannel(ab));ja.detectNetwork&&(r+="&connectType=7",Gd());this.getNetworkResult=function(){return ec};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":
-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var fc=new Map,gc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:fc.clear();gc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,
!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':
'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var h=b.getLittleEndian32();h=b.getAscllString(h,!1);var q=b.getLittleEndian32();q=b.getAscllString(q,!1);var M=b.getLittleEndian32();b.getAscllString(M,!1);M=b.getLittleEndian64();M=(new Date(1E3*M)).toDateString();d=Hd(a,d,q,h,M);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");
a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var A,G=document.querySelector('input[name="scard_name"]:checked');G&&(A=parseInt(G.value));yb=fc.get(A);rb=gc.get(A);A=document.getElementById("userPin").value;eb=(new TextEncoder("utf-8")).encode(A);A=2;A=eb?A+4+eb.length:A+4;A=rb?A+4+rb.length:A+4;A=new Uint8Array(A);A=new hi5.DataBuffer(A);A.setByte(1);A.setByte(2);
eb?(A.setLittleEndian32(eb.length),A.setBytes(eb)):A.setLittleEndian32(0);rb?(A.setLittleEndian32(rb.length),A.setAsciiString(rb,rb.length)):A.setLittleEndian32(0);ab&&ab.send(A)};document.getElementById("userPin").addEventListener("keypress",function(A){"Enter"===A.key&&(A.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),
a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(gb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),
e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,p.onagentmessage)p.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Id(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var A=0,G=document.querySelector('input[name="ds_name"]:checked');G&&(A=G.value);
G=new Uint8Array(3);G[0]=4;G[1]=5;G[2]=A;if(p.onagentmessage)p.onagentmessage(G)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));b.getLittleEndian16();p.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=p.getAgentLink(),hi5.notifications.notify({title:b,
html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)h=b.getLittleEndian32(),d=b.getUnicodeString(h),h=b.getLittleEndian32(),h=b.getUnicodeString(h),c.push({name:d,driver:h});db&&db.listCallback&&(db.listCallback(c),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var yb,eb,rb,jc=
{type:6,data:null};this.setAgentStatus=function(a){Yc=a};this.getAgentStatus=function(){return Yc};this.run=function(){var a;if(a=null==p.onagentmessage)a=1==p.mode?!1:p.hasSmartCard()||p.hasScanner()||U(O.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(p):(p.hasUSB()?ia.getFocused().requestUsbDevices(p.getUSB(),function(b){Ha.usbChannel.openDevices(b);hc()}):hc(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return sa};this.mouseDown=function(a,b,c){Xa&&wa("80"+a+"\t"+
b+"\t"+c)};this.mouseMove=function(a,b){Xa&&wa("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Xa&&wa("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Xa&&wa("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Xa&&("number"==typeof a?(wa("840\t"+a),wa("8449152\t"+a)):wa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){p.reconnectOnResize&&(Va?(nb&&(clearTimeout(nb),nb=0),a&=-4,b&=-4,nb=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){p.writeRawInput("8C661441\t"+
a+"\t"+b);3==p.windowState&&Wc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):p.running()&&(nb&&(clearTimeout(nb),nb=0),nb=setTimeout(function(){document.hidden||p.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!p.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Zb,b[4]=Zb>>8,b[5]=Yb,b[6]=Yb>>8,b[7]=$b,b[8]=$b>>8,b[9]=ac,b[10]=ac>>8);wa(b.buffer);return!0};this.refreshOutput=
function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);wa(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);wa(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||(Qa=new hi5.tool.ResponseMonitor(function(){Xa&&p.sendPing()},function(){if(Xa&&p.onnoresponse)return p.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;
wa(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ma?Ma.postMessage({type:0,cmd:6,start:1}):(Fa.onSlowPath=Fa.onFastPath=Nc,Fa.onReqHistory=function(){Nc(15555)})};this.stopPing=function(){Qa&&Qa.stop();Ma?Ma.postMessage({type:0,cmd:6,start:0}):Fa.onSlowPath=Fa.onFastPath=Fa.onReqHistory=null};var $a=null,Tc=0;this.play=function(){wa("F3")};this.pause=function(){wa("F2")};this.scan=function(a){wa("F4"+(a?"1":"0"))};this.seek=function(a){var b=ia.getFocused();b&&Ja&&(wa("F4"+(a?"1":"0")+
"\t"+(a/b.getScale().x|0)),sa.pause(!0))};var Ga={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Sc=!1;this.showMessage=function(a,b,c){p&&p.displayMsg&&a&&((b=
b||ia.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(){svGlobal.logger.info("closing...");Ja&&Va&&ia&&ja.closeRemoteApp&&ia.tryCloseRemoteApps();sa&&sa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Vc,2222)):Vc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(p.close):window.addEventListener("unload",p.close,!1);Mb.searchStartCode=
function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};sc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Nb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Nb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||
(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d,h){function q(w,X,ha,Z){this.pixels=w;this.width=X;this.height=ha;this.key=Z}function M(){this.bottom=this.right=this.top=this.left=0;this.read=function(w){this.left=w.getLittleEndian16();this.top=w.getLittleEndian16();this.right=w.getLittleEndian16();this.bottom=w.getLittleEndian16()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function A(){this.qualityVal=
this.p=this.qb=0;this.read=function(w){var X=w.getByte();this.qp=X&63;this.p=X>>7&1;this.qualityVal=w.getByte()}}function G(w,X,ha){this.bitstream=w;this.regionRects=X;this.isChroma=ha;this.timestamp=0}function J(w,X,ha){this.width=w;this.height=X;this.monitors=ha}function x(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(w){this.left=w.getLittleEndian32();this.top=w.getLittleEndian32();this.right=w.getLittleEndian32();this.bottom=w.getLittleEndian32();this.flags=w.getLittleEndian32()};
this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function y(w,X,ha,Z,fa){function da(){la=!1;Ca.drawable=V._video;V._player=oa?new Ud(V,!1,Z,fa):new Nb(Ca.drawable,V,!1);V._player.onsps=function(g){console.log("*** SPS: "+g.width+"x"+g.height+" smooth:"+ka.imageSmoothingEnabled);oa&&(V._video.width=g.width,V._video.height=g.height);V.onsps&&V.onsps(g)};V._player.onerror=function(g){V.onfatalerror&&V.onfatalerror(V,
g)};V._player.onplayerror=function(g){function k(){Ca={drawable:V._video};V.player.play(!0)}Ca=null;if((!V.onuserinteract||!V.onuserinteract(k,"video"))&&V.onmessage)V.onmessage({msg:"Please click Yes to continue.<br>"+g,cbYes:function(){V.player.play(!0);this.destroy()}})};V._player.onframedecoded=function(g){ka.drawImage(g,0,0)}}this.id=w;this.width=X;this.height=ha;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=X;this.targetHeight=ha;this._player=null;var oa="no-decoder"==
Z?!1:!!window.VideoDecoder;this._video=oa?new OffscreenCanvas(X,ha):document.createElement("video");var ka=oa?this._video.getContext("2d",{alpha:!1,desynchronized:!0,antialias:!1,powerPreference:"high-performance"}):null,V=this,Q=null,la=!0,Ca={drawable:null},l=10;oa&&(svGlobal.logger.info("...MediaDecoder in use: "+Z),ka.imageSmoothingEnabled=!1);this.resumeVideo=function(){V._player&&V._player.play(!0)};this.setDisplayBuffer=function(g){Q=g};this.draw=function(g,k,f,t){return la?Q.draw(g,k,f,t):
Ca};this.processAvc=function(g){la&&da();if(oa)g.timestamp=l,l+=10;else if(g.isChroma)return;V.onvideoframe(g)};this.reset=function(g,k){V&&V._player&&V._player.reset()};this.close=function(){V&&V._player&&(V._player.close(),V._player=null);V=null};this.setRGBs=function(g,k,f,t,v,E,C){Q.setRGBs(g,k,f,t,v,E,C)};this.getRGBs=function(g,k,f,t){return Q.getRGBs(g,k,f,t)};this.moveArea=function(g,k,f,t,v,E){Q.moveArea(g,k,f,t,v,E)};this.fillRect=function(g,k,f,t,v){Q.fillRect(g,k,f,t,v)};this.postPaint=
function(g,k,f,t){la&&Q.postPaint(g,k,f,t)}}function S(w,X,ha,Z){var fa=new y(w,X,ha,d,h);fa.pixelFormat=Z||33;fa.setDisplayBuffer(e);pa.push(fa);T.oncreatesurface&&T.oncreatesurface(fa);svGlobal.logger.info("create surface id:"+w+" w:"+X+" h:"+ha+" pixelFmt:"+fa.pixelFormat);return fa}function n(w,X,ha){for(var Z=w.getPosition(),fa=w.getLittleEndian32(),da=Array(fa),oa=0;oa<fa;oa++){var ka=new M;ka.read(w);da[oa]=ka}ka=Array(fa);for(oa=0;oa<fa;oa++){var V=new A;V.read(w);ka[oa]=V}w=w.getBytes(X-
(w.getPosition()-Z));return new G(w,da,ha)}function z(w,X,ha,Z){ha=w.getLittleEndian32();var fa=ha>>>30;ha&=1073741823;switch(fa){case 0:var da=n(w,ha,!1);var oa=n(w,X-ha-4,!0);break;case 1:da=n(w,ha,!1);break;case 2:X=w.getEnd()-w.getPosition();oa=n(w,X,!0);break;default:throw Error("Invalid LC: "+fa);}da&&Z.processAvc(da);oa&&Z.processAvc(oa)}var B=new function(){function w(f,t,v,E,C){this.len=f;this.code=t;this.valueBits=v;this.type=E;this.vbase=C}function X(f){var t=25E5-da,v=f.length;if(t>=v)fa.set(f,
da),da=t>v?da+v:0;else if(25E5>=v)fa.set(f.subarray(0,t),da),fa.set(f.subarray(t),0),da=v-t;else{t=(v-t)%25E5;var E=v-t,C=f.subarray(E);f=f.subarray(v-25E5,E);fa.set(f,25E5-f.length);fa.set(C,0);da=t}}function ha(f){for(;la<f;)Q<<=8,Ca<g?Q+=l[Ca++]:console.log("--- end"),la+=8;V-=f;la-=f;f=Q>>la;Q&=(1<<la)-1;return f}var Z=[new w(1,0,8,0,0),new w(5,17,5,1,0),new w(5,18,7,1,32),new w(5,19,9,1,160),new w(5,20,10,1,672),new w(5,21,12,1,1696),new w(5,24,0,0,0),new w(5,25,0,0,1),new w(6,44,14,1,5792),
new w(6,45,15,1,22176),new w(6,52,0,0,2),new w(6,53,0,0,3),new w(6,54,0,0,255),new w(7,92,18,1,54944),new w(7,93,20,1,317088),new w(7,110,0,0,4),new w(7,111,0,0,5),new w(7,112,0,0,6),new w(7,113,0,0,7),new w(7,114,0,0,8),new w(7,115,0,0,9),new w(7,116,0,0,10),new w(7,117,0,0,11),new w(7,118,0,0,58),new w(7,119,0,0,59),new w(7,120,0,0,60),new w(7,121,0,0,61),new w(7,122,0,0,62),new w(7,123,0,0,63),new w(7,124,0,0,64),new w(7,125,0,0,128),new w(8,188,20,1,1365664),new w(8,189,21,1,2414240),new w(8,
252,0,0,12),new w(8,253,0,0,56),new w(8,254,0,0,57),new w(8,255,0,0,102),new w(9,380,22,1,4511392),new w(9,381,23,1,8705696),new w(9,382,24,1,17094304)],fa=new Uint8Array(25E5),da=0,oa=new Uint8Array(65536),ka=0,V=0,Q=0,la=0,Ca=0,l=null,g=0,k=!0;this.toPDU=function(){if(k)return null;var f=new Uint8Array(2500008);f[0]=29;f[2]=1;f[3]=10;f[4]=da;f[5]=da>>8;f[6]=da>>16;f[7]=da>>24;f.set(fa,8);return f};this.fromStream=function(f){da=f.getLittleEndian32();fa.set(f.getSubarray(25E5))};this.decompress=
function(f,t){if(t){l=f;k&&(k=!1);g=l.length-1;V=8*g-l[g];for(ka=Ca=la=Q=0;0<V;)for(var v=t=0,E=0;E<Z.length;E++){for(f=Z[E];t<f.len;)v=(v<<1)+ha(1),t++;0>v&&console.log("xxx inPrefix");if(v==f.code){if(0==f.type)f=f.vbase+ha(f.valueBits),(0>f||255<f)&&console.log("xxx do c"),f&=255,fa[da]=f,25E5==++da&&(da=0),oa[ka++]=f;else if(t=ha(f.valueBits),t=f.vbase+t,0>t&&console.log("xxx distance"),0!=t){if(0==ha(1))f=3;else{f=4;for(v=2;1==ha(1);)f*=2,v++;f+=ha(v)}t=25E5-t+da;t%=25E5;v=t+f;if(Math.abs(da-
t)>=f&&25E5>v&&25E5>da+f)t=fa.subarray(t,v),fa.set(t,da),da+=f,oa.set(t,ka),ka+=f;else for(;0<f;)v=fa[t],25E5==++t&&(t=0),fa[da]=v,25E5==++da&&(da=0),oa[ka++]=v,f--}else f=ha(15),V-=la,Q=la=0,t=l.subarray(Ca,Ca+f),X(t),oa.set(t,ka),Ca+=f,ka+=f,V-=8*f;break}}65536<ka&&console.error("xx outputIndex:"+ka);return oa.subarray(0,ka)}X(f);return f}},u=new function(){this.process=function(w){var X=w.getByte();if(224==X){var ha=0!=(w.getByte()&32);var Z=w.getPosition(),fa=w.getEnd();X=B.decompress(w.getData().subarray(Z,
fa),ha);w.setPosition(fa)}else{225!=X&&console.log("Invalid descriptor:"+X);fa=w.getLittleEndian16();var da=w.getLittleEndian32();X=new Uint8Array(da);for(var oa=0,ka,V=0;V<fa;V++)ka=w.getLittleEndian32(),ha=0!=(w.getByte()&32),ka--,Z=w.getPosition(),ha=B.decompress(w.getData().subarray(Z,Z+ka),ha),X.set(ha,oa),oa+=ha.length,w.skipPosition(ka);oa!=da&&console.error("wrong size, actual:"+oa+" expected:"+da)}return new RdpBuffer(X,0,X.length)}},K=null,D=new rdpcodecs.RemoteFX(!1),P=0,Y=[],T=new a;T.name=
"Microsoft::Windows::RDS::Graphics";var pa=new function(w,X){var ha=[];this.push=function(Z){Z.onsps=w.onsps;Z.onfatalerror=w.onfatalerror;Z.onplayerror=w.onplayerror;Z.onuserinteract=w.onuserinteract;Z.onmessage=w.onmessage;ha[Z.id]=Z};this.get=function(Z){return ha[Z]};this.getAll=function(){return ha};this.delete=function(Z){var fa=ha[Z];fa&&(fa.onsps=null,fa.onfatalerror=null,fa.onplayerror=null,ha[Z]=null)};this.reset=function(Z){Z=0;for(var fa=ha.length;Z<fa;Z++)ha[Z]&&ha[Z].reset()};this.close=
function(){for(var Z=0,fa=ha.length;Z<fa;Z++)ha[Z]&&ha[Z].close()};this.resumeVideo=function(){for(var Z=0,fa=ha.length;Z<fa;Z++)ha[Z]&&ha[Z].resumeVideo()}}(T,e);T.drawable=new function(){this.draw=function(w,X,ha,Z,fa){return(fa=pa.get(fa))?fa.draw(w,X,ha,Z):null};this.getSurfaces=function(){return pa};this.onfocus=function(w){};this.resumePlay=null};T.resumeVideo=function(){pa.resumeVideo()};T.process=function(w){for(var X=u.process(w);X.has(8);){var ha=X.getLittleEndian16();X.getLittleEndian16();
var Z=X.getLittleEndian32(),fa=X.getPosition()+Z-8;switch(ha){case 1:var da=X,oa=da.getLittleEndian16(),ka=da.getLittleEndian16(),V=da.getByte(),Q=da.getLittleEndian16(),la=da.getLittleEndian16(),Ca=da.getLittleEndian16(),l=da.getLittleEndian16(),g=Ca-Q,k=l-la,f=da.getLittleEndian32(),t=da.getPosition()+f,v=pa.get(oa);v||(T.onconfirm&&T.onconfirm(),v=S(oa,e.width,e.height,V));switch(ka){case 0:var E=rdpcodecs.bitmap.byte2int(da.getData(),f,da.getPosition());v.setRGBs(Q,la,g,k,E,0,g);break;case 3:for(var C=
D.decode(da,f),F=C.getRects(),W=C.getTiles(),N=C.getTileSize(),m=C.getRectSize(),I=0;I<N;I++){var H=W[I];if(m)for(var R=H.x+64,ba=H.y+64,qa=0;qa<m;qa++){var ua=F[qa],Aa=ua.x+ua.width,Ea=ua.y+ua.height;R<=Aa?ba<=Ea?v.setRGBs(H.x+Q,H.y+la,64,64,H.data,0,64):v.setRGBs(H.x+Q,H.y+la,64,Ea-H.y,H.data,0,64):ba<=Ea?v.setRGBs(H.x+Q,H.y+la,Aa-H.x,64,H.data,0,64):v.setRGBs(H.x+Q,H.y+la,Aa-H.x,Ea-H.y,H.data,0,64)}else v.setRGBs(H.x,H.y,64,64,H.data,0,4)}break;case 8:K||(K=new ClearDecoder);K.decode(da,g,k,v.getData(),
Q,la,v.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Ba=v,ya=n(da,f,!1);Ba.processAvc(ya);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:z(da,f,!1,v);break;case 15:z(da,f,!0,v);break;default:svGlobal.logger.warn("Invalid codec:"+ka)}da.setPosition(t);v.postPaint(Q,la,g,k);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ia=X;svGlobal.logger.info("...soliFill");
for(var va=Ia.getLittleEndian16(),za=-16777216|Ia.getByte()<<16|Ia.getByte()<<8|Ia.getByte()|Ia.getByte()<<24,Na=Ia.getLittleEndian16(),Ya=pa.get(va),Za=0;Za<Na;Za++){var Wa=Ia.getLittleEndian16(),mb=Ia.getLittleEndian16(),wb=Ia.getLittleEndian16()-Wa,cd=Ia.getLittleEndian16()-mb;Ya.fillRect(Wa,mb,wb,cd,za);Ya.postPaint(Wa,mb,wb,cd)}break;case 5:var hb=X;svGlobal.logger.info("...surfaceToSurface");for(var dd=hb.getLittleEndian16(),ed=hb.getLittleEndian16(),Pb=hb.getLittleEndian16(),Qb=hb.getLittleEndian16(),
Rb=hb.getLittleEndian16()-Pb,wc=hb.getLittleEndian16()-Qb,Xd=hb.getLittleEndian16(),fd=pa.get(dd),Yd=pa.get(ed),gd=dd==ed?null:fd.getRGBs(Pb,Qb,Rb,wc),hd=0;hd<Xd;hd++){var id=hb.getLittleEndian16(),jd=hb.getLittleEndian16();gd?Yd.setRGBs(id,jd,Rb,wc,gd,0,Rb):fd.moveArea(Pb,Qb,Rb,wc,id-Pb,jd-Qb)}break;case 6:var ob=X;svGlobal.logger.info("...surfaceToCache");var Zd=ob.getLittleEndian16(),xc=ob.getLittleEndian32().toString(16),kd=ob.getLittleEndian32();0<kd&&(xc=kd.toString(16)+xc);var $d=ob.getLittleEndian16(),
ld=ob.getLittleEndian16(),md=ob.getLittleEndian16(),nd=ob.getLittleEndian16()-ld,od=ob.getLittleEndian16()-md,ae=pa.get(Zd).getRGBs(ld,md,nd,od);Y[$d]=new q(ae,nd,od,xc);break;case 7:var Eb=X;svGlobal.logger.info("...cacheToSurface");for(var be=Eb.getLittleEndian16(),ce=Eb.getLittleEndian16(),de=Eb.getLittleEndian16(),Sb=Y[be],ee=pa.get(ce),pd=0;pd<de;pd++){var fe=Eb.getLittleEndian16(),ge=Eb.getLittleEndian16();ee.setRGBs(fe,ge,Sb.width,Sb.height,Sb.pixels,0,Sb.width)}break;case 8:var he=X.getLittleEndian16();
Y[he]=null;break;case 9:var Tb=X,ie=Tb.getLittleEndian16(),je=Tb.getLittleEndian16(),ke=Tb.getLittleEndian16(),le=Tb.getByte();S(ie,je,ke,le);break;case 10:var qd=X.getLittleEndian16();pa.delete(qd);svGlobal.logger.info("delete surface id:"+qd);break;case 11:var rd=X;rd.getLittleEndian32();rd.getLittleEndian32();break;case 12:var me=X.getLittleEndian32();if(0==P){var sd=new Uint8Array(20),sb=new RdpBuffer(sd);sb.setLittleEndian16(13);sb.setLittleEndian16(0);sb.setLittleEndian32(20);sb.setLittleEndian32(4294967295);
sb.setLittleEndian32(me);P++;sb.setLittleEndian32(P);sb.markEnd();c&&T.send(sd)}break;case 14:var Ub=X,td=Ub.getLittleEndian32(),ud=Ub.getLittleEndian32(),yc=Ub.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+td+" h:"+ud+" monitors:"+yc);for(var vd=Array(yc),Vb=0;Vb<yc;Vb++){var zc=new x;zc.read(Ub);vd[Vb]=zc;svGlobal.logger.info("MonitorDef "+Vb+": "+zc.toString())}var wd=new J(td,ud,vd);pa.reset(wd);T.onresetgraphic&&T.onresetgraphic(wd);break;case 15:var Wb=X,xd=Wb.getLittleEndian16();
Wb.skipPosition(2);var Fb=pa.get(xd);Fb.outputOriginX=Wb.getLittleEndian32();Fb.outputOriginY=Wb.getLittleEndian32();T.onmapsurface&&T.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+xd+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var Ac=X,yd=Ac.getLittleEndian32(),ne=Ac.getLittleEndian32(),Gb=Ac.getLittleEndian32(),Xb=!1;switch(yd){case 524292:Xb=!1;0==(Gb&1)&&(K=new ClearDecoder);
break;case 524549:(Xb=0!=(Gb&16))||0!=(Gb&1)||(K=new ClearDecoder);break;default:Xb=0==(Gb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+yd.toString(16)+" len:"+ne+" flags:"+Gb+" h264:"+Xb);T.onconfirm&&T.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var zb=X,zd=zb.getLittleEndian16();zb.skipPosition(2);var ib=pa.get(zd);ib.outputOriginX=zb.getLittleEndian32();ib.outputOriginY=zb.getLittleEndian32();ib.targetWidth=zb.getLittleEndian32();ib.targetHeight=zb.getLittleEndian32();
svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+zd+" outX:"+ib.outputOriginX+" outY:"+ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);T.onmapsurface&&T.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+ha);return}X.setPosition(fa)}};T.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var w=b?2:8,X=10+12*w,ha=new Uint8Array(X),Z=new RdpBuffer(ha);Z.setLittleEndian16(18);
Z.setLittleEndian16(0);Z.setLittleEndian32(X);Z.setLittleEndian16(w);Z.setLittleEndian32(524292);Z.setLittleEndian32(4);Z.setLittleEndian32(b?1:0);Z.setLittleEndian32(524549);Z.setLittleEndian32(4);Z.setLittleEndian32(b?19:0);b||(Z.setLittleEndian32(655362),Z.setLittleEndian32(4),Z.setLittleEndian32(0),Z.setLittleEndian32(655872),Z.setLittleEndian32(4),Z.setLittleEndian32(0),Z.setLittleEndian32(656129),Z.setLittleEndian32(4),Z.setLittleEndian32(0),Z.setLittleEndian32(656384),Z.setLittleEndian32(4),
Z.setLittleEndian32(0),Z.setLittleEndian32(656642),Z.setLittleEndian32(4),Z.setLittleEndian32(0),Z.setLittleEndian32(656896),Z.setLittleEndian32(4),Z.setLittleEndian32(0));Z.markEnd();c&&T.send(ha)};T.onclose=function(){pa.close()};e.onGetGfxHistory=function(w,X){var ha=B.toPDU();ha&&w(ha);X();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(w,X){svGlobal.logger.info("Set GFX Histroy");10==w?B.fromStream(X):svGlobal.logger.error("Invalid GFX histroy type: "+w)};return T}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var r=navigator&&(navigator.language||navigator.userLanguage||""),L=Rdp.languageToKeyboard[r];if(!L){var aa=r.indexOf("-");aa&&(L=Rdp.languageToKeyboard[r.substring(0,aa)])}L||(svGlobal.logger.info("No valid layout for "+r),L=1033);return L}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
