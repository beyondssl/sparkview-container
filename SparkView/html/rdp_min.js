var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(r){var I=0;return function(){return I<r.length?{done:!1,value:r[I++]}:{done:!0}}};$jscomp.arrayIterator=function(r){return{next:$jscomp.arrayIteratorImpl(r)}};$jscomp.makeIterator=function(r){var I="undefined"!=typeof Symbol&&Symbol.iterator&&r[Symbol.iterator];return I?I.call(r):$jscomp.arrayIterator(r)};$jscomp.arrayFromIterator=function(r){for(var I,V=[];!(I=r.next()).done;)V.push(I.value);return V};
$jscomp.arrayFromIterable=function(r){return r instanceof Array?r:$jscomp.arrayFromIterator($jscomp.makeIterator(r))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(r){var I=function(){};I.prototype=r;return new I};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(r,I,V){if(r==Array.prototype||r==Object.prototype)return r;r[I]=V.value;return r};$jscomp.getGlobal=function(r){r=["object"==typeof globalThis&&globalThis,r,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var I=0;I<r.length;++I){var V=r[I];if(V&&V.Math==Math)return V}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(r,I){var V=$jscomp.propertyToPolyfillSymbol[I];if(null==V)return r[I];V=r[V];return void 0!==V?V:r[I]};
$jscomp.polyfill=function(r,I,V,na){I&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(r,I,V,na):$jscomp.polyfillUnisolated(r,I,V,na))};$jscomp.polyfillUnisolated=function(r,I,V,na){V=$jscomp.global;r=r.split(".");for(na=0;na<r.length-1;na++){var S=r[na];if(!(S in V))return;V=V[S]}r=r[r.length-1];na=V[r];I=I(na);I!=na&&null!=I&&$jscomp.defineProperty(V,r,{configurable:!0,writable:!0,value:I})};
$jscomp.polyfillIsolated=function(r,I,V,na){var S=r.split(".");r=1===S.length;na=S[0];na=!r&&na in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var xa=0;xa<S.length-1;xa++){var ca=S[xa];if(!(ca in na))return;na=na[ca]}S=S[S.length-1];V=$jscomp.IS_SYMBOL_NATIVE&&"es6"===V?na[S]:null;I=I(V);null!=I&&(r?$jscomp.defineProperty($jscomp.polyfills,S,{configurable:!0,writable:!0,value:I}):I!==V&&($jscomp.propertyToPolyfillSymbol[S]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(S):$jscomp.POLYFILL_PREFIX+
S,S=$jscomp.propertyToPolyfillSymbol[S],$jscomp.defineProperty(na,S,{configurable:!0,writable:!0,value:I})))};
$jscomp.getConstructImplementation=function(){function r(){function V(){}new V;Reflect.construct(V,[],function(){});return new V instanceof V}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(r())return Reflect.construct;var I=Reflect.construct;return function(V,na,S){V=I(V,na);S&&Reflect.setPrototypeOf(V,S.prototype);return V}}return function(V,na,S){void 0===S&&(S=V);S=$jscomp.objectCreate(S.prototype||Object.prototype);return Function.prototype.apply.call(V,S,na)||
S}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var r={a:!0},I={};try{return I.__proto__=r,I.a}catch(V){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(r,I){r.__proto__=I;if(r.__proto__!==I)throw new TypeError(r+" is not extensible");return r}:null;
$jscomp.inherits=function(r,I){r.prototype=$jscomp.objectCreate(I.prototype);r.prototype.constructor=r;if($jscomp.setPrototypeOf){var V=$jscomp.setPrototypeOf;V(r,I)}else for(V in I)if("prototype"!=V)if(Object.defineProperties){var na=Object.getOwnPropertyDescriptor(I,V);na&&Object.defineProperty(r,V,na)}else r[V]=I[V];r.superClass_=I.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(r){if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(r){this.yieldResult=r};
$jscomp.generator.Context.prototype.throw_=function(r){this.abruptCompletion_={exception:r,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(r){this.abruptCompletion_={return:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(r){this.abruptCompletion_={jumpTo:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(r,I){this.nextAddress=I;return{value:r}};
$jscomp.generator.Context.prototype.yieldAll=function(r,I){r=$jscomp.makeIterator(r);var V=r.next();$jscomp.generator.ensureIteratorResultIsObject_(V);if(V.done)this.yieldResult=V.value,this.nextAddress=I;else return this.yieldAllIterator_=r,this.yield(V.value,I)};$jscomp.generator.Context.prototype.jumpTo=function(r){this.nextAddress=r};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(r,I){this.catchAddress_=r;void 0!=I&&(this.finallyAddress_=I)};$jscomp.generator.Context.prototype.setFinallyBlock=function(r){this.catchAddress_=0;this.finallyAddress_=r||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(r,I){this.nextAddress=r;this.catchAddress_=I||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(r){this.catchAddress_=r||0;r=this.abruptCompletion_.exception;this.abruptCompletion_=null;return r};$jscomp.generator.Context.prototype.enterFinallyBlock=function(r,I,V){V?this.finallyContexts_[V]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=r||0;this.finallyAddress_=I||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(r,I){I=this.finallyContexts_.splice(I||0)[0];if(I=this.abruptCompletion_=this.abruptCompletion_||I){if(I.isException)return this.jumpToErrorHandler_();void 0!=I.jumpTo&&this.finallyAddress_<I.jumpTo?(this.nextAddress=I.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=r};$jscomp.generator.Context.prototype.forIn=function(r){return new $jscomp.generator.Context.PropertyIterator(r)};
$jscomp.generator.Context.PropertyIterator=function(r){this.object_=r;this.properties_=[];for(var I in r)this.properties_.push(I);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var r=this.properties_.pop();if(r in this.object_)return r}return null};$jscomp.generator.Engine_=function(r){this.context_=new $jscomp.generator.Context;this.program_=r};
$jscomp.generator.Engine_.prototype.next_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,r,this.context_.next_);this.context_.next_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(r){this.context_.start_();var I=this.context_.yieldAllIterator_;if(I)return this.yieldAllStep_("return"in I?I["return"]:function(V){return{value:V,done:!0}},r,this.context_.return);this.context_.return(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],r,this.context_.next_);this.context_.throw_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(r,I,V){try{var na=r.call(this.context_.yieldAllIterator_,I);$jscomp.generator.ensureIteratorResultIsObject_(na);if(!na.done)return this.context_.stop_(),na;var S=na.value}catch(xa){return this.context_.yieldAllIterator_=null,this.context_.throw_(xa),this.nextStep_()}this.context_.yieldAllIterator_=null;V.call(this.context_,S);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var r=this.program_(this.context_);if(r)return this.context_.stop_(),{value:r.value,done:!1}}catch(I){this.context_.yieldResult=void 0,this.context_.throw_(I)}this.context_.stop_();if(this.context_.abruptCompletion_){r=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(r.isException)throw r.exception;return{value:r.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(r){this.next=function(I){return r.next_(I)};this.throw=function(I){return r.throw_(I)};this.return=function(I){return r.return_(I)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(r,I){I=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(I));$jscomp.setPrototypeOf&&r.prototype&&$jscomp.setPrototypeOf(I,r.prototype);return I};
$jscomp.asyncExecutePromiseGenerator=function(r){function I(na){return r.next(na)}function V(na){return r.throw(na)}return new Promise(function(na,S){function xa(ca){ca.done?na(ca.value):Promise.resolve(ca.value).then(I,V).then(xa,S)}xa(r.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(r){return $jscomp.asyncExecutePromiseGenerator(r())};$jscomp.asyncExecutePromiseGeneratorProgram=function(r){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(r)))};
$jscomp.polyfill("Reflect",function(r){return r?r:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(r){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(r){if(r)return r;if($jscomp.setPrototypeOf){var I=$jscomp.setPrototypeOf;return function(V,na){try{return I(V,na),!0}catch(S){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(r){if(r)return r;var I=function(S,xa){this.$jscomp$symbol$id_=S;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:xa})};I.prototype.toString=function(){return this.$jscomp$symbol$id_};var V=0,na=function(S){if(this instanceof na)throw new TypeError("Symbol is not a constructor");return new I("jscomp_symbol_"+(S||"")+"_"+V++,S)};return na},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(r){if(r)return r;r=Symbol("Symbol.iterator");for(var I="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),V=0;V<I.length;V++){var na=$jscomp.global[I[V]];"function"===typeof na&&"function"!=typeof na.prototype[r]&&$jscomp.defineProperty(na.prototype,r,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return r},"es6",
"es3");$jscomp.iteratorPrototype=function(r){r={next:r};r[Symbol.iterator]=function(){return this};return r};
$jscomp.polyfill("Promise",function(r){function I(){this.batch_=null}function V(ca){return ca instanceof S?ca:new S(function(ta,fa){ta(ca)})}if(r&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return r;I.prototype.asyncExecute=function(ca){if(null==this.batch_){this.batch_=[];var ta=this;this.asyncExecuteFunction(function(){ta.executeBatch_()})}this.batch_.push(ca)};
var na=$jscomp.global.setTimeout;I.prototype.asyncExecuteFunction=function(ca){na(ca,0)};I.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var ca=this.batch_;this.batch_=[];for(var ta=0;ta<ca.length;++ta){var fa=ca[ta];ca[ta]=null;try{fa()}catch(la){this.asyncThrow_(la)}}}this.batch_=null};I.prototype.asyncThrow_=function(ca){this.asyncExecuteFunction(function(){throw ca;})};var S=function(ca){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var ta=this.createResolveAndReject_();try{ca(ta.resolve,ta.reject)}catch(fa){ta.reject(fa)}};S.prototype.createResolveAndReject_=function(){function ca(la){return function(pa){fa||(fa=!0,la.call(ta,pa))}}var ta=this,fa=!1;return{resolve:ca(this.resolveTo_),reject:ca(this.reject_)}};S.prototype.resolveTo_=function(ca){if(ca===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(ca instanceof S)this.settleSameAsPromise_(ca);else{a:switch(typeof ca){case "object":var ta=
null!=ca;break a;case "function":ta=!0;break a;default:ta=!1}ta?this.resolveToNonPromiseObj_(ca):this.fulfill_(ca)}};S.prototype.resolveToNonPromiseObj_=function(ca){var ta=void 0;try{ta=ca.then}catch(fa){this.reject_(fa);return}"function"==typeof ta?this.settleSameAsThenable_(ta,ca):this.fulfill_(ca)};S.prototype.reject_=function(ca){this.settle_(2,ca)};S.prototype.fulfill_=function(ca){this.settle_(1,ca)};S.prototype.settle_=function(ca,ta){if(0!=this.state_)throw Error("Cannot settle("+ca+", "+
ta+"): Promise already settled in state"+this.state_);this.state_=ca;this.result_=ta;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};S.prototype.scheduleUnhandledRejectionCheck_=function(){var ca=this;na(function(){if(ca.notifyUnhandledRejection_()){var ta=$jscomp.global.console;"undefined"!==typeof ta&&ta.error(ca.result_)}},1)};S.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var ca=$jscomp.global.CustomEvent,ta=$jscomp.global.Event,
fa=$jscomp.global.dispatchEvent;if("undefined"===typeof fa)return!0;"function"===typeof ca?ca=new ca("unhandledrejection",{cancelable:!0}):"function"===typeof ta?ca=new ta("unhandledrejection",{cancelable:!0}):(ca=$jscomp.global.document.createEvent("CustomEvent"),ca.initCustomEvent("unhandledrejection",!1,!0,ca));ca.promise=this;ca.reason=this.result_;return fa(ca)};S.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var ca=0;ca<this.onSettledCallbacks_.length;++ca)xa.asyncExecute(this.onSettledCallbacks_[ca]);
this.onSettledCallbacks_=null}};var xa=new I;S.prototype.settleSameAsPromise_=function(ca){var ta=this.createResolveAndReject_();ca.callWhenSettled_(ta.resolve,ta.reject)};S.prototype.settleSameAsThenable_=function(ca,ta){var fa=this.createResolveAndReject_();try{ca.call(ta,fa.resolve,fa.reject)}catch(la){fa.reject(la)}};S.prototype.then=function(ca,ta){function fa(Pa,wa){return"function"==typeof Pa?function(ub){try{la(Pa(ub))}catch(qb){pa(qb)}}:wa}var la,pa,Ca=new S(function(Pa,wa){la=Pa;pa=wa});
this.callWhenSettled_(fa(ca,la),fa(ta,pa));return Ca};S.prototype.catch=function(ca){return this.then(void 0,ca)};S.prototype.callWhenSettled_=function(ca,ta){function fa(){switch(la.state_){case 1:ca(la.result_);break;case 2:ta(la.result_);break;default:throw Error("Unexpected state: "+la.state_);}}var la=this;null==this.onSettledCallbacks_?xa.asyncExecute(fa):this.onSettledCallbacks_.push(fa);this.isRejectionHandled_=!0};S.resolve=V;S.reject=function(ca){return new S(function(ta,fa){fa(ca)})};S.race=
function(ca){return new S(function(ta,fa){for(var la=$jscomp.makeIterator(ca),pa=la.next();!pa.done;pa=la.next())V(pa.value).callWhenSettled_(ta,fa)})};S.all=function(ca){var ta=$jscomp.makeIterator(ca),fa=ta.next();return fa.done?V([]):new S(function(la,pa){function Ca(ub){return function(qb){Pa[ub]=qb;wa--;0==wa&&la(Pa)}}var Pa=[],wa=0;do Pa.push(void 0),wa++,V(fa.value).callWhenSettled_(Ca(Pa.length-1),pa),fa=ta.next();while(!fa.done)})};return S},"es6","es3");
$jscomp.checkStringArgs=function(r,I,V){if(null==r)throw new TypeError("The 'this' value for String.prototype."+V+" must not be null or undefined");if(I instanceof RegExp)throw new TypeError("First argument to String.prototype."+V+" must not be a regular expression");return r+""};
$jscomp.polyfill("String.prototype.startsWith",function(r){return r?r:function(I,V){var na=$jscomp.checkStringArgs(this,I,"startsWith");I+="";var S=na.length,xa=I.length;V=Math.max(0,Math.min(V|0,na.length));for(var ca=0;ca<xa&&V<S;)if(na[V++]!=I[ca++])return!1;return ca>=xa}},"es6","es3");
$jscomp.iteratorFromArray=function(r,I){r instanceof String&&(r+="");var V=0,na=!1,S={next:function(){if(!na&&V<r.length){var xa=V++;return{value:I(xa,r[xa]),done:!1}}na=!0;return{done:!0,value:void 0}}};S[Symbol.iterator]=function(){return S};return S};$jscomp.polyfill("Array.prototype.keys",function(r){return r?r:function(){return $jscomp.iteratorFromArray(this,function(I){return I})}},"es6","es3");
$jscomp.polyfill("Array.from",function(r){return r?r:function(I,V,na){V=null!=V?V:function(ta){return ta};var S=[],xa="undefined"!=typeof Symbol&&Symbol.iterator&&I[Symbol.iterator];if("function"==typeof xa){I=xa.call(I);for(var ca=0;!(xa=I.next()).done;)S.push(V.call(na,xa.value,ca++))}else for(xa=I.length,ca=0;ca<xa;ca++)S.push(V.call(na,I[ca],ca));return S}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var r={},I=Object.create(new $jscomp.global.Proxy(r,{get:function(V,na,S){return V==r&&"q"==na&&S==I}}));return!0===I.q}catch(V){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(r,I){return Object.prototype.hasOwnProperty.call(r,I)};
$jscomp.polyfill("WeakMap",function(r){function I(){if(!r||!Object.seal)return!1;try{var la=Object.seal({}),pa=Object.seal({}),Ca=new r([[la,2],[pa,3]]);if(2!=Ca.get(la)||3!=Ca.get(pa))return!1;Ca.delete(la);Ca.set(pa,4);return!Ca.has(la)&&4==Ca.get(pa)}catch(Pa){return!1}}function V(){}function na(la){var pa=typeof la;return"object"===pa&&null!==la||"function"===pa}function S(la){if(!$jscomp.owns(la,ca)){var pa=new V;$jscomp.defineProperty(la,ca,{value:pa})}}function xa(la){if(!$jscomp.ISOLATE_POLYFILLS){var pa=
Object[la];pa&&(Object[la]=function(Ca){if(Ca instanceof V)return Ca;Object.isExtensible(Ca)&&S(Ca);return pa(Ca)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(I())return r;var ca="$jscomp_hidden_"+Math.random();xa("freeze");xa("preventExtensions");xa("seal");var ta=0,fa=function(la){this.id_=(ta+=Math.random()+1).toString();if(la){la=$jscomp.makeIterator(la);for(var pa;!(pa=la.next()).done;)pa=pa.value,this.set(pa[0],pa[1])}};fa.prototype.set=
function(la,pa){if(!na(la))throw Error("Invalid WeakMap key");S(la);if(!$jscomp.owns(la,ca))throw Error("WeakMap key fail: "+la);la[ca][this.id_]=pa;return this};fa.prototype.get=function(la){return na(la)&&$jscomp.owns(la,ca)?la[ca][this.id_]:void 0};fa.prototype.has=function(la){return na(la)&&$jscomp.owns(la,ca)&&$jscomp.owns(la[ca],this.id_)};fa.prototype.delete=function(la){return na(la)&&$jscomp.owns(la,ca)&&$jscomp.owns(la[ca],this.id_)?delete la[ca][this.id_]:!1};return fa},"es6","es3");
$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(r){function I(){if($jscomp.ASSUME_NO_NATIVE_MAP||!r||"function"!=typeof r||!r.prototype.entries||"function"!=typeof Object.seal)return!1;try{var fa=Object.seal({x:4}),la=new r($jscomp.makeIterator([[fa,"s"]]));if("s"!=la.get(fa)||1!=la.size||la.get({x:4})||la.set({x:4},"t")!=la||2!=la.size)return!1;var pa=la.entries(),Ca=pa.next();if(Ca.done||Ca.value[0]!=fa||"s"!=Ca.value[1])return!1;Ca=pa.next();return Ca.done||4!=Ca.value[0].x||"t"!=Ca.value[1]||!pa.next().done?
!1:!0}catch(Pa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(I())return r;var V=new WeakMap,na=function(fa){this.data_={};this.head_=ca();this.size=0;if(fa){fa=$jscomp.makeIterator(fa);for(var la;!(la=fa.next()).done;)la=la.value,this.set(la[0],la[1])}};na.prototype.set=function(fa,la){fa=0===fa?0:fa;var pa=S(this,fa);pa.list||(pa.list=this.data_[pa.id]=[]);pa.entry?pa.entry.value=la:(pa.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:fa,value:la},pa.list.push(pa.entry),this.head_.previous.next=pa.entry,this.head_.previous=pa.entry,this.size++);return this};na.prototype.delete=function(fa){fa=S(this,fa);return fa.entry&&fa.list?(fa.list.splice(fa.index,1),fa.list.length||delete this.data_[fa.id],fa.entry.previous.next=fa.entry.next,fa.entry.next.previous=fa.entry.previous,fa.entry.head=null,this.size--,!0):!1};na.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=ca();this.size=0};na.prototype.has=
function(fa){return!!S(this,fa).entry};na.prototype.get=function(fa){return(fa=S(this,fa).entry)&&fa.value};na.prototype.entries=function(){return xa(this,function(fa){return[fa.key,fa.value]})};na.prototype.keys=function(){return xa(this,function(fa){return fa.key})};na.prototype.values=function(){return xa(this,function(fa){return fa.value})};na.prototype.forEach=function(fa,la){for(var pa=this.entries(),Ca;!(Ca=pa.next()).done;)Ca=Ca.value,fa.call(la,Ca[1],Ca[0],this)};na.prototype[Symbol.iterator]=
na.prototype.entries;var S=function(fa,la){var pa=la&&typeof la;"object"==pa||"function"==pa?V.has(la)?pa=V.get(la):(pa=""+ ++ta,V.set(la,pa)):pa="p_"+la;var Ca=fa.data_[pa];if(Ca&&$jscomp.owns(fa.data_,pa))for(fa=0;fa<Ca.length;fa++){var Pa=Ca[fa];if(la!==la&&Pa.key!==Pa.key||la===Pa.key)return{id:pa,list:Ca,index:fa,entry:Pa}}return{id:pa,list:Ca,index:-1,entry:void 0}},xa=function(fa,la){var pa=fa.head_;return $jscomp.iteratorPrototype(function(){if(pa){for(;pa.head!=fa.head_;)pa=pa.previous;for(;pa.next!=
pa.head;)return pa=pa.next,{done:!1,value:la(pa)};pa=null}return{done:!0,value:void 0}})},ca=function(){var fa={};return fa.previous=fa.next=fa.head=fa},ta=0;return na},"es6","es3");$jscomp.findInternal=function(r,I,V){r instanceof String&&(r=String(r));for(var na=r.length,S=0;S<na;S++){var xa=r[S];if(I.call(V,xa,S,r))return{i:S,v:xa}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(r){return r?r:function(I,V){return $jscomp.findInternal(this,I,V).i}},"es6","es3");
var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var I={};I.id=r.id;I.server=r.id;I.displayName=r.displayName||r.id;if(r=r.rdp){for(var V in r)I[V]=r[V];I.user=r.username||"";I.pwd=r.password||"";I.useConsole=r.console||!1;I.legacyMode=r.leagacyMode||r.legacyMode||!1;I.server_bpp=r.color||16;I.exe=r.remoteProgram||"";I.args=r.remoteArgs||"";I.startProgram=0<I.exe.length?"app":I.command&&0<I.command.length?"shell":"noapp"}return I}
function Rdp2(r){r=svGlobal.util.getServerArgs(r);if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var I=r.gateway||"",V=0,na=0,S=16,xa=1==r.useSSL||"true"==r.useSSL||"on"==r.useSSL||null;r.width&&(V=parseInt(r.width,10));r.height&&(na=parseInt(r.height,10));r.color&&(S=parseInt(r.color,10));r.server_bpp&&(S=parseInt(r.server_bpp,10));r=hi5.browser.obj2url(r);null===xa&&(xa="https:"==location.protocol);return new Rdp((xa?"wss://":"ws://")+I+"/RDP?"+r,V,na,S)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(r,I,V,na){function S(a){return"on"==a||"true"==a||1==a}function xa(){var a=n.gateway;n.ongetgatewayaddress&&(a=n.ongetgatewayaddress(a));return a}function ca(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ta(a,b){a=ka[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function fa(){return L.displayName||L.server||L.symlink||L.id||"undefined"}function la(a){n.loadbalanceToken||
(n.loadbalanceToken=ka.loadbalanceTokenName?ka.loadbalanceTokenName+"="+a:"")}function pa(a,b,c){n.ontitlechange&&(a=n.ontitlechange(a,c));n.setTitle&&a&&(b=b||window,b.document.title=a)}function Ca(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return L.invitation||n.showMessage("15 bit color is not supported anymore."),!1;default:return!1}gb=a;b&&(Ma?Ma.postMessage({type:0,cmd:1,data:a}):Ga&&Ga.setColor(a));return!0}function Pa(a,b,c,e){Ka=a;La=b;$b=ac=0;bc=Ka-1;cc=La-1;Va&&(Ka=(L.waWidth||
hi5.browser.getScreenWidth())|0,La=(L.waHeight||hi5.browser.getScreenHeight())|0);L.minWidth&&Ka<L.minWidth&&(Ka=L.minWidth|0);L.minHeight&&La<L.minHeight&&(La=L.minHeight|0);Ka&=-4;La&=-4;svGlobal.logger.warn("resolution changed, w:"+Ka+" h:"+La);var d=Ka,g=La;sa?sa.resize(d,g):sa=new Bc(d,g);ia.setSize(Ka,La,Va?"hidden":null);if(c||Ka!=a||La!=b)Ma?Ma.postMessage({type:0,cmd:2,data:{w:Ka,h:La}}):Ga&&Ga.setResolution(Ka,La);if(n.onresolutionchange&&!e)n.onresolutionchange(a,b)}function wa(a){!cb&&
Ja&&(Ma?(dc.data=a,"string"!=typeof a?Ma.postMessage(dc,[a]):Ma.postMessage(dc)):Ga.writeRawInput(a))}function ub(a){switch(a){case "\r":break;case "\n":n.writeScancode(28);break;case "\t":n.writeScancode(15);break;default:wa("86"+a)}}function qb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),g=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=g?5:9;c=new Uint8Array(e+c);c[0]=a;if(g)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{g=b.name;for(var p=Math.min(g.length,8),J=0;J<p;J++)c[1+J]=g.charCodeAt(J)}c.set(d,e);wa(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Hb(a){if(n){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};n.displayMsg&&n.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(n.onerror)n.onerror(a)}}function Cc(a){if(n){var b=__svi18n.info[a];b||(b="info "+a);n.displayMsg&&n.showMessage(b);svGlobal.logger.info(b)}}function ec(){var a=Ja;rb=Ja=!1;
Ma?Ma.postMessage({type:0,cmd:3}):Ga&&Ga.resetStatus();a&&(Ja=a)}function fc(a){Oa||(Oa=new hi5.file.UploadManager(new hi5.file.WsFileService(wa)),Oa.addEvent("beforeupload",function(b,c,e){if(n.beforeupload)return n.beforeupload(b,c,e)}),Oa.addEvent("fileuploaded",function(b,c,e){if(n.onfileuploaded)n.onfileuploaded(b,c,e)}),Oa.addEvent("uploaded",function(b,c){if(n.onuploaded)n.onuploaded(b,c)}),Oa.addEvent("uploadingCancelled",function(){if(n.onuploadingCancelled)n.onuploadingCancelled()}));a.setFileHandler(Oa)}
function Dc(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ja&&(e=!0,wa("8C5"+d.exe+"\t"+d.args+"\t"+n.sessionInfo.appInfo.session))}}function Ad(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ec(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Ib(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function Bd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Fc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Gc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var g=[];e&1?g.push("usb"):e&2?g.push("nfc"):e&4?g.push("ble"):e&16?g.push("internal"):e&32&&g.push("hybrid");
d.transports=g}b.push(c)}}return b}function Fc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function Cd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function Dd(a,b){var c,e,d,g,p,J,B,F,H,w,y,v,u,W,x,Y,M,Q,O;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){if(1==qa.nextAddress){a.getPublicKeyAlgorithm();if((c=a.getTransports())&&0<c.length)for(var aa=$jscomp.makeIterator(c),
T=aa.next();!T.done;T=aa.next())T=T.value,"USB"==T.toUpperCase()||"NFC"==T.toUpperCase()||"BLE"==T.toUpperCase()||"INTERNAL"==T.toUpperCase()||T.toUpperCase();if(e=a.attestationObject)g=Ib(e),d=g.attStmt;if(p=a.clientDataJSON)J=window.origin,B=(new TextDecoder).decode(p),F=JSON.parse(B),F.origin&&(F.origin=J);H=a.getAuthenticatorData();if(!H)return qa.jumpTo(0);w=new Uint8Array(H);return b?(y=b.id)?qa.yield(Ed(y),5):qa.jumpTo(0):qa.jumpTo(0)}v=qa.yieldResult;u=new Uint8Array(v);W=new hi5.DataBuffer(new Uint8Array(w.byteLength));
W.setBytes(u);x=w.slice?w.slice(32,w.length):w.subarray(32,w.length);W.setBytes(x);W.markEnd();Y=W.getData();M={1:"packed",2:Y,3:d};Q=CBOR.encode(M);O=new hi5.DataBuffer(new Uint8Array(Q.byteLength+1));O.setByte(0);O.setBytes(Q);O.markEnd();return qa.return(O.getData())})}function Ed(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Fd(b))})}function Fd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==
c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function Gd(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}function Hd(a,b,c,e,d){gc.set(a,b);hc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=
b;c.innerHTML+="<br>";return c}function Id(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Hc(){var a="";L&&S(L.connectif)&&L.symlink&&"sessionStorage"in window&&(a="SV_"+L.symlink,L.domain&&(a+=L.domain),L.user&&(a+=L.user));return a}function Jd(){var a=window.localStorage.getItem(void 0)||"";a&&(a="&certHash="+a);var b=hi5.appcfg.persistentId?
window.localStorage:window.sessionStorage;if(!b)return a;var c=b.getItem("appInfo.session");if(!c)return a;a+="&_session="+c;(b=b.getItem("appInfo.numericId"))&&(a+="&_numericId="+b);return a}function Jb(){if(!Ja){rb=!1;var a="";cb?Ia.init(!1,!0,!1,0,!1,!1):a=n.getRuntimeURL();void 0==ka.wsPost&&(ka.wsPost=!1);n.oncreatewebsocket&&(Ma=null);Ma?(cb&&(cb.onopen=ic,cb.onclose=Ab,cb.onmessage=function(c){jc.data=c.data;Ma.postMessage(jc,[jc.data])}),Ma.postMessage({type:0,cmd:0,data:{addr:a,width:Ka,
height:La,server_bpp:gb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ka.wsPost}})):(Ga=new RdpGeneral(cb||a,Ka,La,gb,sa,!1,ka.wsPost),Ga.oncreatewebsocket=n.oncreatewebsocket,Ga.run());Ma?Ma.addEventListener("message",Ic,!1):(Ga.onopen=ic,Ga.onmessage=Jc,Ga.onclose=Ab,Ga.onerror=Hb,Ga.oninfo=Cc,Ga.onloggedin=kc,Ga.onresolutionchange=function(c,e){Pa(c,e,!1,L.monitorDef&&0<=L.monitor?!0:!1)},Ga.onAltSecWindows=Kc,Ga.onMoveCursor=lc,Ga.onCloseSurface=Lc,Ga.onColorChange=Ca,Ga.onHistoryReceived=function(){mc()},
Ga.onLockKeyState=function(c){if(n.onLockKeyState)n.onLockKeyState(c)});if(a=ia.getSurface(ia.size()-1))Va?a&&(a.remoteApp=new Dc(L.exe,L.args,"")):pa(fa(),a.getWindow());if(L.invitation&&!S(L.shadow)){var b=null;a&&(b=a.initChat(L.expert));Bb=new n.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,L.novice)};b&&(b.onchat=function(c){if(Ja){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();
Bb.send(e)}});n.addGatewayChannel(Bb)}}}function Ic(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:ic();break;case 1:Ab(a.expected);break;case 2:Hb(a.code);break;case 3:Cc(a.code);break;case 4:kc();break;case 5:Pa(a.w,a.h,!1,L.monitorDef&&0<=L.monitor?!0:!1);break;case 6:lc(a.x,a.y,!0);break;case 7:Lc();break;case 8:0==a.id&&mc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:Ca(a.color);break;case 10:if(n.onLockKeyState)n.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:sa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:sa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:sa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:sa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:sa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:sa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Mc(a);break;case 10:Jc(a);break;case 11:Ua.attach(a.data,0,a.data.length);Kc(Ua,a.size);
break;case 12:sa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:sa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:sa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:sa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:sa.putFont(a.font,a.character,a.glyph);break;case 17:sa.putCursor(a.idx,
a.cursor);break;case 18:sa.setCursor(a.idx);break;case 19:sa.getHistory(a.cmd,wa,function(b){Ma.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);sa.setHistory(a.order,Ua);break;case 21:sa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Nc(a){Qa&&Qa.check(a)}function ic(){Ja=!0;var a="87"+navigator.userAgent+"\t";Kb=hi5.tool.uuid();document.cookie=Kb+"=sv";wa(a+Kb);if(n.onopen)n.onopen();
ka.joinCloseMode&&n.setJoinCloseMode(ka.joinCloseMode)}function Lc(){ia&&ia.close()}function Jc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=kb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Da.tag=a.getLittleEndian16();Da.channels=a.getLittleEndian16();Da.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Da.bitsPerSample=
a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec);Ma&&Ma.postMessage({type:0,cmd:5,data:{tag:Da.tag,channels:Da.channels,samplePerSec:Da.samplePerSec,bitsPerSample:Da.bitsPerSample}});41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);nc(a,b,c,0);lb||(c+=Date.now()-e,wa("8A"+
b+","+c))}Qa&&Qa.check();break;case 56:Oc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Pc(Ua);break;case 62:Qc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Rc(Ua);Qa&&Qa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ia[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ia[b].newInstance?(Ia[a]=Ia[b].newInstance(),Ia[a].id=a):(Ia[b].id=a,Ia[a]=Ia[b]),Ia[a].onopen)Ia[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+
b+" id:"+a);break;case 3:Ia[a]&&Ia[a].process(b);break;case 4:if(Ia[a]&&Ia[a].onclose)Ia[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:Kd(Ua);break;default:if(n.onunknownmessage)n.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:wa("87"+navigator.userAgent);break;case 15:if(n){Lb=!1;vb=n.reconnectTimes;(n&&0==n.mode||S(L.connectif))&&mc();b="";for(b in mb)if((c=mb[b])&&c.onopen)c.onopen();
for(b in kb)if((c=kb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&n&&(n.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(n.onnotify)n.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&n.onerror)n.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;n.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ia.drawLicense(a);
break;case 50:if(Ja)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Ld(a);break;case 2:Cb?(Cb.type==a?n.writeRawInput("881"+a+"\t"+Cb.text):n.writeRawInput("881ERROR\t"),Cb=null):!(b=ia.getFocused())||b.processClipReq(a)||!ka.clipWarnAlways&&Sc||!L||L.leagacyMode||(n.showMessage(__svi18n.info.menucopy,null,5E3),Sc=!0);break;case 5:(b=ia.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ia.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=xa()+b[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+
a+" name:"+b[1]+" driver:"+b[2]);n.onprintingready&&n.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ia.getFocused())&&b.showPDF(a);break;case 56:Oc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ia.getWinById(parseInt(b[0]))){if(!ia.hasApp(b[1])){(c=ia.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(n.onremoteappstart)n.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&n.ontitlechange)n.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Md(a);break;case 59:a=hi5.Base64.dec(a,0);db=(new RdpBuffer(a,0,a.length)).getLittleEndian32();lb||!(db&16||db&65536)?(Mb=!1,Oa=null):(db&16&&(Mb=!0),Oa||(a=ia.getFocused())&&fc(a));db&64&&n.showMessage(__svi18n.info.recording);Oa&&(Oa.setUpload(!(db&128)),Oa.setDownload(!(db&131072)),Oa.canCopyFile=0!=(db&65536));ia.execute("setFeature",[db]);break;case 60:Pc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Pa(a.width,a.height,!0,!1);Ca(a.color);
(b=a.server)&&n&&(n.server=a.server);Tc=a.length;c=ia.getFocused();Va=1==a.isRail;c&&(1!=n.mode&&c.setAutoScale(!Va),b&&pa(fa(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Mb=!0,fc(c));if(n.onopened)n.onopened(a);break;case 1:a=a.duration;if(n.onprogress)n.onprogress(a,Tc);break;case 2:2==a.status?(ec(),Ja=!0):(b=0==a.status,b==sa.isPaused()||n.onsessionpause&&n.onsessionpause(b,a)||(sa&&sa.pause(b,void 0),b||ia.repaint(0,0,sa.width-1,sa.height-1),a.warn&&
n.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Qc(a);break;case 63:Rc(b64ToBuffer(a));break;default:if(n.onunknownmessage)n.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function mc(){if(!lb&&!Xa&&(Xa=!0,n&&(ka.pingInterval&&n.startPing(ka.pingInterval),n.onready)))n.onready()}function Kd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;wa(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();
0!=b||a&4||(db^=65536,ia.execute("setFeature",[db]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(n.onLockKeyState)n.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();n.sessionInfo.appInfo.twoFAEnabled=
0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);n.sessionInfo.appInfo.twoFAQR=a;n.ontwofaqr&&n.ontwofaqr(a)||2==b&&ia.execute("showTwoFAQR");break;case 1:sa&&sa.pause(!0,!0);if(n.ontwofacode&&n.ontwofacode())return;(a=ia.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!n.ontwofaresult||!n.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ia.getFocused()){c="image/png";switch(b){case 1:c=
"image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var g=new Uint8Array(2+d.length);g[0]=146;g[1]=8;g.set(d,2);wa(g.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Nd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var g=ia.getFocused();g&&Ja&&(g=g.getThumbnail(a))&&g.length!=d&&(wa("8E7"+g),d=g.length)},b))};this.stop=function(){clearInterval(c)}}function Od(a,
b){!$a||$a.width==a&&$a.interval==b||($a.stop(),$a=null);$a||($a=new Nd(a,b));$a.start()}function Rc(a){var b=a.getAscllString(8);(b=mb[b])&&b.process&&b.process(a)}function Qc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=n.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ec();Ja=!0;a=d.width;e=d.height;if(a==Ka&&e==La)break;Pa(a,e,!1,!1);break;case 1:d=JSON.parse(c);n.sessionInfo.joinedSessions.push(d.numericId);n.sessionInfo.joiners.push(d);e.sessions[d.numericId]=
d.name||d.__ip;if(!e.joined||ka.alertJoin)n.onsessionjoin&&(a=n.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&n.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);n.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=n.sessionInfo.joiners;c=0;for(var g=b.length;c<g;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ka.alertJoin)n.onsessionexit&&(a=n.onsessionexit(d)),!a&&__svi18n.info.exitsession&&
n.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ia.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;n.ongivecontrol&&(a=n.ongivecontrol());if(a)break;n.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ia.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=
!1;n.ontakebackcontrol&&(a=n.ontakebackcontrol());if(a)break;n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);n.onrequirecontrol&&(a=n.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;sa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));n.showMessage({title:a,msg:e,cbYes:function(){n.giveControl(d.numericId);this.destroy();sa.isPaused()&&n.pauseSession(n.sessionInfo.appInfo.numericId,!1)},cbNo:function(){n.refuseControl(d.numericId);
this.destroy()},html:!0});break;case 6:ia.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Pa(d.width,d.height,!0,L.monitorDef&&0<=L.monitor?!0:!1);d.color&&(Ca(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(n.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);Lb=!0;if(n.onrequestcredential&&n.onrequestcredential(d,Ra.reconnect))break;if(n.onautherror&&n.onautherror(d,Ra.reconnect))break;ia.getFocused().requestCredential(d,
Ra.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Od(d.width,d.interval):$a&&($a.stop(),$a=null);break;case 11:d=JSON.parse(c);n.onrequirejoin&&(a=n.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);n.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){n.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){n.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&kc();break;case 14:d=JSON.parse(c);
if(n.oncontrolchange)n.oncontrolchange(d);break;case 15:d=JSON.parse(c),Pd(d)}}function Pd(a){if("cert"==a.type){Lb=!0;var b=__svi18n.info.cert||"The certificate of remote connection could not be verified. Do you want to continue?<br>Target: %1,<br>Hash: %2";b=b.applyArgs([a.target,a.hash]);hi5.notifications.notify({msg:b,cbYes:function(){this.destroy();window.localStorage.setItem(void 0,a.hash);Jb()},cbNo:function(){this.destroy()},html:!0})}}function Pc(a){switch(a.getByte()){case 32:if(!sa.isPaused()){var b=
a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,g=void 0;ka.noCursorName||(d=a.getLittleEndian32(),n.sessionInfo.appInfo&&(g=n.sessionInfo.appInfo.sessions[d]));lc(c,e,!0,g,d,b)}}}function lc(a,b,c,e,d,g){sa.isPaused()||ia.getFocused().moveCursor(a,b,c,e,d,g)}function Mc(a){ia.setCursor(a)}function Qd(a){var b=ka.page&&ka.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");
if(b)return c.substring(0,e+1)+b;b=xa();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Oc(a){a=JSON.parse(a);oc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",oc),c.setItem("appInfo.numericId",b));la(a.appId);a.server||(a.server=fa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=n.mode&&ia.execute("setAutoScale",
[!0]):(n.mode=0,S(L.connectif)&&ia.setSize(Ka,La),ka.disableJoinedAppResize&&(n.windowState=0));var e=xa();b=Qd("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),n.protocol="http"==c.substring(0,e)?"ws":"wss",n.gateway=c,b+="&gateway="+encodeURIComponent(c));b=n.modifyURL(b);a.joinLink=b;n.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Pa(Ka,La,!0,!0),rb||1==n.mode||ia.execute("setAutoScale",[!0]));a.ver&&
a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ka.cursorNameOnly=a.isAssistance;if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function Md(a){if(Oa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Oa.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Oa.confirmId(c[0],c[1],c[2]);break;case 2:Oa.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Oa.close(c[0]);break;case 9:a='<a href="'+n.modifyURL(xa()+c[0])+'" download="'+
c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ia.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Oa.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function nc(a,b,c,e){if(!Rd||sa.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Da.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Da.tag)pc||(pc=new MSGSM),b=pc.decode(b,d,e),d=0,
e=b.length;var g=Da.bitsPerSample;var p=Math.floor(e/(g>>3));var J=c=e=0;a||(e=Math.pow(2,g-1)-1,c=-e-1,J=Math.pow(2,g));g=Da.channels;var B=Math.floor(p/g),F=Ta.getBuffer(B),H=F.getChannelData(0),w=F.getChannelData(1);p=0;if(a)for(;p<B;)1==g?w[p]=H[p]=b[d++]:(H[p]=b[d++],w[p]=b[d++]),p++;else for(;p<B;)a=b[d++]|b[d++]<<8,a>e?(a-=J,a/=-c):a/=e,1==g?H[p]=a:(H[p]=a,a=b[d++]|b[d++]<<8,a>e?(a-=J,a/=-c):a/=e),w[p]=a,p++;return Ta.playBuffer(F)}function Uc(a){if(!n.openLink||2E3<a.length)return!1;var b=
a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:n.onurlredirection&&n.onurlredirection(b)?!0:(a=ia.getFocused())?a.processLink(b):!1:!1}function Sd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=
a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=n.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Ld(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(n.onservercopy&&n.onservercopy(a)||Uc(a))){var b=ia.getFocused();b&&b.copyToClip(Sd(a))}setTimeout(function(){wa("883")},999)}}function kc(a){if(!rb&&(setTimeout(function(){Ja&&wa("884")},333),n.onloggedin))n.onloggedin();qc=rb=!0;a&&a.sessionId&&(n.sessionInfo.sessionId=a.sessionId);Va&&1!=
n.mode&&ia.execute("setAutoScale",[!1]);Oa&&(Oa.enabled=!0);Nb&&!Va&&(sa.setContext(ia.getFocused().context),ia.repaint(0,0,sa.width-1,sa.height-1))}function Ab(a){if(n){hi5.browser.cookie.delete(Kb);svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));n.onagentmessage&&(n.onagentmessage=null);if(n.onagentclose)n.onagentclose();var b=Hc();b&&n.sessionInfo.appInfo&&0==n.mode&&(sessionStorage[b]=n.sessionInfo.appInfo.session);if(n&&(b=1!=n.mode,!Ja&&b&&Hb("connection"),
b=b&&(Ja||vb<n.reconnectTimes)&&0<vb&&!a,Xa=Ja=!1,b)){vb--;__svi18n.info.reconnecting&&n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-vb)+"/"+n.reconnectTimes,null,3E3);setTimeout(Jb,ka.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+vb);return}if(Lb)svGlobal.logger.info("No release");else{Qa&&(n.stopPing(),Qa=null);Ma&&(Ma.removeEventListener("message",Ic,!1),Ma.postMessage({type:0,cmd:4}),Ma.terminate(),Ma=null);Oa&&(Oa.release(),Oa=null);Sa=r=null;Ia&&(Ia.close(),
Ia=null);mb&&hi5.Arrays.release(mb);kb&&hi5.Arrays.release(kb);$a&&($a.stop(),$a=null);Ta&&(Ta.close(),Ta=null);n.player&&(n.player=null);Db=null;try{if(n.onclose)n.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ia&&(ia.close(),ia=null)}catch(c){svGlobal.logger.warn(c)}Ua=null;Ga&&(Ga.onopen=null,Ga.onmessage=null,Ga.onclose=null,Ga.onerror=null,Ga.close(),Ga=null);ia=Ra=null;sa&&(sa.release(),sa=null);hi5.browser.isChromeApp?
chrome.runtime.onSuspend.removeListener(n.close):window.removeEventListener("unload",n.close,!1);window&&window.$rdp==n&&(window.$rdp=null);n=null}}}function Vc(){Ga&&Ja?Ga.close():Ab(!0)}function Kc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),g=0;16>c&&(g=a.getLittleEndian16());var p=a.getLittleEndian16(),J=a.getLittleEndian16();a.getBytes(p);g&&
a.getBytes(g);if(8<=c&&(g=ia.getFocused())&&g.onremoteappicon){p=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();J=d+J;var B;a=a.getData();for(var F=0,H,w;d<J;)switch(c){case 16:(B=a[d++]|a[d++]<<8)?(w=B>>7&248,H=B>>2&248,B=B<<3&248,w|=w>>5,H|=H>>5,B|=B>>5,e[F++]=B,e[F++]=H,e[F++]=w,e[F++]=255):F+=4;break;case 32:e[F++]=a[d++],e[F++]=a[d++],e[F++]=a[d++],e[F++]=a[d++]}p.putPixels(e,0,e.length);a=ia.getWinById(b);g.onremoteappicon(a,p)}}else 0!=(c&2147483648)?
svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ia.delWin(b)):Td(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((g=ia.getOwnerSurfaceById(b))&&
g.railWin&&g.railWin.setActiveWinId(b,3==ka.windowState),ia.setTitle(b),sa.getContext()||(b=ia.getFocused())&&sa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ia.zOrders,c.length=b,g=0;g<b;g++)c[g]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[g])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Wc(a){var b=ia.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),
Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Td(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ia.getWinById(c);d?e=!0:d=new ia.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+
d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=
(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),
svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var g=d.showState;(2==g&&0!=ka.noMinimize||!e&&3==g&&5==ka.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(g=0!=(b&4)){var p=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(p,
!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=
a.getLittleEndian32());if(0!=(b&2048)){p=a.getLittleEndian32();var J=a.getLittleEndian32();d.winOffsetX=p;d.winOffsetY=J;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==n.windowState?Wc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(p=ia.getFocused())){p=p.getFreeSpace();var B=d.winWidth,F=d.winHeight;if(d.winOffsetX>p.width||d.winOffsetY>p.height||0>B+d.winOffsetX||0>F+d.winOffsetY){var H=(p.width-d.winWidth)/2|0,w=(p.height-d.winHeight)/2|0;0>H&&(H=0);0>w&&(w=0);setTimeout(function(){d.resize(H,w,B,F)},50)}}0!=(b&256)&&(p=a.getLittleEndian16(),0<p&&a.skipPosition(8*p));0!=(b&
4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ia.onWinChange(d);else ia.addWin(d);g&&ia.setTitle(c);c==ia.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ia.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function Bc(a,b){function c(h,l,k,f,q){0<q.width?q.union(h,l,k,f):(q.x=h,q.y=l,q.width=k,q.height=f)}function e(h,
l,k,f){for(da=0;da<ea;da++){var q=T[da];if(h>=q[0]&&l>=q[1]&&k<=q[2]&&f<=q[3])return E[da]}return null}function d(h,l,k,f){if(ea){var q=e(h,l,h+k-1,l+f-1);q&&c(h,l,k,f,q)}else c(h,l,k,f,W)}function g(h,l,k,f,q,t,A){for(var C=q*k+f,z=h.setRGB,X=h.getRGB,K=0;K<A;K++){for(var m=0;m<t;m++){if(h){var D=X(f+m,q+K);z(f+m,q+K,~D&16777215)}else l[C]=~l[C]&16777215;C++}C+=k-t}}function p(h,l,k,f,q,t,A,C,z,X){l=X*C+z;null==A&&(A=h);for(h=0;h<t;h++){for(z=0;z<q;z++)v[f+h][k+z]=v[f+h][k+z]&A[l]&16777215|4278190080,
l++;l+=C-q}}function J(h,l,k,f,q,t,A,C,z,X){l=X*C+z;z=h.setRGB;X=h.getRGB;null==A&&(A=h);for(h=0;h<t;h++){for(var K=0;K<q;K++){var m=X(k+K,f+h);z(k+K,f+h,m|A[l]&16777215);l++}l+=C-q}}function B(h,l,k,f){var q=ja;if(q){var t=q.getRGB(l,k);switch(h){case 0:q.setRGB(l,k,0);break;case 1:q.setRGB(l,k,~(t|f)&16777215);break;case 2:q.setRGB(l,k,t&~f&16777215);break;case 3:q.setRGB(l,k,~f&16777215);break;case 4:q.setRGB(l,k,16777215*(~t&f));break;case 5:q.setRGB(l,k,~t&16777215);break;case 6:q.setRGB(l,k,
t^f&16777215);break;case 7:q.setRGB(l,k,~t&f&16777215);break;case 8:q.setRGB(l,k,t&f&16777215);break;case 9:q.setRGB(l,k,t^~f&16777215);break;case 10:break;case 11:q.setRGB(l,k,t|~f&16777215);break;case 12:q.setRGB(l,k,f);break;case 13:q.setRGB(l,k,(~t|f)&16777215);break;case 14:q.setRGB(l,k,t|f&16777215);break;case 15:q.setRGB(l,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+h),q.setRGB(l,k,f)}}}function F(h,l,k,f,q,t,A,C,z){h>C||l>z||(k=h+k-1,k>C&&(k=C),h<t&&(h=t),k=
k-h+1,f=l+f-1,f>z&&(f=z),l<A&&(l=A),f=f-l+1,1>k||1>f||ja.fillRect(h,l,k,f,q))}function H(h,l,k,f,q,t,A,C,z,X,K,m){if(!(l>K||k>m)){var D=l+f-1;D>K&&(D=K);z=l<z?z:l;D=D-l+1;K=k+q-1;K>m&&(K=m);X=k<X?X:k;m=K-k+1;if(!(1>D||1>m)){K=128;var G=0;A|=4278190080;C|=4278190080;if(z==l&&X==k&&D==f&&m==q)if(0==h)for(var N=0;N<q;N++){h=k+N;for(var ba=0;ba<f;ba++)0==K&&(G++,K=128),0!=(t[G]&K)&&(v[h][l+ba]=C),K>>=1;G++;K=128;G==t.length&&(G=0)}else for(N=0;N<q;N++){h=k+N;for(ba=0;ba<f;ba++)0==K&&(G++,K=128),v[h][l+
ba]=0!=(t[G]&K)?C:A,K>>=1;G++;K=128;G==t.length&&(G=0)}else if(0==h)for(N=0;N<m;N++){h=k+N;for(ba=0;ba<D;ba++)0==K&&(G++,K=128),l+ba>=z&&h>=X&&0!=(t[G]&K)&&(v[h][l+ba]=C),K>>=1;G++;K=128;G==t.length&&(G=0)}else for(N=0;N<m;N++){h=k+N;for(ba=0;ba<D;ba++)0==K&&(G++,K=128),l+ba>=z&&k+N>=X&&(v[h][l+ba]=0!=(t[G]&K)?C:A),K>>=1;G++;K=128;G==t.length&&(G=0)}}}}function w(h,l,k,f,q){this.offset=h;this.baseLine=l;this.width=k;this.height=f;this.fontData=q}function y(h,l,k,f,q,t,A,C,z){this.cache_idx=h;this.rawData=
l;this.none=!l;this.hotX=k;this.hotY=f;this.width=q;this.height=t;this.xorSize=C;this.andSize=z;this.result="";this.distance=0;this.bpp=A;this.system="";if(l){if(!this.distance){h=0;if(l){A=0;for(var X=l.length;A<X;A++)0!=l[A]&&(h+=A%q+(A/q|0))}this.distance=h}if(!this.system){a:switch(this.distance){case 507:h="text";break a;case 2046:case 4359:h="default";break a;default:h=""}this.system=h}}h="";if(!this.system&&l){A=q*t*4;h=62+A+C+z;X=new Uint8Array(h);h=new hi5.DataBuffer(X,0,h);h.setLittleEndian16(0);
h.setLittleEndian16(2);h.setLittleEndian16(1);h.setByte(q);h.setByte(t);h.setByte(0);h.setByte(0);h.setLittleEndian16(k);h.setLittleEndian16(f);h.setLittleEndian32(40+A+C+z);h.setLittleEndian32(22);h.setLittleEndian32(40);h.setLittleEndian32(q);h.setLittleEndian32(2*t);h.setLittleEndian16(1);h.setLittleEndian16(32);h.setLittleEndian32(0);h.setLittleEndian32(C+z);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);for(k=t-1;0<=k;k--)for(f=0;f<q;f++)t=l[q*k+f],
h.setByte(t&255),h.setByte(t>>8&255),h.setByte(t>>16&255),h.setByte(t>>24&255);h="data:image/x-icon;base64,"+hi5.Base64.enc(h.getData())}this.url=h}var v=[],u=null,W=new hi5.graphic.Rectangle(0,0,0,0),x="Uint8ClampedArray"in window,Y=null,M=0,Q=0,O=0,qa=0,aa=null,T,E,da=0,ea=0;this.width=a;this.height=b;var U=!1,ja=this,Z={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(h){Y=h};this.getDirtyArea=function(){return W};this.setImgRect=function(h,l,k,f){M=h;Q=l;O=k;qa=f};this.parseMonitorDef=
function(h){var l=h.split(","),k=l.length,f=[];if(1<k){for(var q=!1,t=0;t<k;t++){var A=l[t].split(":");if(4==A.length)f[t]=Array(5),f[t][0]=parseInt(A[0]),f[t][1]=parseInt(A[1]),f[t][2]=parseInt(A[2]),f[t][3]=parseInt(A[3]),f[t][4]=0==f[t][0]&&0==f[t][1]?1:0;else{q=!0;break}}q&&(svGlobal.logger.warn("invaiid monitorDef:"+h),f.length=0)}return f};this.setMonitorLayout=function(h){var l=h.length,k=0;T=h;for(E=Array(l);k<l;k++)E[k]=new hi5.graphic.Rectangle(0,0,0,0);ea=l};this.setMonitorCount=function(h){ea=
h};this.addImg=function(h){O&&(aa&&URL.revokeObjectURL(aa.src),aa=h)};this.flushImgs=function(){aa&&(URL.revokeObjectURL(aa.src),aa=null,O=0)};this.getData=function(){return v};this.pause=function(h,l){U=h;l&&u&&u.fillRect(0,0,a,b)};this.release=function(){W=null;hi5.Arrays.release(E);ja.flushImgs();v=u=ja=null;Z=Z.imgData=null};this.isPaused=function(){return U};this.setContext=function(h){h!=u&&(u||!h||h.createImageData(1,1).data.buffer||(x=!1),u=h,null!=u&&(Z.imgData=u.createImageData(a,b)))};
this.getContext=function(){return u};this.resize=function(h,l){if(v.length!=l||v[0].length!=h){for(var k=0;k<l;k++)v[k]=new Uint32Array(h);v.length=l;ja.width=a=h;ja.height=b=l;null!=u&&(Z.imgData=u.createImageData(a,b))}};ja.resize(a,b);this.getBuffer=function(){return v};this.setRGB=function(h,l,k){v[l][h]=k|4278190080};this.getRGB=function(h,l){return v[l][h]};this.setRGBs=function(h,l,k,f,q,t,A){var C=h+k,z=l+f;z>b&&(z=b);if(!(h>=a)){C>a&&(k-=C-a);for(C=l;C<z;C++,t+=A)v[C].set(q.subarray(t,t+
k),h);d(h,l,k,f)}};this.moveArea=function(h,l,k,f,q,t){if(0<t){var A=h+q,C=l+t,z;for(z=f-1;0<=z;z--)v[C+z].set(v[l+z].subarray(h,h+k),A)}else if(0>t)for(A=h+q,C=l+t,z=0;z<f;z++)v[C+z].set(v[l+z].subarray(h,h+k),A);else if(0<q){A=h+q;C=l+t;var X;for(z=k-1;0<=z;z--){var K=A+z;var m=h+z;for(X=0;X<f;X++)v[C+X][K]=v[l+X][m]}}else for(A=h+q,C=l+t,z=0;z<k;z++)for(K=A+z,m=h+z,X=0;X<f;X++)v[C+X][K]=v[l+X][m];d(h+q,l+t,k,f)};this.getRGBs=function(h,l,k,f,q){var t=new Uint32Array(k*f),A=h+k;f=l+f;for(var C=
0;l<f;l++)t.set(v[l].subarray(h,A),C),C+=k;return q?(q(t),null):t};this.repaint=function(h,l,k,f){var q=Z.imgData.data,t=0,A,C;Y&&Y.begin("paint");0>h&&(k+=h,h=0);0>l&&(f+=l,l=0);h+k>a&&(k=a-h);l+f>b&&(f=b-l);var z=h+k;var X=l+f;if(x)for(q=new Uint32Array(q.buffer),C=l;C<X;C++)q.set(v[C].subarray(h,z),t),t+=a;else{var K=4*(a-k)|0;for(C=l;C<X;C++){for(A=h;A<z;A++){var m=v[C][A];q[t++]=m&255;q[t++]=m>>8&255;q[t++]=m>>16&255;q[t++]=255}t+=K}}Z.left=h;Z.top=l;Z.width=k;Z.height=f;Y&&Y.end("paint");return Z};
this.postPaint=d;this.draw=function(h,l,k,f){if(!U&&u)if(aa&&aa.complete&&(u.drawImage(aa,M,Q,O,qa),URL.revokeObjectURL(aa.src),aa=null),ea){if(h=e(h,l,k,f),h.width)return ja.repaint(h.x,h.y,h.width,h.height),h.width=0,Z}else if(W.width)return ja.repaint(W.x,W.y,W.width,W.height),W.width=0,Z;return null};this.fillRect=function(h,l,k,f,q){var t=h+k,A=l+f;if(v[0].fill)for(var C,z=l;z<A;z++)v[z].fill(q,h,t);else for(z=l;z<A;z++)for(C=h;C<t;C++)v[z][C]=q;d(h,l,k,f)};this.drawLine=function(h,l,k,f,q){if(l==
f){if(h>k){var t=h;h=k;k=t}var A=v[l];k++;if(A.fill)A.fill(q,h,k);else for(t=h;t<k;t++)A[t]=q}else if(h==k)for(l>f&&(t=l,l=f,f=t),f++,t=l;t<f;t++)v[t][h]=q;else{var C=Math.abs(k-h),z=Math.abs(f-l);t=h;A=l;k=k>=h?h=1:h=-1;l=f>=l?f=1:f=-1;if(C>=z){l=h=0;var X=C;var K=C/2|0;var m=z}else f=k=0,X=z,K=z/2|0,m=C,C=z;if(!(1>C))for(C++,z=0;z<C;z++)v[A][t]=q,K+=m,K>=X&&(K-=X,t+=h,A+=f),t+=k,A+=l}};this.bitBlt=function(h,l,k,f,q,t,A,C,z,X){var K=ja;switch(h){case 0:C=K.setRGB;for(K=k;K<k+q;K++)for(z=f;z<f+t;z++)C(K,
z,0);break;case 1:h=A;z=X*C+z;X=K.setRGB;l=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(A=0;A<q;A++)X(k+q,f+t,~(l(k+q,f+t)|h[z])&16777215);z+=C-q}break;case 2:h=A;z=X*C+z;X=K.setRGB;l=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(A=0;A<q;A++){var m=l(k+q,f+t);X(k+q,f+t,m&~h[z]&16777215);z++}z+=C-q}break;case 3:g(K,A,C,z,X,q,t);A?K.setRGBs(k,f,q,t,A,X*C+z,C):K.moveArea(z,X,q,t,k-z,f-X);break;case 4:g(K,null,l,k,f,q,t);p(K,l,k,f,q,t,A,C,z,X);break;case 5:g(K,null,l,k,f,q,t);break;case 6:h=A;z=X*C+z;
null==h&&(h=K);for(K=0;K<t;K++){for(X=0;X<q;X++)v[f+K][k+X]=v[f+K][k+X]^h[z]&16777215|4278190080,z++;z+=C-q}break;case 7:h=A;z=X*C+z;X=K.setRGB;l=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(A=0;A<q;A++)m=l(k+A,f+K),X(k+A,f+K,~(m&h[z])&16777215),z++;z+=C-q}break;case 8:p(K,l,k,f,q,t,A,C,z,X);break;case 9:h=A;z=X*C+z;X=K.setRGB;l=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(A=0;A<q;A++)m=l(k+A,f+K),X(k+A,f+K,m^~h[z]&16777215),z++;z+=C-q}break;case 10:break;case 11:h=A;z=X*C+z;X=K.setRGB;l=K.getRGB;
null==h&&(h=K);for(K=0;K<t;K++){for(A=0;A<q;A++)m=l(k+A,f+K),X(k+A,f+K,m|~h[z]&16777215),z++;z+=C-q}break;case 12:A?K.setRGBs(k,f,q,t,A,X*C+z,C):K.moveArea(z,X,q,t,k-z,f-X);break;case 13:g(K,null,l,k,f,q,t);J(K,l,k,f,q,t,A,C,z,X);break;case 14:J(K,l,k,f,q,t,A,C,z,X);break;case 15:C=K.setRGB;for(K=k;K<k+q;K++)for(z=f;z<f+t;z++)C(K,z,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+h)}d(k,f,q,t)};this.drawLineExt=function(h,l,k,f,q,t){if(h==k||l==f){var A;if(l==f)if(k>h){var C=k-
h;if(!(1>C))for(A=0;A<C;A++)B(t,h+A,l,q)}else{if(C=h-k,!(1>C))for(A=0;A<C;A++)B(t,k+A,l,q)}else if(f>l){if(C=f-l,!(1>C))for(A=0;A<C;A++)B(t,h,l+A,q)}else if(C=l-f,!(1>C))for(A=0;A<C;A++)B(t,h,f+A,q)}else{var z=Math.abs(k-h),X=Math.abs(f-l);A=h;C=l;var K,m;var D=k>=h?K=1:K=-1;var G=f>=l?m=1:m=-1;if(z>=X){G=K=0;var N=z;var ba=z/2>>0;var oa=X}else m=D=0,N=X,ba=X/2>>0,oa=z,z=X;if(1>z)return;for(X=0;X<=z;X++)B(t,A,C,q),ba+=oa,ba>=N&&(ba-=N,A+=K,C+=m),A+=D,C+=G}q=Math.min(h,k);h=Math.max(h,k);k=Math.min(l,
f);l=Math.max(l,f);0>h-q||0>l-k||d(q,k,h-q+1,l-k+1)};this.drawText=function(h,l,k,f,q,t,A,C,z,X,K,m,D,G,N,ba,oa,ua,Aa,Fa,Ba){var ya=0;1<m?F(X,K,m,D,q,ua,Aa,Fa,Ba):1==k&&F(t,A,C,z,q,ua,Aa,Fa,Ba);for(var Ha=ba,va=0;va<ba;)switch(oa[ya+va]){case 255:var za=oa[ya+va+2];if(za>Ha-ya){va=ba=0;break}za=oa.slice?oa.slice(ya,ya+za):oa.subarray(ya,ya+za);P[oa[ya+va+1]]=za;va+=3;ba-=va;ya=va;va=0;break;case 254:var Na=(za=P[oa[ya+va+1]])?za:null;Na&&0==Na[1]&&0==(l&32)&&(0!=(l&4)?N+=oa[ya+va+2]:G+=oa[ya+va+2]);
va=va+2<ba?va+3:va+2;ba-=va;ya=va;va=0;if(!Na)break;for(var Ya=Na.length,Za=0;Za<Ya;Za++){za=ma.getFont(h,Na[Za]);if(0==(l&32)){var Wa=Na[++Za];0!=(Wa&128)?(0!=(l&4)?N+=Na[Za+1]|Na[Za+2]<<8:G+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(l&4)?N+=Wa:G+=Wa}za&&(H(k,G+za.offset&65535,N+za.baseLine&65535,za.width,za.height,za.fontData,q,f,ua,Aa,Fa,Ba),0!=(l&32)&&(G+=za.width))}break;default:za=ma.getFont(h,oa[ya+va]),0==(l&32)&&(Wa=oa[ya+ ++va],0!=(Wa&128)?(0!=(l&4)?N+=oa[ya+va+1]|oa[ya+va+2]<<8:G+=oa[ya+va+1]|oa[ya+
va+2]<<8,va+=2):0!=(l&4)?N+=Wa:G+=Wa),za&&(H(k,G+za.offset&65535,N+za.baseLine&65535,za.width,za.height,za.fontData,q,f,ua,Aa,Fa,Ba),0!=(l&32)&&(G+=za.width)),va++}1<m?0<D&&d(X,K,m,D):0<C&&0<z&&d(t,A,C,z)};this.drawBitmap=function(h,l,k,f,q,t,A,C,z){var X=Ea.getBitmap(h,l);X?(h=X.width,l=X.height,q>h&&(q=h),t>l&&(t=l),12==z?ja.setRGBs(k,f,q,t,X.data,C*h+A,h):ja.bitBlt(z,a,k,f,q,t,X.data,h,A,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+h+" idx="+l)};this.saveDesktop=function(h,l,
k,f,q){ja.getRGBs(h,l,k,f,function(t){R.save(h,l,k,f,q,t)})};this.restoreDesktop=function(h,l,k,f,q){(q=R.restore(h,l,k,f,q))?ja.setRGBs(h,l,k,f,q,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(h,l,k){ma.putFont(h,l,k)};this.putBitmap=function(h,l,k){Ea.putBitmap(h,l,k)};this.putCursor=function(h,l){ra.set(h,l)};this.setCursor=function(h){if(!U&&-1!=h){var l=ra.get(h);if(l)ja.onSetCursor(l);else svGlobal.logger.warn("invalid cursor"+h)}};var ha=0;this.isSendingHistory=
function(){return 2E3>Date.now()-ha};this.getHistory=function(h,l,k){var f=null;(f=ra.toPDU(h))&&l(f.buffer);if(ja.onGetGfxHistory)ja.onGetGfxHistory(h,l,k);else{Y&&Y.begin("his_bitmap");Ea.forEach(function(z,X,K){if(z){var m=0,D=0;K=0;for(var G=z.length;K<G;K++)z[K]&&z[K].data&&(m++,D+=z[K].raw?z[K].raw.length:4*z[K].data.length);if(m&&D){f=new Uint8Array(D+20*m+8);f[0]=h;f[2]=1;f[3]=4;D=new hi5.DataBuffer(f,4,f.length);D.setLittleEndian32(m);for(K=0;K<G;K++)(m=z[K])&&m.data&&(D.setLittleEndian16(X),
D.setLittleEndian16(K),D.setLittleEndian16(m.left),D.setLittleEndian16(m.top),D.setLittleEndian16(m.width),D.setLittleEndian16(m.height),D.setLittleEndian16(m.bitsperpixel),D.setLittleEndian16(m.codec),D.setLittleEndian32(m.raw?m.raw.length:4*m.data.length),D.setBytes(m.raw||new Uint8Array(m.data.buffer)));l(f.buffer)}}});Y&&Y.end("his_bitmap");Y&&Y.begin("his_font");(f=ma.toPDU(h))&&l(f.buffer);Y&&Y.end("his_font");for(var q=4,t=0,A=P.length;t<A;t++)P[t]&&(q+=P[t].length+6);if(4<q){f=new Uint8Array(q);
f[0]=h;f[2]=1;f[3]=7;var C=4;t=0;for(A=P.length;t<A;t++)P[t]&&P[t].length&&(f[C++]=t,f[C++]=t>>8,q=P[t].length,f[C++]=q,f[C++]=q>>8,f[C++]=q>>16,f[C++]=q>>24,f.set(P[t],C),C+=q);l(f.buffer)}(f=R.toPDU(h))&&l(f.buffer);k(h);ha=Date.now()}};this.onHistoryDone=function(){ja.onGetGfxHistory&&n.reconnect(a,b,!0)};this.setHistory=function(h,l){svGlobal.logger.info("setHistory type:"+h);switch(h){case 4:Y&&Y.begin("his_bitmap_dec");var k=l.getLittleEndian32();for(h=0;h<k;h++){var f=l.getLittleEndian16(),
q=l.getLittleEndian16(),t=l.getLittleEndian16(),A=l.getLittleEndian16(),C=l.getLittleEndian16(),z=l.getLittleEndian16(),X=l.getLittleEndian16(),K=l.getLittleEndian16(),m=l.getLittleEndian32(),D=new Uint8Array(l.getData().buffer,l.getPosition(),m),G=new Uint8Array(m);G.set(D);D=rdpcodecs.bitmap;switch(K){case 0:var N=new Uint32Array(G.buffer);l.skipPosition(m);break;case 1:switch(X){case 16:N=D.decompressInt16(C,z,m,G,0);break;case 24:N=D.decompressInt24(C,z,m,G,0);break;case 32:N=D.decompressInt32(C,
z,m,G,0)}l.skipPosition(m);break;case 2:N=new rdpcodecs.NSCodec,N.process(l,X,C,z),m=N.getData(),N=N.getDataSize(),N=new Uint32Array(N),rdpcodecs.flipimage(m,0,N,C,z,1)}Ea.putBitmap(f,q,new rdpcodecs.Bitmap(N,C,z,t,A,X,0==K?null:G,K))}Y&&Y.end("his_bitmap_dec");break;case 5:ma.fromStream(l);break;case 6:ra.fromStream(l);break;case 7:for(;l.has(6);)if(h=l.getLittleEndian16(),m=l.getLittleEndian32())k=l.getData().subarray(l.getPosition(),l.getPosition()+m),P[h]=k,l.skipPosition(m);break;case 9:R.fromStream(l);
break;default:if(ja.onSetGfxHistory)ja.onSetGfxHistory(h,l)}};var ra=new function(){var h=[],l=!1;this.useRemoteCursor=function(k){l=k};this.set=function(k,f){l&&(f.system="");h[k]=f};this.get=function(k){return h[k]};this.total=function(){return h.length};this.toPDU=function(k){for(var f=2,q=2,t=0,A=0,C=h.length,z;A<C;A++)if(z=h[A])t++,q=q+7+(z.rawData?z.rawData.length:0);if(!t)return null;q=new Uint32Array(q);q[0]=30==k?100728862:100728861;q[1]=t;for(A=0;A<C;A++)if(z=h[A])if(k=z.rawData?z.rawData.length:
0,q[f++]=z.cache_idx|z.bpp<<16,q[f++]=z.hotX|z.hotY<<16,q[f++]=z.width|z.height<<16,q[f++]=z.xorSize,q[f++]=z.andSize,q[f++]=z.distance,q[f++]=k)q.set(z.rawData,f),f+=k;return q};this.fromStream=function(k){var f=k.getPosition();k=new Uint32Array(k.getData().buffer,f);var q=k[0],t=0;for(f=1;t<q;t++){var A=k[f]&65535;var C=k[f++]>>16;var z=k[f]&65535;var X=k[f++]>>16;var K=k[f]&65535;var m=k[f++]>>16;var D=k[f++];var G=k[f++];var N=k[f++];var ba=k[f++];var oa=null;ba&&(oa=new Uint32Array(ba),oa.set(k.subarray(f,
f+ba)),f+=ba);C=new y(A,oa,z,X,K,m,C,D,G);N&&(C.distance=N);l&&(C.system="");h[A]=C}}};ra.useRemoteCursor(!!ka.remoteCursor);var R=new function(){function h(k,f,q,t,A,C){this.x=k;this.y=f;this.cx=q;this.cy=t;this.offset=A;this.data=C}var l=[];this.save=function(k,f,q,t,A,C){k=new h(k,f,q,t,A,C);f=0;for(q=l.length;f<q;f++)if(!l[f]){l[f]=k;return}l.push(k)};this.restore=function(k,f,q,t,A){for(var C,z=0,X=l.length;z<X;z++)if((C=l[z])&&C.x==k&&C.y==f&&C.cx==q&&C.cy==t){if(C.offset==A)return k=C.data,
l[z]=null,k;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(k){for(var f=0,q=2,t=0,A=l.length;t<A;t++)l[t]&&(f++,q+=l[t].data.length+6);if(!f||!q)return null;q=new Uint32Array(q);var C=2;q[0]=30==k?151060510:151060509;q[1]=f;for(t=0;t<A;t++)if(k=l[t])q[C++]=k.x,q[C++]=k.y,q[C++]=k.cx,q[C++]=k.cy,q[C++]=k.offset,q[C++]=k.data.length,q.set(k.data,C),C+=k.data.length;return q};this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());for(var f=1,q=k[0],t,
A,C,z,X,K,m,D=0;D<q;D++)t=k[f++],A=k[f++],C=k[f++],z=k[f++],X=k[f++],K=k[f++],m=new Uint32Array(K),K=f+K,m.set(k.subarray(f,K)),f=K,this.save(t,A,C,z,X,m)}},P=[],ma=new function(){var h=[];this.putFont=function(l,k,f){h[l]||(h[l]=[]);h[l][k]=f};this.getFont=function(l,k){return h[l]?h[l][k]:null};this.toPDU=function(l){var k=0,f,q,t;var A=4;for(var C,z=h.length;k<z;k++)if((t=h[k])&&t.length)for(C=t.length,f=0;f<C;f++)(q=t[f])&&(A+=15+q.fontData.length);if(5>A)return null;var X=new Uint8Array(A);A=
new hi5.DataBuffer(X,0,A);X[0]=l;X[2]=1;X[3]=5;A.skipPosition(4);k=0;for(z=h.length;k<z;k++)if((t=h[k])&&t.length)for(C=t.length,f=0;f<C;f++)if(q=t[f])A.setByte(k),A.setLittleEndian16(f),A.setLittleEndian16(q.offset),A.setLittleEndian16(q.baseLine),A.setLittleEndian16(q.width),A.setLittleEndian16(q.height),A.setLittleEndian32(q.fontData.length),A.setBytes(q.fontData);return X};this.fromStream=function(l){for(;l.has(15);){var k=l.getByte(),f=l.getLittleEndian16(),q=l.getLittleEndian16(),t=l.getLittleEndian16(),
A=l.getLittleEndian16(),C=l.getLittleEndian16(),z=l.getLittleEndian32();z=l.getBytes(z);this.putFont(k,f,new w(q,t,A,C,z))}}},Ea=new function(){var h=[],l=[];this.putBitmap=function(k,f,q){if(32767==f)l[k]&&(l[k].data=null,l[k]=null),l[k]=q;else{var t=h[k];t?t[f]&&(t[f].data=null,t[f]=null):h[k]=t=[];t[f]=q}};this.getBitmap=function(k,f){return 32767==f?l[k]:h[k]?h[k][f]:null};this.forEach=function(k){for(var f=h.length,q=0;q<f;q++)k(h[q],q,h)}}}function Ob(a){function b(m,D,G){D[G]=m>>24&255;D[G+
1]=m>>16&255;D[G+2]=m>>8&255;D[G+3]=m&255}function c(m,D){var G=m.length;D=new Uint8Array(D?G+1:G);for(var N=0;N<G;N++)D[N]=m.charCodeAt(N);return D}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),g={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},
p=this,J=1,B=a?48E3:9E4,F=1,H=!1,w=null;this.initTypes=function(){for(var m in g)g[m]=[m.charCodeAt(0),m.charCodeAt(1),m.charCodeAt(2),m.charCodeAt(3)];g.url=[117,114,108,32]};p.initTypes();this.reset=function(){H=!1;F=J=1};this.close=function(){p&&(p.reset(),p=null)};this.remux=function(m){m.id=J;m.isAudio=a;m.timeScale=a?m.audioHeader.sampleRate:B;if(!H){var D=new v(a),G=new u(m);w=new Uint8Array(D.data.length+G.data.length);w.set(D.data,0);w.set(G.data,D.data.length);H=!0}m.sequenceNumber=F++;
D=new q(m);G=new K(m);m=new Uint8Array(D.data.length+G.data.length);m.set(D.data,0);m.set(G.data,D.data.length);w&&(D=new Uint8Array(w.length+m.length),D.set(w,0),D.set(m,w.length),m=D,w=null);if(p.ondata)p.ondata(m)};var y=function(m){this.type=m;this.data=null};y.prototype.setData=function(){var m=Array.prototype.slice.call(arguments,0),D=m.length,G=8,N;for(N=0;N<D;N++)G+=m[N].byteLength;this.data=new Uint8Array(G);b(G,this.data,0);this.data.set(this.type,4);G=8;for(N=0;N<D;N++)this.data.set(m[N],
G),G+=m[N].byteLength};var v=function(m){var D=y.call(this,g.ftyp)||this;var G=c("mp42"),N=c("mp41"),ba=c("isom"),oa=c("avc1"),ua=c("iso5"),Aa=new Uint8Array([0,0,2,0]);m?D.setData(G,Aa,G,N,ba,ua):D.setData(ba,Aa,ba,N,ua,oa);return D};$jscomp.inherits(v,y);var u=function(m){var D=y.call(this,g.moov)||this;var G=new W(m),N=new x(m);m=new k(m);D.setData(G.data,N.data,m.data);return D};$jscomp.inherits(u,y);var W=function(m){m=y.call(this,g.mvhd)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,
0]),N=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]),oa=new Uint8Array(4);b(1E3,oa,0);var ua=new Uint8Array([0,1,0,0]),Aa=new Uint8Array([1,0]),Fa=new Uint8Array(10),Ba=new Uint8Array(36);Ba[1]=1;Ba[17]=1;Ba[32]=64;var ya=new Uint8Array(24),Ha=new Uint8Array([255,255,255,255]);m.setData(D,G,N,ba,oa,e,ua,Aa,Fa,Ba,ya,Ha);return m};$jscomp.inherits(W,y);var x=function(m){var D=y.call(this,g.trak)||this;var G=new Y(m);m=new M(m);D.setData(G.data,m.data);return D};$jscomp.inherits(x,y);var Y=function(m){var D=
y.call(this,g.tkhd)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,7]),ba=new Uint8Array([0,0,0,0]),oa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(m.id,ua,0);var Aa=new Uint8Array(4),Fa=new Uint8Array(8),Ba=new Uint8Array([0,0]),ya=new Uint8Array([0,0]),Ha=m.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),va=new Uint8Array(2),za=new Uint8Array(36);za[1]=1;za[17]=1;za[32]=64;var Na=new Uint8Array(4);Na[0]=m.width>>8&255;Na[1]=m.width&255;Na[2]=0;Na[3]=0;var Ya=new Uint8Array(4);Ya[0]=
m.height>>8&255;Ya[1]=m.height&255;Ya[2]=0;Ya[3]=0;D.setData(G,N,ba,oa,ua,Aa,e,Fa,Ba,ya,Ha,va,za,Na,Ya);return D};$jscomp.inherits(Y,y);var M=function(m){var D=y.call(this,g.mdia)||this;var G=new Q(m),N=new O(m);m=new qa(m);D.setData(G.data,N.data,m.data);return D};$jscomp.inherits(M,y);var Q=function(m){var D=y.call(this,g.mdhd)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,0]),oa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(m.timeScale,ua,0);m=new Uint8Array([85,
196]);var Aa=new Uint8Array(2);D.setData(G,N,ba,oa,ua,e,m,Aa);return D};$jscomp.inherits(Q,y);var O=function(m){var D=y.call(this,g.hdlr)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array(4);m=m.isAudio?c("soun"):c("vide");var oa=new Uint8Array(12),ua=c("Remote Spark Handler",!0);D.setData(G,N,ba,m,oa,ua);return D};$jscomp.inherits(O,y);var qa=function(m){var D=y.call(this,g.minf)||this;var G=new E,N=new U(m);m.isAudio?(m=new T,D.setData(m.data,G.data,N.data)):(m=new aa,
D.setData(m.data,G.data,N.data));return D};$jscomp.inherits(qa,y);var aa=function(){var m=y.call(this,g.vmhd)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,1]),N=new Uint8Array([0,0]),ba=new Uint8Array(6);m.setData(D,G,N,ba);return m};$jscomp.inherits(aa,y);var T=function(){var m=y.call(this,g.smhd)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,0]),N=new Uint8Array([0,0]),ba=new Uint8Array(2);m.setData(D,G,N,ba);return m};$jscomp.inherits(T,y);var E=function(){var m=y.call(this,g.dinf)||
this;var D=new da;m.setData(D.data);return m};$jscomp.inherits(E,y);var da=function(){var m=y.call(this,g.dref)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,1]),ba=new ea;m.setData(D,G,N,ba.data);return m};$jscomp.inherits(da,y);var ea=function(){var m=y.call(this,g.url)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,1]);m.setData(D,G);return m};$jscomp.inherits(ea,y);var U=function(m){var D=y.call(this,g.stbl)||this;m=new ja(m);var G=new ma,N=new Ea,ba=
new h,oa=new l;D.setData(m.data,G.data,N.data,ba.data,oa.data);return D};$jscomp.inherits(U,y);var ja=function(m){var D=y.call(this,g.stsd)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,1]);m.isAudio?(m=new Z(m),D.setData(G,N,ba,m.data)):(m=new ra(m),D.setData(G,N,ba,m.data));return D};$jscomp.inherits(ja,y);var Z=function(m){var D=y.call(this,g.mp4a)||this;var G=new Uint8Array(6),N=new Uint8Array([0,1]),ba=new Uint8Array(8),oa=new Uint8Array([0,2]),ua=new Uint8Array([0,
16]),Aa=new Uint8Array([0,0]),Fa=new Uint8Array(2),Ba=m.audioHeader.sampleRate,ya=new Uint8Array(4);ya[0]=Ba>>8&255;ya[1]=Ba&255;ya[2]=0;ya[3]=0;m=new ha(m);D.setData(G,N,ba,oa,ua,Aa,Fa,ya,m.data);return D};$jscomp.inherits(Z,y);var ha=function(m){var D=y.call(this,g.esds)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array([3]),oa=new Uint8Array([25]),ua=new Uint8Array([0,0]),Aa=new Uint8Array([0]),Fa=new Uint8Array([4]),Ba=new Uint8Array([17]),ya=new Uint8Array([64]),Ha=
new Uint8Array([21]),va=new Uint8Array(3),za=m.bufferSizeDB;va[0]=za>>16&255;va[1]=za>>8&255;va[2]=za&255;za=new Uint8Array(4);b(m.bitRate,za,0);var Na=new Uint8Array(4);b(m.bitRate,Na,0);var Ya=new Uint8Array([5]),Za=new Uint8Array([2]),Wa=m.audioHeader.audioType||2,nb=m.audioHeader.frequencyIdx,wb=m.audioHeader.channelConfig;m=new Uint8Array(2);m[0]=Wa<<3|nb>>1&7;m[1]=(nb&1)<<7|wb<<3;Wa=new Uint8Array([6]);nb=new Uint8Array([1]);wb=new Uint8Array([2]);D.setData(G,N,ba,oa,ua,Aa,Fa,Ba,ya,Ha,va,za,
Na,Ya,Za,m,Wa,nb,wb);return D};$jscomp.inherits(ha,y);var ra=function(m){var D=y.call(this,g.avc1)||this;var G=new Uint8Array(6),N=new Uint8Array([0,1]),ba=new Uint8Array([0,0]),oa=new Uint8Array(2),ua=new Uint8Array(12),Aa=new Uint8Array(2);Aa[0]=m.width>>8&255;Aa[1]=m.width&255;var Fa=new Uint8Array(2);Fa[0]=m.height>>8&255;Fa[1]=m.height&255;var Ba=new Uint8Array([0,72,0,0]),ya=new Uint8Array([0,72,0,0]),Ha=new Uint8Array(4),va=new Uint8Array([0,1]),za=c("SparkStreamPlayer"),Na=new Uint8Array(32);
Na[0]=za.length;Na.set(za,1);za=new Uint8Array([0,24]);var Ya=new Uint8Array([255,255]);m=new R(m);D.setData(G,N,ba,oa,ua,Aa,Fa,Ba,ya,Ha,va,Na,za,Ya,m.data);return D};$jscomp.inherits(ra,y);var R=function(m){var D=y.call(this,g.avcC)||this;var G=new Uint8Array([1]),N=new Uint8Array([m.sps[1]]),ba=new Uint8Array([m.sps[2]]),oa=new Uint8Array([m.sps[3]]),ua=new Uint8Array([255]),Aa=new Uint8Array([225]),Fa=new Uint8Array(2),Ba=m.sps.byteLength;Fa[0]=Ba>>8&255;Fa[1]=Ba&255;Ba=new Uint8Array(m.sps);var ya=
new Uint8Array([1]),Ha=new Uint8Array(2),va=m.pps.byteLength;Ha[0]=va>>8&255;Ha[1]=va&255;m=new Uint8Array(m.pps);D.setData(G,N,ba,oa,ua,Aa,Fa,Ba,ya,Ha,m);return D};$jscomp.inherits(R,y);var P=function(){var m=y.call(this,g.btrt)||this;var D=new Uint8Array([0,28,156,128]),G=new Uint8Array([0,45,198,192]),N=new Uint8Array([0,45,198,192]);m.setData(D,G,N);return m};$jscomp.inherits(P,y);var ma=function(){var m=y.call(this,g.stts)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,0]),N=new Uint8Array([0,
0,0,0]);m.setData(D,G,N);return m};$jscomp.inherits(ma,y);var Ea=function(){var m=y.call(this,g.stsc)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,0]);m.setData(D,G,N);return m};$jscomp.inherits(Ea,y);var h=function(){var m=y.call(this,g.stsz)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]);m.setData(D,G,N,ba);return m};$jscomp.inherits(h,y);var l=function(){var m=y.call(this,g.stco)||this;var D=
new Uint8Array([0]),G=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,0]);m.setData(D,G,N);return m};$jscomp.inherits(l,y);var k=function(m){var D=y.call(this,g.mvex)||this;m=new f(m);D.setData(m.data);return D};$jscomp.inherits(k,y);P=function(m){m=y.call(this,g.mehd)||this;var D=new Uint8Array([0]),G=new Uint8Array([0,0,0]);m.setData(D,G,d);return m};$jscomp.inherits(P,y);var f=function(m){var D=y.call(this,g.trex)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m.id,
ba,0);m=new Uint8Array([0,0,0,1]);var oa=new Uint8Array([0,0,0,0]),ua=new Uint8Array([0,0,0,0]),Aa=new Uint8Array([0,0,0,0]);D.setData(G,N,ba,m,oa,ua,Aa);return D};$jscomp.inherits(f,y);var q=function(m){var D=y.call(this,g.moof)||this;t.setSequenceNumber(m.sequenceNumber);m=new A(m);D.setData(t.data,m.data);return D};$jscomp.inherits(q,y);P=function(m){var D=y.call(this,g.mfhd)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m,ba,0);D.setData(G,N,ba);return D};$jscomp.inherits(P,
y);P.prototype.setSequenceNumber=function(m){b(m,this.data,12)};var t=new P(1),A=function(m){var D=y.call(this,g.traf)||this;C.setTrackId(m.id);C.setSampleDuration(m.frameDuration);z.setBaseMediaDecodeTime(m.samples[0].timestamp);var G=32+C.data.length+z.data.length;if(m.isAudio)m=new X(m,null,G);else{for(var N=[],ba=0;ba<m.samples.length;ba++){var oa=m.samples[ba];N.push({size:oa.unitsLength+4*oa.units.length,duration:m.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:oa.hasIDR?
2:1,isDependedOn:0,hasRedundancy:0,isNonSync:oa.hasIDR?0:1,degradationPriority:0}})}m=new X(m,N,G)}D.setData(C.data,z.data,m.data);return D};$jscomp.inherits(A,y);P=function(m,D){var G=y.call(this,g.tfhd)||this;G.isAudio=D;var N=new Uint8Array([0]),ba=D?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),oa=new Uint8Array(4);b(m,oa,0);D?(m=new Uint8Array([0,0,0,1]),D=new Uint8Array(4),b(1024,D,0),G.setData(N,ba,oa,m,D)):(m=new Uint8Array([0,0,2,0,1,1,0,0]),G.setData(N,ba,oa,m));return G};$jscomp.inherits(P,
y);P.prototype.setTrackId=function(m){b(m,this.data,12)};P.prototype.setSampleDuration=function(m){this.isAudio||b(m,this.data,16)};var C=new P(0,a);P=function(m){var D=y.call(this,g.tfdt)||this;var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(m,ba,0);D.setData(G,N,ba);return D};$jscomp.inherits(P,y);P.prototype.setBaseMediaDecodeTime=function(m){b(m,this.data,12)};var z=new P(0),X=function(m,D,G){var N=y.call(this,g.trun)||this;var ba=new Uint8Array([0]),oa=m.isAudio?new Uint8Array([0,
2,1]):new Uint8Array([0,15,1]),ua=m.isAudio?4:16;G+=ua*(m.isAudio?m.samples.length:D.length)+28;var Aa=new Uint8Array(4);m.isAudio?b(m.samples.length,Aa,0):b(D.length,Aa,0);var Fa=new Uint8Array(4);b(G,Fa,0);if(m.isAudio){G=new Uint8Array(ua*m.samples.length);for(var Ba=0;Ba<m.samples.length;Ba++)b(m.samples[Ba].aacData.byteLength,G,ua*Ba)}else for(G=new Uint8Array(ua*D.length),Ba=0;Ba<D.length;Ba++){m=D[Ba];var ya=ua*Ba;b(m.duration,G,ya);b(m.size,G,ya+4);var Ha=m.flags,va=new Uint8Array(4);va[0]=
Ha.isLeading<<2|Ha.dependsOn;va[1]=Ha.isDependedOn<<6|Ha.hasRedundancy<<4|0|Ha.isNonSync;va[2]=Ha.degradationPriority&61440;va[3]=Ha.degradationPriority&15;G.set(va,ya+8);b(m.compositionTimeOffset,G,ya+12)}N.setData(ba,oa,Aa,Fa,G);return N};$jscomp.inherits(X,y);P=function(m){var D=y.call(this,g.sdtp)||this;for(var G=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ba=new Uint8Array(m.length),oa=0;oa<m.length;oa++){var ua=m[oa].flags;ba[oa]=ua.isLeading<<6|ua.dependsOn<<4|N.isDependedOn<<2|N.hasRedundancy}D.setData(G,
N,ba);return D};$jscomp.inherits(P,y);var K=function(m){var D=y.call(this,g.mdat)||this;if(m.isAudio){for(var G=new Uint8Array(m.totalByteLength),N=0,ba=0;ba<m.samples.length;ba++){var oa=m.samples[ba].aacData;G.set(oa,N);N+=oa.byteLength}D.setData(G)}else{G=new Uint8Array(4*m.unitNum+m.totalByteLength);for(ba=N=0;ba<m.samples.length;ba++){oa=m.samples[ba];for(var ua=0;ua<oa.units.length;ua++){var Aa=oa.units[ua],Fa=Aa.data.byteLength;b(Fa,G,N);N+=4;G.set(Aa.data,N);N+=Fa}}D.setData(G)}return D};
$jscomp.inherits(K,y)}function rc(a){function b(F,H){this.aacData=F;this.timestamp=H}function c(F,H,w,y){this.audioType=F;this.frequencyIdx=H;this.sampleRate=w;this.channelConfig=y}var e=rc.SAMPLING_FREQUENCY,d=null,g=!0,p=this,J=0;this.reset=function(){J=0;d=null;B.audioHeader=null;a&&a.reset()};var B=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=
this.bitRate=this.duration=0}};this.setMediaFormat=function(F,H){var w=F.frequencyIdx;w||(w=e.indexOf(F.sampleRate));-1==w&&console.error("Invalid AAC sampel rate: "+F.sampleRate);d=new c(F.audioType||2,w,F.sampleRate,F.channels||F.channelConfig);B.audioHeader=d;g=!H;if(p.oncodec)p.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(F){if(g){var H=p.readADTSHeader(F);F=F.subarray(H)}H=new b(F,J);J+=1024;B.samples.push(H);B.totalByteLength+=F.byteLength;F=1/(d.sampleRate/1024);B.duration=
F;B.samples[0]&&(B.bitRate=8*B.samples[0].aacData.length/F|0);a&&a.remux(B);B.clear()};this.readADTSHeader=function(F){var H=F[1]&0?9:7,w=(F[2]>>6&3)+1,y=F[2]>>2&15,v=e[y];v||console.error("Invalid Sampling Frequency Index: "+y);var u=((F[2]&1)<<2)+(F[3]>>6&3),W=F[1]>>1&3;0!=W&&console.error("Invalid data format: layer is not 0x00: "+W.toString(16));F.length!=((F[3]&3)<<11)+(F[4]<<3)+(F[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+F.length);if(d){if(y!=d.frequencyIdx&&(d.frequencyIdx=
y,d.sampleRate=v,p.oncodec))p.oncodec("mp4a.40.2",d)}else if(d=new c(w,y,v,u),B.audioHeader=d,p.oncodec)p.oncodec("mp4a.40.2",d);return H}}function Xc(a){function b(){if(0==J)console.error("no more ExpGolomb data");else{var H=0,w=p-J;for(B=0;w<p;){var y=a[w];if(3!=y||0!=a[w-1]||0!=a[w-2])B=B<<8|y,H++;w++;if(4<=H)break}4>H&&(B<<=4-H);F=8*H;J=p-w}}function c(H){if(!(F>H)){H-=F;var w=H>>3;H-=w>>3;J-=w;b()}B<<=H;F-=H}function e(H){var w=Math.min(F,H),y=B>>>32-w;32<H&&logger.error("Read more than 32 bits:"+
H);F-=w;0<F?B<<=w:0<J&&b();w=H-w;return 0<w?y<<w|e(w):y}function d(){var H;for(H=0;H<F;++H)if(0!==(B&2147483648>>>H))return B<<=H,F-=H,H;b();return H+d()}function g(){c(1+d())}var p=a.byteLength,J=p,B=0,F=0;this.readUEG=function(){var H=d();return e(H+1)-1};this.readEG=function(){var H=this.readUEG();return 1&H?1+H>>>1:-1*(H>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=
function(H){var w=8,y=8,v;for(v=0;v<H;v++)0!==y&&(y=this.readEG(),y=(w+y+256)%256),w=0===y?w:y};this.readSPS=function(){var H=0,w=0,y=0,v=0,u=1,W,x=0,Y=!0;if(7>a.length)return console.log("no enough SPS data"),null;var M=this.readU8();if(7!=(M&31))return console.error("Invalid SPS type: "+M,a),null;M=this.readU8();e(5);c(3);this.readU8();g();if(100===M||110===M||122===M||244===M||44===M||83===M||86===M||118===M||128===M||138===M||139===M||134===M||135===M){var Q=this.readUEG();3===Q&&c(1);g();g();
c(1);if(this.readBool()){var O=3!==Q?8:12;for(W=0;W<O;W++)this.readBool()&&(6>W?this.skipScalingList(16):this.skipScalingList(64))}}g();W=this.readUEG();if(0===W)this.readUEG();else if(1===W)for(c(1),c(1+d()),c(1+d()),O=this.readUEG(),W=0;W<O;W++)c(1+d());g();c(1);var qa=this.readUEG();W=this.readUEG();O=e(1);0===O&&c(1);c(1);this.readBool()&&(H=this.readUEG(),w=this.readUEG(),y=this.readUEG(),v=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var aa=[1,1];break;
case 2:aa=[12,11];break;case 3:aa=[10,11];break;case 4:aa=[16,11];break;case 5:aa=[40,33];break;case 6:aa=[24,11];break;case 7:aa=[20,11];break;case 8:aa=[32,11];break;case 9:aa=[80,33];break;case 10:aa=[18,11];break;case 11:aa=[15,11];break;case 12:aa=[64,33];break;case 13:aa=[160,99];break;case 14:aa=[4,3];break;case 15:aa=[3,2];break;case 16:aa=[2,1];break;case 255:aa=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}aa&&(u=aa[0]/aa[1])}this.readBool()&&c(1);this.readBool()&&(c(4),
this.readBool()&&c(24));this.readBool()&&(g(),g());this.readBool()&&(x=this.readU32(),aa=this.readU32(),Y=this.readBool(),x=aa/(2*x))}u=Math.ceil((16*(qa+1)-2*H-2*w)*u);aa=(2-O)*(W+1)*16-(O?2:4)*(y+v);W="avc1."+(0==a[1]?"00":a[1].toString(16));W+=0==a[2]?"00":a[2].toString(16);W+=0==a[3]?"00":a[3].toString(16);return{width:u,height:aa,profileIdc:M,chromaFormatIdc:Q,frameCropLeftOffset:H,frameCropRightOffset:w,frameCropTopOffset:y,frameCropBottomOffset:v,fps:x,fixedFrameRate:Y,codec:W}};this.readSliceType=
function(){this.readU8();this.readUEG();return this.readUEG()}}function Ud(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=J;this.unitsLength=B;this.timestamp=d;this.hasIDR=g}function e(){var y=!1;if(p&&H.sps){var v=new c;d+=H.frameDuration||3E3;H.samples.push(v);H.totalByteLength+=
B;H.unitNum+=J.length;H.sequence++;y=!0;if(v.hasIDR&&w.onkeyframe)w.onkeyframe(v)}p=g=!1;J=[];B=0;return y}var d=0,g=!1,p=!1,J=[],B=0,F=Ob.searchStartCode,H=null,w=this;H=new b;this.reset=function(){d=0;g=!1;J=[];B=0;H=new b;a&&a.reset()};this.close=function(){w&&(w.reset(),w=null)};this.parseH264Data=this.parse=function(y){for(var v=[],u=0,W,x,Y,M=[0,0];u<y.byteLength;){M[0]=u;F(y,M);var Q=M[0];if(-1==Q)break;u=M[1];u=Q+u;Y=y[u];Y&=31;W&&(W={type:x,data:y.subarray(W,Q)},v.push(W));W=u;x=Y}W&&(W=
{type:x,data:y.subarray(W,y.byteLength)},v.push(W));for(y=0;y<v.length;y++)switch(M=v[y],u=M.type,u){case 1:case 2:case 3:case 4:J.push(M);B+=M.data.byteLength;p=!0;break;case 5:p=g=!0;J.push(M);B+=M.data.byteLength;break;case 6:break;case 7:u=new Xc(M.data);if(u=u.readSPS()){if(H.width=u.width,H.height=u.height,H.codec=u.codec,H.sps=M.data,u.fps&&(H.frameDuration=9E4/u.fps|0),J.push(M),B+=M.data.byteLength,w.oncodec)w.oncodec(H.codec,u)}else console.log("corrupted sps",M.data);break;case 8:H.pps=
M.data;J.push(M);B+=M.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+u)}e()&&H.sps&&(a.remux(H),H.clear())}}function Pb(a,b,c){function e(){for(;B;){if(x.updating){B=!1;break}var Q=J.shift();if(!Q)break;try{x.appendBuffer(Q),F=0}catch(O){J.unshift(Q);if("QuotaExceededError"==O.name)if(p(!0))continue;else{if(H.onerror)H.onerror(O);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),H.close();break}F++;console.error("Failed to append buffer, retry "+
F,O);if(2<F){if(H.onerror)H.onerror(O);break}}}}function d(){B=!0;e()}function g(){W.duration=Number.POSITIVE_INFINITY;x=W.addSourceBuffer(w);x.mode="sequence";x.addEventListener("updateend",d);x.addEventListener("error",function(Q){console.error(Q)});B=!0;H.play(!1);e()}function p(Q){var O=Math.min(a.played.end(0),x.buffered.end(0)),qa=0,aa=u.length,T=!1,E=0;if(c)E=O-180,0>E&&console.warn("Not possible, time played secs: "+O);else if(1<aa){var da=aa-2;for(O=9E4*O|0;qa<aa;){if(u[qa]>O){da=qa-2;break}qa++}0<=
da&&(E=(u[da]+1E3)/9E4)}if(0<E)try{x.remove(0,E),u.splice(0,da+1),T=!0,console.info("Buffer removed "+E+" isAudio: "+c)}catch(ea){console.warn("Buffer removal "+E+" failed, retry, isAudio: "+c)}Q||(v=setTimeout(p,18E4));return T}var J=[],B=!1,F=0,H=this,w="",y=null,v=0,u=[],W=null,x=null,Y=null,M=null;a.autoplay=!0;this.getKeyFrames=function(){return u};Y=new Ob(c);Y.ondata=function(Q){J.push(Q);e()};M=c?new rc(Y):new Ud(Y);M.onkeyframe=function(Q){u.push(Q.timestamp)};M.oncodec=function(Q,O){var qa=
c?"audio/mp4;codecs=":"video/mp4;codecs=";qa+=Q;if(qa!=w||(c?y.sampleRate!=O.sampleRate:y.width!=O.width||y.height!=O.height))if(w=qa,y=O,B=!1,x=null,W=new MediaSource,W.addEventListener("sourceopen",g),a.src=URL.createObjectURL(W),H.onsps)H.onsps(O)};b.onvideoframe=function(Q){M.parse(Q.bitstream)};b.onaudioframe=function(Q){M.parse(Q)};b.onendofstream=function(){H.reset()};this.play=function(Q){a.play().catch(function(O){if(!Q&&(console.error(O),H.onplayerror))H.onplayerror(O)})};this.reset=function(){console.log("Reset player");
v&&(clearTimeout(v),v=0);u.length=0;B=!1;w="";y=null;M&&M.reset();J.length=0};this.close=function(){H&&(H.reset(),W&&"open"==W.readyState&&(W.endOfStream(),a.src=null),M&&M.close&&M.close(),Y&&Y.close&&Y.close(),H=null)};this.setMediaFormat=function(Q,O){M.setMediaFormat&&M.setMediaFormat(Q,O)};this.getMediaSource=function(){return W};this.getMediaSourceBuffer=function(){return x};a.addEventListener("ended",function(Q){console.warn(".... ended");v&&(clearTimeout(v),v=0)});a.addEventListener("emptied",
function(Q){B=!!x});a.addEventListener("pause",function(Q){console.warn(".... paused");B=!!x;var O=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+O)}).catch(function(qa){console.error(qa)})});a.addEventListener("waiting",function(Q){B=!!x})}function Vd(a,b,c,e){function d(u,W,x,Y){var M,Q,O,qa,aa,T,E,da,ea,U,ja,Z,ha,ra,R,P,ma,Ea,h,l,k,f,q,t,A,C,z,X,K,m,D,G,N,ba,oa,ua,Aa,Fa,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ya){if(1==ya.nextAddress)return M=
u.allocationSize(),Q=new Uint8Array(M),ya.yield(u.copyTo(Q),2);O=u.codedWidth;qa=(O+1)/2|0;aa=u.codedHeight;T=(aa+1)/2|0;E=O*aa;da=E+qa*T;ea=2*E;U=W.subarray(E,ea);ja=W.subarray(ea);ma=P=R=ra=ha=Z=0;k=l=h=Ea=null;f=Q.subarray(0,E);q=Q.subarray(E,da);t=Q.subarray(da);A=0;for(C=Y.length;A<C;A++){z=Y[A];X=z.left;K=z.top;m=z.right;D=z.bottom;G=X/2|0;N=K/2|0;ba=m/2|0;oa=D/2|0;ua=G/2|0;Aa=ba/2|0;for(ha=K;ha<D;ha++)for(P=ha*O,ma=P+O,Ea=f.subarray(P,ma),l=U.subarray(P,ma),k=ja.subarray(P,ma),Z=G;Z<ba;Z++)R=
2*Z+1,l[R]=Ea[Z],k[R]=Ea[Z+qa];Fa=(qa+1)/2|0;if(x)for(Ba=Q.subarray(E),ha=N;ha<oa;ha++)for(P=ha*O,ma=P+qa,Ea=Ba.subarray(P,ma),P=ma,ma=P+qa,h=Ba.subarray(P,ma),P=(2*ha+1)*O,ma=P+O,l=U.subarray(P,ma),k=ja.subarray(P,ma),Z=G;Z<ba;Z++)ra=2*Z,l[ra]=Ea[Z],k[ra]=h[Z];else for(ha=N;ha<oa;ha++)for(P=ha*qa,ma=P+qa,Ea=q.subarray(P,ma),h=t.subarray(P,ma),P=(2*ha+1)*O,ma=P+O,l=U.subarray(P,ma),k=ja.subarray(P,ma),Z=ua;Z<Aa;Z++)ra=4*Z,l[ra]=Ea[Z],k[ra]=Ea[Z+Fa],ra+=2,l[ra]=h[Z],k[ra]=h[Z+Fa]}ya.jumpToEnd()})}
function g(u,W,x,Y){var M,Q,O,qa,aa,T,E,da,ea,U,ja,Z,ha,ra,R,P,ma,Ea,h,l,k,f,q,t,A,C,z,X,K,m,D,G,N,ba,oa,ua,Aa,Fa,Ba,ya,Ha,va,za,Na,Ya,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return M=new Uint8Array(u.allocationSize()),Wa.yield(u.copyTo(M),2);Q=u.codedWidth;O=u.codedHeight;qa=(Q+1)/2|0;aa=(O+1)/2|0;T=Q*O;E=T+qa*aa;da=M.subarray(T,E);ea=M.subarray(E);U=2*T;ja=W.subarray(T,U);Z=W.subarray(U);h=Ea=ma=P=R=ra=ha=0;q=f=k=l=null;t=0;for(A=Y.length;t<A;t++){C=
Y[t];z=C.left;X=C.top;K=C.right;m=C.bottom;D=K-z;G=m-X;N=X*Q+z;ba=M.subarray(N,T);oa=W.subarray(N,T);ua=ja.subarray(N);Aa=Z.subarray(N);Fa=z/2|0;Ba=X/2|0;ya=K/2|0;Ha=m/2|0;va=ya-Fa;za=Ha-Ba;for(ra=0;ra<G;ra++)P=ra*Q,ma=P+D,l=ba.subarray(P,ma),oa.set(l,P);if(x)for(N=Ba*Q+z,Na=M.subarray(T+N),ra=0;ra<za;ra++){P=ra*Q;ma=P+D;l=Na.subarray(P,ma);P=2*ra*Q;ma=P+D;f=ua.subarray(P,ma);q=Aa.subarray(P,ma);for(ha=0;ha<va;ha++)R=2*ha,Ea=l[R],f[R]=Ea,f[R+1]=Ea,h=l[R+1],q[R]=h,q[R+1]=h,void 0==h&&console.log("undefined v: "+
R,ha,ra,P,ma,D,va,za);P+=Q;ua.set(f,P);Aa.set(q,P)}else for(N=Ba*qa+Fa,Ya=da.subarray(N),Za=ea.subarray(N),ra=0;ra<za;ra++){P=ra*qa;ma=P+va;l=Ya.subarray(P,ma);k=Za.subarray(P,ma);P=2*ra*Q;ma=P+D;f=ua.subarray(P,ma);q=Aa.subarray(P,ma);for(ha=0;ha<va;ha++)R=2*ha,Ea=l[ha],f[R]=Ea,f[R+1]=Ea,h=k[ha],q[R]=h,q[R+1]=h;P+=Q;ua.set(f,P);Aa.set(q,P)}}return Wa.return(W)})}function p(u){var W;return $jscomp.asyncExecutePromiseGeneratorProgram(function(x){switch(x.nextAddress){case 1:if(!e){if(1E3==u.duration)F.onframedecoded(u,
v.getRects(u.timestamp));x.jumpTo(2);break}W=null;return 1E3==u.duration?x.yield(v.setMainFrame(u),6):x.yield(v.getCombinedFrame(u),5);case 5:W=x.yieldResult;x.jumpTo(4);break;case 6:W=x.yieldResult;case 4:F.onframedecoded(W),W.close();case 2:u.close(),x.jumpToEnd()}})}function J(u){var W=u.codec;if(W!=B||(b?w.sampleRate!=u.sampleRate:w.width!=u.width||w.height!=u.height))if(console.log("Codec: "+W+" audio: "+b),B=W,w=u,H||(H=new VideoDecoder({output:function(x){p(x)},error:function(x){console.error("VideoDecoder error:",
x);if(F.onerror)F.onerror(x)}})),W={codec:B,codedWidth:u.width,codedHeight:u.height,hardwareAcceleration:c||"no-preference"},console.log(W),H.configure(W),F.onsps)F.onsps(u)}var B=null,F=this,H,w=null,y={type:"delta",data:null,timestamp:0,duration:0},v=new function(){function u(Q){for(;;){var O=W.shift();if(O){if(O.timestamp==Q)return O.rects;if(O.timestamp>Q){console.log("not possible, time: "+Q+" option.timestamp: "+O.timestamp);break}}else break}return null}var W=[],x=null,Y=!1,M={timestamp:0,
codedWidth:0,codedHeight:9,duration:0,format:"I444"};this.pushRects=function(Q){W.push(Q)};this.getRects=u;this.setMainFrame=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){if(1==O.nextAddress)return x||(x=new Uint8Array(2*Q.allocationSize()),Y="NV12"==Q.format,M.codedWidth=Q.codedWidth,M.codedHeight=Q.codedHeight,console.log("isNV12: "+Y+" supportsI444: "+e)),O.yield(g(Q,x,Y,u(Q.timestamp)),2);M.duration=Q.duration;M.timestamp=Q.timestamp;return O.return(new VideoFrame(x,
M))})};this.getCombinedFrame=function(Q){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){if(1==O.nextAddress)return O.yield(d(Q,x,Y,u(Q.timestamp)),2);M.duration=Q.duration;M.timestamp=Q.timestamp;return O.return(new VideoFrame(x,M))})};this.close=function(){x&&(x=null)}};a.onvideoframe=function(u){var W=u.bitstream;var x=0,Y=[0,0],M=W.length;var Q=!1;var O=null;for(var qa=!1,aa=0,T=0;x<M;){Y[0]=x;Ob.searchStartCode(W,Y);var E=Y[0];if(-1==E){T=Y[1];break}E+=Y[1];x=E+1;aa=W[E]&31;switch(aa){case 5:Q=
!0;break;case 7:(O=(new Xc(W.subarray(E))).readSPS())||(qa=!0)}}x=M-x;Y=null;7>x&&(Y=W.subarray(0,M-(x+(T+1))),7==aa&&(qa=!1));W=Y;qa&&console.log("corrupted: "+u.timestamp,u.bitstream);O&&J(O);w&&(v.pushRects({timestamp:u.timestamp,rects:u.regionRects}),W&&(u.bitstream=W),y.type=Q?"key":"delta",y.data=u.bitstream,y.timestamp=u.timestamp,y.duration=u.isChroma?77:1E3,u=new EncodedVideoChunk(y),H.decode(u))};this.play=function(u){};this.reset=function(){console.log("Reset MediaDecoder");w=B=null;v.close();
H&&H.reset()&&H.close();H=null};this.close=function(){F.reset();H&&(H.close(),H=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Nb=!1,mb={},kb={},Bb=null,n=this,Lb=!1,Xa=!1,db=0,Cb=null,Yc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});
var ka=hi5.appcfg,Kb="";this.setConfig=function(a){ka=a};var cb="object"==typeof r?r:null,L=cb?{}:hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));void 0==L.mapClipboard&&ka.clipboard&&void 0!=ka.clipboard.enabled&&(L.mapClipboard=ka.clipboard.enabled);L.hardwareAcceleration||(L.hardwareAcceleration=ka.hardwareAcceleration);void 0==L.yuv444&&(L.yuv444=ka.yuv444);void 0==ka.enableDVCAudio&&(ka.enableDVCAudio=!0);var Ka=0,La=0,gb=(na||L.color||L.server_bpp||16)|0,pc=null,Zc=null,Qa=null,sc=null,$c=
"/DOWNLOAD?",ad="/CLIP?";24==gb&&(gb=16);var Va="app"==L.startProgram,Mb=S(L.mapDisk),ob=0;this.setLinks=function(a){a.download&&($c=a.download);a.clipboard&&(ad=a.clipboard)};this.protocol=cb?"":r.substring(0,r.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return S(L.smartCard)||S(L.mapSmartCard)||S(L.passwordIsPin)};this.enableWebAuthn=function(){return S(L.enableWebAuthn)||S(L.useWebAuthn)};this.hasScanner=function(){return S(L.scanner)};this.hasUSB=function(){return S(L.mapUSB)&&
!!navigator.usb};this.getUSB=function(){return L.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Zc=a};this.getProfiler=function(){return Zc};this.gateway=function(){if(cb)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss:\/\//ig,
"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=xa;var lb="object"==typeof r||0<r.indexOf("/PLAY?"),tc=!lb&&0<r.indexOf("invitation=");if(tc){var uc=decodeURIComponent(r),Qb=uc.indexOf(' USERNAME="');if(0<Qb){Qb+=11;var Wd=uc.substring(Qb,uc.indexOf('"',Qb));r+="&novice="+Wd}r+="&mapClipboard=on";L.mapClipboard="on";this.reconnectOnResize=!1}if(lb)this.mode=1,cb?r="":(Ka=640,La=480),r+="&touchpad=on",L.touchpad=
"on",this.reconnectOnResize=!1;else if(0<r.indexOf("/JOIN?")||tc)this.mode=2,this.reconnectOnResize=!1;var vc=S(L.gfx)||S(L.remotefx)||0<n.mode;vc&&(Va||tc?(vc=!1,L.remotefx=!1):gb=32);I?Ka=parseInt(I):L.width&&(Ka=parseInt(L.width));V?La=parseInt(V):L.height&&(La=parseInt(L.height));-1==Ka&&(Ka=hi5.browser.getScreenWidth());-1==La&&(La=hi5.browser.getScreenHeight());L.symlink&&L.parameters&&hi5.tool.queryToObj(L.parameters,L);L.gateway||(r+="&gateway="+encodeURIComponent(n.gateway));!L.minWidth&&
ka.minWidth&&(L.minWidth=ka.minWidth);!L.minHeight&&ka.minHeight&&(L.minHeight=ka.minHeight);L.minWidth&&(L.minWidth=parseInt(L.minWidth));L.minHeight&&(L.minHeight=parseInt(L.minHeight));L.waWidth=L.waWidth?parseInt(L.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;L.waWidth&=-4;L.waHeight=L.waHeight?parseInt(L.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;L.waHeight&=-4;"useSSL"in L||(r+=
"&useSSL="+("wss"==n.protocol));hi5.storage.isAvailable&&(S(L.shareClipboard)||L.shareClipboardId)&&(r+="&shareClipboardId="+(L.shareClipboardId||ca()));ka&&(void 0!=ka.displayMsg?this.displayMsg=ka.displayMsg:ka.displayMsg=this.displayMsg,ka.appTimeout&&(this.appTimeout=ka.appTimeout),void 0!=ka.reconnectOnResize&&(this.reconnectOnResize=ka.reconnectOnResize),ka.reconnectTimes&&(this.reconnectTimes=ka.reconnectTimes),void 0!=ka.windowState&&(this.windowState=ka.windowState),void 0!=ka.openLink&&
(this.openLink=ka.openLink),void 0!=ka.setTitle&&(this.setTitle=ka.setTitle),"boolean"==typeof ka.useWSS&&(r=(ka.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),"boolean"==typeof ka.remoteAppLogin&&(this.remoteAppLogin=ka.remoteAppLogin,Nb=!ka.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ka.hideLogin&&(Nb=ka.hideLogin),void 0!=ka.localPrinter&&void 0==L.localPrinter&&(L.localPrinter=ka.localPrinter));var Oa=null;void 0==
ka.useWorker&&(ka.useWorker=!1);ka.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ka.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ma=ka.useWorker?new Worker(ta("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,vb=this.reconnectTimes,dc=Ma?{type:5,data:null}:null;this.getDisplayName=fa;this.server=fa();this.port=parseInt(L.port,10);this.loadbalanceToken="";ka.loadbalanceTokenName&&
(L[ka.loadbalanceTokenName]?la(L[ka.loadbalanceTokenName]):!1!==ka.randomAppId?la(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){n.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+n.loadbalanceToken:"&"+n.loadbalanceToken,a+="&loadbalanceTokenName="+ka.loadbalanceTokenName);return a};this.getURL=function(){return r};this.getRuntimeURL=function(){var a=r+"&width="+Ka+"&height="+La+"&server_bpp="+gb+"&audio="+(Ta.available||hi5.browser.isIE),b=Hc(),
c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=L.monitorDef,d=L.monitor,g=0;b=ia.size();var p=Array(b);c=Array(b);var J=0,B=0,F=0,H=0,w=0,y=0,v="";if(e){c=sa.parseMonitorDef(e);for(b=c.length;g<b;g++){var u=c[g];u[0]<F&&(F=u[0]);u[1]<H&&(H=u[1]);u[2]>w&&(w=u[2]);u[3]>y&&(y=u[3])}0>F&&(J=-F);0>H&&(B=-H);u=0>d?[F,H,w,y]:c[d];L.width=u[2]-u[0]+1;L.height=u[3]-u[1]+1;g=ia.getSurface(0);g.setMonitor(u[0],u[1],u[2],u[3]);if(J||B)for(u=g.getMousePosition(),u.left+=J,u.right+=J,u.top+=
B,u.bottom+=B,g=0;g<b;g++)u=c[g],u[0]+=J,u[1]+=B,u[2]+=J,u[3]+=B;sa.setMonitorLayout(c);0>d&&sa.setMonitorCount(0);n.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+L.width+"&height="+L.height}else{if(1<b&&!Va){for(ia.verifyMonitors();g<b;g++)e=ia.getSurface(g),u=e.getMousePosition(),u.left<F&&(F=u.left),u.top<H&&(H=u.top),u.right>w&&(w=u.right),u.bottom>y&&(y=u.bottom),p[g]=u,v&&(v+=","),v+=u.left+":"+u.top+":"+u.right+":"+u.bottom;0>F&&(J=-F);0>H&&(B=-H);for(g=0;g<b;g++){u=ia.getSurface(g).getMousePosition();
if(J||B)u.left+=J,u.right+=J,u.top+=B,u.bottom+=B;c[g]=[u.left,u.top,u.right,u.bottom,u.left==J&&u.top==B?1:0]}sa.setMonitorLayout(c);n.reconnectOnResize=!1}v&&(svGlobal.logger.warn("MonitorDef:"+v),L.width=w-F+1,L.height=y-H+1,v="&monitorDef="+v+"&width="+L.width+"&height="+L.height);b=v}a+=b;0>r.indexOf("waWidth")&&(b=(b=ia.getFocused())?b.getWindow():window,a+="&waWidth="+L.waWidth+"&waHeight="+L.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;L.tzOffset||(a+="&tzOffset="+
b.getTimezoneOffset());L.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==L.soundPref&&(L.soundPref=0,a+="&soundPref=0");J=c=b="";for(J in mb)B=mb[J],"flags"in B&&(b&&(b+=",",c+=","),b+=B.name,c+=B.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(J in kb)B=kb[J],"flags"in B&&(b&&(b+=","),b+=B.name);b&&(a+="&gwChannelName="+b);if(c=Ad())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);
b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);L.audioRecord=S(L.audioRecord)&&hi5.audio.recordable;Ia.init(b,vc,L.audioRecord,L.soundPref,S(L.mapCamera)&&!!navigator.mediaDevices,S(L.mapUSB)&&!!navigator.usb);L.audioRecord&&(a+="&audioRecord=on");L.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ia.count&&(a+="&dvcChannels="+Ia.names.join(","));a+="&binary=on";ka.existingFile&&(a+="&existingFile="+ka.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(xa());
a=n.modifyURL(a);ka.copyTextOnly&&S(L.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);S(L.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Jd()};this.getColor=function(){return gb};this.changeTitle=pa;hi5.browser.isTouch&&Math.max(Ka,La)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=
function(){return Va};var Ga=null,Ja=!1,rb=!1,qc=!1,Ta=new function(){function a(F){e&&(g&&g.disconnect(),p&&p.disconnect());hi5.audio.releaseAudioContext();F||(B&&(B.close(),B=null),J&&(J.pause(),J=null))}function b(){B.play(!0)}function c(F){console.error("play error: ",F);n.onuserinteract&&n.onuserinteract(b,"audio")||n.showMessage({msg:"Please click Yes to continue.<br>"+F,cbYes:function(){B.play(!0);this.destroy()},html:!0})}var e=null;this.supportWebAudio=this.available=!1;(0==L.playSound||
0<n.mode)&&(e=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return e};this.getBuffer=function(F){return e.createBuffer(2,F,Da.samplePerSec)};var d=0,g=null,p=null;this.setVolume=function(F){1==F?g=null:(g||(g=e.createGain()),g.gain.value=F)};this.playBuffer=function(F){p=e.createBufferSource();p.buffer=F;g?(p.connect(g),g.connect(e.destination)):p.connect(e.destination);var H=e.currentTime,w=0<d?d:H;w<H&&(w=H);d=w+F.duration;
p.start?p.start(w):p.noteOn(w);return d-H};this.iOSFix=function(){if(e){var F=this.getBuffer(1024),H=e.createBufferSource();H.buffer=F;H.connect(e.destination);H.start?H.start(0):H.noteOn(0)}};this.close=a;var J=null,B=null;this.onaudioframe=null;this.initMediaPlayer=function(F,H,w){a(!0);J||(J=document.createElement("audio"));B||(B=new Pb(J,F,!0),B.onplayerror=c,B.onerror=function(y){console.error("Not possible audio error",y)},svGlobal.logger.info("MediaPlayer init, headerless: "+w+" sampleRate:"+
H.sampleRate));B.setMediaFormat(H,w);B.play(!1)}},Rd=Ta.available,ab=null,sa=new Bc(200,200);sa.onSetCursor=Mc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var ac=0,$b=0,bc=Ka-1,cc=La-1,oc="";window.$rdp||(window.$rdp=this);Ca(gb);this.setResolution=Pa;this.running=function(){return Ja};this.setJoinMode=function(a){Ja&&wa("8E1"+a)};this.setJoinCloseMode=function(a){Ja&&wa("8EB3\t"+a)};this.refuseControl=function(a){Ja&&wa("8E3"+a)};this.giveControl=function(a){Ja&&
wa("8E4"+a)};this.pauseSession=function(a,b){Ja&&wa("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ja&&wa("8EB2\t"+a)};this.requestControl=function(){Ja&&wa("8E2")};this.saveSession=function(a){Ja&&wa("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ja&&wa("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(c&&0<c.length){var g=c.shift();g.key?Db.sendSingleKey(g.down,g.key):g.char&&ub(g.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,
space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(g,p){var J=b[p.toLowerCase()];J?n.writeScancode(g,J):(J=p.length,
0!=J&&(1==J?n.writeKeyCode(g,p.toUpperCase().charCodeAt(0)):g&&n.writeText(p)))};var c=null,e=0,d=null;this.sendKeyComb=function(g,p,J){if(Xa){g=g.split("+");var B=g.length,F;if(0!=B){var H=null,w=[];for(F=0;F<B;F++){var y=g[F];""==y&&""==H&&(y="Add");""!=y&&w.push({key:y,down:!0});H=y}B=w.length;for(F=B-1;0<=F;F--)w.push({key:w[F].key,down:!1});if(p)c=w,e=p,d=J,a();else for(F=0,B=w.length;F<B;F++)Db.sendSingleKey(w[F].down,w[F].key)}}};this.sendText=function(g,p,J){for(var B=[],F=0,H=g.length;F<
H;F++)B.push({"char":g.charAt(F)});c=B;e=p;d=J;a()}};this.writeKeyComb=function(a,b,c){Xa&&Db.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Xa)if(b)Db.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)ub(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),n.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ia=new function(a,b){function c(){function d(w){for(;0<w.ownerWinid;){var y=F.getWinById(w.ownerWinid);if(y&&y.isVisible())w=y;else break}return w}function g(w){for(var y=
"";w;)w.titleInfo&&(y=w.titleInfo),w=F.getWinById(w.ownerWinid);return y}var p=[],J=[],B=0,F=this;this.mainWin=null;this.appId="";var H=0;this.getActiveWinId=function(){return H};this.setActiveWinId=function(w,y){svGlobal.logger.info("setActiveWinId: "+w+" old: "+H+" max: "+y);if(H!=w){var v=0==H;H=w;(w=F.getMainByWinId(w))&&w.isMainWin()&&F.mainWin!=w&&(F.mainWin=w);v&&y&&(y=ia.getFocused())&&(y=y.getFreeSpace(),w=y.width,n.resetSize(w,y.height))}};this.onchange=function(w){w.isVisible()||w!=F.mainWin?
w.isVisible()&&!F.mainWin&&w.isMainWin()&&(F.mainWin=w,3==a.windowState&&w.exeCommand(61488)):F.mainWin=null};this.addWin=function(w){for(var y=p.length,v=!1,u=0;u<y;u++)if(w.id==p[u].id){p[u]=w;v=!0;break}v||p.push(w);1==p.length&&(B=Date.now());y=w.isMainWin();svGlobal.logger.info("is mainwin:"+y+" id:"+w.id);y&&!F.mainWin&&(F.mainWin=w)};this.popWins=function(w){w=F.getWinById(w);var y=[];if(w){w=0<w.ownerWinid?w.ownerWinid:w.id;for(var v=p.length-1;0<=v;v--)if(p[v].ownerWinid==w||p[v].id==w)y.push(p[v]),
p.splice(v,1)}return y};this.hasApp=function(w){return-1!=J.indexOf(w)};this.addApp=function(w){return-1==J.indexOf(w)?(J.push(w),!0):!1};this.isNew=function(){return 3E4>Date.now()-B};this.getAll=function(){return p};this.hasWin=function(w){return 0<=p.indexOf(w)};this.close=function(){for(var w=0,y=p.length;w<y;w++)p[w].close()};this.clear=function(){p.length=0};this.delWin=function(w){for(var y=0,v=p.length;y<v;y++)if(p[y].id==w)return p.splice(y,1),y;return-1};this.isRunning=function(){var w=
p.length;if(1>w)return!1;var y=0;for(w=p.length;y<w;y++){var v=p[y];if(v.showState)return!0}return!1};this.getWinById=function(w){var y=p.length;if(1>y)return null;for(var v=0;v<y;v++){var u=p[v];if(u.id==w)return u}return null};this.getMainWinByAppId=function(w){var y=null,v=0;for(len=p.length;v<len;){y=p[v];if(y.appId==w&&y.isVisible()&&1>y.ownerWinid)break;v++}return y};this.getTopWin=function(w){var y=null,v,u=w.length;for(v=0;v<u&&(!(y=F.getWinById(w[v]))||!y.isVisible());v++)y=null;if(!y)for(svGlobal.logger.warn("No win found"),
u=p.length,v=u-1;0<=v&&(y=p[v],!y.isVisible());v--)y=null;return y};this.getMain=function(w){return(w=F.getTopWin(w))?d(w):null};this.getMainByWinId=function(w){return(w=F.getWinById(w))?d(w):null};this.getOtherApps=function(w,y,v){var u=p.length;if(0!=u&&p[u-1])if(u=p[u-1].appId,v||!u)setTimeout(function(){F.getOtherApps(w,y)},v||3E3);else{v=[];if(u=F.getTopWin(w)){var W=0<u.ownerWinid?u.ownerWinid:u.id,x=[],Y=0;for(u=p.length;Y<u;Y++)p[Y].ownerWinid!=W&&p[Y].id!=W&&p[Y].isVisible()&&x.push(p[Y]);
Y=0;for(u=x.length;Y<u;Y++)x[Y].ownerWinid!=W&&x[Y].id!=W&&(v.push({title:g(x[Y]),win:d(x[Y])}),W=0<x[Y].ownerWinid?x[Y].ownerWinid:x[Y].id)}y(v)}};this.getFullTitle=function(w){for(var y,v="";;){y=F.getWinById(w);if(!y)break;y.titleInfo&&y.isVisible()&&(v&&(v=" > "+v),v=y.titleInfo+v);if(1>w)break;w=y.ownerWinid}return v}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,g=0;g<d;g++)e[g].railWin&&e[g].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,
g=Array(d),p=0;p<d;p++)e[p].configMonitor(),g[p]=e[p].getMousePosition();g.sort(function(F,H){var w=F.left-H.left;return 0!=w?w:F.top-H.top});var J=g.findIndex(function(F){return 0==F.left&&0==F.top});svGlobal.logger.info("monitor layout",g,J);-1==J&&(n.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",g));for(p=J-1;0<=p;){if(g[p].right<g[p+1].left){var B=g[p+1].left-g[p].right-1;0<B&&(g[p].right+=
B,g[p].left+=B)}g[p].bottom<g[p+1].top&&(B=g[p+1].top-g[p].bottom-1,0<B&&(g[p].top+=B,g[p].bottom+=B));p--}for(p=J+1;p<d;)g[p-1].right<g[p].left&&(B=g[p].left-g[p-1].right-1,0<B&&(g[p].right-=B,g[p].left-=B)),g[p-1].bottom<g[p].top&&(B=g[p].top-g[p-1].bottom-1,0<B&&(g[p].top-=B,g[p].bottom-=B)),p++};this.repaint=function(d,g,p,J){for(var B=0,F=e.length;B<F;B++)e[B].repaint(d,g,p,J)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};
this.hasSurface=function(d){for(var g=e.length,p=0;p<g;p++)if(e[p].equals(d))return!0;return!1};this.getMonitorSurface=function(d,g,p,J){var B=e.length;if(1==B)return e[0];for(var F=0;F<B;F++)if(e[F].isMonitor(d,g,p,J))return e[F];return null};this.fromSyncedSurface=function(d){var g=e.length;Date.now();for(var p=0;p<g;p++)if(e[p].isClipSynced(d))return!0;return!1};this.setSize=function(d,g,p){for(var J=0,B=e.length;J<B;J++)e[J].setSize(d,g,p)};this.zOrders=[];this.drawLicense=function(d){for(var g=
0,p=e.length;g<p;g++)e[g].drawLicense(d)};this.setReadOnly=function(d,g){for(var p=0,J=e.length;p<J;p++)e[p].setReadOnly(d,g)};this.setVisible=function(d,g){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var g=0,p=e.length;g<p;g++)e[g]&&e[g].setCursor(d)};this.hide=function(d){d=0;for(var g=e.length;d<g;d++)e[d]&&e[d].hide()};this.execute=function(d,g){for(var p=0,J=e.length;p<J;p++)e[p][d].apply(e[p],g)};this.addWin=function(d){var g=this.getFocused();g||(svGlobal.logger.warn("Focused surface not found!"),
g=e[e.length-1]);g?(Va=!0,g.railWin||(g.railWin=new c,g.onunload=function(){hi5.appcfg.closeRemoteApp&&g.railWin&&g.railWin.close();g.remoteApp&&g.remoteApp.close();g.railWin&&(g.railWin.clear(),g.railWin=null);e.removeElm(g)}),g.context&&b.setContext(g.context),g.railWin.addWin(d),g.railWin.mainWin==d&&(setTimeout(function(){var p=g.getFreeSpace();a.writeRawInput("8C661441\t"+p.width+"\t"+p.height);svGlobal.logger.info("-- main win dp change:"+p.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);
svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&g.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var g,p=e.length-1;0<=p;p--){var J=e[p];g=J.railWin;var B=g.getWinById(d),F=B&&B.appId&&-1!=B.appId.toLowerCase().indexOf("runonce");if(0<=g.delWin(d)){B==g.mainWin&&(g.mainWin=null);if(J.toolbar){d=
"win"+d;var H=J.toolbar.querySelector("#"+d);H&&J.toolbar.removeChild(H)}if(!g.isRunning()&&0==n.mode){if(B.isMainWin()&&J.onremoteappclose)J.onremoteappclose(B);B=a.appTimeout;if(F||g.isNew())B*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(w){return function(){svGlobal.logger.info("Start del:"+Date.now());w.railWin&&w.railWin.isRunning()||(w.remoteApp&&w.remoteApp.close(),ia&&ia.delSurface(w))}}(J),B)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):
[]};this.getWinById=function(d){for(var g,p=0,J=e.length;p<J;p++)if(e[p]&&e[p].railWin&&(g=e[p].railWin.getWinById(d)))return g;return null};this.getMainWinByAppId=function(d){for(var g,p=0,J=e.length;p<J;p++)if(e[p].railWin&&(g=e[p].railWin.getMainWinByAppId(d)))return g;return null};this.onWinChange=function(d){for(var g,p=0,J=e.length;p<J;p++)if(e[p].railWin&&(g=e[p].railWin.getWinById(d.id)))e[p].railWin.onchange(d)};this.setTitle=function(d){for(var g,p=0,J=e.length;p<J;p++)if(e[p].railWin){g=
e[p].railWin.getWinById(d);var B=e[p].railWin.getFullTitle(d);if(B){a.changeTitle(B,e[p].getWindow(),g.appId);break}}};this.hasApp=function(d){for(var g=0,p=e.length;g<p;g++)if(e[g].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var g=0,p=e.length;g<p;g++)if(e[g].railWin&&e[g].railWin.hasWin(d))return e[g];return null};
this.getOwnerSurfaceById=function(d){for(var g,p=0,J=e.length;p<J;p++)if(e[p].railWin&&(g=e[p].railWin.getWinById(d)))return e[p];return null};this.getFocused=function(){for(var d=e.length,g=0;g<d;g++)if(e[g].focused)return e[g];return e[d-1]};this.close=function(){for(var d=0,g=e.length;d<g;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function g(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var p=this;this.resizable=function(){return p.isVisible?
0!=(p.style&262144)||0!=(p.style&65536)||0!=(p.style&16777216)||3==p.showState:!1};this.setShowState=function(J){p.showState=J};this.parent=function(){return ia.getWinById(p.ownerWinid)};this.resize=function(J,B,F,H){svGlobal.logger.info("www resize, l "+J+" w "+F);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+p.id+"\t"+J+"\t"+B+"\t"+F+"\t"+H)};this.exeCommand=function(J){svGlobal.logger.info("www exeCommand, cmd "+J);a.writeRawInput("8C4"+d+"\t"+J)};this.activate=function(J){svGlobal.logger.info("www activate, enable "+
J+" id:"+d);2==p.showState?(p.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+J)},50)):a.writeRawInput("8C3"+d+"\t"+J)};this.close=function(){svGlobal.logger.info("www close");p.exeCommand(61536)};this.getAppId=g;this.isVisible=function(){return p.winWidth&&p.winHeight&&p.showState&&45<p.winHeight&&45<p.winWidth};this.isMainWin=function(){if(!(p.isVisible()&&p.winWidth&&p.winHeight&&45<p.winHeight&&45<p.winWidth))return!1;var J=1>p.ownerWinid;if(!J)return J;var B=p.style;if(0!=
(B&4194304))return!0;if(0!=(B&2147483648)&&(0==(B&8388608)||0==(B&12582912)))return!1;var F=0!=(p.extStyle&128);(J=J&&!F)&&0!=(B&2147483648)&&0==(B&2156396544)&&(J=!1);return J};g()}}(n,sa);this.getSurfaces=function(){return ia};this.hide=function(){ia&&ia.hide()};this.getFileUrl=function(a,b,c){var e=xa(),d=$c,g=d.indexOf("://");e=(0<g&&11>g?d:e+d)+"s="+oc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return n.modifyURL(e)};this.listFiles=function(a,b){Oa&&Xa&&Oa.list(a,b)};
this.writeRawInput=function(a){if(Xa){wa(a);if(n.onactivity)n.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);wa(e.buffer)};var bd=0;if(ka.numLock||ka.numlock||S(L.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)bd|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;
this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;
this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var g=d.getFreeSpace(),p=g.width;g=g.height;Ra.checkLockFlags=!0;ka.scale?d.scaleTo(p,g,!1):a.resetSize(p,g)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,g){this.reqCopyTime=Date.now();var p=a.getGatewayAddr(),J=ad,B=J.indexOf("://");p=(0<B&&11>B?J:p+
J)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(p),g);this.reqCopyTime=Date.now();Uc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,g,p){a.reconnectOnResize=!1;var J=a.getFileUrl(d,g,p);n.ondownload&&n.ondownload({fileName:d,url:J,source:g,action:p})||window.open(J)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return r};this.reconnect=function(d,g,p){L.symlink?(d="user="+d+"&pwd="+g,p&&(d+="&domain="+p),r=hi5.tool.replaceQuery(r,
"parameters",d)):(r=hi5.tool.replaceQuery(r,"user",d),r=hi5.tool.replaceQuery(r,"pwd",g),r=hi5.tool.replaceQuery(r,"domain",p));a.run()};this.sendKeyboardSyncFlags=function(d,g){return Xa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},g||333),!0):!1};this.sendKeyboardSynchronize=function(d,g,p){var J=0;p&&(J|=4);g&&(J|=2);d&&(J|=1);this.sendKeyboardSyncFlags(J)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",
20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,g){a.authWithCode(d,g)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(n,bd),Xd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,g){return a.repaint(c,e,d-c+1,g-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&
e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+c.id))}}(sa,ia);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new qb(143)};this.GatewayChannel=function(){return new qb(28)};this.DynamicChannel=function(){return new qb(64)};this.addChannel=function(a){mb[a.name]=a};this.addGatewayChannel=function(a){kb[a.name]=a};this.addDynamicChannel=function(a){Ia.names.push(a.name);Ia[a.name]=a;Ia.count++};
var Sa=null,Ia={count:0,names:[],usbChannel:null,close:function(){for(var a=Ia.names,b=0,c=a.length;b<c;b++){var e=Ia[a[b]];if(e&&e.onclose)e.onclose()}a.length=0;Ia.usbChannel=null},init:function(a,b,c,e,d,g){function p(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=
this.formatTag=0;this.extenstion=null;var v=this;this.fromBuffer=function(u,W){v.formatTag=u.getLittleEndian16();v.nChannels=u.getLittleEndian16();v.nSamplesPerSec=u.getLittleEndian32();v.nAvgBytesPerSec=u.getLittleEndian32();v.nBlockAlign=u.getLittleEndian16();v.bitsPerSample=u.getLittleEndian16();var x=u.getLittleEndian16();v.cbSize=x;0<x&&!0!==W&&(v.extenstion=Array(x),u.copyToByteArray(v.extenstion,0,u.getPosition(),x),u.skipPosition(x))};this.toBuffer=function(u){u.setLittleEndian16(v.formatTag);
u.setLittleEndian16(v.nChannels);u.setLittleEndian32(v.nSamplesPerSec);u.setLittleEndian32(v.nAvgBytesPerSec);u.setLittleEndian16(v.nBlockAlign);u.setLittleEndian16(v.bitsPerSample);u.setLittleEndian16(v.cbSize);0<v.cbSize&&u.setBytes(v.extenstion)};this.getSize=function(){return 18+v.cbSize};this.toString=function(){return"Audio Format, tag="+v.formatTag+" nChannels="+v.nChannels+" nSamplesPerSec="+v.nSamplesPerSec+" nAvgBytesPerSec="+v.nAvgBytesPerSec+" nBlockAlign="+v.nBlockAlign+" bitsPerSample="+
v.bitsPerSample+" cbSize="+v.cbSize}}function J(){Sa=new n.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(v){var u=v.getLittleEndian32();v.getLittleEndian32();switch(u){case 5:u=v.getLittleEndian32(),Sa.maxMonitorAreaFactorA=v.getLittleEndian32(),Sa.maxMonitorAreaFactorB=v.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+u+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),v=new Uint8Array(2),
v[0]=146,v[1]=4,wa(v.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(v,u){if(Sa.enabled){var W=new Uint8Array(56),x=new RdpBuffer(W,0,56);v=v>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:v&-4;u=u>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:u&-4;x.setLittleEndian32(2);x.setLittleEndian32(56);x.setLittleEndian32(40);x.setLittleEndian32(1);x.setLittleEndian32(1);x.setLittleEndian32(0);x.setLittleEndian32(0);x.setLittleEndian32(v);x.setLittleEndian32(u);
x.setLittleEndian32(.26458*v|0);x.setLittleEndian32(.26458*u|0);x.setLittleEndian32(v>u?0:90);x.setLittleEndian32(100);x.setLittleEndian32(100);Sa.send(W);svGlobal.logger.warn("Display control: "+v+"x"+u)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!ka.disableDVC){if(ka.enableEcho){var B=new n.DynamicChannel;B.name="ECHO";B.process=function(v){var u=v.getPosition(),W=v.getEnd(),x=new Uint8Array(W-u);x.set(v.getData().subarray(u,W));B.send(x)};n.addDynamicChannel(B)}if(a){var F=
new n.DynamicChannel;F.name="Microsoft::Windows::RDS::Input";F.process=function(v){var u=v.getLittleEndian16();v.getLittleEndian32();switch(u){case 1:v.skipPosition(4),v=new RdpBuffer(new Uint8Array(16),0,16),v.setLittleEndian16(2),v.setLittleEndian32(16),v.setLittleEndian32(3),v.setLittleEndian32(65536),v.setLittleEndian16(256),v.markEnd(),F.send(v);case 5:ia.execute("setTouchRemoting",[!0]);Ia.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ia.execute("setTouchRemoting",
[!1]),Ia.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(F)}if(c){svGlobal.logger.warn("Audio input on");var H=new n.DynamicChannel;(function(){function v(T){var E=new RdpBuffer(new Uint8Array(5),0,5);E.setByte(7);E.setLittleEndian32(T);E.markEnd();H.send(E)}function u(T){var E=T.getLittleEndian32(),da=T.getLittleEndian32(),ea=new p;ea.fromBuffer(T,!0);var U=0,ja=0;0<ea.cbSize&&(22==ea.cbSize?(U=T.getLittleEndian16(),ja=T.getLittleEndian32(),T.skipPosition(16)):
(svGlobal.logger.warn("Wrong cbsize: "+ea.cbSize),T.skipPosition(ea.cbSize)));T=x[da];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+E+" initial: "+da+", "+T.toString());svGlobal.logger.info("Open fmt: "+ea.toString()+" validBits:"+U+" mask:"+ja);M=!0;Q=n.reconnectOnResize;n.reconnectOnResize=!1;aa.onopen||(aa.onopen=function(Z){if(Ja){W=Z;n.reconnectOnResize=Q;v(da);var ha=new RdpBuffer(new Uint8Array(5),0,5);ha.setByte(4);ha.setLittleEndian32(Z?0:1);ha.markEnd();H.send(ha)}});aa.ondata||
(aa.ondata=function(Z,ha){W&&(O.length!=ha+1&&(O=new Uint8Array(ha+1),O[0]=6),H.send(Y),O.set(Z,1),H.send(O))});aa.start(T,E)}H.name="AUDIO_INPUT";H.process=function(T){var E=T.getByte();switch(E){case 1:T=T.getLittleEndian32();E=new RdpBuffer(new Uint8Array(5),0,5);E.setByte(1);E.setLittleEndian32(T);E.markEnd();H.send(E);break;case 2:var da=T.getLittleEndian32();T.getLittleEndian32();var ea=hi5.audio.getAudioContext().sampleRate;for(E=x.length=0;E<da;E++){var U=new p;U.fromBuffer(T);svGlobal.logger.info("Server rec fmt "+
E+":"+U.toString());0==e&&49==U.formatTag&&22050==U.nSamplesPerSec?x.push(U):1==U.formatTag&&U.nSamplesPerSec<=ea&&x.push(U)}H.send(Y);da=0;T=x.length;for(E=0;E<T;E++)da+=x[E].getSize();ea=new RdpBuffer(new Uint8Array(1024),0,1024);ea.setByte(2);ea.setLittleEndian32(T);ea.setLittleEndian32(da+9);for(E=0;E<T;E++)x[E].toBuffer(ea),svGlobal.logger.info("Client rec fmt: "+x[E].toString());ea.skipPosition(1024-da-9);ea.markEnd();H.send(ea);break;case 3:u(T);break;case 7:E=T.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+
x[E].toString()+" by client:"+M);M||(v(E),M=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+E)}};var W=!1,x=[];H.onclose=function(){W=!1;aa&&aa.close()};var Y=new Uint8Array(1);Y[0]=5;var M=!1,Q=n.reconnectOnResize,O=new Uint8Array(0),qa=ta("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),aa=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),qa):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();n.addDynamicChannel(H)}n.addDynamicChannel(function(){var v=
new n.DynamicChannel;v.name="TSMF";var u={type:"image/jpeg"},W=Array(1);v.process=function(x){x.getPosition();var Y=x.getLittleEndian32()&1073741823;var M=x.getLittleEndian32();var Q=x.getLittleEndian32();switch(Y){case 2:if(256==Q){x.getLittleEndian32();Q=new Uint8Array(16);var O=new RdpBuffer(Q,0,16);O.setLittleEndian32(2);O.setLittleEndian32(M);O.setLittleEndian32(1);O.setLittleEndian32(0);v.send(Q)}break;case 0:switch(Q){case 257:x.getBytes(16);x.getLittleEndian32();break;case 256:Y=x.getPosition();
O=x.getLittleEndian32();for(Q=0;Q<O;Q++){x.getLittleEndian32();var qa=x.getLittleEndian32();x.getLittleEndian32();x.skipPosition(qa-4)}Q=x.getPosition()-Y;O=Q+8+4;Q=new Uint8Array(O);O=new RdpBuffer(Q,0,O);O.setLittleEndian32(-2147483648);O.setLittleEndian32(M);Q.set(x.getData().subarray(Y,x.getPosition()),8);v.send(Q);break;case 261:x.getBytes(16);x.getLittleEndian32();break;case 264:Y=x.getLittleEndian32();x.skipPosition(4);x.getLittleEndian32();qa=x.getBytes(16);var aa=x.getBytes(16);x.getLittleEndian32();
x.getLittleEndian32();x.getLittleEndian32();var T=x.getBytes(16);Q=x.getLittleEndian32();x.skipPosition(Q);Q=new Uint8Array(20);O=new RdpBuffer(Q,0,20);O.setLittleEndian32(-2147483648);O.setLittleEndian32(M);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],qa)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],aa)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],T)?O.setLittleEndian32(1):(O.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),
svGlobal.logger.warn(qa),svGlobal.logger.warn(aa),svGlobal.logger.warn(T));O.setLittleEndian32(Y);v.send(Q);break;case 258:x.getBytes(16);x.getLittleEndian32();Y=x.getLittleEndian32();x.skipPosition(Y);break;case 263:x.getBytes(16),Q=new Uint8Array(16),O=new RdpBuffer(Q,0,16),O.setLittleEndian32(-2147483648),O.setLittleEndian32(M),O.setLittleEndian32(1),v.send(Q);case 277:x.getBytes(16);x.getLittleEndian32();break;case 262:x.getBytes(16);sa.flushImgs();sa.setImgRect(0,0,0,0);Q=new Uint8Array(12);
O=new RdpBuffer(Q,0,12);O.setLittleEndian32(-2147483648);O.setLittleEndian32(M);v.send(Q);break;case 278:x.getBytes(16);M=x.getLittleEndian32();Q=x.getLittleEndian32();Y=x.getLittleEndian32();x=x.getLittleEndian32();sa.setImgRect(M,Q,Y-M,x-Q);break;case 265:x.getBytes(16);x.getLittleEndian64();x.getLittleEndian32();break;case 266:x.getBytes(16);break;case 268:x.getBytes(16);break;case 267:x.getBytes(16);break;case 269:x.getBytes(16);x.getLittleEndian32();break;case 274:break;case 275:break;case 259:x.getBytes(16);
x.getLittleEndian32();x.getLittleEndian32();x.skipPosition(32);Q=x.getLittleEndian32();M=new Image;Y=x.getPosition();W[0]=x.getData().subarray(Y,Y+Q);x=new Blob(W,u);M.src=URL.createObjectURL(x);sa.addImg(M);break;case 270:sa.flushImgs();break;case 273:break;case 260:break;case 276:x.getBytes(16);Q=x.getLittleEndian32();Y=x.getPosition()+Q;x.skipPosition(8);M=x.getLittleEndian32();svGlobal.logger.info("window state:"+M);O=x.getLittleEndian32();qa=x.getLittleEndian32();M=x.getLittleEndian32();Q=x.getLittleEndian32();
x.skipPosition(8);aa=x.getLittleEndian32();T=x.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+M+" top:"+Q+" w:"+O+" h:"+qa+" cl:"+aa+" ct:"+T);x.setPosition(Y);Y=x.getLittleEndian32();for(Y=x.getPosition()+Y;x.getPosition()<Y;){aa=x.getLittleEndian32();T=x.getLittleEndian32();var E=x.getLittleEndian32(),da=x.getLittleEndian32();svGlobal.logger.info("visible region, l:"+T+" t:"+aa+" r:"+da+" b:"+E)}sa.setImgRect(M,Q,O,qa);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+
Q)}break;default:svGlobal.logger.warn("unkown interface:"+Y)}};return v}());lb||n.addDynamicChannel(J());ka.enableDVCAudio&&n.addDynamicChannel(function(v,u){var W=!1,x=0,Y=0,M=0,Q=0,O=[],qa=new Uint8Array(4),aa=new n.DynamicChannel;aa.name="AUDIO_PLAYBACK_DVC";aa.onclose=function(){};aa.process=function(T){function E(R){R.skipPosition(14);var P=R.getLittleEndian16();R.getByte();var ma=R.getLittleEndian16();R.skipPosition(1);for(var Ea,h=O.length=0;h<P;h++){var l=new p;l.fromBuffer(R);(Ea=22050<=
l.nSamplesPerSec&&(1==l.formatTag||49==l.formatTag&&22050==l.nSamplesPerSec&&0==v||41222==l.formatTag))&&O.push(l)}l=20;R=O.length;for(h=0;h<R;h++)l+=O[h].getSize();h=l+4;P=new RdpBuffer(new Uint8Array(h),0,h);P.setByte(7);P.setByte(2);P.setLittleEndian16(l);P.setLittleEndian32(3);P.setLittleEndian32(4294967295);P.setLittleEndian32(0);P.setLittleEndian16(0);P.setLittleEndian16(R);P.skipPosition(1);P.setLittleEndian16(ma);P.setByte(124);for(h=0;h<R;h++)l=O[h],l.toBuffer(P);P.markEnd();u&&aa.send(P);
5<ma&&(P=new RdpBuffer(new Uint8Array(8),0,8),P.setByte(12),P.skipPosition(1),P.setLittleEndian16(4),P.setLittleEndian16(0),P.setLittleEndian16(0),P.markEnd(),u&&aa.send(P))}function da(R){var P=R.getLittleEndian16();R=R.getLittleEndian16();var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(6);ma.setByte(35);ma.setLittleEndian16(4);ma.setLittleEndian16(P);ma.setLittleEndian16(R);ma.markEnd();u&&aa.send(ma)}function ea(){var R=O[M];if(R){if(R.formatTag!=Da.tag||R.nSamplesPerSec!=Da.samplePerSec||
Da.channels!=R.nChannels)Da.tag=R.formatTag,Da.channels=R.nChannels,Da.samplePerSec=R.nSamplesPerSec,Da.bitsPerSample=49==R.formatTag?8:R.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec),41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!0))}else 41222!=Da.tag&&(Da.tag=41222,Da.channels=2,Da.bitsPerSample=16,Da.sampleRate=44100,Ta.initMediaPlayer(Ta,Da,!0))}function U(R){Y=
R.getLittleEndian16();M=R.getLittleEndian16();Q=R.getByte();R.skipPosition(3);qa.set(R.getSubarray(4));W=!0;ea()}function ja(R,P){var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(5);ma.skipPosition(1);ma.setLittleEndian16(4);ma.setLittleEndian16(R);ma.setByte(P);ma.skipPosition(1);ma.markEnd();u&&aa.send(ma)}function Z(R){W=!1;var P=x-8,ma=Date.now();R.copyFromByteArray(qa,0,R.getPosition(),4);nc(R,Q,Y,P);R=Y+(Date.now()-ma);ja(R,Q)}function ha(R){var P=Date.now();Y=R.getLittleEndian16();M=
R.getLittleEndian16();Q=R.getByte();R.skipPosition(7);ea();R=nc(R,Q,Y,0);R*=1E3;P=Y+(Date.now()-P)+R;ja(P,Q)}if(W)Z(T);else{var ra=T.getByte();T.skipPosition(1);x=T.getLittleEndian16();switch(ra){case 7:E(T);break;case 6:da(T);break;case 2:U(T);break;case 3:T.getLittleEndian16();T.getLittleEndian16();break;case 13:ha(T)}}};return aa}(e,0==n.mode));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var w=svGlobal.DCVC_EXTENSION;w.WEBAUTHN=function(v){function u(){if(Y){var M=Error("Cancelling existing WebAuthn API call for new one");
M.name="WebAuthnAbortError";Y.abort(M)}Y=new AbortController;return Y.signal}function W(){if(Y){var M=Error("Manually cancelling existing WebAuthn API call");M.name="WebAuthnAbortError";Y.abort(M);Y=void 0}}var x=new v;x.name="WebAuthN_Channel";x.newInstance=function(){return w.WEBAUTHN(v)};x.onopen=function(){svGlobal.logger.info("webAuthn open")};x.onclose=function(){svGlobal.logger.info("webAuthn close")};var Y=null;x.process=function(M){var Q=M.getEnd()-M.getPosition();M=M.getBytes(Q);var O=Ib(M),
qa=O.command;Q=O.flags;M=O.timeout;var aa=O.webAuthNPara;if(qa)switch(console.log("==== command: "+O.command),qa){case 5:if(O.request)switch(qa=O.request[0],console.log("==== webAuth cmdType = "+qa),console.log("==== webAuth request bytes: "+Gd(O.request.slice(1,O.request.length))),qa){case 1:O=O.request.slice(1,O.request.length);var T=Ib(O);O=T[1];var E=T[2],da=T[3],ea=T[4],U=T[5];qa=T[6];var ja=T[7];T={};var Z=Cd(aa);Z&&(Z.attestation&&(T.attestation=Z.attestation),Z.attestationFormats&&(T.attestationFormats=
Z.attestationFormats));if(Q=Bd(Q,aa,ja))T.authenticatorSelection=Q;T.challenge=O;U&&(T.excludeCredentials=Gc(U));T.rpId=E.id;T.rp=E;T.extensions=qa?qa:{};T.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};ea&&(T.pubKeyCredParams=ea);M&&(T.timeout=M);T.user=da;M={};M.signal=u();M.publicKey=T;navigator.credentials.create(M).then(function(ha){Dd(ha.response,E).then(function(ra){var R={},P={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",
providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},ma=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);P.aaGuid=ma.buffer;P.residentKey=!0;R.deviceInfo=P;R.status=0;R.response=ra;ra=CBOR.encode(R);R=new hi5.DataBuffer(new Uint8Array(4+ra.byteLength));R.setLittleEndian32(0);R.setBytes(ra);R.markEnd();x.send(R)})}).catch(function(ha){console.log("WebAuthN MakeCredential failed with error code ["+
ha.code+"], msg: "+ha.message);ha=new hi5.DataBuffer(new Uint8Array(4));ha.setLittleEndian32(1);ha.markEnd();x.send(ha)});break;case 2:O=O.request.slice(1,O.request.length);T=Ib(O);O=T[2];da=T[3];qa=T[4];ja=T[5];T={};da&&(T.allowCredentials=Gc(da));T.challenge=O;qa&&(T.extensions=qa);T.rp=window.location.hostname;M&&(T.timeout=M);if(M=Fc(Q,aa,ja))T.userVerification=M;M={};M.signal=u();M.publicKey=T;navigator.credentials.get(M).then(function(ha){ha=new hi5.DataBuffer(new Uint8Array(void 0));ha.markEnd();
x.send(ha)}).catch(function(ha){console.log("WebAuthN GetAssertion failed with error code ["+ha.code+"], msg: "+ha.message);ha=new hi5.DataBuffer(new Uint8Array(4));ha.setLittleEndian32(1);ha.markEnd();x.send(ha)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+qa)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:M=new hi5.DataBuffer(new Uint8Array(8));M.setLittleEndian32(0);Q=Ec()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():
!1;Q?M.setLittleEndian32(1):M.setLittleEndian32(0);M.markEnd();x.send(M);break;case 7:W();M=new hi5.DataBuffer(new Uint8Array(4));M.setLittleEndian32(0);M.markEnd();x.send(M);break;case 8:M=new hi5.DataBuffer(new Uint8Array(8));M.setLittleEndian32(0);M.setLittleEndian32(4);M.markEnd();x.send(M);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+qa)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return x};n.enableWebAuthn()&&Ec()&&(a=w.WEBAUTHN(n.DynamicChannel),
n.addDynamicChannel(a));d&&(d=w.WEBCAM(n.DynamicChannel),a=w.WEBCAM_ENUM(n.DynamicChannel,d),n.addDynamicChannel(a),n.addDynamicChannel(d));g&&(svGlobal.logger.info("Mapping USB..."),n.addDynamicChannel(Ia.usbChannel));if(b&&w.GFX){var y=function(){ab.drawable.resumePlay||(ab.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();ab.resumeVideo()})};ab=w.GFX(n.DynamicChannel,S(L.remotefx)&&!S(L.gfx),0==n.mode,sa,L.hardwareAcceleration,S(L.yuv444)&&hi5.browser.supportsI444);ab.onmessage=
function(v){n.showMessage(v)};y();ab.onuserinteract=function(v){ia.execute("showPlay");y();svGlobal.logger.info("resumePlay");return!0};ab.onfatalerror=function(v,u){n.reconnect(v.width,v.height,!0)};ab.onsps=function(v){v.fps&&n.setFPS(v.fps)};ab.onresetgraphic=function(v){n.setResolution(v.width,v.height)};ab.onmapsurface=function(v){ab.onconfirm();var u=ia.getMonitorSurface(v.outputOriginX,v.outputOriginY,v.targetWidth+v.outputOriginX-1,v.targetHeight+v.outputOriginY-1);u?(u.setId(v.id),u.setSize(v.targetWidth,
v.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+v.outputOriginX+" y:"+v.outputOriginY)};ab.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ia.execute("setDrawable",[ab.drawable])};n.addDynamicChannel(ab)}w.VOR&&(b=w.VOR(n.DynamicChannel),n.addDynamicChannel(b[0]),n.addDynamicChannel(b[1]),n.addDynamicChannel(w.GT(n.DynamicChannel)))}}},eb=null;svGlobal.DCVC_EXTENSION&&!lb&&(n.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ia.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(n.DynamicChannel)),
svGlobal.DCVC_EXTENSION.DRIVE&&(eb=svGlobal.DCVC_EXTENSION.DRIVE(n.GatewayChannel),n.addGatewayChannel(eb)));this.getPrinters=function(a){if(!n.onagentmessage||!eb)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();n.onagentmessage(b.getData());eb.listCallback=a};this.attachPrinter=function(a){eb&&eb.attachPrinter(a,n)};this.showError=Hb;this.resetStatus=ec;this.exeAppCmd=function(a){var b=ia.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;
(b=hi5.tool.isNumber(a)?ia.getWinById(a):ia.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ka.forceReconnect||!1);if(!Ja&&!c)return!1;L.minWidth&&a<L.minWidth&&(a<L.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+L.minWidth),a=L.minWidth);L.minHeight&&b<L.minHeight&&(b<L.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+L.minHeight),b=L.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-
Ka)&&4>Math.abs(b-La))return!1;if(Sa&&Sa.enabled&&!1!==ka.displayVC)Sa.applyResolution(a,b);else if(qc&&rb||c||Xa&&!qc)rb=!1,svGlobal.logger.info("reconnecting..."),wa("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));wa(a)};this.getUploadManager=function(){return Oa};this.setFPS=function(a){ia.execute("setFPS",[a])};this.addSurface=function(a){if(!ia.hasSurface(a)&&(Nb||sa.setContext(a.context),!ia.hasSurface(a)||
!a.railWin)){lb&&a.setPlayerMode();L.mouseMoveEmu&&(a.mouseMoveEmu=S(L.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ka&&(Ka=b.width);0==La&&(La=b.height);a.setConfig(ka);ia.addSurface(a);Pa(Ka,La,!0,L.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Xd);a.setTouchpad(S(L.touchpad));var c=b=S(L.mapClipboard),e=b;void 0!=L.copyToLocal?c=S(L.copyToLocal):void 0!=ka.copyToLocal&&(c=ka.copyToLocal);void 0!=L.copyToRemote?e=S(L.copyToRemote):void 0!=ka.copyToRemote&&(e=ka.copyToRemote);
a.setClipboard(b,c,e);Mb&&fc(a);L.invitation&&!S(L.control)&&(ia.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=L.ctrlToWin?S(L.ctrlToWin):void 0!=ka.ctrlToWin?ka.ctrlToWin:!0;c=void 0!=L.cmdToCtrl?S(L.cmdToCtrl):void 0!=ka.cmdToCtrl?ka.cmdToCtrl:!0;a.run(parseInt(L.keyboard||1033,10),b,!!ka.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ia.size();b<c;b++)ia.getSurface(b).railWin.getMain(ia.zOrders)&&a.push(ia.getSurface(b).railWin.getMain(ia.zOrders).titleInfo);
return a};this.startApp=function(a,b,c){b=b||"";c=c||"";wa("8C2"+a+"\t"+b+"\t"+c);var e=ia.getSurface(ia.size()-1);e&&(e.remoteApp=new Dc(a,b,c))};this.startExitingApp=function(a){a=ia.popWins(a);for(var b=a.length-1;0<=b;b--)ia.addWin(a[b])};var xb=new n.DynamicChannel;xb.name="PNPDR";xb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};xb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),
a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),xb.send(a)}};xb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};n.addDynamicChannel(xb);var hb=null;S(L.scanner)&&(hb=new n.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);
b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(n.onagentmessage)n.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(n.onagentmessage)n.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(n.onagentmessage)n.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+
'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addDynamicChannel(hb));var bb=null;n.hasSmartCard()&&(bb=new n.GatewayChannel,bb.name="SCARDSTB",bb.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(n.onagentmessage)n.onagentmessage(a);S(L.passwordIsPin)&&n.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",
type:0,timeout:1E4})},bb.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(n.onagentmessage)n.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;yb&&(b+=yb.length);fb&&(b+=fb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);yb?(b.setLittleEndian32(yb.length),b.setBytes(yb)):b.setLittleEndian32(0);fb?(b.setLittleEndian32(fb.length),b.setBytes(fb)):b.setLittleEndian32(0);
b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(n.onagentmessage)n.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(n.onagentmessage)n.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(bb)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),n.onagentmessage)n.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},bb.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addGatewayChannel(bb));r+="&connectType=7";(function(){var a=0,b=0,c=new n.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),g=e.getLittleEndian16(),
p=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(p){case 1:case 4097:p=new RdpBuffer(new Uint8Array(6),0,6);p.setByte(6);p.setByte(1);p.setLittleEndian16(g);p.setLittleEndian16(0);p.markEnd();c.send(p);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:g=e.getLittleEndian16();a+=g;break;case 43:case 1065:case 1577:43==p&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),
0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(g);d.setLittleEndian16(43==p?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:g=e.getLittleEndian32();p=e.getLittleEndian32();e=e.getLittleEndian32();sc={baseRTT:g,bandwidth:p,averageRTT:e};if(n.onnetworkresult)n.onnetworkresult(sc);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};n.addGatewayChannel(c)})();
this.getNetworkResult=function(){return sc};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var gc=new Map,hc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(bb){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));
switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;bb.send(a);break;case 8:gc.clear();hc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",
b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var p=b.getLittleEndian32();p=b.getAscllString(p,!1);var J=b.getLittleEndian32();b.getAscllString(J,!1);J=b.getLittleEndian64();J=(new Date(1E3*
J)).toDateString();d=Hd(a,d,p,g,J);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var B,F=document.querySelector('input[name="scard_name"]:checked');F&&(B=parseInt(F.value));yb=gc.get(B);sb=hc.get(B);B=document.getElementById("userPin").value;
fb=(new TextEncoder("utf-8")).encode(B);B=2;B=fb?B+4+fb.length:B+4;B=sb?B+4+sb.length:B+4;B=new Uint8Array(B);B=new hi5.DataBuffer(B);B.setByte(1);B.setByte(2);fb?(B.setLittleEndian32(fb.length),B.setBytes(fb)):B.setLittleEndian32(0);sb?(B.setLittleEndian32(sb.length),B.setAsciiString(sb,sb.length)):B.setLittleEndian32(0);bb&&bb.send(B)};document.getElementById("userPin").addEventListener("keypress",function(B){"Enter"===B.key&&(B.preventDefault(),document.getElementById("continue_button").click())});
b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),bb.send(b));break;case 12:a[0]=1;a[1]=6;bb.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML=
"<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,n.onagentmessage)n.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=
b.getAscllString(41,!0),d=Id(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var B=0,F=document.querySelector('input[name="ds_name"]:checked');F&&(B=F.value);F=new Uint8Array(3);F[0]=4;F[1]=5;F[2]=B;if(n.onagentmessage)n.onagentmessage(F)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();n.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>
b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=n.getAgentLink(),hi5.notifications.notify({title:b,html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)g=b.getLittleEndian32(),d=b.getUnicodeString(g),g=b.getLittleEndian32(),g=b.getUnicodeString(g),c.push({name:d,driver:g});
eb&&eb.listCallback&&(eb.listCallback(c),eb.listCallback=null)}break;case 7:eb.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var yb,fb,sb,jc={type:6,data:null};this.setAgentStatus=function(a){Yc=a};this.getAgentStatus=function(){return Yc};this.run=function(){var a;if(a=null==n.onagentmessage)a=1==n.mode?!1:n.hasSmartCard()||n.hasScanner()||S(L.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(n):(n.hasUSB()?ia.getFocused().requestUsbDevices(n.getUSB(),
function(b){Ia.usbChannel.openDevices(b);Jb()}):Jb(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return sa};this.mouseDown=function(a,b,c){Xa&&wa("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Xa&&wa("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Xa&&wa("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Xa&&wa("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Xa&&("number"==typeof a?(wa("840\t"+a),wa("8449152\t"+a)):wa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,
b){n.reconnectOnResize&&(Va?(ob&&(clearTimeout(ob),ob=0),a&=-4,b&=-4,ob=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){n.writeRawInput("8C661441\t"+a+"\t"+b);3==n.windowState&&Wc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):n.running()&&(ob&&(clearTimeout(ob),ob=0),ob=setTimeout(function(){document.hidden||n.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!n.sessionInfo.suppressOutput)return!1;
void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=ac,b[4]=ac>>8,b[5]=$b,b[6]=$b>>8,b[7]=bc,b[8]=bc>>8,b[9]=cc,b[10]=cc>>8);wa(b.buffer);return!0};this.refreshOutput=function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);wa(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);wa(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||
(Qa=new hi5.tool.ResponseMonitor(function(){Xa&&n.sendPing()},function(){if(Xa&&n.onnoresponse)return n.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;wa(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ma?Ma.postMessage({type:0,cmd:6,start:1}):(Ga.onSlowPath=Ga.onFastPath=Nc,Ga.onReqHistory=function(){Nc(15555)})};this.stopPing=function(){Qa&&Qa.stop();Ma?Ma.postMessage({type:0,cmd:6,start:0}):Ga.onSlowPath=Ga.onFastPath=Ga.onReqHistory=null};
var $a=null,Tc=0;this.play=function(){wa("F3")};this.pause=function(){wa("F2")};this.scan=function(a){wa("F4"+(a?"1":"0"))};this.seek=function(a){var b=ia.getFocused();b&&Ja&&(wa("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),sa&&sa.pause(!0,void 0))};var Da={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,sampleRate:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=
a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Sc=!1;this.showMessage=function(a,b,c){n&&n.displayMsg&&a&&((b=b||ia.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(){svGlobal.logger.info("closing...");Ja&&Va&&ia&&ka.closeRemoteApp&&ia.tryCloseRemoteApps();sa&&sa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),
setTimeout(Vc,2222)):Vc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(n.close):window.addEventListener("unload",n.close,!1);Ob.searchStartCode=function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};rc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Pb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
Pb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d,g){function p(E,da,ea,U){this.pixels=E;this.width=da;this.height=ea;this.key=U}function J(){this.bottom=this.right=this.top=this.left=0;this.read=function(E){this.left=E.getLittleEndian16();this.top=E.getLittleEndian16();this.right=E.getLittleEndian16();this.bottom=E.getLittleEndian16()};this.toString=
function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function B(){this.qualityVal=this.p=this.qb=0;this.read=function(E){var da=E.getByte();this.qp=da&63;this.p=da>>7&1;this.qualityVal=E.getByte()}}function F(E,da,ea){this.bitstream=E;this.regionRects=da;this.isChroma=ea;this.timestamp=0}function H(E,da,ea){this.width=E;this.height=da;this.monitors=ea}function w(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(E){this.left=
E.getLittleEndian32();this.top=E.getLittleEndian32();this.right=E.getLittleEndian32();this.bottom=E.getLittleEndian32();this.flags=E.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function y(E,da,ea,U,ja){function Z(){ma=!1;Ea.drawable=R._video;R._player=ha?new Vd(R,!1,U,ja):new Pb(Ea.drawable,R,!1);R._player.onsps=function(k){console.log("*** SPS: "+k.width+"x"+k.height+" smooth:"+ra.imageSmoothingEnabled);
ha&&(R._video.width=k.width,R._video.height=k.height);R.onsps&&R.onsps(k)};R._player.onerror=function(k){R.onfatalerror&&R.onfatalerror(R,k)};R._player.onplayerror=function(k){function f(){Ea={drawable:R._video};R.player.play(!0)}Ea=null;if((!R.onuserinteract||!R.onuserinteract(f,"video"))&&R.onmessage)R.onmessage({msg:"Please click Yes to continue.<br>"+k,cbYes:function(){R.player.play(!0);this.destroy()}})};R._player.onframedecoded=function(k,f){if(!l)if(f)for(var q=f.length,t=0;t<q;t++){var A=
f[t],C=A.right-A.left,z=A.bottom-A.top;ra.drawImage(k,A.left,A.top,C,z,A.left,A.top,C,z)}else ra.drawImage(k,0,0)}}this.id=E;this.width=da;this.height=ea;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=da;this.targetHeight=ea;this._player=null;var ha="no-decoder"==U?!1:!!window.VideoDecoder;this._video=ha?new OffscreenCanvas(da,ea):document.createElement("video");var ra=ha?this._video.getContext("2d",{alpha:!1,desynchronized:!0,antialias:!1,powerPreference:"high-performance"}):
null,R=this,P=null,ma=!0,Ea={drawable:null},h=10,l=!1;ha&&(svGlobal.logger.info("...MediaDecoder in use: "+U),ra.imageSmoothingEnabled=!1);this.pause=function(k,f){l=k;f&&ra&&ra.fillRect(0,0,_screen.width,_screen.height)};this.resumeVideo=function(){R._player&&R._player.play(!0)};this.setDisplayBuffer=function(k){P=k};this.draw=function(k,f,q,t){return ma?P.draw(k,f,q,t):Ea};this.processAvc=function(k){ma&&Z();if(ha)k.timestamp=h,h+=10;else if(k.isChroma)return;R.onvideoframe(k)};this.reset=function(k,
f){R&&R._player&&R._player.reset()};this.close=function(){R&&R._player&&(R._player.close(),R._player=null);R=null};this.setRGBs=function(k,f,q,t,A,C,z){P.setRGBs(k,f,q,t,A,C,z)};this.getRGBs=function(k,f,q,t){return P.getRGBs(k,f,q,t)};this.moveArea=function(k,f,q,t,A,C){P.moveArea(k,f,q,t,A,C)};this.fillRect=function(k,f,q,t,A){P.fillRect(k,f,q,t,A)};this.postPaint=function(k,f,q,t){ma&&P.postPaint(k,f,q,t)}}function v(E,da,ea,U){var ja=new y(E,da,ea,d,g);ja.pixelFormat=U||33;ja.setDisplayBuffer(e);
T.push(ja);aa.oncreatesurface&&aa.oncreatesurface(ja);svGlobal.logger.info("create surface id:"+E+" w:"+da+" h:"+ea+" pixelFmt:"+ja.pixelFormat);return ja}function u(E,da,ea){for(var U=E.getPosition(),ja=E.getLittleEndian32(),Z=Array(ja),ha=0;ha<ja;ha++){var ra=new J;ra.read(E);Z[ha]=ra}ra=Array(ja);for(ha=0;ha<ja;ha++){var R=new B;R.read(E);ra[ha]=R}E=E.getBytes(da-(E.getPosition()-U));return new F(E,Z,ea)}function W(E,da,ea,U){ea=E.getLittleEndian32();var ja=ea>>>30;ea&=1073741823;switch(ja){case 0:var Z=
u(E,ea,!1);var ha=u(E,da-ea-4,!0);break;case 1:Z=u(E,ea,!1);break;case 2:da=E.getEnd()-E.getPosition();ha=u(E,da,!0);break;default:console.error("Invalid LC: "+ja)}Z&&U.processAvc(Z);ha&&U.processAvc(ha)}var x=new function(){function E(f,q,t,A,C){this.len=f;this.code=q;this.valueBits=t;this.type=A;this.vbase=C}function da(f){var q=25E5-Z,t=f.length;if(q>=t)ja.set(f,Z),Z=q>t?Z+t:0;else if(25E5>=t)ja.set(f.subarray(0,q),Z),ja.set(f.subarray(q),0),Z=t-q;else{q=(t-q)%25E5;var A=t-q,C=f.subarray(A);f=
f.subarray(t-25E5,A);ja.set(f,25E5-f.length);ja.set(C,0);Z=q}}function ea(f){for(;ma<f;)P<<=8,Ea<l?P+=h[Ea++]:console.log("--- end"),ma+=8;R-=f;ma-=f;f=P>>ma;P&=(1<<ma)-1;return f}var U=[new E(1,0,8,0,0),new E(5,17,5,1,0),new E(5,18,7,1,32),new E(5,19,9,1,160),new E(5,20,10,1,672),new E(5,21,12,1,1696),new E(5,24,0,0,0),new E(5,25,0,0,1),new E(6,44,14,1,5792),new E(6,45,15,1,22176),new E(6,52,0,0,2),new E(6,53,0,0,3),new E(6,54,0,0,255),new E(7,92,18,1,54944),new E(7,93,20,1,317088),new E(7,110,0,
0,4),new E(7,111,0,0,5),new E(7,112,0,0,6),new E(7,113,0,0,7),new E(7,114,0,0,8),new E(7,115,0,0,9),new E(7,116,0,0,10),new E(7,117,0,0,11),new E(7,118,0,0,58),new E(7,119,0,0,59),new E(7,120,0,0,60),new E(7,121,0,0,61),new E(7,122,0,0,62),new E(7,123,0,0,63),new E(7,124,0,0,64),new E(7,125,0,0,128),new E(8,188,20,1,1365664),new E(8,189,21,1,2414240),new E(8,252,0,0,12),new E(8,253,0,0,56),new E(8,254,0,0,57),new E(8,255,0,0,102),new E(9,380,22,1,4511392),new E(9,381,23,1,8705696),new E(9,382,24,
1,17094304)],ja=new Uint8Array(25E5),Z=0,ha=new Uint8Array(65536),ra=0,R=0,P=0,ma=0,Ea=0,h=null,l=0,k=!0;this.toPDU=function(f){if(k)return null;30==f&&n.reconnect(n.widthRdp,n.heightRdp,!0);var q=new Uint8Array(2500008);q[0]=f;q[2]=1;q[3]=10;q[4]=Z;q[5]=Z>>8;q[6]=Z>>16;q[7]=Z>>24;q.set(ja,8);return q};this.fromStream=function(f){Z=f.getLittleEndian32();ja.set(f.getSubarray(25E5))};this.decompress=function(f,q){if(q){h=f;k&&(k=!1);l=h.length-1;R=8*l-h[l];for(ra=Ea=ma=P=0;0<R;)for(var t=q=0,A=0;A<
U.length;A++){for(f=U[A];q<f.len;)t=(t<<1)+ea(1),q++;0>t&&console.log("xxx inPrefix");if(t==f.code){if(0==f.type)f=f.vbase+ea(f.valueBits),(0>f||255<f)&&console.log("xxx do c"),f&=255,ja[Z]=f,25E5==++Z&&(Z=0),ha[ra++]=f;else if(q=ea(f.valueBits),q=f.vbase+q,0>q&&console.log("xxx distance"),0!=q){if(0==ea(1))f=3;else{f=4;for(t=2;1==ea(1);)f*=2,t++;f+=ea(t)}q=25E5-q+Z;q%=25E5;t=q+f;if(Math.abs(Z-q)>=f&&25E5>t&&25E5>Z+f)q=ja.subarray(q,t),ja.set(q,Z),Z+=f,ha.set(q,ra),ra+=f;else for(;0<f;)t=ja[q],25E5==
++q&&(q=0),ja[Z]=t,25E5==++Z&&(Z=0),ha[ra++]=t,f--}else f=ea(15),R-=ma,P=ma=0,q=h.subarray(Ea,Ea+f),da(q),ha.set(q,ra),Ea+=f,ra+=f,R-=8*f;break}}65536<ra&&console.error("xx outputIndex:"+ra);return ha.subarray(0,ra)}da(f);return f}},Y=new function(){this.process=function(E){var da=E.getByte();if(224==da){var ea=0!=(E.getByte()&32);var U=E.getPosition(),ja=E.getEnd();da=x.decompress(E.getData().subarray(U,ja),ea);E.setPosition(ja)}else{225!=da&&console.log("Invalid descriptor:"+da);ja=E.getLittleEndian16();
var Z=E.getLittleEndian32();da=new Uint8Array(Z);for(var ha=0,ra,R=0;R<ja;R++)ra=E.getLittleEndian32(),ea=0!=(E.getByte()&32),ra--,U=E.getPosition(),ea=x.decompress(E.getData().subarray(U,U+ra),ea),da.set(ea,ha),ha+=ea.length,E.skipPosition(ra);ha!=Z&&console.error("wrong size, actual:"+ha+" expected:"+Z)}return new RdpBuffer(da,0,da.length)}},M=null,Q=new rdpcodecs.RemoteFX(!1),O=0,qa=[],aa=new a;aa.name="Microsoft::Windows::RDS::Graphics";var T=new function(E,da){var ea=[];this.push=function(U){U.onsps=
E.onsps;U.onfatalerror=E.onfatalerror;U.onplayerror=E.onplayerror;U.onuserinteract=E.onuserinteract;U.onmessage=E.onmessage;ea[U.id]=U};this.get=function(U){return ea[U]};this.getAll=function(){return ea};this.delete=function(U){var ja=ea[U];ja&&(ja.onsps=null,ja.onfatalerror=null,ja.onplayerror=null,ea[U]=null)};this.reset=function(U){U=0;for(var ja=ea.length;U<ja;U++)ea[U]&&ea[U].reset()};this.close=function(){for(var U=0,ja=ea.length;U<ja;U++)ea[U]&&ea[U].close()};this.resumeVideo=function(){for(var U=
0,ja=ea.length;U<ja;U++)ea[U]&&ea[U].resumeVideo()};da.pause=function(U,ja){for(var Z=0,ha=ea.length;Z<ha;Z++)ea[Z]&&ea[Z].pause(U,ja)}}(aa,e);aa.drawable=new function(){this.draw=function(E,da,ea,U,ja){return(ja=T.get(ja))?ja.draw(E,da,ea,U):null};this.getSurfaces=function(){return T};this.onfocus=function(E){};this.resumePlay=null};aa.resumeVideo=function(){T.resumeVideo()};aa.process=function(E){for(var da=Y.process(E);da.has(8);){var ea=da.getLittleEndian16();da.getLittleEndian16();var U=da.getLittleEndian32(),
ja=da.getPosition()+U-8;switch(ea){case 1:var Z=da,ha=Z.getLittleEndian16(),ra=Z.getLittleEndian16(),R=Z.getByte(),P=Z.getLittleEndian16(),ma=Z.getLittleEndian16(),Ea=Z.getLittleEndian16(),h=Z.getLittleEndian16(),l=Ea-P,k=h-ma,f=Z.getLittleEndian32(),q=Z.getPosition()+f,t=T.get(ha);t||(aa.onconfirm&&aa.onconfirm(),t=v(ha,e.width,e.height,R));switch(ra){case 0:var A=rdpcodecs.bitmap.byte2int(Z.getData(),f,Z.getPosition());t.setRGBs(P,ma,l,k,A,0,l);break;case 3:for(var C=Q.decode(Z,f),z=C.getRects(),
X=C.getTiles(),K=C.getTileSize(),m=C.getRectSize(),D=0;D<K;D++){var G=X[D];if(m)for(var N=G.x+64,ba=G.y+64,oa=0;oa<m;oa++){var ua=z[oa],Aa=ua.x+ua.width,Fa=ua.y+ua.height;N<=Aa?ba<=Fa?t.setRGBs(G.x+P,G.y+ma,64,64,G.data,0,64):t.setRGBs(G.x+P,G.y+ma,64,Fa-G.y,G.data,0,64):ba<=Fa?t.setRGBs(G.x+P,G.y+ma,Aa-G.x,64,G.data,0,64):t.setRGBs(G.x+P,G.y+ma,Aa-G.x,Fa-G.y,G.data,0,64)}else t.setRGBs(G.x,G.y,64,64,G.data,0,4)}break;case 8:M||(M=new ClearDecoder);M.decode(Z,l,k,t.getData(),P,ma,t.width);break;case 10:svGlobal.logger.info("...PLANAR");
break;case 11:var Ba=t,ya=u(Z,f,!1);Ba.processAvc(ya);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:W(Z,f,!1,t);break;case 15:W(Z,f,!0,t);break;default:svGlobal.logger.warn("Invalid codec:"+ra)}Z.setPosition(q);t.postPaint(P,ma,l,k);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ha=da;svGlobal.logger.info("...soliFill");for(var va=Ha.getLittleEndian16(),za=-16777216|Ha.getByte()<<
16|Ha.getByte()<<8|Ha.getByte()|Ha.getByte()<<24,Na=Ha.getLittleEndian16(),Ya=T.get(va),Za=0;Za<Na;Za++){var Wa=Ha.getLittleEndian16(),nb=Ha.getLittleEndian16(),wb=Ha.getLittleEndian16()-Wa,cd=Ha.getLittleEndian16()-nb;Ya.fillRect(Wa,nb,wb,cd,za);Ya.postPaint(Wa,nb,wb,cd)}break;case 5:var ib=da;svGlobal.logger.info("...surfaceToSurface");for(var dd=ib.getLittleEndian16(),ed=ib.getLittleEndian16(),Rb=ib.getLittleEndian16(),Sb=ib.getLittleEndian16(),Tb=ib.getLittleEndian16()-Rb,wc=ib.getLittleEndian16()-
Sb,Yd=ib.getLittleEndian16(),fd=T.get(dd),Zd=T.get(ed),gd=dd==ed?null:fd.getRGBs(Rb,Sb,Tb,wc),hd=0;hd<Yd;hd++){var id=ib.getLittleEndian16(),jd=ib.getLittleEndian16();gd?Zd.setRGBs(id,jd,Tb,wc,gd,0,Tb):fd.moveArea(Rb,Sb,Tb,wc,id-Rb,jd-Sb)}break;case 6:var pb=da;svGlobal.logger.info("...surfaceToCache");var $d=pb.getLittleEndian16(),xc=pb.getLittleEndian32().toString(16),kd=pb.getLittleEndian32();0<kd&&(xc=kd.toString(16)+xc);var ae=pb.getLittleEndian16(),ld=pb.getLittleEndian16(),md=pb.getLittleEndian16(),
nd=pb.getLittleEndian16()-ld,od=pb.getLittleEndian16()-md,be=T.get($d).getRGBs(ld,md,nd,od);qa[ae]=new p(be,nd,od,xc);break;case 7:var Eb=da;svGlobal.logger.info("...cacheToSurface");for(var ce=Eb.getLittleEndian16(),de=Eb.getLittleEndian16(),ee=Eb.getLittleEndian16(),Ub=qa[ce],fe=T.get(de),pd=0;pd<ee;pd++){var ge=Eb.getLittleEndian16(),he=Eb.getLittleEndian16();fe.setRGBs(ge,he,Ub.width,Ub.height,Ub.pixels,0,Ub.width)}break;case 8:var ie=da.getLittleEndian16();qa[ie]=null;break;case 9:var Vb=da,
je=Vb.getLittleEndian16(),ke=Vb.getLittleEndian16(),le=Vb.getLittleEndian16(),me=Vb.getByte();v(je,ke,le,me);break;case 10:var qd=da.getLittleEndian16();T.delete(qd);svGlobal.logger.info("delete surface id:"+qd);break;case 11:var rd=da;rd.getLittleEndian32();rd.getLittleEndian32();break;case 12:var ne=da.getLittleEndian32();if(0==O){var sd=new Uint8Array(20),tb=new RdpBuffer(sd);tb.setLittleEndian16(13);tb.setLittleEndian16(0);tb.setLittleEndian32(20);tb.setLittleEndian32(4294967295);tb.setLittleEndian32(ne);
O++;tb.setLittleEndian32(O);tb.markEnd();c&&aa.send(sd)}break;case 14:var Wb=da,td=Wb.getLittleEndian32(),ud=Wb.getLittleEndian32(),yc=Wb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+td+" h:"+ud+" monitors:"+yc);for(var vd=Array(yc),Xb=0;Xb<yc;Xb++){var zc=new w;zc.read(Wb);vd[Xb]=zc;svGlobal.logger.info("MonitorDef "+Xb+": "+zc.toString())}var wd=new H(td,ud,vd);T.reset(wd);aa.onresetgraphic&&aa.onresetgraphic(wd);break;case 15:var Yb=da,xd=Yb.getLittleEndian16();Yb.skipPosition(2);
var Fb=T.get(xd);Fb.outputOriginX=Yb.getLittleEndian32();Fb.outputOriginY=Yb.getLittleEndian32();aa.onmapsurface&&aa.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+xd+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var Ac=da,yd=Ac.getLittleEndian32(),oe=Ac.getLittleEndian32(),Gb=Ac.getLittleEndian32(),Zb=!1;switch(yd){case 524292:Zb=!1;0==(Gb&1)&&(M=new ClearDecoder);break;
case 524549:(Zb=0!=(Gb&16))||0!=(Gb&1)||(M=new ClearDecoder);break;default:Zb=0==(Gb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+yd.toString(16)+" len:"+oe+" flags:"+Gb+" h264:"+Zb);aa.onconfirm&&aa.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var zb=da,zd=zb.getLittleEndian16();zb.skipPosition(2);var jb=T.get(zd);jb.outputOriginX=zb.getLittleEndian32();jb.outputOriginY=zb.getLittleEndian32();jb.targetWidth=zb.getLittleEndian32();jb.targetHeight=zb.getLittleEndian32();
svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+zd+" outX:"+jb.outputOriginX+" outY:"+jb.outputOriginY+" targetW:"+jb.targetWidth+" targetH:"+jb.targetHeight);aa.onmapsurface&&aa.onmapsurface(jb);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+ea);return}da.setPosition(ja)}};aa.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var E=b?2:8,da=10+12*E,ea=new Uint8Array(da),U=new RdpBuffer(ea);U.setLittleEndian16(18);
U.setLittleEndian16(0);U.setLittleEndian32(da);U.setLittleEndian16(E);U.setLittleEndian32(524292);U.setLittleEndian32(4);U.setLittleEndian32(b?1:0);U.setLittleEndian32(524549);U.setLittleEndian32(4);U.setLittleEndian32(b?19:0);b||(U.setLittleEndian32(655362),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(655872),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(656129),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(656384),U.setLittleEndian32(4),
U.setLittleEndian32(0),U.setLittleEndian32(656642),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(656896),U.setLittleEndian32(4),U.setLittleEndian32(0));U.markEnd();c&&aa.send(ea)};aa.onclose=function(){T.close()};e.onGetGfxHistory=function(E,da,ea){var U=x.toPDU(E);U&&da(U);ea(E);svGlobal.logger.info("Got GFX Histroy")};e.onSetGfxHistory=function(E,da){svGlobal.logger.info("Set GFX Histroy");10==E?x.fromStream(da):svGlobal.logger.error("Invalid GFX histroy type: "+E)};return aa}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var r=navigator&&(navigator.language||navigator.userLanguage||""),I=Rdp.languageToKeyboard[r];if(!I){var V=r.indexOf("-");V&&(I=Rdp.languageToKeyboard[r.substring(0,V)])}I||(svGlobal.logger.info("No valid layout for "+r),I=1033);return I}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
