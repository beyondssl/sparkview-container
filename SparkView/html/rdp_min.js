var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(r){var I=0;return function(){return I<r.length?{done:!1,value:r[I++]}:{done:!0}}};$jscomp.arrayIterator=function(r){return{next:$jscomp.arrayIteratorImpl(r)}};$jscomp.makeIterator=function(r){var I="undefined"!=typeof Symbol&&Symbol.iterator&&r[Symbol.iterator];return I?I.call(r):$jscomp.arrayIterator(r)};$jscomp.arrayFromIterator=function(r){for(var I,T=[];!(I=r.next()).done;)T.push(I.value);return T};
$jscomp.arrayFromIterable=function(r){return r instanceof Array?r:$jscomp.arrayFromIterator($jscomp.makeIterator(r))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(r){var I=function(){};I.prototype=r;return new I};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(r,I,T){if(r==Array.prototype||r==Object.prototype)return r;r[I]=T.value;return r};$jscomp.getGlobal=function(r){r=["object"==typeof globalThis&&globalThis,r,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var I=0;I<r.length;++I){var T=r[I];if(T&&T.Math==Math)return T}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(r,I){var T=$jscomp.propertyToPolyfillSymbol[I];if(null==T)return r[I];T=r[T];return void 0!==T?T:r[I]};
$jscomp.polyfill=function(r,I,T,na){I&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(r,I,T,na):$jscomp.polyfillUnisolated(r,I,T,na))};$jscomp.polyfillUnisolated=function(r,I,T,na){T=$jscomp.global;r=r.split(".");for(na=0;na<r.length-1;na++){var R=r[na];if(!(R in T))return;T=T[R]}r=r[r.length-1];na=T[r];I=I(na);I!=na&&null!=I&&$jscomp.defineProperty(T,r,{configurable:!0,writable:!0,value:I})};
$jscomp.polyfillIsolated=function(r,I,T,na){var R=r.split(".");r=1===R.length;na=R[0];na=!r&&na in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ya=0;ya<R.length-1;ya++){var da=R[ya];if(!(da in na))return;na=na[da]}R=R[R.length-1];T=$jscomp.IS_SYMBOL_NATIVE&&"es6"===T?na[R]:null;I=I(T);null!=I&&(r?$jscomp.defineProperty($jscomp.polyfills,R,{configurable:!0,writable:!0,value:I}):I!==T&&($jscomp.propertyToPolyfillSymbol[R]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(R):$jscomp.POLYFILL_PREFIX+
R,R=$jscomp.propertyToPolyfillSymbol[R],$jscomp.defineProperty(na,R,{configurable:!0,writable:!0,value:I})))};
$jscomp.getConstructImplementation=function(){function r(){function T(){}new T;Reflect.construct(T,[],function(){});return new T instanceof T}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(r())return Reflect.construct;var I=Reflect.construct;return function(T,na,R){T=I(T,na);R&&Reflect.setPrototypeOf(T,R.prototype);return T}}return function(T,na,R){void 0===R&&(R=T);R=$jscomp.objectCreate(R.prototype||Object.prototype);return Function.prototype.apply.call(T,R,na)||
R}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var r={a:!0},I={};try{return I.__proto__=r,I.a}catch(T){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(r,I){r.__proto__=I;if(r.__proto__!==I)throw new TypeError(r+" is not extensible");return r}:null;
$jscomp.inherits=function(r,I){r.prototype=$jscomp.objectCreate(I.prototype);r.prototype.constructor=r;if($jscomp.setPrototypeOf){var T=$jscomp.setPrototypeOf;T(r,I)}else for(T in I)if("prototype"!=T)if(Object.defineProperties){var na=Object.getOwnPropertyDescriptor(I,T);na&&Object.defineProperty(r,T,na)}else r[T]=I[T];r.superClass_=I.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(r){if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(r){this.yieldResult=r};
$jscomp.generator.Context.prototype.throw_=function(r){this.abruptCompletion_={exception:r,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(r){this.abruptCompletion_={return:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(r){this.abruptCompletion_={jumpTo:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(r,I){this.nextAddress=I;return{value:r}};
$jscomp.generator.Context.prototype.yieldAll=function(r,I){r=$jscomp.makeIterator(r);var T=r.next();$jscomp.generator.ensureIteratorResultIsObject_(T);if(T.done)this.yieldResult=T.value,this.nextAddress=I;else return this.yieldAllIterator_=r,this.yield(T.value,I)};$jscomp.generator.Context.prototype.jumpTo=function(r){this.nextAddress=r};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(r,I){this.catchAddress_=r;void 0!=I&&(this.finallyAddress_=I)};$jscomp.generator.Context.prototype.setFinallyBlock=function(r){this.catchAddress_=0;this.finallyAddress_=r||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(r,I){this.nextAddress=r;this.catchAddress_=I||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(r){this.catchAddress_=r||0;r=this.abruptCompletion_.exception;this.abruptCompletion_=null;return r};$jscomp.generator.Context.prototype.enterFinallyBlock=function(r,I,T){T?this.finallyContexts_[T]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=r||0;this.finallyAddress_=I||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(r,I){I=this.finallyContexts_.splice(I||0)[0];if(I=this.abruptCompletion_=this.abruptCompletion_||I){if(I.isException)return this.jumpToErrorHandler_();void 0!=I.jumpTo&&this.finallyAddress_<I.jumpTo?(this.nextAddress=I.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=r};$jscomp.generator.Context.prototype.forIn=function(r){return new $jscomp.generator.Context.PropertyIterator(r)};
$jscomp.generator.Context.PropertyIterator=function(r){this.object_=r;this.properties_=[];for(var I in r)this.properties_.push(I);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var r=this.properties_.pop();if(r in this.object_)return r}return null};$jscomp.generator.Engine_=function(r){this.context_=new $jscomp.generator.Context;this.program_=r};
$jscomp.generator.Engine_.prototype.next_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,r,this.context_.next_);this.context_.next_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(r){this.context_.start_();var I=this.context_.yieldAllIterator_;if(I)return this.yieldAllStep_("return"in I?I["return"]:function(T){return{value:T,done:!0}},r,this.context_.return);this.context_.return(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],r,this.context_.next_);this.context_.throw_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(r,I,T){try{var na=r.call(this.context_.yieldAllIterator_,I);$jscomp.generator.ensureIteratorResultIsObject_(na);if(!na.done)return this.context_.stop_(),na;var R=na.value}catch(ya){return this.context_.yieldAllIterator_=null,this.context_.throw_(ya),this.nextStep_()}this.context_.yieldAllIterator_=null;T.call(this.context_,R);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var r=this.program_(this.context_);if(r)return this.context_.stop_(),{value:r.value,done:!1}}catch(I){this.context_.yieldResult=void 0,this.context_.throw_(I)}this.context_.stop_();if(this.context_.abruptCompletion_){r=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(r.isException)throw r.exception;return{value:r.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(r){this.next=function(I){return r.next_(I)};this.throw=function(I){return r.throw_(I)};this.return=function(I){return r.return_(I)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(r,I){I=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(I));$jscomp.setPrototypeOf&&r.prototype&&$jscomp.setPrototypeOf(I,r.prototype);return I};
$jscomp.asyncExecutePromiseGenerator=function(r){function I(na){return r.next(na)}function T(na){return r.throw(na)}return new Promise(function(na,R){function ya(da){da.done?na(da.value):Promise.resolve(da.value).then(I,T).then(ya,R)}ya(r.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(r){return $jscomp.asyncExecutePromiseGenerator(r())};$jscomp.asyncExecutePromiseGeneratorProgram=function(r){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(r)))};
$jscomp.polyfill("Reflect",function(r){return r?r:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(r){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(r){if(r)return r;if($jscomp.setPrototypeOf){var I=$jscomp.setPrototypeOf;return function(T,na){try{return I(T,na),!0}catch(R){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(r){if(r)return r;var I=function(R,ya){this.$jscomp$symbol$id_=R;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ya})};I.prototype.toString=function(){return this.$jscomp$symbol$id_};var T=0,na=function(R){if(this instanceof na)throw new TypeError("Symbol is not a constructor");return new I("jscomp_symbol_"+(R||"")+"_"+T++,R)};return na},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(r){if(r)return r;r=Symbol("Symbol.iterator");for(var I="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),T=0;T<I.length;T++){var na=$jscomp.global[I[T]];"function"===typeof na&&"function"!=typeof na.prototype[r]&&$jscomp.defineProperty(na.prototype,r,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return r},"es6",
"es3");$jscomp.iteratorPrototype=function(r){r={next:r};r[Symbol.iterator]=function(){return this};return r};
$jscomp.polyfill("Promise",function(r){function I(){this.batch_=null}function T(da){return da instanceof R?da:new R(function(ta,fa){ta(da)})}if(r&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return r;I.prototype.asyncExecute=function(da){if(null==this.batch_){this.batch_=[];var ta=this;this.asyncExecuteFunction(function(){ta.executeBatch_()})}this.batch_.push(da)};
var na=$jscomp.global.setTimeout;I.prototype.asyncExecuteFunction=function(da){na(da,0)};I.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var da=this.batch_;this.batch_=[];for(var ta=0;ta<da.length;++ta){var fa=da[ta];da[ta]=null;try{fa()}catch(ma){this.asyncThrow_(ma)}}}this.batch_=null};I.prototype.asyncThrow_=function(da){this.asyncExecuteFunction(function(){throw da;})};var R=function(da){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var ta=this.createResolveAndReject_();try{da(ta.resolve,ta.reject)}catch(fa){ta.reject(fa)}};R.prototype.createResolveAndReject_=function(){function da(ma){return function(qa){fa||(fa=!0,ma.call(ta,qa))}}var ta=this,fa=!1;return{resolve:da(this.resolveTo_),reject:da(this.reject_)}};R.prototype.resolveTo_=function(da){if(da===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(da instanceof R)this.settleSameAsPromise_(da);else{a:switch(typeof da){case "object":var ta=
null!=da;break a;case "function":ta=!0;break a;default:ta=!1}ta?this.resolveToNonPromiseObj_(da):this.fulfill_(da)}};R.prototype.resolveToNonPromiseObj_=function(da){var ta=void 0;try{ta=da.then}catch(fa){this.reject_(fa);return}"function"==typeof ta?this.settleSameAsThenable_(ta,da):this.fulfill_(da)};R.prototype.reject_=function(da){this.settle_(2,da)};R.prototype.fulfill_=function(da){this.settle_(1,da)};R.prototype.settle_=function(da,ta){if(0!=this.state_)throw Error("Cannot settle("+da+", "+
ta+"): Promise already settled in state"+this.state_);this.state_=da;this.result_=ta;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};R.prototype.scheduleUnhandledRejectionCheck_=function(){var da=this;na(function(){if(da.notifyUnhandledRejection_()){var ta=$jscomp.global.console;"undefined"!==typeof ta&&ta.error(da.result_)}},1)};R.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var da=$jscomp.global.CustomEvent,ta=$jscomp.global.Event,
fa=$jscomp.global.dispatchEvent;if("undefined"===typeof fa)return!0;"function"===typeof da?da=new da("unhandledrejection",{cancelable:!0}):"function"===typeof ta?da=new ta("unhandledrejection",{cancelable:!0}):(da=$jscomp.global.document.createEvent("CustomEvent"),da.initCustomEvent("unhandledrejection",!1,!0,da));da.promise=this;da.reason=this.result_;return fa(da)};R.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var da=0;da<this.onSettledCallbacks_.length;++da)ya.asyncExecute(this.onSettledCallbacks_[da]);
this.onSettledCallbacks_=null}};var ya=new I;R.prototype.settleSameAsPromise_=function(da){var ta=this.createResolveAndReject_();da.callWhenSettled_(ta.resolve,ta.reject)};R.prototype.settleSameAsThenable_=function(da,ta){var fa=this.createResolveAndReject_();try{da.call(ta,fa.resolve,fa.reject)}catch(ma){fa.reject(ma)}};R.prototype.then=function(da,ta){function fa(Pa,xa){return"function"==typeof Pa?function(ub){try{ma(Pa(ub))}catch(qb){qa(qb)}}:xa}var ma,qa,Da=new R(function(Pa,xa){ma=Pa;qa=xa});
this.callWhenSettled_(fa(da,ma),fa(ta,qa));return Da};R.prototype.catch=function(da){return this.then(void 0,da)};R.prototype.callWhenSettled_=function(da,ta){function fa(){switch(ma.state_){case 1:da(ma.result_);break;case 2:ta(ma.result_);break;default:throw Error("Unexpected state: "+ma.state_);}}var ma=this;null==this.onSettledCallbacks_?ya.asyncExecute(fa):this.onSettledCallbacks_.push(fa);this.isRejectionHandled_=!0};R.resolve=T;R.reject=function(da){return new R(function(ta,fa){fa(da)})};R.race=
function(da){return new R(function(ta,fa){for(var ma=$jscomp.makeIterator(da),qa=ma.next();!qa.done;qa=ma.next())T(qa.value).callWhenSettled_(ta,fa)})};R.all=function(da){var ta=$jscomp.makeIterator(da),fa=ta.next();return fa.done?T([]):new R(function(ma,qa){function Da(ub){return function(qb){Pa[ub]=qb;xa--;0==xa&&ma(Pa)}}var Pa=[],xa=0;do Pa.push(void 0),xa++,T(fa.value).callWhenSettled_(Da(Pa.length-1),qa),fa=ta.next();while(!fa.done)})};return R},"es6","es3");
$jscomp.checkStringArgs=function(r,I,T){if(null==r)throw new TypeError("The 'this' value for String.prototype."+T+" must not be null or undefined");if(I instanceof RegExp)throw new TypeError("First argument to String.prototype."+T+" must not be a regular expression");return r+""};
$jscomp.polyfill("String.prototype.startsWith",function(r){return r?r:function(I,T){var na=$jscomp.checkStringArgs(this,I,"startsWith");I+="";var R=na.length,ya=I.length;T=Math.max(0,Math.min(T|0,na.length));for(var da=0;da<ya&&T<R;)if(na[T++]!=I[da++])return!1;return da>=ya}},"es6","es3");
$jscomp.iteratorFromArray=function(r,I){r instanceof String&&(r+="");var T=0,na=!1,R={next:function(){if(!na&&T<r.length){var ya=T++;return{value:I(ya,r[ya]),done:!1}}na=!0;return{done:!0,value:void 0}}};R[Symbol.iterator]=function(){return R};return R};$jscomp.polyfill("Array.prototype.keys",function(r){return r?r:function(){return $jscomp.iteratorFromArray(this,function(I){return I})}},"es6","es3");
$jscomp.polyfill("Array.from",function(r){return r?r:function(I,T,na){T=null!=T?T:function(ta){return ta};var R=[],ya="undefined"!=typeof Symbol&&Symbol.iterator&&I[Symbol.iterator];if("function"==typeof ya){I=ya.call(I);for(var da=0;!(ya=I.next()).done;)R.push(T.call(na,ya.value,da++))}else for(ya=I.length,da=0;da<ya;da++)R.push(T.call(na,I[da],da));return R}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var r={},I=Object.create(new $jscomp.global.Proxy(r,{get:function(T,na,R){return T==r&&"q"==na&&R==I}}));return!0===I.q}catch(T){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(r,I){return Object.prototype.hasOwnProperty.call(r,I)};
$jscomp.polyfill("WeakMap",function(r){function I(){if(!r||!Object.seal)return!1;try{var ma=Object.seal({}),qa=Object.seal({}),Da=new r([[ma,2],[qa,3]]);if(2!=Da.get(ma)||3!=Da.get(qa))return!1;Da.delete(ma);Da.set(qa,4);return!Da.has(ma)&&4==Da.get(qa)}catch(Pa){return!1}}function T(){}function na(ma){var qa=typeof ma;return"object"===qa&&null!==ma||"function"===qa}function R(ma){if(!$jscomp.owns(ma,da)){var qa=new T;$jscomp.defineProperty(ma,da,{value:qa})}}function ya(ma){if(!$jscomp.ISOLATE_POLYFILLS){var qa=
Object[ma];qa&&(Object[ma]=function(Da){if(Da instanceof T)return Da;Object.isExtensible(Da)&&R(Da);return qa(Da)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(I())return r;var da="$jscomp_hidden_"+Math.random();ya("freeze");ya("preventExtensions");ya("seal");var ta=0,fa=function(ma){this.id_=(ta+=Math.random()+1).toString();if(ma){ma=$jscomp.makeIterator(ma);for(var qa;!(qa=ma.next()).done;)qa=qa.value,this.set(qa[0],qa[1])}};fa.prototype.set=
function(ma,qa){if(!na(ma))throw Error("Invalid WeakMap key");R(ma);if(!$jscomp.owns(ma,da))throw Error("WeakMap key fail: "+ma);ma[da][this.id_]=qa;return this};fa.prototype.get=function(ma){return na(ma)&&$jscomp.owns(ma,da)?ma[da][this.id_]:void 0};fa.prototype.has=function(ma){return na(ma)&&$jscomp.owns(ma,da)&&$jscomp.owns(ma[da],this.id_)};fa.prototype.delete=function(ma){return na(ma)&&$jscomp.owns(ma,da)&&$jscomp.owns(ma[da],this.id_)?delete ma[da][this.id_]:!1};return fa},"es6","es3");
$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(r){function I(){if($jscomp.ASSUME_NO_NATIVE_MAP||!r||"function"!=typeof r||!r.prototype.entries||"function"!=typeof Object.seal)return!1;try{var fa=Object.seal({x:4}),ma=new r($jscomp.makeIterator([[fa,"s"]]));if("s"!=ma.get(fa)||1!=ma.size||ma.get({x:4})||ma.set({x:4},"t")!=ma||2!=ma.size)return!1;var qa=ma.entries(),Da=qa.next();if(Da.done||Da.value[0]!=fa||"s"!=Da.value[1])return!1;Da=qa.next();return Da.done||4!=Da.value[0].x||"t"!=Da.value[1]||!qa.next().done?
!1:!0}catch(Pa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(I())return r;var T=new WeakMap,na=function(fa){this.data_={};this.head_=da();this.size=0;if(fa){fa=$jscomp.makeIterator(fa);for(var ma;!(ma=fa.next()).done;)ma=ma.value,this.set(ma[0],ma[1])}};na.prototype.set=function(fa,ma){fa=0===fa?0:fa;var qa=R(this,fa);qa.list||(qa.list=this.data_[qa.id]=[]);qa.entry?qa.entry.value=ma:(qa.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:fa,value:ma},qa.list.push(qa.entry),this.head_.previous.next=qa.entry,this.head_.previous=qa.entry,this.size++);return this};na.prototype.delete=function(fa){fa=R(this,fa);return fa.entry&&fa.list?(fa.list.splice(fa.index,1),fa.list.length||delete this.data_[fa.id],fa.entry.previous.next=fa.entry.next,fa.entry.next.previous=fa.entry.previous,fa.entry.head=null,this.size--,!0):!1};na.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=da();this.size=0};na.prototype.has=
function(fa){return!!R(this,fa).entry};na.prototype.get=function(fa){return(fa=R(this,fa).entry)&&fa.value};na.prototype.entries=function(){return ya(this,function(fa){return[fa.key,fa.value]})};na.prototype.keys=function(){return ya(this,function(fa){return fa.key})};na.prototype.values=function(){return ya(this,function(fa){return fa.value})};na.prototype.forEach=function(fa,ma){for(var qa=this.entries(),Da;!(Da=qa.next()).done;)Da=Da.value,fa.call(ma,Da[1],Da[0],this)};na.prototype[Symbol.iterator]=
na.prototype.entries;var R=function(fa,ma){var qa=ma&&typeof ma;"object"==qa||"function"==qa?T.has(ma)?qa=T.get(ma):(qa=""+ ++ta,T.set(ma,qa)):qa="p_"+ma;var Da=fa.data_[qa];if(Da&&$jscomp.owns(fa.data_,qa))for(fa=0;fa<Da.length;fa++){var Pa=Da[fa];if(ma!==ma&&Pa.key!==Pa.key||ma===Pa.key)return{id:qa,list:Da,index:fa,entry:Pa}}return{id:qa,list:Da,index:-1,entry:void 0}},ya=function(fa,ma){var qa=fa.head_;return $jscomp.iteratorPrototype(function(){if(qa){for(;qa.head!=fa.head_;)qa=qa.previous;for(;qa.next!=
qa.head;)return qa=qa.next,{done:!1,value:ma(qa)};qa=null}return{done:!0,value:void 0}})},da=function(){var fa={};return fa.previous=fa.next=fa.head=fa},ta=0;return na},"es6","es3");$jscomp.findInternal=function(r,I,T){r instanceof String&&(r=String(r));for(var na=r.length,R=0;R<na;R++){var ya=r[R];if(I.call(T,ya,R,r))return{i:R,v:ya}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(r){return r?r:function(I,T){return $jscomp.findInternal(this,I,T).i}},"es6","es3");
var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var I={};I.id=r.id;I.server=r.id;I.displayName=r.displayName||r.id;if(r=r.rdp){for(var T in r)I[T]=r[T];I.user=r.username||"";I.pwd=r.password||"";I.useConsole=r.console||!1;I.legacyMode=r.leagacyMode||r.legacyMode||!1;I.server_bpp=r.color||16;I.exe=r.remoteProgram||"";I.args=r.remoteArgs||"";I.startProgram=0<I.exe.length?"app":I.command&&0<I.command.length?"shell":"noapp"}return I}
function Rdp2(r){r=svGlobal.util.getServerArgs(r);if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var I=r.gateway||"",T=0,na=0,R=16,ya=1==r.useSSL||"true"==r.useSSL||"on"==r.useSSL||null;r.width&&(T=parseInt(r.width,10));r.height&&(na=parseInt(r.height,10));r.color&&(R=parseInt(r.color,10));r.server_bpp&&(R=parseInt(r.server_bpp,10));r=hi5.browser.obj2url(r);null===ya&&(ya="https:"==location.protocol);return new Rdp((ya?"wss://":"ws://")+I+"/RDP?"+r,T,na,R)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(r,I,T,na){function R(a){return"on"==a||"true"==a||1==a}function ya(){var a=n.gateway;n.ongetgatewayaddress&&(a=n.ongetgatewayaddress(a));return a}function da(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ta(a,b){a=la[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function fa(){return L.displayName||L.server||L.symlink||L.id||"undefined"}function ma(a){n.loadbalanceToken||
(n.loadbalanceToken=la.loadbalanceTokenName?la.loadbalanceTokenName+"="+a:"")}function qa(a,b,c){n.ontitlechange&&(a=n.ontitlechange(a,c));n.setTitle&&a&&(b=b||window,b.document.title=a)}function Da(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return L.invitation||n.showMessage("15 bit color is not supported anymore."),!1;default:return!1}gb=a;b&&(Ma?Ma.postMessage({type:0,cmd:1,data:a}):Fa&&Fa.setColor(a));return!0}function Pa(a,b,c,e){Ka=a;La=b;$b=ac=0;bc=Ka-1;cc=La-1;Va&&(Ka=(L.waWidth||
hi5.browser.getScreenWidth())|0,La=(L.waHeight||hi5.browser.getScreenHeight())|0);L.minWidth&&Ka<L.minWidth&&(Ka=L.minWidth|0);L.minHeight&&La<L.minHeight&&(La=L.minHeight|0);Ka&=-4;La&=-4;svGlobal.logger.warn("resolution changed, w:"+Ka+" h:"+La);var d=Ka,g=La;sa?sa.resize(d,g):sa=new Bc(d,g);ja.setSize(Ka,La,Va?"hidden":null);if(c||Ka!=a||La!=b)Ma?Ma.postMessage({type:0,cmd:2,data:{w:Ka,h:La}}):Fa&&Fa.setResolution(Ka,La);if(n.onresolutionchange&&!e)n.onresolutionchange(a,b)}function xa(a){!cb&&
Ja&&(Ma?(dc.data=a,"string"!=typeof a?Ma.postMessage(dc,[a]):Ma.postMessage(dc)):Fa.writeRawInput(a))}function ub(a){switch(a){case "\r":break;case "\n":n.writeScancode(28);break;case "\t":n.writeScancode(15);break;default:xa("86"+a)}}function qb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),g=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=g?5:9;c=new Uint8Array(e+c);c[0]=a;if(g)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{g=b.name;for(var q=Math.min(g.length,8),J=0;J<q;J++)c[1+J]=g.charCodeAt(J)}c.set(d,e);xa(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Hb(a){if(n){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};n.displayMsg&&n.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(n.onerror)n.onerror(a)}}function Cc(a){if(n){var b=__svi18n.info[a];b||(b="info "+a);n.displayMsg&&n.showMessage(b);svGlobal.logger.info(b)}}function ec(){var a=Ja;rb=Ja=!1;
Ma?Ma.postMessage({type:0,cmd:3}):Fa&&Fa.resetStatus();a&&(Ja=a)}function fc(a){Oa||(Oa=new hi5.file.UploadManager(new hi5.file.WsFileService(xa)),Oa.addEvent("beforeupload",function(b,c,e){if(n.beforeupload)return n.beforeupload(b,c,e)}),Oa.addEvent("fileuploaded",function(b,c,e){if(n.onfileuploaded)n.onfileuploaded(b,c,e)}),Oa.addEvent("uploaded",function(b,c){if(n.onuploaded)n.onuploaded(b,c)}),Oa.addEvent("uploadingCancelled",function(){if(n.onuploadingCancelled)n.onuploadingCancelled()}));a.setFileHandler(Oa)}
function Dc(a,b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ja&&(e=!0,xa("8C5"+d.exe+"\t"+d.args+"\t"+n.sessionInfo.appInfo.session))}}function Ad(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ec(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Ib(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function Bd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=
void 0));d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Fc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Gc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var g=[];e&1?g.push("usb"):e&2?g.push("nfc"):e&4?g.push("ble"):e&16?g.push("internal"):e&32&&g.push("hybrid");
d.transports=g}b.push(c)}}return b}function Fc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function Cd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function Dd(a,b){var c,e,d,g,q,J,z,G,H,x,A,v,u,Y,w,Z,M,O,P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){if(1==oa.nextAddress){a.getPublicKeyAlgorithm();if((c=a.getTransports())&&0<c.length)for(var ba=$jscomp.makeIterator(c),
U=ba.next();!U.done;U=ba.next())U=U.value,"USB"==U.toUpperCase()||"NFC"==U.toUpperCase()||"BLE"==U.toUpperCase()||"INTERNAL"==U.toUpperCase()||U.toUpperCase();if(e=a.attestationObject)g=Ib(e),d=g.attStmt;if(q=a.clientDataJSON)J=window.origin,z=(new TextDecoder).decode(q),G=JSON.parse(z),G.origin&&(G.origin=J);H=a.getAuthenticatorData();if(!H)return oa.jumpTo(0);x=new Uint8Array(H);return b?(A=b.id)?oa.yield(Ed(A),5):oa.jumpTo(0):oa.jumpTo(0)}v=oa.yieldResult;u=new Uint8Array(v);Y=new hi5.DataBuffer(new Uint8Array(x.byteLength));
Y.setBytes(u);w=x.slice?x.slice(32,x.length):x.subarray(32,x.length);Y.setBytes(w);Y.markEnd();Z=Y.getData();M={1:"packed",2:Z,3:d};O=CBOR.encode(M);P=new hi5.DataBuffer(new Uint8Array(O.byteLength+1));P.setByte(0);P.setBytes(O);P.markEnd();return oa.return(P.getData())})}function Ed(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(Fd(b))})}function Fd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==
c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function Gd(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}function Hd(a,b,c,e,d){gc.set(a,b);hc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=
b;c.innerHTML+="<br>";return c}function Id(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Hc(){var a="";L&&R(L.connectif)&&L.symlink&&"sessionStorage"in window&&(a="SV_"+L.symlink,L.domain&&(a+=L.domain),L.user&&(a+=L.user));return a}function Jd(){var a=window.localStorage.getItem(void 0)||"";a&&(a="&certHash="+a);var b=hi5.appcfg.persistentId?
window.localStorage:window.sessionStorage;if(!b)return a;var c=b.getItem("appInfo.session");if(!c)return a;a+="&_session="+c;(b=b.getItem("appInfo.numericId"))&&(a+="&_numericId="+b);return a}function Jb(){if(!Ja){rb=!1;var a="";cb?Ia.init(!1,!0,!1,0,!1,!1):a=n.getRuntimeURL();void 0==la.wsPost&&(la.wsPost=!1);n.oncreatewebsocket&&(Ma=null);Ma?(cb&&(cb.onopen=ic,cb.onclose=Ab,cb.onmessage=function(c){jc.data=c.data;Ma.postMessage(jc,[jc.data])}),Ma.postMessage({type:0,cmd:0,data:{addr:a,width:Ka,
height:La,server_bpp:gb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:la.wsPost}})):(Fa=new RdpGeneral(cb||a,Ka,La,gb,sa,!1,la.wsPost),Fa.oncreatewebsocket=n.oncreatewebsocket,Fa.run());Ma?Ma.addEventListener("message",Ic,!1):(Fa.onopen=ic,Fa.onmessage=Jc,Fa.onclose=Ab,Fa.onerror=Hb,Fa.oninfo=Cc,Fa.onloggedin=kc,Fa.onresolutionchange=function(c,e){Pa(c,e,!1,L.monitorDef&&0<=L.monitor?!0:!1)},Fa.onAltSecWindows=Kc,Fa.onMoveCursor=lc,Fa.onCloseSurface=Lc,Fa.onColorChange=Da,Fa.onHistoryReceived=function(){mc()},
Fa.onLockKeyState=function(c){if(n.onLockKeyState)n.onLockKeyState(c)});if(a=ja.getSurface(ja.size()-1))Va?a&&(a.remoteApp=new Dc(L.exe,L.args,"")):qa(fa(),a.getWindow());if(L.invitation&&!R(L.shadow)){var b=null;a&&(b=a.initChat(L.expert));Bb=new n.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,L.novice)};b&&(b.onchat=function(c){if(Ja){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();
Bb.send(e)}});n.addGatewayChannel(Bb)}}}function Ic(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:ic();break;case 1:Ab(a.expected);break;case 2:Hb(a.code);break;case 3:Cc(a.code);break;case 4:kc();break;case 5:Pa(a.w,a.h,!1,L.monitorDef&&0<=L.monitor?!0:!1);break;case 6:lc(a.x,a.y,!0);break;case 7:Lc();break;case 8:0==a.id&&mc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:Da(a.color);break;case 10:if(n.onLockKeyState)n.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:sa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:sa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:sa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:sa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:sa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:sa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Mc(a);break;case 10:Jc(a);break;case 11:Ua.attach(a.data,0,a.data.length);Kc(Ua,a.size);
break;case 12:sa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:sa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:sa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:sa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:sa.putFont(a.font,a.character,a.glyph);break;case 17:sa.putCursor(a.idx,
a.cursor);break;case 18:sa.setCursor(a.idx);break;case 19:sa.getHistory(a.cmd,xa,function(b){Ma.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);sa.setHistory(a.order,Ua);break;case 21:sa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Nc(a){Qa&&Qa.check(a)}function ic(){Ja=!0;var a="87"+navigator.userAgent+"\t";Kb=hi5.tool.uuid();document.cookie=Kb+"=sv";xa(a+Kb);if(n.onopen)n.onopen();
la.joinCloseMode&&n.setJoinCloseMode(la.joinCloseMode)}function Lc(){ja&&ja.close()}function Jc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=kb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Ga.tag=a.getLittleEndian16();Ga.channels=a.getLittleEndian16();Ga.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Ga.bitsPerSample=
a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ga.tag+" channels="+Ga.channels+" bitsPerSample="+Ga.bitsPerSample+" samplePerSec="+Ga.samplePerSec);Ma&&Ma.postMessage({type:0,cmd:5,data:{tag:Ga.tag,channels:Ga.channels,samplePerSec:Ga.samplePerSec,bitsPerSample:Ga.bitsPerSample}});41222==Ga.tag&&(Ga.sampleRate=Ga.samplePerSec,Ta.initMediaPlayer(Ta,Ga,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);nc(a,b,c,0);lb||(c+=Date.now()-e,xa("8A"+
b+","+c))}Qa&&Qa.check();break;case 56:Oc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Pc(Ua);break;case 62:Qc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Rc(Ua);Qa&&Qa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ia[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ia[b].newInstance?(Ia[a]=Ia[b].newInstance(),Ia[a].id=a):(Ia[b].id=a,Ia[a]=Ia[b]),Ia[a].onopen)Ia[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+
b+" id:"+a);break;case 3:Ia[a]&&Ia[a].process(b);break;case 4:if(Ia[a]&&Ia[a].onclose)Ia[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:Kd(Ua);break;default:if(n.onunknownmessage)n.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:xa("87"+navigator.userAgent);break;case 15:if(n){Lb=!1;vb=n.reconnectTimes;(n&&0==n.mode||R(L.connectif))&&mc();b="";for(b in mb)if((c=mb[b])&&c.onopen)c.onopen();
for(b in kb)if((c=kb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&n&&(n.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(n.onnotify)n.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&n.onerror)n.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;n.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ja.drawLicense(a);
break;case 50:if(Ja)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Ld(a);break;case 2:Cb?(Cb.type==a?n.writeRawInput("881"+a+"\t"+Cb.text):n.writeRawInput("881ERROR\t"),Cb=null):!(b=ja.getFocused())||b.processClipReq(a)||!la.clipWarnAlways&&Sc||!L||L.leagacyMode||(n.showMessage(__svi18n.info.menucopy,null,5E3),Sc=!0);break;case 5:(b=ja.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ja.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=ya()+b[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+
a+" name:"+b[1]+" driver:"+b[2]);n.onprintingready&&n.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ja.getFocused())&&b.showPDF(a);break;case 56:Oc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ja.getWinById(parseInt(b[0]))){if(!ja.hasApp(b[1])){(c=ja.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(n.onremoteappstart)n.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&n.ontitlechange)n.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Md(a);break;case 59:a=hi5.Base64.dec(a,0);db=(new RdpBuffer(a,0,a.length)).getLittleEndian32();lb||!(db&16||db&65536)?(Mb=!1,Oa=null):(db&16&&(Mb=!0),Oa||(a=ja.getFocused())&&fc(a));db&64&&n.showMessage(__svi18n.info.recording);Oa&&(Oa.setUpload(!(db&128)),Oa.setDownload(!(db&131072)),Oa.canCopyFile=0!=(db&65536));ja.execute("setFeature",[db]);break;case 60:Pc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Pa(a.width,a.height,!0,!1);Da(a.color);
(b=a.server)&&n&&(n.server=a.server);Tc=a.length;c=ja.getFocused();Va=1==a.isRail;c&&(1!=n.mode&&c.setAutoScale(!Va),b&&qa(fa(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Mb=!0,fc(c));if(n.onopened)n.onopened(a);break;case 1:a=a.duration;if(n.onprogress)n.onprogress(a,Tc);break;case 2:2==a.status?(ec(),Ja=!0):(b=0==a.status,b==sa.isPaused()||n.onsessionpause&&n.onsessionpause(b,a)||(sa&&sa.pause(b,void 0),b||ja.repaint(0,0,sa.width-1,sa.height-1),a.warn&&
n.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Qc(a);break;case 63:Rc(b64ToBuffer(a));break;default:if(n.onunknownmessage)n.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function mc(){if(!lb&&!Xa&&(Xa=!0,n&&(la.pingInterval&&n.startPing(la.pingInterval),n.onready)))n.onready()}function Kd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;xa(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();
0!=b||a&4||(db^=65536,ja.execute("setFeature",[db]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(n.onLockKeyState)n.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();n.sessionInfo.appInfo.twoFAEnabled=
0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);n.sessionInfo.appInfo.twoFAQR=a;n.ontwofaqr&&n.ontwofaqr(a)||2==b&&ja.execute("showTwoFAQR");break;case 1:sa&&sa.pause(!0,!0);if(n.ontwofacode&&n.ontwofacode())return;(a=ja.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!n.ontwofaresult||!n.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ja.getFocused()){c="image/png";switch(b){case 1:c=
"image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var g=new Uint8Array(2+d.length);g[0]=146;g[1]=8;g.set(d,2);xa(g.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Nd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var g=ja.getFocused();g&&Ja&&(g=g.getThumbnail(a))&&g.length!=d&&(xa("8E7"+g),d=g.length)},b))};this.stop=function(){clearInterval(c)}}function Od(a,
b){!$a||$a.width==a&&$a.interval==b||($a.stop(),$a=null);$a||($a=new Nd(a,b));$a.start()}function Rc(a){var b=a.getAscllString(8);(b=mb[b])&&b.process&&b.process(a)}function Qc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=n.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ec();Ja=!0;a=d.width;e=d.height;if(a==Ka&&e==La)break;Pa(a,e,!1,!1);break;case 1:d=JSON.parse(c);n.sessionInfo.joinedSessions.push(d.numericId);n.sessionInfo.joiners.push(d);e.sessions[d.numericId]=
d.name||d.__ip;if(!e.joined||la.alertJoin)n.onsessionjoin&&(a=n.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&n.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);n.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=n.sessionInfo.joiners;c=0;for(var g=b.length;c<g;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||la.alertJoin)n.onsessionexit&&(a=n.onsessionexit(d)),!a&&__svi18n.info.exitsession&&
n.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ja.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;n.ongivecontrol&&(a=n.ongivecontrol());if(a)break;n.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ja.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=
!1;n.ontakebackcontrol&&(a=n.ontakebackcontrol());if(a)break;n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);n.onrequirecontrol&&(a=n.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;sa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));n.showMessage({title:a,msg:e,cbYes:function(){n.giveControl(d.numericId);this.destroy();sa.isPaused()&&n.pauseSession(n.sessionInfo.appInfo.numericId,!1)},cbNo:function(){n.refuseControl(d.numericId);
this.destroy()},html:!0});break;case 6:ja.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Pa(d.width,d.height,!0,L.monitorDef&&0<=L.monitor?!0:!1);d.color&&(Da(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(n.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);Lb=!0;if(n.onrequestcredential&&n.onrequestcredential(d,Ra.reconnect))break;if(n.onautherror&&n.onautherror(d,Ra.reconnect))break;ja.getFocused().requestCredential(d,
Ra.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Od(d.width,d.interval):$a&&($a.stop(),$a=null);break;case 11:d=JSON.parse(c);n.onrequirejoin&&(a=n.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);n.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){n.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){n.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&kc();break;case 14:d=JSON.parse(c);
if(n.oncontrolchange)n.oncontrolchange(d);break;case 15:d=JSON.parse(c),Pd(d)}}function Pd(a){if("cert"==a.type){Lb=!0;var b=__svi18n.info.cert||"The certificate of remote connection could not be verified. Do you want to continue?<br>Target: %1,<br>Hash: %2";b=b.applyArgs([a.target,a.hash]);hi5.notifications.notify({msg:b,cbYes:function(){this.destroy();window.localStorage.setItem(void 0,a.hash);Jb()},cbNo:function(){this.destroy()},html:!0})}}function Pc(a){switch(a.getByte()){case 32:if(!sa.isPaused()){var b=
a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,g=void 0;la.noCursorName||(d=a.getLittleEndian32(),n.sessionInfo.appInfo&&(g=n.sessionInfo.appInfo.sessions[d]));lc(c,e,!0,g,d,b)}}}function lc(a,b,c,e,d,g){sa.isPaused()||ja.getFocused().moveCursor(a,b,c,e,d,g)}function Mc(a){ja.setCursor(a)}function Qd(a){var b=la.page&&la.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");
if(b)return c.substring(0,e+1)+b;b=ya();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Oc(a){a=JSON.parse(a);oc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",oc),c.setItem("appInfo.numericId",b));ma(a.appId);a.server||(a.server=fa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=n.mode&&ja.execute("setAutoScale",
[!0]):(n.mode=0,R(L.connectif)&&ja.setSize(Ka,La),la.disableJoinedAppResize&&(n.windowState=0));var e=ya();b=Qd("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),n.protocol="http"==c.substring(0,e)?"ws":"wss",n.gateway=c,b+="&gateway="+encodeURIComponent(c));b=n.modifyURL(b);a.joinLink=b;n.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Pa(Ka,La,!0,!0),rb||1==n.mode||ja.execute("setAutoScale",[!0]));a.ver&&
a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);la.cursorNameOnly=a.isAssistance;if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function Md(a){if(Oa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Oa.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Oa.confirmId(c[0],c[1],c[2]);break;case 2:Oa.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Oa.close(c[0]);break;case 9:a='<a href="'+n.modifyURL(ya()+c[0])+'" download="'+
c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ja.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Oa.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function nc(a,b,c,e){if(!Rd||sa.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ga.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ga.tag)pc||(pc=new MSGSM),b=pc.decode(b,d,e),d=0,
e=b.length;var g=Ga.bitsPerSample;var q=Math.floor(e/(g>>3));var J=c=e=0;a||(e=Math.pow(2,g-1)-1,c=-e-1,J=Math.pow(2,g));g=Ga.channels;var z=Math.floor(q/g),G=Ta.getBuffer(z),H=G.getChannelData(0),x=G.getChannelData(1);q=0;if(a)for(;q<z;)1==g?x[q]=H[q]=b[d++]:(H[q]=b[d++],x[q]=b[d++]),q++;else for(;q<z;)a=b[d++]|b[d++]<<8,a>e?(a-=J,a/=-c):a/=e,1==g?H[q]=a:(H[q]=a,a=b[d++]|b[d++]<<8,a>e?(a-=J,a/=-c):a/=e),x[q]=a,q++;return Ta.playBuffer(G)}function Uc(a){if(!n.openLink||2E3<a.length)return!1;var b=
a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:n.onurlredirection&&n.onurlredirection(b)?!0:(a=ja.getFocused())?a.processLink(b):!1:!1}function Sd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=
a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=n.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Ld(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(n.onservercopy&&n.onservercopy(a)||Uc(a))){var b=ja.getFocused();b&&b.copyToClip(Sd(a))}setTimeout(function(){xa("883")},999)}}function kc(a){if(!rb&&(setTimeout(function(){Ja&&xa("884")},333),n.onloggedin))n.onloggedin();qc=rb=!0;a&&a.sessionId&&(n.sessionInfo.sessionId=a.sessionId);Va&&1!=
n.mode&&ja.execute("setAutoScale",[!1]);Oa&&(Oa.enabled=!0);Nb&&!Va&&(sa.setContext(ja.getFocused().context),ja.repaint(0,0,sa.width-1,sa.height-1))}function Ab(a){if(n){hi5.browser.cookie.delete(Kb);svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));n.onagentmessage&&(n.onagentmessage=null);if(n.onagentclose)n.onagentclose();var b=Hc();b&&n.sessionInfo.appInfo&&0==n.mode&&(sessionStorage[b]=n.sessionInfo.appInfo.session);if(n&&(b=1!=n.mode,!Ja&&b&&Hb("connection"),
b=b&&(Ja||vb<n.reconnectTimes)&&0<vb&&!a,Xa=Ja=!1,b)){vb--;__svi18n.info.reconnecting&&n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-vb)+"/"+n.reconnectTimes,null,3E3);setTimeout(Jb,la.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+vb);return}if(Lb)svGlobal.logger.info("No release");else{Qa&&(n.stopPing(),Qa=null);Ma&&(Ma.removeEventListener("message",Ic,!1),Ma.postMessage({type:0,cmd:4}),Ma.terminate(),Ma=null);Oa&&(Oa.release(),Oa=null);Sa=r=null;Ia&&(Ia.close(),
Ia=null);mb&&hi5.Arrays.release(mb);kb&&hi5.Arrays.release(kb);$a&&($a.stop(),$a=null);Ta&&(Ta.close(),Ta=null);n.player&&(n.player=null);Db=null;try{if(n.onclose)n.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ja&&(ja.close(),ja=null)}catch(c){svGlobal.logger.warn(c)}Ua=null;Fa&&(Fa.onopen=null,Fa.onmessage=null,Fa.onclose=null,Fa.onerror=null,Fa.close(),Fa=null);ja=Ra=null;sa&&(sa.release(),sa=null);hi5.browser.isChromeApp?
chrome.runtime.onSuspend.removeListener(n.close):window.removeEventListener("unload",n.close,!1);window&&window.$rdp==n&&(window.$rdp=null);n=null}}}function Vc(){Fa&&Ja?Fa.close():Ab(!0)}function Kc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),g=0;16>c&&(g=a.getLittleEndian16());var q=a.getLittleEndian16(),J=a.getLittleEndian16();a.getBytes(q);g&&
a.getBytes(g);if(8<=c&&(g=ja.getFocused())&&g.onremoteappicon){q=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();J=d+J;var z;a=a.getData();for(var G=0,H,x;d<J;)switch(c){case 16:(z=a[d++]|a[d++]<<8)?(x=z>>7&248,H=z>>2&248,z=z<<3&248,x|=x>>5,H|=H>>5,z|=z>>5,e[G++]=z,e[G++]=H,e[G++]=x,e[G++]=255):G+=4;break;case 32:e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++]}q.putPixels(e,0,e.length);a=ja.getWinById(b);g.onremoteappicon(a,q)}}else 0!=(c&2147483648)?
svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ja.delWin(b)):Td(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((g=ja.getOwnerSurfaceById(b))&&
g.railWin&&g.railWin.setActiveWinId(b,3==la.windowState),ja.setTitle(b),sa.getContext()||(b=ja.getFocused())&&sa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ja.zOrders,c.length=b,g=0;g<b;g++)c[g]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[g])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Wc(a){var b=ja.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),
Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Td(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=ja.getWinById(c);d?e=!0:d=new ja.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+
d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=
(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),
svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var g=d.showState;(2==g&&0!=la.noMinimize||!e&&3==g&&5==la.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(g=0!=(b&4)){var q=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(q,
!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=
a.getLittleEndian32());if(0!=(b&2048)){q=a.getLittleEndian32();var J=a.getLittleEndian32();d.winOffsetX=q;d.winOffsetY=J;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==n.windowState?Wc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(q=ja.getFocused())){q=q.getFreeSpace();var z=d.winWidth,G=d.winHeight;if(d.winOffsetX>q.width||d.winOffsetY>q.height||0>z+d.winOffsetX||0>G+d.winOffsetY){var H=(q.width-d.winWidth)/2|0,x=(q.height-d.winHeight)/2|0;0>H&&(H=0);0>x&&(x=0);setTimeout(function(){d.resize(H,x,z,G)},50)}}0!=(b&256)&&(q=a.getLittleEndian16(),0<q&&a.skipPosition(8*q));0!=(b&
4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ja.onWinChange(d);else ja.addWin(d);g&&ja.setTitle(c);c==ja.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ja.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function Bc(a,b){function c(h,m,k,f,p){0<p.width?p.union(h,m,k,f):(p.x=h,p.y=m,p.width=k,p.height=f)}function e(h,
m,k,f){for(ea=0;ea<ha;ea++){var p=U[ea];if(h>=p[0]&&m>=p[1]&&k<=p[2]&&f<=p[3])return E[ea]}return null}function d(h,m,k,f){if(ha){var p=e(h,m,h+k-1,m+f-1);p&&c(h,m,k,f,p)}else c(h,m,k,f,Y)}function g(h,m,k,f,p,t,B){for(var C=p*k+f,y=h.setRGB,V=h.getRGB,K=0;K<B;K++){for(var l=0;l<t;l++){if(h){var D=V(f+l,p+K);y(f+l,p+K,~D&16777215)}else m[C]=~m[C]&16777215;C++}C+=k-t}}function q(h,m,k,f,p,t,B,C,y,V){m=V*C+y;null==B&&(B=h);for(h=0;h<t;h++){for(y=0;y<p;y++)v[f+h][k+y]=v[f+h][k+y]&B[m]&16777215|4278190080,
m++;m+=C-p}}function J(h,m,k,f,p,t,B,C,y,V){m=V*C+y;y=h.setRGB;V=h.getRGB;null==B&&(B=h);for(h=0;h<t;h++){for(var K=0;K<p;K++){var l=V(k+K,f+h);y(k+K,f+h,l|B[m]&16777215);m++}m+=C-p}}function z(h,m,k,f){var p=ka;if(p){var t=p.getRGB(m,k);switch(h){case 0:p.setRGB(m,k,0);break;case 1:p.setRGB(m,k,~(t|f)&16777215);break;case 2:p.setRGB(m,k,t&~f&16777215);break;case 3:p.setRGB(m,k,~f&16777215);break;case 4:p.setRGB(m,k,16777215*(~t&f));break;case 5:p.setRGB(m,k,~t&16777215);break;case 6:p.setRGB(m,k,
t^f&16777215);break;case 7:p.setRGB(m,k,~t&f&16777215);break;case 8:p.setRGB(m,k,t&f&16777215);break;case 9:p.setRGB(m,k,t^~f&16777215);break;case 10:break;case 11:p.setRGB(m,k,t|~f&16777215);break;case 12:p.setRGB(m,k,f);break;case 13:p.setRGB(m,k,(~t|f)&16777215);break;case 14:p.setRGB(m,k,t|f&16777215);break;case 15:p.setRGB(m,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+h),p.setRGB(m,k,f)}}}function G(h,m,k,f,p,t,B,C,y){h>C||m>y||(k=h+k-1,k>C&&(k=C),h<t&&(h=t),k=
k-h+1,f=m+f-1,f>y&&(f=y),m<B&&(m=B),f=f-m+1,1>k||1>f||ka.fillRect(h,m,k,f,p))}function H(h,m,k,f,p,t,B,C,y,V,K,l){if(!(m>K||k>l)){var D=m+f-1;D>K&&(D=K);y=m<y?y:m;D=D-m+1;K=k+p-1;K>l&&(K=l);V=k<V?V:k;l=K-k+1;if(!(1>D||1>l)){K=128;var F=0;B|=4278190080;C|=4278190080;if(y==m&&V==k&&D==f&&l==p)if(0==h)for(var N=0;N<p;N++){h=k+N;for(var ca=0;ca<f;ca++)0==K&&(F++,K=128),0!=(t[F]&K)&&(v[h][m+ca]=C),K>>=1;F++;K=128;F==t.length&&(F=0)}else for(N=0;N<p;N++){h=k+N;for(ca=0;ca<f;ca++)0==K&&(F++,K=128),v[h][m+
ca]=0!=(t[F]&K)?C:B,K>>=1;F++;K=128;F==t.length&&(F=0)}else if(0==h)for(N=0;N<l;N++){h=k+N;for(ca=0;ca<D;ca++)0==K&&(F++,K=128),m+ca>=y&&h>=V&&0!=(t[F]&K)&&(v[h][m+ca]=C),K>>=1;F++;K=128;F==t.length&&(F=0)}else for(N=0;N<l;N++){h=k+N;for(ca=0;ca<D;ca++)0==K&&(F++,K=128),m+ca>=y&&k+N>=V&&(v[h][m+ca]=0!=(t[F]&K)?C:B),K>>=1;F++;K=128;F==t.length&&(F=0)}}}}function x(h,m,k,f,p){this.offset=h;this.baseLine=m;this.width=k;this.height=f;this.fontData=p}function A(h,m,k,f,p,t,B,C,y){this.cache_idx=h;this.rawData=
m;this.none=!m;this.hotX=k;this.hotY=f;this.width=p;this.height=t;this.xorSize=C;this.andSize=y;this.result="";this.distance=0;this.bpp=B;this.system="";if(m){if(!this.distance){h=0;if(m){B=0;for(var V=m.length;B<V;B++)0!=m[B]&&(h+=B%p+(B/p|0))}this.distance=h}if(!this.system){a:switch(this.distance){case 507:h="text";break a;case 2046:case 4359:h="default";break a;default:h=""}this.system=h}}h="";if(!this.system&&m){B=p*t*4;h=62+B+C+y;V=new Uint8Array(h);h=new hi5.DataBuffer(V,0,h);h.setLittleEndian16(0);
h.setLittleEndian16(2);h.setLittleEndian16(1);h.setByte(p);h.setByte(t);h.setByte(0);h.setByte(0);h.setLittleEndian16(k);h.setLittleEndian16(f);h.setLittleEndian32(40+B+C+y);h.setLittleEndian32(22);h.setLittleEndian32(40);h.setLittleEndian32(p);h.setLittleEndian32(2*t);h.setLittleEndian16(1);h.setLittleEndian16(32);h.setLittleEndian32(0);h.setLittleEndian32(C+y);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);h.setLittleEndian32(0);for(k=t-1;0<=k;k--)for(f=0;f<p;f++)t=m[p*k+f],
h.setByte(t&255),h.setByte(t>>8&255),h.setByte(t>>16&255),h.setByte(t>>24&255);h="data:image/x-icon;base64,"+hi5.Base64.enc(h.getData())}this.url=h}var v=[],u=null,Y=new hi5.graphic.Rectangle(0,0,0,0),w="Uint8ClampedArray"in window,Z=null,M=0,O=0,P=0,oa=0,ba=null,U,E,ea=0,ha=0;this.width=a;this.height=b;var S=!1,ka=this,aa={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(h){Z=h};this.getDirtyArea=function(){return Y};this.setImgRect=function(h,m,k,f){M=h;O=m;P=k;oa=f};this.parseMonitorDef=
function(h){var m=h.split(","),k=m.length,f=[];if(1<k){for(var p=!1,t=0;t<k;t++){var B=m[t].split(":");if(4==B.length)f[t]=Array(5),f[t][0]=parseInt(B[0]),f[t][1]=parseInt(B[1]),f[t][2]=parseInt(B[2]),f[t][3]=parseInt(B[3]),f[t][4]=0==f[t][0]&&0==f[t][1]?1:0;else{p=!0;break}}p&&(svGlobal.logger.warn("invaiid monitorDef:"+h),f.length=0)}return f};this.setMonitorLayout=function(h){var m=h.length,k=0;U=h;for(E=Array(m);k<m;k++)E[k]=new hi5.graphic.Rectangle(0,0,0,0);ha=m};this.setMonitorCount=function(h){ha=
h};this.addImg=function(h){P&&(ba&&URL.revokeObjectURL(ba.src),ba=h)};this.flushImgs=function(){ba&&(URL.revokeObjectURL(ba.src),ba=null,P=0)};this.getData=function(){return v};this.pause=function(h,m){S=h;m&&u&&u.fillRect(0,0,a,b)};this.release=function(){Y=null;hi5.Arrays.release(E);ka.flushImgs();v=u=ka=null;aa=aa.imgData=null};this.isPaused=function(){return S};this.setContext=function(h){h!=u&&(u||!h||h.createImageData(1,1).data.buffer||(w=!1),u=h,null!=u&&(aa.imgData=u.createImageData(a,b)))};
this.getContext=function(){return u};this.resize=function(h,m){if(v.length!=m||v[0].length!=h){for(var k=0;k<m;k++)v[k]=new Uint32Array(h);v.length=m;ka.width=a=h;ka.height=b=m;null!=u&&(aa.imgData=u.createImageData(a,b))}};ka.resize(a,b);this.getBuffer=function(){return v};this.setRGB=function(h,m,k){v[m][h]=k|4278190080};this.getRGB=function(h,m){return v[m][h]};this.setRGBs=function(h,m,k,f,p,t,B){var C=h+k,y=m+f;y>b&&(y=b);if(!(h>=a)){C>a&&(k-=C-a);for(C=m;C<y;C++,t+=B)v[C].set(p.subarray(t,t+
k),h);d(h,m,k,f)}};this.moveArea=function(h,m,k,f,p,t){if(0<t){var B=h+p,C=m+t,y;for(y=f-1;0<=y;y--)v[C+y].set(v[m+y].subarray(h,h+k),B)}else if(0>t)for(B=h+p,C=m+t,y=0;y<f;y++)v[C+y].set(v[m+y].subarray(h,h+k),B);else if(0<p){B=h+p;C=m+t;var V;for(y=k-1;0<=y;y--){var K=B+y;var l=h+y;for(V=0;V<f;V++)v[C+V][K]=v[m+V][l]}}else for(B=h+p,C=m+t,y=0;y<k;y++)for(K=B+y,l=h+y,V=0;V<f;V++)v[C+V][K]=v[m+V][l];d(h+p,m+t,k,f)};this.getRGBs=function(h,m,k,f,p){var t=new Uint32Array(k*f),B=h+k;f=m+f;for(var C=
0;m<f;m++)t.set(v[m].subarray(h,B),C),C+=k;return p?(p(t),null):t};this.repaint=function(h,m,k,f){var p=aa.imgData.data,t=0,B,C;Z&&Z.begin("paint");0>h&&(k+=h,h=0);0>m&&(f+=m,m=0);h+k>a&&(k=a-h);m+f>b&&(f=b-m);var y=h+k;var V=m+f;if(w)for(p=new Uint32Array(p.buffer),C=m;C<V;C++)p.set(v[C].subarray(h,y),t),t+=a;else{var K=4*(a-k)|0;for(C=m;C<V;C++){for(B=h;B<y;B++){var l=v[C][B];p[t++]=l&255;p[t++]=l>>8&255;p[t++]=l>>16&255;p[t++]=255}t+=K}}aa.left=h;aa.top=m;aa.width=k;aa.height=f;Z&&Z.end("paint");
return aa};this.postPaint=d;this.draw=function(h,m,k,f){if(!S&&u)if(ba&&ba.complete&&(u.drawImage(ba,M,O,P,oa),URL.revokeObjectURL(ba.src),ba=null),ha){if(h=e(h,m,k,f),h.width)return ka.repaint(h.x,h.y,h.width,h.height),h.width=0,aa}else if(Y.width)return ka.repaint(Y.x,Y.y,Y.width,Y.height),Y.width=0,aa;return null};this.fillRect=function(h,m,k,f,p){var t=h+k,B=m+f;if(v[0].fill)for(var C,y=m;y<B;y++)v[y].fill(p,h,t);else for(y=m;y<B;y++)for(C=h;C<t;C++)v[y][C]=p;d(h,m,k,f)};this.drawLine=function(h,
m,k,f,p){if(m==f){if(h>k){var t=h;h=k;k=t}var B=v[m];k++;if(B.fill)B.fill(p,h,k);else for(t=h;t<k;t++)B[t]=p}else if(h==k)for(m>f&&(t=m,m=f,f=t),f++,t=m;t<f;t++)v[t][h]=p;else{var C=Math.abs(k-h),y=Math.abs(f-m);t=h;B=m;k=k>=h?h=1:h=-1;m=f>=m?f=1:f=-1;if(C>=y){m=h=0;var V=C;var K=C/2|0;var l=y}else f=k=0,V=y,K=y/2|0,l=C,C=y;if(!(1>C))for(C++,y=0;y<C;y++)v[B][t]=p,K+=l,K>=V&&(K-=V,t+=h,B+=f),t+=k,B+=m}};this.bitBlt=function(h,m,k,f,p,t,B,C,y,V){var K=ka;switch(h){case 0:C=K.setRGB;for(K=k;K<k+p;K++)for(y=
f;y<f+t;y++)C(K,y,0);break;case 1:h=B;y=V*C+y;V=K.setRGB;m=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(B=0;B<p;B++)V(k+p,f+t,~(m(k+p,f+t)|h[y])&16777215);y+=C-p}break;case 2:h=B;y=V*C+y;V=K.setRGB;m=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(B=0;B<p;B++){var l=m(k+p,f+t);V(k+p,f+t,l&~h[y]&16777215);y++}y+=C-p}break;case 3:g(K,B,C,y,V,p,t);B?K.setRGBs(k,f,p,t,B,V*C+y,C):K.moveArea(y,V,p,t,k-y,f-V);break;case 4:g(K,null,m,k,f,p,t);q(K,m,k,f,p,t,B,C,y,V);break;case 5:g(K,null,m,k,f,p,t);break;case 6:h=
B;y=V*C+y;null==h&&(h=K);for(K=0;K<t;K++){for(V=0;V<p;V++)v[f+K][k+V]=v[f+K][k+V]^h[y]&16777215|4278190080,y++;y+=C-p}break;case 7:h=B;y=V*C+y;V=K.setRGB;m=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(B=0;B<p;B++)l=m(k+B,f+K),V(k+B,f+K,~(l&h[y])&16777215),y++;y+=C-p}break;case 8:q(K,m,k,f,p,t,B,C,y,V);break;case 9:h=B;y=V*C+y;V=K.setRGB;m=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(B=0;B<p;B++)l=m(k+B,f+K),V(k+B,f+K,l^~h[y]&16777215),y++;y+=C-p}break;case 10:break;case 11:h=B;y=V*C+y;V=K.setRGB;
m=K.getRGB;null==h&&(h=K);for(K=0;K<t;K++){for(B=0;B<p;B++)l=m(k+B,f+K),V(k+B,f+K,l|~h[y]&16777215),y++;y+=C-p}break;case 12:B?K.setRGBs(k,f,p,t,B,V*C+y,C):K.moveArea(y,V,p,t,k-y,f-V);break;case 13:g(K,null,m,k,f,p,t);J(K,m,k,f,p,t,B,C,y,V);break;case 14:J(K,m,k,f,p,t,B,C,y,V);break;case 15:C=K.setRGB;for(K=k;K<k+p;K++)for(y=f;y<f+t;y++)C(K,y,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+h)}d(k,f,p,t)};this.drawLineExt=function(h,m,k,f,p,t){if(h==k||m==f){var B;if(m==f)if(k>
h){var C=k-h;if(!(1>C))for(B=0;B<C;B++)z(t,h+B,m,p)}else{if(C=h-k,!(1>C))for(B=0;B<C;B++)z(t,k+B,m,p)}else if(f>m){if(C=f-m,!(1>C))for(B=0;B<C;B++)z(t,h,m+B,p)}else if(C=m-f,!(1>C))for(B=0;B<C;B++)z(t,h,f+B,p)}else{var y=Math.abs(k-h),V=Math.abs(f-m);B=h;C=m;var K,l;var D=k>=h?K=1:K=-1;var F=f>=m?l=1:l=-1;if(y>=V){F=K=0;var N=y;var ca=y/2>>0;var pa=V}else l=D=0,N=V,ca=V/2>>0,pa=y,y=V;if(1>y)return;for(V=0;V<=y;V++)z(t,B,C,p),ca+=pa,ca>=N&&(ca-=N,B+=K,C+=l),B+=D,C+=F}p=Math.min(h,k);h=Math.max(h,k);
k=Math.min(m,f);m=Math.max(m,f);0>h-p||0>m-k||d(p,k,h-p+1,m-k+1)};this.drawText=function(h,m,k,f,p,t,B,C,y,V,K,l,D,F,N,ca,pa,ua,Ba,Ea,Ca){var za=0;1<l?G(V,K,l,D,p,ua,Ba,Ea,Ca):1==k&&G(t,B,C,y,p,ua,Ba,Ea,Ca);for(var Ha=ca,wa=0;wa<ca;)switch(pa[za+wa]){case 255:var Aa=pa[za+wa+2];if(Aa>Ha-za){wa=ca=0;break}Aa=pa.slice?pa.slice(za,za+Aa):pa.subarray(za,za+Aa);Q[pa[za+wa+1]]=Aa;wa+=3;ca-=wa;za=wa;wa=0;break;case 254:var Na=(Aa=Q[pa[za+wa+1]])?Aa:null;Na&&0==Na[1]&&0==(m&32)&&(0!=(m&4)?N+=pa[za+wa+2]:
F+=pa[za+wa+2]);wa=wa+2<ca?wa+3:wa+2;ca-=wa;za=wa;wa=0;if(!Na)break;for(var Ya=Na.length,Za=0;Za<Ya;Za++){Aa=ra.getFont(h,Na[Za]);if(0==(m&32)){var Wa=Na[++Za];0!=(Wa&128)?(0!=(m&4)?N+=Na[Za+1]|Na[Za+2]<<8:F+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(m&4)?N+=Wa:F+=Wa}Aa&&(H(k,F+Aa.offset&65535,N+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,p,f,ua,Ba,Ea,Ca),0!=(m&32)&&(F+=Aa.width))}break;default:Aa=ra.getFont(h,pa[za+wa]),0==(m&32)&&(Wa=pa[za+ ++wa],0!=(Wa&128)?(0!=(m&4)?N+=pa[za+wa+1]|pa[za+wa+2]<<8:F+=
pa[za+wa+1]|pa[za+wa+2]<<8,wa+=2):0!=(m&4)?N+=Wa:F+=Wa),Aa&&(H(k,F+Aa.offset&65535,N+Aa.baseLine&65535,Aa.width,Aa.height,Aa.fontData,p,f,ua,Ba,Ea,Ca),0!=(m&32)&&(F+=Aa.width)),wa++}1<l?0<D&&d(V,K,l,D):0<C&&0<y&&d(t,B,C,y)};this.drawBitmap=function(h,m,k,f,p,t,B,C,y){var V=va.getBitmap(h,m);V?(h=V.width,m=V.height,p>h&&(p=h),t>m&&(t=m),12==y?ka.setRGBs(k,f,p,t,V.data,C*h+B,h):ka.bitBlt(y,a,k,f,p,t,V.data,h,B,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+h+" idx="+m)};this.saveDesktop=
function(h,m,k,f,p){ka.getRGBs(h,m,k,f,function(t){W.save(h,m,k,f,p,t)})};this.restoreDesktop=function(h,m,k,f,p){(p=W.restore(h,m,k,f,p))?ka.setRGBs(h,m,k,f,p,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(h,m,k){ra.putFont(h,m,k)};this.putBitmap=function(h,m,k){va.putBitmap(h,m,k)};this.putCursor=function(h,m){X.set(h,m)};this.setCursor=function(h){if(!S&&-1!=h){var m=X.get(h);if(m)ka.onSetCursor(m);else svGlobal.logger.warn("invalid cursor"+h)}};var ia=0;this.isSendingHistory=
function(){return 2E3>Date.now()-ia};this.getHistory=function(h,m,k){var f=null;(f=X.toPDU(h))&&m(f.buffer);if(ka.onGetGfxHistory)ka.onGetGfxHistory(h,m,k);else{Z&&Z.begin("his_bitmap");va.forEach(function(y,V,K){if(y){var l=0,D=0;K=0;for(var F=y.length;K<F;K++)y[K]&&y[K].data&&(l++,D+=y[K].raw?y[K].raw.length:4*y[K].data.length);if(l&&D){f=new Uint8Array(D+20*l+8);f[0]=h;f[2]=1;f[3]=4;D=new hi5.DataBuffer(f,4,f.length);D.setLittleEndian32(l);for(K=0;K<F;K++)(l=y[K])&&l.data&&(D.setLittleEndian16(V),
D.setLittleEndian16(K),D.setLittleEndian16(l.left),D.setLittleEndian16(l.top),D.setLittleEndian16(l.width),D.setLittleEndian16(l.height),D.setLittleEndian16(l.bitsperpixel),D.setLittleEndian16(l.codec),D.setLittleEndian32(l.raw?l.raw.length:4*l.data.length),D.setBytes(l.raw||new Uint8Array(l.data.buffer)));m(f.buffer)}}});Z&&Z.end("his_bitmap");Z&&Z.begin("his_font");(f=ra.toPDU(h))&&m(f.buffer);Z&&Z.end("his_font");for(var p=4,t=0,B=Q.length;t<B;t++)Q[t]&&(p+=Q[t].length+6);if(4<p){f=new Uint8Array(p);
f[0]=h;f[2]=1;f[3]=7;var C=4;t=0;for(B=Q.length;t<B;t++)Q[t]&&Q[t].length&&(f[C++]=t,f[C++]=t>>8,p=Q[t].length,f[C++]=p,f[C++]=p>>8,f[C++]=p>>16,f[C++]=p>>24,f.set(Q[t],C),C+=p);m(f.buffer)}(f=W.toPDU(h))&&m(f.buffer);k(h);ia=Date.now()}};this.onHistoryDone=function(){ka.onGetGfxHistory&&n.reconnect(a,b,!0)};this.setHistory=function(h,m){svGlobal.logger.info("setHistory type:"+h);switch(h){case 4:Z&&Z.begin("his_bitmap_dec");var k=m.getLittleEndian32();for(h=0;h<k;h++){var f=m.getLittleEndian16(),
p=m.getLittleEndian16(),t=m.getLittleEndian16(),B=m.getLittleEndian16(),C=m.getLittleEndian16(),y=m.getLittleEndian16(),V=m.getLittleEndian16(),K=m.getLittleEndian16(),l=m.getLittleEndian32(),D=new Uint8Array(m.getData().buffer,m.getPosition(),l),F=new Uint8Array(l);F.set(D);D=rdpcodecs.bitmap;switch(K){case 0:var N=new Uint32Array(F.buffer);m.skipPosition(l);break;case 1:switch(V){case 16:N=D.decompressInt16(C,y,l,F,0);break;case 24:N=D.decompressInt24(C,y,l,F,0);break;case 32:N=D.decompressInt32(C,
y,l,F,0)}m.skipPosition(l);break;case 2:N=new rdpcodecs.NSCodec,N.process(m,V,C,y),l=N.getData(),N=N.getDataSize(),N=new Uint32Array(N),rdpcodecs.flipimage(l,0,N,C,y,1)}va.putBitmap(f,p,new rdpcodecs.Bitmap(N,C,y,t,B,V,0==K?null:F,K))}Z&&Z.end("his_bitmap_dec");break;case 5:ra.fromStream(m);break;case 6:X.fromStream(m);break;case 7:for(;m.has(6);)if(h=m.getLittleEndian16(),l=m.getLittleEndian32())k=m.getData().subarray(m.getPosition(),m.getPosition()+l),Q[h]=k,m.skipPosition(l);break;case 9:W.fromStream(m);
break;default:if(ka.onSetGfxHistory)ka.onSetGfxHistory(h,m)}};var X=new function(){var h=[],m=!1;this.useRemoteCursor=function(k){m=k};this.set=function(k,f){m&&(f.system="");h[k]=f};this.get=function(k){return h[k]};this.total=function(){return h.length};this.toPDU=function(k){for(var f=2,p=2,t=0,B=0,C=h.length,y;B<C;B++)if(y=h[B])t++,p=p+7+(y.rawData?y.rawData.length:0);if(!t)return null;p=new Uint32Array(p);p[0]=30==k?100728862:100728861;p[1]=t;for(B=0;B<C;B++)if(y=h[B])if(k=y.rawData?y.rawData.length:
0,p[f++]=y.cache_idx|y.bpp<<16,p[f++]=y.hotX|y.hotY<<16,p[f++]=y.width|y.height<<16,p[f++]=y.xorSize,p[f++]=y.andSize,p[f++]=y.distance,p[f++]=k)p.set(y.rawData,f),f+=k;return p};this.fromStream=function(k){var f=k.getPosition();k=new Uint32Array(k.getData().buffer,f);var p=k[0],t=0;for(f=1;t<p;t++){var B=k[f]&65535;var C=k[f++]>>16;var y=k[f]&65535;var V=k[f++]>>16;var K=k[f]&65535;var l=k[f++]>>16;var D=k[f++];var F=k[f++];var N=k[f++];var ca=k[f++];var pa=null;ca&&(pa=new Uint32Array(ca),pa.set(k.subarray(f,
f+ca)),f+=ca);C=new A(B,pa,y,V,K,l,C,D,F);N&&(C.distance=N);m&&(C.system="");h[B]=C}}};X.useRemoteCursor(!!la.remoteCursor);var W=new function(){function h(k,f,p,t,B,C){this.x=k;this.y=f;this.cx=p;this.cy=t;this.offset=B;this.data=C}var m=[];this.save=function(k,f,p,t,B,C){k=new h(k,f,p,t,B,C);f=0;for(p=m.length;f<p;f++)if(!m[f]){m[f]=k;return}m.push(k)};this.restore=function(k,f,p,t,B){for(var C,y=0,V=m.length;y<V;y++)if((C=m[y])&&C.x==k&&C.y==f&&C.cx==p&&C.cy==t){if(C.offset==B)return k=C.data,
m[y]=null,k;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(k){for(var f=0,p=2,t=0,B=m.length;t<B;t++)m[t]&&(f++,p+=m[t].data.length+6);if(!f||!p)return null;p=new Uint32Array(p);var C=2;p[0]=30==k?151060510:151060509;p[1]=f;for(t=0;t<B;t++)if(k=m[t])p[C++]=k.x,p[C++]=k.y,p[C++]=k.cx,p[C++]=k.cy,p[C++]=k.offset,p[C++]=k.data.length,p.set(k.data,C),C+=k.data.length;return p};this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());for(var f=1,p=k[0],t,
B,C,y,V,K,l,D=0;D<p;D++)t=k[f++],B=k[f++],C=k[f++],y=k[f++],V=k[f++],K=k[f++],l=new Uint32Array(K),K=f+K,l.set(k.subarray(f,K)),f=K,this.save(t,B,C,y,V,l)}},Q=[],ra=new function(){var h=[];this.putFont=function(m,k,f){h[m]||(h[m]=[]);h[m][k]=f};this.getFont=function(m,k){return h[m]?h[m][k]:null};this.toPDU=function(m){var k=0,f,p,t;var B=4;for(var C,y=h.length;k<y;k++)if((t=h[k])&&t.length)for(C=t.length,f=0;f<C;f++)(p=t[f])&&(B+=15+p.fontData.length);if(5>B)return null;var V=new Uint8Array(B);B=
new hi5.DataBuffer(V,0,B);V[0]=m;V[2]=1;V[3]=5;B.skipPosition(4);k=0;for(y=h.length;k<y;k++)if((t=h[k])&&t.length)for(C=t.length,f=0;f<C;f++)if(p=t[f])B.setByte(k),B.setLittleEndian16(f),B.setLittleEndian16(p.offset),B.setLittleEndian16(p.baseLine),B.setLittleEndian16(p.width),B.setLittleEndian16(p.height),B.setLittleEndian32(p.fontData.length),B.setBytes(p.fontData);return V};this.fromStream=function(m){for(;m.has(15);){var k=m.getByte(),f=m.getLittleEndian16(),p=m.getLittleEndian16(),t=m.getLittleEndian16(),
B=m.getLittleEndian16(),C=m.getLittleEndian16(),y=m.getLittleEndian32();y=m.getBytes(y);this.putFont(k,f,new x(p,t,B,C,y))}}},va=new function(){var h=[],m=[];this.putBitmap=function(k,f,p){if(32767==f)m[k]&&(m[k].data=null,m[k]=null),m[k]=p;else{var t=h[k];t?t[f]&&(t[f].data=null,t[f]=null):h[k]=t=[];t[f]=p}};this.getBitmap=function(k,f){return 32767==f?m[k]:h[k]?h[k][f]:null};this.forEach=function(k){for(var f=h.length,p=0;p<f;p++)k(h[p],p,h)}}}function Ob(a){function b(l,D,F){D[F]=l>>24&255;D[F+
1]=l>>16&255;D[F+2]=l>>8&255;D[F+3]=l&255}function c(l,D){var F=l.length;D=new Uint8Array(D?F+1:F);for(var N=0;N<F;N++)D[N]=l.charCodeAt(N);return D}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),g={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},
q=this,J=1,z=a?48E3:9E4,G=1,H=!1,x=null;this.initTypes=function(){for(var l in g)g[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)];g.url=[117,114,108,32]};q.initTypes();this.reset=function(){H=!1;G=J=1};this.close=function(){q&&(q.reset(),q=null)};this.remux=function(l){l.id=J;l.isAudio=a;l.timeScale=a?l.audioHeader.sampleRate:z;if(!H){var D=new v(a),F=new u(l);x=new Uint8Array(D.data.length+F.data.length);x.set(D.data,0);x.set(F.data,D.data.length);H=!0}l.sequenceNumber=G++;
D=new p(l);F=new K(l);l=new Uint8Array(D.data.length+F.data.length);l.set(D.data,0);l.set(F.data,D.data.length);x&&(D=new Uint8Array(x.length+l.length),D.set(x,0),D.set(l,x.length),l=D,x=null);if(q.ondata)q.ondata(l)};var A=function(l){this.type=l;this.data=null};A.prototype.setData=function(){var l=Array.prototype.slice.call(arguments,0),D=l.length,F=8,N;for(N=0;N<D;N++)F+=l[N].byteLength;this.data=new Uint8Array(F);b(F,this.data,0);this.data.set(this.type,4);F=8;for(N=0;N<D;N++)this.data.set(l[N],
F),F+=l[N].byteLength};var v=function(l){var D=A.call(this,g.ftyp)||this;var F=c("mp42"),N=c("mp41"),ca=c("isom"),pa=c("avc1"),ua=c("iso5"),Ba=new Uint8Array([0,0,2,0]);l?D.setData(F,Ba,F,N,ca,ua):D.setData(ca,Ba,ca,N,ua,pa);return D};$jscomp.inherits(v,A);var u=function(l){var D=A.call(this,g.moov)||this;var F=new Y(l),N=new w(l);l=new k(l);D.setData(F.data,N.data,l.data);return D};$jscomp.inherits(u,A);var Y=function(l){l=A.call(this,g.mvhd)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,
0]),N=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]),pa=new Uint8Array(4);b(1E3,pa,0);var ua=new Uint8Array([0,1,0,0]),Ba=new Uint8Array([1,0]),Ea=new Uint8Array(10),Ca=new Uint8Array(36);Ca[1]=1;Ca[17]=1;Ca[32]=64;var za=new Uint8Array(24),Ha=new Uint8Array([255,255,255,255]);l.setData(D,F,N,ca,pa,e,ua,Ba,Ea,Ca,za,Ha);return l};$jscomp.inherits(Y,A);var w=function(l){var D=A.call(this,g.trak)||this;var F=new Z(l);l=new M(l);D.setData(F.data,l.data);return D};$jscomp.inherits(w,A);var Z=function(l){var D=
A.call(this,g.tkhd)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,7]),ca=new Uint8Array([0,0,0,0]),pa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(l.id,ua,0);var Ba=new Uint8Array(4),Ea=new Uint8Array(8),Ca=new Uint8Array([0,0]),za=new Uint8Array([0,0]),Ha=l.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),wa=new Uint8Array(2),Aa=new Uint8Array(36);Aa[1]=1;Aa[17]=1;Aa[32]=64;var Na=new Uint8Array(4);Na[0]=l.width>>8&255;Na[1]=l.width&255;Na[2]=0;Na[3]=0;var Ya=new Uint8Array(4);Ya[0]=
l.height>>8&255;Ya[1]=l.height&255;Ya[2]=0;Ya[3]=0;D.setData(F,N,ca,pa,ua,Ba,e,Ea,Ca,za,Ha,wa,Aa,Na,Ya);return D};$jscomp.inherits(Z,A);var M=function(l){var D=A.call(this,g.mdia)||this;var F=new O(l),N=new P(l);l=new oa(l);D.setData(F.data,N.data,l.data);return D};$jscomp.inherits(M,A);var O=function(l){var D=A.call(this,g.mdhd)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,0]),pa=new Uint8Array([0,0,0,0]),ua=new Uint8Array(4);b(l.timeScale,ua,0);l=new Uint8Array([85,
196]);var Ba=new Uint8Array(2);D.setData(F,N,ca,pa,ua,e,l,Ba);return D};$jscomp.inherits(O,A);var P=function(l){var D=A.call(this,g.hdlr)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array(4);l=l.isAudio?c("soun"):c("vide");var pa=new Uint8Array(12),ua=c("Remote Spark Handler",!0);D.setData(F,N,ca,l,pa,ua);return D};$jscomp.inherits(P,A);var oa=function(l){var D=A.call(this,g.minf)||this;var F=new E,N=new S(l);l.isAudio?(l=new U,D.setData(l.data,F.data,N.data)):(l=new ba,
D.setData(l.data,F.data,N.data));return D};$jscomp.inherits(oa,A);var ba=function(){var l=A.call(this,g.vmhd)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,1]),N=new Uint8Array([0,0]),ca=new Uint8Array(6);l.setData(D,F,N,ca);return l};$jscomp.inherits(ba,A);var U=function(){var l=A.call(this,g.smhd)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,0]),N=new Uint8Array([0,0]),ca=new Uint8Array(2);l.setData(D,F,N,ca);return l};$jscomp.inherits(U,A);var E=function(){var l=A.call(this,g.dinf)||
this;var D=new ea;l.setData(D.data);return l};$jscomp.inherits(E,A);var ea=function(){var l=A.call(this,g.dref)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,1]),ca=new ha;l.setData(D,F,N,ca.data);return l};$jscomp.inherits(ea,A);var ha=function(){var l=A.call(this,g.url)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,1]);l.setData(D,F);return l};$jscomp.inherits(ha,A);var S=function(l){var D=A.call(this,g.stbl)||this;l=new ka(l);var F=new ra,N=new va,ca=
new h,pa=new m;D.setData(l.data,F.data,N.data,ca.data,pa.data);return D};$jscomp.inherits(S,A);var ka=function(l){var D=A.call(this,g.stsd)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,1]);l.isAudio?(l=new aa(l),D.setData(F,N,ca,l.data)):(l=new X(l),D.setData(F,N,ca,l.data));return D};$jscomp.inherits(ka,A);var aa=function(l){var D=A.call(this,g.mp4a)||this;var F=new Uint8Array(6),N=new Uint8Array([0,1]),ca=new Uint8Array(8),pa=new Uint8Array([0,2]),ua=new Uint8Array([0,
16]),Ba=new Uint8Array([0,0]),Ea=new Uint8Array(2),Ca=l.audioHeader.sampleRate,za=new Uint8Array(4);za[0]=Ca>>8&255;za[1]=Ca&255;za[2]=0;za[3]=0;l=new ia(l);D.setData(F,N,ca,pa,ua,Ba,Ea,za,l.data);return D};$jscomp.inherits(aa,A);var ia=function(l){var D=A.call(this,g.esds)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array([3]),pa=new Uint8Array([25]),ua=new Uint8Array([0,0]),Ba=new Uint8Array([0]),Ea=new Uint8Array([4]),Ca=new Uint8Array([17]),za=new Uint8Array([64]),Ha=
new Uint8Array([21]),wa=new Uint8Array(3),Aa=l.bufferSizeDB;wa[0]=Aa>>16&255;wa[1]=Aa>>8&255;wa[2]=Aa&255;Aa=new Uint8Array(4);b(l.bitRate,Aa,0);var Na=new Uint8Array(4);b(l.bitRate,Na,0);var Ya=new Uint8Array([5]),Za=new Uint8Array([2]),Wa=l.audioHeader.audioType||2,nb=l.audioHeader.frequencyIdx,wb=l.audioHeader.channelConfig;l=new Uint8Array(2);l[0]=Wa<<3|nb>>1&7;l[1]=(nb&1)<<7|wb<<3;Wa=new Uint8Array([6]);nb=new Uint8Array([1]);wb=new Uint8Array([2]);D.setData(F,N,ca,pa,ua,Ba,Ea,Ca,za,Ha,wa,Aa,
Na,Ya,Za,l,Wa,nb,wb);return D};$jscomp.inherits(ia,A);var X=function(l){var D=A.call(this,g.avc1)||this;var F=new Uint8Array(6),N=new Uint8Array([0,1]),ca=new Uint8Array([0,0]),pa=new Uint8Array(2),ua=new Uint8Array(12),Ba=new Uint8Array(2);Ba[0]=l.width>>8&255;Ba[1]=l.width&255;var Ea=new Uint8Array(2);Ea[0]=l.height>>8&255;Ea[1]=l.height&255;var Ca=new Uint8Array([0,72,0,0]),za=new Uint8Array([0,72,0,0]),Ha=new Uint8Array(4),wa=new Uint8Array([0,1]),Aa=c("SparkStreamPlayer"),Na=new Uint8Array(32);
Na[0]=Aa.length;Na.set(Aa,1);Aa=new Uint8Array([0,24]);var Ya=new Uint8Array([255,255]);l=new W(l);D.setData(F,N,ca,pa,ua,Ba,Ea,Ca,za,Ha,wa,Na,Aa,Ya,l.data);return D};$jscomp.inherits(X,A);var W=function(l){var D=A.call(this,g.avcC)||this;var F=new Uint8Array([1]),N=new Uint8Array([l.sps[1]]),ca=new Uint8Array([l.sps[2]]),pa=new Uint8Array([l.sps[3]]),ua=new Uint8Array([255]),Ba=new Uint8Array([225]),Ea=new Uint8Array(2),Ca=l.sps.byteLength;Ea[0]=Ca>>8&255;Ea[1]=Ca&255;Ca=new Uint8Array(l.sps);var za=
new Uint8Array([1]),Ha=new Uint8Array(2),wa=l.pps.byteLength;Ha[0]=wa>>8&255;Ha[1]=wa&255;l=new Uint8Array(l.pps);D.setData(F,N,ca,pa,ua,Ba,Ea,Ca,za,Ha,l);return D};$jscomp.inherits(W,A);var Q=function(){var l=A.call(this,g.btrt)||this;var D=new Uint8Array([0,28,156,128]),F=new Uint8Array([0,45,198,192]),N=new Uint8Array([0,45,198,192]);l.setData(D,F,N);return l};$jscomp.inherits(Q,A);var ra=function(){var l=A.call(this,g.stts)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,0]),N=new Uint8Array([0,
0,0,0]);l.setData(D,F,N);return l};$jscomp.inherits(ra,A);var va=function(){var l=A.call(this,g.stsc)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,0]);l.setData(D,F,N);return l};$jscomp.inherits(va,A);var h=function(){var l=A.call(this,g.stsz)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]);l.setData(D,F,N,ca);return l};$jscomp.inherits(h,A);var m=function(){var l=A.call(this,g.stco)||this;var D=
new Uint8Array([0]),F=new Uint8Array([0,0,0]),N=new Uint8Array([0,0,0,0]);l.setData(D,F,N);return l};$jscomp.inherits(m,A);var k=function(l){var D=A.call(this,g.mvex)||this;l=new f(l);D.setData(l.data);return D};$jscomp.inherits(k,A);Q=function(l){l=A.call(this,g.mehd)||this;var D=new Uint8Array([0]),F=new Uint8Array([0,0,0]);l.setData(D,F,d);return l};$jscomp.inherits(Q,A);var f=function(l){var D=A.call(this,g.trex)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l.id,
ca,0);l=new Uint8Array([0,0,0,1]);var pa=new Uint8Array([0,0,0,0]),ua=new Uint8Array([0,0,0,0]),Ba=new Uint8Array([0,0,0,0]);D.setData(F,N,ca,l,pa,ua,Ba);return D};$jscomp.inherits(f,A);var p=function(l){var D=A.call(this,g.moof)||this;t.setSequenceNumber(l.sequenceNumber);l=new B(l);D.setData(t.data,l.data);return D};$jscomp.inherits(p,A);Q=function(l){var D=A.call(this,g.mfhd)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);D.setData(F,N,ca);return D};$jscomp.inherits(Q,
A);Q.prototype.setSequenceNumber=function(l){b(l,this.data,12)};var t=new Q(1),B=function(l){var D=A.call(this,g.traf)||this;C.setTrackId(l.id);C.setSampleDuration(l.frameDuration);y.setBaseMediaDecodeTime(l.samples[0].timestamp);var F=32+C.data.length+y.data.length;if(l.isAudio)l=new V(l,null,F);else{for(var N=[],ca=0;ca<l.samples.length;ca++){var pa=l.samples[ca];N.push({size:pa.unitsLength+4*pa.units.length,duration:l.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:pa.hasIDR?
2:1,isDependedOn:0,hasRedundancy:0,isNonSync:pa.hasIDR?0:1,degradationPriority:0}})}l=new V(l,N,F)}D.setData(C.data,y.data,l.data);return D};$jscomp.inherits(B,A);Q=function(l,D){var F=A.call(this,g.tfhd)||this;F.isAudio=D;var N=new Uint8Array([0]),ca=D?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),pa=new Uint8Array(4);b(l,pa,0);D?(l=new Uint8Array([0,0,0,1]),D=new Uint8Array(4),b(1024,D,0),F.setData(N,ca,pa,l,D)):(l=new Uint8Array([0,0,2,0,1,1,0,0]),F.setData(N,ca,pa,l));return F};$jscomp.inherits(Q,
A);Q.prototype.setTrackId=function(l){b(l,this.data,12)};Q.prototype.setSampleDuration=function(l){this.isAudio||b(l,this.data,16)};var C=new Q(0,a);Q=function(l){var D=A.call(this,g.tfdt)||this;var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);D.setData(F,N,ca);return D};$jscomp.inherits(Q,A);Q.prototype.setBaseMediaDecodeTime=function(l){b(l,this.data,12)};var y=new Q(0),V=function(l,D,F){var N=A.call(this,g.trun)||this;var ca=new Uint8Array([0]),pa=l.isAudio?new Uint8Array([0,
2,1]):new Uint8Array([0,15,1]),ua=l.isAudio?4:16;F+=ua*(l.isAudio?l.samples.length:D.length)+28;var Ba=new Uint8Array(4);l.isAudio?b(l.samples.length,Ba,0):b(D.length,Ba,0);var Ea=new Uint8Array(4);b(F,Ea,0);if(l.isAudio){F=new Uint8Array(ua*l.samples.length);for(var Ca=0;Ca<l.samples.length;Ca++)b(l.samples[Ca].aacData.byteLength,F,ua*Ca)}else for(F=new Uint8Array(ua*D.length),Ca=0;Ca<D.length;Ca++){l=D[Ca];var za=ua*Ca;b(l.duration,F,za);b(l.size,F,za+4);var Ha=l.flags,wa=new Uint8Array(4);wa[0]=
Ha.isLeading<<2|Ha.dependsOn;wa[1]=Ha.isDependedOn<<6|Ha.hasRedundancy<<4|0|Ha.isNonSync;wa[2]=Ha.degradationPriority&61440;wa[3]=Ha.degradationPriority&15;F.set(wa,za+8);b(l.compositionTimeOffset,F,za+12)}N.setData(ca,pa,Ba,Ea,F);return N};$jscomp.inherits(V,A);Q=function(l){var D=A.call(this,g.sdtp)||this;for(var F=new Uint8Array([0]),N=new Uint8Array([0,0,0]),ca=new Uint8Array(l.length),pa=0;pa<l.length;pa++){var ua=l[pa].flags;ca[pa]=ua.isLeading<<6|ua.dependsOn<<4|N.isDependedOn<<2|N.hasRedundancy}D.setData(F,
N,ca);return D};$jscomp.inherits(Q,A);var K=function(l){var D=A.call(this,g.mdat)||this;if(l.isAudio){for(var F=new Uint8Array(l.totalByteLength),N=0,ca=0;ca<l.samples.length;ca++){var pa=l.samples[ca].aacData;F.set(pa,N);N+=pa.byteLength}D.setData(F)}else{F=new Uint8Array(4*l.unitNum+l.totalByteLength);for(ca=N=0;ca<l.samples.length;ca++){pa=l.samples[ca];for(var ua=0;ua<pa.units.length;ua++){var Ba=pa.units[ua],Ea=Ba.data.byteLength;b(Ea,F,N);N+=4;F.set(Ba.data,N);N+=Ea}}D.setData(F)}return D};
$jscomp.inherits(K,A)}function rc(a){function b(G,H){this.aacData=G;this.timestamp=H}function c(G,H,x,A){this.audioType=G;this.frequencyIdx=H;this.sampleRate=x;this.channelConfig=A}var e=rc.SAMPLING_FREQUENCY,d=null,g=!0,q=this,J=0;this.reset=function(){J=0;d=null;z.audioHeader=null;a&&a.reset()};var z=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=
this.bitRate=this.duration=0}};this.setMediaFormat=function(G,H){var x=G.frequencyIdx;x||(x=e.indexOf(G.sampleRate));-1==x&&console.error("Invalid AAC sampel rate: "+G.sampleRate);d=new c(G.audioType||2,x,G.sampleRate,G.channels||G.channelConfig);z.audioHeader=d;g=!H;if(q.oncodec)q.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(G){if(g){var H=q.readADTSHeader(G);G=G.subarray(H)}H=new b(G,J);J+=1024;z.samples.push(H);z.totalByteLength+=G.byteLength;G=1/(d.sampleRate/1024);z.duration=
G;z.samples[0]&&(z.bitRate=8*z.samples[0].aacData.length/G|0);a&&a.remux(z);z.clear()};this.readADTSHeader=function(G){var H=G[1]&0?9:7,x=(G[2]>>6&3)+1,A=G[2]>>2&15,v=e[A];v||console.error("Invalid Sampling Frequency Index: "+A);var u=((G[2]&1)<<2)+(G[3]>>6&3),Y=G[1]>>1&3;0!=Y&&console.error("Invalid data format: layer is not 0x00: "+Y.toString(16));G.length!=((G[3]&3)<<11)+(G[4]<<3)+(G[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+G.length);if(d){if(A!=d.frequencyIdx&&(d.frequencyIdx=
A,d.sampleRate=v,q.oncodec))q.oncodec("mp4a.40.2",d)}else if(d=new c(x,A,v,u),z.audioHeader=d,q.oncodec)q.oncodec("mp4a.40.2",d);return H}}function Xc(a){function b(){if(0==J)console.error("no more ExpGolomb data");else{var H=0,x=q-J;for(z=0;x<q;){var A=a[x];if(3!=A||0!=a[x-1]||0!=a[x-2])z=z<<8|A,H++;x++;if(4<=H)break}4>H&&(z<<=4-H);G=8*H;J=q-x}}function c(H){if(!(G>H)){H-=G;var x=H>>3;H-=x>>3;J-=x;b()}z<<=H;G-=H}function e(H){var x=Math.min(G,H),A=z>>>32-x;32<H&&logger.error("Read more than 32 bits:"+
H);G-=x;0<G?z<<=x:0<J&&b();x=H-x;return 0<x?A<<x|e(x):A}function d(){var H;for(H=0;H<G;++H)if(0!==(z&2147483648>>>H))return z<<=H,G-=H,H;b();return H+d()}function g(){c(1+d())}var q=a.byteLength,J=q,z=0,G=0;this.readUEG=function(){var H=d();return e(H+1)-1};this.readEG=function(){var H=this.readUEG();return 1&H?1+H>>>1:-1*(H>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=
function(H){var x=8,A=8,v;for(v=0;v<H;v++)0!==A&&(A=this.readEG(),A=(x+A+256)%256),x=0===A?x:A};this.readSPS=function(){var H=0,x=0,A=0,v=0,u=1,Y,w=0,Z=!0;if(7>a.length)return console.log("no enough SPS data"),null;var M=this.readU8();if(7!=(M&31))return console.error("Invalid SPS type: "+M,a),null;M=this.readU8();e(5);c(3);this.readU8();g();if(100===M||110===M||122===M||244===M||44===M||83===M||86===M||118===M||128===M||138===M||139===M||134===M||135===M){var O=this.readUEG();3===O&&c(1);g();g();
c(1);if(this.readBool()){var P=3!==O?8:12;for(Y=0;Y<P;Y++)this.readBool()&&(6>Y?this.skipScalingList(16):this.skipScalingList(64))}}g();Y=this.readUEG();if(0===Y)this.readUEG();else if(1===Y)for(c(1),c(1+d()),c(1+d()),P=this.readUEG(),Y=0;Y<P;Y++)c(1+d());g();c(1);var oa=this.readUEG();Y=this.readUEG();P=e(1);0===P&&c(1);c(1);this.readBool()&&(H=this.readUEG(),x=this.readUEG(),A=this.readUEG(),v=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var ba=[1,1];break;
case 2:ba=[12,11];break;case 3:ba=[10,11];break;case 4:ba=[16,11];break;case 5:ba=[40,33];break;case 6:ba=[24,11];break;case 7:ba=[20,11];break;case 8:ba=[32,11];break;case 9:ba=[80,33];break;case 10:ba=[18,11];break;case 11:ba=[15,11];break;case 12:ba=[64,33];break;case 13:ba=[160,99];break;case 14:ba=[4,3];break;case 15:ba=[3,2];break;case 16:ba=[2,1];break;case 255:ba=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}ba&&(u=ba[0]/ba[1])}this.readBool()&&c(1);this.readBool()&&(c(4),
this.readBool()&&c(24));this.readBool()&&(g(),g());this.readBool()&&(w=this.readU32(),ba=this.readU32(),Z=this.readBool(),w=ba/(2*w))}u=Math.ceil((16*(oa+1)-2*H-2*x)*u);ba=(2-P)*(Y+1)*16-(P?2:4)*(A+v);Y="avc1."+(0==a[1]?"00":a[1].toString(16));Y+=0==a[2]?"00":a[2].toString(16);Y+=0==a[3]?"00":a[3].toString(16);return{width:u,height:ba,profileIdc:M,chromaFormatIdc:O,frameCropLeftOffset:H,frameCropRightOffset:x,frameCropTopOffset:A,frameCropBottomOffset:v,fps:w,fixedFrameRate:Z,codec:Y}};this.readSliceType=
function(){this.readU8();this.readUEG();return this.readUEG()}}function Ud(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=J;this.unitsLength=z;this.timestamp=d;this.hasIDR=g}function e(){var A=!1;if(q&&H.sps){var v=new c;d+=H.frameDuration||3E3;H.samples.push(v);H.totalByteLength+=
z;H.unitNum+=J.length;H.sequence++;A=!0;if(v.hasIDR&&x.onkeyframe)x.onkeyframe(v)}q=g=!1;J=[];z=0;return A}var d=0,g=!1,q=!1,J=[],z=0,G=Ob.searchStartCode,H=null,x=this;H=new b;this.reset=function(){d=0;g=!1;J=[];z=0;H=new b;a&&a.reset()};this.close=function(){x&&(x.reset(),x=null)};this.parseH264Data=this.parse=function(A){for(var v=[],u=0,Y,w,Z,M=[0,0];u<A.byteLength;){M[0]=u;G(A,M);var O=M[0];if(-1==O)break;u=M[1];u=O+u;Z=A[u];Z&=31;Y&&(Y={type:w,data:A.subarray(Y,O)},v.push(Y));Y=u;w=Z}Y&&(Y=
{type:w,data:A.subarray(Y,A.byteLength)},v.push(Y));for(A=0;A<v.length;A++)switch(M=v[A],u=M.type,u){case 1:case 2:case 3:case 4:J.push(M);z+=M.data.byteLength;q=!0;break;case 5:q=g=!0;J.push(M);z+=M.data.byteLength;break;case 6:break;case 7:u=new Xc(M.data);if(u=u.readSPS()){if(H.width=u.width,H.height=u.height,H.codec=u.codec,H.sps=M.data,u.fps&&(H.frameDuration=9E4/u.fps|0),J.push(M),z+=M.data.byteLength,x.oncodec)x.oncodec(H.codec,u)}else console.log("corrupted sps",M.data);break;case 8:H.pps=
M.data;J.push(M);z+=M.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+u)}e()&&H.sps&&(a.remux(H),H.clear())}}function Pb(a,b,c){function e(){for(;z;){if(w.updating){z=!1;break}var O=J.shift();if(!O)break;try{w.appendBuffer(O),G=0}catch(P){J.unshift(O);if("QuotaExceededError"==P.name)if(q(!0))continue;else{if(H.onerror)H.onerror(P);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),H.close();break}G++;console.error("Failed to append buffer, retry "+
G,P);if(2<G){if(H.onerror)H.onerror(P);break}}}}function d(){z=!0;e()}function g(){w=Y.addSourceBuffer(x);w.mode="sequence";w.addEventListener("updateend",d);w.addEventListener("error",function(O){console.error(O)});z=!0;H.play(!1);e()}function q(O){var P=Math.min(a.played.end(0),w.buffered.end(0)),oa=0,ba=u.length,U=!1,E=0;if(c)E=P-180,0>E&&console.warn("Not possible, time played secs: "+P);else if(1<ba){var ea=ba-2;for(P=9E4*P|0;oa<ba;){if(u[oa]>P){ea=oa-2;break}oa++}0<=ea&&(E=(u[ea]+1E3)/9E4)}if(0<
E)try{w.remove(0,E),u.splice(0,ea+1),U=!0,console.info("Buffer removed "+E+" isAudio: "+c)}catch(ha){console.warn("Buffer removal "+E+" failed, retry, isAudio: "+c)}O||(v=setTimeout(q,18E4));return U}var J=[],z=!1,G=0,H=this,x="",A=null,v=0,u=[],Y=null,w=null,Z=null,M=null;a.autoplay=!0;this.getKeyFrames=function(){return u};Z=new Ob(c);Z.ondata=function(O){J.push(O);e()};M=c?new rc(Z):new Ud(Z);M.onkeyframe=function(O){u.push(O.timestamp)};M.oncodec=function(O,P){var oa=c?"audio/mp4;codecs=":"video/mp4;codecs=";
oa+=O;if(oa!=x||(c?A.sampleRate!=P.sampleRate:A.width!=P.width||A.height!=P.height))if(x=oa,A=P,z=!1,w=null,Y=new MediaSource,Y.addEventListener("sourceopen",g),a.src=URL.createObjectURL(Y),H.onsps)H.onsps(P)};b.onvideoframe=function(O){M.parse(O.bitstream)};b.onaudioframe=function(O){M.parse(O)};b.onendofstream=function(){H.reset()};this.play=function(O){a.play().catch(function(P){if(!O&&(console.error(P),H.onplayerror))H.onplayerror(P)})};this.reset=function(){console.log("Reset player");v&&(clearTimeout(v),
v=0);u.length=0;z=!1;x="";A=null;M&&M.reset();J.length=0};this.close=function(){H&&(H.reset(),Y&&"open"==Y.readyState&&(Y.endOfStream(),a.src=null),M&&M.close&&M.close(),Z&&Z.close&&Z.close(),H=null)};this.setMediaFormat=function(O,P){M.setMediaFormat&&M.setMediaFormat(O,P)};this.getMediaSource=function(){return Y};this.getMediaSourceBuffer=function(){return w};a.addEventListener("ended",function(O){console.warn(".... ended");v&&(clearTimeout(v),v=0)});a.addEventListener("emptied",function(O){z=!!w});
a.addEventListener("pause",function(O){console.warn(".... paused");z=!!w;var P=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+P)}).catch(function(oa){console.error(oa)})});a.addEventListener("waiting",function(O){z=!!w})}function Vd(a,b,c,e){function d(u,Y,w,Z){var M,O,P,oa,ba,U,E,ea,ha,S,ka,aa,ia,X,W,Q,ra,va,h,m,k,f,p,t,B,C,y,V,K,l,D,F,N,ca,pa,ua,Ba,Ea,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){if(1==za.nextAddress)return M=u.allocationSize(),
O=new Uint8Array(M),za.yield(u.copyTo(O),2);P=u.codedWidth;oa=(P+1)/2|0;ba=u.codedHeight;U=(ba+1)/2|0;E=P*ba;ea=E+oa*U;ha=2*E;S=Y.subarray(E,ha);ka=Y.subarray(ha);ra=Q=W=X=ia=aa=0;k=m=h=va=null;f=O.subarray(0,E);p=O.subarray(E,ea);t=O.subarray(ea);B=0;for(C=Z.length;B<C;B++){y=Z[B];V=y.left;K=y.top;l=y.right;D=y.bottom;F=V/2|0;N=K/2|0;ca=l/2|0;pa=D/2|0;ua=F/2|0;Ba=ca/2|0;for(ia=K;ia<D;ia++)for(Q=ia*P,ra=Q+P,va=f.subarray(Q,ra),m=S.subarray(Q,ra),k=ka.subarray(Q,ra),aa=F;aa<ca;aa++)W=2*aa+1,m[W]=va[aa],
k[W]=va[aa+oa];Ea=(oa+1)/2|0;if(w)for(Ca=O.subarray(E),ia=N;ia<pa;ia++)for(Q=ia*P,ra=Q+oa,va=Ca.subarray(Q,ra),Q=ra,ra=Q+oa,h=Ca.subarray(Q,ra),Q=(2*ia+1)*P,ra=Q+P,m=S.subarray(Q,ra),k=ka.subarray(Q,ra),aa=F;aa<ca;aa++)X=2*aa,m[X]=va[aa],k[X]=h[aa];else for(ia=N;ia<pa;ia++)for(Q=ia*oa,ra=Q+oa,va=p.subarray(Q,ra),h=t.subarray(Q,ra),Q=(2*ia+1)*P,ra=Q+P,m=S.subarray(Q,ra),k=ka.subarray(Q,ra),aa=ua;aa<Ba;aa++)X=4*aa,m[X]=va[aa],k[X]=va[aa+Ea],X+=2,m[X]=h[aa],k[X]=h[aa+Ea]}za.jumpToEnd()})}function g(u,
Y,w,Z){var M,O,P,oa,ba,U,E,ea,ha,S,ka,aa,ia,X,W,Q,ra,va,h,m,k,f,p,t,B,C,y,V,K,l,D,F,N,ca,pa,ua,Ba,Ea,Ca,za,Ha,wa,Aa,Na,Ya,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return M=new Uint8Array(u.allocationSize()),Wa.yield(u.copyTo(M),2);O=u.codedWidth;P=u.codedHeight;oa=(O+1)/2|0;ba=(P+1)/2|0;U=O*P;E=U+oa*ba;ea=M.subarray(U,E);ha=M.subarray(E);S=2*U;ka=Y.subarray(U,S);aa=Y.subarray(S);h=va=ra=Q=W=X=ia=0;p=f=k=m=null;t=0;for(B=Z.length;t<B;t++){C=Z[t];y=C.left;
V=C.top;K=C.right;l=C.bottom;D=K-y;F=l-V;N=V*O+y;ca=M.subarray(N,U);pa=Y.subarray(N,U);ua=ka.subarray(N);Ba=aa.subarray(N);Ea=y/2|0;Ca=V/2|0;za=K/2|0;Ha=l/2|0;wa=za-Ea;Aa=Ha-Ca;for(X=0;X<F;X++)Q=X*O,ra=Q+D,m=ca.subarray(Q,ra),pa.set(m,Q);if(w)for(N=Ca*O+y,Na=M.subarray(U+N),X=0;X<Aa;X++){Q=X*O;ra=Q+D;m=Na.subarray(Q,ra);Q=2*X*O;ra=Q+D;f=ua.subarray(Q,ra);p=Ba.subarray(Q,ra);for(ia=0;ia<wa;ia++)W=2*ia,va=m[W],f[W]=va,f[W+1]=va,h=m[W+1],p[W]=h,p[W+1]=h,void 0==h&&console.log("undefined v: "+W,ia,X,
Q,ra,D,wa,Aa);Q+=O;ua.set(f,Q);Ba.set(p,Q)}else for(N=Ca*oa+Ea,Ya=ea.subarray(N),Za=ha.subarray(N),X=0;X<Aa;X++){Q=X*oa;ra=Q+wa;m=Ya.subarray(Q,ra);k=Za.subarray(Q,ra);Q=2*X*O;ra=Q+D;f=ua.subarray(Q,ra);p=Ba.subarray(Q,ra);for(ia=0;ia<wa;ia++)W=2*ia,va=m[ia],f[W]=va,f[W+1]=va,h=k[ia],p[W]=h,p[W+1]=h;Q+=O;ua.set(f,Q);Ba.set(p,Q)}}return Wa.return(Y)})}function q(u){var Y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){switch(w.nextAddress){case 1:if(!e){if(1E3==u.duration)G.onframedecoded(u,
v.getRects(u.timestamp));w.jumpTo(2);break}Y=null;return 1E3==u.duration?w.yield(v.setMainFrame(u),6):w.yield(v.getCombinedFrame(u),5);case 5:Y=w.yieldResult;w.jumpTo(4);break;case 6:Y=w.yieldResult;case 4:G.onframedecoded(Y),Y.close();case 2:u.close(),w.jumpToEnd()}})}function J(u){var Y=u.codec;if(Y!=z||(b?x.sampleRate!=u.sampleRate:x.width!=u.width||x.height!=u.height))if(console.log("Codec: "+Y+" audio: "+b),z=Y,x=u,H||(H=new VideoDecoder({output:function(w){q(w)},error:function(w){console.error("VideoDecoder error:",
w);if(G.onerror)G.onerror(w)}})),Y={codec:z,codedWidth:u.width,codedHeight:u.height,hardwareAcceleration:c||"no-preference"},console.log(Y),H.configure(Y),G.onsps)G.onsps(u)}var z=null,G=this,H,x=null,A={type:"delta",data:null,timestamp:0,duration:0},v=new function(){function u(O){for(;;){var P=Y.shift();if(P){if(P.timestamp==O)return P.rects;if(P.timestamp>O){console.log("not possible, time: "+O+" option.timestamp: "+P.timestamp);break}}else break}return null}var Y=[],w=null,Z=!1,M={timestamp:0,
codedWidth:0,codedHeight:9,duration:0,format:"I444"};this.pushRects=function(O){Y.push(O)};this.getRects=u;this.setMainFrame=function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){if(1==P.nextAddress)return w||(w=new Uint8Array(2*O.allocationSize()),Z="NV12"==O.format,M.codedWidth=O.codedWidth,M.codedHeight=O.codedHeight,console.log("isNV12: "+Z+" supportsI444: "+e)),P.yield(g(O,w,Z,u(O.timestamp)),2);M.duration=O.duration;M.timestamp=O.timestamp;return P.return(new VideoFrame(w,
M))})};this.getCombinedFrame=function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){if(1==P.nextAddress)return P.yield(d(O,w,Z,u(O.timestamp)),2);M.duration=O.duration;M.timestamp=O.timestamp;return P.return(new VideoFrame(w,M))})};this.close=function(){w&&(w=null)}};a.onvideoframe=function(u){var Y=u.bitstream;var w=0,Z=[0,0],M=Y.length;var O=!1;var P=null;for(var oa=!1,ba=0,U=0;w<M;){Z[0]=w;Ob.searchStartCode(Y,Z);var E=Z[0];if(-1==E){U=Z[1];break}E+=Z[1];w=E+1;ba=Y[E]&31;switch(ba){case 5:O=
!0;break;case 7:(P=(new Xc(Y.subarray(E))).readSPS())||(oa=!0)}}w=M-w;Z=null;7>w&&(Z=Y.subarray(0,M-(w+(U+1))),7==ba&&(oa=!1));Y=Z;oa&&console.log("corrupted: "+u.timestamp,u.bitstream);P&&J(P);x&&(v.pushRects({timestamp:u.timestamp,rects:u.regionRects}),Y&&(u.bitstream=Y),A.type=O?"key":"delta",A.data=u.bitstream,A.timestamp=u.timestamp,A.duration=u.isChroma?77:1E3,u=new EncodedVideoChunk(A),H.decode(u))};this.play=function(u){};this.reset=function(){console.log("Reset MediaDecoder");x=z=null;v.close();
H&&H.reset()&&H.close();H=null};this.close=function(){G.reset();H&&(H.close(),H=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Nb=!1,mb={},kb={},Bb=null,n=this,Lb=!1,Xa=!1,db=0,Cb=null,Yc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});
var la=hi5.appcfg,Kb="";this.setConfig=function(a){la=a};var cb="object"==typeof r?r:null,L=cb?{}:hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));void 0==L.mapClipboard&&la.clipboard&&void 0!=la.clipboard.enabled&&(L.mapClipboard=la.clipboard.enabled);L.hardwareAcceleration||(L.hardwareAcceleration=la.hardwareAcceleration);void 0==L.yuv444&&(L.yuv444=la.yuv444);void 0==la.enableDVCAudio&&(la.enableDVCAudio=!0);var Ka=0,La=0,gb=(na||L.color||L.server_bpp||16)|0,pc=null,Zc=null,Qa=null,sc=null,$c=
"/DOWNLOAD?",ad="/CLIP?";24==gb&&(gb=16);var Va="app"==L.startProgram,Mb=R(L.mapDisk),ob=0;this.setLinks=function(a){a.download&&($c=a.download);a.clipboard&&(ad=a.clipboard)};this.protocol=cb?"":r.substring(0,r.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return R(L.smartCard)||R(L.mapSmartCard)||R(L.passwordIsPin)};this.enableWebAuthn=function(){return R(L.enableWebAuthn)||R(L.useWebAuthn)};this.hasScanner=function(){return R(L.scanner)};this.hasUSB=function(){return R(L.mapUSB)&&
!!navigator.usb};this.getUSB=function(){return L.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Zc=a};this.getProfiler=function(){return Zc};this.gateway=function(){if(cb)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss:\/\//ig,
"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ya;var lb="object"==typeof r||0<r.indexOf("/PLAY?"),tc=!lb&&0<r.indexOf("invitation=");if(tc){var uc=decodeURIComponent(r),Qb=uc.indexOf(' USERNAME="');if(0<Qb){Qb+=11;var Wd=uc.substring(Qb,uc.indexOf('"',Qb));r+="&novice="+Wd}r+="&mapClipboard=on";L.mapClipboard="on";this.reconnectOnResize=!1}if(lb)this.mode=1,cb?r="":(Ka=640,La=480),r+="&touchpad=on",L.touchpad=
"on",this.reconnectOnResize=!1;else if(0<r.indexOf("/JOIN?")||tc)this.mode=2,this.reconnectOnResize=!1;var vc=R(L.gfx)||R(L.remotefx)||0<n.mode;vc&&(Va||tc?(vc=!1,L.remotefx=!1):gb=32);I?Ka=parseInt(I):L.width&&(Ka=parseInt(L.width));T?La=parseInt(T):L.height&&(La=parseInt(L.height));-1==Ka&&(Ka=hi5.browser.getScreenWidth());-1==La&&(La=hi5.browser.getScreenHeight());L.symlink&&L.parameters&&hi5.tool.queryToObj(L.parameters,L);L.gateway||(r+="&gateway="+encodeURIComponent(n.gateway));!L.minWidth&&
la.minWidth&&(L.minWidth=la.minWidth);!L.minHeight&&la.minHeight&&(L.minHeight=la.minHeight);L.minWidth&&(L.minWidth=parseInt(L.minWidth));L.minHeight&&(L.minHeight=parseInt(L.minHeight));L.waWidth=L.waWidth?parseInt(L.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;L.waWidth&=-4;L.waHeight=L.waHeight?parseInt(L.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;L.waHeight&=-4;"useSSL"in L||(r+=
"&useSSL="+("wss"==n.protocol));hi5.storage.isAvailable&&(R(L.shareClipboard)||L.shareClipboardId)&&(r+="&shareClipboardId="+(L.shareClipboardId||da()));la&&(void 0!=la.displayMsg?this.displayMsg=la.displayMsg:la.displayMsg=this.displayMsg,la.appTimeout&&(this.appTimeout=la.appTimeout),void 0!=la.reconnectOnResize&&(this.reconnectOnResize=la.reconnectOnResize),la.reconnectTimes&&(this.reconnectTimes=la.reconnectTimes),void 0!=la.windowState&&(this.windowState=la.windowState),void 0!=la.openLink&&
(this.openLink=la.openLink),void 0!=la.setTitle&&(this.setTitle=la.setTitle),"boolean"==typeof la.useWSS&&(r=(la.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),"boolean"==typeof la.remoteAppLogin&&(this.remoteAppLogin=la.remoteAppLogin,Nb=!la.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof la.hideLogin&&(Nb=la.hideLogin),void 0!=la.localPrinter&&void 0==L.localPrinter&&(L.localPrinter=la.localPrinter));var Oa=null;void 0==
la.useWorker&&(la.useWorker=!1);la.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(la.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ma=la.useWorker?new Worker(ta("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,vb=this.reconnectTimes,dc=Ma?{type:5,data:null}:null;this.getDisplayName=fa;this.server=fa();this.port=parseInt(L.port,10);this.loadbalanceToken="";la.loadbalanceTokenName&&
(L[la.loadbalanceTokenName]?ma(L[la.loadbalanceTokenName]):!1!==la.randomAppId?ma(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){n.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+n.loadbalanceToken:"&"+n.loadbalanceToken,a+="&loadbalanceTokenName="+la.loadbalanceTokenName);return a};this.getURL=function(){return r};this.getRuntimeURL=function(){var a=r+"&width="+Ka+"&height="+La+"&server_bpp="+gb+"&audio="+(Ta.available||hi5.browser.isIE),b=Hc(),
c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=L.monitorDef,d=L.monitor,g=0;b=ja.size();var q=Array(b);c=Array(b);var J=0,z=0,G=0,H=0,x=0,A=0,v="";if(e){c=sa.parseMonitorDef(e);for(b=c.length;g<b;g++){var u=c[g];u[0]<G&&(G=u[0]);u[1]<H&&(H=u[1]);u[2]>x&&(x=u[2]);u[3]>A&&(A=u[3])}0>G&&(J=-G);0>H&&(z=-H);u=0>d?[G,H,x,A]:c[d];L.width=u[2]-u[0]+1;L.height=u[3]-u[1]+1;g=ja.getSurface(0);g.setMonitor(u[0],u[1],u[2],u[3]);if(J||z)for(u=g.getMousePosition(),u.left+=J,u.right+=J,u.top+=
z,u.bottom+=z,g=0;g<b;g++)u=c[g],u[0]+=J,u[1]+=z,u[2]+=J,u[3]+=z;sa.setMonitorLayout(c);0>d&&sa.setMonitorCount(0);n.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+L.width+"&height="+L.height}else{if(1<b&&!Va){for(ja.verifyMonitors();g<b;g++)e=ja.getSurface(g),u=e.getMousePosition(),u.left<G&&(G=u.left),u.top<H&&(H=u.top),u.right>x&&(x=u.right),u.bottom>A&&(A=u.bottom),q[g]=u,v&&(v+=","),v+=u.left+":"+u.top+":"+u.right+":"+u.bottom;0>G&&(J=-G);0>H&&(z=-H);for(g=0;g<b;g++){u=ja.getSurface(g).getMousePosition();
if(J||z)u.left+=J,u.right+=J,u.top+=z,u.bottom+=z;c[g]=[u.left,u.top,u.right,u.bottom,u.left==J&&u.top==z?1:0]}sa.setMonitorLayout(c);n.reconnectOnResize=!1}v&&(svGlobal.logger.warn("MonitorDef:"+v),L.width=x-G+1,L.height=A-H+1,v="&monitorDef="+v+"&width="+L.width+"&height="+L.height);b=v}a+=b;0>r.indexOf("waWidth")&&(b=(b=ja.getFocused())?b.getWindow():window,a+="&waWidth="+L.waWidth+"&waHeight="+L.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;L.tzOffset||(a+="&tzOffset="+
b.getTimezoneOffset());L.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==L.soundPref&&(L.soundPref=0,a+="&soundPref=0");J=c=b="";for(J in mb)z=mb[J],"flags"in z&&(b&&(b+=",",c+=","),b+=z.name,c+=z.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(J in kb)z=kb[J],"flags"in z&&(b&&(b+=","),b+=z.name);b&&(a+="&gwChannelName="+b);if(c=Ad())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);
b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);L.audioRecord=R(L.audioRecord)&&hi5.audio.recordable;Ia.init(b,vc,L.audioRecord,L.soundPref,R(L.mapCamera)&&!!navigator.mediaDevices,R(L.mapUSB)&&!!navigator.usb);L.audioRecord&&(a+="&audioRecord=on");L.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ia.count&&(a+="&dvcChannels="+Ia.names.join(","));a+="&binary=on";la.existingFile&&(a+="&existingFile="+la.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ya());
a=n.modifyURL(a);la.copyTextOnly&&R(L.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);R(L.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Jd()};this.getColor=function(){return gb};this.changeTitle=qa;hi5.browser.isTouch&&Math.max(Ka,La)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=
function(){return Va};var Fa=null,Ja=!1,rb=!1,qc=!1,Ta=new function(){function a(z){c&&(d&&d.disconnect(),g&&g.disconnect());hi5.audio.releaseAudioContext();z||(J&&(J.close(),J=null),q&&(q.pause(),q=null))}function b(z){console.error("play error: ",z)}var c=null;this.supportWebAudio=this.available=!1;(0==L.playSound||0<n.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(z){return c.createBuffer(2,
z,Ga.samplePerSec)};var e=0,d=null,g=null;this.setVolume=function(z){1==z?d=null:(d||(d=c.createGain()),d.gain.value=z)};this.playBuffer=function(z){g=c.createBufferSource();g.buffer=z;d?(g.connect(d),d.connect(c.destination)):g.connect(c.destination);var G=c.currentTime,H=0<e?e:G;H<G&&(H=G);e=H+z.duration;g.start?g.start(H):g.noteOn(H);return e-G};this.iOSFix=function(){if(c){var z=this.getBuffer(1024),G=c.createBufferSource();G.buffer=z;G.connect(c.destination);G.start?G.start(0):G.noteOn(0)}};
this.close=a;var q=null,J=null;this.onaudioframe=null;this.initMediaPlayer=function(z,G,H){a(!0);q||(q=document.createElement("audio"));J||(J=new Pb(q,z,!0),J.onplayerror=b,J.onerror=function(x){console.error("Not possible audio error",x)},svGlobal.logger.info("MediaPlayer init, headerless: "+H+" sampleRate:"+G.sampleRate));J.setMediaFormat(G,H);J.play(!1)}},Rd=Ta.available,ab=null,sa=new Bc(200,200);sa.onSetCursor=Mc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};
var ac=0,$b=0,bc=Ka-1,cc=La-1,oc="";window.$rdp||(window.$rdp=this);Da(gb);this.setResolution=Pa;this.running=function(){return Ja};this.setJoinMode=function(a){Ja&&xa("8E1"+a)};this.setJoinCloseMode=function(a){Ja&&xa("8EB3\t"+a)};this.refuseControl=function(a){Ja&&xa("8E3"+a)};this.giveControl=function(a){Ja&&xa("8E4"+a)};this.pauseSession=function(a,b){Ja&&xa("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ja&&xa("8EB2\t"+a)};this.requestControl=function(){Ja&&xa("8E2")};this.saveSession=
function(a){Ja&&xa("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ja&&xa("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(c&&0<c.length){var g=c.shift();g.key?Db.sendSingleKey(g.down,g.key):g.char&&ub(g.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,
context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(g,q){var J=b[q.toLowerCase()];J?n.writeScancode(g,J):(J=q.length,0!=J&&(1==J?n.writeKeyCode(g,q.toUpperCase().charCodeAt(0)):g&&n.writeText(q)))};var c=null,e=0,d=null;this.sendKeyComb=function(g,q,J){if(Xa){g=g.split("+");var z=g.length,G;if(0!=z){var H=
null,x=[];for(G=0;G<z;G++){var A=g[G];""==A&&""==H&&(A="Add");""!=A&&x.push({key:A,down:!0});H=A}z=x.length;for(G=z-1;0<=G;G--)x.push({key:x[G].key,down:!1});if(q)c=x,e=q,d=J,a();else for(G=0,z=x.length;G<z;G++)Db.sendSingleKey(x[G].down,x[G].key)}}};this.sendText=function(g,q,J){for(var z=[],G=0,H=g.length;G<H;G++)z.push({"char":g.charAt(G)});c=z;e=q;d=J;a()}};this.writeKeyComb=function(a,b,c){Xa&&Db.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Xa)if(b)Db.sendText(a,b,c);else for(b=0,c=
a.length;b<c;b++)ub(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),n.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ja=new function(a,b){function c(){function d(x){for(;0<x.ownerWinid;){var A=G.getWinById(x.ownerWinid);if(A&&A.isVisible())x=A;else break}return x}function g(x){for(var A="";x;)x.titleInfo&&(A=x.titleInfo),x=G.getWinById(x.ownerWinid);return A}var q=[],J=[],z=0,G=this;this.mainWin=null;this.appId="";var H=0;this.getActiveWinId=function(){return H};
this.setActiveWinId=function(x,A){svGlobal.logger.info("setActiveWinId: "+x+" old: "+H+" max: "+A);if(H!=x){var v=0==H;H=x;(x=G.getMainByWinId(x))&&x.isMainWin()&&G.mainWin!=x&&(G.mainWin=x);v&&A&&(A=ja.getFocused())&&(A=A.getFreeSpace(),x=A.width,n.resetSize(x,A.height))}};this.onchange=function(x){x.isVisible()||x!=G.mainWin?x.isVisible()&&!G.mainWin&&x.isMainWin()&&(G.mainWin=x,3==a.windowState&&x.exeCommand(61488)):G.mainWin=null};this.addWin=function(x){for(var A=q.length,v=!1,u=0;u<A;u++)if(x.id==
q[u].id){q[u]=x;v=!0;break}v||q.push(x);1==q.length&&(z=Date.now());A=x.isMainWin();svGlobal.logger.info("is mainwin:"+A+" id:"+x.id);A&&!G.mainWin&&(G.mainWin=x)};this.popWins=function(x){x=G.getWinById(x);var A=[];if(x){x=0<x.ownerWinid?x.ownerWinid:x.id;for(var v=q.length-1;0<=v;v--)if(q[v].ownerWinid==x||q[v].id==x)A.push(q[v]),q.splice(v,1)}return A};this.hasApp=function(x){return-1!=J.indexOf(x)};this.addApp=function(x){return-1==J.indexOf(x)?(J.push(x),!0):!1};this.isNew=function(){return 3E4>
Date.now()-z};this.getAll=function(){return q};this.hasWin=function(x){return 0<=q.indexOf(x)};this.close=function(){for(var x=0,A=q.length;x<A;x++)q[x].close()};this.clear=function(){q.length=0};this.delWin=function(x){for(var A=0,v=q.length;A<v;A++)if(q[A].id==x)return q.splice(A,1),A;return-1};this.isRunning=function(){var x=q.length;if(1>x)return!1;var A=0;for(x=q.length;A<x;A++){var v=q[A];if(v.showState)return!0}return!1};this.getWinById=function(x){var A=q.length;if(1>A)return null;for(var v=
0;v<A;v++){var u=q[v];if(u.id==x)return u}return null};this.getMainWinByAppId=function(x){var A=null,v=0;for(len=q.length;v<len;){A=q[v];if(A.appId==x&&A.isVisible()&&1>A.ownerWinid)break;v++}return A};this.getTopWin=function(x){var A=null,v,u=x.length;for(v=0;v<u&&(!(A=G.getWinById(x[v]))||!A.isVisible());v++)A=null;if(!A)for(svGlobal.logger.warn("No win found"),u=q.length,v=u-1;0<=v&&(A=q[v],!A.isVisible());v--)A=null;return A};this.getMain=function(x){return(x=G.getTopWin(x))?d(x):null};this.getMainByWinId=
function(x){return(x=G.getWinById(x))?d(x):null};this.getOtherApps=function(x,A,v){var u=q.length;if(0!=u&&q[u-1])if(u=q[u-1].appId,v||!u)setTimeout(function(){G.getOtherApps(x,A)},v||3E3);else{v=[];if(u=G.getTopWin(x)){var Y=0<u.ownerWinid?u.ownerWinid:u.id,w=[],Z=0;for(u=q.length;Z<u;Z++)q[Z].ownerWinid!=Y&&q[Z].id!=Y&&q[Z].isVisible()&&w.push(q[Z]);Z=0;for(u=w.length;Z<u;Z++)w[Z].ownerWinid!=Y&&w[Z].id!=Y&&(v.push({title:g(w[Z]),win:d(w[Z])}),Y=0<w[Z].ownerWinid?w[Z].ownerWinid:w[Z].id)}A(v)}};
this.getFullTitle=function(x){for(var A,v="";;){A=G.getWinById(x);if(!A)break;A.titleInfo&&A.isVisible()&&(v&&(v=" > "+v),v=A.titleInfo+v);if(1>x)break;x=A.ownerWinid}return v}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,g=0;g<d;g++)e[g].railWin&&e[g].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,g=Array(d),q=0;q<d;q++)e[q].configMonitor(),g[q]=e[q].getMousePosition();g.sort(function(G,H){var x=G.left-H.left;return 0!=x?x:G.top-H.top});
var J=g.findIndex(function(G){return 0==G.left&&0==G.top});svGlobal.logger.info("monitor layout",g,J);-1==J&&(n.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",g));for(q=J-1;0<=q;){if(g[q].right<g[q+1].left){var z=g[q+1].left-g[q].right-1;0<z&&(g[q].right+=z,g[q].left+=z)}g[q].bottom<g[q+1].top&&(z=g[q+1].top-g[q].bottom-1,0<z&&(g[q].top+=z,g[q].bottom+=z));q--}for(q=J+1;q<d;)g[q-1].right<g[q].left&&
(z=g[q].left-g[q-1].right-1,0<z&&(g[q].right-=z,g[q].left-=z)),g[q-1].bottom<g[q].top&&(z=g[q].top-g[q-1].bottom-1,0<z&&(g[q].top-=z,g[q].bottom-=z)),q++};this.repaint=function(d,g,q,J){for(var z=0,G=e.length;z<G;z++)e[z].repaint(d,g,q,J)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var g=e.length,q=0;q<g;q++)if(e[q].equals(d))return!0;return!1};this.getMonitorSurface=function(d,g,q,J){var z=
e.length;if(1==z)return e[0];for(var G=0;G<z;G++)if(e[G].isMonitor(d,g,q,J))return e[G];return null};this.fromSyncedSurface=function(d){var g=e.length;Date.now();for(var q=0;q<g;q++)if(e[q].isClipSynced(d))return!0;return!1};this.setSize=function(d,g,q){for(var J=0,z=e.length;J<z;J++)e[J].setSize(d,g,q)};this.zOrders=[];this.drawLicense=function(d){for(var g=0,q=e.length;g<q;g++)e[g].drawLicense(d)};this.setReadOnly=function(d,g){for(var q=0,J=e.length;q<J;q++)e[q].setReadOnly(d,g)};this.setVisible=
function(d,g){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var g=0,q=e.length;g<q;g++)e[g]&&e[g].setCursor(d)};this.hide=function(d){d=0;for(var g=e.length;d<g;d++)e[d]&&e[d].hide()};this.execute=function(d,g){for(var q=0,J=e.length;q<J;q++)e[q][d].apply(e[q],g)};this.addWin=function(d){var g=this.getFocused();g||(svGlobal.logger.warn("Focused surface not found!"),g=e[e.length-1]);g?(Va=!0,g.railWin||(g.railWin=new c,g.onunload=function(){hi5.appcfg.closeRemoteApp&&g.railWin&&
g.railWin.close();g.remoteApp&&g.remoteApp.close();g.railWin&&(g.railWin.clear(),g.railWin=null);e.removeElm(g)}),g.context&&b.setContext(g.context),g.railWin.addWin(d),g.railWin.mainWin==d&&(setTimeout(function(){var q=g.getFreeSpace();a.writeRawInput("8C661441\t"+q.width+"\t"+q.height);svGlobal.logger.info("-- main win dp change:"+q.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);
svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&g.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var g,q=e.length-1;0<=q;q--){var J=e[q];g=J.railWin;var z=g.getWinById(d),G=z&&z.appId&&-1!=z.appId.toLowerCase().indexOf("runonce");if(0<=g.delWin(d)){z==g.mainWin&&(g.mainWin=null);if(J.toolbar){d="win"+d;var H=J.toolbar.querySelector("#"+d);H&&J.toolbar.removeChild(H)}if(!g.isRunning()&&0==n.mode){if(z.isMainWin()&&
J.onremoteappclose)J.onremoteappclose(z);z=a.appTimeout;if(G||g.isNew())z*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(x){return function(){svGlobal.logger.info("Start del:"+Date.now());x.railWin&&x.railWin.isRunning()||(x.remoteApp&&x.remoteApp.close(),ja&&ja.delSurface(x))}}(J),z)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var g,q=0,J=e.length;q<J;q++)if(e[q]&&e[q].railWin&&(g=e[q].railWin.getWinById(d)))return g;
return null};this.getMainWinByAppId=function(d){for(var g,q=0,J=e.length;q<J;q++)if(e[q].railWin&&(g=e[q].railWin.getMainWinByAppId(d)))return g;return null};this.onWinChange=function(d){for(var g,q=0,J=e.length;q<J;q++)if(e[q].railWin&&(g=e[q].railWin.getWinById(d.id)))e[q].railWin.onchange(d)};this.setTitle=function(d){for(var g,q=0,J=e.length;q<J;q++)if(e[q].railWin){g=e[q].railWin.getWinById(d);var z=e[q].railWin.getFullTitle(d);if(z){a.changeTitle(z,e[q].getWindow(),g.appId);break}}};this.hasApp=
function(d){for(var g=0,q=e.length;g<q;g++)if(e[g].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var g=0,q=e.length;g<q;g++)if(e[g].railWin&&e[g].railWin.hasWin(d))return e[g];return null};this.getOwnerSurfaceById=function(d){for(var g,q=0,J=e.length;q<J;q++)if(e[q].railWin&&(g=e[q].railWin.getWinById(d)))return e[q];
return null};this.getFocused=function(){for(var d=e.length,g=0;g<d;g++)if(e[g].focused)return e[g];return e[d-1]};this.close=function(){for(var d=0,g=e.length;d<g;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function g(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var q=this;this.resizable=function(){return q.isVisible?0!=(q.style&262144)||0!=(q.style&65536)||0!=(q.style&16777216)||3==q.showState:!1};this.setShowState=function(J){q.showState=
J};this.parent=function(){return ja.getWinById(q.ownerWinid)};this.resize=function(J,z,G,H){svGlobal.logger.info("www resize, l "+J+" w "+G);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+q.id+"\t"+J+"\t"+z+"\t"+G+"\t"+H)};this.exeCommand=function(J){svGlobal.logger.info("www exeCommand, cmd "+J);a.writeRawInput("8C4"+d+"\t"+J)};this.activate=function(J){svGlobal.logger.info("www activate, enable "+J+" id:"+d);2==q.showState?(q.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+
d+"\t"+J)},50)):a.writeRawInput("8C3"+d+"\t"+J)};this.close=function(){svGlobal.logger.info("www close");q.exeCommand(61536)};this.getAppId=g;this.isVisible=function(){return q.winWidth&&q.winHeight&&q.showState&&45<q.winHeight&&45<q.winWidth};this.isMainWin=function(){if(!(q.isVisible()&&q.winWidth&&q.winHeight&&45<q.winHeight&&45<q.winWidth))return!1;var J=1>q.ownerWinid;if(!J)return J;var z=q.style;if(0!=(z&4194304))return!0;if(0!=(z&2147483648)&&(0==(z&8388608)||0==(z&12582912)))return!1;var G=
0!=(q.extStyle&128);(J=J&&!G)&&0!=(z&2147483648)&&0==(z&2156396544)&&(J=!1);return J};g()}}(n,sa);this.getSurfaces=function(){return ja};this.hide=function(){ja&&ja.hide()};this.getFileUrl=function(a,b,c){var e=ya(),d=$c,g=d.indexOf("://");e=(0<g&&11>g?d:e+d)+"s="+oc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return n.modifyURL(e)};this.listFiles=function(a,b){Oa&&Xa&&Oa.list(a,b)};this.writeRawInput=function(a){if(Xa){xa(a);if(n.onactivity)n.onactivity(a);return!0}return!1};
this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);xa(e.buffer)};var bd=0;if(la.numLock||la.numlock||R(L.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)bd|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=
!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&
Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var g=d.getFreeSpace(),q=g.width;g=g.height;Ra.checkLockFlags=!0;la.scale?d.scaleTo(q,g,!1):a.resetSize(q,g)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,g){this.reqCopyTime=Date.now();var q=a.getGatewayAddr(),J=ad,z=J.indexOf("://");q=(0<z&&11>z?J:q+J)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(q),g);this.reqCopyTime=
Date.now();Uc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,g,q){a.reconnectOnResize=!1;var J=a.getFileUrl(d,g,q);n.ondownload&&n.ondownload({fileName:d,url:J,source:g,action:q})||window.open(J)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return r};this.reconnect=function(d,g,q){L.symlink?(d="user="+d+"&pwd="+g,q&&(d+="&domain="+q),r=hi5.tool.replaceQuery(r,"parameters",d)):(r=hi5.tool.replaceQuery(r,"user",d),r=hi5.tool.replaceQuery(r,"pwd",g),r=hi5.tool.replaceQuery(r,
"domain",q));a.run()};this.sendKeyboardSyncFlags=function(d,g){return Xa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},g||333),!0):!1};this.sendKeyboardSynchronize=function(d,g,q){var J=0;q&&(J|=4);g&&(J|=2);d&&(J|=1);this.sendKeyboardSyncFlags(J)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);
a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,g){a.authWithCode(d,g)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(n,bd),Xd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,g){return a.repaint(c,e,d-c+1,g-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+
c.id))}}(sa,ja);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new qb(143)};this.GatewayChannel=function(){return new qb(28)};this.DynamicChannel=function(){return new qb(64)};this.addChannel=function(a){mb[a.name]=a};this.addGatewayChannel=function(a){kb[a.name]=a};this.addDynamicChannel=function(a){Ia.names.push(a.name);Ia[a.name]=a;Ia.count++};var Sa=null,Ia={count:0,names:[],usbChannel:null,close:function(){for(var a=Ia.names,
b=0,c=a.length;b<c;b++){var e=Ia[a[b]];if(e&&e.onclose)e.onclose()}a.length=0;Ia.usbChannel=null},init:function(a,b,c,e,d,g){function q(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var v=this;this.fromBuffer=function(u,Y){v.formatTag=
u.getLittleEndian16();v.nChannels=u.getLittleEndian16();v.nSamplesPerSec=u.getLittleEndian32();v.nAvgBytesPerSec=u.getLittleEndian32();v.nBlockAlign=u.getLittleEndian16();v.bitsPerSample=u.getLittleEndian16();var w=u.getLittleEndian16();v.cbSize=w;0<w&&!0!==Y&&(v.extenstion=Array(w),u.copyToByteArray(v.extenstion,0,u.getPosition(),w),u.skipPosition(w))};this.toBuffer=function(u){u.setLittleEndian16(v.formatTag);u.setLittleEndian16(v.nChannels);u.setLittleEndian32(v.nSamplesPerSec);u.setLittleEndian32(v.nAvgBytesPerSec);
u.setLittleEndian16(v.nBlockAlign);u.setLittleEndian16(v.bitsPerSample);u.setLittleEndian16(v.cbSize);0<v.cbSize&&u.setBytes(v.extenstion)};this.getSize=function(){return 18+v.cbSize};this.toString=function(){return"Audio Format, tag="+v.formatTag+" nChannels="+v.nChannels+" nSamplesPerSec="+v.nSamplesPerSec+" nAvgBytesPerSec="+v.nAvgBytesPerSec+" nBlockAlign="+v.nBlockAlign+" bitsPerSample="+v.bitsPerSample+" cbSize="+v.cbSize}}function J(){Sa=new n.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";
Sa.enabled=!1;Sa.process=function(v){var u=v.getLittleEndian32();v.getLittleEndian32();switch(u){case 5:u=v.getLittleEndian32(),Sa.maxMonitorAreaFactorA=v.getLittleEndian32(),Sa.maxMonitorAreaFactorB=v.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+u+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),v=new Uint8Array(2),v[0]=146,v[1]=4,xa(v.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(v,u){if(Sa.enabled){var Y=
new Uint8Array(56),w=new RdpBuffer(Y,0,56);v=v>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:v&-4;u=u>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:u&-4;w.setLittleEndian32(2);w.setLittleEndian32(56);w.setLittleEndian32(40);w.setLittleEndian32(1);w.setLittleEndian32(1);w.setLittleEndian32(0);w.setLittleEndian32(0);w.setLittleEndian32(v);w.setLittleEndian32(u);w.setLittleEndian32(.26458*v|0);w.setLittleEndian32(.26458*u|0);w.setLittleEndian32(v>u?0:90);w.setLittleEndian32(100);w.setLittleEndian32(100);
Sa.send(Y);svGlobal.logger.warn("Display control: "+v+"x"+u)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!la.disableDVC){if(la.enableEcho){var z=new n.DynamicChannel;z.name="ECHO";z.process=function(v){var u=v.getPosition(),Y=v.getEnd(),w=new Uint8Array(Y-u);w.set(v.getData().subarray(u,Y));z.send(w)};n.addDynamicChannel(z)}if(a){var G=new n.DynamicChannel;G.name="Microsoft::Windows::RDS::Input";G.process=function(v){var u=v.getLittleEndian16();v.getLittleEndian32();switch(u){case 1:v.skipPosition(4),
v=new RdpBuffer(new Uint8Array(16),0,16),v.setLittleEndian16(2),v.setLittleEndian32(16),v.setLittleEndian32(3),v.setLittleEndian32(65536),v.setLittleEndian16(256),v.markEnd(),G.send(v);case 5:ja.execute("setTouchRemoting",[!0]);Ia.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ja.execute("setTouchRemoting",[!1]),Ia.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(G)}if(c){svGlobal.logger.warn("Audio input on");var H=new n.DynamicChannel;
(function(){function v(U){var E=new RdpBuffer(new Uint8Array(5),0,5);E.setByte(7);E.setLittleEndian32(U);E.markEnd();H.send(E)}function u(U){var E=U.getLittleEndian32(),ea=U.getLittleEndian32(),ha=new q;ha.fromBuffer(U,!0);var S=0,ka=0;0<ha.cbSize&&(22==ha.cbSize?(S=U.getLittleEndian16(),ka=U.getLittleEndian32(),U.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+ha.cbSize),U.skipPosition(ha.cbSize)));U=w[ea];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+E+" initial: "+ea+", "+
U.toString());svGlobal.logger.info("Open fmt: "+ha.toString()+" validBits:"+S+" mask:"+ka);M=!0;O=n.reconnectOnResize;n.reconnectOnResize=!1;ba.onopen||(ba.onopen=function(aa){if(Ja){Y=aa;n.reconnectOnResize=O;v(ea);var ia=new RdpBuffer(new Uint8Array(5),0,5);ia.setByte(4);ia.setLittleEndian32(aa?0:1);ia.markEnd();H.send(ia)}});ba.ondata||(ba.ondata=function(aa,ia){Y&&(P.length!=ia+1&&(P=new Uint8Array(ia+1),P[0]=6),H.send(Z),P.set(aa,1),H.send(P))});ba.start(U,E)}H.name="AUDIO_INPUT";H.process=function(U){var E=
U.getByte();switch(E){case 1:U=U.getLittleEndian32();E=new RdpBuffer(new Uint8Array(5),0,5);E.setByte(1);E.setLittleEndian32(U);E.markEnd();H.send(E);break;case 2:var ea=U.getLittleEndian32();U.getLittleEndian32();var ha=hi5.audio.getAudioContext().sampleRate;for(E=w.length=0;E<ea;E++){var S=new q;S.fromBuffer(U);svGlobal.logger.info("Server rec fmt "+E+":"+S.toString());0==e&&49==S.formatTag&&22050==S.nSamplesPerSec?w.push(S):1==S.formatTag&&S.nSamplesPerSec<=ha&&w.push(S)}H.send(Z);ea=0;U=w.length;
for(E=0;E<U;E++)ea+=w[E].getSize();ha=new RdpBuffer(new Uint8Array(1024),0,1024);ha.setByte(2);ha.setLittleEndian32(U);ha.setLittleEndian32(ea+9);for(E=0;E<U;E++)w[E].toBuffer(ha),svGlobal.logger.info("Client rec fmt: "+w[E].toString());ha.skipPosition(1024-ea-9);ha.markEnd();H.send(ha);break;case 3:u(U);break;case 7:E=U.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+w[E].toString()+" by client:"+M);M||(v(E),M=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+E)}};var Y=
!1,w=[];H.onclose=function(){Y=!1;ba&&ba.close()};var Z=new Uint8Array(1);Z[0]=5;var M=!1,O=n.reconnectOnResize,P=new Uint8Array(0),oa=ta("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),ba=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),oa):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();n.addDynamicChannel(H)}n.addDynamicChannel(function(){var v=new n.DynamicChannel;v.name="TSMF";var u={type:"image/jpeg"},Y=Array(1);v.process=
function(w){w.getPosition();var Z=w.getLittleEndian32()&1073741823;var M=w.getLittleEndian32();var O=w.getLittleEndian32();switch(Z){case 2:if(256==O){w.getLittleEndian32();O=new Uint8Array(16);var P=new RdpBuffer(O,0,16);P.setLittleEndian32(2);P.setLittleEndian32(M);P.setLittleEndian32(1);P.setLittleEndian32(0);v.send(O)}break;case 0:switch(O){case 257:w.getBytes(16);w.getLittleEndian32();break;case 256:Z=w.getPosition();P=w.getLittleEndian32();for(O=0;O<P;O++){w.getLittleEndian32();var oa=w.getLittleEndian32();
w.getLittleEndian32();w.skipPosition(oa-4)}O=w.getPosition()-Z;P=O+8+4;O=new Uint8Array(P);P=new RdpBuffer(O,0,P);P.setLittleEndian32(-2147483648);P.setLittleEndian32(M);O.set(w.getData().subarray(Z,w.getPosition()),8);v.send(O);break;case 261:w.getBytes(16);w.getLittleEndian32();break;case 264:Z=w.getLittleEndian32();w.skipPosition(4);w.getLittleEndian32();oa=w.getBytes(16);var ba=w.getBytes(16);w.getLittleEndian32();w.getLittleEndian32();w.getLittleEndian32();var U=w.getBytes(16);O=w.getLittleEndian32();
w.skipPosition(O);O=new Uint8Array(20);P=new RdpBuffer(O,0,20);P.setLittleEndian32(-2147483648);P.setLittleEndian32(M);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],oa)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],ba)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],U)?P.setLittleEndian32(1):(P.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(oa),svGlobal.logger.warn(ba),svGlobal.logger.warn(U));
P.setLittleEndian32(Z);v.send(O);break;case 258:w.getBytes(16);w.getLittleEndian32();Z=w.getLittleEndian32();w.skipPosition(Z);break;case 263:w.getBytes(16),O=new Uint8Array(16),P=new RdpBuffer(O,0,16),P.setLittleEndian32(-2147483648),P.setLittleEndian32(M),P.setLittleEndian32(1),v.send(O);case 277:w.getBytes(16);w.getLittleEndian32();break;case 262:w.getBytes(16);sa.flushImgs();sa.setImgRect(0,0,0,0);O=new Uint8Array(12);P=new RdpBuffer(O,0,12);P.setLittleEndian32(-2147483648);P.setLittleEndian32(M);
v.send(O);break;case 278:w.getBytes(16);M=w.getLittleEndian32();O=w.getLittleEndian32();Z=w.getLittleEndian32();w=w.getLittleEndian32();sa.setImgRect(M,O,Z-M,w-O);break;case 265:w.getBytes(16);w.getLittleEndian64();w.getLittleEndian32();break;case 266:w.getBytes(16);break;case 268:w.getBytes(16);break;case 267:w.getBytes(16);break;case 269:w.getBytes(16);w.getLittleEndian32();break;case 274:break;case 275:break;case 259:w.getBytes(16);w.getLittleEndian32();w.getLittleEndian32();w.skipPosition(32);
O=w.getLittleEndian32();M=new Image;Z=w.getPosition();Y[0]=w.getData().subarray(Z,Z+O);w=new Blob(Y,u);M.src=URL.createObjectURL(w);sa.addImg(M);break;case 270:sa.flushImgs();break;case 273:break;case 260:break;case 276:w.getBytes(16);O=w.getLittleEndian32();Z=w.getPosition()+O;w.skipPosition(8);M=w.getLittleEndian32();svGlobal.logger.info("window state:"+M);P=w.getLittleEndian32();oa=w.getLittleEndian32();M=w.getLittleEndian32();O=w.getLittleEndian32();w.skipPosition(8);ba=w.getLittleEndian32();
U=w.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+M+" top:"+O+" w:"+P+" h:"+oa+" cl:"+ba+" ct:"+U);w.setPosition(Z);Z=w.getLittleEndian32();for(Z=w.getPosition()+Z;w.getPosition()<Z;){ba=w.getLittleEndian32();U=w.getLittleEndian32();var E=w.getLittleEndian32(),ea=w.getLittleEndian32();svGlobal.logger.info("visible region, l:"+U+" t:"+ba+" r:"+ea+" b:"+E)}sa.setImgRect(M,O,P,oa);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+O)}break;default:svGlobal.logger.warn("unkown interface:"+
Z)}};return v}());lb||n.addDynamicChannel(J());la.enableDVCAudio&&n.addDynamicChannel(function(v){var u=!1,Y=0,w=0,Z=0,M=0,O=[],P=new Uint8Array(4),oa=new n.DynamicChannel;oa.name="AUDIO_PLAYBACK_DVC";oa.onclose=function(){};oa.process=function(ba){function U(X){X.skipPosition(14);var W=X.getLittleEndian16();X.getByte();var Q=X.getLittleEndian16();X.skipPosition(1);for(var ra,va=O.length=0;va<W;va++){var h=new q;h.fromBuffer(X);(ra=22050<=h.nSamplesPerSec&&(1==h.formatTag||49==h.formatTag&&22050==
h.nSamplesPerSec&&0==v||41222==h.formatTag))&&O.push(h)}h=20;X=O.length;for(va=0;va<X;va++)h+=O[va].getSize();va=h+4;W=new RdpBuffer(new Uint8Array(va),0,va);W.setByte(7);W.setByte(2);W.setLittleEndian16(h);W.setLittleEndian32(3);W.setLittleEndian32(4294967295);W.setLittleEndian32(0);W.setLittleEndian16(0);W.setLittleEndian16(X);W.skipPosition(1);W.setLittleEndian16(Q);W.setByte(124);for(va=0;va<X;va++)h=O[va],h.toBuffer(W);W.markEnd();oa.send(W);5<Q&&(W=new RdpBuffer(new Uint8Array(8),0,8),W.setByte(12),
W.skipPosition(1),W.setLittleEndian16(4),W.setLittleEndian16(0),W.setLittleEndian16(0),W.markEnd(),oa.send(W))}function E(X){var W=X.getLittleEndian16();X=X.getLittleEndian16();var Q=new RdpBuffer(new Uint8Array(8),0,8);Q.setByte(6);Q.setByte(35);Q.setLittleEndian16(4);Q.setLittleEndian16(W);Q.setLittleEndian16(X);Q.markEnd();oa.send(Q)}function ea(){var X=O[Z];if(X.formatTag!=Ga.tag||X.nSamplesPerSec!=Ga.samplePerSec||Ga.channels!=X.nChannels)Ga.tag=X.formatTag,Ga.channels=X.nChannels,Ga.samplePerSec=
X.nSamplesPerSec,Ga.bitsPerSample=49==X.formatTag?8:X.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ga.tag+" channels="+Ga.channels+" bitsPerSample="+Ga.bitsPerSample+" samplePerSec="+Ga.samplePerSec),41222==Ga.tag&&(Ga.sampleRate=Ga.samplePerSec,Ta.initMediaPlayer(Ta,Ga,!0))}function ha(X){w=X.getLittleEndian16();Z=X.getLittleEndian16();M=X.getByte();X.skipPosition(3);P.set(X.getSubarray(4));u=!0;ea()}function S(X,W){var Q=new RdpBuffer(new Uint8Array(8),0,8);Q.setByte(5);Q.skipPosition(1);
Q.setLittleEndian16(4);Q.setLittleEndian16(X);Q.setByte(W);Q.skipPosition(1);Q.markEnd();oa.send(Q)}function ka(X){u=!1;var W=Y-8,Q=Date.now();X.copyFromByteArray(P,0,X.getPosition(),4);nc(X,M,w,W);X=w+(Date.now()-Q);S(X,M)}function aa(X){var W=Date.now();w=X.getLittleEndian16();Z=X.getLittleEndian16();M=X.getByte();X.skipPosition(7);ea();X=nc(X,M,w,0);X*=1E3;W=w+(Date.now()-W)+X;S(W,M)}if(u)ka(ba);else{var ia=ba.getByte();ba.skipPosition(1);Y=ba.getLittleEndian16();switch(ia){case 7:U(ba);break;
case 6:E(ba);break;case 2:ha(ba);break;case 3:ba.getLittleEndian16();ba.getLittleEndian16();break;case 13:aa(ba)}}};return oa}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var x=svGlobal.DCVC_EXTENSION;x.WEBAUTHN=function(v){function u(){if(Z){var M=Error("Cancelling existing WebAuthn API call for new one");M.name="WebAuthnAbortError";Z.abort(M)}Z=new AbortController;return Z.signal}function Y(){if(Z){var M=Error("Manually cancelling existing WebAuthn API call");M.name="WebAuthnAbortError";
Z.abort(M);Z=void 0}}var w=new v;w.name="WebAuthN_Channel";w.newInstance=function(){return x.WEBAUTHN(v)};w.onopen=function(){svGlobal.logger.info("webAuthn open")};w.onclose=function(){svGlobal.logger.info("webAuthn close")};var Z=null;w.process=function(M){var O=M.getEnd()-M.getPosition();M=M.getBytes(O);var P=Ib(M),oa=P.command;O=P.flags;M=P.timeout;var ba=P.webAuthNPara;if(oa)switch(console.log("==== command: "+P.command),oa){case 5:if(P.request)switch(oa=P.request[0],console.log("==== webAuth cmdType = "+
oa),console.log("==== webAuth request bytes: "+Gd(P.request.slice(1,P.request.length))),oa){case 1:P=P.request.slice(1,P.request.length);var U=Ib(P);P=U[1];var E=U[2],ea=U[3],ha=U[4],S=U[5];oa=U[6];var ka=U[7];U={};var aa=Cd(ba);aa&&(aa.attestation&&(U.attestation=aa.attestation),aa.attestationFormats&&(U.attestationFormats=aa.attestationFormats));if(O=Bd(O,ba,ka))U.authenticatorSelection=O;U.challenge=P;S&&(U.excludeCredentials=Gc(S));U.rpId=E.id;U.rp=E;U.extensions=oa?oa:{};U.extensions.remoteDesktopClientOverride=
{origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};ha&&(U.pubKeyCredParams=ha);M&&(U.timeout=M);U.user=ea;M={};M.signal=u();M.publicKey=U;navigator.credentials.create(M).then(function(ia){Dd(ia.response,E).then(function(X){var W={},Q={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},ra=new Uint8Array([159,87,192,47,19,129,
234,71,177,22,187,90,141,185,32,42]);Q.aaGuid=ra.buffer;Q.residentKey=!0;W.deviceInfo=Q;W.status=0;W.response=X;X=CBOR.encode(W);W=new hi5.DataBuffer(new Uint8Array(4+X.byteLength));W.setLittleEndian32(0);W.setBytes(X);W.markEnd();w.send(W)})}).catch(function(ia){console.log("WebAuthN MakeCredential failed with error code ["+ia.code+"], msg: "+ia.message);ia=new hi5.DataBuffer(new Uint8Array(4));ia.setLittleEndian32(1);ia.markEnd();w.send(ia)});break;case 2:P=P.request.slice(1,P.request.length);U=
Ib(P);P=U[2];ea=U[3];oa=U[4];ka=U[5];U={};ea&&(U.allowCredentials=Gc(ea));U.challenge=P;oa&&(U.extensions=oa);U.rp=window.location.hostname;M&&(U.timeout=M);if(M=Fc(O,ba,ka))U.userVerification=M;M={};M.signal=u();M.publicKey=U;navigator.credentials.get(M).then(function(ia){ia=new hi5.DataBuffer(new Uint8Array(void 0));ia.markEnd();w.send(ia)}).catch(function(ia){console.log("WebAuthN GetAssertion failed with error code ["+ia.code+"], msg: "+ia.message);ia=new hi5.DataBuffer(new Uint8Array(4));ia.setLittleEndian32(1);
ia.markEnd();w.send(ia)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+oa)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:M=new hi5.DataBuffer(new Uint8Array(8));M.setLittleEndian32(0);O=Ec()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;O?M.setLittleEndian32(1):M.setLittleEndian32(0);M.markEnd();w.send(M);break;case 7:Y();M=new hi5.DataBuffer(new Uint8Array(4));M.setLittleEndian32(0);M.markEnd();w.send(M);
break;case 8:M=new hi5.DataBuffer(new Uint8Array(8));M.setLittleEndian32(0);M.setLittleEndian32(4);M.markEnd();w.send(M);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+oa)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return w};n.enableWebAuthn()&&Ec()&&(a=x.WEBAUTHN(n.DynamicChannel),n.addDynamicChannel(a));d&&(d=x.WEBCAM(n.DynamicChannel),a=x.WEBCAM_ENUM(n.DynamicChannel,d),n.addDynamicChannel(a),n.addDynamicChannel(d));g&&(svGlobal.logger.info("Mapping USB..."),
n.addDynamicChannel(Ia.usbChannel));if(b&&x.GFX){var A=function(){ab.drawable.resumePlay||(ab.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();ab.resumeVideo()})};ab=x.GFX(n.DynamicChannel,R(L.remotefx)&&!R(L.gfx),0==n.mode,sa,L.hardwareAcceleration,R(L.yuv444)&&hi5.browser.supportsI444);ab.onmessage=function(v){n.showMessage(v)};A();ab.onuserinteract=function(v){ja.execute("showPlay");A();svGlobal.logger.info("resumePlay");return!0};ab.onfatalerror=function(v,u){n.reconnect(v.width,
v.height,!0)};ab.onsps=function(v){v.fps&&n.setFPS(v.fps)};ab.onresetgraphic=function(v){n.setResolution(v.width,v.height)};ab.onmapsurface=function(v){ab.onconfirm();var u=ja.getMonitorSurface(v.outputOriginX,v.outputOriginY,v.targetWidth+v.outputOriginX-1,v.targetHeight+v.outputOriginY-1);u?(u.setId(v.id),u.setSize(v.targetWidth,v.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+v.outputOriginX+" y:"+v.outputOriginY)};ab.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");
ja.execute("setDrawable",[ab.drawable])};n.addDynamicChannel(ab)}x.VOR&&(b=x.VOR(n.DynamicChannel),n.addDynamicChannel(b[0]),n.addDynamicChannel(b[1]),n.addDynamicChannel(x.GT(n.DynamicChannel)))}}},eb=null;svGlobal.DCVC_EXTENSION&&!lb&&(n.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ia.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(n.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(eb=svGlobal.DCVC_EXTENSION.DRIVE(n.GatewayChannel),n.addGatewayChannel(eb)));this.getPrinters=function(a){if(!n.onagentmessage||
!eb)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();n.onagentmessage(b.getData());eb.listCallback=a};this.attachPrinter=function(a){eb&&eb.attachPrinter(a,n)};this.showError=Hb;this.resetStatus=ec;this.exeAppCmd=function(a){var b=ja.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ja.getWinById(a):ja.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,
c){void 0==c&&(c=la.forceReconnect||!1);if(!Ja&&!c)return!1;L.minWidth&&a<L.minWidth&&(a<L.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+L.minWidth),a=L.minWidth);L.minHeight&&b<L.minHeight&&(b<L.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+L.minHeight),b=L.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ka)&&4>Math.abs(b-La))return!1;if(Sa&&Sa.enabled&&!1!==la.displayVC)Sa.applyResolution(a,b);else if(qc&&rb||c||Xa&&!qc)rb=!1,svGlobal.logger.info("reconnecting..."),
xa("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));xa(a)};this.getUploadManager=function(){return Oa};this.setFPS=function(a){ja.execute("setFPS",[a])};this.addSurface=function(a){if(!ja.hasSurface(a)&&(Nb||sa.setContext(a.context),!ja.hasSurface(a)||!a.railWin)){lb&&a.setPlayerMode();L.mouseMoveEmu&&(a.mouseMoveEmu=R(L.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ka&&(Ka=b.width);0==La&&(La=
b.height);a.setConfig(la);ja.addSurface(a);Pa(Ka,La,!0,L.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Xd);a.setTouchpad(R(L.touchpad));var c=b=R(L.mapClipboard),e=b;void 0!=L.copyToLocal?c=R(L.copyToLocal):void 0!=la.copyToLocal&&(c=la.copyToLocal);void 0!=L.copyToRemote?e=R(L.copyToRemote):void 0!=la.copyToRemote&&(e=la.copyToRemote);a.setClipboard(b,c,e);Mb&&fc(a);L.invitation&&!R(L.control)&&(ja.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=L.ctrlToWin?R(L.ctrlToWin):
void 0!=la.ctrlToWin?la.ctrlToWin:!0;c=void 0!=L.cmdToCtrl?R(L.cmdToCtrl):void 0!=la.cmdToCtrl?la.cmdToCtrl:!0;a.run(parseInt(L.keyboard||1033,10),b,!!la.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ja.size();b<c;b++)ja.getSurface(b).railWin.getMain(ja.zOrders)&&a.push(ja.getSurface(b).railWin.getMain(ja.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";xa("8C2"+a+"\t"+b+"\t"+c);var e=ja.getSurface(ja.size()-1);e&&(e.remoteApp=new Dc(a,
b,c))};this.startExitingApp=function(a){a=ja.popWins(a);for(var b=a.length-1;0<=b;b--)ja.addWin(a[b])};var xb=new n.DynamicChannel;xb.name="PNPDR";xb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};xb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),
a.setLittleEndian32(1),xb.send(a)}};xb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};n.addDynamicChannel(xb);var hb=null;R(L.scanner)&&(hb=new n.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(n.onagentmessage)n.onagentmessage(b);
break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(n.onagentmessage)n.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(n.onagentmessage)n.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},
n.addDynamicChannel(hb));var bb=null;n.hasSmartCard()&&(bb=new n.GatewayChannel,bb.name="SCARDSTB",bb.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(n.onagentmessage)n.onagentmessage(a);R(L.passwordIsPin)&&n.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},bb.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=
new Uint8Array(2);c[0]=3;c[1]=7;if(n.onagentmessage)n.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;yb&&(b+=yb.length);fb&&(b+=fb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);yb?(b.setLittleEndian32(yb.length),b.setBytes(yb)):b.setLittleEndian32(0);fb?(b.setLittleEndian32(fb.length),b.setBytes(fb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(n.onagentmessage)n.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=
new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(n.onagentmessage)n.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(bb)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),n.onagentmessage)n.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+
a[0]+"].")}},bb.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addGatewayChannel(bb));r+="&connectType=7";(function(){var a=0,b=0,c=new n.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),g=e.getLittleEndian16(),q=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(q){case 1:case 4097:q=
new RdpBuffer(new Uint8Array(6),0,6);q.setByte(6);q.setByte(1);q.setLittleEndian16(g);q.setLittleEndian16(0);q.markEnd();c.send(q);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:g=e.getLittleEndian16();a+=g;break;case 43:case 1065:case 1577:43==q&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(g);d.setLittleEndian16(43==q?3:11);d.setLittleEndian32(e);
d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:g=e.getLittleEndian32();q=e.getLittleEndian32();e=e.getLittleEndian32();sc={baseRTT:g,bandwidth:q,averageRTT:e};if(n.onnetworkresult)n.onnetworkresult(sc);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};n.addGatewayChannel(c)})();this.getNetworkResult=function(){return sc};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:
navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var gc=new Map,hc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(bb){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;bb.send(a);break;case 8:gc.clear();
hc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},
b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var q=b.getLittleEndian32();q=b.getAscllString(q,!1);var J=b.getLittleEndian32();b.getAscllString(J,!1);J=b.getLittleEndian64();J=(new Date(1E3*J)).toDateString();d=Hd(a,d,q,g,J);e.appendChild(d)}e.innerHTML+=
"<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var z,G=document.querySelector('input[name="scard_name"]:checked');G&&(z=parseInt(G.value));yb=gc.get(z);sb=hc.get(z);z=document.getElementById("userPin").value;fb=(new TextEncoder("utf-8")).encode(z);z=
2;z=fb?z+4+fb.length:z+4;z=sb?z+4+sb.length:z+4;z=new Uint8Array(z);z=new hi5.DataBuffer(z);z.setByte(1);z.setByte(2);fb?(z.setLittleEndian32(fb.length),z.setBytes(fb)):z.setLittleEndian32(0);sb?(z.setLittleEndian32(sb.length),z.setAsciiString(sb,sb.length)):z.setLittleEndian32(0);bb&&bb.send(z)};document.getElementById("userPin").addEventListener("keypress",function(z){"Enter"===z.key&&(z.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();
0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),bb.send(b));break;case 12:a[0]=1;a[1]=6;bb.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):
new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,n.onagentmessage)n.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Id(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.Lightbox(e,{btnYes:{}});b.onclose=function(){var z=0,G=document.querySelector('input[name="ds_name"]:checked');G&&(z=G.value);
G=new Uint8Array(3);G[0]=4;G[1]=5;G[2]=z;if(n.onagentmessage)n.onagentmessage(G)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));b.getLittleEndian16();n.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=n.getAgentLink(),hi5.notifications.notify({title:b,
html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)g=b.getLittleEndian32(),d=b.getUnicodeString(g),g=b.getLittleEndian32(),g=b.getUnicodeString(g),c.push({name:d,driver:g});eb&&eb.listCallback&&(eb.listCallback(c),eb.listCallback=null)}break;case 7:eb.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var yb,fb,sb,jc=
{type:6,data:null};this.setAgentStatus=function(a){Yc=a};this.getAgentStatus=function(){return Yc};this.run=function(){var a;if(a=null==n.onagentmessage)a=1==n.mode?!1:n.hasSmartCard()||n.hasScanner()||R(L.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(n):(n.hasUSB()?ja.getFocused().requestUsbDevices(n.getUSB(),function(b){Ia.usbChannel.openDevices(b);Jb()}):Jb(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return sa};this.mouseDown=function(a,b,c){Xa&&xa("80"+a+"\t"+
b+"\t"+c)};this.mouseMove=function(a,b){Xa&&xa("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Xa&&xa("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Xa&&xa("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Xa&&("number"==typeof a?(xa("840\t"+a),xa("8449152\t"+a)):xa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){n.reconnectOnResize&&(Va?(ob&&(clearTimeout(ob),ob=0),a&=-4,b&=-4,ob=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){n.writeRawInput("8C661441\t"+
a+"\t"+b);3==n.windowState&&Wc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):n.running()&&(ob&&(clearTimeout(ob),ob=0),ob=setTimeout(function(){document.hidden||n.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!n.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=ac,b[4]=ac>>8,b[5]=$b,b[6]=$b>>8,b[7]=bc,b[8]=bc>>8,b[9]=cc,b[10]=cc>>8);xa(b.buffer);return!0};this.refreshOutput=
function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);xa(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);xa(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||(Qa=new hi5.tool.ResponseMonitor(function(){Xa&&n.sendPing()},function(){if(Xa&&n.onnoresponse)return n.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;
xa(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ma?Ma.postMessage({type:0,cmd:6,start:1}):(Fa.onSlowPath=Fa.onFastPath=Nc,Fa.onReqHistory=function(){Nc(15555)})};this.stopPing=function(){Qa&&Qa.stop();Ma?Ma.postMessage({type:0,cmd:6,start:0}):Fa.onSlowPath=Fa.onFastPath=Fa.onReqHistory=null};var $a=null,Tc=0;this.play=function(){xa("F3")};this.pause=function(){xa("F2")};this.scan=function(a){xa("F4"+(a?"1":"0"))};this.seek=function(a){var b=ja.getFocused();b&&Ja&&(xa("F4"+(a?"1":"0")+
"\t"+(a/b.getScale().x|0)),sa&&sa.pause(!0,void 0))};var Ga={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Sc=!1;this.showMessage=function(a,b,c){n&&n.displayMsg&&
a&&((b=b||ja.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(){svGlobal.logger.info("closing...");Ja&&Va&&ja&&la.closeRemoteApp&&ja.tryCloseRemoteApps();sa&&sa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Vc,2222)):Vc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(n.close):window.addEventListener("unload",n.close,!1);Ob.searchStartCode=
function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};rc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Pb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Pb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||
(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d,g){function q(E,ea,ha,S){this.pixels=E;this.width=ea;this.height=ha;this.key=S}function J(){this.bottom=this.right=this.top=this.left=0;this.read=function(E){this.left=E.getLittleEndian16();this.top=E.getLittleEndian16();this.right=E.getLittleEndian16();this.bottom=E.getLittleEndian16()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function z(){this.qualityVal=
this.p=this.qb=0;this.read=function(E){var ea=E.getByte();this.qp=ea&63;this.p=ea>>7&1;this.qualityVal=E.getByte()}}function G(E,ea,ha){this.bitstream=E;this.regionRects=ea;this.isChroma=ha;this.timestamp=0}function H(E,ea,ha){this.width=E;this.height=ea;this.monitors=ha}function x(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(E){this.left=E.getLittleEndian32();this.top=E.getLittleEndian32();this.right=E.getLittleEndian32();this.bottom=E.getLittleEndian32();this.flags=
E.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function A(E,ea,ha,S,ka){function aa(){ra=!1;va.drawable=W._video;W._player=ia?new Vd(W,!1,S,ka):new Pb(va.drawable,W,!1);W._player.onsps=function(k){console.log("*** SPS: "+k.width+"x"+k.height+" smooth:"+X.imageSmoothingEnabled);ia&&(W._video.width=k.width,W._video.height=k.height);W.onsps&&W.onsps(k)};W._player.onerror=function(k){W.onfatalerror&&
W.onfatalerror(W,k)};W._player.onplayerror=function(k){function f(){va={drawable:W._video};W.player.play(!0)}va=null;if((!W.onuserinteract||!W.onuserinteract(f,"video"))&&W.onmessage)W.onmessage({msg:"Please click Yes to continue.<br>"+k,cbYes:function(){W.player.play(!0);this.destroy()}})};W._player.onframedecoded=function(k,f){if(!m)if(f)for(var p=f.length,t=0;t<p;t++){var B=f[t],C=B.right-B.left,y=B.bottom-B.top;X.drawImage(k,B.left,B.top,C,y,B.left,B.top,C,y)}else X.drawImage(k,0,0)}}this.id=
E;this.width=ea;this.height=ha;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=ea;this.targetHeight=ha;this._player=null;var ia="no-decoder"==S?!1:!!window.VideoDecoder;this._video=ia?new OffscreenCanvas(ea,ha):document.createElement("video");var X=ia?this._video.getContext("2d",{alpha:!1,desynchronized:!0,antialias:!1,powerPreference:"high-performance"}):null,W=this,Q=null,ra=!0,va={drawable:null},h=10,m=!1;ia&&(svGlobal.logger.info("...MediaDecoder in use: "+S),X.imageSmoothingEnabled=
!1);this.pause=function(k,f){m=k;f&&X&&X.fillRect(0,0,_screen.width,_screen.height)};this.resumeVideo=function(){W._player&&W._player.play(!0)};this.setDisplayBuffer=function(k){Q=k};this.draw=function(k,f,p,t){return ra?Q.draw(k,f,p,t):va};this.processAvc=function(k){ra&&aa();if(ia)k.timestamp=h,h+=10;else if(k.isChroma)return;W.onvideoframe(k)};this.reset=function(k,f){W&&W._player&&W._player.reset()};this.close=function(){W&&W._player&&(W._player.close(),W._player=null);W=null};this.setRGBs=function(k,
f,p,t,B,C,y){Q.setRGBs(k,f,p,t,B,C,y)};this.getRGBs=function(k,f,p,t){return Q.getRGBs(k,f,p,t)};this.moveArea=function(k,f,p,t,B,C){Q.moveArea(k,f,p,t,B,C)};this.fillRect=function(k,f,p,t,B){Q.fillRect(k,f,p,t,B)};this.postPaint=function(k,f,p,t){ra&&Q.postPaint(k,f,p,t)}}function v(E,ea,ha,S){var ka=new A(E,ea,ha,d,g);ka.pixelFormat=S||33;ka.setDisplayBuffer(e);U.push(ka);ba.oncreatesurface&&ba.oncreatesurface(ka);svGlobal.logger.info("create surface id:"+E+" w:"+ea+" h:"+ha+" pixelFmt:"+ka.pixelFormat);
return ka}function u(E,ea,ha){for(var S=E.getPosition(),ka=E.getLittleEndian32(),aa=Array(ka),ia=0;ia<ka;ia++){var X=new J;X.read(E);aa[ia]=X}X=Array(ka);for(ia=0;ia<ka;ia++){var W=new z;W.read(E);X[ia]=W}E=E.getBytes(ea-(E.getPosition()-S));return new G(E,aa,ha)}function Y(E,ea,ha,S){ha=E.getLittleEndian32();var ka=ha>>>30;ha&=1073741823;switch(ka){case 0:var aa=u(E,ha,!1);var ia=u(E,ea-ha-4,!0);break;case 1:aa=u(E,ha,!1);break;case 2:ea=E.getEnd()-E.getPosition();ia=u(E,ea,!0);break;default:console.error("Invalid LC: "+
ka)}aa&&S.processAvc(aa);ia&&S.processAvc(ia)}var w=new function(){function E(f,p,t,B,C){this.len=f;this.code=p;this.valueBits=t;this.type=B;this.vbase=C}function ea(f){var p=25E5-aa,t=f.length;if(p>=t)ka.set(f,aa),aa=p>t?aa+t:0;else if(25E5>=t)ka.set(f.subarray(0,p),aa),ka.set(f.subarray(p),0),aa=t-p;else{p=(t-p)%25E5;var B=t-p,C=f.subarray(B);f=f.subarray(t-25E5,B);ka.set(f,25E5-f.length);ka.set(C,0);aa=p}}function ha(f){for(;ra<f;)Q<<=8,va<m?Q+=h[va++]:console.log("--- end"),ra+=8;W-=f;ra-=f;f=
Q>>ra;Q&=(1<<ra)-1;return f}var S=[new E(1,0,8,0,0),new E(5,17,5,1,0),new E(5,18,7,1,32),new E(5,19,9,1,160),new E(5,20,10,1,672),new E(5,21,12,1,1696),new E(5,24,0,0,0),new E(5,25,0,0,1),new E(6,44,14,1,5792),new E(6,45,15,1,22176),new E(6,52,0,0,2),new E(6,53,0,0,3),new E(6,54,0,0,255),new E(7,92,18,1,54944),new E(7,93,20,1,317088),new E(7,110,0,0,4),new E(7,111,0,0,5),new E(7,112,0,0,6),new E(7,113,0,0,7),new E(7,114,0,0,8),new E(7,115,0,0,9),new E(7,116,0,0,10),new E(7,117,0,0,11),new E(7,118,
0,0,58),new E(7,119,0,0,59),new E(7,120,0,0,60),new E(7,121,0,0,61),new E(7,122,0,0,62),new E(7,123,0,0,63),new E(7,124,0,0,64),new E(7,125,0,0,128),new E(8,188,20,1,1365664),new E(8,189,21,1,2414240),new E(8,252,0,0,12),new E(8,253,0,0,56),new E(8,254,0,0,57),new E(8,255,0,0,102),new E(9,380,22,1,4511392),new E(9,381,23,1,8705696),new E(9,382,24,1,17094304)],ka=new Uint8Array(25E5),aa=0,ia=new Uint8Array(65536),X=0,W=0,Q=0,ra=0,va=0,h=null,m=0,k=!0;this.toPDU=function(f){if(k)return null;30==f&&
n.reconnect(n.widthRdp,n.heightRdp,!0);var p=new Uint8Array(2500008);p[0]=f;p[2]=1;p[3]=10;p[4]=aa;p[5]=aa>>8;p[6]=aa>>16;p[7]=aa>>24;p.set(ka,8);return p};this.fromStream=function(f){aa=f.getLittleEndian32();ka.set(f.getSubarray(25E5))};this.decompress=function(f,p){if(p){h=f;k&&(k=!1);m=h.length-1;W=8*m-h[m];for(X=va=ra=Q=0;0<W;)for(var t=p=0,B=0;B<S.length;B++){for(f=S[B];p<f.len;)t=(t<<1)+ha(1),p++;0>t&&console.log("xxx inPrefix");if(t==f.code){if(0==f.type)f=f.vbase+ha(f.valueBits),(0>f||255<
f)&&console.log("xxx do c"),f&=255,ka[aa]=f,25E5==++aa&&(aa=0),ia[X++]=f;else if(p=ha(f.valueBits),p=f.vbase+p,0>p&&console.log("xxx distance"),0!=p){if(0==ha(1))f=3;else{f=4;for(t=2;1==ha(1);)f*=2,t++;f+=ha(t)}p=25E5-p+aa;p%=25E5;t=p+f;if(Math.abs(aa-p)>=f&&25E5>t&&25E5>aa+f)p=ka.subarray(p,t),ka.set(p,aa),aa+=f,ia.set(p,X),X+=f;else for(;0<f;)t=ka[p],25E5==++p&&(p=0),ka[aa]=t,25E5==++aa&&(aa=0),ia[X++]=t,f--}else f=ha(15),W-=ra,Q=ra=0,p=h.subarray(va,va+f),ea(p),ia.set(p,X),va+=f,X+=f,W-=8*f;break}}65536<
X&&console.error("xx outputIndex:"+X);return ia.subarray(0,X)}ea(f);return f}},Z=new function(){this.process=function(E){var ea=E.getByte();if(224==ea){var ha=0!=(E.getByte()&32);var S=E.getPosition(),ka=E.getEnd();ea=w.decompress(E.getData().subarray(S,ka),ha);E.setPosition(ka)}else{225!=ea&&console.log("Invalid descriptor:"+ea);ka=E.getLittleEndian16();var aa=E.getLittleEndian32();ea=new Uint8Array(aa);for(var ia=0,X,W=0;W<ka;W++)X=E.getLittleEndian32(),ha=0!=(E.getByte()&32),X--,S=E.getPosition(),
ha=w.decompress(E.getData().subarray(S,S+X),ha),ea.set(ha,ia),ia+=ha.length,E.skipPosition(X);ia!=aa&&console.error("wrong size, actual:"+ia+" expected:"+aa)}return new RdpBuffer(ea,0,ea.length)}},M=null,O=new rdpcodecs.RemoteFX(!1),P=0,oa=[],ba=new a;ba.name="Microsoft::Windows::RDS::Graphics";var U=new function(E,ea){var ha=[];this.push=function(S){S.onsps=E.onsps;S.onfatalerror=E.onfatalerror;S.onplayerror=E.onplayerror;S.onuserinteract=E.onuserinteract;S.onmessage=E.onmessage;ha[S.id]=S};this.get=
function(S){return ha[S]};this.getAll=function(){return ha};this.delete=function(S){var ka=ha[S];ka&&(ka.onsps=null,ka.onfatalerror=null,ka.onplayerror=null,ha[S]=null)};this.reset=function(S){S=0;for(var ka=ha.length;S<ka;S++)ha[S]&&ha[S].reset()};this.close=function(){for(var S=0,ka=ha.length;S<ka;S++)ha[S]&&ha[S].close()};this.resumeVideo=function(){for(var S=0,ka=ha.length;S<ka;S++)ha[S]&&ha[S].resumeVideo()};ea.pause=function(S,ka){for(var aa=0,ia=ha.length;aa<ia;aa++)ha[aa]&&ha[aa].pause(S,
ka)}}(ba,e);ba.drawable=new function(){this.draw=function(E,ea,ha,S,ka){return(ka=U.get(ka))?ka.draw(E,ea,ha,S):null};this.getSurfaces=function(){return U};this.onfocus=function(E){};this.resumePlay=null};ba.resumeVideo=function(){U.resumeVideo()};ba.process=function(E){for(var ea=Z.process(E);ea.has(8);){var ha=ea.getLittleEndian16();ea.getLittleEndian16();var S=ea.getLittleEndian32(),ka=ea.getPosition()+S-8;switch(ha){case 1:var aa=ea,ia=aa.getLittleEndian16(),X=aa.getLittleEndian16(),W=aa.getByte(),
Q=aa.getLittleEndian16(),ra=aa.getLittleEndian16(),va=aa.getLittleEndian16(),h=aa.getLittleEndian16(),m=va-Q,k=h-ra,f=aa.getLittleEndian32(),p=aa.getPosition()+f,t=U.get(ia);t||(ba.onconfirm&&ba.onconfirm(),t=v(ia,e.width,e.height,W));switch(X){case 0:var B=rdpcodecs.bitmap.byte2int(aa.getData(),f,aa.getPosition());t.setRGBs(Q,ra,m,k,B,0,m);break;case 3:for(var C=O.decode(aa,f),y=C.getRects(),V=C.getTiles(),K=C.getTileSize(),l=C.getRectSize(),D=0;D<K;D++){var F=V[D];if(l)for(var N=F.x+64,ca=F.y+64,
pa=0;pa<l;pa++){var ua=y[pa],Ba=ua.x+ua.width,Ea=ua.y+ua.height;N<=Ba?ca<=Ea?t.setRGBs(F.x+Q,F.y+ra,64,64,F.data,0,64):t.setRGBs(F.x+Q,F.y+ra,64,Ea-F.y,F.data,0,64):ca<=Ea?t.setRGBs(F.x+Q,F.y+ra,Ba-F.x,64,F.data,0,64):t.setRGBs(F.x+Q,F.y+ra,Ba-F.x,Ea-F.y,F.data,0,64)}else t.setRGBs(F.x,F.y,64,64,F.data,0,4)}break;case 8:M||(M=new ClearDecoder);M.decode(aa,m,k,t.getData(),Q,ra,t.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Ca=t,za=u(aa,f,!1);Ca.processAvc(za);break;case 12:svGlobal.logger.info("...ALPHA");
break;case 14:Y(aa,f,!1,t);break;case 15:Y(aa,f,!0,t);break;default:svGlobal.logger.warn("Invalid codec:"+X)}aa.setPosition(p);t.postPaint(Q,ra,m,k);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ha=ea;svGlobal.logger.info("...soliFill");for(var wa=Ha.getLittleEndian16(),Aa=-16777216|Ha.getByte()<<16|Ha.getByte()<<8|Ha.getByte()|Ha.getByte()<<24,Na=Ha.getLittleEndian16(),Ya=U.get(wa),Za=0;Za<
Na;Za++){var Wa=Ha.getLittleEndian16(),nb=Ha.getLittleEndian16(),wb=Ha.getLittleEndian16()-Wa,cd=Ha.getLittleEndian16()-nb;Ya.fillRect(Wa,nb,wb,cd,Aa);Ya.postPaint(Wa,nb,wb,cd)}break;case 5:var ib=ea;svGlobal.logger.info("...surfaceToSurface");for(var dd=ib.getLittleEndian16(),ed=ib.getLittleEndian16(),Rb=ib.getLittleEndian16(),Sb=ib.getLittleEndian16(),Tb=ib.getLittleEndian16()-Rb,wc=ib.getLittleEndian16()-Sb,Yd=ib.getLittleEndian16(),fd=U.get(dd),Zd=U.get(ed),gd=dd==ed?null:fd.getRGBs(Rb,Sb,Tb,
wc),hd=0;hd<Yd;hd++){var id=ib.getLittleEndian16(),jd=ib.getLittleEndian16();gd?Zd.setRGBs(id,jd,Tb,wc,gd,0,Tb):fd.moveArea(Rb,Sb,Tb,wc,id-Rb,jd-Sb)}break;case 6:var pb=ea;svGlobal.logger.info("...surfaceToCache");var $d=pb.getLittleEndian16(),xc=pb.getLittleEndian32().toString(16),kd=pb.getLittleEndian32();0<kd&&(xc=kd.toString(16)+xc);var ae=pb.getLittleEndian16(),ld=pb.getLittleEndian16(),md=pb.getLittleEndian16(),nd=pb.getLittleEndian16()-ld,od=pb.getLittleEndian16()-md,be=U.get($d).getRGBs(ld,
md,nd,od);oa[ae]=new q(be,nd,od,xc);break;case 7:var Eb=ea;svGlobal.logger.info("...cacheToSurface");for(var ce=Eb.getLittleEndian16(),de=Eb.getLittleEndian16(),ee=Eb.getLittleEndian16(),Ub=oa[ce],fe=U.get(de),pd=0;pd<ee;pd++){var ge=Eb.getLittleEndian16(),he=Eb.getLittleEndian16();fe.setRGBs(ge,he,Ub.width,Ub.height,Ub.pixels,0,Ub.width)}break;case 8:var ie=ea.getLittleEndian16();oa[ie]=null;break;case 9:var Vb=ea,je=Vb.getLittleEndian16(),ke=Vb.getLittleEndian16(),le=Vb.getLittleEndian16(),me=Vb.getByte();
v(je,ke,le,me);break;case 10:var qd=ea.getLittleEndian16();U.delete(qd);svGlobal.logger.info("delete surface id:"+qd);break;case 11:var rd=ea;rd.getLittleEndian32();rd.getLittleEndian32();break;case 12:var ne=ea.getLittleEndian32();if(0==P){var sd=new Uint8Array(20),tb=new RdpBuffer(sd);tb.setLittleEndian16(13);tb.setLittleEndian16(0);tb.setLittleEndian32(20);tb.setLittleEndian32(4294967295);tb.setLittleEndian32(ne);P++;tb.setLittleEndian32(P);tb.markEnd();c&&ba.send(sd)}break;case 14:var Wb=ea,td=
Wb.getLittleEndian32(),ud=Wb.getLittleEndian32(),yc=Wb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+td+" h:"+ud+" monitors:"+yc);for(var vd=Array(yc),Xb=0;Xb<yc;Xb++){var zc=new x;zc.read(Wb);vd[Xb]=zc;svGlobal.logger.info("MonitorDef "+Xb+": "+zc.toString())}var wd=new H(td,ud,vd);U.reset(wd);ba.onresetgraphic&&ba.onresetgraphic(wd);break;case 15:var Yb=ea,xd=Yb.getLittleEndian16();Yb.skipPosition(2);var Fb=U.get(xd);Fb.outputOriginX=Yb.getLittleEndian32();Fb.outputOriginY=Yb.getLittleEndian32();
ba.onmapsurface&&ba.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+xd+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var Ac=ea,yd=Ac.getLittleEndian32(),oe=Ac.getLittleEndian32(),Gb=Ac.getLittleEndian32(),Zb=!1;switch(yd){case 524292:Zb=!1;0==(Gb&1)&&(M=new ClearDecoder);break;case 524549:(Zb=0!=(Gb&16))||0!=(Gb&1)||(M=new ClearDecoder);break;default:Zb=0==(Gb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+
yd.toString(16)+" len:"+oe+" flags:"+Gb+" h264:"+Zb);ba.onconfirm&&ba.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var zb=ea,zd=zb.getLittleEndian16();zb.skipPosition(2);var jb=U.get(zd);jb.outputOriginX=zb.getLittleEndian32();jb.outputOriginY=zb.getLittleEndian32();jb.targetWidth=zb.getLittleEndian32();jb.targetHeight=zb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+zd+" outX:"+jb.outputOriginX+" outY:"+jb.outputOriginY+
" targetW:"+jb.targetWidth+" targetH:"+jb.targetHeight);ba.onmapsurface&&ba.onmapsurface(jb);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+ha);return}ea.setPosition(ka)}};ba.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var E=b?2:8,ea=10+12*E,ha=new Uint8Array(ea),S=new RdpBuffer(ha);S.setLittleEndian16(18);S.setLittleEndian16(0);S.setLittleEndian32(ea);S.setLittleEndian16(E);S.setLittleEndian32(524292);S.setLittleEndian32(4);
S.setLittleEndian32(b?1:0);S.setLittleEndian32(524549);S.setLittleEndian32(4);S.setLittleEndian32(b?19:0);b||(S.setLittleEndian32(655362),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(655872),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656129),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656384),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656642),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656896),
S.setLittleEndian32(4),S.setLittleEndian32(0));S.markEnd();c&&ba.send(ha)};ba.onclose=function(){U.close()};e.onGetGfxHistory=function(E,ea,ha){var S=w.toPDU(E);S&&ea(S);ha(E);svGlobal.logger.info("Got GFX Histroy")};e.onSetGfxHistory=function(E,ea){svGlobal.logger.info("Set GFX Histroy");10==E?w.fromStream(ea):svGlobal.logger.error("Invalid GFX histroy type: "+E)};return ba}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var r=navigator&&(navigator.language||navigator.userLanguage||""),I=Rdp.languageToKeyboard[r];if(!I){var T=r.indexOf("-");T&&(I=Rdp.languageToKeyboard[r.substring(0,T)])}I||(svGlobal.logger.info("No valid layout for "+r),I=1033);return I}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
