var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(r){var H=0;return function(){return H<r.length?{done:!1,value:r[H++]}:{done:!0}}};$jscomp.arrayIterator=function(r){return{next:$jscomp.arrayIteratorImpl(r)}};$jscomp.makeIterator=function(r){var H="undefined"!=typeof Symbol&&Symbol.iterator&&r[Symbol.iterator];return H?H.call(r):$jscomp.arrayIterator(r)};$jscomp.arrayFromIterator=function(r){for(var H,V=[];!(H=r.next()).done;)V.push(H.value);return V};
$jscomp.arrayFromIterable=function(r){return r instanceof Array?r:$jscomp.arrayFromIterator($jscomp.makeIterator(r))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(r){var H=function(){};H.prototype=r;return new H};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(r,H,V){if(r==Array.prototype||r==Object.prototype)return r;r[H]=V.value;return r};$jscomp.getGlobal=function(r){r=["object"==typeof globalThis&&globalThis,r,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var H=0;H<r.length;++H){var V=r[H];if(V&&V.Math==Math)return V}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(r,H){var V=$jscomp.propertyToPolyfillSymbol[H];if(null==V)return r[H];V=r[V];return void 0!==V?V:r[H]};
$jscomp.polyfill=function(r,H,V,oa){H&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(r,H,V,oa):$jscomp.polyfillUnisolated(r,H,V,oa))};$jscomp.polyfillUnisolated=function(r,H,V,oa){V=$jscomp.global;r=r.split(".");for(oa=0;oa<r.length-1;oa++){var S=r[oa];if(!(S in V))return;V=V[S]}r=r[r.length-1];oa=V[r];H=H(oa);H!=oa&&null!=H&&$jscomp.defineProperty(V,r,{configurable:!0,writable:!0,value:H})};
$jscomp.polyfillIsolated=function(r,H,V,oa){var S=r.split(".");r=1===S.length;oa=S[0];oa=!r&&oa in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var Ba=0;Ba<S.length-1;Ba++){var ea=S[Ba];if(!(ea in oa))return;oa=oa[ea]}S=S[S.length-1];V=$jscomp.IS_SYMBOL_NATIVE&&"es6"===V?oa[S]:null;H=H(V);null!=H&&(r?$jscomp.defineProperty($jscomp.polyfills,S,{configurable:!0,writable:!0,value:H}):H!==V&&($jscomp.propertyToPolyfillSymbol[S]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(S):$jscomp.POLYFILL_PREFIX+
S,S=$jscomp.propertyToPolyfillSymbol[S],$jscomp.defineProperty(oa,S,{configurable:!0,writable:!0,value:H})))};
$jscomp.getConstructImplementation=function(){function r(){function V(){}new V;Reflect.construct(V,[],function(){});return new V instanceof V}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(r())return Reflect.construct;var H=Reflect.construct;return function(V,oa,S){V=H(V,oa);S&&Reflect.setPrototypeOf(V,S.prototype);return V}}return function(V,oa,S){void 0===S&&(S=V);S=$jscomp.objectCreate(S.prototype||Object.prototype);return Function.prototype.apply.call(V,S,oa)||
S}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var r={a:!0},H={};try{return H.__proto__=r,H.a}catch(V){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(r,H){r.__proto__=H;if(r.__proto__!==H)throw new TypeError(r+" is not extensible");return r}:null;
$jscomp.inherits=function(r,H){r.prototype=$jscomp.objectCreate(H.prototype);r.prototype.constructor=r;if($jscomp.setPrototypeOf){var V=$jscomp.setPrototypeOf;V(r,H)}else for(V in H)if("prototype"!=V)if(Object.defineProperties){var oa=Object.getOwnPropertyDescriptor(H,V);oa&&Object.defineProperty(r,V,oa)}else r[V]=H[V];r.superClass_=H.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(r){if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(r){this.yieldResult=r};
$jscomp.generator.Context.prototype.throw_=function(r){this.abruptCompletion_={exception:r,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(r){this.abruptCompletion_={return:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(r){this.abruptCompletion_={jumpTo:r};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(r,H){this.nextAddress=H;return{value:r}};
$jscomp.generator.Context.prototype.yieldAll=function(r,H){r=$jscomp.makeIterator(r);var V=r.next();$jscomp.generator.ensureIteratorResultIsObject_(V);if(V.done)this.yieldResult=V.value,this.nextAddress=H;else return this.yieldAllIterator_=r,this.yield(V.value,H)};$jscomp.generator.Context.prototype.jumpTo=function(r){this.nextAddress=r};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(r,H){this.catchAddress_=r;void 0!=H&&(this.finallyAddress_=H)};$jscomp.generator.Context.prototype.setFinallyBlock=function(r){this.catchAddress_=0;this.finallyAddress_=r||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(r,H){this.nextAddress=r;this.catchAddress_=H||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(r){this.catchAddress_=r||0;r=this.abruptCompletion_.exception;this.abruptCompletion_=null;return r};$jscomp.generator.Context.prototype.enterFinallyBlock=function(r,H,V){V?this.finallyContexts_[V]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=r||0;this.finallyAddress_=H||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(r,H){H=this.finallyContexts_.splice(H||0)[0];if(H=this.abruptCompletion_=this.abruptCompletion_||H){if(H.isException)return this.jumpToErrorHandler_();void 0!=H.jumpTo&&this.finallyAddress_<H.jumpTo?(this.nextAddress=H.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=r};$jscomp.generator.Context.prototype.forIn=function(r){return new $jscomp.generator.Context.PropertyIterator(r)};
$jscomp.generator.Context.PropertyIterator=function(r){this.object_=r;this.properties_=[];for(var H in r)this.properties_.push(H);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var r=this.properties_.pop();if(r in this.object_)return r}return null};$jscomp.generator.Engine_=function(r){this.context_=new $jscomp.generator.Context;this.program_=r};
$jscomp.generator.Engine_.prototype.next_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,r,this.context_.next_);this.context_.next_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(r){this.context_.start_();var H=this.context_.yieldAllIterator_;if(H)return this.yieldAllStep_("return"in H?H["return"]:function(V){return{value:V,done:!0}},r,this.context_.return);this.context_.return(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(r){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],r,this.context_.next_);this.context_.throw_(r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(r,H,V){try{var oa=r.call(this.context_.yieldAllIterator_,H);$jscomp.generator.ensureIteratorResultIsObject_(oa);if(!oa.done)return this.context_.stop_(),oa;var S=oa.value}catch(Ba){return this.context_.yieldAllIterator_=null,this.context_.throw_(Ba),this.nextStep_()}this.context_.yieldAllIterator_=null;V.call(this.context_,S);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var r=this.program_(this.context_);if(r)return this.context_.stop_(),{value:r.value,done:!1}}catch(H){this.context_.yieldResult=void 0,this.context_.throw_(H)}this.context_.stop_();if(this.context_.abruptCompletion_){r=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(r.isException)throw r.exception;return{value:r.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(r){this.next=function(H){return r.next_(H)};this.throw=function(H){return r.throw_(H)};this.return=function(H){return r.return_(H)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(r,H){H=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(H));$jscomp.setPrototypeOf&&r.prototype&&$jscomp.setPrototypeOf(H,r.prototype);return H};
$jscomp.asyncExecutePromiseGenerator=function(r){function H(oa){return r.next(oa)}function V(oa){return r.throw(oa)}return new Promise(function(oa,S){function Ba(ea){ea.done?oa(ea.value):Promise.resolve(ea.value).then(H,V).then(Ba,S)}Ba(r.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(r){return $jscomp.asyncExecutePromiseGenerator(r())};$jscomp.asyncExecutePromiseGeneratorProgram=function(r){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(r)))};
$jscomp.polyfill("Reflect",function(r){return r?r:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(r){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(r){if(r)return r;if($jscomp.setPrototypeOf){var H=$jscomp.setPrototypeOf;return function(V,oa){try{return H(V,oa),!0}catch(S){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(r){if(r)return r;var H=function(S,Ba){this.$jscomp$symbol$id_=S;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:Ba})};H.prototype.toString=function(){return this.$jscomp$symbol$id_};var V=0,oa=function(S){if(this instanceof oa)throw new TypeError("Symbol is not a constructor");return new H("jscomp_symbol_"+(S||"")+"_"+V++,S)};return oa},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(r){if(r)return r;r=Symbol("Symbol.iterator");for(var H="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),V=0;V<H.length;V++){var oa=$jscomp.global[H[V]];"function"===typeof oa&&"function"!=typeof oa.prototype[r]&&$jscomp.defineProperty(oa.prototype,r,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return r},"es6",
"es3");$jscomp.iteratorPrototype=function(r){r={next:r};r[Symbol.iterator]=function(){return this};return r};
$jscomp.polyfill("Promise",function(r){function H(){this.batch_=null}function V(ea){return ea instanceof S?ea:new S(function(xa,fa){xa(ea)})}if(r&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return r;H.prototype.asyncExecute=function(ea){if(null==this.batch_){this.batch_=[];var xa=this;this.asyncExecuteFunction(function(){xa.executeBatch_()})}this.batch_.push(ea)};
var oa=$jscomp.global.setTimeout;H.prototype.asyncExecuteFunction=function(ea){oa(ea,0)};H.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var ea=this.batch_;this.batch_=[];for(var xa=0;xa<ea.length;++xa){var fa=ea[xa];ea[xa]=null;try{fa()}catch(la){this.asyncThrow_(la)}}}this.batch_=null};H.prototype.asyncThrow_=function(ea){this.asyncExecuteFunction(function(){throw ea;})};var S=function(ea){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var xa=this.createResolveAndReject_();try{ea(xa.resolve,xa.reject)}catch(fa){xa.reject(fa)}};S.prototype.createResolveAndReject_=function(){function ea(la){return function(sa){fa||(fa=!0,la.call(xa,sa))}}var xa=this,fa=!1;return{resolve:ea(this.resolveTo_),reject:ea(this.reject_)}};S.prototype.resolveTo_=function(ea){if(ea===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(ea instanceof S)this.settleSameAsPromise_(ea);else{a:switch(typeof ea){case "object":var xa=
null!=ea;break a;case "function":xa=!0;break a;default:xa=!1}xa?this.resolveToNonPromiseObj_(ea):this.fulfill_(ea)}};S.prototype.resolveToNonPromiseObj_=function(ea){var xa=void 0;try{xa=ea.then}catch(fa){this.reject_(fa);return}"function"==typeof xa?this.settleSameAsThenable_(xa,ea):this.fulfill_(ea)};S.prototype.reject_=function(ea){this.settle_(2,ea)};S.prototype.fulfill_=function(ea){this.settle_(1,ea)};S.prototype.settle_=function(ea,xa){if(0!=this.state_)throw Error("Cannot settle("+ea+", "+
xa+"): Promise already settled in state"+this.state_);this.state_=ea;this.result_=xa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};S.prototype.scheduleUnhandledRejectionCheck_=function(){var ea=this;oa(function(){if(ea.notifyUnhandledRejection_()){var xa=$jscomp.global.console;"undefined"!==typeof xa&&xa.error(ea.result_)}},1)};S.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var ea=$jscomp.global.CustomEvent,xa=$jscomp.global.Event,
fa=$jscomp.global.dispatchEvent;if("undefined"===typeof fa)return!0;"function"===typeof ea?ea=new ea("unhandledrejection",{cancelable:!0}):"function"===typeof xa?ea=new xa("unhandledrejection",{cancelable:!0}):(ea=$jscomp.global.document.createEvent("CustomEvent"),ea.initCustomEvent("unhandledrejection",!1,!0,ea));ea.promise=this;ea.reason=this.result_;return fa(ea)};S.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var ea=0;ea<this.onSettledCallbacks_.length;++ea)Ba.asyncExecute(this.onSettledCallbacks_[ea]);
this.onSettledCallbacks_=null}};var Ba=new H;S.prototype.settleSameAsPromise_=function(ea){var xa=this.createResolveAndReject_();ea.callWhenSettled_(xa.resolve,xa.reject)};S.prototype.settleSameAsThenable_=function(ea,xa){var fa=this.createResolveAndReject_();try{ea.call(xa,fa.resolve,fa.reject)}catch(la){fa.reject(la)}};S.prototype.then=function(ea,xa){function fa(Ra,za){return"function"==typeof Ra?function(ub){try{la(Ra(ub))}catch(pb){sa(pb)}}:za}var la,sa,Fa=new S(function(Ra,za){la=Ra;sa=za});
this.callWhenSettled_(fa(ea,la),fa(xa,sa));return Fa};S.prototype.catch=function(ea){return this.then(void 0,ea)};S.prototype.callWhenSettled_=function(ea,xa){function fa(){switch(la.state_){case 1:ea(la.result_);break;case 2:xa(la.result_);break;default:throw Error("Unexpected state: "+la.state_);}}var la=this;null==this.onSettledCallbacks_?Ba.asyncExecute(fa):this.onSettledCallbacks_.push(fa);this.isRejectionHandled_=!0};S.resolve=V;S.reject=function(ea){return new S(function(xa,fa){fa(ea)})};S.race=
function(ea){return new S(function(xa,fa){for(var la=$jscomp.makeIterator(ea),sa=la.next();!sa.done;sa=la.next())V(sa.value).callWhenSettled_(xa,fa)})};S.all=function(ea){var xa=$jscomp.makeIterator(ea),fa=xa.next();return fa.done?V([]):new S(function(la,sa){function Fa(ub){return function(pb){Ra[ub]=pb;za--;0==za&&la(Ra)}}var Ra=[],za=0;do Ra.push(void 0),za++,V(fa.value).callWhenSettled_(Fa(Ra.length-1),sa),fa=xa.next();while(!fa.done)})};return S},"es6","es3");
$jscomp.checkStringArgs=function(r,H,V){if(null==r)throw new TypeError("The 'this' value for String.prototype."+V+" must not be null or undefined");if(H instanceof RegExp)throw new TypeError("First argument to String.prototype."+V+" must not be a regular expression");return r+""};
$jscomp.polyfill("String.prototype.startsWith",function(r){return r?r:function(H,V){var oa=$jscomp.checkStringArgs(this,H,"startsWith");H+="";var S=oa.length,Ba=H.length;V=Math.max(0,Math.min(V|0,oa.length));for(var ea=0;ea<Ba&&V<S;)if(oa[V++]!=H[ea++])return!1;return ea>=Ba}},"es6","es3");
$jscomp.iteratorFromArray=function(r,H){r instanceof String&&(r+="");var V=0,oa=!1,S={next:function(){if(!oa&&V<r.length){var Ba=V++;return{value:H(Ba,r[Ba]),done:!1}}oa=!0;return{done:!0,value:void 0}}};S[Symbol.iterator]=function(){return S};return S};$jscomp.polyfill("Array.prototype.keys",function(r){return r?r:function(){return $jscomp.iteratorFromArray(this,function(H){return H})}},"es6","es3");
$jscomp.polyfill("Array.from",function(r){return r?r:function(H,V,oa){V=null!=V?V:function(xa){return xa};var S=[],Ba="undefined"!=typeof Symbol&&Symbol.iterator&&H[Symbol.iterator];if("function"==typeof Ba){H=Ba.call(H);for(var ea=0;!(Ba=H.next()).done;)S.push(V.call(oa,Ba.value,ea++))}else for(Ba=H.length,ea=0;ea<Ba;ea++)S.push(V.call(oa,H[ea],ea));return S}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var r={},H=Object.create(new $jscomp.global.Proxy(r,{get:function(V,oa,S){return V==r&&"q"==oa&&S==H}}));return!0===H.q}catch(V){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(r,H){return Object.prototype.hasOwnProperty.call(r,H)};
$jscomp.polyfill("WeakMap",function(r){function H(){if(!r||!Object.seal)return!1;try{var la=Object.seal({}),sa=Object.seal({}),Fa=new r([[la,2],[sa,3]]);if(2!=Fa.get(la)||3!=Fa.get(sa))return!1;Fa.delete(la);Fa.set(sa,4);return!Fa.has(la)&&4==Fa.get(sa)}catch(Ra){return!1}}function V(){}function oa(la){var sa=typeof la;return"object"===sa&&null!==la||"function"===sa}function S(la){if(!$jscomp.owns(la,ea)){var sa=new V;$jscomp.defineProperty(la,ea,{value:sa})}}function Ba(la){if(!$jscomp.ISOLATE_POLYFILLS){var sa=
Object[la];sa&&(Object[la]=function(Fa){if(Fa instanceof V)return Fa;Object.isExtensible(Fa)&&S(Fa);return sa(Fa)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(H())return r;var ea="$jscomp_hidden_"+Math.random();Ba("freeze");Ba("preventExtensions");Ba("seal");var xa=0,fa=function(la){this.id_=(xa+=Math.random()+1).toString();if(la){la=$jscomp.makeIterator(la);for(var sa;!(sa=la.next()).done;)sa=sa.value,this.set(sa[0],sa[1])}};fa.prototype.set=
function(la,sa){if(!oa(la))throw Error("Invalid WeakMap key");S(la);if(!$jscomp.owns(la,ea))throw Error("WeakMap key fail: "+la);la[ea][this.id_]=sa;return this};fa.prototype.get=function(la){return oa(la)&&$jscomp.owns(la,ea)?la[ea][this.id_]:void 0};fa.prototype.has=function(la){return oa(la)&&$jscomp.owns(la,ea)&&$jscomp.owns(la[ea],this.id_)};fa.prototype.delete=function(la){return oa(la)&&$jscomp.owns(la,ea)&&$jscomp.owns(la[ea],this.id_)?delete la[ea][this.id_]:!1};return fa},"es6","es3");
$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(r){function H(){if($jscomp.ASSUME_NO_NATIVE_MAP||!r||"function"!=typeof r||!r.prototype.entries||"function"!=typeof Object.seal)return!1;try{var fa=Object.seal({x:4}),la=new r($jscomp.makeIterator([[fa,"s"]]));if("s"!=la.get(fa)||1!=la.size||la.get({x:4})||la.set({x:4},"t")!=la||2!=la.size)return!1;var sa=la.entries(),Fa=sa.next();if(Fa.done||Fa.value[0]!=fa||"s"!=Fa.value[1])return!1;Fa=sa.next();return Fa.done||4!=Fa.value[0].x||"t"!=Fa.value[1]||!sa.next().done?
!1:!0}catch(Ra){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(r&&$jscomp.ES6_CONFORMANCE)return r}else if(H())return r;var V=new WeakMap,oa=function(fa){this.data_={};this.head_=ea();this.size=0;if(fa){fa=$jscomp.makeIterator(fa);for(var la;!(la=fa.next()).done;)la=la.value,this.set(la[0],la[1])}};oa.prototype.set=function(fa,la){fa=0===fa?0:fa;var sa=S(this,fa);sa.list||(sa.list=this.data_[sa.id]=[]);sa.entry?sa.entry.value=la:(sa.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:fa,value:la},sa.list.push(sa.entry),this.head_.previous.next=sa.entry,this.head_.previous=sa.entry,this.size++);return this};oa.prototype.delete=function(fa){fa=S(this,fa);return fa.entry&&fa.list?(fa.list.splice(fa.index,1),fa.list.length||delete this.data_[fa.id],fa.entry.previous.next=fa.entry.next,fa.entry.next.previous=fa.entry.previous,fa.entry.head=null,this.size--,!0):!1};oa.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=ea();this.size=0};oa.prototype.has=
function(fa){return!!S(this,fa).entry};oa.prototype.get=function(fa){return(fa=S(this,fa).entry)&&fa.value};oa.prototype.entries=function(){return Ba(this,function(fa){return[fa.key,fa.value]})};oa.prototype.keys=function(){return Ba(this,function(fa){return fa.key})};oa.prototype.values=function(){return Ba(this,function(fa){return fa.value})};oa.prototype.forEach=function(fa,la){for(var sa=this.entries(),Fa;!(Fa=sa.next()).done;)Fa=Fa.value,fa.call(la,Fa[1],Fa[0],this)};oa.prototype[Symbol.iterator]=
oa.prototype.entries;var S=function(fa,la){var sa=la&&typeof la;"object"==sa||"function"==sa?V.has(la)?sa=V.get(la):(sa=""+ ++xa,V.set(la,sa)):sa="p_"+la;var Fa=fa.data_[sa];if(Fa&&$jscomp.owns(fa.data_,sa))for(fa=0;fa<Fa.length;fa++){var Ra=Fa[fa];if(la!==la&&Ra.key!==Ra.key||la===Ra.key)return{id:sa,list:Fa,index:fa,entry:Ra}}return{id:sa,list:Fa,index:-1,entry:void 0}},Ba=function(fa,la){var sa=fa.head_;return $jscomp.iteratorPrototype(function(){if(sa){for(;sa.head!=fa.head_;)sa=sa.previous;for(;sa.next!=
sa.head;)return sa=sa.next,{done:!1,value:la(sa)};sa=null}return{done:!0,value:void 0}})},ea=function(){var fa={};return fa.previous=fa.next=fa.head=fa},xa=0;return oa},"es6","es3");$jscomp.findInternal=function(r,H,V){r instanceof String&&(r=String(r));for(var oa=r.length,S=0;S<oa;S++){var Ba=r[S];if(H.call(V,Ba,S,r))return{i:S,v:Ba}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(r){return r?r:function(H,V){return $jscomp.findInternal(this,H,V).i}},"es6","es3");
var svManager={getInstance:function(){var r=window.$rdp;return r&&r.running&&r.running()?r:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(r){var H={};H.id=r.id;H.server=r.id;H.displayName=r.displayName||r.id;if(r=r.rdp){for(var V in r)H[V]=r[V];H.user=r.username||"";H.pwd=r.password||"";H.useConsole=r.console||!1;H.legacyMode=r.leagacyMode||r.legacyMode||!1;H.server_bpp=r.color||16;H.exe=r.remoteProgram||"";H.args=r.remoteArgs||"";H.startProgram=0<H.exe.length?"app":H.command&&0<H.command.length?"shell":"noapp"}return H}
function Rdp2(r){r=svGlobal.util.getServerArgs(r);if(!r||!r.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var H=r.gateway||"",V=0,oa=0,S=16,Ba=1==r.useSSL||"true"==r.useSSL||"on"==r.useSSL||null;r.width&&(V=parseInt(r.width,10));r.height&&(oa=parseInt(r.height,10));r.color&&(S=parseInt(r.color,10));r.server_bpp&&(S=parseInt(r.server_bpp,10));r=hi5.browser.obj2url(r);null===Ba&&(Ba="https:"==location.protocol);return new Rdp((Ba?"wss://":"ws://")+H+"/RDP?"+r,V,oa,S)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(r,H,V,oa){function S(a){return"on"==a||"true"==a||1==a}function Ba(){var a=n.gateway;n.ongetgatewayaddress&&(a=n.ongetgatewayaddress(a));return a}function ea(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function xa(a,b){a=ja[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function fa(){return I.displayName||I.server||I.symlink||I.id||"undefined"}function la(a){n.loadbalanceToken||
(n.loadbalanceToken=ja.loadbalanceTokenName?ja.loadbalanceTokenName+"="+a:"")}function sa(a,b,d){n.ontitlechange&&(a=n.ontitlechange(a,d));n.setTitle&&a&&(b=b||window,b.document.title=a)}function Fa(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return I.invitation||n.showMessage("15 bit color is not supported anymore."),!1;default:return!1}hb=a;b&&(Na?Na.postMessage({type:0,cmd:1,data:a}):Ha&&Ha.setColor(a));return!0}function Ra(a,b,d,g){La=a;Ma=b;bc=cc=0;dc=La-1;ec=Ma-1;Ya&&(La=(I.waWidth||
hi5.browser.getScreenWidth())|0,Ma=(I.waHeight||hi5.browser.getScreenHeight())|0);I.minWidth&&La<I.minWidth&&(La=I.minWidth|0);I.minHeight&&Ma<I.minHeight&&(Ma=I.minHeight|0);La&=-4;Ma&=-4;svGlobal.logger.warn("resolution changed, w:"+La+" h:"+Ma);var c=La,e=Ma;va?va.resize(c,e):va=new Ec(c,e);ha.setSize(La,Ma,Ya?"hidden":null);if(d||La!=a||Ma!=b)Na?Na.postMessage({type:0,cmd:2,data:{w:La,h:Ma}}):Ha&&Ha.setResolution(La,Ma);if(n.onresolutionchange&&!g)n.onresolutionchange(a,b)}function za(a){!eb&&
Ja&&(Na?(fc.data=a,"string"!=typeof a?Na.postMessage(fc,[a]):Na.postMessage(fc)):Ha.writeRawInput(a))}function ub(a){switch(a){case "\r":break;case "\n":n.writeScancode(28);break;case "\t":n.writeScancode(15);break;default:za("86"+a)}}function pb(a){var b=this;a||(a=143);this.send=function(d){var g=!!d.buffer,c=g?d:d.getData(),e=64==a;d=g?c.length:d.getEnd()||c.length;d<c.length&&(c=g?c.subarray(0,d):c.slice(0,d));g=e?5:9;d=new Uint8Array(g+d);d[0]=a;if(e)d[1]=b.id,d[2]=b.id>>8,d[3]=b.id>>16,d[4]=
b.id>>24;else{e=b.name;for(var f=Math.min(e.length,8),z=0;z<f;z++)d[1+z]=e.charCodeAt(z)}d.set(c,g);za(d.buffer)};this.name="";this.count=this.id=this.flags=0}function Ib(a){if(n){var b=__svi18n.errorCode[a]||"Error: "+a;a={name:a,message:b,msg:b};n.displayMsg&&n.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(n.onerror)n.onerror(a)}}function Fc(a){if(n){var b=__svi18n.info[a];b||(b="info "+a);n.displayMsg&&n.showMessage(b);svGlobal.logger.info(b)}}function gc(){var a=Ja;qb=Ja=!1;
Na?Na.postMessage({type:0,cmd:3}):Ha&&Ha.resetStatus();a&&(Ja=a)}function hc(a){Pa||(Pa=new hi5.file.UploadManager(new hi5.file.WsFileService(za)),Pa.addEvent("beforeupload",function(b,d,g){if(n.beforeupload)return n.beforeupload(b,d,g)}),Pa.addEvent("fileuploaded",function(b,d,g){if(n.onfileuploaded)n.onfileuploaded(b,d,g)}),Pa.addEvent("uploaded",function(b,d){if(n.onuploaded)n.onuploaded(b,d)}),Pa.addEvent("uploadingCancelled",function(){if(n.onuploadingCancelled)n.onuploadingCancelled()}));a.setFileHandler(Pa)}
function Gc(a,b,d){var g=!1;this.exe=a;this.args=b||"";this._dir=d||"";var c=this;this.close=function(){!g&&Ja&&(g=!0,za("8C5"+c.exe+"\t"+c.args+"\t"+n.sessionInfo.appInfo.session))}}function Cd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Hc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}
function Jb(a){a=(new Uint8Array(a)).buffer;return CBOR.decode(a)}function Dd(a,b,d){var g={};if(b&&b.attachment)switch(b.attachment){case 1:var c="platform";break;case 2:c="cross-platform"}c&&(g.authenticatorAttachment=c);c={};b&&(b.requireResident?b.requireResident&&(c.requireResidentKey=!0,c.residentKey="required"):b.preferResident&&b.preferResident&&(c.requireResidentKey=!0,c.residentKey="preferred"));d&&d.rk&&(d.rk?(c.requireResidentKey=!0,c.residentKey="required"):(c.requireResidentKey=!1,c.residentKey=
void 0));c&&(c.requireResidentKey&&(g.requireResidentKey=c.requireResidentKey),c.residentKey&&(g.residentKey=c.residentKey));if(a=Ic(a,b,d))g.userVerification=a;if(Object.keys(g).length)return g}function Jc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next()){var g=d.value;d={};g.id&&(d.id=g.id);g.type&&(d.type=g.type);if(g.transports){var c=d;g=g.transports;var e=[];g&1?e.push("usb"):g&2?e.push("nfc"):g&4?e.push("ble"):g&16?e.push("internal"):g&32&&e.push("hybrid");
c.transports=e}b.push(d)}}return b}function Ic(a,b,d){var g;a&&(a&4194304?g="required":a&8388608?g="preferred":a&16777216&&(g="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:g="required";break;case 2:g="preferred";break;case 3:g="discouraged"}d&&d.uv&&("FALSE"==d.uv.toUpperCase()?g="discouraged":"TRUE"==d.uv.toUpperCase()&&(g="required"));return g}function Ed(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function Fd(a,b){var d,g,c,e,f,z,x,t,J,C,A,w,v,X,y,ba,O,P,N;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ma){if(1==ma.nextAddress){a.getPublicKeyAlgorithm();if((d=a.getTransports())&&0<d.length)for(var qa=$jscomp.makeIterator(d),
R=qa.next();!R.done;R=qa.next())R=R.value,"USB"==R.toUpperCase()||"NFC"==R.toUpperCase()||"BLE"==R.toUpperCase()||"INTERNAL"==R.toUpperCase()||R.toUpperCase();if(g=a.attestationObject)e=Jb(g),c=e.attStmt;if(f=a.clientDataJSON)z=window.origin,x=(new TextDecoder).decode(f),t=JSON.parse(x),t.origin&&(t.origin=z);J=a.getAuthenticatorData();if(!J)return ma.jumpTo(0);C=new Uint8Array(J);return b?(A=b.id)?ma.yield(Gd(A),5):ma.jumpTo(0):ma.jumpTo(0)}w=ma.yieldResult;v=new Uint8Array(w);X=new hi5.DataBuffer(new Uint8Array(C.byteLength));
X.setBytes(v);y=C.slice?C.slice(32,C.length):C.subarray(32,C.length);X.setBytes(y);X.markEnd();ba=X.getData();O={1:"packed",2:ba,3:c};P=CBOR.encode(O);N=new hi5.DataBuffer(new Uint8Array(P.byteLength+1));N.setByte(0);N.setBytes(P);N.markEnd();return ma.return(N.getData())})}function Gd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){b=(new TextEncoder).encode(a);return d.return(Hd(b))})}function Hd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==
d.nextAddress)return d.yield(crypto.subtle.digest("SHA-256",a),2);b=d.yieldResult;return d.return(b)})}function Id(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}function Jd(a,b,d,g,c){ic.set(a,b);jc.set(a,g);b="<b>User:&nbsp;</b>"+d+"&nbsp;("+g+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+c;d=document.createElement("div");g=document.createElement("input");g.type="radio";g.name="scard_name";g.value=a;0==a&&(g.defaultChecked=!0);d.appendChild(g);d.innerHTML+=
b;d.innerHTML+="<br>";return d}function Kd(a,b){var d=document.createElement("div"),g=document.createElement("input");g.type="radio";g.name="ds_name";g.value=a;0==a&&(g.defaultChecked=!0);d.appendChild(g);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Kc(){var a="";I&&S(I.connectif)&&I.symlink&&"sessionStorage"in window&&(a="SV_"+I.symlink,I.domain&&(a+=I.domain),I.user&&(a+=I.user));return a}function Ld(){var a=window.localStorage.getItem(void 0)||"";a&&(a="&certHash="+a);var b=hi5.appcfg.persistentId?
window.localStorage:window.sessionStorage;if(!b)return a;var d=b.getItem("appInfo.session");if(!d)return a;a+="&_session="+d;(b=b.getItem("appInfo.numericId"))&&(a+="&_numericId="+b);return a}function Kb(){if(!Ja){qb=!1;var a="";eb?Ia.init(!1,!0,!1,1,!1,!1):a=n.getRuntimeURL();void 0==ja.wsPost&&(ja.wsPost=!1);n.oncreatewebsocket&&(Na=null);Na?(eb&&(eb.onopen=kc,eb.onclose=Ab,eb.onmessage=function(d){lc.data=d.data;Na.postMessage(lc,[lc.data])}),Na.postMessage({type:0,cmd:0,data:{addr:a,width:La,
height:Ma,server_bpp:hb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ja.wsPost}})):(Ha=new RdpGeneral(eb||a,La,Ma,hb,va,!1,ja.wsPost),Ha.oncreatewebsocket=n.oncreatewebsocket,Ha.run());Na?Na.addEventListener("message",Lc,!1):(Ha.onopen=kc,Ha.onmessage=Mc,Ha.onclose=Ab,Ha.onerror=Ib,Ha.oninfo=Fc,Ha.onloggedin=mc,Ha.onresolutionchange=function(d,g){Ra(d,g,!1,I.monitorDef&&0<=I.monitor?!0:!1)},Ha.onAltSecWindows=Nc,Ha.onMoveCursor=nc,Ha.onCloseSurface=Oc,Ha.onColorChange=Fa,Ha.onHistoryReceived=function(){oc()},
Ha.onLockKeyState=function(d){if(n.onLockKeyState)n.onLockKeyState(d)});if(a=ha.getSurface(ha.size()-1))Ya?a&&(a.remoteApp=new Gc(I.exe,I.args,"")):sa(fa(),a.getWindow());if(I.invitation&&!S(I.shadow)){var b=null;a&&(b=a.initChat(I.expert));Bb=new n.GatewayChannel;Bb.name="C_H_A_T";Bb.process=function(d){d=d.getUnicodeString(d.getEnd()-d.getPosition(),!0);b&&b.add(d,I.novice)};b&&(b.onchat=function(d){if(Ja){var g=Array(2*d.length);g=new hi5.DataBuffer(g,0,g.length);g.setUnicodeString(d);g.markEnd();
Bb.send(g)}});n.addGatewayChannel(Bb)}}}function Lc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:kc();break;case 1:Ab(a.expected);break;case 2:Ib(a.code);break;case 3:Fc(a.code);break;case 4:mc();break;case 5:Ra(a.w,a.h,!1,I.monitorDef&&0<=I.monitor?!0:!1);break;case 6:nc(a.x,a.y,!0);break;case 7:Oc();break;case 8:0==a.id&&oc();Sa&&Sa.check(1<a.id?15555:0);break;case 9:Fa(a.color);break;case 10:if(n.onLockKeyState)n.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:va.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:va.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:va.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:va.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:va.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:va.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Pc(a);break;case 10:Mc(a);break;case 11:Xa.attach(a.data,0,a.data.length);Nc(Xa,a.size);
break;case 12:va.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:va.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:va.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:va.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:va.putFont(a.font,a.character,a.glyph);break;case 17:va.putCursor(a.idx,
a.cursor);break;case 18:va.setCursor(a.idx);break;case 19:va.getHistory(a.cmd,za,function(b){Na.postMessage({type:0,cmd:7})});Sa&&Sa.check(15555);break;case 20:Xa.attach(a.data,a.off,a.data.length-a.off);va.setHistory(a.order,Xa);break;case 21:va.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Qc(a){Sa&&Sa.check(a)}function kc(){Ja=!0;var a="87"+navigator.userAgent+"\t";Lb=hi5.tool.uuid();document.cookie=Lb+"=sv";za(a+Lb);if(n.onopen)n.onopen();
ja.joinCloseMode&&n.setJoinCloseMode(ja.joinCloseMode)}function Oc(){ha&&ha.close()}function Mc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Xa.attach(a,0,b.byteLength);var d=Xa.getLittleEndian16();switch(d){case 28:a=Xa;b=a.getAscllString(8);d=kb[b];null!=d?d.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Xa;switch(a.getByte()){case 0:Ea.tag=a.getLittleEndian16();Ea.channels=a.getLittleEndian16();Ea.samplePerSec=a.getLittleEndian32();a.skipPosition(6);Ea.bitsPerSample=
a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ea.tag+" channels="+Ea.channels+" bitsPerSample="+Ea.bitsPerSample+" samplePerSec="+Ea.samplePerSec);Na&&Na.postMessage({type:0,cmd:5,data:{tag:Ea.tag,channels:Ea.channels,samplePerSec:Ea.samplePerSec,bitsPerSample:Ea.bitsPerSample}});41222==Ea.tag&&(Ea.sampleRate=Ea.samplePerSec,Wa.initMediaPlayer(Wa,Ea,!1));break;case 1:b=a.getByte(),d=a.getLittleEndian16(),a.skipPosition(8),pc(a,b,d,0),lb||za("8A"+b+","+d)}Sa&&Sa.check();break;case 56:Rc(Xa.getUnicodeString(Xa.getEnd()-
Xa.getPosition(),!1));break;case 60:Sc(Xa);break;case 62:Tc(Xa.getUnicodeString(Xa.getEnd()-Xa.getPosition(),!1));break;case 63:Uc(Xa);Sa&&Sa.check();break;case 64:b=Xa;d=b.getByte();a=b.getLittleEndian32();switch(d){case 1:b=b.getAscllString();if(Ia[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ia[b].newInstance?(Ia[a]=Ia[b].newInstance(),Ia[a].id=a):(Ia[b].id=a,Ia[a]=Ia[b]),Ia[a].onopen)Ia[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ia[a]&&
Ia[a].process(b);break;case 4:if(Ia[a]&&Ia[a].onclose)Ia[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Sa&&Sa.check();break;case 146:Md(Xa);break;default:if(n.onunknownmessage)n.onunknownmessage(d,Xa);else svGlobal.logger.warn("@TODO:"+d+"\n")}}else switch(d=parseInt(b.substring(0,2),16),a=b.substring(2),d){case 0:za("87"+navigator.userAgent);break;case 15:if(n){Mb=!1;vb=n.reconnectTimes;(n&&0==n.mode||S(I.connectif))&&oc();b="";for(b in mb)if((d=mb[b])&&d.onopen)d.onopen();for(b in kb)if((d=
kb[b])&&d.onopen)d.onopen();a&&(a=JSON.parse(a),a.capability&&n&&(n.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(n.onnotify)n.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&n.onerror)n.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;n.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ha.drawLicense(a);break;case 50:if(Ja)switch(b=
parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Nd(a);break;case 2:Cb?(Cb.type==a?n.writeRawInput("881"+a+"\t"+Cb.text):n.writeRawInput("881ERROR\t"),Cb=null):!(b=ha.getFocused())||b.processClipReq(a)||!ja.clipWarnAlways&&Vc||!I||I.leagacyMode||(n.showMessage(__svi18n.info.menucopy,null,5E3),Vc=!0);break;case 5:(b=ha.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ha.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=Ba()+b[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+
a+" name:"+b[1]+" driver:"+b[2]);n.onprintingready&&n.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ha.getFocused())&&b.showPDF(a);break;case 56:Rc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ha.getWinById(parseInt(b[0]))){if(!ha.hasApp(b[1])){(d=ha.getOwnerSurface(a))&&d.railWin&&(d.railWin.appId=b[1],d.railWin.addApp(b[1]));if(n.onremoteappstart)n.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&n.ontitlechange)n.ontitlechange(d.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Od(a);break;case 59:a=hi5.Base64.dec(a,0);fb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();lb||!(fb&16||fb&65536)?(Nb=!1,Pa=null):(fb&16&&(Nb=!0),Pa||(a=ha.getFocused())&&hc(a));fb&64&&n.showMessage(__svi18n.info.recording);Pa&&(Pa.setUpload(!(fb&128)),Pa.setDownload(!(fb&131072)),Pa.canCopyFile=0!=(fb&65536));ha.execute("setFeature",[fb]);break;case 60:Sc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Ra(a.width,a.height,!0,!1);Fa(a.color);
(b=a.server)&&n&&(n.server=a.server);Wc=a.length;d=ha.getFocused();Ya=1==a.isRail;d&&(1!=n.mode&&d.setAutoScale(!Ya),b&&sa(fa(),d.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&d.setUnicode(!0),b=a.mapDisk)&&(Nb=!0,hc(d));if(n.onopened)n.onopened(a);break;case 1:a=a.duration;if(n.onprogress)n.onprogress(a,Wc);break;case 2:2==a.status?(gc(),Ja=!0):(b=0==a.status,b==va.isPaused()||n.onsessionpause&&n.onsessionpause(b,a)||(va&&va.pause(b,void 0),b||ha.repaint(0,0,va.width-1,va.height-1),a.warn&&
n.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Tc(a);break;case 63:Uc(b64ToBuffer(a));break;default:if(n.onunknownmessage)n.onunknownmessage(d,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function oc(){if(!lb&&!Za&&(Za=!0,n&&(ja.pingInterval&&n.startPing(ja.pingInterval),n.onready)))n.onready()}function Md(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;za(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();
0!=b||a&4||(fb^=65536,ha.execute("setFeature",[fb]));break;case 6:Ta.remoteLockFlags=a.getLittleEndian32();Ta.checkLockFlags=!0;if(n.onLockKeyState)n.onLockKeyState({capsLock:0!=(Ta.remoteLockFlags&4),numLock:0!=(Ta.remoteLockFlags&2),scrollLock:0!=(Ta.remoteLockFlags&1)},{capsLock:0!=(Ta.localLockFlags&4),numLock:0!=(Ta.localLockFlags&2),scrollLock:0!=(Ta.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ta.remoteLockFlags);break;case 7:b=a.getByte();n.sessionInfo.appInfo.twoFAEnabled=
0<b;switch(b){case 0:b=a.getByte();var d=a.getLittleEndian32();a=a.getBytes(d);n.sessionInfo.appInfo.twoFAQR=a;n.ontwofaqr&&n.ontwofaqr(a)||2==b&&ha.execute("showTwoFAQR");break;case 1:va&&va.pause(!0,!0);if(n.ontwofacode&&n.ontwofacode())return;(a=ha.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!n.ontwofaresult||!n.ontwofaresult(b,a))&&Ta.onauthcoderesult)Ta.onauthcoderesult(b,a)}break;case 8:b=a.getByte();if(a=ha.getFocused()){d="image/png";switch(b){case 1:d=
"image/jpeg";break;case 2:d="image/webp"}a.getSnapshot(function(g){g.bytes().then(function(c){var e=new Uint8Array(2+c.length);e[0]=146;e[1]=8;e.set(c,2);za(e.buffer)})},d)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Pd(a,b){var d=0,g=!1;this.width=a;this.interval=b;var c=0;this.start=function(){g||(g=!0,d=setInterval(function(){var e=ha.getFocused();e&&Ja&&(e=e.getThumbnail(a))&&e.length!=c&&(za("8E7"+e),c=e.length)},b))};this.stop=function(){clearInterval(d)}}function Qd(a,
b){!$a||$a.width==a&&$a.interval==b||($a.stop(),$a=null);$a||($a=new Pd(a,b));$a.start()}function Uc(a){var b=a.getAscllString(8);(b=mb[b])&&b.process&&b.process(a)}function Tc(a){var b=parseInt(a.substring(0,1),16),d=a.substring(1);a=!1;var g=n.sessionInfo.appInfo;switch(b){case 0:var c=JSON.parse(d);gc();Ja=!0;a=c.width;g=c.height;if(a==La&&g==Ma)break;Ra(a,g,!1,!1);break;case 1:c=JSON.parse(d);n.sessionInfo.joinedSessions.push(c.numericId);n.sessionInfo.joiners.push(c);g.sessions[c.numericId]=
c.name||c.__ip;if(!g.joined||ja.alertJoin)n.onsessionjoin&&(a=n.onsessionjoin(c)),!a&&__svi18n.info.joinsession&&n.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(d);n.sessionInfo.joinedSessions.removeElm(c.numericId);delete g.sessions[c.numericId];b=n.sessionInfo.joiners;d=0;for(var e=b.length;d<e;d++)if(b[d].numericId==c.numericId){b.splice(d,1);break}if(!g.joined||ja.alertJoin)n.onsessionexit&&(a=n.onsessionexit(c)),!a&&__svi18n.info.exitsession&&
n.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(d);g.joinMode!=c.mode&&(g.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(g.hasControl)break;g.hasControl=!0;ha.setReadOnly(!1,2==c.mode);if(g=hi5.$("requestControl"))g.disabled=!0;n.ongivecontrol&&(a=n.ongivecontrol());if(a)break;n.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:c=JSON.parse(d);ha.setReadOnly(!0,2==c.mode);g.hasControl=!1;if(g=hi5.$("requestControl"))g.disabled=
!1;n.ontakebackcontrol&&(a=n.ontakebackcontrol());if(a)break;n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:c=JSON.parse(d);n.onrequirecontrol&&(a=n.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);g=__svi18n.info.recontrol;va.isPaused&&(g+="<br><br>"+(__svi18n.info.autoresume||""));n.showMessage({title:a,msg:g,cbYes:function(){n.giveControl(c.numericId);this.destroy();va.isPaused()&&n.pauseSession(n.sessionInfo.appInfo.numericId,!1)},cbNo:function(){n.refuseControl(c.numericId);
this.destroy()},html:!0});break;case 6:ha.execute("setTouchRemoting",[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&Ra(c.width,c.height,!0,I.monitorDef&&0<=I.monitor?!0:!1);c.color&&(Fa(c.color,!0),svGlobal.logger.warn("Color depth changed to:"+c.color));c.version&&(n.sessionInfo.protocolVersion=c.version);break;case 8:c=JSON.parse(d);Mb=!0;if(n.onrequestcredential&&n.onrequestcredential(c,Ta.reconnect))break;if(n.onautherror&&n.onautherror(c,Ta.reconnect))break;ha.getFocused().requestCredential(c,
Ta.reconnect);break;case 9:c=JSON.parse(d);0<c.interval&&0<c.width?Qd(c.width,c.interval):$a&&($a.stop(),$a=null);break;case 11:c=JSON.parse(d);n.onrequirejoin&&(a=n.onrequirejoin(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);n.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){n.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){n.allowJoin(c.numericId,!1);this.destroy()}});break;case 13:c=JSON.parse(d);"login"==c.type&&mc();break;case 14:c=JSON.parse(d);
if(n.oncontrolchange)n.oncontrolchange(c);break;case 15:c=JSON.parse(d),Rd(c)}}function Rd(a){if("cert"==a.type){Mb=!0;var b=__svi18n.info.cert||"The certificate of remote connection could not be verified. Do you want to continue?<br>Target: %1,<br>Hash: %2";b=b.applyArgs([a.target,a.hash]);hi5.notifications.notify({msg:b,cbYes:function(){this.destroy();window.localStorage.setItem(void 0,a.hash);Kb()},cbNo:function(){this.destroy()},html:!0})}}function Sc(a){switch(a.getByte()){case 32:if(!va.isPaused()){var b=
a.getLittleEndian16(),d=a.getLittleEndian16(),g=a.getLittleEndian16(),c=void 0,e=void 0;ja.noCursorName||(c=a.getLittleEndian32(),n.sessionInfo.appInfo&&(e=n.sessionInfo.appInfo.sessions[c]));nc(d,g,!0,e,c,b)}}}function nc(a,b,d,g,c,e){va.isPaused()||ha.getFocused().moveCursor(a,b,d,g,c,e)}function Pc(a){ha.setCursor(a)}function Sd(a){var b=ja.page&&ja.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var d=location.href,g=d.lastIndexOf("/");
if(b)return d.substring(0,g+1)+b;b=Ba();d.toLowerCase().startsWith(b.toLowerCase())&&(b=d.substring(0,g));return b+"/"+a}function Rc(a){a=JSON.parse(a);qc=a.session;var b=a.numericId,d=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;d&&(d.setItem("appInfo.session",qc),d.setItem("appInfo.numericId",b));la(a.appId);a.server||(a.server=fa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=n.mode&&ha.execute("setAutoScale",
[!0]):(n.mode=0,S(I.connectif)&&ha.setSize(La,Ma),ja.disableJoinedAppResize&&(n.windowState=0));var g=Ba();b=Sd("join.html")+"?id="+(a.joined||a.numericId);(d=a.webAddress)&&0<d.length&&d.toLowerCase()!=g.toLowerCase()&&(g=d.indexOf("://"),n.protocol="http"==d.substring(0,g)?"ws":"wss",n.gateway=d,b+="&gateway="+encodeURIComponent(d));b=n.modifyURL(b);a.joinLink=b;n.sessionInfo.appInfo=a;"isApp"in a&&Ya!==a.isApp&&(Ya=a.isApp,Ra(La,Ma,!0,!0),qb||1==n.mode||ha.execute("setAutoScale",[!0]));a.ver&&
a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ja.cursorNameOnly=a.isAssistance;if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function Od(a){if(Pa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Pa.notifyFiles(JSON.parse(a));else{var d=a.split("\t");switch(b){case 1:Pa.confirmId(d[0],d[1],d[2]);break;case 2:Pa.read(d[0],parseInt(d[1],10),parseInt(d[2],10));break;case 4:Pa.close(d[0]);break;case 9:a='<a href="'+n.modifyURL(Ba()+d[0])+'" download="'+
d[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+d[1]+"</a>",__svi18n.info.download&&ha.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Pa.removeFile(d[0],!0);this.destroy()},onclick:function(g){"A"==g.target.tagName&&this.destroy()}})}}}}function pc(a,b,d,g){if(!Xc||va.isPaused())return 0;var c=a.getPosition();b=a.getData();g||(g=a.getEnd()-c);if(41222==Ea.tag)return Wa.onaudioframe(b.slice(c)),0;if(a=1!=Ea.tag)rc||(rc=new MSGSM),b=rc.decode(b,c,g),c=0,
g=b.length;var e=Ea.bitsPerSample;var f=Math.floor(g/(e>>3));var z=d=g=0;a||(g=Math.pow(2,e-1)-1,d=-g-1,z=Math.pow(2,e));e=Ea.channels;var x=Math.floor(f/e),t=Wa.getBuffer(x),J=t.getChannelData(0),C=t.getChannelData(1);f=0;if(a)for(;f<x;)1==e?C[f]=J[f]=b[c++]:(J[f]=b[c++],C[f]=b[c++]),f++;else for(;f<x;)a=b[c++]|b[c++]<<8,a>g?(a-=z,a/=-d):a/=g,1==e?J[f]=a:(J[f]=a,a=b[c++]|b[c++]<<8,a>g?(a-=z,a/=-d):a/=g),C[f]=a,f++;return Wa.playBuffer(t)}function Yc(a){if(!n.openLink||2E3<a.length)return!1;var b=
a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var d=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");d||(0==a.indexOf("www.")?(d=!0,a="http://"+a):0==a.indexOf("ftp.")&&(d=!0,a="ftp://"+a));return d?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:n.onurlredirection&&n.onurlredirection(b)?!0:(a=ha.getFocused())?a.processLink(b):!1:!1}function Td(a){if(a.startsWith("text/html;<img data-sv-img")){var b=
a.indexOf('src="');if(0<b){b+=5;var d=a.indexOf('"',b),g=a.substring(b,d);g=n.modifyURL(g);a=a.substring(0,b)+g+a.substring(d)}}return a}function Nd(a){if("text/plain;"!=a){if(1666<Date.now()-Ta.reqCopyTime&&!(n.onservercopy&&n.onservercopy(a)||Yc(a))){var b=ha.getFocused();b&&b.copyToClip(Td(a))}setTimeout(function(){za("883")},999)}}function mc(a){if(!qb&&(setTimeout(function(){Ja&&za("884")},333),n.onloggedin))n.onloggedin();sc=qb=!0;a&&a.sessionId&&(n.sessionInfo.sessionId=a.sessionId);Ya&&1!=
n.mode&&ha.execute("setAutoScale",[!1]);Pa&&(Pa.enabled=!0);Ob&&!Ya&&(va.setContext(ha.getFocused().context),ha.repaint(0,0,va.width-1,va.height-1))}function Ab(a){if(n){hi5.browser.cookie.delete(Lb);svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));n.onagentmessage&&(n.onagentmessage=null);if(n.onagentclose)n.onagentclose();var b=Kc();b&&n.sessionInfo.appInfo&&0==n.mode&&(sessionStorage[b]=n.sessionInfo.appInfo.session);if(n&&(b=1!=n.mode,!Ja&&b&&Ib("connection"),
b=b&&(Ja||vb<n.reconnectTimes)&&0<vb&&!a,Za=Ja=!1,b)){vb--;__svi18n.info.reconnecting&&n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-vb)+"/"+n.reconnectTimes,null,3E3);setTimeout(Kb,ja.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+vb);return}if(Mb)svGlobal.logger.info("No release");else{Sa&&(n.stopPing(),Sa=null);Na&&(Na.removeEventListener("message",Lc,!1),Na.postMessage({type:0,cmd:4}),Na.terminate(),Na=null);Pa&&(Pa.release(),Pa=null);Ua=r=null;Ia&&(Ia.close(),
Ia=null);mb&&hi5.Arrays.release(mb);kb&&hi5.Arrays.release(kb);$a&&($a.stop(),$a=null);Wa&&(Wa.close(),Wa=null);n.player&&(n.player=null);Db=null;try{if(n.onclose)n.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ha&&(ha.close(),ha=null)}catch(d){svGlobal.logger.warn(d)}Xa=null;Ha&&(Ha.onopen=null,Ha.onmessage=null,Ha.onclose=null,Ha.onerror=null,Ha.close(),Ha=null);ha=Ta=null;va&&(va.release(),va=null);hi5.browser.isChromeApp?
chrome.runtime.onSuspend.removeListener(n.close):window.removeEventListener("unload",n.close,!1);window&&window.$rdp==n&&(window.$rdp=null);n=null}}}function Zc(a){Ha&&Ja?Ha.close(hi5.appcfg.returnUrl)||(hi5.appcfg.returnUrl=""):Ab(!0)}function Nc(a,b){var d=a.getLittleEndian32();if(0!=(d&16777216))if(b=a.getLittleEndian32(),0!=(d&1073741824)){a.getLittleEndian16();a.getByte();d=a.getByte();var g=a.getLittleEndian16(),c=a.getLittleEndian16(),e=0;16>d&&(e=a.getLittleEndian16());var f=a.getLittleEndian16(),
z=a.getLittleEndian16();a.getBytes(f);e&&a.getBytes(e);if(8<=d&&(e=ha.getFocused())&&e.onremoteappicon){f=new hi5.graphic.Bitmap(g,c,32);a.getPosition();g=new Uint8Array(g*c*4);c=a.getPosition();z=c+z;var x;a=a.getData();for(var t=0,J,C;c<z;)switch(d){case 16:(x=a[c++]|a[c++]<<8)?(C=x>>7&248,J=x>>2&248,x=x<<3&248,C|=C>>5,J|=J>>5,x|=x>>5,g[t++]=x,g[t++]=J,g[t++]=C,g[t++]=255):t+=4;break;case 32:g[t++]=a[c++],g[t++]=a[c++],g[t++]=a[c++],g[t++]=a[c++]}f.putPixels(g,0,g.length);a=ha.getWinById(b);e.onremoteappicon(a,
f)}}else 0!=(d&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(d&536870912)?(svGlobal.logger.info("***** delete winId="+b),ha.delWin(b)):Ud(a,d,b);else if(0!=(d&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+d);else if(0!=(d&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+d),0!=(d&1))svGlobal.logger.info("Desktop non monitored flags="+d);else{if(0!=(d&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+d+" winId="+
b),0<b&&((e=ha.getOwnerSurfaceById(b))&&e.railWin&&e.railWin.setActiveWinId(b,3==ja.windowState),ha.setTitle(b),va.getContext()||(b=ha.getFocused())&&va.setContext(b.context))),0!=(d&16)&&(b=a.getByte(),0<b))for(d=ha.zOrders,d.length=b,e=0;e<b;e++)d[e]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+d[e])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+d)}function $c(a){var b=ha.getFocused();if(b&&b.railWin){var d=a||b.railWin.mainWin;if(d&&2<d.showState){var g=b.getFreeSpace();
a=Math.max(Math.abs(d.winHeight-g.height),Math.abs(d.winWidth-g.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+d._hOffset+" appId:"+d.appId+" spaceH:"+g.height);0<a?(b=a==d._hOffset,d._hOffset&&b||(d._hOffset=a,setTimeout(function(){d.resize(0,0,g.width,g.height)},333))):d._hOffset=0}}}function Ud(a,b,d){Ya||(Ya=!0);var g=0==(b&268435456),c=ha.getWinById(d);c?g=!0:c=new ha.LocalWin(d);svGlobal.logger.info("\n\n=========== winId="+d+" existed="+g);if(c){0!=(b&2)&&(c.ownerWinid=
a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+c.ownerWinid));0!=(b&8)&&(c.style=a.getLittleEndian32(),c.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" style="+c.style+" extStyle="+c.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(c.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(c.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(c.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(c.extStyle&
1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(c.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(c.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(c.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(c.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(c.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(c.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+
(0!=(c.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(c.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(c.extStyle&524288))));if(0!=(b&16)){c.setShowState(a.getByte());svGlobal.logger.info("***** winId="+d+" showState="+c.showState);var e=c.showState;(2==e&&0!=ja.noMinimize||!g&&3==e&&5==ja.windowState)&&setTimeout(function(){c.exeCommand(61728)},50)}if(e=0!=(b&4)){var f=a.getLittleEndian16();
c.titleInfo=a.getUnicodeString(f,!1);svGlobal.logger.info("***** winId="+d+" title="+c.titleInfo)}0!=(b&16384)&&(c.clientOffsetX=a.getLittleEndian32(),c.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" coffX"+c.clientOffsetX+" coffY="+c.clientOffsetY));0!=(b&65536)&&(c.clientAreaWidth=a.getLittleEndian32(),c.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" cw"+c.clientAreaWidth+" ch="+c.clientAreaHeight));0!=(b&131072)&&(c.rpContent=a.getLittleEndian32());
0!=(b&262144)&&(c.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){f=a.getLittleEndian32();var z=a.getLittleEndian32();c.winOffsetX=f;c.winOffsetY=z;svGlobal.logger.info("***** winId="+d+" offX"+c.winOffsetX+" offY="+c.winOffsetY)}0!=(b&32768)&&(c.winClientDeltaX=a.getLittleEndian32(),c.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" dX"+c.winClientDeltaX+" dY="+c.winClientDeltaY));0!=(b&1024)&&(c.winWidth=a.getLittleEndian32(),c.winHeight=a.getLittleEndian32(),
svGlobal.logger.info("***** winId="+d+" w"+c.winWidth+" h="+c.winHeight));if(!g)if(c.isMainWin())3==n.windowState?$c(c):setTimeout(function(){c.activate(1)},666);else if(2<c.showState&&(f=ha.getFocused())){f=f.getFreeSpace();var x=c.winWidth,t=c.winHeight;if(c.winOffsetX>f.width||c.winOffsetY>f.height||0>x+c.winOffsetX||0>t+c.winOffsetY){var J=(f.width-c.winWidth)/2|0,C=(f.height-c.winHeight)/2|0;0>J&&(J=0);0>C&&(C=0);setTimeout(function(){c.resize(J,C,x,t)},50)}}0!=(b&256)&&(f=a.getLittleEndian16(),
0<f&&a.skipPosition(8*f));0!=(b&4096)&&(c.visibleOffsetX=a.getLittleEndian32(),c.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),c.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(g)ha.onWinChange(c);else ha.addWin(c);e&&ha.setTitle(d);d==ha.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+d):svGlobal.logger.info("zzz win: "+d,ha.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+d)}function Ec(a,b){function d(k,m,l,h,q){0<q.width?q.union(k,m,l,h):(q.x=k,q.y=
m,q.width=l,q.height=h)}function g(k,m,l,h){for(W=0;W<U;W++){var q=R[W];if(k>=q[0]&&m>=q[1]&&l<=q[2]&&h<=q[3])return E[W]}return null}function c(k,m,l,h){if(U){var q=g(k,m,k+l-1,m+h-1);q&&d(k,m,l,h,q)}else d(k,m,l,h,X)}function e(k,m,l,h,q,u,D){for(var F=q*l+h,B=k.setRGB,Z=k.getRGB,K=0;K<D;K++){for(var ka=0;ka<u;ka++){if(k){var ua=Z(h+ka,q+K);B(h+ka,q+K,~ua&16777215)}else m[F]=~m[F]&16777215;F++}F+=l-u}}function f(k,m,l,h,q,u,D,F,B,Z){m=Z*F+B;null==D&&(D=k);for(k=0;k<u;k++){for(B=0;B<q;B++)w[h+k][l+
B]=w[h+k][l+B]&D[m]&16777215|4278190080,m++;m+=F-q}}function z(k,m,l,h,q,u,D,F,B,Z){m=Z*F+B;B=k.setRGB;Z=k.getRGB;null==D&&(D=k);for(k=0;k<u;k++){for(var K=0;K<q;K++){var ka=Z(l+K,h+k);B(l+K,h+k,ka|D[m]&16777215);m++}m+=F-q}}function x(k,m,l,h){var q=Y;if(q){var u=q.getRGB(m,l);switch(k){case 0:q.setRGB(m,l,0);break;case 1:q.setRGB(m,l,~(u|h)&16777215);break;case 2:q.setRGB(m,l,u&~h&16777215);break;case 3:q.setRGB(m,l,~h&16777215);break;case 4:q.setRGB(m,l,16777215*(~u&h));break;case 5:q.setRGB(m,
l,~u&16777215);break;case 6:q.setRGB(m,l,u^h&16777215);break;case 7:q.setRGB(m,l,~u&h&16777215);break;case 8:q.setRGB(m,l,u&h&16777215);break;case 9:q.setRGB(m,l,u^~h&16777215);break;case 10:break;case 11:q.setRGB(m,l,u|~h&16777215);break;case 12:q.setRGB(m,l,h);break;case 13:q.setRGB(m,l,(~u|h)&16777215);break;case 14:q.setRGB(m,l,u|h&16777215);break;case 15:q.setRGB(m,l,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+k),q.setRGB(m,l,h)}}}function t(k,m,l,h,q,u,D,F,B){k>
F||m>B||(l=k+l-1,l>F&&(l=F),k<u&&(k=u),l=l-k+1,h=m+h-1,h>B&&(h=B),m<D&&(m=D),h=h-m+1,1>l||1>h||Y.fillRect(k,m,l,h,q))}function J(k,m,l,h,q,u,D,F,B,Z,K,ka){if(!(m>K||l>ka)){var ua=m+h-1;ua>K&&(ua=K);B=m<B?B:m;ua=ua-m+1;K=l+q-1;K>ka&&(K=ka);Z=l<Z?Z:l;ka=K-l+1;if(!(1>ua||1>ka)){K=128;var p=0;D|=4278190080;F|=4278190080;if(B==m&&Z==l&&ua==h&&ka==q)if(0==k)for(var G=0;G<q;G++){k=l+G;for(var M=0;M<h;M++)0==K&&(p++,K=128),0!=(u[p]&K)&&(w[k][m+M]=F),K>>=1;p++;K=128;p==u.length&&(p=0)}else for(G=0;G<q;G++){k=
l+G;for(M=0;M<h;M++)0==K&&(p++,K=128),w[k][m+M]=0!=(u[p]&K)?F:D,K>>=1;p++;K=128;p==u.length&&(p=0)}else if(0==k)for(G=0;G<ka;G++){k=l+G;for(M=0;M<ua;M++)0==K&&(p++,K=128),m+M>=B&&k>=Z&&0!=(u[p]&K)&&(w[k][m+M]=F),K>>=1;p++;K=128;p==u.length&&(p=0)}else for(G=0;G<ka;G++){k=l+G;for(M=0;M<ua;M++)0==K&&(p++,K=128),m+M>=B&&l+G>=Z&&(w[k][m+M]=0!=(u[p]&K)?F:D),K>>=1;p++;K=128;p==u.length&&(p=0)}}}}function C(k,m,l,h,q){this.offset=k;this.baseLine=m;this.width=l;this.height=h;this.fontData=q}function A(k,
m,l,h,q,u,D,F,B){this.cache_idx=k;this.rawData=m;this.none=!m;this.hotX=l;this.hotY=h;this.width=q;this.height=u;this.xorSize=F;this.andSize=B;this.result="";this.distance=0;this.bpp=D;this.system="";if(m){if(!this.distance){k=0;if(m){D=0;for(var Z=m.length;D<Z;D++)0!=m[D]&&(k+=D%q+(D/q|0))}this.distance=k}if(!this.system){a:switch(this.distance){case 507:k="text";break a;case 2046:case 4359:k="default";break a;default:k=""}this.system=k}}k="";if(!this.system&&m){D=q*u*4;k=62+D+F+B;Z=new Uint8Array(k);
k=new hi5.DataBuffer(Z,0,k);k.setLittleEndian16(0);k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(q);k.setByte(u);k.setByte(0);k.setByte(0);k.setLittleEndian16(l);k.setLittleEndian16(h);k.setLittleEndian32(40+D+F+B);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(q);k.setLittleEndian32(2*u);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(F+B);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);
for(l=u-1;0<=l;l--)for(h=0;h<q;h++)u=m[q*l+h],k.setByte(u&255),k.setByte(u>>8&255),k.setByte(u>>16&255),k.setByte(u>>24&255);k="data:image/x-icon;base64,"+hi5.Base64.enc(k.getData())}this.url=k}var w=[],v=null,X=new hi5.graphic.Rectangle(0,0,0,0),y="Uint8ClampedArray"in window,ba=null,O=0,P=0,N=0,ma=0,qa=null,R,E,W=0,U=0;this.width=a;this.height=b;var L=!1,Y=this,T={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(k){ba=k};this.getDirtyArea=function(){return X};this.setImgRect=
function(k,m,l,h){O=k;P=m;N=l;ma=h};this.parseMonitorDef=function(k){var m=k.split(","),l=m.length,h=[];if(1<l){for(var q=!1,u=0;u<l;u++){var D=m[u].split(":");if(4==D.length)h[u]=Array(5),h[u][0]=parseInt(D[0]),h[u][1]=parseInt(D[1]),h[u][2]=parseInt(D[2]),h[u][3]=parseInt(D[3]),h[u][4]=0==h[u][0]&&0==h[u][1]?1:0;else{q=!0;break}}q&&(svGlobal.logger.warn("invaiid monitorDef:"+k),h.length=0)}return h};this.setMonitorLayout=function(k){var m=k.length,l=0;R=k;for(E=Array(m);l<m;l++)E[l]=new hi5.graphic.Rectangle(0,
0,0,0);U=m};this.setMonitorCount=function(k){U=k};this.addImg=function(k){N&&(qa&&URL.revokeObjectURL(qa.src),qa=k)};this.flushImgs=function(){qa&&(URL.revokeObjectURL(qa.src),qa=null,N=0)};this.getData=function(){return w};this.pause=function(k,m){L=k;m&&v&&v.fillRect(0,0,a,b)};this.release=function(){X=null;hi5.Arrays.release(E);Y.flushImgs();w=v=Y=null;T=T.imgData=null};this.isPaused=function(){return L};this.setContext=function(k){k!=v&&(v||!k||k.createImageData(1,1).data.buffer||(y=!1),v=k,null!=
v&&(T.imgData=v.createImageData(a,b)))};this.getContext=function(){return v};this.resize=function(k,m){if(w.length!=m||w[0].length!=k){for(var l=0;l<m;l++)w[l]=new Uint32Array(k);w.length=m;Y.width=a=k;Y.height=b=m;null!=v&&(T.imgData=v.createImageData(a,b))}};Y.resize(a,b);this.getBuffer=function(){return w};this.setRGB=function(k,m,l){w[m][k]=l|4278190080};this.getRGB=function(k,m){return w[m][k]};this.setRGBs=function(k,m,l,h,q,u,D){var F=k+l,B=m+h;B>b&&(B=b);if(!(k>=a)){F>a&&(l-=F-a);for(F=m;F<
B;F++,u+=D)w[F].set(q.subarray(u,u+l),k);c(k,m,l,h)}};this.moveArea=function(k,m,l,h,q,u){if(0<u){var D=k+q,F=m+u,B;for(B=h-1;0<=B;B--)w[F+B].set(w[m+B].subarray(k,k+l),D)}else if(0>u)for(D=k+q,F=m+u,B=0;B<h;B++)w[F+B].set(w[m+B].subarray(k,k+l),D);else if(0<q){D=k+q;F=m+u;var Z;for(B=l-1;0<=B;B--){var K=D+B;var ka=k+B;for(Z=0;Z<h;Z++)w[F+Z][K]=w[m+Z][ka]}}else for(D=k+q,F=m+u,B=0;B<l;B++)for(K=D+B,ka=k+B,Z=0;Z<h;Z++)w[F+Z][K]=w[m+Z][ka];c(k+q,m+u,l,h)};this.getRGBs=function(k,m,l,h,q){var u=new Uint32Array(l*
h),D=k+l;h=m+h;for(var F=0;m<h;m++)u.set(w[m].subarray(k,D),F),F+=l;return q?(q(u),null):u};this.repaint=function(k,m,l,h){var q=T.imgData.data,u=0,D,F;ba&&ba.begin("paint");0>k&&(l+=k,k=0);0>m&&(h+=m,m=0);k+l>a&&(l=a-k);m+h>b&&(h=b-m);var B=k+l;var Z=m+h;if(y)for(q=new Uint32Array(q.buffer),F=m;F<Z;F++)q.set(w[F].subarray(k,B),u),u+=a;else{var K=4*(a-l)|0;for(F=m;F<Z;F++){for(D=k;D<B;D++){var ka=w[F][D];q[u++]=ka&255;q[u++]=ka>>8&255;q[u++]=ka>>16&255;q[u++]=255}u+=K}}T.left=k;T.top=m;T.width=l;
T.height=h;ba&&ba.end("paint");return T};this.postPaint=c;this.draw=function(k,m,l,h){if(!L&&v)if(qa&&qa.complete&&(v.drawImage(qa,O,P,N,ma),URL.revokeObjectURL(qa.src),qa=null),U){if(k=g(k,m,l,h),k.width)return Y.repaint(k.x,k.y,k.width,k.height),k.width=0,T}else if(X.width)return Y.repaint(X.x,X.y,X.width,X.height),X.width=0,T;return null};this.fillRect=function(k,m,l,h,q){var u=k+l,D=m+h;if(w[0].fill)for(var F,B=m;B<D;B++)w[B].fill(q,k,u);else for(B=m;B<D;B++)for(F=k;F<u;F++)w[B][F]=q;c(k,m,l,
h)};this.drawLine=function(k,m,l,h,q){if(m==h){if(k>l){var u=k;k=l;l=u}var D=w[m];l++;if(D.fill)D.fill(q,k,l);else for(u=k;u<l;u++)D[u]=q}else if(k==l)for(m>h&&(u=m,m=h,h=u),h++,u=m;u<h;u++)w[u][k]=q;else{var F=Math.abs(l-k),B=Math.abs(h-m);u=k;D=m;l=l>=k?k=1:k=-1;m=h>=m?h=1:h=-1;if(F>=B){m=k=0;var Z=F;var K=F/2|0;var ka=B}else h=l=0,Z=B,K=B/2|0,ka=F,F=B;if(!(1>F))for(F++,B=0;B<F;B++)w[D][u]=q,K+=ka,K>=Z&&(K-=Z,u+=k,D+=h),u+=l,D+=m}};this.bitBlt=function(k,m,l,h,q,u,D,F,B,Z){var K=Y;switch(k){case 0:F=
K.setRGB;for(K=l;K<l+q;K++)for(B=h;B<h+u;B++)F(K,B,0);break;case 1:k=D;B=Z*F+B;Z=K.setRGB;m=K.getRGB;null==k&&(k=K);for(K=0;K<u;K++){for(D=0;D<q;D++)Z(l+q,h+u,~(m(l+q,h+u)|k[B])&16777215);B+=F-q}break;case 2:k=D;B=Z*F+B;Z=K.setRGB;m=K.getRGB;null==k&&(k=K);for(K=0;K<u;K++){for(D=0;D<q;D++){var ka=m(l+q,h+u);Z(l+q,h+u,ka&~k[B]&16777215);B++}B+=F-q}break;case 3:e(K,D,F,B,Z,q,u);D?K.setRGBs(l,h,q,u,D,Z*F+B,F):K.moveArea(B,Z,q,u,l-B,h-Z);break;case 4:e(K,null,m,l,h,q,u);f(K,m,l,h,q,u,D,F,B,Z);break;case 5:e(K,
null,m,l,h,q,u);break;case 6:k=D;B=Z*F+B;null==k&&(k=K);for(K=0;K<u;K++){for(Z=0;Z<q;Z++)w[h+K][l+Z]=w[h+K][l+Z]^k[B]&16777215|4278190080,B++;B+=F-q}break;case 7:k=D;B=Z*F+B;Z=K.setRGB;m=K.getRGB;null==k&&(k=K);for(K=0;K<u;K++){for(D=0;D<q;D++)ka=m(l+D,h+K),Z(l+D,h+K,~(ka&k[B])&16777215),B++;B+=F-q}break;case 8:f(K,m,l,h,q,u,D,F,B,Z);break;case 9:k=D;B=Z*F+B;Z=K.setRGB;m=K.getRGB;null==k&&(k=K);for(K=0;K<u;K++){for(D=0;D<q;D++)ka=m(l+D,h+K),Z(l+D,h+K,ka^~k[B]&16777215),B++;B+=F-q}break;case 10:break;
case 11:k=D;B=Z*F+B;Z=K.setRGB;m=K.getRGB;null==k&&(k=K);for(K=0;K<u;K++){for(D=0;D<q;D++)ka=m(l+D,h+K),Z(l+D,h+K,ka|~k[B]&16777215),B++;B+=F-q}break;case 12:D?K.setRGBs(l,h,q,u,D,Z*F+B,F):K.moveArea(B,Z,q,u,l-B,h-Z);break;case 13:e(K,null,m,l,h,q,u);z(K,m,l,h,q,u,D,F,B,Z);break;case 14:z(K,m,l,h,q,u,D,F,B,Z);break;case 15:F=K.setRGB;for(K=l;K<l+q;K++)for(B=h;B<h+u;B++)F(K,B,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+k)}c(l,h,q,u)};this.drawLineExt=function(k,m,l,h,q,u){if(k==
l||m==h){var D;if(m==h)if(l>k){var F=l-k;if(!(1>F))for(D=0;D<F;D++)x(u,k+D,m,q)}else{if(F=k-l,!(1>F))for(D=0;D<F;D++)x(u,l+D,m,q)}else if(h>m){if(F=h-m,!(1>F))for(D=0;D<F;D++)x(u,k,m+D,q)}else if(F=m-h,!(1>F))for(D=0;D<F;D++)x(u,k,h+D,q)}else{var B=Math.abs(l-k),Z=Math.abs(h-m);D=k;F=m;var K,ka;var ua=l>=k?K=1:K=-1;var p=h>=m?ka=1:ka=-1;if(B>=Z){p=K=0;var G=B;var M=B/2>>0;var aa=Z}else ka=ua=0,G=Z,M=Z/2>>0,aa=B,B=Z;if(1>B)return;for(Z=0;Z<=B;Z++)x(u,D,F,q),M+=aa,M>=G&&(M-=G,D+=K,F+=ka),D+=ua,F+=p}q=
Math.min(k,l);k=Math.max(k,l);l=Math.min(m,h);m=Math.max(m,h);0>k-q||0>m-l||c(q,l,k-q+1,m-l+1)};this.drawText=function(k,m,l,h,q,u,D,F,B,Z,K,ka,ua,p,G,M,aa,na,ta,ya,Ca){var Aa=0;1<ka?t(Z,K,ka,ua,q,na,ta,ya,Ca):1==l&&t(u,D,F,B,q,na,ta,ya,Ca);for(var Da=M,wa=0;wa<M;)switch(aa[Aa+wa]){case 255:var Ga=aa[Aa+wa+2];if(Ga>Da-Aa){wa=M=0;break}Ga=aa.slice?aa.slice(Aa,Aa+Ga):aa.subarray(Aa,Aa+Ga);da[aa[Aa+wa+1]]=Ga;wa+=3;M-=wa;Aa=wa;wa=0;break;case 254:var Qa=(Ga=da[aa[Aa+wa+1]])?Ga:null;Qa&&0==Qa[1]&&0==(m&
32)&&(0!=(m&4)?G+=aa[Aa+wa+2]:p+=aa[Aa+wa+2]);wa=wa+2<M?wa+3:wa+2;M-=wa;Aa=wa;wa=0;if(!Qa)break;for(var Va=Qa.length,Ka=0;Ka<Va;Ka++){Ga=Q.getFont(k,Qa[Ka]);if(0==(m&32)){var Oa=Qa[++Ka];0!=(Oa&128)?(0!=(m&4)?G+=Qa[Ka+1]|Qa[Ka+2]<<8:p+=Qa[Ka+1]|Qa[Ka+2]<<8,Ka+=2):0!=(m&4)?G+=Oa:p+=Oa}Ga&&(J(l,p+Ga.offset&65535,G+Ga.baseLine&65535,Ga.width,Ga.height,Ga.fontData,q,h,na,ta,ya,Ca),0!=(m&32)&&(p+=Ga.width))}break;default:Ga=Q.getFont(k,aa[Aa+wa]),0==(m&32)&&(Oa=aa[Aa+ ++wa],0!=(Oa&128)?(0!=(m&4)?G+=aa[Aa+
wa+1]|aa[Aa+wa+2]<<8:p+=aa[Aa+wa+1]|aa[Aa+wa+2]<<8,wa+=2):0!=(m&4)?G+=Oa:p+=Oa),Ga&&(J(l,p+Ga.offset&65535,G+Ga.baseLine&65535,Ga.width,Ga.height,Ga.fontData,q,h,na,ta,ya,Ca),0!=(m&32)&&(p+=Ga.width)),wa++}1<ka?0<ua&&c(Z,K,ka,ua):0<F&&0<B&&c(u,D,F,B)};this.drawBitmap=function(k,m,l,h,q,u,D,F,B){var Z=ra.getBitmap(k,m);Z?(k=Z.width,m=Z.height,q>k&&(q=k),u>m&&(u=m),12==B?Y.setRGBs(l,h,q,u,Z.data,F*k+D,k):Y.bitBlt(B,a,l,h,q,u,Z.data,k,D,F)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
k+" idx="+m)};this.saveDesktop=function(k,m,l,h,q){Y.getRGBs(k,m,l,h,function(u){ia.save(k,m,l,h,q,u)})};this.restoreDesktop=function(k,m,l,h,q){(q=ia.restore(k,m,l,h,q))?Y.setRGBs(k,m,l,h,q,0,l):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(k,m,l){Q.putFont(k,m,l)};this.putBitmap=function(k,m,l){ra.putBitmap(k,m,l)};this.putCursor=function(k,m){pa.set(k,m)};this.setCursor=function(k){if(!L&&-1!=k){var m=pa.get(k);if(m)Y.onSetCursor(m);else svGlobal.logger.warn("invalid cursor"+
k)}};var ca=0;this.isSendingHistory=function(){return 2E3>Date.now()-ca};this.getHistory=function(k,m,l){var h=null;(h=pa.toPDU(k))&&m(h.buffer);if(Y.onGetGfxHistory)Y.onGetGfxHistory(k,m,l);else{ba&&ba.begin("his_bitmap");ra.forEach(function(B,Z,K){if(B){var ka=0,ua=0;K=0;for(var p=B.length;K<p;K++)B[K]&&B[K].data&&(ka++,ua+=B[K].raw?B[K].raw.length:4*B[K].data.length);if(ka&&ua){h=new Uint8Array(ua+20*ka+8);h[0]=k;h[2]=1;h[3]=4;ua=new hi5.DataBuffer(h,4,h.length);ua.setLittleEndian32(ka);for(K=
0;K<p;K++)(ka=B[K])&&ka.data&&(ua.setLittleEndian16(Z),ua.setLittleEndian16(K),ua.setLittleEndian16(ka.left),ua.setLittleEndian16(ka.top),ua.setLittleEndian16(ka.width),ua.setLittleEndian16(ka.height),ua.setLittleEndian16(ka.bitsperpixel),ua.setLittleEndian16(ka.codec),ua.setLittleEndian32(ka.raw?ka.raw.length:4*ka.data.length),ua.setBytes(ka.raw||new Uint8Array(ka.data.buffer)));m(h.buffer)}}});ba&&ba.end("his_bitmap");ba&&ba.begin("his_font");(h=Q.toPDU(k))&&m(h.buffer);ba&&ba.end("his_font");for(var q=
4,u=0,D=da.length;u<D;u++)da[u]&&(q+=da[u].length+6);if(4<q){h=new Uint8Array(q);h[0]=k;h[2]=1;h[3]=7;var F=4;u=0;for(D=da.length;u<D;u++)da[u]&&da[u].length&&(h[F++]=u,h[F++]=u>>8,q=da[u].length,h[F++]=q,h[F++]=q>>8,h[F++]=q>>16,h[F++]=q>>24,h.set(da[u],F),F+=q);m(h.buffer)}(h=ia.toPDU(k))&&m(h.buffer);l(k);ca=Date.now()}};this.onHistoryDone=function(){Y.onGetGfxHistory&&n.reconnect(a,b,!0)};this.setHistory=function(k,m){svGlobal.logger.info("setHistory type:"+k);switch(k){case 4:ba&&ba.begin("his_bitmap_dec");
var l=m.getLittleEndian32();for(k=0;k<l;k++){var h=m.getLittleEndian16(),q=m.getLittleEndian16(),u=m.getLittleEndian16(),D=m.getLittleEndian16(),F=m.getLittleEndian16(),B=m.getLittleEndian16(),Z=m.getLittleEndian16(),K=m.getLittleEndian16(),ka=m.getLittleEndian32(),ua=new Uint8Array(m.getData().buffer,m.getPosition(),ka),p=new Uint8Array(ka);p.set(ua);ua=rdpcodecs.bitmap;switch(K){case 0:var G=new Uint32Array(p.buffer);m.skipPosition(ka);break;case 1:switch(Z){case 16:G=ua.decompressInt16(F,B,ka,
p,0);break;case 24:G=ua.decompressInt24(F,B,ka,p,0);break;case 32:G=ua.decompressInt32(F,B,ka,p,0)}m.skipPosition(ka);break;case 2:G=new rdpcodecs.NSCodec,G.process(m,Z,F,B),ka=G.getData(),G=G.getDataSize(),G=new Uint32Array(G),rdpcodecs.flipimage(ka,0,G,F,B,1)}ra.putBitmap(h,q,new rdpcodecs.Bitmap(G,F,B,u,D,Z,0==K?null:p,K))}ba&&ba.end("his_bitmap_dec");break;case 5:Q.fromStream(m);break;case 6:pa.fromStream(m);break;case 7:for(;m.has(6);)if(k=m.getLittleEndian16(),ka=m.getLittleEndian32())l=m.getData().subarray(m.getPosition(),
m.getPosition()+ka),da[k]=l,m.skipPosition(ka);break;case 9:ia.fromStream(m);break;default:if(Y.onSetGfxHistory)Y.onSetGfxHistory(k,m)}};var pa=new function(){var k=[],m=!1;this.useRemoteCursor=function(l){m=l};this.set=function(l,h){m&&(h.system="");k[l]=h};this.get=function(l){return k[l]};this.total=function(){return k.length};this.toPDU=function(l){for(var h=2,q=2,u=0,D=0,F=k.length,B;D<F;D++)if(B=k[D])u++,q=q+7+(B.rawData?B.rawData.length:0);if(!u)return null;q=new Uint32Array(q);q[0]=30==l?
100728862:100728861;q[1]=u;for(D=0;D<F;D++)if(B=k[D])if(l=B.rawData?B.rawData.length:0,q[h++]=B.cache_idx|B.bpp<<16,q[h++]=B.hotX|B.hotY<<16,q[h++]=B.width|B.height<<16,q[h++]=B.xorSize,q[h++]=B.andSize,q[h++]=B.distance,q[h++]=l)q.set(B.rawData,h),h+=l;return q};this.fromStream=function(l){var h=l.getPosition();l=new Uint32Array(l.getData().buffer,h);var q=l[0],u=0;for(h=1;u<q;u++){var D=l[h]&65535;var F=l[h++]>>16;var B=l[h]&65535;var Z=l[h++]>>16;var K=l[h]&65535;var ka=l[h++]>>16;var ua=l[h++];
var p=l[h++];var G=l[h++];var M=l[h++];var aa=null;M&&(aa=new Uint32Array(M),aa.set(l.subarray(h,h+M)),h+=M);F=new A(D,aa,B,Z,K,ka,F,ua,p);G&&(F.distance=G);m&&(F.system="");k[D]=F}}};pa.useRemoteCursor(!!ja.remoteCursor);var ia=new function(){function k(l,h,q,u,D,F){this.x=l;this.y=h;this.cx=q;this.cy=u;this.offset=D;this.data=F}var m=[];this.save=function(l,h,q,u,D,F){l=new k(l,h,q,u,D,F);h=0;for(q=m.length;h<q;h++)if(!m[h]){m[h]=l;return}m.push(l)};this.restore=function(l,h,q,u,D){for(var F,B=
0,Z=m.length;B<Z;B++)if((F=m[B])&&F.x==l&&F.y==h&&F.cx==q&&F.cy==u){if(F.offset==D)return l=F.data,m[B]=null,l;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(l){for(var h=0,q=2,u=0,D=m.length;u<D;u++)m[u]&&(h++,q+=m[u].data.length+6);if(!h||!q)return null;q=new Uint32Array(q);var F=2;q[0]=30==l?151060510:151060509;q[1]=h;for(u=0;u<D;u++)if(l=m[u])q[F++]=l.x,q[F++]=l.y,q[F++]=l.cx,q[F++]=l.cy,q[F++]=l.offset,q[F++]=l.data.length,q.set(l.data,F),F+=l.data.length;return q};this.fromStream=
function(l){l=new Uint32Array(l.getData().buffer,l.getPosition());for(var h=1,q=l[0],u,D,F,B,Z,K,ka,ua=0;ua<q;ua++)u=l[h++],D=l[h++],F=l[h++],B=l[h++],Z=l[h++],K=l[h++],ka=new Uint32Array(K),K=h+K,ka.set(l.subarray(h,K)),h=K,this.save(u,D,F,B,Z,ka)}},da=[],Q=new function(){var k=[];this.putFont=function(m,l,h){k[m]||(k[m]=[]);k[m][l]=h};this.getFont=function(m,l){return k[m]?k[m][l]:null};this.toPDU=function(m){var l=0,h,q,u;var D=4;for(var F,B=k.length;l<B;l++)if((u=k[l])&&u.length)for(F=u.length,
h=0;h<F;h++)(q=u[h])&&(D+=15+q.fontData.length);if(5>D)return null;var Z=new Uint8Array(D);D=new hi5.DataBuffer(Z,0,D);Z[0]=m;Z[2]=1;Z[3]=5;D.skipPosition(4);l=0;for(B=k.length;l<B;l++)if((u=k[l])&&u.length)for(F=u.length,h=0;h<F;h++)if(q=u[h])D.setByte(l),D.setLittleEndian16(h),D.setLittleEndian16(q.offset),D.setLittleEndian16(q.baseLine),D.setLittleEndian16(q.width),D.setLittleEndian16(q.height),D.setLittleEndian32(q.fontData.length),D.setBytes(q.fontData);return Z};this.fromStream=function(m){for(;m.has(15);){var l=
m.getByte(),h=m.getLittleEndian16(),q=m.getLittleEndian16(),u=m.getLittleEndian16(),D=m.getLittleEndian16(),F=m.getLittleEndian16(),B=m.getLittleEndian32();B=m.getBytes(B);this.putFont(l,h,new C(q,u,D,F,B))}}},ra=new function(){var k=[],m=[];this.putBitmap=function(l,h,q){if(32767==h)m[l]&&(m[l].data=null,m[l]=null),m[l]=q;else{var u=k[l];u?u[h]&&(u[h].data=null,u[h]=null):k[l]=u=[];u[h]=q}};this.getBitmap=function(l,h){return 32767==h?m[l]:k[l]?k[l][h]:null};this.forEach=function(l){for(var h=k.length,
q=0;q<h;q++)l(k[q],q,k)}}}function Pb(a){function b(p,G,M){G[M]=p>>24;G[M+1]=p>>16;G[M+2]=p>>8;G[M+3]=p}function d(p,G){var M=p.length;G=new Uint8Array(G?M+1:M);for(var aa=0;aa<M;aa++)G[aa]=p.charCodeAt(aa);return G}var g=new Uint8Array([0,0,0,0]),c=new Uint8Array([255,255,255,255]),e={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],
traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},f=this,z=1,x=a?48E3:9E4,t=1,J=!1,C=null;this.initTypes=function(){for(var p in e)e[p]=[p.charCodeAt(0),p.charCodeAt(1),p.charCodeAt(2),p.charCodeAt(3)];e.url=[117,114,108,32]};f.initTypes();this.reset=function(){J=!1;t=z=1};this.close=function(){f&&(f.reset(),f=null)};this.remux=function(p){p.id=z;p.isAudio=a;p.timeScale=a?p.audioHeader.sampleRate:x;if(!J){var G=new w(a),M=new v(p);C=new Uint8Array(G.data.length+M.data.length);C.set(G.data,
0);C.set(M.data,G.data.length);J=!0}p.sequenceNumber=t++;G=new q(p);M=new ua(p);p=new Uint8Array(G.data.length+M.data.length);p.set(G.data,0);p.set(M.data,G.data.length);C&&(G=new Uint8Array(C.length+p.length),G.set(C,0),G.set(p,C.length),p=G,C=null);if(f.ondata)f.ondata(p)};var A=function(p){this.type=p;this.data=null};A.prototype.setData=function(){var p=Array.prototype.slice.call(arguments,0),G=p.length,M=8,aa;for(aa=0;aa<G;aa++)M+=p[aa].byteLength;this.data=new Uint8Array(M);b(M,this.data,0);
this.data.set(this.type,4);M=8;for(aa=0;aa<G;aa++)this.data.set(p[aa],M),M+=p[aa].byteLength};var w=function(p){var G=A.call(this,e.ftyp)||this;var M=d("mp42"),aa=d("mp41"),na=d("isom"),ta=d("avc1"),ya=d("iso5"),Ca=new Uint8Array([0,0,2,0]);p?G.setData(M,Ca,M,aa,na,ya):G.setData(na,Ca,na,aa,ya,ta);return G};$jscomp.inherits(w,A);var v=function(p){var G=A.call(this,e.moov)||this;var M=new X(p),aa=new y(p);p=new l(p);G.setData(M.data,aa.data,p.data);return G};$jscomp.inherits(v,A);var X=function(p){p=
A.call(this,e.mvhd)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0,0,0]),na=new Uint8Array([0,0,0,0]),ta=new Uint8Array(4);b(1E3,ta,0);var ya=new Uint8Array([0,1,0,0]),Ca=new Uint8Array([1,0]),Aa=new Uint8Array(10),Da=new Uint8Array(36);Da[1]=1;Da[17]=1;Da[32]=64;var wa=new Uint8Array(24),Ga=new Uint8Array([255,255,255,255]);p.setData(G,M,aa,na,ta,g,ya,Ca,Aa,Da,wa,Ga);return p};$jscomp.inherits(X,A);var y=function(p){var G=A.call(this,e.trak)||this;var M=new ba(p);
p=new O(p);G.setData(M.data,p.data);return G};$jscomp.inherits(y,A);var ba=function(p){var G=A.call(this,e.tkhd)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,7]),na=new Uint8Array([0,0,0,0]),ta=new Uint8Array([0,0,0,0]),ya=new Uint8Array(4);b(p.id,ya,0);var Ca=new Uint8Array(4),Aa=new Uint8Array(8),Da=new Uint8Array([0,0]),wa=new Uint8Array([0,0]),Ga=p.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),Qa=new Uint8Array(2),Va=new Uint8Array(36);Va[1]=1;Va[17]=1;Va[32]=64;var Ka=new Uint8Array(4);
Ka[0]=p.width>>8&255;Ka[1]=p.width&255;Ka[2]=0;Ka[3]=0;var Oa=new Uint8Array(4);Oa[0]=p.height>>8&255;Oa[1]=p.height&255;Oa[2]=0;Oa[3]=0;G.setData(M,aa,na,ta,ya,Ca,g,Aa,Da,wa,Ga,Qa,Va,Ka,Oa);return G};$jscomp.inherits(ba,A);var O=function(p){var G=A.call(this,e.mdia)||this;var M=new P(p),aa=new N(p);p=new ma(p);G.setData(M.data,aa.data,p.data);return G};$jscomp.inherits(O,A);var P=function(p){var G=A.call(this,e.mdhd)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array([0,
0,0,0]),ta=new Uint8Array([0,0,0,0]),ya=new Uint8Array(4);b(p.timeScale,ya,0);p=new Uint8Array([85,196]);var Ca=new Uint8Array(2);G.setData(M,aa,na,ta,ya,g,p,Ca);return G};$jscomp.inherits(P,A);var N=function(p){var G=A.call(this,e.hdlr)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array(4);p=p.isAudio?d("soun"):d("vide");var ta=new Uint8Array(12),ya=d("Remote Spark Handler",!0);G.setData(M,aa,na,p,ta,ya);return G};$jscomp.inherits(N,A);var ma=function(p){var G=A.call(this,
e.minf)||this;var M=new E,aa=new L(p);p.isAudio?(p=new R,G.setData(p.data,M.data,aa.data)):(p=new qa,G.setData(p.data,M.data,aa.data));return G};$jscomp.inherits(ma,A);var qa=function(){var p=A.call(this,e.vmhd)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,1]),aa=new Uint8Array([0,0]),na=new Uint8Array(6);p.setData(G,M,aa,na);return p};$jscomp.inherits(qa,A);var R=function(){var p=A.call(this,e.smhd)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0]),na=new Uint8Array(2);
p.setData(G,M,aa,na);return p};$jscomp.inherits(R,A);var E=function(){var p=A.call(this,e.dinf)||this;var G=new W;p.setData(G.data);return p};$jscomp.inherits(E,A);var W=function(){var p=A.call(this,e.dref)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0,0,1]),na=new U;p.setData(G,M,aa,na.data);return p};$jscomp.inherits(W,A);var U=function(){var p=A.call(this,e.url)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,1]);p.setData(G,M);return p};$jscomp.inherits(U,
A);var L=function(p){var G=A.call(this,e.stbl)||this;p=new Y(p);var M=new Q,aa=new ra,na=new k,ta=new m;G.setData(p.data,M.data,aa.data,na.data,ta.data);return G};$jscomp.inherits(L,A);var Y=function(p){var G=A.call(this,e.stsd)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array([0,0,0,1]);p.isAudio?(p=new T(p),G.setData(M,aa,na,p.data)):(p=new pa(p),G.setData(M,aa,na,p.data));return G};$jscomp.inherits(Y,A);var T=function(p){var G=A.call(this,e.mp4a)||this;var M=new Uint8Array(6),
aa=new Uint8Array([0,1]),na=new Uint8Array(8),ta=new Uint8Array([0,2]),ya=new Uint8Array([0,16]),Ca=new Uint8Array([0,0]),Aa=new Uint8Array(2),Da=p.audioHeader.sampleRate,wa=new Uint8Array(4);wa[0]=Da>>8&255;wa[1]=Da&255;wa[2]=0;wa[3]=0;p=new ca(p);G.setData(M,aa,na,ta,ya,Ca,Aa,wa,p.data);return G};$jscomp.inherits(T,A);var ca=function(p){var G=A.call(this,e.esds)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array([3]),ta=new Uint8Array([25]),ya=new Uint8Array([0,0]),Ca=
new Uint8Array([0]),Aa=new Uint8Array([4]),Da=new Uint8Array([17]),wa=new Uint8Array([64]),Ga=new Uint8Array([21]),Qa=new Uint8Array(3),Va=p.bufferSizeDB;Qa[0]=Va>>16;Qa[1]=Va>>8;Qa[2]=Va;var Ka=p.audioHeader.avgBitRate|96E3,Oa=p.audioHeader.maxBitRate|1.2*Ka|0;Va=new Uint8Array(4);b(Oa,Va,0);Oa=new Uint8Array(4);b(Ka,Oa,0);Ka=new Uint8Array([5]);var Eb=new Uint8Array([2]),wb=p.audioHeader.audioType||2,rb=p.audioHeader.frequencyIdx,bb=p.audioHeader.channelConfig;p=new Uint8Array(2);p[0]=wb<<3|rb>>
1&7;p[1]=(rb&1)<<7|bb<<3;wb=new Uint8Array([6]);rb=new Uint8Array([1]);bb=new Uint8Array([2]);G.setData(M,aa,na,ta,ya,Ca,Aa,Da,wa,Ga,Qa,Va,Oa,Ka,Eb,p,wb,rb,bb);return G};$jscomp.inherits(ca,A);var pa=function(p){var G=A.call(this,e.avc1)||this;var M=new Uint8Array(6),aa=new Uint8Array([0,1]),na=new Uint8Array([0,0]),ta=new Uint8Array(2),ya=new Uint8Array(12),Ca=new Uint8Array(2);Ca[0]=p.width>>8&255;Ca[1]=p.width&255;var Aa=new Uint8Array(2);Aa[0]=p.height>>8&255;Aa[1]=p.height&255;var Da=new Uint8Array([0,
72,0,0]),wa=new Uint8Array([0,72,0,0]),Ga=new Uint8Array(4),Qa=new Uint8Array([0,1]),Va=d("SparkStreamPlayer"),Ka=new Uint8Array(32);Ka[0]=Va.length;Ka.set(Va,1);Va=new Uint8Array([0,24]);var Oa=new Uint8Array([255,255]);p=new ia(p);G.setData(M,aa,na,ta,ya,Ca,Aa,Da,wa,Ga,Qa,Ka,Va,Oa,p.data);return G};$jscomp.inherits(pa,A);var ia=function(p){var G=A.call(this,e.avcC)||this;var M=new Uint8Array([1]),aa=new Uint8Array([p.sps[1]]),na=new Uint8Array([p.sps[2]]),ta=new Uint8Array([p.sps[3]]),ya=new Uint8Array([255]),
Ca=new Uint8Array([225]),Aa=new Uint8Array(2),Da=p.sps.byteLength;Aa[0]=Da>>8;Aa[1]=Da;Da=new Uint8Array(p.sps);var wa=new Uint8Array([1]),Ga=new Uint8Array(2),Qa=p.pps.byteLength;Ga[0]=Qa>>8;Ga[1]=Qa;p=new Uint8Array(p.pps);G.setData(M,aa,na,ta,ya,Ca,Aa,Da,wa,Ga,p);return G};$jscomp.inherits(ia,A);var da=function(){var p=A.call(this,e.btrt)||this;var G=new Uint8Array([0,28,156,128]),M=new Uint8Array([0,45,198,192]),aa=new Uint8Array([0,45,198,192]);p.setData(G,M,aa);return p};$jscomp.inherits(da,
A);var Q=function(){var p=A.call(this,e.stts)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0,0,0]);p.setData(G,M,aa);return p};$jscomp.inherits(Q,A);var ra=function(){var p=A.call(this,e.stsc)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0,0,0]);p.setData(G,M,aa);return p};$jscomp.inherits(ra,A);var k=function(){var p=A.call(this,e.stsz)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0,0,0]),na=new Uint8Array([0,
0,0,0]);p.setData(G,M,aa,na);return p};$jscomp.inherits(k,A);var m=function(){var p=A.call(this,e.stco)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]),aa=new Uint8Array([0,0,0,0]);p.setData(G,M,aa);return p};$jscomp.inherits(m,A);var l=function(p){var G=A.call(this,e.mvex)||this;p=new h(p);G.setData(p.data);return G};$jscomp.inherits(l,A);da=function(p){p=A.call(this,e.mehd)||this;var G=new Uint8Array([0]),M=new Uint8Array([0,0,0]);p.setData(G,M,c);return p};$jscomp.inherits(da,A);var h=
function(p){var G=A.call(this,e.trex)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array(4);b(p.id,na,0);p=new Uint8Array([0,0,0,1]);var ta=new Uint8Array([0,0,0,0]),ya=new Uint8Array([0,0,0,0]),Ca=new Uint8Array([0,0,0,0]);G.setData(M,aa,na,p,ta,ya,Ca);return G};$jscomp.inherits(h,A);var q=function(p){var G=A.call(this,e.moof)||this;u.setSequenceNumber(p.sequenceNumber);p=new D(p);G.setData(u.data,p.data);return G};$jscomp.inherits(q,A);da=function(p){var G=A.call(this,
e.mfhd)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array(4);b(p,na,0);G.setData(M,aa,na);return G};$jscomp.inherits(da,A);da.prototype.setSequenceNumber=function(p){b(p,this.data,12)};var u=new da(1),D=function(p){var G=A.call(this,e.traf)||this;F.setTrackId(p.id);F.setSampleDuration(p.frameDuration);B.setBaseMediaDecodeTime(p.samples[0].timestamp);var M=32+F.data.length+B.data.length;if(p.isAudio)p=new ka(p,null,M);else{for(var aa=[],na=0;na<p.samples.length;na++){var ta=
p.samples[na];aa.push({size:ta.unitsLength+4*ta.units.length,duration:p.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:ta.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:ta.hasIDR?0:1,degradationPriority:0}})}p=new ka(p,aa,M)}G.setData(F.data,B.data,p.data);return G};$jscomp.inherits(D,A);da=function(p,G){var M=A.call(this,e.tfhd)||this;M.isAudio=G;var aa=new Uint8Array([0]),na=G?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),ta=new Uint8Array(4);b(p,ta,0);G?(p=new Uint8Array([0,
0,0,1]),G=new Uint8Array(4),b(1024,G,0),M.setData(aa,na,ta,p,G)):(p=new Uint8Array([0,0,2,0,1,1,0,0]),M.setData(aa,na,ta,p));return M};$jscomp.inherits(da,A);da.prototype.setTrackId=function(p){b(p,this.data,12)};da.prototype.setSampleDuration=function(p){this.isAudio||b(p,this.data,16)};var F=new da(0,a);da=function(p){var G=A.call(this,e.tfdt)||this;var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array(4);b(p,na,0);G.setData(M,aa,na);return G};$jscomp.inherits(da,A);da.prototype.setBaseMediaDecodeTime=
function(p){b(p,this.data,12)};var B=new da(0),Z=new Uint8Array([0,0,2,1,0,0,0,0,0,0,0,0]),K=new Uint8Array([0,0,15,1,0,0,0,0,0,0,0,0]),ka=function(p,G,M){var aa=A.call(this,e.trun)||this;var na=p.isAudio,ta=p.samples,ya=p.isAudio?Z:K,Ca=na?4:16;p=na?p.samples.length:G.length;M+=Ca*p+28;b(p,ya,4);b(M,ya,8);if(na)for(M=new Uint8Array(Ca*p),na=0;na<p;na++)b(ta[na].aacData.byteLength,M,Ca*na);else for(M=new Uint8Array(Ca*G.length),na=0;na<p;na++){ta=G[na];var Aa=Ca*na;b(ta.duration,M,Aa);b(ta.size,M,
Aa+4);var Da=ta.flags,wa=new Uint8Array(4);wa[0]=Da.isLeading<<2|Da.dependsOn;wa[1]=Da.isDependedOn<<6|Da.hasRedundancy<<4|0|Da.isNonSync;wa[2]=Da.degradationPriority&61440;wa[3]=Da.degradationPriority&15;M.set(wa,Aa+8);b(ta.compositionTimeOffset,M,Aa+12)}aa.setData(ya,M);return aa};$jscomp.inherits(ka,A);da=function(p){var G=A.call(this,e.sdtp)||this;for(var M=new Uint8Array([0]),aa=new Uint8Array([0,0,0]),na=new Uint8Array(p.length),ta=0;ta<p.length;ta++){var ya=p[ta].flags;na[ta]=ya.isLeading<<
6|ya.dependsOn<<4|aa.isDependedOn<<2|aa.hasRedundancy}G.setData(M,aa,na);return G};$jscomp.inherits(da,A);var ua=function(p){var G=A.call(this,e.mdat)||this;var M=0,aa=p.samples,na=aa.length;if(p.isAudio){var ta=new Uint8Array(p.totalByteLength);for(p=0;p<na;p++){var ya=aa[p].aacData;ta.set(ya,M);M+=ya.byteLength}G.setData(ta)}else{ta=new Uint8Array(4*p.unitNum+p.totalByteLength);for(p=M=0;p<na;p++){ya=aa[p].units;for(var Ca=0,Aa=ya.length;Ca<Aa;Ca++){var Da=ya[Ca],wa=Da.data.byteLength;b(wa,ta,M);
M+=4;ta.set(Da.data,M);M+=wa}}G.setData(ta)}return G};$jscomp.inherits(ua,A)}function tc(a){function b(t,J){this.aacData=t;this.timestamp=J}function d(t,J,C,A,w){this.audioType=t;this.frequencyIdx=J;this.sampleRate=C;this.channelConfig=A;this.avgBitRate=w||0}var g=tc.SAMPLING_FREQUENCY,c=null,e=!0,f=this,z=0;this.reset=function(){z=0;a&&a.reset()};var x=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=
0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=function(t,J){var C=t.frequencyIdx;C||(C=g.indexOf(t.sampleRate));-1==C&&console.error("Invalid AAC sampel rate: "+t.sampleRate);var A=A?t.avgBitRate:t.nAvgBytesPerSec?8*t.nAvgBytesPerSec:0;c=new d(t.audioType||2,C,t.sampleRate,t.channels||t.channelConfig,A);x.audioHeader=c;e=!J;if(f.oncodec)f.oncodec("mp4a.40.2",c)};this.parseAACData=this.parse=function(t){if(e){var J=f.readADTSHeader(t);
t=t.subarray(J)}J=new b(t,z);z+=1024;x.samples.push(J);x.totalByteLength+=t.byteLength;x.duration=1/(c.sampleRate/1024);a&&a.remux(x);x.clear()};this.readADTSHeader=function(t){var J=t[1]&0?9:7,C=(t[2]>>6&3)+1,A=t[2]>>2&15,w=g[A];w||console.error("Invalid Sampling Frequency Index: "+A);var v=((t[2]&1)<<2)+(t[3]>>6&3),X=t[1]>>1&3;0!=X&&console.error("Invalid data format: layer is not 0x00: "+X.toString(16));t.length!=((t[3]&3)<<11)+(t[4]<<3)+(t[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+
t.length);if(c){if(A!=c.frequencyIdx&&(c.frequencyIdx=A,c.sampleRate=w,f.oncodec))f.oncodec("mp4a.40.2",c)}else if(c=new d(C,A,w,v),x.audioHeader=c,f.oncodec)f.oncodec("mp4a.40.2",c);return J}}function uc(a){function b(){if(0==c)throw console.error("no more ExpGolomb data"),Error("no more ExpGolomb data");var z=0,x=g-c;for(e=0;x<g;){var t=a[x];3==t&&2<=x&&0==a[x-1]&&0==a[x-2]||(e=e<<8|t,z++);x++;if(4<=z)break}4>z&&(e<<=8*(4-z));f=8*z;c=g-x}function d(){var z;for(z=0;z<f;++z)if(0!==(e&2147483648>>>
z))return e<<=z,f-=z,z;b();return z+d()}var g=a.byteLength,c=g,e=0,f=0;this.data=a;this.availabeBytes=function(){return c};this.skipBits=function(z){if(!(f>z)){z-=f;var x=z>>3;z-=x>>3;c-=x;b()}e<<=z;f-=z};this.readBits=function(z){var x=Math.min(f,z),t=e>>>32-x;32<z&&logger.error("Read more than 32 bits:"+z);f-=x;0<f?e<<=x:0<c&&b();x=z-x;return 0<x?t<<x|this.readBits(x):t};this.skipUEG=function(){this.skipBits(1+d())};this.skipEG=function(){this.skipBits(1+d())};this.readUEG=function(){var z=d();
return this.readBits(z+1)-1};this.readEG=function(){var z=this.readUEG();return 1&z?1+z>>>1:-1*(z>>>1)};this.readBool=function(){return 1===this.readBits(1)};this.readU8=function(){return this.readBits(8)};this.readU16=function(){return this.readBits(16)};this.readU32=function(){return this.readBits(32)};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Vd(){var a=[],b=0,d=0,g=Number.leadingZeros;this.writeU8=function(c){this.writeBits(c,8)};this.writeBits=
function(c,e){if(32<e)throw Error("Write more than 32 bits: "+e);for(;0<e;){var f=Math.min(e,8-d);b=b<<f|c>>>e-f&(1<<f)-1;d+=f;e-=f;if(8<=d){f=b>>>d-8&255;var z=a.length;4>f&&2<=z&&0==a[z-1]&&0==a[z-2]&&a.push(3);a.push(f);d-=8}}};this.writeBool=function(c){this.writeBits(c?1:0,1)};this.writeU32=function(c){this.writeBits(c,32)};this.writeUEG=function(c){if(0>c)console.error("Cannot write negative value as unsigned: "+c);else{c++;var e=32-g(c);this.writeBits(c,e+e-1)}};this.writeEG=function(c){this.writeUEG(0>=
c?-c<<1:(c<<1)-1)};this.finalize=function(){if(0<d){var c=8-d;this.writeBits(1<<c-1,c)}return a}}function Wd(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function d(){this.units=z;this.unitsLength=x;this.timestamp=c;this.hasIDR=e}function g(){var A=!1;if(f&&J.sps){var w=new d;c+=J.frameDuration||3E3;
J.samples.push(w);J.totalByteLength+=x;J.unitNum+=z.length;J.sequence++;A=!0;if(w.hasIDR&&C.onkeyframe)C.onkeyframe(w)}f=e=!1;z=[];x=0;return A}var c=0,e=!1,f=!1,z=[],x=0,t=Pb.searchStartCode,J=null,C=this;J=new b;this.reset=function(){c=0;e=!1;z=[];x=0;J=new b;a&&a.reset()};this.close=function(){C&&(C.reset(),C=null)};this.parseH264Data=this.parse=function(A){for(var w=[],v=0,X,y,ba,O=[0,0];v<A.byteLength;){O[0]=v;t(A,O);var P=O[0];if(-1==P)break;v=O[1];v=P+v;ba=A[v];ba&=31;X&&(X={type:y,data:A.subarray(X,
P)},w.push(X));X=v;y=ba}X&&(X={type:y,data:A.subarray(X,A.byteLength)},w.push(X));for(A=0;A<w.length;A++)switch(O=w[A],v=O.type,v){case 1:case 2:case 3:case 4:z.push(O);x+=O.data.byteLength;f=!0;break;case 5:f=e=!0;z.push(O);x+=O.data.byteLength;break;case 6:break;case 7:v=new uc(O.data);X=null;try{X=Qb.SPS.read(v)}catch(N){svGlobal.logger.info("Error parsing SPS: "+N)}if(X){if(J.width=X.width,J.height=X.height,J.codec=X.codec,J.sps=O.data,X.fps&&(J.frameDuration=9E4/X.fps|0),z.push(O),x+=O.data.byteLength,
C.oncodec)C.oncodec(J.codec,X)}else console.log("corrupted sps",O.data);break;case 8:J.pps=O.data;z.push(O);x+=O.data.byteLength;break;case 9:g();break;default:console.log("Ignore NAL unit with type = "+v)}g()&&J.sps&&(a.remux(J),J.clear())}}function Rb(a,b,d){function g(){for(;x;){if(y.updating){x=!1;break}var P=z.shift();if(!P)break;try{y.appendBuffer(P),t=0}catch(N){z.unshift(P);if("QuotaExceededError"==N.name)if(f(!0))continue;else{if(J.onerror)J.onerror(N);else console.log("QuotaExceededError: not recoverable, isAudio: "+
d),J.close();break}t++;console.error("Failed to append buffer, retry "+t,N);if(2<t){if(J.onerror)J.onerror(N);break}}}}function c(){x=!0;g()}function e(){X.duration=Number.POSITIVE_INFINITY;y=X.addSourceBuffer(C);y.mode="sequence";y.addEventListener("updateend",c);y.addEventListener("error",function(P){console.error(P)});x=!0;J.play(!1);g()}function f(P){var N=Math.min(a.played.end(0),y.buffered.end(0)),ma=0,qa=v.length,R=!1,E=0;if(d)E=N-180,0>E&&console.warn("Not possible, time played secs: "+N);
else if(1<qa){var W=qa-2;for(N=9E4*N|0;ma<qa;){if(v[ma]>N){W=ma-2;break}ma++}0<=W&&(E=(v[W]+1E3)/9E4)}if(0<E)try{y.remove(0,E),v.splice(0,W+1),R=!0,console.info("Buffer removed "+E+" isAudio: "+d)}catch(U){console.warn("Buffer removal "+E+" failed, retry, isAudio: "+d)}P||(w=setTimeout(f,18E4));return R}var z=[],x=!1,t=0,J=this,C="",A=null,w=0,v=[],X=null,y=null,ba=null,O=null;a.autoplay=!0;this.getKeyFrames=function(){return v};ba=new Pb(d);ba.ondata=function(P){z.push(P);g()};O=d?new tc(ba):new Wd(ba);
O.onkeyframe=function(P){v.push(P.timestamp)};O.oncodec=function(P,N){var ma=d?"audio/mp4;codecs=":"video/mp4;codecs=";ma+=P;if(ma!=C||(d?A.sampleRate!=N.sampleRate:A.width!=N.width||A.height!=N.height))if(C=ma,A=N,x=!1,y=null,X=new MediaSource,X.addEventListener("sourceopen",e),a.src=URL.createObjectURL(X),J.onsps)J.onsps(N)};b.onvideoframe=function(P){O.parse(P.bitstream)};b.onaudioframe=function(P){O.parse(P)};b.onendofstream=function(){J.reset()};this.play=function(P,N){a.play().then(function(){if(d){var ma=
y.buffered.end(0);ma&&(a.currentTime=ma-.01)}x=!0}).catch(function(ma){if(!P&&(console.error(ma),J.onplayerror))J.onplayerror(ma)})};this.reset=function(){console.log("Reset player");w&&(clearTimeout(w),w=0);v.length=0;x=!1;C="";A=null;O&&O.reset();z.length=0};this.close=function(){J&&(J.reset(),X&&"open"==X.readyState&&(X.endOfStream(),a.src=null),O&&O.close&&O.close(),ba&&ba.close&&ba.close(),J=null)};this.setMediaFormat=function(P,N){O.setMediaFormat&&O.setMediaFormat(P,N)};this.getMediaSource=
function(){return X};this.getMediaSourceBuffer=function(){return y};a.addEventListener("ended",function(P){console.warn(".... ended");w&&(clearTimeout(w),w=0)});a.addEventListener("emptied",function(P){x=!!y});a.addEventListener("pause",function(P){console.warn(".... paused");x=!!y;var N=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+N)}).catch(function(ma){console.error(ma)})});a.addEventListener("waiting",function(P){x=!!y})}function Xd(a,b,d,g){function c(v,
X,y,ba){var O,P,N,ma,qa,R,E,W,U,L,Y,T,ca,pa,ia,da,Q,ra,k,m,l,h,q,u,D,F,B,Z,K,ka,ua,p,G,M,aa,na,ta,ya,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aa){if(1==Aa.nextAddress)return O=v.allocationSize(),P=new Uint8Array(O),Aa.yield(v.copyTo(P),2);N=v.codedWidth;ma=(N+1)/2|0;qa=v.codedHeight;R=(qa+1)/2|0;E=N*qa;W=E+ma*R;U=2*E;L=X.subarray(E,U);Y=X.subarray(U);Q=da=ia=pa=ca=T=0;l=m=k=ra=null;h=P.subarray(0,E);q=P.subarray(E,W);u=P.subarray(W);D=0;for(F=ba.length;D<F;D++){B=ba[D];Z=B.left;
K=B.top;ka=B.right;ua=B.bottom;p=Z/2|0;G=K/2|0;M=ka/2|0;aa=ua/2|0;na=p/2|0;ta=M/2|0;for(ca=K;ca<ua;ca++)for(da=ca*N,Q=da+N,ra=h.subarray(da,Q),m=L.subarray(da,Q),l=Y.subarray(da,Q),T=p;T<M;T++)ia=2*T+1,m[ia]=ra[T],l[ia]=ra[T+ma];ya=(ma+1)/2|0;if(y)for(Ca=P.subarray(E),ca=G;ca<aa;ca++)for(da=ca*N,Q=da+ma,ra=Ca.subarray(da,Q),da=Q,Q=da+ma,k=Ca.subarray(da,Q),da=(2*ca+1)*N,Q=da+N,m=L.subarray(da,Q),l=Y.subarray(da,Q),T=p;T<M;T++)pa=2*T,m[pa]=ra[T],l[pa]=k[T];else for(ca=G;ca<aa;ca++)for(da=ca*ma,Q=da+
ma,ra=q.subarray(da,Q),k=u.subarray(da,Q),da=(2*ca+1)*N,Q=da+N,m=L.subarray(da,Q),l=Y.subarray(da,Q),T=na;T<ta;T++)pa=4*T,m[pa]=ra[T],l[pa]=ra[T+ya],pa+=2,m[pa]=k[T],l[pa]=k[T+ya]}Aa.jumpToEnd()})}function e(v,X,y,ba){var O,P,N,ma,qa,R,E,W,U,L,Y,T,ca,pa,ia,da,Q,ra,k,m,l,h,q,u,D,F,B,Z,K,ka,ua,p,G,M,aa,na,ta,ya,Ca,Aa,Da,wa,Ga,Qa,Va,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oa){if(1==Oa.nextAddress)return O=new Uint8Array(v.allocationSize()),Oa.yield(v.copyTo(O),2);P=v.codedWidth;
N=v.codedHeight;ma=(P+1)/2|0;qa=(N+1)/2|0;R=P*N;E=R+ma*qa;W=O.subarray(R,E);U=O.subarray(E);L=2*R;Y=X.subarray(R,L);T=X.subarray(L);k=ra=Q=da=ia=pa=ca=0;q=h=l=m=null;u=0;for(D=ba.length;u<D;u++){F=ba[u];B=F.left;Z=F.top;K=F.right;ka=F.bottom;ua=K-B;p=ka-Z;G=Z*P+B;M=O.subarray(G,R);aa=X.subarray(G,R);na=Y.subarray(G);ta=T.subarray(G);ya=B/2|0;Ca=Z/2|0;Aa=K/2|0;Da=ka/2|0;wa=Aa-ya;Ga=Da-Ca;for(pa=0;pa<p;pa++)da=pa*P,Q=da+ua,m=M.subarray(da,Q),aa.set(m,da);if(y)for(G=Ca*P+B,Qa=O.subarray(R+G),pa=0;pa<
Ga;pa++){da=pa*P;Q=da+ua;m=Qa.subarray(da,Q);da=2*pa*P;Q=da+ua;h=na.subarray(da,Q);q=ta.subarray(da,Q);for(ca=0;ca<wa;ca++)ia=2*ca,ra=m[ia],h[ia]=ra,h[ia+1]=ra,k=m[ia+1],q[ia]=k,q[ia+1]=k,void 0==k&&console.log("undefined v: "+ia,ca,pa,da,Q,ua,wa,Ga);da+=P;na.set(h,da);ta.set(q,da)}else for(G=Ca*ma+ya,Va=W.subarray(G),Ka=U.subarray(G),pa=0;pa<Ga;pa++){da=pa*ma;Q=da+wa;m=Va.subarray(da,Q);l=Ka.subarray(da,Q);da=2*pa*P;Q=da+ua;h=na.subarray(da,Q);q=ta.subarray(da,Q);for(ca=0;ca<wa;ca++)ia=2*ca,ra=m[ca],
h[ia]=ra,h[ia+1]=ra,k=l[ca],q[ia]=k,q[ia+1]=k;da+=P;na.set(h,da);ta.set(q,da)}}return Oa.return(X)})}function f(v){var X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){switch(y.nextAddress){case 1:if(!g){if(1E3==v.duration)t.onframedecoded(v,w.getRects(v.timestamp));y.jumpTo(2);break}X=null;return 1E3==v.duration?y.yield(w.setMainFrame(v),6):y.yield(w.getCombinedFrame(v),5);case 5:X=y.yieldResult;y.jumpTo(4);break;case 6:X=y.yieldResult;case 4:t.onframedecoded(X),X.close();case 2:v.close(),
y.jumpToEnd()}})}function z(v){var X=v.codec;if(X!=x||(b?C.sampleRate!=v.sampleRate:C.width!=v.width||C.height!=v.height))if(console.log("Codec: "+X+" audio: "+b),x=X,C=v,J||(J=new VideoDecoder({output:function(y){f(y)},error:function(y){console.error("VideoDecoder error:",y);if(t.onerror)t.onerror(y)}})),X={codec:x,codedWidth:v.width,codedHeight:v.height,hardwareAcceleration:d||"no-preference"},console.log(X),J.configure(X),t.onsps)t.onsps(v)}var x=null,t=this,J,C=null,A={type:"delta",data:null,
timestamp:0,duration:0},w=new function(){function v(P){for(;;){var N=X.shift();if(N){if(N.timestamp==P)return N.rects;if(N.timestamp>P){console.log("not possible, time: "+P+" option.timestamp: "+N.timestamp);break}}else break}return null}var X=[],y=null,ba=!1,O={timestamp:0,codedWidth:0,codedHeight:9,duration:0,format:"I444"};this.pushRects=function(P){X.push(P)};this.getRects=v;this.setMainFrame=function(P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return y||
(y=new Uint8Array(2*P.allocationSize()),ba="NV12"==P.format,O.codedWidth=P.codedWidth,O.codedHeight=P.codedHeight,console.log("isNV12: "+ba+" supportsI444: "+g)),N.yield(e(P,y,ba,v(P.timestamp)),2);O.duration=P.duration;O.timestamp=P.timestamp;return N.return(new VideoFrame(y,O))})};this.getCombinedFrame=function(P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return N.yield(c(P,y,ba,v(P.timestamp)),2);O.duration=P.duration;O.timestamp=P.timestamp;return N.return(new VideoFrame(y,
O))})};this.close=function(){y&&(y=null)}};a.onvideoframe=function(v){var X=v.bitstream;var y=0,ba=[0,0],O=X.length;var P=!1;var N=null;for(var ma=!1,qa=0,R=0,E=0,W=0;y<O;){ba[0]=y;Pb.searchStartCode(X,ba);var U=ba[0];if(-1==U){R=ba[1];break}E&&!W&&(W=U);U+=ba[1];y=U+1;qa=X[U]&31;switch(qa){case 5:P=!0;break;case 7:E=U;U=new uc(X.subarray(U));try{N=Qb.SPS.read(U)}catch(ia){svGlobal.logger.info(ia)}N||(ma=!0)}}ba=O-y;U=7>ba;y=null;if(U||N)if(U&&(y=X.subarray(0,O-(ba+(R+1))),7==qa&&(ma=!1)),N){U=new uc(X.subarray(E,
W));try{var L=Qb.SPS.read(U);if(L){var Y=L.vui.video_signal;Y.video_signal_type_present_flag=!0;Y.video_format=5;Y.video_full_range_flag=!0;Y.colour_description_present_flag=!0;Y.colour_description={colour_primaries:1,transfer_characteristics:1,matrix_coefficients:1};var T=new Vd;Qb.SPS.write(L,T);var ca=T.finalize();y||(y=X);var pa=new Uint8Array(ca.length+y.length-(W-E));pa.set(y.subarray(0,E),0);pa.set(ca,E);pa.set(y.subarray(W),E+ca.length);y=pa}}catch(ia){svGlobal.logger.info(ia)}}X=y;ma&&console.log("corrupted: "+
v.timestamp,v.bitstream);N&&z(N);C&&(w.pushRects({timestamp:v.timestamp,rects:v.regionRects}),X&&(v.bitstream=X),A.type=P?"key":"delta",A.data=v.bitstream,A.timestamp=v.timestamp,A.duration=v.isChroma?77:1E3,v=new EncodedVideoChunk(A),J.decode(v))};this.play=function(v){};this.reset=function(){console.log("Reset MediaDecoder");C=x=null;w.close();J&&J.reset()&&J.close();J=null};this.close=function(){t.reset();J&&(J.close(),J=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=
0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Ob=!1,mb={},kb={},Bb=null,n=this,Mb=!1,Za=!1,fb=0,Cb=null,ad=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ja=hi5.appcfg,Lb="";this.setConfig=function(a){ja=a};var eb="object"==typeof r?r:null,I=eb?{}:hi5.tool.queryToObj(r.substring(r.indexOf("?")+1));void 0==I.mapClipboard&&
ja.clipboard&&void 0!=ja.clipboard.enabled&&(I.mapClipboard=ja.clipboard.enabled);I.hardwareAcceleration||(I.hardwareAcceleration=ja.hardwareAcceleration);void 0==I.yuv444&&(I.yuv444=ja.yuv444);var Yd=void 0!=I.playSound?parseInt(I.playSound):1;void 0==ja.enableDVCAudio&&(ja.enableDVCAudio=!0);I.avgBytesPerSec||(I.avgBytesPerSec=ja.avgBytesPerSec);var Zd=void 0!=I.avgBytesPerSec?parseInt(I.avgBytesPerSec):12E3,La=0,Ma=0,hb=(oa||I.color||I.server_bpp||16)|0,rc=null,bd=null,Sa=null,vc=null,cd="/DOWNLOAD?",
dd="/CLIP?";24==hb&&(hb=16);var Ya="app"==I.startProgram,Nb=S(I.mapDisk),nb=0;this.setLinks=function(a){a.download&&(cd=a.download);a.clipboard&&(dd=a.clipboard)};this.protocol=eb?"":r.substring(0,r.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return S(I.smartCard)||S(I.mapSmartCard)||S(I.passwordIsPin)};this.enableWebAuthn=function(){return S(I.enableWebAuthn)||S(I.useWebAuthn)};this.hasScanner=function(){return S(I.scanner)};this.hasUSB=function(){return S(I.mapUSB)&&!!navigator.usb};
this.getUSB=function(){return I.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){bd=a};this.getProfiler=function(){return bd};this.gateway=function(){if(eb)return"";var a=r.lastIndexOf("/RDP?");-1==a&&(a=r.lastIndexOf("/JOIN?"));-1==a&&(a=r.lastIndexOf("/PLAY?"));return r.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,
"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=Ba;var lb="object"==typeof r||0<r.indexOf("/PLAY?"),wc=!lb&&0<r.indexOf("invitation=");if(wc){var xc=decodeURIComponent(r),Sb=xc.indexOf(' USERNAME="');if(0<Sb){Sb+=11;var $d=xc.substring(Sb,xc.indexOf('"',Sb));r+="&novice="+$d}r+="&mapClipboard=on";I.mapClipboard="on";this.reconnectOnResize=!1}if(lb)this.mode=1,eb?r="":(La=640,Ma=480),r+="&touchpad=on",I.touchpad="on",this.reconnectOnResize=!1;
else if(0<r.indexOf("/JOIN?")||wc)this.mode=2,this.reconnectOnResize=!1;var yc=S(I.gfx)||S(I.remotefx)||0<n.mode;yc&&(Ya||wc?(yc=!1,I.remotefx=!1):hb=32);H?La=parseInt(H):I.width&&(La=parseInt(I.width));V?Ma=parseInt(V):I.height&&(Ma=parseInt(I.height));-1==La&&(La=hi5.browser.getScreenWidth());-1==Ma&&(Ma=hi5.browser.getScreenHeight());I.symlink&&I.parameters&&hi5.tool.queryToObj(I.parameters,I);I.gateway||(r+="&gateway="+encodeURIComponent(n.gateway));!I.minWidth&&ja.minWidth&&(I.minWidth=ja.minWidth);
!I.minHeight&&ja.minHeight&&(I.minHeight=ja.minHeight);I.minWidth&&(I.minWidth=parseInt(I.minWidth));I.minHeight&&(I.minHeight=parseInt(I.minHeight));I.waWidth=I.waWidth?parseInt(I.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;I.waWidth&=-4;I.waHeight=I.waHeight?parseInt(I.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;I.waHeight&=-4;"useSSL"in I||(r+="&useSSL="+("wss"==n.protocol));hi5.storage.isAvailable&&
(S(I.shareClipboard)||I.shareClipboardId)&&(r+="&shareClipboardId="+(I.shareClipboardId||ea()));ja&&(void 0!=ja.displayMsg?this.displayMsg=ja.displayMsg:ja.displayMsg=this.displayMsg,ja.appTimeout&&(this.appTimeout=ja.appTimeout),void 0!=ja.reconnectOnResize&&(this.reconnectOnResize=ja.reconnectOnResize),ja.reconnectTimes&&(this.reconnectTimes=ja.reconnectTimes),void 0!=ja.windowState&&(this.windowState=ja.windowState),void 0!=ja.openLink&&(this.openLink=ja.openLink),void 0!=ja.setTitle&&(this.setTitle=
ja.setTitle),"boolean"==typeof ja.useWSS&&(r=(ja.useWSS?"wss":"ws")+r.substring(r.indexOf("://"))),"boolean"==typeof ja.remoteAppLogin&&(this.remoteAppLogin=ja.remoteAppLogin,Ob=!ja.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ja.hideLogin&&(Ob=ja.hideLogin),void 0!=ja.localPrinter&&void 0==I.localPrinter&&(I.localPrinter=ja.localPrinter));var Pa=null;void 0==ja.useWorker&&(ja.useWorker=!1);ja.useWorker&&(!window.Worker||hi5.browser.isFirefox||
Ya&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ja.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Na=ja.useWorker?new Worker(xa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,vb=this.reconnectTimes,fc=Na?{type:5,data:null}:null;this.getDisplayName=fa;this.server=fa();this.port=parseInt(I.port,10);this.loadbalanceToken="";ja.loadbalanceTokenName&&(I[ja.loadbalanceTokenName]?la(I[ja.loadbalanceTokenName]):!1!==ja.randomAppId?la(hi5.tool.uuid()):
svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){n.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+n.loadbalanceToken:"&"+n.loadbalanceToken,a+="&loadbalanceTokenName="+ja.loadbalanceTokenName);return a};this.getURL=function(){return r};this.getRuntimeURL=function(){var a=r+"&width="+La+"&height="+Ma+"&server_bpp="+hb+"&audio="+(Wa.available||hi5.browser.isIE),b=Kc(),d="";b&&(d=sessionStorage[b]||"")&&(d="&preSymJoin="+d);a+=d;var g=I.monitorDef,c=I.monitor,e=0;b=
ha.size();var f=Array(b);d=Array(b);var z=0,x=0,t=0,J=0,C=0,A=0,w="";if(g){d=va.parseMonitorDef(g);for(b=d.length;e<b;e++){var v=d[e];v[0]<t&&(t=v[0]);v[1]<J&&(J=v[1]);v[2]>C&&(C=v[2]);v[3]>A&&(A=v[3])}0>t&&(z=-t);0>J&&(x=-J);v=0>c?[t,J,C,A]:d[c];I.width=v[2]-v[0]+1;I.height=v[3]-v[1]+1;e=ha.getSurface(0);e.setMonitor(v[0],v[1],v[2],v[3]);if(z||x)for(v=e.getMousePosition(),v.left+=z,v.right+=z,v.top+=x,v.bottom+=x,e=0;e<b;e++)v=d[e],v[0]+=z,v[1]+=x,v[2]+=z,v[3]+=x;va.setMonitorLayout(d);0>c&&va.setMonitorCount(0);
n.reconnectOnResize=!1;b="&monitorDef="+g+"&width="+I.width+"&height="+I.height}else{if(1<b&&!Ya){for(ha.verifyMonitors();e<b;e++)g=ha.getSurface(e),v=g.getMousePosition(),v.left<t&&(t=v.left),v.top<J&&(J=v.top),v.right>C&&(C=v.right),v.bottom>A&&(A=v.bottom),f[e]=v,w&&(w+=","),w+=v.left+":"+v.top+":"+v.right+":"+v.bottom;0>t&&(z=-t);0>J&&(x=-J);for(e=0;e<b;e++){v=ha.getSurface(e).getMousePosition();if(z||x)v.left+=z,v.right+=z,v.top+=x,v.bottom+=x;d[e]=[v.left,v.top,v.right,v.bottom,v.left==z&&v.top==
x?1:0]}va.setMonitorLayout(d);n.reconnectOnResize=!1}w&&(svGlobal.logger.warn("MonitorDef:"+w),I.width=C-t+1,I.height=A-J+1,w="&monitorDef="+w+"&width="+I.width+"&height="+I.height);b=w}a+=b;0>r.indexOf("waWidth")&&(b=(b=ha.getFocused())?b.getWindow():window,a+="&waWidth="+I.waWidth+"&waHeight="+I.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;I.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());I.timezone||(d=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(d.standardName));
a+="&time="+b.getTime();I.soundPref=void 0==I.soundPref?0:parseInt(I.soundPref,10);a+="&soundPref="+I.soundPref;z=d=b="";for(z in mb)x=mb[z],"flags"in x&&(b&&(b+=",",d+=","),b+=x.name,d+=x.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+d));b="";for(z in kb)x=kb[z],"flags"in x&&(b&&(b+=","),b+=x.name);b&&(a+="&gwChannelName="+b);if(d=Cd())b=d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);I.audioRecord=
S(I.audioRecord)&&hi5.audio.recordable;Ia.init(b,yc,I.audioRecord,I.soundPref,S(I.mapCamera)&&!!navigator.mediaDevices,S(I.mapUSB)&&!!navigator.usb);I.audioRecord&&(a+="&audioRecord=on");I.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ia.count&&(a+="&dvcChannels="+Ia.names.join(","));a+="&binary=on";ja.existingFile&&(a+="&existingFile="+ja.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(Ba());a=n.modifyURL(a);ja.copyTextOnly&&S(I.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&
(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);S(I.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Ld()};this.getColor=function(){return hb};this.changeTitle=sa;hi5.browser.isTouch&&Math.max(La,Ma)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Ya};var Ha=null,Ja=!1,qb=!1,sc=!1,Wa=new function(){function a(t){g&&(e&&e.disconnect(),
f&&f.disconnect());hi5.audio.releaseAudioContext();t||(x&&(x.close(),x=null),z&&(z.pause(),z=null))}function b(){x.play(!0)}function d(t){console.error("play error: ",t);n.onuserinteract&&n.onuserinteract(b,"audio")||n.showMessage({msg:"Please click Yes to continue.<br>"+t,cbYes:function(){x.play(!0);this.destroy()},html:!0})}var g=null;this.supportWebAudio=this.available=!1;(0==Yd||1==n.mode)&&(g=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=
function(){return g};this.getBuffer=function(t){return g.createBuffer(2,t,Ea.samplePerSec)};var c=0,e=null,f=null;this.setVolume=function(t){1==t?e=null:(e||(e=g.createGain()),e.gain.value=t)};this.playBuffer=function(t){f=g.createBufferSource();f.buffer=t;e?(f.connect(e),e.connect(g.destination)):f.connect(g.destination);var J=g.currentTime,C=0<c?c:J;C<J&&(C=J);c=C+t.duration;f.start?f.start(C):f.noteOn(C);return c-J};this.iOSFix=function(){if(g){var t=this.getBuffer(1024),J=g.createBufferSource();
J.buffer=t;J.connect(g.destination);J.start?J.start(0):J.noteOn(0)}};this.close=a;var z=null,x=null;this.onaudioframe=null;this.initMediaPlayer=function(t,J,C){a(!0);z||(z=document.createElement("audio"));x||(x=new Rb(z,t,!0),x.onplayerror=d,x.onerror=function(A){console.error("Not possible audio error",A)},svGlobal.logger.info("MediaPlayer init, headerless: "+C+" sampleRate:"+J.sampleRate));x.setMediaFormat(J,C);x.play(!1)}},Xc=Wa.available;Xc||(ja.enableDVCAudio=!1);var ab=null,va=new Ec(200,200);
va.onSetCursor=Pc;this.setVolume=function(a){Wa&&Wa.setVolume(a)};this.setAudioBuffer=function(a){};var cc=0,bc=0,dc=La-1,ec=Ma-1,qc="";window.$rdp||(window.$rdp=this);Fa(hb);this.setResolution=Ra;this.running=function(){return Ja};this.setJoinMode=function(a){Ja&&za("8E1"+a)};this.setJoinCloseMode=function(a){Ja&&za("8EB3\t"+a)};this.refuseControl=function(a){Ja&&za("8E3"+a)};this.giveControl=function(a){Ja&&za("8E4"+a)};this.pauseSession=function(a,b){Ja&&za("8EB"+(b?1:0)+"\t"+a)};this.closeSession=
function(a){Ja&&za("8EB2\t"+a)};this.requestControl=function(){Ja&&za("8E2")};this.saveSession=function(a){Ja&&za("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ja&&za("8EA"+a+"\t"+(b?1:0))};var Db=new function(){function a(){if(d&&0<d.length){var e=d.shift();e.key?Db.sendSingleKey(e.down,e.key):e.char&&ub(e.char);0<d.length?setTimeout(a,g):(d=null,c&&c())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,
down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(e,f){var z=b[f.toLowerCase()];z?n.writeScancode(e,z):(z=f.length,0!=z&&(1==z?n.writeKeyCode(e,f.toUpperCase().charCodeAt(0)):e&&n.writeText(f)))};var d=null,g=
0,c=null;this.sendKeyComb=function(e,f,z){if(Za){e=e.split("+");var x=e.length,t;if(0!=x){var J=null,C=[];for(t=0;t<x;t++){var A=e[t];""==A&&""==J&&(A="Add");""!=A&&C.push({key:A,down:!0});J=A}x=C.length;for(t=x-1;0<=t;t--)C.push({key:C[t].key,down:!1});if(f)d=C,g=f,c=z,a();else for(t=0,x=C.length;t<x;t++)Db.sendSingleKey(C[t].down,C[t].key)}}};this.sendText=function(e,f,z){for(var x=[],t=0,J=e.length;t<J;t++)x.push({"char":e.charAt(t)});d=x;g=f;c=z;a()}};this.writeKeyComb=function(a,b,d){Za&&Db.sendKeyComb(a,
b,d)};this.writeText=function(a,b,d){if(Za)if(b)Db.sendText(a,b,d);else for(b=0,d=a.length;b<d;b++)ub(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),n.writeRawInput("880"+b+"\t"+a.hashCode()),Cb={type:b,text:a})};var ha=new function(a,b){function d(){function c(C){for(;0<C.ownerWinid;){var A=t.getWinById(C.ownerWinid);if(A&&A.isVisible())C=A;else break}return C}function e(C){for(var A="";C;)C.titleInfo&&(A=C.titleInfo),C=t.getWinById(C.ownerWinid);return A}var f=[],z=[],x=
0,t=this;this.mainWin=null;this.appId="";var J=0;this.getActiveWinId=function(){return J};this.setActiveWinId=function(C,A){svGlobal.logger.info("setActiveWinId: "+C+" old: "+J+" max: "+A);if(J!=C){var w=0==J;J=C;(C=t.getMainByWinId(C))&&C.isMainWin()&&t.mainWin!=C&&(t.mainWin=C);w&&A&&(A=ha.getFocused())&&(A=A.getFreeSpace(),C=A.width,n.resetSize(C,A.height))}};this.onchange=function(C){C.isVisible()||C!=t.mainWin?C.isVisible()&&!t.mainWin&&C.isMainWin()&&(t.mainWin=C,3==a.windowState&&C.exeCommand(61488)):
t.mainWin=null};this.addWin=function(C){for(var A=f.length,w=!1,v=0;v<A;v++)if(C.id==f[v].id){f[v]=C;w=!0;break}w||f.push(C);1==f.length&&(x=Date.now());A=C.isMainWin();svGlobal.logger.info("is mainwin:"+A+" id:"+C.id);A&&!t.mainWin&&(t.mainWin=C)};this.popWins=function(C){C=t.getWinById(C);var A=[];if(C){C=0<C.ownerWinid?C.ownerWinid:C.id;for(var w=f.length-1;0<=w;w--)if(f[w].ownerWinid==C||f[w].id==C)A.push(f[w]),f.splice(w,1)}return A};this.hasApp=function(C){return-1!=z.indexOf(C)};this.addApp=
function(C){return-1==z.indexOf(C)?(z.push(C),!0):!1};this.isNew=function(){return 3E4>Date.now()-x};this.getAll=function(){return f};this.hasWin=function(C){return 0<=f.indexOf(C)};this.close=function(){for(var C=0,A=f.length;C<A;C++)f[C].close()};this.clear=function(){f.length=0};this.delWin=function(C){for(var A=0,w=f.length;A<w;A++)if(f[A].id==C)return f.splice(A,1),A;return-1};this.isRunning=function(){var C=f.length;if(1>C)return!1;var A=0;for(C=f.length;A<C;A++){var w=f[A];if(w.showState)return!0}return!1};
this.getWinById=function(C){var A=f.length;if(1>A)return null;for(var w=0;w<A;w++){var v=f[w];if(v.id==C)return v}return null};this.getMainWinByAppId=function(C){var A=null,w=0;for(len=f.length;w<len;){A=f[w];if(A.appId==C&&A.isVisible()&&1>A.ownerWinid)break;w++}return A};this.getTopWin=function(C){var A=null,w,v=C.length;for(w=0;w<v&&(!(A=t.getWinById(C[w]))||!A.isVisible());w++)A=null;if(!A)for(svGlobal.logger.warn("No win found"),v=f.length,w=v-1;0<=w&&(A=f[w],!A.isVisible());w--)A=null;return A};
this.getMain=function(C){return(C=t.getTopWin(C))?c(C):null};this.getMainByWinId=function(C){return(C=t.getWinById(C))?c(C):null};this.getOtherApps=function(C,A,w){var v=f.length;if(0!=v&&f[v-1])if(v=f[v-1].appId,w||!v)setTimeout(function(){t.getOtherApps(C,A)},w||3E3);else{w=[];if(v=t.getTopWin(C)){var X=0<v.ownerWinid?v.ownerWinid:v.id,y=[],ba=0;for(v=f.length;ba<v;ba++)f[ba].ownerWinid!=X&&f[ba].id!=X&&f[ba].isVisible()&&y.push(f[ba]);ba=0;for(v=y.length;ba<v;ba++)y[ba].ownerWinid!=X&&y[ba].id!=
X&&(w.push({title:e(y[ba]),win:c(y[ba])}),X=0<y[ba].ownerWinid?y[ba].ownerWinid:y[ba].id)}A(w)}};this.getFullTitle=function(C){for(var A,w="";;){A=t.getWinById(C);if(!A)break;A.titleInfo&&A.isVisible()&&(w&&(w=" > "+w),w=A.titleInfo+w);if(1>C)break;C=A.ownerWinid}return w}}var g=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var c=g.length,e=0;e<c;e++)g[e].railWin&&g[e].railWin.close()};this.verifyMonitors=function(){for(var c=g.length,e=Array(c),f=0;f<c;f++)g[f].configMonitor(),
e[f]=g[f].getMousePosition();e.sort(function(t,J){var C=t.left-J.left;return 0!=C?C:t.top-J.top});var z=e.findIndex(function(t){return 0==t.left&&0==t.top});svGlobal.logger.info("monitor layout",e,z);-1==z&&(n.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",e));for(f=z-1;0<=f;){if(e[f].right<e[f+1].left){var x=e[f+1].left-e[f].right-1;0<x&&(e[f].right+=x,e[f].left+=x)}e[f].bottom<e[f+1].top&&(x=
e[f+1].top-e[f].bottom-1,0<x&&(e[f].top+=x,e[f].bottom+=x));f--}for(f=z+1;f<c;)e[f-1].right<e[f].left&&(x=e[f].left-e[f-1].right-1,0<x&&(e[f].right-=x,e[f].left-=x)),e[f-1].bottom<e[f].top&&(x=e[f].top-e[f-1].bottom-1,0<x&&(e[f].top-=x,e[f].bottom-=x)),f++};this.repaint=function(c,e,f,z){for(var x=0,t=g.length;x<t;x++)g[x].repaint(c,e,f,z)};this.size=function(){return g.length};this.getSurface=function(c){return g[c]};this.addSurface=function(c){g.push(c)};this.hasSurface=function(c){for(var e=g.length,
f=0;f<e;f++)if(g[f].equals(c))return!0;return!1};this.getMonitorSurface=function(c,e,f,z){var x=g.length;if(1==x)return g[0];for(var t=0;t<x;t++)if(g[t].isMonitor(c,e,f,z))return g[t];return null};this.fromSyncedSurface=function(c){var e=g.length;Date.now();for(var f=0;f<e;f++)if(g[f].isClipSynced(c))return!0;return!1};this.setSize=function(c,e,f){for(var z=0,x=g.length;z<x;z++)g[z].setSize(c,e,f)};this.zOrders=[];this.drawLicense=function(c){for(var e=0,f=g.length;e<f;e++)g[e].drawLicense(c)};this.setReadOnly=
function(c,e){for(var f=0,z=g.length;f<z;f++)g[f].setReadOnly(c,e)};this.setVisible=function(c,e){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(c){for(var e=0,f=g.length;e<f;e++)g[e]&&g[e].setCursor(c)};this.hide=function(c){c=0;for(var e=g.length;c<e;c++)g[c]&&g[c].hide()};this.execute=function(c,e){for(var f=0,z=g.length;f<z;f++)g[f][c].apply(g[f],e)};this.addWin=function(c){var e=this.getFocused();e||(svGlobal.logger.warn("Focused surface not found!"),e=g[g.length-1]);e?(Ya=
!0,e.railWin||(e.railWin=new d,e.onunload=function(){hi5.appcfg.closeRemoteApp&&e.railWin&&e.railWin.close();e.remoteApp&&e.remoteApp.close();e.railWin&&(e.railWin.clear(),e.railWin=null);g.removeElm(e)}),e.context&&b.setContext(e.context),e.railWin.addWin(c),e.railWin.mainWin==c&&(setTimeout(function(){var f=e.getFreeSpace();a.writeRawInput("8C661441\t"+f.width+"\t"+f.height);svGlobal.logger.info("-- main win dp change:"+f.height);3==a.windowState?c.resizable()&&setTimeout(function(){c.exeCommand(61488);
svGlobal.logger.info("-- max")},50):5==a.windowState&&3==c.showState&&setTimeout(function(){c.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ta.sendKeyboardSyncFlags(Ta.localLockFlags,500)),hi5.browser.isIE&&e.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(c){for(var e,f=g.length-1;0<=f;f--){var z=g[f];e=z.railWin;var x=e.getWinById(c),t=x&&x.appId&&-1!=x.appId.toLowerCase().indexOf("runonce");if(0<=e.delWin(c)){x==e.mainWin&&(e.mainWin=null);if(z.toolbar){c=
"win"+c;var J=z.toolbar.querySelector("#"+c);J&&z.toolbar.removeChild(J)}if(!e.isRunning()&&0==n.mode){if(x.isMainWin()&&z.onremoteappclose)z.onremoteappclose(x);x=a.appTimeout;if(t||e.isNew())x*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(C){return function(){svGlobal.logger.info("Start del:"+Date.now());C.railWin&&C.railWin.isRunning()||(C.remoteApp&&C.remoteApp.close(),ha&&ha.delSurface(C))}}(z),x)}}}};this.popWins=function(c){return g[0]&&g[0].railWin?g[0].railWin.popWins(c):
[]};this.getWinById=function(c){for(var e,f=0,z=g.length;f<z;f++)if(g[f]&&g[f].railWin&&(e=g[f].railWin.getWinById(c)))return e;return null};this.getMainWinByAppId=function(c){for(var e,f=0,z=g.length;f<z;f++)if(g[f].railWin&&(e=g[f].railWin.getMainWinByAppId(c)))return e;return null};this.onWinChange=function(c){for(var e,f=0,z=g.length;f<z;f++)if(g[f].railWin&&(e=g[f].railWin.getWinById(c.id)))g[f].railWin.onchange(c)};this.setTitle=function(c){for(var e,f=0,z=g.length;f<z;f++)if(g[f].railWin){e=
g[f].railWin.getWinById(c);var x=g[f].railWin.getFullTitle(c);if(x){a.changeTitle(x,g[f].getWindow(),e.appId);break}}};this.hasApp=function(c){for(var e=0,f=g.length;e<f;e++)if(g[e].railWin.hasApp(c))return!0;return!1};this.delSurface=function(c){!c||c.railWin&&c.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),g.removeElm(c),c.close(),0==g.length&&a._unload())};this.getOwnerSurface=function(c){for(var e=0,f=g.length;e<f;e++)if(g[e].railWin&&g[e].railWin.hasWin(c))return g[e];return null};
this.getOwnerSurfaceById=function(c){for(var e,f=0,z=g.length;f<z;f++)if(g[f].railWin&&(e=g[f].railWin.getWinById(c)))return g[f];return null};this.getFocused=function(){for(var c=g.length,e=0;e<c;e++)if(g[e].focused)return g[e];return g[c-1]};this.close=function(){for(var c=0,e=g.length;c<e;c++)g[c]&&(g[c].remoteApp&&g[c].remoteApp.close(),g[c].close(),g[c]=null)};this.LocalWin=function(c){function e(){a.writeRawInput("8C0"+c)}this.id=c;this.appId="";var f=this;this.resizable=function(){return f.isVisible?
0!=(f.style&262144)||0!=(f.style&65536)||0!=(f.style&16777216)||3==f.showState:!1};this.setShowState=function(z){f.showState=z};this.parent=function(){return ha.getWinById(f.ownerWinid)};this.resize=function(z,x,t,J){svGlobal.logger.info("www resize, l "+z+" w "+t);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+f.id+"\t"+z+"\t"+x+"\t"+t+"\t"+J)};this.exeCommand=function(z){svGlobal.logger.info("www exeCommand, cmd "+z);a.writeRawInput("8C4"+c+"\t"+z)};this.activate=function(z){svGlobal.logger.info("www activate, enable "+
z+" id:"+c);2==f.showState?(f.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+c+"\t"+z)},50)):a.writeRawInput("8C3"+c+"\t"+z)};this.close=function(){svGlobal.logger.info("www close");f.exeCommand(61536)};this.getAppId=e;this.isVisible=function(){return f.winWidth&&f.winHeight&&f.showState&&45<f.winHeight&&45<f.winWidth};this.isMainWin=function(){if(!(f.isVisible()&&f.winWidth&&f.winHeight&&45<f.winHeight&&45<f.winWidth))return!1;var z=1>f.ownerWinid;if(!z)return z;var x=f.style;if(0!=
(x&4194304))return!0;if(0!=(x&2147483648)&&(0==(x&8388608)||0==(x&12582912)))return!1;var t=0!=(f.extStyle&128);(z=z&&!t)&&0!=(x&2147483648)&&0==(x&2156396544)&&(z=!1);return z};e()}}(n,va);this.getSurfaces=function(){return ha};this.hide=function(){ha&&ha.hide()};this.getFileUrl=function(a,b,d){var g=Ba(),c=cd,e=c.indexOf("://");g=(0<e&&11>e?c:g+c)+"s="+qc+"&f="+encodeURIComponent(a);b&&(g+="&src="+b);d&&(g+="&action="+d);return n.modifyURL(g)};this.listFiles=function(a,b){Pa&&Za&&Pa.list(a,b)};
this.writeRawInput=function(a){if(Za){za(a);if(n.onactivity)n.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var d=a.length,g=new Uint8Array(5+d);g[0]=146;g[1]=7;g[2]=b;g[3]=d&255;g[4]=d>>8&255;for(b=0;b<d;b++)g[5+b]=a.charCodeAt(b);za(g.buffer)};var ed=0;if(ja.numLock||ja.numlock||S(I.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)ed|=2;var Ta=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;
this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var d=void 0,g=a.getSurfaces();this.saveResize=function(c){d=a.reconnectOnResize;a.reconnectOnResize=c};this.restoreResize=function(){void 0!=d&&(a.reconnectOnResize=d)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(c){a.saveSession(c)};this.sendInput=a.writeRawInput;
this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Wa.supportWebAudio&&Wa.iOSFix()};this.onresize=function(c){if((c=c.target.svSurface)&&!document.hidden){var e=c.getFreeSpace(),f=e.width;e=e.height;Ta.checkLockFlags=!0;ja.scale?c.scaleTo(f,e,!1):a.resetSize(f,e)}};this.onorientationchange=function(c){a.resetSize(c.innerWidth,c.innerHeight)};this.getClipData=function(c,e){this.reqCopyTime=Date.now();var f=a.getGatewayAddr(),z=dd,x=z.indexOf("://");f=(0<x&&11>x?z:f+
z)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+c;c=hi5.httpGet(a.modifyURL(f),e);this.reqCopyTime=Date.now();Yc(c);return c};this.getShareFiles=a.listFiles;this.getFile=function(c,e,f){a.reconnectOnResize=!1;var z=a.getFileUrl(c,e,f);n.ondownload&&n.ondownload({fileName:c,url:z,source:e,action:f})||window.open(z)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return r};this.reconnect=function(c,e,f){I.symlink?(c="user="+c+"&pwd="+e,f&&(c+="&domain="+f),r=hi5.tool.replaceQuery(r,
"parameters",c)):(r=hi5.tool.replaceQuery(r,"user",c),r=hi5.tool.replaceQuery(r,"pwd",e),r=hi5.tool.replaceQuery(r,"domain",f));a.run()};this.sendKeyboardSyncFlags=function(c,e){return Za?(this.remoteLockFlags=this.localLockFlags=c,setTimeout(function(){a.writeRawInput("8E5"+c)},e||333),!0):!1};this.sendKeyboardSynchronize=function(c,e,f){var z=0;f&&(z|=4);e&&(z|=2);c&&(z|=1);this.sendKeyboardSyncFlags(z)};this.fromSyncedSurface=function(c){return g.fromSyncedSurface(c)};this.setWorkDir=function(c){a.writeKeyComb("Windows+R",
20,function(){setTimeout(function(){a.writeText(c,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(c,e){a.authWithCode(c,e)};this.getPrinters=function(c){a.getPrinters(c)};this.attachPrinter=function(c){a.attachPrinter(c)};this.attachDirectory=function(c){a.attachDirectory(c)}}(n,ed),ae=new function(a,b){this.draw=a.draw;this.refresh=function(d,g,c,e){return a.repaint(d,g,c-d+1,e-g+1)};this.onfocus=function(d){var g=b.getFocused();Ya&&g&&g.railWin&&
(d=g.railWin.mainWin)&&_core.running()&&(g=g.context)&&g!=a.getContext()&&(a.setContext(null),d.activate(1),svGlobal.logger.info("Activate win:"+d.id))}}(va,ha);this.sendKeyboardSynchronize=function(a,b,d){Ta.sendKeyboardSynchronize(a,b,d)};this.VirtualChannel=function(){return new pb(143)};this.GatewayChannel=function(){return new pb(28)};this.DynamicChannel=function(){return new pb(64)};this.addChannel=function(a){mb[a.name]=a};this.addGatewayChannel=function(a){kb[a.name]=a};this.addDynamicChannel=
function(a){Ia.names.push(a.name);Ia[a.name]=a;Ia.count++};var Ua=null,Ia={count:0,names:[],usbChannel:null,close:function(){for(var a=Ia.names,b=0,d=a.length;b<d;b++){var g=Ia[a[b]];if(g&&g.onclose)g.onclose()}a.length=0;Ia.usbChannel=null},init:function(a,b,d,g,c,e){function f(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=
this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var w=this;this.fromBuffer=function(v,X){w.formatTag=v.getLittleEndian16();w.nChannels=v.getLittleEndian16();w.nSamplesPerSec=v.getLittleEndian32();w.nAvgBytesPerSec=v.getLittleEndian32();w.nBlockAlign=v.getLittleEndian16();w.bitsPerSample=v.getLittleEndian16();var y=v.getLittleEndian16();w.cbSize=y;0<y&&!0!==X&&(w.extenstion=Array(y),v.copyToByteArray(w.extenstion,0,v.getPosition(),y),v.skipPosition(y))};
this.toBuffer=function(v){v.setLittleEndian16(w.formatTag);v.setLittleEndian16(w.nChannels);v.setLittleEndian32(w.nSamplesPerSec);v.setLittleEndian32(w.nAvgBytesPerSec);v.setLittleEndian16(w.nBlockAlign);v.setLittleEndian16(w.bitsPerSample);v.setLittleEndian16(w.cbSize);0<w.cbSize&&v.setBytes(w.extenstion)};this.getSize=function(){return 18+w.cbSize};this.toString=function(){return"Audio Format, tag="+w.formatTag+" nChannels="+w.nChannels+" nSamplesPerSec="+w.nSamplesPerSec+" nAvgBytesPerSec="+w.nAvgBytesPerSec+
" nBlockAlign="+w.nBlockAlign+" bitsPerSample="+w.bitsPerSample+" cbSize="+w.cbSize}}function z(){Ua=new n.DynamicChannel;Ua.name="Microsoft::Windows::RDS::DisplayControl";Ua.enabled=!1;Ua.process=function(w){var v=w.getLittleEndian32();w.getLittleEndian32();switch(v){case 5:v=w.getLittleEndian32(),Ua.maxMonitorAreaFactorA=w.getLittleEndian32(),Ua.maxMonitorAreaFactorB=w.getLittleEndian32(),Ua.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+v+" factorA:"+Ua.maxMonitorAreaFactorA+
" factorB:"+Ua.maxMonitorAreaFactorB),w=new Uint8Array(2),w[0]=146,w[1]=4,za(w.buffer),Sa&&setTimeout(function(){Sa&&Sa.check(5E3)},1900)}};Ua.applyResolution=function(w,v){if(Ua.enabled){var X=new Uint8Array(56),y=new RdpBuffer(X,0,56);w=w>Ua.maxMonitorAreaFactorA?Ua.maxMonitorAreaFactorA:w&-4;v=v>Ua.maxMonitorAreaFactorB?Ua.maxMonitorAreaFactorB:v&-4;y.setLittleEndian32(2);y.setLittleEndian32(56);y.setLittleEndian32(40);y.setLittleEndian32(1);y.setLittleEndian32(1);y.setLittleEndian32(0);y.setLittleEndian32(0);
y.setLittleEndian32(w);y.setLittleEndian32(v);y.setLittleEndian32(.26458*w|0);y.setLittleEndian32(.26458*v|0);y.setLittleEndian32(w>v?0:90);y.setLittleEndian32(100);y.setLittleEndian32(100);Ua.send(X);svGlobal.logger.warn("Display control: "+w+"x"+v)}else svGlobal.logger.warn("Display control disabled.")};return Ua}if(!ja.disableDVC){if(ja.enableEcho){var x=new n.DynamicChannel;x.name="ECHO";x.process=function(w){var v=w.getPosition(),X=w.getEnd(),y=new Uint8Array(X-v);y.set(w.getData().subarray(v,
X));x.send(y)};n.addDynamicChannel(x)}if(a){var t=new n.DynamicChannel;t.name="Microsoft::Windows::RDS::Input";t.process=function(w){var v=w.getLittleEndian16();w.getLittleEndian32();switch(v){case 1:w.skipPosition(4),w=new RdpBuffer(new Uint8Array(16),0,16),w.setLittleEndian16(2),w.setLittleEndian32(16),w.setLittleEndian32(3),w.setLittleEndian32(65536),w.setLittleEndian16(256),w.markEnd(),t.send(w);case 5:ha.execute("setTouchRemoting",[!0]);Ia.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:ha.execute("setTouchRemoting",[!1]),Ia.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(t)}if(d){svGlobal.logger.warn("Audio input on");var J=new n.DynamicChannel;(function(){function w(R){var E=new RdpBuffer(new Uint8Array(5),0,5);E.setByte(7);E.setLittleEndian32(R);E.markEnd();J.send(E)}function v(R){var E=R.getLittleEndian32(),W=R.getLittleEndian32(),U=new f;U.fromBuffer(R,!0);var L=0,Y=0;0<U.cbSize&&(22==U.cbSize?(L=R.getLittleEndian16(),Y=R.getLittleEndian32(),
R.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+U.cbSize),R.skipPosition(U.cbSize)));R=y[W];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+E+" initial: "+W+", "+R.toString());svGlobal.logger.info("Open fmt: "+U.toString()+" validBits:"+L+" mask:"+Y);O=!0;P=n.reconnectOnResize;n.reconnectOnResize=!1;qa.onopen||(qa.onopen=function(T){if(Ja){X=T;n.reconnectOnResize=P;w(W);var ca=new RdpBuffer(new Uint8Array(5),0,5);ca.setByte(4);ca.setLittleEndian32(T?0:1);ca.markEnd();J.send(ca)}});
qa.ondata||(qa.ondata=function(T,ca){X&&(N.length!=ca+1&&(N=new Uint8Array(ca+1),N[0]=6),J.send(ba),N.set(T,1),J.send(N))});qa.start(R,E)}J.name="AUDIO_INPUT";J.process=function(R){var E=R.getByte();switch(E){case 1:R=R.getLittleEndian32();E=new RdpBuffer(new Uint8Array(5),0,5);E.setByte(1);E.setLittleEndian32(R);E.markEnd();J.send(E);break;case 2:var W=R.getLittleEndian32();R.getLittleEndian32();var U=hi5.audio.getAudioContext().sampleRate;for(E=y.length=0;E<W;E++){var L=new f;L.fromBuffer(R);svGlobal.logger.info("Server rec fmt "+
E+":"+L.toString());0==g&&49==L.formatTag&&22050==L.nSamplesPerSec?y.push(L):1==L.formatTag&&L.nSamplesPerSec<=U&&y.push(L)}J.send(ba);W=0;R=y.length;for(E=0;E<R;E++)W+=y[E].getSize();U=new RdpBuffer(new Uint8Array(1024),0,1024);U.setByte(2);U.setLittleEndian32(R);U.setLittleEndian32(W+9);for(E=0;E<R;E++)y[E].toBuffer(U),svGlobal.logger.info("Client rec fmt: "+y[E].toString());U.skipPosition(1024-W-9);U.markEnd();J.send(U);break;case 3:v(R);break;case 7:E=R.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+
y[E].toString()+" by client:"+O);O||(w(E),O=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+E)}};var X=!1,y=[];J.onclose=function(){X=!1;qa&&qa.close()};var ba=new Uint8Array(1);ba[0]=5;var O=!1,P=n.reconnectOnResize,N=new Uint8Array(0),ma=xa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),qa=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),ma):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();n.addDynamicChannel(J)}n.addDynamicChannel(function(){var w=
new n.DynamicChannel;w.name="TSMF";var v={type:"image/jpeg"},X=Array(1);w.process=function(y){y.getPosition();var ba=y.getLittleEndian32()&1073741823;var O=y.getLittleEndian32();var P=y.getLittleEndian32();switch(ba){case 2:if(256==P){y.getLittleEndian32();P=new Uint8Array(16);var N=new RdpBuffer(P,0,16);N.setLittleEndian32(2);N.setLittleEndian32(O);N.setLittleEndian32(1);N.setLittleEndian32(0);w.send(P)}break;case 0:switch(P){case 257:y.getBytes(16);y.getLittleEndian32();break;case 256:ba=y.getPosition();
N=y.getLittleEndian32();for(P=0;P<N;P++){y.getLittleEndian32();var ma=y.getLittleEndian32();y.getLittleEndian32();y.skipPosition(ma-4)}P=y.getPosition()-ba;N=P+8+4;P=new Uint8Array(N);N=new RdpBuffer(P,0,N);N.setLittleEndian32(-2147483648);N.setLittleEndian32(O);P.set(y.getData().subarray(ba,y.getPosition()),8);w.send(P);break;case 261:y.getBytes(16);y.getLittleEndian32();break;case 264:ba=y.getLittleEndian32();y.skipPosition(4);y.getLittleEndian32();ma=y.getBytes(16);var qa=y.getBytes(16);y.getLittleEndian32();
y.getLittleEndian32();y.getLittleEndian32();var R=y.getBytes(16);P=y.getLittleEndian32();y.skipPosition(P);P=new Uint8Array(20);N=new RdpBuffer(P,0,20);N.setLittleEndian32(-2147483648);N.setLittleEndian32(O);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],ma)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],qa)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],R)?N.setLittleEndian32(1):(N.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),
svGlobal.logger.warn(ma),svGlobal.logger.warn(qa),svGlobal.logger.warn(R));N.setLittleEndian32(ba);w.send(P);break;case 258:y.getBytes(16);y.getLittleEndian32();ba=y.getLittleEndian32();y.skipPosition(ba);break;case 263:y.getBytes(16),P=new Uint8Array(16),N=new RdpBuffer(P,0,16),N.setLittleEndian32(-2147483648),N.setLittleEndian32(O),N.setLittleEndian32(1),w.send(P);case 277:y.getBytes(16);y.getLittleEndian32();break;case 262:y.getBytes(16);va.flushImgs();va.setImgRect(0,0,0,0);P=new Uint8Array(12);
N=new RdpBuffer(P,0,12);N.setLittleEndian32(-2147483648);N.setLittleEndian32(O);w.send(P);break;case 278:y.getBytes(16);O=y.getLittleEndian32();P=y.getLittleEndian32();ba=y.getLittleEndian32();y=y.getLittleEndian32();va.setImgRect(O,P,ba-O,y-P);break;case 265:y.getBytes(16);y.getLittleEndian64();y.getLittleEndian32();break;case 266:y.getBytes(16);break;case 268:y.getBytes(16);break;case 267:y.getBytes(16);break;case 269:y.getBytes(16);y.getLittleEndian32();break;case 274:break;case 275:break;case 259:y.getBytes(16);
y.getLittleEndian32();y.getLittleEndian32();y.skipPosition(32);P=y.getLittleEndian32();O=new Image;ba=y.getPosition();X[0]=y.getData().subarray(ba,ba+P);y=new Blob(X,v);O.src=URL.createObjectURL(y);va.addImg(O);break;case 270:va.flushImgs();break;case 273:break;case 260:break;case 276:y.getBytes(16);P=y.getLittleEndian32();ba=y.getPosition()+P;y.skipPosition(8);O=y.getLittleEndian32();svGlobal.logger.info("window state:"+O);N=y.getLittleEndian32();ma=y.getLittleEndian32();O=y.getLittleEndian32();
P=y.getLittleEndian32();y.skipPosition(8);qa=y.getLittleEndian32();R=y.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+O+" top:"+P+" w:"+N+" h:"+ma+" cl:"+qa+" ct:"+R);y.setPosition(ba);ba=y.getLittleEndian32();for(ba=y.getPosition()+ba;y.getPosition()<ba;){qa=y.getLittleEndian32();R=y.getLittleEndian32();var E=y.getLittleEndian32(),W=y.getLittleEndian32();svGlobal.logger.info("visible region, l:"+R+" t:"+qa+" r:"+W+" b:"+E)}va.setImgRect(O,P,N,ma);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+
P)}break;default:svGlobal.logger.warn("unkown interface:"+ba)}};return w}());lb||n.addDynamicChannel(z());ja.enableDVCAudio&&n.addDynamicChannel(function(w,v,X){var y=!1,ba=0,O=0,P=0,N=0,ma=[],qa=new Uint8Array(4),R=new n.DynamicChannel;R.name="AUDIO_PLAYBACK_DVC";R.onclose=function(){};R.process=function(E){function W(Q,ra){if(22050>Q.nSamplesPerSec||41222==Q.formatTag&&0<X&&X!=Q.nAvgBytesPerSec)return!1;switch(ra){case 0:return 49==Q.formatTag&&22050==Q.nSamplesPerSec;case 1:return 1==Q.formatTag||
41222==Q.formatTag;case 2:return 1==Q.formatTag;case 3:return 49==Q.formatTag&&22050==Q.nSamplesPerSec;case 4:return 41222==Q.formatTag;default:return!0}}function U(Q){Q.skipPosition(14);var ra=Q.getLittleEndian16();Q.getByte();var k=Q.getLittleEndian16();Q.skipPosition(1);for(var m,l=ma.length=0;l<ra;l++){var h=new f;h.fromBuffer(Q);svGlobal.logger.info("Server audio fmt "+l+":"+h.toString());(m=W(h,w))&&ma.push(h)}P=-1;if(v){h=20;Q=ma.length;for(l=0;l<Q;l++)h+=ma[l].getSize();l=h+4;ra=new RdpBuffer(new Uint8Array(l),
0,l);ra.setByte(7);ra.setByte(2);ra.setLittleEndian16(h);ra.setLittleEndian32(3);ra.setLittleEndian32(4294967295);ra.setLittleEndian32(0);ra.setLittleEndian16(0);ra.setLittleEndian16(Q);ra.skipPosition(1);ra.setLittleEndian16(k);ra.setByte(124);for(l=0;l<Q;l++)h=ma[l],h.toBuffer(ra);ra.markEnd();R.send(ra);5<k&&(svGlobal.logger.info("Audio output, version: "+k),ra=new RdpBuffer(new Uint8Array(8),0,8),ra.setByte(12),ra.skipPosition(1),ra.setLittleEndian16(4),ra.setLittleEndian16(1),ra.setLittleEndian16(0),
ra.markEnd(),R.send(ra))}}function L(Q){var ra=Q.getLittleEndian16();Q=Q.getLittleEndian16();if(v){var k=new RdpBuffer(new Uint8Array(8),0,8);k.setByte(6);k.setByte(35);k.setLittleEndian16(4);k.setLittleEndian16(ra);k.setLittleEndian16(Q);k.markEnd();R.send(k)}}function Y(){var Q=ma[P];if(Q){if(Q.formatTag!=Ea.tag||Q.nAvgBytesPerSec!=Ea.nAvgBytesPerSec||Q.nSamplesPerSec!=Ea.samplePerSec||Ea.channels!=Q.nChannels)Ea.tag=Q.formatTag,Ea.channels=Q.nChannels,Ea.samplePerSec=Q.nSamplesPerSec,Ea.bitsPerSample=
49==Q.formatTag?8:Q.bitsPerSample,Ea.nBlockAlign=Q.nBlockAlign,Ea.nAvgBytesPerSec=Q.nAvgBytesPerSec,svGlobal.logger.info("DVC Audio Format, tag, "+P+":"+Q.toString()),41222==Ea.tag&&(Ea.sampleRate=Ea.samplePerSec,Wa.initMediaPlayer(Wa,Ea,!0))}else 41222!=Ea.tag&&(Ea.tag=41222,Ea.channels=2,Ea.bitsPerSample=16,Ea.sampleRate=44100,Ea.nBlockAlign=4,Ea.nAvgBytesPerSec=12E3,Wa.initMediaPlayer(Wa,Ea,!0))}function T(Q){O=Q.getLittleEndian16();var ra=Q.getLittleEndian16();N=Q.getByte();Q.skipPosition(3);
qa.set(Q.getSubarray(4));y=!0;ra!=P&&(P=ra,Y())}function ca(Q,ra){if(v){var k=new RdpBuffer(new Uint8Array(8),0,8);k.setByte(5);k.skipPosition(1);k.setLittleEndian16(4);k.setLittleEndian16(Q);k.setByte(ra);k.skipPosition(1);k.markEnd();R.send(k)}}function pa(Q){y=!1;var ra=ba-8;Date.now();Q.copyFromByteArray(qa,0,Q.getPosition(),4);pc(Q,N,O,ra);ca(O,N)}function ia(Q){Date.now();O=Q.getLittleEndian16();P=Q.getLittleEndian16();N=Q.getByte();Q.skipPosition(7);Y();pc(Q,N,O,0);ca(O,N)}if(y)pa(E);else{var da=
E.getByte();E.skipPosition(1);ba=E.getLittleEndian16();switch(da){case 7:U(E);break;case 6:L(E);break;case 2:T(E);break;case 3:E.getLittleEndian16();E.getLittleEndian16();break;case 13:ia(E)}}};return R}(g,0==n.mode,Zd));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var C=svGlobal.DCVC_EXTENSION;C.WEBAUTHN=function(w){function v(){if(ba){var O=Error("Cancelling existing WebAuthn API call for new one");O.name="WebAuthnAbortError";ba.abort(O)}ba=new AbortController;return ba.signal}function X(){if(ba){var O=
Error("Manually cancelling existing WebAuthn API call");O.name="WebAuthnAbortError";ba.abort(O);ba=void 0}}var y=new w;y.name="WebAuthN_Channel";y.newInstance=function(){return C.WEBAUTHN(w)};y.onopen=function(){svGlobal.logger.info("webAuthn open")};y.onclose=function(){svGlobal.logger.info("webAuthn close")};var ba=null;y.process=function(O){var P=O.getEnd()-O.getPosition();O=O.getBytes(P);var N=Jb(O),ma=N.command;P=N.flags;O=N.timeout;var qa=N.webAuthNPara;if(ma)switch(console.log("==== command: "+
N.command),ma){case 5:if(N.request)switch(ma=N.request[0],console.log("==== webAuth cmdType = "+ma),console.log("==== webAuth request bytes: "+Id(N.request.slice(1,N.request.length))),ma){case 1:N=N.request.slice(1,N.request.length);var R=Jb(N);N=R[1];var E=R[2],W=R[3],U=R[4],L=R[5];ma=R[6];var Y=R[7];R={};var T=Ed(qa);T&&(T.attestation&&(R.attestation=T.attestation),T.attestationFormats&&(R.attestationFormats=T.attestationFormats));if(P=Dd(P,qa,Y))R.authenticatorSelection=P;R.challenge=N;L&&(R.excludeCredentials=
Jc(L));R.rpId=E.id;R.rp=E;R.extensions=ma?ma:{};R.extensions.remoteDesktopClientOverride={origin:"https://"+relyingPartyInfo.id,sameOriginWithAncestors:!1};U&&(R.pubKeyCredParams=U);O&&(R.timeout=O);R.user=W;O={};O.signal=v();O.publicKey=R;navigator.credentials.create(O).then(function(ca){Fd(ca.response,E).then(function(pa){var ia={},da={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},
Q=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);da.aaGuid=Q.buffer;da.residentKey=!0;ia.deviceInfo=da;ia.status=0;ia.response=pa;pa=CBOR.encode(ia);ia=new hi5.DataBuffer(new Uint8Array(4+pa.byteLength));ia.setLittleEndian32(0);ia.setBytes(pa);ia.markEnd();y.send(ia)})}).catch(function(ca){console.log("WebAuthN MakeCredential failed with error code ["+ca.code+"], msg: "+ca.message);ca=new hi5.DataBuffer(new Uint8Array(4));ca.setLittleEndian32(1);ca.markEnd();y.send(ca)});
break;case 2:N=N.request.slice(1,N.request.length);R=Jb(N);N=R[2];W=R[3];ma=R[4];Y=R[5];R={};W&&(R.allowCredentials=Jc(W));R.challenge=N;ma&&(R.extensions=ma);R.rp=window.location.hostname;O&&(R.timeout=O);if(O=Ic(P,qa,Y))R.userVerification=O;O={};O.signal=v();O.publicKey=R;navigator.credentials.get(O).then(function(ca){ca=new hi5.DataBuffer(new Uint8Array(void 0));ca.markEnd();y.send(ca)}).catch(function(ca){console.log("WebAuthN GetAssertion failed with error code ["+ca.code+"], msg: "+ca.message);
ca=new hi5.DataBuffer(new Uint8Array(4));ca.setLittleEndian32(1);ca.markEnd();y.send(ca)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+ma)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:O=new hi5.DataBuffer(new Uint8Array(8));O.setLittleEndian32(0);P=Hc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;P?O.setLittleEndian32(1):O.setLittleEndian32(0);O.markEnd();y.send(O);break;case 7:X();O=new hi5.DataBuffer(new Uint8Array(4));
O.setLittleEndian32(0);O.markEnd();y.send(O);break;case 8:O=new hi5.DataBuffer(new Uint8Array(8));O.setLittleEndian32(0);O.setLittleEndian32(4);O.markEnd();y.send(O);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+ma)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return y};n.enableWebAuthn()&&Hc()&&(a=C.WEBAUTHN(n.DynamicChannel),n.addDynamicChannel(a));c&&(c=C.WEBCAM(n.DynamicChannel),a=C.WEBCAM_ENUM(n.DynamicChannel,c),n.addDynamicChannel(a),
n.addDynamicChannel(c));e&&(svGlobal.logger.info("Mapping USB..."),n.addDynamicChannel(Ia.usbChannel));if(b&&C.GFX){var A=function(){ab.drawable.resumePlay||(ab.drawable.resumePlay=function(){Wa&&Wa.supportWebAudio&&Wa.iOSFix();ab.resumeVideo()})};ab=C.GFX(n.DynamicChannel,S(I.remotefx)&&!S(I.gfx),0==n.mode,va,I.hardwareAcceleration,S(I.yuv444)&&hi5.browser.supportsI444);ab.onmessage=function(w){n.showMessage(w)};A();ab.onuserinteract=function(w){ha.execute("showPlay");A();svGlobal.logger.info("resumePlay");
return!0};ab.onfatalerror=function(w,v){n.reconnect(w.width,w.height,!0)};ab.onsps=function(w){w.fps&&n.setFPS(w.fps)};ab.onresetgraphic=function(w){n.setResolution(w.width,w.height)};ab.onmapsurface=function(w){ab.onconfirm();var v=ha.getMonitorSurface(w.outputOriginX,w.outputOriginY,w.targetWidth+w.outputOriginX-1,w.targetHeight+w.outputOriginY-1);v?(v.setId(w.id),v.setSize(w.targetWidth,w.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+w.outputOriginX+" y:"+w.outputOriginY)};ab.onconfirm=
function(){svGlobal.logger.info("GFXDrawableController in use");ha.execute("setDrawable",[ab.drawable])};n.addDynamicChannel(ab)}C.VOR&&(b=C.VOR(n.DynamicChannel),n.addDynamicChannel(b[0]),n.addDynamicChannel(b[1]),n.addDynamicChannel(C.GT(n.DynamicChannel)))}}},cb=null;svGlobal.DCVC_EXTENSION&&!lb&&(n.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ia.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(n.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(cb=svGlobal.DCVC_EXTENSION.DRIVE(n.GatewayChannel),n.addGatewayChannel(cb)));
this.getPrinters=function(a){if(!n.onagentmessage||!cb)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();n.onagentmessage(b.getData());cb.listCallback=a};this.attachPrinter=function(a){cb&&cb.attachPrinter(a,n)};this.attachDirectory=function(a){cb&&cb.attachDirectory(a,n)};this.showError=Ib;this.resetStatus=gc;this.exeAppCmd=function(a){var b=ha.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ha.getWinById(a):
ha.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,d){void 0==d&&(d=ja.forceReconnect||!1);if(!Ja&&!d)return!1;I.minWidth&&a<I.minWidth&&(a<I.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+I.minWidth),a=I.minWidth);I.minHeight&&b<I.minHeight&&(b<I.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+I.minHeight),b=I.minHeight);a&=-4;b&=-4;if(!d&&4>Math.abs(a-La)&&4>Math.abs(b-Ma))return!1;if(Ua&&
Ua.enabled&&!1!==ja.displayVC)Ua.applyResolution(a,b);else if(sc&&qb||d||Za&&!sc)qb=!1,svGlobal.logger.info("reconnecting..."),za("8E0"+a+"\t"+b),Ta&&(Ta.remoteLockFlags=0,Ta.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));za(a)};this.getUploadManager=function(){return Pa};this.setFPS=function(a){ha.execute("setFPS",[a])};this.addSurface=function(a){if(!ha.hasSurface(a)&&(Ob||va.setContext(a.context),!ha.hasSurface(a)||!a.railWin)){lb&&a.setPlayerMode();I.mouseMoveEmu&&
(a.mouseMoveEmu=S(I.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==La&&(La=b.width);0==Ma&&(Ma=b.height);a.setConfig(ja);ha.addSurface(a);Ra(La,Ma,!0,I.monitorDef?!0:!1);a.setController(Ta);a.setDrawable(ae);a.setTouchpad(S(I.touchpad));var d=b=S(I.mapClipboard),g=b;void 0!=I.copyToLocal?d=S(I.copyToLocal):void 0!=ja.copyToLocal&&(d=ja.copyToLocal);void 0!=I.copyToRemote?g=S(I.copyToRemote):void 0!=ja.copyToRemote&&(g=ja.copyToRemote);a.setClipboard(b,d,g);Nb&&hc(a);I.invitation&&
!S(I.control)&&(ha.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=I.ctrlToWin?S(I.ctrlToWin):void 0!=ja.ctrlToWin?ja.ctrlToWin:!0;d=void 0!=I.cmdToCtrl?S(I.cmdToCtrl):void 0!=ja.cmdToCtrl?ja.cmdToCtrl:!0;a.run(parseInt(I.keyboard||1033,10),b,!!ja.noKeyStuck,d)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,d=ha.size();b<d;b++)ha.getSurface(b).railWin.getMain(ha.zOrders)&&a.push(ha.getSurface(b).railWin.getMain(ha.zOrders).titleInfo);return a};this.startApp=
function(a,b,d){b=b||"";d=d||"";za("8C2"+a+"\t"+b+"\t"+d);var g=ha.getSurface(ha.size()-1);g&&(g.remoteApp=new Gc(a,b,d))};this.startExitingApp=function(a){a=ha.popWins(a);for(var b=a.length-1;0<=b;b--)ha.addWin(a[b])};var xb=new n.DynamicChannel;xb.name="PNPDR";xb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};xb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),
0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),xb.send(a)}};xb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};n.addDynamicChannel(xb);var ib=null;S(I.scanner)&&(ib=new n.DynamicChannel,ib.name="SCANNERDVC",ib.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},ib.process=function(a){var b=a.getByte();switch(b){case 0:var d=a.getByte(),g=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=d;b[3]=
g;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(n.onagentmessage)n.onagentmessage(b);break;case 1:break;case 2:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+2);b[0]=4;b[1]=3;b.set(a.getBytes(d),2);if(n.onagentmessage)n.onagentmessage(b);break;case 3:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(d),3);if(n.onagentmessage)n.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},
ib.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addDynamicChannel(ib));var db=null;n.hasSmartCard()&&(db=new n.GatewayChannel,db.name="SCARDSTB",db.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(n.onagentmessage)n.onagentmessage(a);S(I.passwordIsPin)&&n.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},db.process=
function(a){var b=a.getEnd()-a.getPosition(),d=a.getByte(),g=a.getByte();switch(d){case 1:switch(g){case 1:d=new Uint8Array(2);d[0]=3;d[1]=7;if(n.onagentmessage)n.onagentmessage(d);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;yb&&(b+=yb.length);gb&&(b+=gb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);yb?(b.setLittleEndian32(yb.length),b.setBytes(yb)):b.setLittleEndian32(0);gb?(b.setLittleEndian32(gb.length),b.setBytes(gb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);
b.setBytes(a);b.markEnd();if(n.onagentmessage)n.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);d=new Uint8Array(b);d[0]=3;d[1]=11;d.set(a,2);if(n.onagentmessage)n.onagentmessage(d);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(db)if(1==g){if(d=new Uint8Array(b),d[0]=3,d[1]=3,d.set(a.getBytes(b),2),n.onagentmessage)n.onagentmessage(d)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},db.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addGatewayChannel(db));r+="&connectType=7";(function(){var a=0,b=0,d=new n.GatewayChannel;d.name="MESSGSTB";d.onopen=function(){svGlobal.logger.info("Message Channel open")};d.process=function(g){if(0==g.getByte())g.getByte(),g.getByte(),g.getByte();else{var c=g.getByte(),e=g.getLittleEndian16(),
f=g.getLittleEndian16();if(0!=c)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(f){case 1:case 4097:f=new RdpBuffer(new Uint8Array(6),0,6);f.setByte(6);f.setByte(1);f.setLittleEndian16(e);f.setLittleEndian16(0);f.markEnd();d.send(f);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:e=g.getLittleEndian16();a+=e;break;case 43:case 1065:case 1577:43==f&&(c=g.getLittleEndian16(),a=a+c+8,g.skipPosition(c));g=g.has(4)?g.getLittleEndian32():0;a+=g;g=Date.now()-b;c=new RdpBuffer(new Uint8Array(14),
0,14);c.setByte(14);c.setByte(1);c.setLittleEndian16(e);c.setLittleEndian16(43==f?3:11);c.setLittleEndian32(g);c.setLittleEndian32(a);c.markEnd();d.send(c);break;case 2112:case 2176:case 2240:e=g.getLittleEndian32();f=g.getLittleEndian32();g=g.getLittleEndian32();vc={baseRTT:e,bandwidth:f,averageRTT:g};if(n.onnetworkresult)n.onnetworkresult(vc);break;default:svGlobal.logger.warn("Invalid network detect PDU",g)}}};d.onclose=function(){svGlobal.logger.info("MSG channel close")};n.addGatewayChannel(d)})();
this.getNetworkResult=function(){return vc};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var ic=new Map,jc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(db){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));
switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;db.send(a);break;case 8:ic.clear();jc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var d=b.getLittleEndian32(),g=document.getElementById("scardSelection");g||(g=document.createElement("div"),g.id="scardSelection",g.className="appdlg",document.body.appendChild(g));if(g)if(0==d)g&&(g.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",
b=new hi5.ui.Lightbox(g),b.onclose=function(){location.reload()},b.show());else{g.innerHTML=1<d?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<d;a++){var c=b.getLittleEndian32();c=b.getBytes(c);var e=b.getLittleEndian32();e=b.getAscllString(e,!1);var f=b.getLittleEndian32();f=b.getAscllString(f,!1);var z=b.getLittleEndian32();b.getAscllString(z,!1);z=b.getLittleEndian64();z=(new Date(1E3*
z)).toDateString();c=Jd(a,c,f,e,z);g.appendChild(c)}g.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);g.appendChild(b);g.innerHTML+="<br>";b=new hi5.ui.Lightbox(g,{btnYes:{}});b.onclose=function(){var x,t=document.querySelector('input[name="scard_name"]:checked');t&&(x=parseInt(t.value));yb=ic.get(x);sb=jc.get(x);x=document.getElementById("userPin").value;
gb=(new TextEncoder("utf-8")).encode(x);x=2;x=gb?x+4+gb.length:x+4;x=sb?x+4+sb.length:x+4;x=new Uint8Array(x);x=new hi5.DataBuffer(x);x.setByte(1);x.setByte(2);gb?(x.setLittleEndian32(gb.length),x.setBytes(gb)):x.setLittleEndian32(0);sb?(x.setLittleEndian32(sb.length),x.setAsciiString(sb,sb.length)):x.setLittleEndian32(0);db&&db.send(x)};document.getElementById("userPin").addEventListener("keypress",function(x){"Enter"===x.key&&(x.preventDefault(),document.getElementById("continue_button").click())});
b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),db.send(b));break;case 12:a[0]=1;a[1]=6;db.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(ib)switch(a[1]){case 2:b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));g=document.getElementById("dsSelection");g||(g=document.createElement("div"),g.id="dsSelection",g.className="appdlg",document.body.appendChild(g));if(0!=b.getLittleEndian16())g&&(g.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(g),b.onclose=function(){n.run()},b.show());else if(d=(a.byteLength-4)/41,0==d)g&&(g.innerHTML=
"<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(g),b.onclose=function(){n.run()},b.show());else if(1==d){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,n.onagentmessage)n.onagentmessage(b)}else if(g){g.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<d;a++)c=
b.getAscllString(41,!0),c=Kd(a,c),g.appendChild(c);g.innerHTML+="<br>";b=new hi5.ui.Lightbox(g,{btnYes:{}});b.onclose=function(){var x=0,t=document.querySelector('input[name="ds_name"]:checked');t&&(x=t.value);t=new Uint8Array(3);t[0]=4;t[1]=5;t[2]=x;if(n.onagentmessage)n.onagentmessage(t)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));ib.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));ib.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();n.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(g=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(g.major>
b||g.major==b&&g.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",g=n.getAgentLink(),hi5.notifications.notify({title:b,html:!0,msg:a+(': <a href="'+g+'">'+g+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);g=b.getLittleEndian32();d=[];for(a=0;a<g;a++)e=b.getLittleEndian32(),c=b.getUnicodeString(e),e=b.getLittleEndian32(),e=b.getUnicodeString(e),d.push({name:c,driver:e});
cb&&cb.listCallback&&(cb.listCallback(d),cb.listCallback=null)}break;case 7:cb.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var yb,gb,sb,lc={type:6,data:null};this.setAgentStatus=function(a){ad=a};this.getAgentStatus=function(){return ad};this.run=function(){var a;if(a=null==n.onagentmessage)a=1==n.mode?!1:n.hasSmartCard()||n.hasScanner()||S(I.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(n):(n.hasUSB()?ha.getFocused().requestUsbDevices(n.getUSB(),
function(b){Ia.usbChannel.openDevices(b);Kb()}):Kb(),Wa.supportWebAudio&&Wa.iOSFix())};this.getDesktop=function(){return va};this.mouseDown=function(a,b,d){Za&&za("80"+a+"\t"+b+"\t"+d)};this.mouseMove=function(a,b){Za&&za("82"+a+"\t"+b)};this.mouseUp=function(a,b,d){Za&&za("81"+a+"\t"+b+"\t"+d)};this.writeKeyCode=function(a,b){Za&&za("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Za&&("number"==typeof a?(za("840\t"+a),za("8449152\t"+a)):za("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,
b){n.reconnectOnResize&&(Ya?(nb&&(clearTimeout(nb),nb=0),a&=-4,b&=-4,nb=setTimeout(function(){document.hidden||(Ua&&Ua.enabled&&Ua.applyResolution(a,b),setTimeout(function(){n.writeRawInput("8C661441\t"+a+"\t"+b);3==n.windowState&&$c()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):n.running()&&(nb&&(clearTimeout(nb),nb=0),nb=setTimeout(function(){document.hidden||n.reconnect(a,b)},555)))};var Xa=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!n.sessionInfo.suppressOutput)return!1;
void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=cc,b[4]=cc>>8,b[5]=bc,b[6]=bc>>8,b[7]=dc,b[8]=dc>>8,b[9]=ec,b[10]=ec>>8);za(b.buffer);return!0};this.refreshOutput=function(a,b,d,g){var c=new Uint8Array(d?11:3);c[0]=146;c[1]=3;c[2]=2;d&&(c[3]=a,c[4]=a>>8,c[5]=b,c[6]=b>>8,c[7]=d,c[8]=d>>8,c[9]=g,c[10]=g>>8);za(c.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);za(b.buffer)};this.startPing=function(a,b){b=b||0;Sa||
(Sa=new hi5.tool.ResponseMonitor(function(){Za&&n.sendPing()},function(){if(Za&&n.onnoresponse)return n.onnoresponse()}));Sa.setInterval(a,b);var d=new Uint8Array(4);d[0]=146;d[1]=2;d[2]=a;d[3]=b;za(d.buffer);setTimeout(function(){Sa&&Sa.check()},1E3*(a+b));Na?Na.postMessage({type:0,cmd:6,start:1}):(Ha.onSlowPath=Ha.onFastPath=Qc,Ha.onReqHistory=function(){Qc(15555)})};this.stopPing=function(){Sa&&Sa.stop();Na?Na.postMessage({type:0,cmd:6,start:0}):Ha.onSlowPath=Ha.onFastPath=Ha.onReqHistory=null};
var $a=null,Wc=0;this.play=function(){za("F3")};this.pause=function(){za("F2")};this.scan=function(a){za("F4"+(a?"1":"0"))};this.seek=function(a){var b=ha.getFocused();b&&Ja&&(za("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),va&&va.pause(!0,void 0))};var Ea={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,sampleRate:22050,nBlockAlign:0,nAvgBytesPerSec:0,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},
fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Vc=!1;this.showMessage=function(a,b,d){n&&n.displayMsg&&a&&((b=b||ha.getFocused())?b.showMessage(a,d):("string"==typeof a&&(a={msg:a,timeout:d||0}),hi5.notifications.notify(a)))};this._unload=Ab;this.close=function(a){svGlobal.logger.info("closing...");a&&(hi5.appcfg.returnUrl=a);Ja&&Ya&&ha&&ja.closeRemoteApp&&ha.tryCloseRemoteApps();
va&&va.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Zc,2222)):Zc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(n.close):window.addEventListener("beforeunload",n.close,!1);Pb.searchStartCode=function(a,b){for(var d=b[0]+2,g=a.length,c;d<g;)if(c=a[d],1==c){if(0==a[d-1]&&0==a[d-2]){b[1]=0==a[d-3]?4:3;b[0]=d-b[1]+1;return}d+=3}else 0==c?d++:d+=3;b[0]=-1};tc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,
11025,8E3,7350];var Qb=new function(){this.SPS=new function(){function a(e,f){var z=8,x=8,t,J=[];for(t=0;t<e;t++)0!==x&&(x=f.readEG(),J.push(x),x=(z+x+256)%256),z=0===x?z:x;return J}function b(){var e=this.readBool();if(!e)return{hrd_parameters_present_flag:e};for(var f=this.readUEG(),z=this.readBits(4),x=this.readBits(4),t=[],J=0;J<=f;J++){var C=this.readUEG(),A=this.readUEG(),w=this.readBool();t.push({bit_rate_value_minus1:C,cpb_size_value_minus1:A,cbr_flag:w})}J=this.readBits(5);C=this.readBits(5);
A=this.readBits(5);w=this.readBits(5);return{hrd_parameters_present_flag:e,cpb_cnt_minus1:f,bit_rate_scale:z,cpb_size_scale:x,cpb_specs:t,initial_cpb_removal_delay_length_minus1:J,cpb_removal_delay_length_minus1:C,dpb_output_delay_length_minus1:A,time_offset_length:w}}function d(){var e=this.readUEG();if(0===e){var f=this.readUEG();return{pic_order_cnt_type:e,log2_max_pic_order_cnt_lsb_minus4:f}}if(1===e){f=this.readBool();var z=this.readEG(),x=this.readEG(),t=this.readUEG(),J=[];for(i=0;i<t;i++)J.push(this.readEG());
return{pic_order_cnt_type:e,delta_pic_order_always_zero_flag:f,offset_for_non_ref_pic:z,offset_for_top_to_bottom_field:x,numRefFramesInPicOrderCntCycle:t,refFramesInPicOrderCntCycles:J}}return{pic_order_cnt_type:e}}function g(){if(7>this.availabeBytes())return console.log("no enough SPS data"),null;var e=this.readU8();if(7!=(e&31))return console.error("Invalid SPS type: "+e,data),null;var f=this.readU8(),z=this.readBits(6);this.skipBits(2);var x=this.readU8(),t=this.readUEG();if(100===f||110===f||
122===f||244===f||44===f||83===f||86===f||118===f||128===f||138===f||139===f||134===f||135===f){var J=[],C=this.readUEG();var A=3===C?this.readBool():!1;var w=this.readUEG(),v=this.readUEG(),X=this.readBool(),y=this.readBool();if(y){var ba=3!==C?8:12;for(i=0;i<ba;i++){var O=null,P=this.readBool();P&&(O=6>i?a(16,this):a(64,this));J.push({seq_scaling_list_present_flag:P,seq_scalling_list:O})}}A={chroma_format_idc:C,separate_colour_plane_flag:A,bit_depth_luma_minus8:w,bit_depth_chroma_minus8:v,qpprime_y_zero_transform_bypass_flag:X,
seq_scaling_matrix_present_flag:y,seq_scaling_lists:J}}else A=null;J=this.readUEG();C=d.call(this);w=this.readUEG();v=this.readBool();X=this.readUEG();y=this.readUEG();ba=this.readBits(1);O=0===ba?this.readBool():!1;P=this.readBool();var N,ma=N=0,qa=0,R=0,E=this.readBool();E&&(N=this.readUEG(),ma=this.readUEG(),qa=this.readUEG(),R=this.readUEG());N={frame_cropping_flag:E,frameCropLeftOffset:N,frameCropRightOffset:ma,frameCropTopOffset:qa,frameCropBottomOffset:R};if(ma=this.readBool()){var W=this.readBool();
var U=0,L=[0,0],Y=1;if(W){U=this.readU8();switch(U){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:L=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}L&&(Y=
L[0]/L[1])}W={aspect_ratio_info_present_flag:W,aspect_ratio_idc:U,aspectRatio:L,aspectScale:Y};L=(U=this.readBool())?this.readBool():!1;U={overscan_info_present_flag:U,overscan_appropriate_flag:L};if(L=this.readBool()){Y=this.readBits(3);var T=this.readBool(),ca=null;if(this.readBool()){ca=this.readU8();var pa=this.readU8(),ia=this.readU8();ca={colour_primaries:ca,transfer_characteristics:pa,matrix_coefficients:ia}}L={video_signal_type_present_flag:L,video_format:Y,video_full_range_flag:T,colour_description:ca}}else L=
{video_signal_type_present_flag:L};(Y=this.readBool())?(T=this.readUEG(),ca=this.readUEG(),Y={chroma_loc_info_present_flag:Y,chroma_sample_loc_type_top_field:T,chroma_sample_loc_type_bottom_field:ca}):Y={chroma_loc_info_present_flag:Y};(T=this.readBool())?(ca=this.readU32(),pa=this.readU32(),ia=this.readBool(),T={timing_info_present_flag:T,num_units_in_tick:ca,time_scale:pa,fixed_frame_rate_flag:ia,frameDuration:pa/(2*ca)}):T={timing_info_present_flag:T,frameDuration:0};ca=b.call(this);pa=b.call(this);
ia=!1;if(pa.hrd_parameters_present_flag||ca.hrd_parameters_present_flag)ia=this.readBool();var da=this.readBool(),Q;if(Q=this.readBool()){qa=this.readBool();R=this.readUEG();E=this.readUEG();var ra=this.readUEG(),k=this.readUEG(),m=this.readUEG(),l=this.readUEG();Q={bitstream_restriction_flag:Q,motion_vectors_over_pic_boundaries_flag:qa,max_bytes_per_pic_denom:R,max_bits_per_mb_denom:E,log2_max_mv_length_horizontal:ra,log2_max_mv_length_vertical:k,max_num_reorder_frames:m,max_dec_frame_buffering:l}}else Q=
{bitstream_restriction_flag:Q}}W={vui_parameters_present_flag:ma,aspect_ratio:W,overscan:U,video_signal:L,chroma_loc:Y,timing:T,nalHrdParameters:ca,vclHrdParameters:pa,low_delay_hrd_flag:ia,picStructPresentFlag:da,bitstream_restriction:Q};U=Math.ceil((16*(X+1)-2*N.frameCropLeftOffset-2*N.frameCropRightOffset)*W.aspect_ratio.aspectScale);L=(2-ba)*(y+1)*16-(ba?2:4)*(N.frameCropTopOffset+N.frameCropBottomOffset);ma=W.timing.frameDuration;Y=this.data;T="avc1."+(0==Y[1]?"00":Y[1].toString(16));T+=0==Y[2]?
"00":Y[2].toString(16);T+=0==Y[3]?"00":Y[3].toString(16);return{nalType:e,profile_idc:f,constraint_set:z,level_idc:x,seq_parameter_set_id:t,chroma:A,log2_max_frame_num_minus4:J,picOrderCnt:C,max_num_ref_frames:w,gaps_in_frame_num_value_allowed_flag:v,pic_width_in_mbs_minus1:X,pic_height_in_map_units_minus1:y,frame_mbs_flags:ba,mb_adaptive_frame_field_flag:O,direct_8x8_inference_flag:P,frame_cropping:N,vui:W,width:U,height:L,fps:ma,codec:T}}function c(e,f){f.writeUEG(e.cpb_cnt_minus1);f.writeBits(e.bit_rate_scale,
4);f.writeBits(e.cpb_size_scale,4);for(var z=e.cpb_specs,x=0;x<=e.cpb_cnt_minus1;x++){var t=z[x];f.writeUEG(t.bit_rate_value_minus1);f.writeUEG(t.cpb_size_value_minus1);f.writeBool(t.cbr_flag)}f.writeBits(e.initial_cpb_removal_delay_length_minus1,5);f.writeBits(e.cpb_removal_delay_length_minus1,5);f.writeBits(e.dpb_output_delay_length_minus1,5);f.writeBits(e.time_offset_length,5)}this.read=function(e){return g.call(e)};this.write=function(e,f){f.writeU8(e.nalType);f.writeU8(e.profile_idc);f.writeBits(e.constraint_set,
6);f.writeBits(0,2);f.writeU8(e.level_idc);f.writeUEG(e.seq_parameter_set_id);if(e.chroma&&(f.writeUEG(e.chroma.chroma_format_idc),3===e.chroma.chroma_format_idc&&f.writeBool(e.chroma.separate_colour_plane_flag),f.writeUEG(e.chroma.bit_depth_luma_minus8),f.writeUEG(e.chroma.bit_depth_chroma_minus8),f.writeBool(e.chroma.qpprime_y_zero_transform_bypass_flag),f.writeBool(e.chroma.seq_scaling_matrix_present_flag),e.chroma.seq_scaling_matrix_present_flag))for(var z=3!==e.chroma.chroma_format_idc?8:12,
x=e.chroma.seq_scaling_lists,t=0;t<z;t++){var J=x[t],C=J.seq_scaling_list_present_flag;f.writeBool(C);if(C){C=J.seq_scalling_list;J=C.length;for(var A=0;A<J;A++)f.writeUEG(C[A])}}f.writeUEG(e.log2_max_frame_num_minus4);t=e.picOrderCnt;f.writeUEG(t.pic_order_cnt_type);if(0===t.pic_order_cnt_type)f.writeUEG(t.log2_max_pic_order_cnt_lsb_minus4);else if(1===t.pic_order_cnt_type)for(f.writeBool(t.delta_pic_order_always_zero_flag),f.writeEG(t.offset_for_non_ref_pic),f.writeEG(t.offset_for_top_to_bottom_field),
z=t.refFramesInPicOrderCntCycles,J=t.numRefFramesInPicOrderCntCycle||z.length,f.writeUEG(J),t=0;t<J;t++)f.writeEG(z[t]);f.writeUEG(e.max_num_ref_frames);f.writeBool(e.gaps_in_frame_num_value_allowed_flag);f.writeUEG(e.pic_width_in_mbs_minus1);f.writeUEG(e.pic_height_in_map_units_minus1);f.writeBool(e.frame_mbs_flags);e.frame_mbs_flags||f.writeBool(e.mb_adaptive_frame_field_flag);f.writeBool(e.direct_8x8_inference_flag);t=e.frame_cropping;f.writeBool(t.frame_cropping_flag);t.frame_cropping_flag&&(f.writeUEG(t.frameCropLeftOffset),
f.writeUEG(t.frameCropRightOffset),f.writeUEG(t.frameCropTopOffset),f.writeUEG(t.frameCropBottomOffset));e=e.vui;f.writeBool(e.vui_parameters_present_flag);e.vui_parameters_present_flag&&(t=e.aspect_ratio,f.writeBool(t.aspect_ratio_info_present_flag),t.aspect_ratio_info_present_flag&&(f.writeU8(t.aspect_ratio_idc),255===t.aspect_ratio_idc&&(f.writeU8(t.aspectRatio[0]>>>8&255),f.writeU8(t.aspectRatio[0]&255),f.writeU8(t.aspectRatio[1]>>>8&255),f.writeU8(t.aspectRatio[1]&255))),t=e.overscan,f.writeBool(t.overscan_info_present_flag),
t.overscan_info_present_flag&&f.writeBool(t.overscan_appropriate_flag),t=e.video_signal,f.writeBool(t.video_signal_type_present_flag),t.video_signal_type_present_flag&&(f.writeBits(t.video_format,3),f.writeBool(t.video_full_range_flag),f.writeBool(t.colour_description_present_flag),t.colour_description_present_flag&&(t=t.colour_description,f.writeU8(t.colour_primaries),f.writeU8(t.transfer_characteristics),f.writeU8(t.matrix_coefficients))),t=e.chroma_loc,f.writeBool(t.chroma_loc_info_present_flag),
t.chroma_loc_info_present_flag&&(f.writeUEG(t.chroma_sample_loc_type_top_field),f.writeUEG(t.chroma_sample_loc_type_bottom_field)),t=e.timing,f.writeBool(t.timing_info_present_flag),t.timing_info_present_flag&&(f.writeU32(t.num_units_in_tick),f.writeU32(t.time_scale),f.writeBool(t.fixed_frame_rate_flag)),t=e.nalHrdParameters,z=e.vclHrdParameters,f.writeBool(t.hrd_parameters_present_flag),t.hrd_parameters_present_flag&&c(t),f.writeBool(z.hrd_parameters_present_flag),z.hrd_parameters_present_flag&&
c(z),(z.hrd_parameters_present_flag||t.hrd_parameters_present_flag)&&f.writeBool(e.low_delay_hrd_flag),f.writeBool(e.picStructPresentFlag),e=e.bitstream_restriction,f.writeBool(e.bitstream_restriction_flag),e.bitstream_restriction_flag&&(f.writeBool(e.motion_vectors_over_pic_boundaries_flag),f.writeUEG(e.max_bytes_per_pic_denom),f.writeUEG(e.max_bits_per_mb_denom),f.writeUEG(e.log2_max_mv_length_horizontal),f.writeUEG(e.log2_max_mv_length_vertical),f.writeUEG(e.max_num_reorder_frames),f.writeUEG(e.max_dec_frame_buffering)))}}};
Rb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Rb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,d,g,c,e){function f(E,W,U,L){this.pixels=E;this.width=W;this.height=U;this.key=L}function z(){this.bottom=this.right=this.top=this.left=0;this.read=function(E){this.left=E.getLittleEndian16();
this.top=E.getLittleEndian16();this.right=E.getLittleEndian16();this.bottom=E.getLittleEndian16()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom}}function x(){this.qualityVal=this.p=this.qb=0;this.read=function(E){var W=E.getByte();this.qp=W&63;this.p=W>>7&1;this.qualityVal=E.getByte()}}function t(E,W,U){this.bitstream=E;this.regionRects=W;this.isChroma=U;this.timestamp=0}function J(E,W,U){this.width=E;this.height=W;this.monitors=
U}function C(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(E){this.left=E.getLittleEndian32();this.top=E.getLittleEndian32();this.right=E.getLittleEndian32();this.bottom=E.getLittleEndian32();this.flags=E.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function A(E,W,U,L,Y){function T(){Q=!1;ra.drawable=ia._video;ia._player=ca?new Xd(ia,!1,L,Y):new Rb(ra.drawable,
ia,!1);ia._player.onsps=function(l){console.log("*** SPS: "+l.width+"x"+l.height);ca&&(ia._video.width=l.width,ia._video.height=l.height);ia.onsps&&ia.onsps(l)};ia._player.onerror=function(l){ia.onfatalerror&&ia.onfatalerror(ia,l)};ia._player.onplayerror=function(l){function h(){ra={drawable:ia._video};ia.player.play(!0)}ra=null;if((!ia.onuserinteract||!ia.onuserinteract(h,"video"))&&ia.onmessage)ia.onmessage({msg:"Please click Yes to continue.<br>"+l,cbYes:function(){ia.player.play(!0);this.destroy()}})};
ia._player.onframedecoded=function(l,h){if(!m)if(h)for(var q=h.length,u=0;u<q;u++){var D=h[u],F=D.right-D.left,B=D.bottom-D.top;pa.drawImage(l,D.left,D.top,F,B,D.left,D.top,F,B)}else pa.drawImage(l,0,0)}}this.id=E;this.width=W;this.height=U;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=W;this.targetHeight=U;this._player=null;var ca="no-decoder"==L?!1:!!window.VideoDecoder;this._video=ca?new OffscreenCanvas(W,U):document.createElement("video");var pa=ca?this._video.getContext("2d",
{alpha:!1,desynchronized:!0,antialias:!1,powerPreference:"high-performance"}):null,ia=this,da=null,Q=!0,ra={drawable:null},k=10,m=!1;ca&&(svGlobal.logger.info("...MediaDecoder in use: "+L),pa.imageSmoothingEnabled=!1);this.pause=function(l,h){m=l;h&&pa&&pa.fillRect(0,0,_screen.width,_screen.height)};this.resumeVideo=function(){ia._player&&ia._player.play(!0)};this.setDisplayBuffer=function(l){da=l};this.draw=function(l,h,q,u){return Q?da.draw(l,h,q,u):ra};this.processAvc=function(l){Q&&T();if(ca)l.timestamp=
k,k+=10;else if(l.isChroma)return;ia.onvideoframe(l)};this.reset=function(l,h){ia&&ia._player&&ia._player.reset()};this.close=function(){ia&&ia._player&&(ia._player.close(),ia._player=null);ia=null};this.setRGBs=function(l,h,q,u,D,F,B){da.setRGBs(l,h,q,u,D,F,B)};this.getRGBs=function(l,h,q,u){return da.getRGBs(l,h,q,u)};this.moveArea=function(l,h,q,u,D,F){da.moveArea(l,h,q,u,D,F)};this.fillRect=function(l,h,q,u,D){da.fillRect(l,h,q,u,D)};this.postPaint=function(l,h,q,u){Q&&da.postPaint(l,h,q,u)}}
function w(E,W,U,L){var Y=new A(E,W,U,c,e);Y.pixelFormat=L||33;Y.setDisplayBuffer(g);R.push(Y);qa.oncreatesurface&&qa.oncreatesurface(Y);svGlobal.logger.info("create surface id:"+E+" w:"+W+" h:"+U+" pixelFmt:"+Y.pixelFormat);return Y}function v(E,W,U){for(var L=E.getPosition(),Y=E.getLittleEndian32(),T=Array(Y),ca=0;ca<Y;ca++){var pa=new z;pa.read(E);T[ca]=pa}pa=Array(Y);for(ca=0;ca<Y;ca++){var ia=new x;ia.read(E);pa[ca]=ia}E=E.getBytes(W-(E.getPosition()-L));return new t(E,T,U)}function X(E,W,U,
L){U=E.getLittleEndian32();var Y=U>>>30;U&=1073741823;switch(Y){case 0:var T=v(E,U,!1);var ca=v(E,W-U-4,!0);break;case 1:T=v(E,U,!1);break;case 2:W=E.getEnd()-E.getPosition();ca=v(E,W,!0);break;default:console.error("Invalid LC: "+Y)}T&&L.processAvc(T);ca&&L.processAvc(ca)}var y=new function(){function E(h,q,u,D,F){this.len=h;this.code=q;this.valueBits=u;this.type=D;this.vbase=F}function W(h){var q=25E5-T,u=h.length;if(q>=u)Y.set(h,T),T=q>u?T+u:0;else if(25E5>=u)Y.set(h.subarray(0,q),T),Y.set(h.subarray(q),
0),T=u-q;else{q=(u-q)%25E5;var D=u-q,F=h.subarray(D);h=h.subarray(u-25E5,D);Y.set(h,25E5-h.length);Y.set(F,0);T=q}}function U(h){for(;Q<h;)da<<=8,ra<m?da+=k[ra++]:console.log("--- end"),Q+=8;ia-=h;Q-=h;h=da>>Q;da&=(1<<Q)-1;return h}var L=[new E(1,0,8,0,0),new E(5,17,5,1,0),new E(5,18,7,1,32),new E(5,19,9,1,160),new E(5,20,10,1,672),new E(5,21,12,1,1696),new E(5,24,0,0,0),new E(5,25,0,0,1),new E(6,44,14,1,5792),new E(6,45,15,1,22176),new E(6,52,0,0,2),new E(6,53,0,0,3),new E(6,54,0,0,255),new E(7,
92,18,1,54944),new E(7,93,20,1,317088),new E(7,110,0,0,4),new E(7,111,0,0,5),new E(7,112,0,0,6),new E(7,113,0,0,7),new E(7,114,0,0,8),new E(7,115,0,0,9),new E(7,116,0,0,10),new E(7,117,0,0,11),new E(7,118,0,0,58),new E(7,119,0,0,59),new E(7,120,0,0,60),new E(7,121,0,0,61),new E(7,122,0,0,62),new E(7,123,0,0,63),new E(7,124,0,0,64),new E(7,125,0,0,128),new E(8,188,20,1,1365664),new E(8,189,21,1,2414240),new E(8,252,0,0,12),new E(8,253,0,0,56),new E(8,254,0,0,57),new E(8,255,0,0,102),new E(9,380,22,
1,4511392),new E(9,381,23,1,8705696),new E(9,382,24,1,17094304)],Y=new Uint8Array(25E5),T=0,ca=new Uint8Array(65536),pa=0,ia=0,da=0,Q=0,ra=0,k=null,m=0,l=!0;this.toPDU=function(h){if(l)return null;30==h&&n.reconnect(n.widthRdp,n.heightRdp,!0);var q=new Uint8Array(2500008);q[0]=h;q[2]=1;q[3]=10;q[4]=T;q[5]=T>>8;q[6]=T>>16;q[7]=T>>24;q.set(Y,8);return q};this.fromStream=function(h){T=h.getLittleEndian32();Y.set(h.getSubarray(25E5))};this.decompress=function(h,q){if(q){k=h;l&&(l=!1);m=k.length-1;ia=
8*m-k[m];for(pa=ra=Q=da=0;0<ia;)for(var u=q=0,D=0;D<L.length;D++){for(h=L[D];q<h.len;)u=(u<<1)+U(1),q++;0>u&&console.log("xxx inPrefix");if(u==h.code){if(0==h.type)h=h.vbase+U(h.valueBits),(0>h||255<h)&&console.log("xxx do c"),h&=255,Y[T]=h,25E5==++T&&(T=0),ca[pa++]=h;else if(q=U(h.valueBits),q=h.vbase+q,0>q&&console.log("xxx distance"),0!=q){if(0==U(1))h=3;else{h=4;for(u=2;1==U(1);)h*=2,u++;h+=U(u)}q=25E5-q+T;q%=25E5;u=q+h;if(Math.abs(T-q)>=h&&25E5>u&&25E5>T+h)q=Y.subarray(q,u),Y.set(q,T),T+=h,ca.set(q,
pa),pa+=h;else for(;0<h;)u=Y[q],25E5==++q&&(q=0),Y[T]=u,25E5==++T&&(T=0),ca[pa++]=u,h--}else h=U(15),ia-=Q,da=Q=0,q=k.subarray(ra,ra+h),W(q),ca.set(q,pa),ra+=h,pa+=h,ia-=8*h;break}}65536<pa&&console.error("xx outputIndex:"+pa);return ca.subarray(0,pa)}W(h);return h}},ba=new function(){this.process=function(E){var W=E.getByte();if(224==W){var U=0!=(E.getByte()&32);var L=E.getPosition(),Y=E.getEnd();W=y.decompress(E.getData().subarray(L,Y),U);E.setPosition(Y)}else{225!=W&&console.log("Invalid descriptor:"+
W);Y=E.getLittleEndian16();var T=E.getLittleEndian32();W=new Uint8Array(T);for(var ca=0,pa,ia=0;ia<Y;ia++)pa=E.getLittleEndian32(),U=0!=(E.getByte()&32),pa--,L=E.getPosition(),U=y.decompress(E.getData().subarray(L,L+pa),U),W.set(U,ca),ca+=U.length,E.skipPosition(pa);ca!=T&&console.error("wrong size, actual:"+ca+" expected:"+T)}return new RdpBuffer(W,0,W.length)}},O=null,P=new rdpcodecs.RemoteFX(!1),N=0,ma=[],qa=new a;qa.name="Microsoft::Windows::RDS::Graphics";var R=new function(E,W){var U=[];this.push=
function(L){L.onsps=E.onsps;L.onfatalerror=E.onfatalerror;L.onplayerror=E.onplayerror;L.onuserinteract=E.onuserinteract;L.onmessage=E.onmessage;U[L.id]=L};this.get=function(L){return U[L]};this.getAll=function(){return U};this.delete=function(L){var Y=U[L];Y&&(Y.onsps=null,Y.onfatalerror=null,Y.onplayerror=null,U[L]=null)};this.reset=function(L){L=0;for(var Y=U.length;L<Y;L++)U[L]&&U[L].reset()};this.close=function(){for(var L=0,Y=U.length;L<Y;L++)U[L]&&U[L].close()};this.resumeVideo=function(){for(var L=
0,Y=U.length;L<Y;L++)U[L]&&U[L].resumeVideo()};W.pause=function(L,Y){for(var T=0,ca=U.length;T<ca;T++)U[T]&&U[T].pause(L,Y)}}(qa,g);qa.drawable=new function(){this.draw=function(E,W,U,L,Y){return(Y=R.get(Y))?Y.draw(E,W,U,L):null};this.getSurfaces=function(){return R};this.onfocus=function(E){};this.resumePlay=null};qa.resumeVideo=function(){R.resumeVideo()};qa.process=function(E){for(var W=ba.process(E);W.has(8);){var U=W.getLittleEndian16();W.getLittleEndian16();var L=W.getLittleEndian32(),Y=W.getPosition()+
L-8;switch(U){case 1:var T=W,ca=T.getLittleEndian16(),pa=T.getLittleEndian16(),ia=T.getByte(),da=T.getLittleEndian16(),Q=T.getLittleEndian16(),ra=T.getLittleEndian16(),k=T.getLittleEndian16(),m=ra-da,l=k-Q,h=T.getLittleEndian32(),q=T.getPosition()+h,u=R.get(ca);u||(qa.onconfirm&&qa.onconfirm(),u=w(ca,g.width,g.height,ia));switch(pa){case 0:var D=rdpcodecs.bitmap.byte2int(T.getData(),h,T.getPosition());u.setRGBs(da,Q,m,l,D,0,m);break;case 3:for(var F=P.decode(T,h),B=F.getRects(),Z=F.getTiles(),K=F.getTileSize(),
ka=F.getRectSize(),ua=0;ua<K;ua++){var p=Z[ua];if(ka)for(var G=p.x+64,M=p.y+64,aa=0;aa<ka;aa++){var na=B[aa],ta=na.x+na.width,ya=na.y+na.height;G<=ta?M<=ya?u.setRGBs(p.x+da,p.y+Q,64,64,p.data,0,64):u.setRGBs(p.x+da,p.y+Q,64,ya-p.y,p.data,0,64):M<=ya?u.setRGBs(p.x+da,p.y+Q,ta-p.x,64,p.data,0,64):u.setRGBs(p.x+da,p.y+Q,ta-p.x,ya-p.y,p.data,0,64)}else u.setRGBs(p.x,p.y,64,64,p.data,0,4)}break;case 8:O||(O=new ClearDecoder);O.decode(T,m,l,u.getData(),da,Q,u.width);break;case 10:svGlobal.logger.info("...PLANAR");
break;case 11:var Ca=u,Aa=v(T,h,!1);Ca.processAvc(Aa);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:X(T,h,!1,u);break;case 15:X(T,h,!0,u);break;default:svGlobal.logger.warn("Invalid codec:"+pa)}T.setPosition(q);u.postPaint(da,Q,m,l);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Da=W;svGlobal.logger.info("...soliFill");for(var wa=Da.getLittleEndian16(),Ga=-16777216|Da.getByte()<<
16|Da.getByte()<<8|Da.getByte()|Da.getByte()<<24,Qa=Da.getLittleEndian16(),Va=R.get(wa),Ka=0;Ka<Qa;Ka++){var Oa=Da.getLittleEndian16(),Eb=Da.getLittleEndian16(),wb=Da.getLittleEndian16()-Oa,rb=Da.getLittleEndian16()-Eb;Va.fillRect(Oa,Eb,wb,rb,Ga);Va.postPaint(Oa,Eb,wb,rb)}break;case 5:var bb=W;svGlobal.logger.info("...surfaceToSurface");for(var fd=bb.getLittleEndian16(),gd=bb.getLittleEndian16(),Tb=bb.getLittleEndian16(),Ub=bb.getLittleEndian16(),Vb=bb.getLittleEndian16()-Tb,zc=bb.getLittleEndian16()-
Ub,be=bb.getLittleEndian16(),hd=R.get(fd),ce=R.get(gd),id=fd==gd?null:hd.getRGBs(Tb,Ub,Vb,zc),jd=0;jd<be;jd++){var kd=bb.getLittleEndian16(),ld=bb.getLittleEndian16();id?ce.setRGBs(kd,ld,Vb,zc,id,0,Vb):hd.moveArea(Tb,Ub,Vb,zc,kd-Tb,ld-Ub)}break;case 6:var ob=W;svGlobal.logger.info("...surfaceToCache");var de=ob.getLittleEndian16(),Ac=ob.getLittleEndian32().toString(16),md=ob.getLittleEndian32();0<md&&(Ac=md.toString(16)+Ac);var ee=ob.getLittleEndian16(),nd=ob.getLittleEndian16(),od=ob.getLittleEndian16(),
pd=ob.getLittleEndian16()-nd,qd=ob.getLittleEndian16()-od,fe=R.get(de).getRGBs(nd,od,pd,qd);ma[ee]=new f(fe,pd,qd,Ac);break;case 7:var Fb=W;svGlobal.logger.info("...cacheToSurface");for(var ge=Fb.getLittleEndian16(),he=Fb.getLittleEndian16(),ie=Fb.getLittleEndian16(),Wb=ma[ge],je=R.get(he),rd=0;rd<ie;rd++){var ke=Fb.getLittleEndian16(),le=Fb.getLittleEndian16();je.setRGBs(ke,le,Wb.width,Wb.height,Wb.pixels,0,Wb.width)}break;case 8:var me=W.getLittleEndian16();ma[me]=null;break;case 9:var Xb=W,ne=
Xb.getLittleEndian16(),oe=Xb.getLittleEndian16(),pe=Xb.getLittleEndian16(),qe=Xb.getByte();w(ne,oe,pe,qe);break;case 10:var sd=W.getLittleEndian16();R.delete(sd);svGlobal.logger.info("delete surface id:"+sd);break;case 11:var td=W;td.getLittleEndian32();td.getLittleEndian32();break;case 12:var re=W.getLittleEndian32();if(0==N){var ud=new Uint8Array(20),tb=new RdpBuffer(ud);tb.setLittleEndian16(13);tb.setLittleEndian16(0);tb.setLittleEndian32(20);tb.setLittleEndian32(4294967295);tb.setLittleEndian32(re);
N++;tb.setLittleEndian32(N);tb.markEnd();d&&qa.send(ud)}break;case 14:var Yb=W,vd=Yb.getLittleEndian32(),wd=Yb.getLittleEndian32(),Bc=Yb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+vd+" h:"+wd+" monitors:"+Bc);for(var xd=Array(Bc),Zb=0;Zb<Bc;Zb++){var Cc=new C;Cc.read(Yb);xd[Zb]=Cc;svGlobal.logger.info("MonitorDef "+Zb+": "+Cc.toString())}var yd=new J(vd,wd,xd);R.reset(yd);qa.onresetgraphic&&qa.onresetgraphic(yd);break;case 15:var $b=W,zd=$b.getLittleEndian16();$b.skipPosition(2);
var Gb=R.get(zd);Gb.outputOriginX=$b.getLittleEndian32();Gb.outputOriginY=$b.getLittleEndian32();qa.onmapsurface&&qa.onmapsurface(Gb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+zd+" outX:"+Gb.outputOriginX+" outY:"+Gb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var Dc=W,Ad=Dc.getLittleEndian32(),se=Dc.getLittleEndian32(),Hb=Dc.getLittleEndian32(),ac=!1;switch(Ad){case 524292:ac=!1;0==(Hb&1)&&(O=new ClearDecoder);break;
case 524549:(ac=0!=(Hb&16))||0!=(Hb&1)||(O=new ClearDecoder);break;default:ac=0==(Hb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+Ad.toString(16)+" len:"+se+" flags:"+Hb+" h264:"+ac);qa.onconfirm&&qa.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var zb=W,Bd=zb.getLittleEndian16();zb.skipPosition(2);var jb=R.get(Bd);jb.outputOriginX=zb.getLittleEndian32();jb.outputOriginY=zb.getLittleEndian32();jb.targetWidth=zb.getLittleEndian32();jb.targetHeight=zb.getLittleEndian32();
svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+Bd+" outX:"+jb.outputOriginX+" outY:"+jb.outputOriginY+" targetW:"+jb.targetWidth+" targetH:"+jb.targetHeight);qa.onmapsurface&&qa.onmapsurface(jb);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+U);return}W.setPosition(Y)}};qa.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var E=b?2:8,W=10+12*E,U=new Uint8Array(W),L=new RdpBuffer(U);L.setLittleEndian16(18);
L.setLittleEndian16(0);L.setLittleEndian32(W);L.setLittleEndian16(E);L.setLittleEndian32(524292);L.setLittleEndian32(4);L.setLittleEndian32(b?1:0);L.setLittleEndian32(524549);L.setLittleEndian32(4);L.setLittleEndian32(b?19:0);b||(L.setLittleEndian32(655362),L.setLittleEndian32(4),L.setLittleEndian32(0),L.setLittleEndian32(655872),L.setLittleEndian32(4),L.setLittleEndian32(0),L.setLittleEndian32(656129),L.setLittleEndian32(4),L.setLittleEndian32(0),L.setLittleEndian32(656384),L.setLittleEndian32(4),
L.setLittleEndian32(0),L.setLittleEndian32(656642),L.setLittleEndian32(4),L.setLittleEndian32(0),L.setLittleEndian32(656896),L.setLittleEndian32(4),L.setLittleEndian32(0));L.markEnd();d&&qa.send(U)};qa.onclose=function(){R.close()};g.onGetGfxHistory=function(E,W,U){var L=y.toPDU(E);L&&W(L);U(E);svGlobal.logger.info("Got GFX Histroy")};g.onSetGfxHistory=function(E,W){svGlobal.logger.info("Set GFX Histroy");10==E?y.fromStream(W):svGlobal.logger.error("Invalid GFX histroy type: "+E)};return qa}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var r=navigator&&(navigator.language||navigator.userLanguage||""),H=Rdp.languageToKeyboard[r];if(!H){var V=r.indexOf("-");V&&(H=Rdp.languageToKeyboard[r.substring(0,V)])}H||(svGlobal.logger.info("No valid layout for "+r),H=1033);return H}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
