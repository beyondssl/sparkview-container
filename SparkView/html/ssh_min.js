var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(k,t,p){if(null==k)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return k+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(k,t,p){if(k==Array.prototype||k==Object.prototype)return k;k[t]=p.value;return k};
$jscomp.getGlobal=function(k){k=["object"==typeof globalThis&&globalThis,k,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<k.length;++t){var p=k[t];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(k,t){var p=$jscomp.propertyToPolyfillSymbol[t];if(null==p)return k[t];p=k[p];return void 0!==p?p:k[t]};$jscomp.polyfill=function(k,t,p,x){t&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(k,t,p,x):$jscomp.polyfillUnisolated(k,t,p,x))};
$jscomp.polyfillUnisolated=function(k,t,p,x){p=$jscomp.global;k=k.split(".");for(x=0;x<k.length-1;x++){var y=k[x];if(!(y in p))return;p=p[y]}k=k[k.length-1];x=p[k];t=t(x);t!=x&&null!=t&&$jscomp.defineProperty(p,k,{configurable:!0,writable:!0,value:t})};
$jscomp.polyfillIsolated=function(k,t,p,x){var y=k.split(".");k=1===y.length;x=y[0];x=!k&&x in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ca=0;ca<y.length-1;ca++){var X=y[ca];if(!(X in x))return;x=x[X]}y=y[y.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?x[y]:null;t=t(p);null!=t&&(k?$jscomp.defineProperty($jscomp.polyfills,y,{configurable:!0,writable:!0,value:t}):t!==p&&($jscomp.propertyToPolyfillSymbol[y]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(y):$jscomp.POLYFILL_PREFIX+
y,y=$jscomp.propertyToPolyfillSymbol[y],$jscomp.defineProperty(x,y,{configurable:!0,writable:!0,value:t})))};$jscomp.polyfill("String.prototype.startsWith",function(k){return k?k:function(t,p){var x=$jscomp.checkStringArgs(this,t,"startsWith");t+="";var y=x.length,ca=t.length;p=Math.max(0,Math.min(p|0,x.length));for(var X=0;X<ca&&p<y;)if(x[p++]!=t[X++])return!1;return X>=ca}},"es6","es3");
$jscomp.polyfill("String.fromCodePoint",function(k){return k?k:function(t){for(var p="",x=0;x<arguments.length;x++){var y=Number(arguments[x]);if(0>y||1114111<y||y!==Math.floor(y))throw new RangeError("invalid_code_point "+y);65535>=y?p+=String.fromCharCode(y):(y-=65536,p+=String.fromCharCode(y>>>10&1023|55296),p+=String.fromCharCode(y&1023|56320))}return p}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(k){return k?k:function(t,p,x){var y=this.length||0;0>p&&(p=Math.max(0,y+p));if(null==x||x>y)x=y;x=Number(x);0>x&&(x=Math.max(0,y+x));for(p=Number(p||0);p<x;p++)this[p]=t;return this}},"es6","es3");$jscomp.typedArrayFill=function(k){return k?k:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("String.prototype.trimRight",function(k){function t(){return this.replace(/[\s\xa0]+$/,"")}return k||t},"es_2019","es3");$jscomp.polyfill("String.prototype.trimEnd",function(k){return k||String.prototype.trimRight},"es_2019","es3");var svManager={getInstance:function(){var k=window.$ssh;return k&&k.running&&k.running()?k:null}};
function connvertServer(k){var t={};t.id=k.id;t.server=k.id;t.displayName=k.displayName||k.id;if(k=k.ssh){for(var p in k)t[p]=k[p];t.user=k.username||"";t.pwd=k.password||""}return t}
svGlobal.SSH=function(k,t,p,x){function y(a){return"on"==a||"true"==a||1==a}function ca(a){h.loadbalanceToken||(B.randomAppId&&(a=hi5.tool.uuid()),h.loadbalanceToken=B.loadbalanceTokenName?B.loadbalanceTokenName+"="+a:"")}function X(){var a=k.indexOf("://"),b=k.substring(a+3);a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function Ab(a){if(!ua)return"";var b=X(),c=Ea.clipboard,d=c.indexOf("://");b=(0<d&&11>d?c:b+c)+"s="+ua+"&t="+Date.now()+"&type="+a;return hi5.browser.httpGet(h.modifyURL(b),
!1)}function Pa(a,b){b&&(Y=b);a&&(a>K&&(a=K),S=a,va=(S-1)*q);Za=1==Y&&S==K}function wa(a,b,c,d){var e=b;d=d||Math.floor(e/q);b=c||Math.floor(a/w);var m=null;c&&(a=M*w,e=K*q);F&&(m=r.getImageData(0,0,Math.min(b*w,N),Math.min(d*q,K*q)));t=a;p=e;c=t;a=p;C.setSize(c,a);Z.width=c;Z.height=a;r.textBaseline="top";r.font=n.fontSize+"px "+(n.fontFamily||n.fontName);Fa();m&&r.putImageData(m,0,0);K=d;M=b;N=M*w;Pa(Math.floor(p/q));E?E.resize(M,K):E=new $a(M,K);if(h.onresolutionchange)h.onresolutionchange(t,p)}
function Qa(a){A.send(a)}function Ga(){return n.displayName||n.server||n.symlink||n.id||"undefined"}function ab(a){h.setTitle&&(document.title=a)}function bb(a,b,c){this.need=a;this.handler=b;this.repeat=c||1}function Bb(){var a=window.localStorage.getItem(void 0)||"";a&&(a="&certHash="+a);var b=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!b)return a;var c=b.getItem("appInfo.session");if(!c)return a;a+="&_session="+c;(b=b.getItem("appInfo.numericId"))&&(a+="&_numericId="+
b);return a}function Cb(a){aa=new RecordingManager;aa.setHeader({name:"rec",width:a.width,height:a.height,color:a.fontSize,namesuffix:".sshv",filetag:"SSHV",duration:0})}function Db(a,b){var c=0,d=!1;this.width=a;this.interval=b;var e=0;this.start=function(){d||(d=!0,c=setInterval(function(){if(C&&F){var m=C.getThumbnail(a);m&&m.length!=e&&(A.send("8E7"+m),e=m.length)}},b))};this.stop=function(){clearInterval(c)}}function Eb(a,b){!V||V.width==a&&V.interval==b||(V.stop(),V=null);V||(V=new Db(a,b));
V.start()}function Fb(a){F&&A.send("5D"+a.join("\t"));G=null}function cb(){if(G){var a=G.answer.length;a<G.prompt.length?(da(G.prompt[a]),pa()):(A.send("5D"+G.answer.join("\t")),G=null)}}function Gb(a){F&&A.send("5B"+a)}function Hb(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var d=h.sessionInfo.appInfo;switch(b){case 1:var e=JSON.parse(c);h.onsessionjoin&&(a=h.onsessionjoin(e));if(a)break;h.showMessage(__svi18n.info.joinsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 2:e=
JSON.parse(c);h.onsessionexit&&(a=h.onsessionexit(e));if(a)break;h.showMessage(__svi18n.info.exitsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 3:e=JSON.parse(c);d.joinMode!=e.mode&&(d.joinMode=e.mode,b=hi5.$("joinSelect"))&&(b.value=e.mode);if(d.hasControl)break;C.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;h.ongivecontrol&&(a=h.ongivecontrol());if(a)break;h.showMessage(__svi18n.info.givecontrol);break;case 4:C.setReadOnly(!0);d.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=
!1;h.ontakebackcontrol&&(a=h.ontakebackcontrol());if(a)break;h.showMessage(__svi18n.info.nocontrol);break;case 5:e=JSON.parse(c);h.onrequirecontrol&&(a=h.onrequirecontrol(e));if(a)break;a=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);h.showMessage({title:a,msg:__svi18n.info.recontrol,cbYes:function(){h.giveControl(e.numericId);this.destroy()},cbNo:function(){h.refuseControl(e.numericId);this.destroy()}});break;case 6:C.setTouchRemoting(!0);break;case 7:e=JSON.parse(c);e.width&&e.height&&
wa(0,0,e.cols,e.rows);break;case 8:e=JSON.parse(c);if(h.onrequestcredential&&h.onrequestcredential(e))break;C.requestCredential(e);break;case 9:e=JSON.parse(c);0<e.interval&&0<e.width?Eb(e.width,e.interval):V&&(V.stop(),V=null);break;case 11:e=JSON.parse(c);h.onrequirejoin&&(a=h.onrequirejoin(e));if(a)break;a=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);h.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){h.allowJoin(e.numericId,!0);this.destroy()},cbNo:function(){h.allowJoin(e.numericId,
!1);this.destroy()}});break;case 12:db=!0;break;case 14:e=JSON.parse(c);if(h.oncontrolchange)h.oncontrolchange(e);break;case 15:e=JSON.parse(c),Ib(e)}}function Ib(a){if("cert"==a.type){eb=!0;var b=__svi18n.info.cert||"The certificate of remote connection could not be verified. Do you want to continue?<br>Target: %1,<br>Hash: %2";b=b.applyArgs([a.target,a.hash]);hi5.notifications.notify({msg:b,cbYes:function(){this.destroy();window.localStorage.setItem(void 0,a.hash);h.run()},cbNo:function(){this.destroy()},
html:!0})}}function Jb(a){var b=B.page&&B.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,d=c.lastIndexOf("/");if(b)return c.substring(0,d+1)+b;b=X();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,d));return b+"/"+a}function qa(a){ja.style.display=a?"none":"block"}function Kb(a){svGlobal.logger.info("opened...");F=!0;A.send("87"+navigator.userAgent);if(h.onopen)h.onopen()}function Lb(a){svGlobal.logger.warn(a)}
function Ha(a){svGlobal.logger.warn("closed ...");qa(!0);if(!F&&((a=__svi18n.errorCode.connection)||(a="error connection"),h)){if(h.onerror)h.onerror({name:"connection",message:a});h.showMessage(a);0<svGlobal.log&&console.error(a)}xa=F=!1;if(!eb){if(h)if(h.onclose)h.onclose(db);else if(hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}try{null!=aa&&(aa.exit(),aa=null),C&&C.close()}catch(b){}na&&(na.release(),na=null);Z=r=null;A&&(A.onopen=null,A.onmessage=null,A.onclose=
null,A=A.onerror=null);C=Q=null;h&&(h=null);window&&window.$ssh&&(window.$ssh=null);null!=aa&&(aa.exit(),aa=null)}}function fb(){10>n.fontSize&&(n.fontSize=10);13>n.fontSize?q=n.fontSize+6:12<n.fontSize&&19>n.fontSize?q=n.fontSize+8:18<n.fontSize&&25>n.fontSize?q=n.fontSize+12:24<n.fontSize&&(q=n.fontSize+16);n.lineHeight&&(q=parseInt(n.lineHeight));gb=(q-n.fontSize)/2|0;r.textBaseline="top";r.font=n.fontSize+"px "+n.fontFamily;w=r.measureText("X").width;K=parseInt(p/q);M=parseInt(t/w);N=M*w;Pa(parseInt(p/
q));E?E.resize(M,K):E=new $a(M,K)}function Ra(){Fa();z=v=0;fb();ja.style.width=w+"px";ja.style.height=q+"px";xa=!0}function hb(){ya=!1;H=n.fgColor||ba[7];L=n.bgColor||ba[0];Sa=0;ra=!0}function ib(a){switch(a){case 0:svGlobal.logger.info("C0 0");break;case 5:svGlobal.logger.info("C0 END enquiry");break;case 7:svGlobal.logger.info("C0 bell");break;case 8:Ta();break;case 9:v=8*((v/w/8|0)+1)*w;za();break;case 10:Ua(!0);break;case 11:Ua();break;case 12:svGlobal.logger.info("C0 form feed");break;case 13:jb();
break;case 14:svGlobal.logger.info("C0 Shift out");break;case 15:svGlobal.logger.info("C0 exit_alt_charset_mode");break;default:svGlobal.logger.warn("Unknown C0 control:"+a)}}function Mb(a){var b=a.getPosition();if(!O.parse(a))return a.setPosition(b-2),!1;a=O.count;b=O.parameters;switch(O.command){case 64:0==a&&(b[0]=1);a=b[0];b="";for(var c=a*w,d=r.getImageData(v,z,N-v-c,q),e=0;e<a;e++)b+=" ";da(b);v-=c;r.putImageData(d,v+c,z);E.insertSpace(a,R(),P());break;case 65:0==a&&(b[0]=1);z-=(b[0]||1)*q;
break;case 66:0==a&&(b[0]=1);z+=(b[0]||1)*q;za(!0);break;case 67:0==a&&(b[0]=1);a=b[0]||1;a>M&&(a=M);v+=a*w;break;case 68:0==a&&(b[0]=1);v-=(b[0]||1)*w;0>v&&(v=0);break;case 69:0==a&&(b[0]=1);z+=b[0]*q;v=0;break;case 70:0==a&&(b[0]=1);z-=b[0]*q;v=0;break;case 71:0==a&&(b[0]=1);Ia(0,b[0]);break;case 72:case 102:0==a&&(b[0]=b[1]=1);Ia(b[0]||1,b[1]||1);break;case 74:a||(b[0]=0);switch(b[0]){case 0:r.fillStyle=L;r.fillRect(v,z,N-v,K*q-z);r.fillStyle=H;E.clearEOS(R(),P());break;case 1:r.fillStyle=L;r.fillRect(0,
0,v,z);r.fillStyle=H;E.clearBOS(R(),P());break;case 2:Fa();z=v=0;E.cleanScreen();break;case 3:Fa();z=v=0;E.cleanScreen();break;default:svGlobal.logger.warn("invalid CSI J:"+b[0])}break;case 75:a||(b[0]=0);switch(b[0]){case 0:kb();break;case 1:r.fillStyle=L;r.fillRect(0,z,v,q);r.fillStyle=H;E.clearBOL(R(),P());break;case 2:r.fillStyle=L;r.fillRect(0,z,N,q);r.fillStyle=H;E.clearLine(P());break;default:svGlobal.logger.warn("invalid CSI K:"+b[0])}break;case 76:case 84:a||(b[0]=1);lb(b[0],76==O.command);
break;case 77:case 83:a||(b[0]=1);mb(b[0],77==O.command);break;case 80:a||(b[0]=1);a=b[0];b=v+a*w;b=r.getImageData(b,z,N-b,q);kb();r.putImageData(b,v,z);E.deleteChars(R(),P(),a);break;case 88:a||(b[0]=1);a=b[0];r.fillStyle=L;r.fillRect(v,z,a*w,q);r.fillStyle=H;E.eraseChars(R(),P(),a);break;case 90:a||(b[0]=1);v=8*((v/w/8|0)-b[0]+1)*w;za();break;case 99:I("x1B[?6c");break;case 100:a||(b[0]=1);Ia(b[0]);break;case 101:a||(b[0]=1);Ia(P()+b[0]);break;case 104:if(63==O.mode)switch(b[0]){case 1:oa.setCursorKeyMode(1);
break;case 5:svGlobal.logger.info("Reversal screen mode");break;case 6:svGlobal.logger.info("Relative origion mode");break;case 7:svGlobal.logger.info("wraparound mode on");ra=!0;break;case 12:break;case 25:qa(!1);break;case 45:svGlobal.logger.info("reverse-wraparound mode on");break;case 1E3:case 1001:case 1002:case 1003:case 1005:case 1006:U=b[0];svGlobal.logger.warn("mouse tracking on:"+U);break;case 1034:svGlobal.logger.warn("TD:Interpret meta key, xterm.");break;case 1048:case 1049:svGlobal.logger.warn("TD: Save cursor");
break;default:svGlobal.logger.warn("TD: CSI ? Pm h, Ps:"+b[0])}break;case 108:if(63==O.mode)switch(b[0]){case 1:oa.setCursorKeyMode(0);break;case 2:Aa.setKeyboard("vt52");break;case 3:svGlobal.logger.info("80 Column Mode (DECCOLM), VT100");break;case 5:svGlobal.logger.info("screen mode: "+O.toString());break;case 6:svGlobal.logger.info("Absolute origion mode: "+O.toString());break;case 7:ra=!1;break;case 12:break;case 25:qa(!0);break;case 45:svGlobal.logger.info("reverse-wraparound mode off");break;
case 47:svGlobal.logger.info("TODO: use Normal Screen Buffer, xterm.");break;case 1E3:case 1001:case 1002:case 1003:case 1005:case 1006:U=0;break;case 1048:case 1049:svGlobal.logger.warn("TD: Restore cursor");break;default:svGlobal.logger.warn("TD: CSI ? Pm l, Ps:"+b[0])}break;case 109:0==a&&(a=1,b[0]=0);for(c=0;c<a;c++)switch(b[c]){case 0:Ba(7);Ca(0);Va(!1);break;case 1:Va(!0);break;case 2:break;case 4:break;case 5:case 8:break;case 7:Ba(0);Ca(7);break;case 27:Ba(7);Ca(0);break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:Ba(b[c]-
30);break;case 38:return 2==b[c+1]&&(H="rgb("+b[c+2]+","+b[c+3]+","+b[c+4]+")",r.fillStyle=H),!0;case 39:Ba(7);break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:Ca(b[c]-40);break;case 48:return 2==b[c+1]&&(L="rgb("+b[c+2]+","+b[c+3]+","+b[c+4]+")"),!0;case 49:Ca(0);1==c&&39==b[0]&&Va(!1);break;default:return svGlobal.logger.warn("TD: SGR="+O.toString()),!0}break;case 110:6==b[0]?63==O.mode?I("\u001b[?"+P()+";"+R()+"R"):I("\u001b["+P()+";"+R()+"R"):5==b[0]&&I("\u001b[0n");break;
case 112:"!"==O.trailing&&hb();break;case 114:O.mode||Pa(b[1],b[0]);break;case 124:break;default:svGlobal.logger.warn("TD: CSI="+O.toString())}return!0}function lb(a,b){a||(a=1);b=b?z/q+1|0:Y;var c=(b-1)*q;if(S!=b){var d=r.getImageData(0,c,N,(S-b-a+1)*q);r.fillStyle=L;r.fillRect(0,c,N,q*a);r.putImageData(d,0,(b+a-1)*q);r.fillStyle=H;E.scrollUp(a,b,S)}}function mb(a,b){a||(a=1);b=b?z/q+1|0:Y;var c=(b-1)*q,d=S*q,e=a*q,m=c+e;d!=m&&(m=r.getImageData(0,m,N,d-m),r.fillStyle=L,r.fillRect(0,d-e,N,e),r.fillStyle=
H,r.putImageData(m,0,c),E.scrollDown(a,b,S))}function Ua(a){a&&E.cariageReturn(R(),P());z+=q;za(a)}function za(a){ra&&v>=N&&(v=0,z+=q);(ra||a)&&z>va&&(z>va&&(z=va),Za?(r.drawImage(Z,0,-q),r.fillStyle=L,r.fillRect(0,va,t,q),E.appendLines(1)):(a=r.getImageData(0,(Y-0)*q,N,(S-Y)*q),r.fillStyle=L,r.fillRect(0,(Y-1)*q,N,(S-Y+1)*q),r.putImageData(a,0,(Y-1)*q),E.scrollDown(1,Y,S)),r.fillStyle=H)}function Ta(){v-=w;0>v&&(v=0)}function P(){return(z/q|0)+1}function R(){return(v/w|0)+1}function Ia(a,b){b&&(v=
(b-1)*w,0>v&&(v=0));a&&(a>K&&(a=K),z=(a-1)*q)}function Ca(a){L=Ja[a];L||(L=n.bgColor||"black",svGlobal.logger.info("xx colorIndex:"+a))}function Ba(a){Sa=a;H=ba[a];H||(H=n.fgColor||"white",svGlobal.logger.info("xx colorIndex:"+a));r.fillStyle=H}function Va(a){ba=a?nb:Ja;H=ba[Sa]}function kb(){r.fillStyle=L;r.fillRect(v,z,N-v,q);r.fillStyle=H;E.clearEOL(R(),P())}function Fa(){r.fillStyle=L;r.fillRect(0,0,Z.width,Z.height);r.fillStyle=H}function pa(){ja.style.top=z+"px";ja.style.left=v+"px";var a=E.getChar((v/
w|0)+1,(z/q|0)+1);a&&r.measureText(a).width>w?ja.style.width=2*w+"px":ja.style.width=w+"px"}function da(a){if(a){T.on&&(a.startsWith(T.prompt)?(T.on=!1,setTimeout(T.process,30)):T.text+=a);var b=M-(v/w|0);for(var c=a.length,d=0;d<c;){var e=a.charAt(d++);r.measureText(e).width>w?b-=2:b--;if(0==b)break;else if(0>b){d--;break}}b=d+1>c?-1:d;0<=b?(ob(a.substring(0,b),b),za(),da(a.substring(b))):ob(a,a.length)}}function ob(a,b){if(a){E.writeText(R(),P(),a);for(var c=0,d=[],e=0;e<b;e++){var m=a.charAt(e),
f=r.measureText(m).width;d.push(f);c+=f<=w?w:2*w}r.fillStyle=L;r.fillRect(v,z,Math.ceil(c),q);r.fillStyle=H;c=z+gb;for(e=0;e<b;e++)m=a.charAt(e),f=d[e],f==w?(r.fillText(m,v,c),v+=w):f>w?(f=(2*w-f)/2|0,r.fillText(m,v+f,c),v+=2*w):(f=(w-f)/2|0,r.fillText(m,v+f,c),v+=w)}}function pb(a){ea+=a;ka?(da(a),pa()):G&&G.echo[G.answer.length]&&(da(a),pa())}function jb(){v=0;z>(S-1)*q&&(z=(S-1)*q)}function qb(a){if(F&&Da)return(a=a.getData("text/plain"))?(a=a.replace(/\r\n/g,"\n"),ka||G?pb(a):I(a),!0):!1}function Wa(){if(W){var a=
!!W.value;W.value=E.toString();a||(a=new hi5.ui.Lightbox(W.parentNode),a.show(),C&&C.setIgnorePaste(!1),a.onclose=function(){W.value="";C&&C.focus()});setTimeout(function(){W.scrollTop=W.scrollHeight},10)}}function rb(a){y(n.mapDisk)&&(J||(J=new hi5.file.UploadManager(new hi5.file.WsFileService(Qa),!1),J.enabled=!0,J.canCopyFile=!1,J.addEvent("beforeupload",function(b,c,d){h.beforeupload&&h.beforeupload(b,c,d)}),J.addEvent("fileuploaded",function(b,c,d){if(h.onfileuploaded)h.onfileuploaded(b,c,d)}),
J.addEvent("uploaded",function(b,c){if(h.onuploaded)h.onuploaded(b,c)}),J.addEvent("uploadingCancelled",function(){if(h.onuploadingCancelled)h.onuploadingCancelled()})),a.setFileHandler(J))}function sb(a,b,c){return a.querySelector(b+'[name="'+c+'"]')||document.getElementById(c)}function I(a){if(a){a=Ka.encode(a);var b=a.length+1,c=new Uint8Array(b);c[0]=147;for(var d=1;d<b;d++)c[d]=a[d-1];A.send(c.buffer)}}function Nb(a,b){a&&"text/plain"==b?qb(a):h.showMessage("Please use Ctrl+V or browser's Edit menu")}
function $a(a,b){function c(f,g){if(g)for(var l=r.measureText("W").width,u=0;u<f;u++){var D=g[u];D&&7923<D.charCodeAt(0)&&r.measureText(D).width>l&&f--}return f}var d=0,e=[],m=10*b;this.resize=function(f,g,l){l=0;for(var u=e.length;l<u;l++)if(e[l]&&(e[l].length=f,f>a))for(var D=a;D<f;D++)e[l][D]=" ";a=f;b=g;m=10*b};this.writeText=function(f,g,l){g--;f--;var u=e[d+g];u||(u=[],e[d+g]=u);g=0;for(var D=l.length;g<D;g++)u[g+f]=l[g]};this.cariageReturn=function(f,g){g--;if(g=e[d+g])f=g.length,g[f]="\r",
g[f+1]="\n"};this.appendLines=function(f){d+=f};this.scrollDown=function(f,g,l){l=d+l-1-f;for(g=d+g-1;g<=l;g++)e[g]=e[g+f];l++;for(g=0;g<f;g++)e[l+g]=[]};this.scrollUp=function(f,g,l){g=d+g-1+f;for(l=d+l-1;l>=g;l--)e[l]=e[l-f];g--;for(l=0;l<f;l++)e[g-l]=[]};this.cleanScreen=function(){d=e.length;if(d>=m){var f=2*b;e.splice(0,f);d-=f}};this.clearEOS=function(f,g){g--;f--;for(var l=d+g,u,D=0,fa=b-g;D<fa;D++)if(u=e[l+D])for(g=f;g<a;g++)u[g]=" "};this.clearBOS=function(f,g){g--;f--;for(var l=d,u,D,fa=
0;fa<g;fa++)if(D=e[l+fa])for(f=c(f,dataRow),u=0;u<f;u++)D[u]=" "};this.clearLine=function(f){f--;(f=e[d+f])&&hi5.Arrays.fill(f,0,a," ")};this.clearBOL=function(f,g){g--;f--;if(g=e[d+g]){f=c(f,g);for(var l=0;l<f;l++)g[l]=" "}};this.clearEOL=function(f,g){g--;f--;if(g=e[d+g])for(f=c(f,g);f<a;f++)g[f]=" "};this.eraseChars=function(f,g,l){g--;f--;if(g=e[d+g]){var u=f=c(f,g);for(f+=l;u<f;u++)g[u]=" "}};this.deleteChars=function(f,g,l){g--;f--;if(g=e[d+g])f=c(f,g),g.splice(f,l)};this.getChar=function(f,
g){g--;f--;return(g=e[d+g])?g[c(f,g)]:null};this.insertSpace=function(f,g,l){l--;g--;if(l=e[d+l]){g=c(g,l);for(var u=l.length-1;u>=g;u--)l[u+f]=l[u];for(u=0;u<f;u++)l[g+u]=" "}};this.getSingleLine=function(f,g,l){f--;g--;var u="";if(f=e[d+f])for(g=c(g,f),l=null==l||l>=f.length?f.length:c(l-1,f);g<l;g++)u+=f[g];return u};this.getMultiLines=function(f,g,l,u){if(u<g)return this.getMultiLines(l,u,f,g);var D=u-g+1;if(1>D)return null;if(1==D)return this.getSingleLine(g,f,l);f=this.getSingleLine(g,f,null);
l=this.getSingleLine(u,1,l);D-=2;g+=d;for(var fa=0;fa<D;fa++)f=(u=e[fa+g])?f+u.join(""):f+"\r\n";return f+l};this.toString=function(){for(var f="",g=0,l=e.length;g<l;g++)e[g]&&(f+=e[g].join("").trimEnd()),f+="\r\n";return f}}var ha=0,ia=null,db=!1,ya=!1;this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;this.reconnectOnResize=!0;var h=this,tb=new hi5.codec["utf-8"].Decoder,Ka=new hi5.codec["utf-8"].Encoder,Ob={stream:!0},eb=!1;this.setCodec=function(a,b){tb="string"==
typeof a?"utf-8"==a?new hi5.codec["utf-8"].Decoder:new TextDecoder(a):a;if(b)if("string"==typeof b)if(a=hi5.codec[b])Ka=new a.Encoder;else return Ka=new hi5.codec["utf-8"].Encoder,svGlobal.logger.warn("Unsupported encode: "+b),!1;else Ka=b;return!0};this.getHistory=function(){return E.toString()};hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var B=hi5.appcfg,T={on:!1,text:"",prompt:"",cmd:"",process:function(){var a=T.cmd.indexOf(" "),b=T.cmd.substring(a+1);a=b.lastIndexOf(".");
var c="";if(-1!=a)switch(b.substring(a+1).toLowerCase()){case "jpe":case "jpg":case "jpeg":c="image/jpeg";break;case "gif":c="image/gif";break;case "bmp":c="image/bmp";break;case "svg":c="image/svg+xml";break;case "png":c="image/png";break;case "webp":c="image/webp";break;case "ico":c="image/x-icon"}a="data:"+(c||"application/octet-stream")+";base64,"+T.text;T.text="";h.showMessage(c?{msg:'<img src="'+a+'" style="max-width:100%"/>',html:!0}:{msg:'<a download="'+b+'" href="'+a+'" target="_blank">'+
b+"</a>",html:!0})}};void 0!=B.reconnectOnResize&&(this.reconnectOnResize=B.reconnectOnResize);var Xa="object"==typeof k?k:null,ub="object"==typeof k||0<k.indexOf("/PLAY?");ub?(this.mode=1,Xa&&(k=""),k+="&touchpad=on"):0<k.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var n=hi5.tool.queryToObj(k.substring(k.indexOf("?")+1));void 0==n.mapClipboard&&B.clipboard&&void 0!=B.clipboard.enabled&&(n.mapClipboard=B.clipboard.enabled);n.keyfile&&n.keyfile.startsWith("-----BEGIN")&&(B.wsPost=!0);
n.color||(n.color=32);n.fontFamily||(n.fontFamily='"Courier New"');var Pb=n.terminalType||"default",Da=y(n.mapClipboard),W=null,E=null,Ea={download:"/DOWNLOAD?",clipboard:"/CLIP?"};this.setLinks=function(a){a.download&&(Ea.download=a.download);a.clipboard&&(Ea.clipboard=a.clipboard)};this.server=n.server;this.port=parseInt(n.port,10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var C=null,F=!1,xa=!1,Ya=0,ua="",U=0,J=null;B.copyDialog=!0;var v=0,z=0,vb=0,wb=0,
w=0,q=18,gb=0,Ja="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),nb="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),Qb="#073642 #dc322f #859900 #b58900 #268bd2 #d33682 #2aa198 #eee8d5".split(" "),Rb="#002b36 #cb4b16 #586e75 #657b83 #839496 #6c71c4 #93a1a1 #fdf6e3".split(" "),Sb="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),Tb="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),ba=Ja,H=n.fgColor||
ba[7],L=n.bgColor||ba[0],Sa=0,ra=!0;n.wraparoundMode&&(ra=y(n.wraparoundMode));var Y=1,S=24,va=0,Za=!0,ja=null,K=0,M=0,N=0,aa=null;window.$ssh=this;var na=new function(a){var b=0,c=0,d=new Uint8Array(a),e=this,m=new bb(0,null,0);this.needMore=!1;this.release=function(){e=d=m=null};this.getHandler=function(){return m};this.getData=function(){return d};this.getPosition=function(){return b};this.setPosition=function(f){b=f};this.getEnd=function(){return c};this.has=function(f){return c-b>=f};this.set=
function(f){var g=f.length,l=c-b;if(1>l)c=g,d=f;else{var u=d.subarray(b,c);c=l+g;g=new Uint8Array(c);g.set(u);g.set(f,l);d=g}b=0};this.handle=function(){m.handler(e,m)};this.setHandler=function(f){f&&1>f.need&&svGlobal.logger.warn("need < 1");(m=f)&&c-b>=f.need&&f.handler(e,f)};this.getByte=function(){return d[b++]};this.peekByte=function(){return d[b]};this.getBE32=function(){return d[b++]<<24|d[b++]<<16|d[b++]<<8|d[b++]};this.getBE16=function(){return d[b++]<<8|d[b++]};this.skip=function(f){b+=
f};this.skipBack=function(f){b-=f};this.getBytes=function(f,g){if(g)for(var l=0;l<f;l++)g[l]=d[b++];else return g=b,b+=f,d.subarray(g,b)};this.copyToByteArray=function(f,g,l,u){hi5.Arrays.arraycopy(d,l,f,g,u)}}(4194304),Ub={l:"\u250c",k:"\u2510",m:"\u2514",j:"\u2518",q:"\u2500",x:"\u2502",n:"\u253c","~":"\u2022",u:"\u2524",t:"\u251c",v:"\u2534",w:"\u252c"};this.__que=na;this.running=function(){return F};this.setTheme=function(a){"light"==a?(this.setColorTable(Qb),this.setColorTableBright(Rb)):"classic"==
a?(this.setColorTable(Sb),this.setColorTableBright(Tb)):svGlobal.logger.warn("Invalid theme: "+a)};this.setColorTable=function(a){ba=Ja=a;H=n.fgColor||ba[7];L=n.bgColor||ba[0]};this.setColorTableBright=function(a){nb=a};this.loadbalanceToken="";if(B.ssh){var La=B.ssh;La.theme&&!n.theme&&(n.theme=La.theme);La.charset&&!n.charset&&(n.charset=La.charset)}n.theme&&this.setTheme(n.theme);n.charset&&this.setCodec(n.charset);B.loadbalanceTokenName&&n[B.loadbalanceTokenName]&&ca(n[B.loadbalanceTokenName]);
this.mapCmdToCtrl=!0;var A=null;t||(t=window.innerWidth);n.width=t;k+="&width="+t;p||(p=window.innerHeight);n.height=p;k+="&height="+p;x=(x=x||n.fontSize)?parseInt(x):13;n.fontSize?(x=parseInt(n.fontSize,10),n.fontSize=x):(n.fontSize=x,k+="&fontSize="+x);var Z=window.OffscreenCanvas?new OffscreenCanvas(t,p):document.createElement("canvas"),r;this.modifyURL=function(a){h.loadbalanceToken&&(a+="&"+h.loadbalanceToken);return a};this.__write=Qa;this.getFileUrl=function(a){var b=X(),c=Ea.download,d=c.indexOf("://");
b=(0<d&&11>d?c:b+c)+"s="+ua+"&f="+a;return h.modifyURL(b)};this.listFiles=function(a,b){J&&J.list(a,b)};this.reconnect=function(a,b){wa(a,b);A.send("ED"+M+"\t"+K+"\t"+t+"\t"+p)};var Q=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.localLockFlags=0;this.checkLockFlags=!0;var c=!1,d={drawable:b};this.pauseUpdate=function(m){c=m};this.draw=function(m,f,g,l,u){return c?null:d};this.getAppMode=function(){return a.mode};this.send=
function(m){"891"!=m&&F&&a.__write(m)};this.sendInput=function(m){a.writeRawInput(m);if(a.onactivity)a.onactivity(m)};var e=null;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.onresize=function(m){if(m=m.target.svSurface){m=m.getFreeSpace();var f=m.width,g=m.height;hi5.browser.isTouch||Math.abs(t-f)<w&&Math.abs(p-g)<q||!a.reconnectOnResize||!F||(e&&(clearTimeout(e),e=null),e=setTimeout(function(){wa(f,g);A.send("ED"+M+"\t"+K+"\t"+t+"\t"+p)},333))}};this.onorientationchange=function(m){};
this.getClipData=Ab;this.getShareFiles=a.listFiles;this.getFile=function(m){var f=a.getFileUrl(m);a.ondownload&&a.ondownload({fileName:m,url:f})||window.open(f)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return k};this.reconnect=function(m,f,g){};this.sendKeyboardSyncFlags=function(m){return F?(this.remoteLockFlags=this.localLockFlags=m,!0):!1};this.setWorkDir=function(m,f){f&&a.writeText("cd "+f+"\n")}}(this,Z);void 0!=B.displayMsg?this.displayMsg=B.displayMsg:B.displayMsg=this.displayMsg;
void 0!=B.reconnectTimes&&(this.reconnectTimes=B.reconnectTimes);void 0!=B.openLink&&(this.openLink=B.openLink);void 0!=B.setTitle&&(this.setTitle=B.setTitle);"boolean"==typeof B.useWSS&&(k=(B.useWSS?"wss":"ws")+k.substring(k.indexOf("://")));this.getURL=function(){return k};this.getRuntimeURL=function(a){fb();var b=k+"&cols="+M+"&rows="+K;b+="&binary=on";var c=window.opener;if(c){var d=null;try{d=c.__sparkUser}catch(e){}d&&(c=d.account,d=d.session,c&&(b+="&account="+c),d&&(b+="&session="+d))}b+=
"&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0);a&&0==h.mode&&B.wsPost&&(b=k.substring(0,k.indexOf("?"))+"?_METHOD=post");b=h.modifyURL(b);(a=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(b+="&__SV_TOKEN_A="+encodeURIComponent(a));return b};var Vb=parseInt(n.server_bpp||n.color||24);this.getColor=function(){return Vb};this.getDisplayName=Ga;this.run=function(){if(!F){if(Xa)A=Xa,Ra();else{var a=h.getRuntimeURL(!0);a+=Bb();A=h.oncreatewebsocket?h.oncreatewebsocket(a):new WebSocket(a,"ssh");
A.binaryType="arraybuffer"}A.onopen=Kb;void 0!=n.recording&&"on"==n.recording&&Cb(n);A.onmessage=function(b){b=b.data;if("string"!=typeof b){var c=new Uint8Array(b);null!=aa&&aa.add(new RecordingObj(c,0,b.byteLength));na.set(c);na.handle()}else{var d=parseInt(b.substring(0,2),16);c=b.substring(2);switch(d){case 0:b=h.getRuntimeURL(!1);b=b.substring(b.indexOf("?")+1);A.send("00"+b);break;case 15:b=JSON.parse(c);A.send("8D");if(h){h.sessionInfo.protocolVersion=b.protocolVersion;if(h.onready)h.onready();
if(h.onloggedin)h.onloggedin();B.pingInterval&&h.startPing(B.pingInterval);J&&(J.enabled=!0)}qa(!1);break;case 26:b=JSON.parse(c);if(b.name){svGlobal.logger.info("msg="+c);if(h.onerror)h.onerror(b);c=__svi18n.errorCode["S"+b.name]||"";c+=b.message||b.msg;h.showMessage(c)}else 0<svGlobal.log&&console.erro("No error code for message:"+c);break;case 27:0!=B.drawLicense&&C.drawLicense(c);break;case 56:b=JSON.parse(c);ua=b.session;c=b.numericId;if(d=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage)d.setItem("appInfo.session",
ua),d.setItem("appInfo.numericId",c);ca(b.appId);b.server||(b.server=Ga());if(c=hi5.$("joinSelect"))c.value=b.joinMode;if(c=hi5.$("requestControl"))c.disabled=b.hasControl;c=Jb("joinssh.html")+"?id="+b.numericId;c=h.modifyURL(c);var e=b.webAddress;e&&0<e.length&&(d=e.indexOf("://"),e=e.substring(d+3),d=e.indexOf("/"),0<d&&(e=e.substring(0,d)),e.toLowerCase()!=location.host.toLowerCase()&&(c+="&gateway="+e));b.joinLink=c;h.sessionInfo.appInfo=b;b.ver&&b.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+
svGlobal.version+" server:"+b.ver);Ra();if(h&&h.onsessionstart)h.onsessionstart(h.sessionInfo);break;case 58:if(J)if(b=parseInt(c.charAt(0),10),c=c.substring(1),5==b)J.notifyFiles(JSON.parse(c));else switch(c=c.split("\t"),b){case 1:J.confirmId(c[0],c[1],c[2]);break;case 2:J.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:J.close(c[0]);break;case 9:b='<a href="'+c[0]+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>",surfaces.getFocused().showMessage({msg:b,title:__svi18n.info.download})}break;
case 59:b=hi5.Base64.dec(c,0);Ya=b[3]<<24|b[2]<<16|b[1]<<8|b[0];Ya&64&&h.showMessage(__svi18n.info.recording);C.setFeature(Ya);break;case 61:b=JSON.parse(c);switch(b.type){case 0:n.fontSize=parseInt(b.fontSize);t=b.width;p=b.height;Ra();C.setAutoScale(!0);wa(0,0,M,K);if(c=b.server)h.server=b.server,ab(Ga());(c=b.mapDisk)&&rb(C);qa(!1);xb=b.length;if(h.onopened)h.onopened(b);break;case 1:b=b.duration;if(h.onprogress)h.onprogress(b,xb);break;case 2:2==b.status?F=!0:(c=0==b.status,Q.pauseUpdate(c),b.warn&&
h.showMessage(c?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:Hb(c);break;case 91:xa=!0;if(h.onusername)h.onusername(Gb);else da(__svi18n.info.user||c),ka=!0,pa();break;case 93:G=JSON.parse(c);if(h.onauthprompt)h.onauthprompt(G,Fb);else b=G.name||"",G.instruction&&(b+=G.instruction),b&&(z+=q,v=0,da(b),pa()),G.answer=[],cb();break;default:svGlobal.logger.warn("@TODO:"+b+"\n")}}};A.onclose=Ha;A.onerror=Lb;ab(Ga());C.focus()}};this.setJoinMode=function(a){F&&A.send("8E1"+a)};
this.refuseControl=function(a){F&&A.send("8E3"+a)};this.giveControl=function(a){F&&A.send("8E4"+a)};this.requestControl=function(){F&&A.send("8E2")};this.play=function(){A.send("F3")};this.pause=function(){A.send("F2")};this.scan=function(a){A.send("F4"+(a?"1":"0"))};this.seek=function(a){C&&F&&A.send("F4"+(a?"1":"0")+"\t"+(a/C.getScale().x|0))};this.allowJoin=function(a,b){A.send("8EA"+a+"\t"+(b?1:0))};var V=null,ka=!1,G=null,ea="",xb=0;this.hide=function(){C&&(qa(!0),C.hide())};this.showMessage=
function(a,b){h.displayMsg&&a&&(C?C.showMessage(a,b):("string"==typeof a&&(a={msg:a,timeout:b||0}),hi5.notifications.notify(a)))};this.close=function(){if(A&&F)try{A.send("85"),A.close()}catch(a){}else Ha()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(Ha):window.addEventListener("unload",Ha,!1);var Wb=new bb(1024,function(a){var b=v,c=z;for(a.needMore=!1;a.has(1);){var d=a.getByte();if(31>=d)if(27==d){a:{var e=a;if(e.has(1)){d=e.getByte();switch(d){case 40:d=e.getByte();svGlobal.logger.info("G0 Character Set start:"+
String.fromCharCode(d));48==d?(ya=!0,svGlobal.logger.info("Line drawing mode on")):(svGlobal.logger.info("Line drawing mode off"),ya=!1);break;case 41:d=e.getByte();ya=!1;svGlobal.logger.info("G0 Character Set canel: "+String.fromCharCode(d));break;case 60:Aa.exitVT52();break;case 55:vb=v;wb=z;break;case 56:v=vb;z=wb;break;case 61:svGlobal.logger.info("TODO: Enter alt keypad mode");break;case 62:svGlobal.logger.info("TODO: Enter keypad mode");break;case 66:break;case 68:mb();break;case 69:jb();Ua(!0);
break;case 77:lb();break;case 83:break;case 90:I("x1B[?6c");break;case 92:svGlobal.logger.info("ST");break;case 93:d=svGlobal.logger;for(var m=d.info,f=e,g=f.getPosition(),l="",u=f.getEnd(),D=f.getData();g<u;)if(e=D[g++],7!=e)switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCodePoint(e);break;case 12:case 13:l+=String.fromCodePoint((e&31)<<6|D[g++]&63);break;case 14:l+=String.fromCodePoint((e&15)<<12|(D[g++]&63)<<6|(D[g++]&63)<<0)}else break;f.setPosition(g);m.call(d,
"OSC:"+l);break;case 91:d=Mb(e);break a;case 99:svGlobal.logger.info("full reset");hb();break;default:svGlobal.logger.warn("unkown cmd for ESC:"+d)}d=!0}else e.skipBack(1),d=!1}if(!d)return}else ib(d);else if(128<=d&&159>=d)switch(d){case 146:a.skip(2);break;default:svGlobal.logger.warn("C1:"+d)}else{a.skipBack(1);d=a;m=d.getPosition();f=d.getEnd();g=d.getData();for(l=m;m<f;)if(e=g[m++],31>=e){m--;break}d.setPosition(m);if(m>l){if(d=g.subarray(l,m),d=tb.decode(d,Ob),ya)for(m=d.split(""),d="",e=0,
f=m.length;e<f;e++)g=m[e],d+=Ub[g]||g}else d="";da(d);if(a.needMore)return}}b==v&&c==z||pa();ia&&ia.check()});na.setHandler(Wb);this.refreshOutput=function(){};var O={mode:0,parameters:[0],count:0,trailing:"",command:0,toString:function(){var a="CSI, ";this.mode&&(a+="mode:"+String.fromCharCode(this.mode));0<this.count&&(a+=" parameters:"+this.parameters.slice(0,this.count).join(";"));this.trailing&&(a+=" trailing:"+this.trailing);return a+=" cmd:"+String.fromCharCode(this.command)},parse:function(a){var b=
0,c=!1,d=a.getByte();if(!d)return!1;if(60<=d&&63>=d)this.mode=d,d=a.getByte();else if(this.mode=0,31>=d||128<=d&&159>=d)ib(d),d=a.getByte();if(!d)return!1;for(this.count=0;48<=d&&63>=d;)if(59==d?(this.parameters[this.count]=c?b:null,this.count++,b=0,c=!1):48<=d&&57>=d?(b=10*b+(d-48),c=!0):svGlobal.logger.warn("CSI Parameter: "+String.fromCharCode(d)),d=a.getByte(),!d)return!1;c?(this.parameters[this.count]=b,this.count++):0<this.count&&(this.parameters[this.count]=1,this.count++);for(;32<=d&&47>=
d;)if(this.trailing+=String.fromCharCode(d),d=a.getByte(),!d)return!1;64<=d&&127>=d?this.command=d:(this.command="",svGlobal.logger.warn("Invalid CSI final char:"+String.fromCharCode(d)));return!0}},Ma=document.getElementById("svHistory");Ma&&(Da?Ma.onclick=Wa:Ma.parentNode.removeChild(Ma));this.showHistory=Wa;this.getUploadManager=function(){return J};this.addSurface=function(a){C=a;ub&&a.setPlayerMode();var b=a.canvas.parentNode;Da&&(W=sb(b,"textarea","copytextarea"))&&(W.value="");ja=sb(b,"div",
"cursorID");Z.width=t;Z.height=p;r=Z.getContext("2d",{alpha:!1});r.fontKerning="none";a.alwaysPaste=!0;a.setAutoScale(0<h.mode);wa(t,p);a.setController(Q);a.setTouchpad(y(n.touchpad));a.setClipboard(y(n.mapClipboard));rb(C);b=void 0!=n.cmdToCtrl?y(n.cmdToCtrl):void 0!=B.cmdToCtrl?B.cmdToCtrl:h.mapCmdToCtrl;a.run(99997,!1,!1,b);Da&&(a.onclipdata=qb)};this.sendPing=function(a){a=new Uint8Array(2);a[0]=146;Qa(a.buffer)};this.startPing=function(a){ia||(ia=new hi5.tool.ResponseMonitor(function(){xa&&h.sendPing()},
function(){xa&&ia.check(1)}));ia.setInterval(a,a);setTimeout(function(){ia.check()},1E3*a)};this.stopPing=function(){ia&&ia.stop()};this.writeText=I;this.writeScancode=function(a,b){I(oa.process(a,b,0))};var Xb={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,
f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.writeKeyComb=function(a){a=a.split("+");var b=a.length;if(0!=b)for(var c=null,d=0;d<b;d++){var e=a[d];""==e&&""==c&&(e="Add");if(""!=e){c=e;var m=Xb[c.toLowerCase()];m?h.writeScancode(!0,m):svGlobal.logger.warn("Invalid key:"+c)}c=e}};var Na=!1,la=0,ma=0,Oa=0,sa=!1,yb=0,zb=0,ta=null;this.writeRawInput=function(a){if(F){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");switch(b){case 128:la=
parseInt(a[0]);ma=parseInt(a[1]);Oa=parseInt(a[2]);sa=!1;Na=!0;yb=Math.floor(la/w)*w;zb=Math.floor(ma/q)*q;1015==U?I("\u001b["+(parseInt(a[2])+32)+";"+(Math.floor(la/w)+1)+";"+(Math.floor(ma/q)+1)+"M"):1006==U?I("\u001b[<"+a[2]+";"+(Math.floor(la/w)+1)+";"+(Math.floor(ma/q)+1)+"M"):U&&I("\u001b[M"+a[2]+String.fromCharCode(Math.floor(la/w)+33)+String.fromCharCode(Math.floor(ma/q)+33));return;case 129:U&&(1015==U?I("\u001b["+(parseInt(a[2])+32)+";"+(Math.floor(la/w)+1)+";"+(Math.floor(ma/q)+1)+"M"):
1006==U?I("\u001b[<"+a[2]+";"+(Math.floor(parseInt(a[0])/w)+1)+";"+(Math.floor(parseInt(a[1])/q)+1)+"m"):U&&I("\u001b[M3"+String.fromCharCode(Math.floor(parseInt(a[0])/w)+33)+String.fromCharCode(Math.floor(parseInt(a[1])/q)+33)));Oa=parseInt(a[2]);2==Oa&&Na&&!sa?(W&&(W.value=""),Da&&C.processClipReq("text/plain",Nb)):sa&&(a=E.getMultiLines(Math.floor(la/w)+1,Math.floor(ma/q+.1)+1,Math.floor(parseInt(a[0])/w+.4)+1,Math.floor(parseInt(a[1])/q-.4)+1))&&C&&C.copyToClip("text/plain;"+a);ta&&(setTimeout(C.removeWhiteboard,
333),ta=null);sa=Na=!1;return;case 130:if(Na){b=parseInt(a[0]);a=parseInt(a[1]);if(!sa){if(3>Math.abs(b-la)&&3>Math.abs(a-ma))return;sa=!0}if(0==Oa){if(!ta){var c=C.initWhiteboard();c.style.opacity=.6;c=c.getContext("2d");ta=new hi5.canvas.TextSelect(c,q,B.selectionColor,"1px",t)}ta.clear();ta.draw(yb,zb,b,a)}}return;case 131:1006==U?I("\u001b[<"+("1"==a[2]?65:64)+";"+(Math.floor(parseInt(a[0])/w)+1)+";"+(Math.floor(parseInt(a[1])/q)+1)+"M"):U?I("\u001b[M"+("1"==a[2]?5:4)+String.fromCharCode(Math.floor(parseInt(a[0])/
w)+64)+String.fromCharCode(Math.floor(parseInt(a[1])/q)+64)):"0"==a[2]&&Wa();return;case 132:c=0==a[0];b=parseInt(a[1]);if(ka||G)c&&(a=b,28==a||156==a?(z+=q,v=0,ka?(ka=!1,A.send("5B"+ea),ea=""):G&&(G.answer.push(ea),ea="",cb())):14==a&&0<ea.length&&(ea=ea.substring(0,ea.length-1),ka&&(Ta(),da(" "),Ta())));else if(I(oa.process(c,b,0)),28!=b)ha||(ha=R());else if(ha){if(ha&&(a=E.getSingleLine(P(),ha,R()))){b=E.getSingleLine(P(),1,ha);if(h.oncommand)h.oncommand(a,b);a.startsWith("cd /")?C.setDirectory(a.substring(3)):
a.startsWith("base64 ")&&(T.on=!0,T.cmd=a,T.prompt=b)}ha=0}return;case 139:b=parseInt(a[1]);c=0==a[0];I(oa.process(c,b,1));return;case 134:ka||G?pb(a[0]):(ha||(ha=R()),I(oa.process(!0,a[0],3)));return}svGlobal.logger.warn("Unknowncode: "+a[1]+" type:"+b)}};var Aa=new function(){function a(u){switch(u){case e:return"vt100";case m:return"vt52";case f:return"att513";case d:return"linux";case c:return"xterm";case b:return"default";default:return"unknown"}}var b="\u001b[11~ \u001b[12~ \u001b[13~ \u001b[14~ \u001b[15~ \u001b[17~ \u001b[18~ \u001b[19~ \u001b[20~ \u001b[21~ \u001b[23~ \u001b[24~".split(" "),
c="\u001bOP \u001bOQ \u001bOR \u001bOS \u001b[15~ \u001b[17~ \u001b[18~ \u001b[19~ \u001b[20~ \u001b[21~ \u001b[23~ \u001b[24~".split(" "),d="\u001b[[A \u001b[[B \u001b[[C \u001b[[D \u001b[[E \u001b[17~ \u001b[18~ \u001b[19~ \u001b[20~ \u001b[21~ \u001b[23~ \u001b[24~".split(" "),e="\u001bOP \u001bOQ \u001bOR \u001bOS \u001bOT \u001bOU \u001bOV \u001bOW \u001bOX \u001bOY \u001bOZ \u001bO[".split(" "),m=["\u001bP","\u001bQ","\u001bR","\u001bS"],f="\u001bOw \u001bNa \u001bSB \u001b[J \u001bOm \u001bf6 \u001b[U \u001b[V \u001bOk \u001bOl".split(" "),
g=b,l=b;this.setKeyboard=function(u){u=u.toLowerCase();svGlobal.logger.info("set keyboard: "+u);g!=m&&(l=g);switch(u){case "vt52":g=m;break;case "att513":g=f;break;case "vt100":g=e;break;case "linux":g=d;break;case "xterm":g=c;break;case "default":g=b;break;default:g=b}};this.exitVT52=function(){svGlobal.logger.info("exit vt52, switch to: "+a(l));g=l};this.fromScancode=function(u){var D;59<=u&&68>=u?D=g[u-59]:87==u?D=g[10]:88==u&&(D=g[11]);return D||""}};Aa.setKeyboard(Pb);this.setKeyboard=function(a){Aa.setKeyboard(a)};
var oa=new function(){var a=!1,b=!1,c=!1,d=0;this.setAltDown=function(e){b=e};this.setCtrlDown=function(e){a=e};this.setCursorKeyMode=function(e){svGlobal.logger.info("Esc mode:"+e+" was: "+d);d=e};this.process=function(e,m,f){if(3==f)return m;if(0==f){switch(m){case 29:case 157:return a=e,"";case 56:case 184:return b=e,"";case 42:case 54:return c=e,""}if(e){switch(m){case 28:e="\r";break;case 200:e=0==d?"\u001b[A":1==d?"\u001bOA":"\u001bA";break;case 208:e=0==d?"\u001b[B":1==d?"\u001bOB":"\u001bB";
break;case 205:e=0==d?"\u001b[C":1==d?"\u001bOC":"\u001bC";break;case 203:e=0==d?"\u001b[D":1==d?"\u001bOD":"\u001bD";break;case 59:case 60:case 61:case 62:case 63:case 64:case 65:case 66:case 67:case 68:case 87:case 88:e=Aa.fromScancode(m);break;case 15:e="\t";break;case 209:e="\u001b[6~";break;case 201:e="\u001b[5~";break;case 199:e=0==d?"\u001b[H":"\u001bOH";break;case 207:e=0==d?"\u001b[F":"\u001bOF";break;case 14:e=c?"\b":"\u007f";break;case 211:e="\u001b[3~";break;case 197:e="\u00ff\u00f3";
break;case 210:e="\u001b[2~";break;case 1:e="\u001b";break;case 55:e="*";break;case 71:e=Q.localLockFlags&2?"7":0==d?"\u001b[H":"\u001bOH";break;case 72:e=Q.localLockFlags&2?"8":0==d?"\u001b[A":"\u001bOA";break;case 73:e=Q.localLockFlags&2?"9":"\u001b[5~";break;case 74:e="-";break;case 75:e=Q.localLockFlags&2?"4":0==d?"\u001b[D":"\u001bOD";break;case 76:e=Q.localLockFlags&2?"5":"\u001bOu";break;case 77:e=Q.localLockFlags&2?"6":0==d?"\u001b[C":"\u001bOC";break;case 78:e="+";break;case 79:e=Q.localLockFlags&
2?"1":0==d?"\u001b[F":"\u001bOF";break;case 80:e=Q.localLockFlags&2?"2":0==d?"\u001b[B":"\u001bOB";break;case 81:e=Q.localLockFlags&2?"3":"\u001b[6~";break;case 82:e=Q.localLockFlags&2?"0":"\u001b[2~";break;case 83:e=Q.localLockFlags&2?".":"\u001b[3~";break;case 156:e="\r";break;case 181:e="/";break;default:return svGlobal.logger.warn("Invalid code:"+m),""}b&&(e="\u001b"+e);return e}return""}if(1==f&&e)if(a){if(64<m&&91>m)return String.fromCharCode(m-64);switch(m){case 54:return"\u001e";case 219:return"\u001b";
case 220:return"\u001c";case 221:return"\u001d";case 32:return"\x00";case 192:return"\u001e";case 191:return"\u001f";default:return svGlobal.logger.warn("Invalid key code:"+m),""}}else if(b)return"\u001b"+String.fromCharCode(m).toLowerCase()}};this.getKeyHandler=function(){return oa}};
