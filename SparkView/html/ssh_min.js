var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(l,u,p){if(null==l)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(u instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return l+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,u,p){if(l==Array.prototype||l==Object.prototype)return l;l[u]=p.value;return l};
$jscomp.getGlobal=function(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var u=0;u<l.length;++u){var p=l[u];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(l,u){var p=$jscomp.propertyToPolyfillSymbol[u];if(null==p)return l[u];p=l[p];return void 0!==p?p:l[u]};$jscomp.polyfill=function(l,u,p,y){u&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(l,u,p,y):$jscomp.polyfillUnisolated(l,u,p,y))};
$jscomp.polyfillUnisolated=function(l,u,p,y){p=$jscomp.global;l=l.split(".");for(y=0;y<l.length-1;y++){var z=l[y];if(!(z in p))return;p=p[z]}l=l[l.length-1];y=p[l];u=u(y);u!=y&&null!=u&&$jscomp.defineProperty(p,l,{configurable:!0,writable:!0,value:u})};
$jscomp.polyfillIsolated=function(l,u,p,y){var z=l.split(".");l=1===z.length;y=z[0];y=!l&&y in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var da=0;da<z.length-1;da++){var Y=z[da];if(!(Y in y))return;y=y[Y]}z=z[z.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?y[z]:null;u=u(p);null!=u&&(l?$jscomp.defineProperty($jscomp.polyfills,z,{configurable:!0,writable:!0,value:u}):u!==p&&($jscomp.propertyToPolyfillSymbol[z]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(z):$jscomp.POLYFILL_PREFIX+
z,z=$jscomp.propertyToPolyfillSymbol[z],$jscomp.defineProperty(y,z,{configurable:!0,writable:!0,value:u})))};$jscomp.polyfill("String.prototype.startsWith",function(l){return l?l:function(u,p){var y=$jscomp.checkStringArgs(this,u,"startsWith");u+="";var z=y.length,da=u.length;p=Math.max(0,Math.min(p|0,y.length));for(var Y=0;Y<da&&p<z;)if(y[p++]!=u[Y++])return!1;return Y>=da}},"es6","es3");
$jscomp.polyfill("String.fromCodePoint",function(l){return l?l:function(u){for(var p="",y=0;y<arguments.length;y++){var z=Number(arguments[y]);if(0>z||1114111<z||z!==Math.floor(z))throw new RangeError("invalid_code_point "+z);65535>=z?p+=String.fromCharCode(z):(z-=65536,p+=String.fromCharCode(z>>>10&1023|55296),p+=String.fromCharCode(z&1023|56320))}return p}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(l){return l?l:function(u,p,y){var z=this.length||0;0>p&&(p=Math.max(0,z+p));if(null==y||y>z)y=z;y=Number(y);0>y&&(y=Math.max(0,z+y));for(p=Number(p||0);p<y;p++)this[p]=u;return this}},"es6","es3");$jscomp.typedArrayFill=function(l){return l?l:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("String.prototype.trimRight",function(l){function u(){return this.replace(/[\s\xa0]+$/,"")}return l||u},"es_2019","es3");$jscomp.polyfill("String.prototype.trimEnd",function(l){return l||String.prototype.trimRight},"es_2019","es3");var svManager={getInstance:function(){var l=window.$ssh;return l&&l.running&&l.running()?l:null}};
function connvertServer(l){var u={};u.id=l.id;u.server=l.id;u.displayName=l.displayName||l.id;if(l=l.ssh){for(var p in l)u[p]=l[p];u.user=l.username||"";u.pwd=l.password||""}return u}
svGlobal.SSH=function(l,u,p,y){function z(a){return"on"==a||"true"==a||1==a}function da(a){k.loadbalanceToken||(C.randomAppId&&(a=hi5.tool.uuid()),k.loadbalanceToken=C.loadbalanceTokenName?C.loadbalanceTokenName+"="+a:"")}function Y(){var a=l.indexOf("://"),b=l.substring(a+3);a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function zb(a){if(!Ea)return"";var b=Y(),c=Fa.clipboard,e=c.indexOf("://");b=(0<e&&11>e?c:b+c)+"s="+Ea+"&t="+Date.now()+"&type="+a;return hi5.browser.httpGet(k.modifyURL(b),
!1)}function Qa(a,b){b&&(Z=b);a&&(a>L&&(a=L),S=a,wa=(S-1)*q);Za=1==Z&&S==L}function xa(a,b,c,e){var d=b;e=e||Math.floor(d/q);b=c||Math.floor(a/x);var h=null;c&&(a=N*x,d=L*q);F&&(h=r.getImageData(0,0,Math.min(b*x,O),Math.min(e*q,L*q)));u=a;p=d;c=u;a=p;D.setSize(c,a);aa.width=c;aa.height=a;r.textBaseline="top";r.font=n.fontSize+"px "+(n.fontFamily||n.fontName);Ga();h&&r.putImageData(h,0,0);L=e;N=b;O=N*x;Qa(Math.floor(p/q));E?E.resize(N,L):E=new $a(N,L);if(k.onresolutionchange)k.onresolutionchange(u,
p)}function Ra(a){B.send(a)}function Ha(){return n.displayName||n.server||n.symlink||n.id||"undefined"}function ab(a){k.setTitle&&(document.title=a)}function bb(a,b,c){this.need=a;this.handler=b;this.repeat=c||1}function Ab(a){ba=new RecordingManager;ba.setHeader({name:"rec",width:a.width,height:a.height,color:a.fontSize,namesuffix:".sshv",filetag:"SSHV",duration:0})}function Bb(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){if(D&&F){var h=
D.getThumbnail(a);h&&h.length!=d&&(B.send("8E7"+h),d=h.length)}},b))};this.stop=function(){clearInterval(c)}}function Cb(a,b){!W||W.width==a&&W.interval==b||(W.stop(),W=null);W||(W=new Bb(a,b));W.start()}function Db(a){F&&B.send("5D"+a.join("\t"));G=null}function cb(){if(G){var a=G.answer.length;a<G.prompt.length?(ea(G.prompt[a]),ra()):(B.send("5D"+G.answer.join("\t")),G=null)}}function Eb(a){F&&B.send("5B"+a)}function Fb(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=k.sessionInfo.appInfo;
switch(b){case 1:var d=JSON.parse(c);k.onsessionjoin&&(a=k.onsessionjoin(d));if(a)break;k.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);k.onsessionexit&&(a=k.onsessionexit(d));if(a)break;k.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;D.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=
!0;k.ongivecontrol&&(a=k.ongivecontrol());if(a)break;k.showMessage(__svi18n.info.givecontrol);break;case 4:D.setReadOnly(!0);e.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;k.ontakebackcontrol&&(a=k.ontakebackcontrol());if(a)break;k.showMessage(__svi18n.info.nocontrol);break;case 5:d=JSON.parse(c);k.onrequirecontrol&&(a=k.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);k.showMessage({title:a,msg:__svi18n.info.recontrol,cbYes:function(){k.giveControl(d.numericId);
this.destroy()},cbNo:function(){k.refuseControl(d.numericId);this.destroy()}});break;case 6:D.setTouchRemoting(!0);break;case 7:d=JSON.parse(c);d.width&&d.height&&xa(0,0,d.cols,d.rows);break;case 8:d=JSON.parse(c);if(k.onrequestcredential&&k.onrequestcredential(d))break;D.requestCredential(d);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Cb(d.width,d.interval):W&&(W.stop(),W=null);break;case 11:d=JSON.parse(c);k.onrequirejoin&&(a=k.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,
d.numericId,d.__ip]);k.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){k.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){k.allowJoin(d.numericId,!1);this.destroy()}});break;case 12:db=!0}}function Gb(a){var b=C.page&&C.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=Y();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,
e));return b+"/"+a}function sa(a){ka.style.display=a?"none":"block"}function Hb(a){svGlobal.logger.info("opened...");F=!0;B.send("87"+navigator.userAgent);if(k.onopen)k.onopen()}function Ib(a){svGlobal.logger.warn(a)}function Ia(a){svGlobal.logger.warn("closed ...");sa(!0);if(!F&&((a=__svi18n.errorCode.connection)||(a="error connection"),k)){if(k.onerror)k.onerror({name:"connection",message:a});k.showMessage(a);0<svGlobal.log&&console.error(a)}ya=F=!1;if(k)if(k.onclose)k.onclose(db);else if(hi5.appcfg&&
hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}try{null!=ba&&(ba.exit(),ba=null),D&&D.close()}catch(b){}oa&&(oa.release(),oa=null);aa=r=null;B&&(B.onopen=null,B.onmessage=null,B.onclose=null,B=B.onerror=null);D=Q=null;k&&(k=null);window&&window.$ssh&&(window.$ssh=null);null!=ba&&(ba.exit(),ba=null)}function eb(){10>n.fontSize&&(n.fontSize=10);13>n.fontSize?q=n.fontSize+6:12<n.fontSize&&19>n.fontSize?q=n.fontSize+8:18<n.fontSize&&25>n.fontSize?q=n.fontSize+12:24<n.fontSize&&
(q=n.fontSize+16);n.lineHeight&&(q=parseInt(n.lineHeight));fb=(q-n.fontSize)/2|0;r.textBaseline="top";r.font=n.fontSize+"px "+n.fontFamily;x=r.measureText("X").width;L=parseInt(p/q);N=parseInt(u/x);O=N*x;Qa(parseInt(p/q));E?E.resize(N,L):E=new $a(N,L)}function Sa(){Ga();A=v=0;eb();ka.style.width=x+"px";ka.style.height=q+"px";ya=!0}function gb(){za=!1;I=n.fgColor||ca[7];M=n.bgColor||ca[0];Ta=0;ta=!0}function hb(a){switch(a){case 0:svGlobal.logger.info("C0 0");break;case 5:svGlobal.logger.info("C0 END enquiry");
break;case 7:svGlobal.logger.info("C0 bell");break;case 8:Ua();break;case 9:v=8*((v/x/8|0)+1)*x;pa();break;case 10:A+=q;pa(!0);break;case 11:A+=q;pa(void 0);break;case 12:svGlobal.logger.info("C0 form feed");break;case 13:ib();break;case 14:svGlobal.logger.info("C0 Shift out");break;case 15:svGlobal.logger.info("C0 exit_alt_charset_mode");break;default:svGlobal.logger.warn("Unknown C0 control:"+a)}}function Jb(a){var b=a.getPosition();if(!P.parse(a))return a.setPosition(b-2),!1;a=P.count;b=P.parameters;
switch(P.command){case 64:0==a&&(b[0]=1);a=b[0];b="";for(var c=a*x,e=r.getImageData(v,A,O-v-c,q),d=0;d<a;d++)b+=" ";ea(b);v-=c;r.putImageData(e,v+c,A);E.insertSpace(a,T(),R());break;case 65:0==a&&(b[0]=1);A-=(b[0]||1)*q;break;case 66:0==a&&(b[0]=1);A+=(b[0]||1)*q;pa(!0);break;case 67:0==a&&(b[0]=1);a=b[0]||1;a>N&&(a=N);v+=a*x;break;case 68:0==a&&(b[0]=1);v-=(b[0]||1)*x;0>v&&(v=0);break;case 69:0==a&&(b[0]=1);A+=b[0]*q;v=0;break;case 70:0==a&&(b[0]=1);A-=b[0]*q;v=0;break;case 71:0==a&&(b[0]=1);Ja(0,
b[0]);break;case 72:case 102:0==a&&(b[0]=b[1]=1);Ja(b[0]||1,b[1]||1);break;case 74:a||(b[0]=0);switch(b[0]){case 0:r.fillStyle=M;r.fillRect(v,A,O-v,L*q-A);r.fillStyle=I;E.clearEOS(T(),R());break;case 1:r.fillStyle=M;r.fillRect(0,0,v,A);r.fillStyle=I;E.clearBOS(T(),R());break;case 2:Ga();A=v=0;E.cleanScreen();break;case 3:Ga();A=v=0;E.cleanScreen();break;default:svGlobal.logger.warn("invalid CSI J:"+b[0])}break;case 75:a||(b[0]=0);switch(b[0]){case 0:jb();break;case 1:r.fillStyle=M;r.fillRect(0,A,
v,q);r.fillStyle=I;E.clearBOL(T(),R());break;case 2:r.fillStyle=M;r.fillRect(0,A,O,q);r.fillStyle=I;E.clearLine(R());break;default:svGlobal.logger.warn("invalid CSI K:"+b[0])}break;case 76:case 84:a||(b[0]=1);kb(b[0],76==P.command);break;case 77:case 83:a||(b[0]=1);lb(b[0],77==P.command);break;case 80:a||(b[0]=1);a=b[0];b=v+a*x;b=r.getImageData(b,A,O-b,q);jb();r.putImageData(b,v,A);E.deleteChars(T(),R(),a);break;case 88:a||(b[0]=1);a=b[0];r.fillStyle=M;r.fillRect(v,A,a*x,q);r.fillStyle=I;E.eraseChars(T(),
R(),a);break;case 90:a||(b[0]=1);v=8*((v/x/8|0)-b[0]+1)*x;pa();break;case 99:J("x1B[?6c");break;case 100:a||(b[0]=1);Ja(b[0]);break;case 101:a||(b[0]=1);Ja(R()+b[0]);break;case 104:if(63==P.mode)switch(b[0]){case 1:qa.setCursorKeyMode(1);break;case 5:svGlobal.logger.info("Reversal screen mode");break;case 6:svGlobal.logger.info("Relative origion mode");break;case 7:svGlobal.logger.info("wraparound mode on");ta=!0;break;case 12:break;case 25:sa(!1);break;case 45:svGlobal.logger.info("reverse-wraparound mode on");
break;case 1E3:case 1001:case 1002:case 1003:case 1005:case 1006:V=b[0];svGlobal.logger.warn("mouse tracking on:"+V);break;case 1034:svGlobal.logger.warn("TD:Interpret meta key, xterm.");break;case 1048:case 1049:svGlobal.logger.warn("TD: Save cursor");break;default:svGlobal.logger.warn("TD: CSI ? Pm h, Ps:"+b[0])}break;case 108:if(63==P.mode)switch(b[0]){case 1:qa.setCursorKeyMode(0);break;case 2:Aa.setKeyboard("vt52");break;case 3:svGlobal.logger.info("80 Column Mode (DECCOLM), VT100");break;case 5:svGlobal.logger.info("screen mode: "+
P.toString());break;case 6:svGlobal.logger.info("Absolute origion mode: "+P.toString());break;case 7:ta=!1;break;case 12:break;case 25:sa(!0);break;case 45:svGlobal.logger.info("reverse-wraparound mode off");break;case 47:svGlobal.logger.info("TODO: use Normal Screen Buffer, xterm.");break;case 1E3:case 1001:case 1002:case 1003:case 1005:case 1006:V=0;break;case 1048:case 1049:svGlobal.logger.warn("TD: Restore cursor");break;default:svGlobal.logger.warn("TD: CSI ? Pm l, Ps:"+b[0])}break;case 109:0==
a&&(a=1,b[0]=0);for(c=0;c<a;c++)switch(b[c]){case 0:Ba(7);Ca(0);Va(!1);break;case 1:Va(!0);break;case 2:break;case 4:break;case 5:case 8:break;case 7:Ba(0);Ca(7);break;case 27:Ba(7);Ca(0);break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:Ba(b[c]-30);break;case 38:return 2==b[c+1]&&(I="rgb("+b[c+2]+","+b[c+3]+","+b[c+4]+")",r.fillStyle=I),!0;case 39:Ba(7);break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:Ca(b[c]-40);break;case 48:return 2==b[c+1]&&(M="rgb("+
b[c+2]+","+b[c+3]+","+b[c+4]+")"),!0;case 49:Ca(0);1==c&&39==b[0]&&Va(!1);break;default:return svGlobal.logger.warn("TD: SGR="+P.toString()),!0}break;case 110:6==b[0]?63==P.mode?J("\u001b[?"+R()+";"+T()+"R"):J("\u001b["+R()+";"+T()+"R"):5==b[0]&&J("\u001b[0n");break;case 112:"!"==P.trailing&&gb();break;case 114:P.mode||Qa(b[1],b[0]);break;case 124:break;default:svGlobal.logger.warn("TD: CSI="+P.toString())}return!0}function kb(a,b){a||(a=1);b=b?A/q+1|0:Z;var c=(b-1)*q;if(S!=b){var e=r.getImageData(0,
c,O,(S-b-a+1)*q);r.fillStyle=M;r.fillRect(0,c,O,q*a);r.putImageData(e,0,(b+a-1)*q);r.fillStyle=I;E.scrollUp(a,b,S)}}function lb(a,b){a||(a=1);b=b?A/q+1|0:Z;var c=(b-1)*q,e=S*q,d=a*q,h=c+d;e!=h&&(h=r.getImageData(0,h,O,e-h),r.fillStyle=M,r.fillRect(0,e-d,O,d),r.fillStyle=I,r.putImageData(h,0,c),E.scrollDown(a,b,S))}function pa(a){ta&&v>=O&&(v=0,A+=q);(ta||a)&&A>wa&&(A>wa&&(A=wa),Za?(r.drawImage(aa,0,-q),r.fillStyle=M,r.fillRect(0,wa,u,q),E.appendLines(1)):(a=r.getImageData(0,(Z-0)*q,O,(S-Z)*q),r.fillStyle=
M,r.fillRect(0,(Z-1)*q,O,(S-Z+1)*q),r.putImageData(a,0,(Z-1)*q),E.scrollDown(1,Z,S)),r.fillStyle=I)}function Ua(){v-=x;0>v&&(v=0)}function R(){return(A/q|0)+1}function T(){return(v/x|0)+1}function Ja(a,b){b&&(v=(b-1)*x,0>v&&(v=0));a&&(a>L&&(a=L),A=(a-1)*q)}function Ca(a){M=Ka[a];M||(M=n.bgColor||"black",svGlobal.logger.info("xx colorIndex:"+a))}function Ba(a){Ta=a;I=ca[a];I||(I=n.fgColor||"white",svGlobal.logger.info("xx colorIndex:"+a));r.fillStyle=I}function Va(a){ca=a?mb:Ka;I=ca[Ta]}function jb(){r.fillStyle=
M;r.fillRect(v,A,O-v,q);r.fillStyle=I;E.clearEOL(T(),R())}function Ga(){r.fillStyle=M;r.fillRect(0,0,aa.width,aa.height);r.fillStyle=I}function ra(){ka.style.top=A+"px";ka.style.left=v+"px";var a=E.getChar((v/x|0)+1,(A/q|0)+1);a&&r.measureText(a).width>x?ka.style.width=2*x+"px":ka.style.width=x+"px"}function ea(a){if(a){U.on&&(a.startsWith(U.prompt)?(U.on=!1,setTimeout(U.process,30)):U.text+=a);var b=N-(v/x|0);for(var c=a.length,e=0;e<c;){var d=a.charAt(e++);r.measureText(d).width>x?b-=2:b--;if(0==
b)break;else if(0>b){e--;break}}b=e+1>c?-1:e;0<=b?(nb(a.substring(0,b),b),pa(),ea(a.substring(b))):nb(a,a.length)}}function nb(a,b){if(a){E.writeText(T(),R(),a);for(var c=0,e=[],d=0;d<b;d++){var h=a.charAt(d),t=r.measureText(h).width;e.push(t);c+=t<=x?x:2*x}r.fillStyle=M;r.fillRect(v,A,Math.ceil(c),q);r.fillStyle=I;c=A+fb;for(d=0;d<b;d++)h=a.charAt(d),t=e[d],t==x?(r.fillText(h,v,c),v+=x):t>x?(t=(2*x-t)/2|0,r.fillText(h,v+t,c),v+=2*x):(t=(x-t)/2|0,r.fillText(h,v+t,c),v+=x)}}function ob(a){fa+=a;la?
(ea(a),ra()):G&&G.echo[G.answer.length]&&(ea(a),ra())}function ib(){v=0;A>(S-1)*q&&(A=(S-1)*q)}function pb(a){if(F&&Da)return(a=a.getData("text/plain"))?(a=a.replace(/\r\n/g,"\n"),la||G?ob(a):J(a),!0):!1}function Wa(){if(X){var a=!!X.value;X.value=E.toString();a||(a=new hi5.ui.Lightbox(X.parentNode),a.show(),D&&D.setIgnorePaste(!1),a.onclose=function(){X.value="";D&&D.focus()});setTimeout(function(){X.scrollTop=X.scrollHeight},10)}}function qb(a){z(n.mapDisk)&&(K||(K=new hi5.file.UploadManager(new hi5.file.WsFileService(Ra),
!1),K.enabled=!0,K.canCopyFile=!1,K.addEvent("beforeupload",function(b,c,e){k.beforeupload&&k.beforeupload(b,c,e)}),K.addEvent("fileuploaded",function(b,c,e){if(k.onfileuploaded)k.onfileuploaded(b,c,e)}),K.addEvent("uploaded",function(b,c){if(k.onuploaded)k.onuploaded(b,c)}),K.addEvent("uploadingCancelled",function(){if(k.onuploadingCancelled)k.onuploadingCancelled()})),a.setFileHandler(K))}function rb(a,b,c){return a.querySelector(b+'[name="'+c+'"]')||document.getElementById(c)}function J(a){if(a){a=
La.encode(a);var b=a.length+1,c=new Uint8Array(b);c[0]=147;for(var e=1;e<b;e++)c[e]=a[e-1];B.send(c.buffer)}}function Kb(a,b){a&&"text/plain"==b?pb(a):k.showMessage("Please use Ctrl+V or browser's Edit menu")}function $a(a,b){function c(){var f=Array(a);hi5.Arrays.fill(f,0,a," ");return f}function e(f,g){if(g)for(var m=r.measureText("W").width,w=0;w<f;w++){var H=g[w];H&&7923<H.charCodeAt(0)&&r.measureText(H).width>m&&f--}return f}var d=0,h=[],t=10*b;this.resize=function(f,g,m){m=0;for(var w=h.length;m<
w;m++)if(h[m]&&(h[m].length=f,f>a))for(var H=a;H<f;H++)h[m][H]=" ";a=f;b=g;t=10*b};this.writeText=function(f,g,m){g--;f--;var w=h[d+g];w||(w=c(),h[d+g]=w);g=0;for(var H=m.length;g<H;g++)w[g+f]=m[g]};this.appendLines=function(f){d+=f};this.scrollDown=function(f,g,m){m=d+m-1-f;for(g=d+g-1;g<=m;g++)h[g]=h[g+f];m++;for(g=0;g<f;g++)h[m+g]=c()};this.scrollUp=function(f,g,m){g=d+g-1+f;for(m=d+m-1;m>=g;m--)h[m]=h[m-f];g--;for(m=0;m<f;m++)h[g-m]=c()};this.cleanScreen=function(){d=h.length;if(d>=t){var f=2*
b;h.splice(0,f);d-=f}};this.clearEOS=function(f,g){g--;f--;for(var m=d+g,w,H=0,ha=b-g;H<ha;H++)if(w=h[m+H])for(g=f;g<a;g++)w[g]=" "};this.clearBOS=function(f,g){g--;f--;for(var m=d,w,H,ha=0;ha<g;ha++)if(H=h[m+ha])for(f=e(f,dataRow),w=0;w<f;w++)H[w]=" "};this.clearLine=function(f){f--;(f=h[d+f])&&hi5.Arrays.fill(f,0,a," ")};this.clearBOL=function(f,g){g--;f--;if(g=h[d+g]){f=e(f,g);for(var m=0;m<f;m++)g[m]=" "}};this.clearEOL=function(f,g){g--;f--;if(g=h[d+g])for(f=e(f,g);f<a;f++)g[f]=" "};this.eraseChars=
function(f,g,m){g--;f--;if(g=h[d+g]){var w=f=e(f,g);for(f+=m;w<f;w++)g[w]=" "}};this.deleteChars=function(f,g,m){g--;f--;if(g=h[d+g])f=e(f,g),g.splice(f,m)};this.getChar=function(f,g){g--;f--;return(g=h[d+g])?g[e(f,g)]:null};this.insertSpace=function(f,g,m){m--;g--;if(m=h[d+m]){g=e(g,m);for(var w=m.length-1;w>=g;w--)m[w+f]=m[w];for(w=0;w<f;w++)m[g+w]=" "}};this.getSingleLine=function(f,g,m){f--;g--;m--;var w="";if(f=h[d+f])for(g=e(g,f),m=e(m,f);g<m;g++)w+=f[g];return w.trimEnd()};this.getMultiLines=
function(f,g,m,w){if(w<g)return this.getMultiLines(m,w,f,g);var H=w-g+1;if(1>H)return null;if(1==H)return this.getSingleLine(g,f,m);f=this.getSingleLine(g,f,a);m=this.getSingleLine(w,1,m);H-=2;g+=d;for(var ha=0;ha<H;ha++)f=(w=h[ha+g])?f+("\r\n"+w.join("").trimEnd()):f+"\r\n\r\n";return f+"\r\n"+m};this.toString=function(){for(var f="",g=0,m=h.length;g<m;g++)h[g]&&(f+=h[g].join("").trimEnd()),f+="\r\n";return f}}var ia=0,ja=null,db=!1,za=!1;this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=
!0;this.mode=0;this.reconnectOnResize=!0;var k=this,sb=new hi5.codec["utf-8"].Decoder,La=new hi5.codec["utf-8"].Encoder,Lb={stream:!0};this.setCodec=function(a,b){sb="string"==typeof a?"utf-8"==a?new hi5.codec["utf-8"].Decoder:new TextDecoder(a):a;if(b)if("string"==typeof b)if(a=hi5.codec[b])La=new a.Encoder;else return La=new hi5.codec["utf-8"].Encoder,svGlobal.logger.warn("Unsupported encode: "+b),!1;else La=b;return!0};this.getHistory=function(){return E.toString()};hi5.appcfg||(hi5.appcfg={img:{},
toolbar:{fadable:!0},displayMsg:!0});var C=hi5.appcfg,U={on:!1,text:"",prompt:"",cmd:"",process:function(){var a=U.cmd.indexOf(" "),b=U.cmd.substring(a+1);a=b.lastIndexOf(".");var c="";if(-1!=a)switch(b.substring(a+1).toLowerCase()){case "jpe":case "jpg":case "jpeg":c="image/jpeg";break;case "gif":c="image/gif";break;case "bmp":c="image/bmp";break;case "svg":c="image/svg+xml";break;case "png":c="image/png";break;case "webp":c="image/webp";break;case "ico":c="image/x-icon"}a="data:"+(c||"application/octet-stream")+
";base64,"+U.text;U.text="";k.showMessage(c?{msg:'<img src="'+a+'" style="max-width:100%"/>',html:!0}:{msg:'<a download="'+b+'" href="'+a+'" target="_blank">'+b+"</a>",html:!0})}};void 0!=C.reconnectOnResize&&(this.reconnectOnResize=C.reconnectOnResize);var Xa="object"==typeof l?l:null,tb="object"==typeof l||0<l.indexOf("/PLAY?");tb?(this.mode=1,Xa&&(l=""),l+="&touchpad=on"):0<l.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var n=hi5.tool.queryToObj(l.substring(l.indexOf("?")+1));void 0==
n.mapClipboard&&C.clipboard&&void 0!=C.clipboard.enabled&&(n.mapClipboard=C.clipboard.enabled);n.keyfile&&n.keyfile.startsWith("-----BEGIN")&&(C.wsPost=!0);n.color||(n.color=32);n.fontFamily||(n.fontFamily='"Courier New"');var Mb=n.terminalType||"default",Da=z(n.mapClipboard),X=null,E=null,Fa={download:"/DOWNLOAD?",clipboard:"/CLIP?"};this.setLinks=function(a){a.download&&(Fa.download=a.download);a.clipboard&&(Fa.clipboard=a.clipboard)};this.server=n.server;this.port=parseInt(n.port,10);this.sessionInfo=
{major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var D=null,F=!1,ya=!1,Ya=0,Ea="",V=0,K=null;C.copyDialog=!0;var v=0,A=0,ub=0,vb=0,x=0,q=18,fb=0,Ka="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),mb="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),Nb="#073642 #dc322f #859900 #b58900 #268bd2 #d33682 #2aa198 #eee8d5".split(" "),Ob="#002b36 #cb4b16 #586e75 #657b83 #839496 #6c71c4 #93a1a1 #fdf6e3".split(" "),Pb="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),
Qb="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),ca=Ka,I=n.fgColor||ca[7],M=n.bgColor||ca[0],Ta=0,ta=!0;n.wraparoundMode&&(ta=z(n.wraparoundMode));var Z=1,S=24,wa=0,Za=!0,ka=null,L=0,N=0,O=0,ba=null;window.$ssh=this;var oa=new function(a){var b=0,c=0,e=new Uint8Array(a),d=this,h=new bb(0,null,0);this.needMore=!1;this.release=function(){d=e=h=null};this.getHandler=function(){return h};this.getData=function(){return e};this.getPosition=function(){return b};this.setPosition=
function(t){b=t};this.getEnd=function(){return c};this.has=function(t){return c-b>=t};this.set=function(t){var f=t.length,g=c-b;if(1>g)c=f,e=t;else{var m=e.subarray(b,c);c=g+f;f=new Uint8Array(c);f.set(m);f.set(t,g);e=f}b=0};this.handle=function(){h.handler(d,h)};this.setHandler=function(t){t&&1>t.need&&svGlobal.logger.warn("need < 1");(h=t)&&c-b>=t.need&&t.handler(d,t)};this.getByte=function(){return e[b++]};this.peekByte=function(){return e[b]};this.getBE32=function(){return e[b++]<<24|e[b++]<<
16|e[b++]<<8|e[b++]};this.getBE16=function(){return e[b++]<<8|e[b++]};this.skip=function(t){b+=t};this.skipBack=function(t){b-=t};this.getBytes=function(t,f){if(f)for(var g=0;g<t;g++)f[g]=e[b++];else return f=b,b+=t,e.subarray(f,b)};this.copyToByteArray=function(t,f,g,m){hi5.Arrays.arraycopy(e,g,t,f,m)}}(4194304),Rb={l:"\u250c",k:"\u2510",m:"\u2514",j:"\u2518",q:"\u2500",x:"\u2502",n:"\u253c","~":"\u2022",u:"\u2524",t:"\u251c",v:"\u2534",w:"\u252c"};this.__que=oa;this.running=function(){return F};
this.setTheme=function(a){"light"==a?(this.setColorTable(Nb),this.setColorTableBright(Ob)):"classic"==a?(this.setColorTable(Pb),this.setColorTableBright(Qb)):svGlobal.logger.warn("Invalid theme: "+a)};this.setColorTable=function(a){ca=Ka=a;I=n.fgColor||ca[7];M=n.bgColor||ca[0]};this.setColorTableBright=function(a){mb=a};this.loadbalanceToken="";if(C.ssh){var Ma=C.ssh;Ma.theme&&!n.theme&&(n.theme=Ma.theme);Ma.charset&&!n.charset&&(n.charset=Ma.charset)}n.theme&&this.setTheme(n.theme);n.charset&&this.setCodec(n.charset);
C.loadbalanceTokenName&&n[C.loadbalanceTokenName]&&da(n[C.loadbalanceTokenName]);this.mapCmdToCtrl=!0;var B=null;u||(u=window.innerWidth);n.width=u;l+="&width="+u;p||(p=window.innerHeight);n.height=p;l+="&height="+p;y=(y=y||n.fontSize)?parseInt(y):13;n.fontSize?(y=parseInt(n.fontSize,10),n.fontSize=y):(n.fontSize=y,l+="&fontSize="+y);var aa=window.OffscreenCanvas?new OffscreenCanvas(u,p):document.createElement("canvas"),r;this.modifyURL=function(a){k.loadbalanceToken&&(a+="&"+k.loadbalanceToken);
return a};this.__write=Ra;this.getFileUrl=function(a){var b=Y(),c=Fa.download,e=c.indexOf("://");b=(0<e&&11>e?c:b+c)+"s="+Ea+"&f="+a;return k.modifyURL(b)};this.listFiles=function(a,b){K&&K.list(a,b)};this.reconnect=function(a,b){xa(a,b);B.send("ED"+N+"\t"+L+"\t"+u+"\t"+p)};var Q=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.localLockFlags=0;this.checkLockFlags=!0;var c=!1,e={drawable:b};this.pauseUpdate=function(h){c=h};
this.draw=function(h,t,f,g,m){return c?null:e};this.getAppMode=function(){return a.mode};this.send=function(h){"891"!=h&&F&&a.__write(h)};this.sendInput=function(h){a.writeRawInput(h);if(a.onactivity)a.onactivity(h)};var d=null;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.onresize=function(h){if(h=h.target.svSurface){h=h.getFreeSpace();var t=h.width,f=h.height;hi5.browser.isTouch||Math.abs(u-t)<x&&Math.abs(p-f)<q||!a.reconnectOnResize||!F||(d&&(clearTimeout(d),d=null),d=setTimeout(function(){xa(t,
f);B.send("ED"+N+"\t"+L+"\t"+u+"\t"+p)},333))}};this.onorientationchange=function(h){};this.getClipData=zb;this.getShareFiles=a.listFiles;this.getFile=function(h){var t=a.getFileUrl(h);a.ondownload&&a.ondownload({fileName:h,url:t})||window.open(t)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return l};this.reconnect=function(h,t,f){};this.sendKeyboardSyncFlags=function(h){return F?(this.remoteLockFlags=this.localLockFlags=h,!0):!1};this.setWorkDir=function(h,t){t&&a.writeText("cd "+t+
"\n")}}(this,aa);void 0!=C.displayMsg?this.displayMsg=C.displayMsg:C.displayMsg=this.displayMsg;void 0!=C.reconnectTimes&&(this.reconnectTimes=C.reconnectTimes);void 0!=C.openLink&&(this.openLink=C.openLink);void 0!=C.setTitle&&(this.setTitle=C.setTitle);"boolean"==typeof C.useWSS&&(l=(C.useWSS?"wss":"ws")+l.substring(l.indexOf("://")));this.getURL=function(){return l};this.getRuntimeURL=function(a){eb();var b=l+"&cols="+N+"&rows="+L;b+="&binary=on";var c=window.opener;if(c){var e=null;try{e=c.__sparkUser}catch(d){}e&&
(c=e.account,e=e.session,c&&(b+="&account="+c),e&&(b+="&session="+e))}b+="&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0);a&&0==k.mode&&C.wsPost&&(b=l.substring(0,l.indexOf("?"))+"?_METHOD=post");b=k.modifyURL(b);(a=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(b+="&__SV_TOKEN_A="+encodeURIComponent(a));return b};var Sb=parseInt(n.server_bpp||n.color||24);this.getColor=function(){return Sb};this.getDisplayName=Ha;this.run=function(){if(!F){if(Xa)B=Xa,Sa();else{var a=k.getRuntimeURL(!0);
B=k.oncreatewebsocket?k.oncreatewebsocket(a):new WebSocket(a,"ssh");B.binaryType="arraybuffer"}B.onopen=Hb;void 0!=n.recording&&"on"==n.recording&&Ab(n);B.onmessage=function(b){b=b.data;if("string"!=typeof b){var c=new Uint8Array(b);null!=ba&&ba.add(new RecordingObj(c,0,b.byteLength));oa.set(c);oa.handle()}else{var e=parseInt(b.substring(0,2),16);c=b.substring(2);switch(e){case 0:b=k.getRuntimeURL(!1);b=b.substring(b.indexOf("?")+1);B.send("00"+b);break;case 15:b=JSON.parse(c);B.send("8D");if(k){k.sessionInfo.protocolVersion=
b.protocolVersion;if(k.onready)k.onready();if(k.onloggedin)k.onloggedin();C.pingInterval&&k.startPing(C.pingInterval);K&&(K.enabled=!0)}sa(!1);break;case 26:b=JSON.parse(c);if(b.name){svGlobal.logger.info("msg="+c);if(k.onerror)k.onerror(b);c=__svi18n.errorCode["S"+b.name]||"";c+=b.message||b.msg;k.showMessage(c)}else 0<svGlobal.log&&console.erro("No error code for message:"+c);break;case 27:0!=C.drawLicense&&D.drawLicense(c);break;case 56:b=JSON.parse(c);Ea=b.session;da(b.appId);b.server||(b.server=
Ha());if(c=hi5.$("joinSelect"))c.value=b.joinMode;if(c=hi5.$("requestControl"))c.disabled=b.hasControl;c=Gb("joinssh.html")+"?id="+b.numericId;c=k.modifyURL(c);var d=b.webAddress;d&&0<d.length&&(e=d.indexOf("://"),d=d.substring(e+3),e=d.indexOf("/"),0<e&&(d=d.substring(0,e)),d.toLowerCase()!=location.host.toLowerCase()&&(c+="&gateway="+d));b.joinLink=c;k.sessionInfo.appInfo=b;b.ver&&b.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+b.ver);Sa();if(k&&k.onsessionstart)k.onsessionstart(k.sessionInfo);
break;case 58:if(K)if(b=parseInt(c.charAt(0),10),c=c.substring(1),5==b)K.notifyFiles(JSON.parse(c));else switch(c=c.split("\t"),b){case 1:K.confirmId(c[0],c[1],c[2]);break;case 2:K.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:K.close(c[0]);break;case 9:b='<a href="'+c[0]+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>",surfaces.getFocused().showMessage({msg:b,title:__svi18n.info.download})}break;case 59:b=hi5.Base64.dec(c,0);Ya=b[3]<<24|b[2]<<16|b[1]<<8|b[0];
Ya&64&&k.showMessage(__svi18n.info.recording);D.setFeature(Ya);break;case 61:b=JSON.parse(c);switch(b.type){case 0:n.fontSize=parseInt(b.fontSize);u=b.width;p=b.height;Sa();D.setAutoScale(!0);xa(0,0,N,L);if(c=b.server)k.server=b.server,ab(Ha());(c=b.mapDisk)&&qb(D);sa(!1);wb=b.length;if(k.onopened)k.onopened(b);break;case 1:b=b.duration;if(k.onprogress)k.onprogress(b,wb);break;case 2:2==b.status?F=!0:(c=0==b.status,Q.pauseUpdate(c),b.warn&&k.showMessage(c?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;
case 62:Fb(c);break;case 91:ya=!0;if(k.onusername)k.onusername(Eb);else ea(__svi18n.info.user||c),la=!0,ra();break;case 93:G=JSON.parse(c);if(k.onauthprompt)k.onauthprompt(G,Db);else b=G.name||"",G.instruction&&(b+=G.instruction),b&&(A+=q,v=0,ea(b),ra()),G.answer=[],cb();break;default:svGlobal.logger.warn("@TODO:"+b+"\n")}}};B.onclose=Ia;B.onerror=Ib;ab(Ha())}};this.setJoinMode=function(a){F&&B.send("8E1"+a)};this.refuseControl=function(a){F&&B.send("8E3"+a)};this.giveControl=function(a){F&&B.send("8E4"+
a)};this.requestControl=function(){F&&B.send("8E2")};this.play=function(){B.send("F3")};this.pause=function(){B.send("F2")};this.scan=function(a){B.send("F4"+(a?"1":"0"))};this.seek=function(a){D&&F&&B.send("F4"+(a?"1":"0")+"\t"+(a/D.getScale().x|0))};this.allowJoin=function(a,b){B.send("8EA"+a+"\t"+(b?1:0))};var W=null,la=!1,G=null,fa="",wb=0;this.hide=function(){D&&(sa(!0),D.hide())};this.showMessage=function(a,b){k.displayMsg&&a&&(D?D.showMessage(a,b):("string"==typeof a&&(a={msg:a,timeout:b||
0}),hi5.notifications.notify(a)))};this.close=function(){if(B&&F)try{B.send("85"),B.close()}catch(a){}else Ia()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(Ia):window.addEventListener("unload",Ia,!1);var Tb=new bb(1024,function(a){var b=v,c=A;for(a.needMore=!1;a.has(1);){var e=a.getByte();if(31>=e)if(27==e){a:{var d=a;if(d.has(1)){e=d.getByte();switch(e){case 40:e=d.getByte();svGlobal.logger.info("G0 Character Set start:"+String.fromCharCode(e));48==e?(za=!0,svGlobal.logger.info("Line drawing mode on")):
(svGlobal.logger.info("Line drawing mode off"),za=!1);break;case 41:e=d.getByte();za=!1;svGlobal.logger.info("G0 Character Set canel: "+String.fromCharCode(e));break;case 60:Aa.exitVT52();break;case 55:ub=v;vb=A;break;case 56:v=ub;A=vb;break;case 61:svGlobal.logger.info("TODO: Enter alt keypad mode");break;case 62:svGlobal.logger.info("TODO: Enter keypad mode");break;case 66:break;case 68:lb();break;case 69:ib();A+=q;pa(!0);break;case 77:kb();break;case 83:break;case 90:J("x1B[?6c");break;case 92:svGlobal.logger.info("ST");
break;case 93:e=svGlobal.logger;for(var h=e.info,t=d,f=t.getPosition(),g="",m=t.getEnd(),w=t.getData();f<m;)if(d=w[f++],7!=d)switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCodePoint(d);break;case 12:case 13:g+=String.fromCodePoint((d&31)<<6|w[f++]&63);break;case 14:g+=String.fromCodePoint((d&15)<<12|(w[f++]&63)<<6|(w[f++]&63)<<0)}else break;t.setPosition(f);h.call(e,"OSC:"+g);break;case 91:e=Jb(d);break a;case 99:svGlobal.logger.info("full reset");gb();break;default:svGlobal.logger.warn("unkown cmd for ESC:"+
e)}e=!0}else d.skipBack(1),e=!1}if(!e)return}else hb(e);else if(128<=e&&159>=e)switch(e){case 146:a.skip(2);break;default:svGlobal.logger.warn("C1:"+e)}else{a.skipBack(1);e=a;h=e.getPosition();t=e.getEnd();f=e.getData();for(g=h;h<t;)if(d=f[h++],31>=d){h--;break}e.setPosition(h);if(h>g){if(e=f.subarray(g,h),e=sb.decode(e,Lb),za)for(h=e.split(""),e="",d=0,t=h.length;d<t;d++)f=h[d],e+=Rb[f]||f}else e="";ea(e);if(a.needMore)return}}b==v&&c==A||ra();ja&&ja.check()});oa.setHandler(Tb);this.refreshOutput=
function(){};var P={mode:0,parameters:[0],count:0,trailing:"",command:0,toString:function(){var a="CSI, ";this.mode&&(a+="mode:"+String.fromCharCode(this.mode));0<this.count&&(a+=" parameters:"+this.parameters.slice(0,this.count).join(";"));this.trailing&&(a+=" trailing:"+this.trailing);return a+=" cmd:"+String.fromCharCode(this.command)},parse:function(a){var b=0,c=!1,e=a.getByte();if(!e)return!1;if(60<=e&&63>=e)this.mode=e,e=a.getByte();else if(this.mode=0,31>=e||128<=e&&159>=e)hb(e),e=a.getByte();
if(!e)return!1;for(this.count=0;48<=e&&63>=e;)if(59==e?(this.parameters[this.count]=c?b:null,this.count++,b=0,c=!1):48<=e&&57>=e?(b=10*b+(e-48),c=!0):svGlobal.logger.warn("CSI Parameter: "+String.fromCharCode(e)),e=a.getByte(),!e)return!1;c?(this.parameters[this.count]=b,this.count++):0<this.count&&(this.parameters[this.count]=1,this.count++);for(;32<=e&&47>=e;)if(this.trailing+=String.fromCharCode(e),e=a.getByte(),!e)return!1;64<=e&&127>=e?this.command=e:(this.command="",svGlobal.logger.warn("Invalid CSI final char:"+
String.fromCharCode(e)));return!0}},Na=document.getElementById("svHistory");Na&&(Da?Na.onclick=Wa:Na.parentNode.removeChild(Na));this.showHistory=Wa;this.getUploadManager=function(){return K};this.addSurface=function(a){D=a;tb&&a.setPlayerMode();var b=a.canvas.parentNode;Da&&(X=rb(b,"textarea","copytextarea"))&&(X.value="");ka=rb(b,"div","cursorID");aa.width=u;aa.height=p;r=aa.getContext("2d",{alpha:!1});r.fontKerning="none";a.alwaysPaste=!0;a.setAutoScale(0<k.mode);xa(u,p);a.setController(Q);a.setTouchpad(z(n.touchpad));
a.setClipboard(z(n.mapClipboard));qb(D);b=void 0!=n.cmdToCtrl?z(n.cmdToCtrl):void 0!=C.cmdToCtrl?C.cmdToCtrl:k.mapCmdToCtrl;a.run(99997,!1,!1,b);Da&&(a.onclipdata=pb)};this.sendPing=function(a){a=new Uint8Array(2);a[0]=146;Ra(a.buffer)};this.startPing=function(a){ja||(ja=new hi5.tool.ResponseMonitor(function(){ya&&k.sendPing()},function(){ya&&ja.check(1)}));ja.setInterval(a,a);setTimeout(function(){ja.check()},1E3*a)};this.stopPing=function(){ja&&ja.stop()};this.writeText=J;this.writeScancode=function(a,
b){J(qa.process(a,b,0))};var Ub={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.writeKeyComb=function(a){a=a.split("+");var b=a.length;if(0!=b)for(var c=null,
e=0;e<b;e++){var d=a[e];""==d&&""==c&&(d="Add");if(""!=d){c=d;var h=Ub[c.toLowerCase()];h?k.writeScancode(!0,h):svGlobal.logger.warn("Invalid key:"+c)}c=d}};var Oa=!1,ma=0,na=0,Pa=0,ua=!1,xb=0,yb=0,va=null;this.writeRawInput=function(a){if(F){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");switch(b){case 128:ma=parseInt(a[0]);na=parseInt(a[1]);Pa=parseInt(a[2]);ua=!1;Oa=!0;xb=Math.floor(ma/x)*x;yb=Math.floor(na/q)*q;1015==V?J("\u001b["+(parseInt(a[2])+32)+";"+(Math.floor(ma/x)+1)+
";"+(Math.floor(na/q)+1)+"M"):1006==V?J("\u001b[<"+a[2]+";"+(Math.floor(ma/x)+1)+";"+(Math.floor(na/q)+1)+"M"):V&&J("\u001b[M"+a[2]+String.fromCharCode(Math.floor(ma/x)+33)+String.fromCharCode(Math.floor(na/q)+33));return;case 129:V&&(1015==V?J("\u001b["+(parseInt(a[2])+32)+";"+(Math.floor(ma/x)+1)+";"+(Math.floor(na/q)+1)+"M"):1006==V?J("\u001b[<"+a[2]+";"+(Math.floor(parseInt(a[0])/x)+1)+";"+(Math.floor(parseInt(a[1])/q)+1)+"m"):V&&J("\u001b[M3"+String.fromCharCode(Math.floor(parseInt(a[0])/x)+
33)+String.fromCharCode(Math.floor(parseInt(a[1])/q)+33)));Pa=parseInt(a[2]);2==Pa&&Oa&&!ua?(X&&(X.value=""),Da&&D.processClipReq("text/plain",Kb)):ua&&(a=E.getMultiLines(Math.floor(ma/x)+1,Math.floor(na/q+.1)+1,Math.floor(parseInt(a[0])/x+.4)+1,Math.floor(parseInt(a[1])/q-.4)+1))&&D&&D.copyToClip("text/plain;"+a);va&&(setTimeout(D.removeWhiteboard,333),va=null);ua=Oa=!1;return;case 130:if(Oa){b=parseInt(a[0]);a=parseInt(a[1]);if(!ua){if(3>Math.abs(b-ma)&&3>Math.abs(a-na))return;ua=!0}if(0==Pa){if(!va){var c=
D.initWhiteboard();c.style.opacity=.6;c=c.getContext("2d");va=new hi5.canvas.TextSelect(c,q,C.selectionColor,"1px",u)}va.clear();va.draw(xb,yb,b,a)}}return;case 131:1006==V?J("\u001b[<"+("1"==a[2]?65:64)+";"+(Math.floor(parseInt(a[0])/x)+1)+";"+(Math.floor(parseInt(a[1])/q)+1)+"M"):V?J("\u001b[M"+("1"==a[2]?5:4)+String.fromCharCode(Math.floor(parseInt(a[0])/x)+64)+String.fromCharCode(Math.floor(parseInt(a[1])/q)+64)):"0"==a[2]&&Wa();return;case 132:c=0==a[0];b=parseInt(a[1]);if(la||G)c&&(a=b,28==
a||156==a?(A+=q,v=0,la?(la=!1,B.send("5B"+fa),fa=""):G&&(G.answer.push(fa),fa="",cb())):14==a&&0<fa.length&&(fa=fa.substring(0,fa.length-1),la&&(Ua(),ea(" "),Ua())));else if(J(qa.process(c,b,0)),28!=b)ia||(ia=T());else if(ia){if(ia&&(a=E.getSingleLine(R(),ia,T()))){b=E.getSingleLine(R(),1,ia);if(k.oncommand)k.oncommand(a,b);a.startsWith("cd /")?D.setDirectory(a.substring(3)):a.startsWith("base64 ")&&(U.on=!0,U.cmd=a,U.prompt=b)}ia=0}return;case 139:b=parseInt(a[1]);c=0==a[0];J(qa.process(c,b,1));
return;case 134:la||G?ob(a[0]):(ia||(ia=T()),J(qa.process(!0,a[0],3)));return}svGlobal.logger.warn("Unknowncode: "+a[1]+" type:"+b)}};var Aa=new function(){function a(m){switch(m){case d:return"vt100";case h:return"vt52";case t:return"att513";case e:return"linux";case c:return"xterm";case b:return"default";default:return"unknown"}}var b="\u001b[11~ \u001b[12~ \u001b[13~ \u001b[14~ \u001b[15~ \u001b[17~ \u001b[18~ \u001b[19~ \u001b[20~ \u001b[21~ \u001b[23~ \u001b[24~".split(" "),c="\u001bOP \u001bOQ \u001bOR \u001bOS \u001b[15~ \u001b[17~ \u001b[18~ \u001b[19~ \u001b[20~ \u001b[21~ \u001b[23~ \u001b[24~".split(" "),
e="\u001b[[A \u001b[[B \u001b[[C \u001b[[D \u001b[[E \u001b[17~ \u001b[18~ \u001b[19~ \u001b[20~ \u001b[21~ \u001b[23~ \u001b[24~".split(" "),d="\u001bOP \u001bOQ \u001bOR \u001bOS \u001bOT \u001bOU \u001bOV \u001bOW \u001bOX \u001bOY \u001bOZ \u001bO[".split(" "),h=["\u001bP","\u001bQ","\u001bR","\u001bS"],t="\u001bOw \u001bNa \u001bSB \u001b[J \u001bOm \u001bf6 \u001b[U \u001b[V \u001bOk \u001bOl".split(" "),f=b,g=b;this.setKeyboard=function(m){m=m.toLowerCase();svGlobal.logger.info("set keyboard: "+
m);f!=h&&(g=f);switch(m){case "vt52":f=h;break;case "att513":f=t;break;case "vt100":f=d;break;case "linux":f=e;break;case "xterm":f=c;break;case "default":f=b;break;default:f=b}};this.exitVT52=function(){svGlobal.logger.info("exit vt52, switch to: "+a(g));f=g};this.fromScancode=function(m){var w;59<=m&&68>=m?w=f[m-59]:87==m?w=f[10]:88==m&&(w=f[11]);return w||""}};Aa.setKeyboard(Mb);this.setKeyboard=function(a){Aa.setKeyboard(a)};var qa=new function(){var a=!1,b=!1,c=!1,e=0;this.setAltDown=function(d){b=
d};this.setCtrlDown=function(d){a=d};this.setCursorKeyMode=function(d){svGlobal.logger.info("Esc mode:"+d+" was: "+e);e=d};this.process=function(d,h,t){if(3==t)return h;if(0==t){switch(h){case 29:case 157:return a=d,"";case 56:case 184:return b=d,"";case 42:case 54:return c=d,""}if(d){switch(h){case 28:d="\r";break;case 200:d=0==e?"\u001b[A":1==e?"\u001bOA":"\u001bA";break;case 208:d=0==e?"\u001b[B":1==e?"\u001bOB":"\u001bB";break;case 205:d=0==e?"\u001b[C":1==e?"\u001bOC":"\u001bC";break;case 203:d=
0==e?"\u001b[D":1==e?"\u001bOD":"\u001bD";break;case 59:case 60:case 61:case 62:case 63:case 64:case 65:case 66:case 67:case 68:case 87:case 88:d=Aa.fromScancode(h);break;case 15:d="\t";break;case 209:d="\u001b[6~";break;case 201:d="\u001b[5~";break;case 199:d=0==e?"\u001b[H":"\u001bOH";break;case 207:d=0==e?"\u001b[F":"\u001bOF";break;case 14:d=c?"\b":"\u007f";break;case 211:d="\u001b[3~";break;case 197:d="\u00ff\u00f3";break;case 210:d="\u001b[2~";break;case 1:d="\u001b";break;case 55:d="*";break;
case 71:d=Q.localLockFlags&2?"7":0==e?"\u001b[H":"\u001bOH";break;case 72:d=Q.localLockFlags&2?"8":0==e?"\u001b[A":"\u001bOA";break;case 73:d=Q.localLockFlags&2?"9":"\u001b[5~";break;case 74:d="-";break;case 75:d=Q.localLockFlags&2?"4":0==e?"\u001b[D":"\u001bOD";break;case 76:d=Q.localLockFlags&2?"5":"\u001bOu";break;case 77:d=Q.localLockFlags&2?"6":0==e?"\u001b[C":"\u001bOC";break;case 78:d="+";break;case 79:d=Q.localLockFlags&2?"1":0==e?"\u001b[F":"\u001bOF";break;case 80:d=Q.localLockFlags&2?"2":
0==e?"\u001b[B":"\u001bOB";break;case 81:d=Q.localLockFlags&2?"3":"\u001b[6~";break;case 82:d=Q.localLockFlags&2?"0":"\u001b[2~";break;case 83:d=Q.localLockFlags&2?".":"\u001b[3~";break;case 156:d="\r";break;case 181:d="/";break;default:return svGlobal.logger.warn("Invalid code:"+h),""}b&&(d="\u001b"+d);return d}return""}if(1==t&&d)if(a){if(64<h&&91>h)return String.fromCharCode(h-64);switch(h){case 54:return"\u001e";case 219:return"\u001b";case 220:return"\u001c";case 221:return"\u001d";case 32:return"\x00";
case 192:return"\u001e";case 191:return"\u001f";default:return svGlobal.logger.warn("Invalid key code:"+h),""}}else if(b)return"\u001b"+String.fromCharCode(h).toLowerCase()}};this.getKeyHandler=function(){return qa}};
