var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(g,m,h){if(null==g)throw new TypeError("The 'this' value for String.prototype."+h+" must not be null or undefined");if(m instanceof RegExp)throw new TypeError("First argument to String.prototype."+h+" must not be a regular expression");return g+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,m,h){if(g==Array.prototype||g==Object.prototype)return g;g[m]=h.value;return g};
$jscomp.getGlobal=function(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var m=0;m<g.length;++m){var h=g[m];if(h&&h.Math==Math)return h}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(g,m){var h=$jscomp.propertyToPolyfillSymbol[m];if(null==h)return g[m];h=g[h];return void 0!==h?h:g[m]};$jscomp.polyfill=function(g,m,h,f){m&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(g,m,h,f):$jscomp.polyfillUnisolated(g,m,h,f))};
$jscomp.polyfillUnisolated=function(g,m,h,f){h=$jscomp.global;g=g.split(".");for(f=0;f<g.length-1;f++){var c=g[f];if(!(c in h))return;h=h[c]}g=g[g.length-1];f=h[g];m=m(f);m!=f&&null!=m&&$jscomp.defineProperty(h,g,{configurable:!0,writable:!0,value:m})};
$jscomp.polyfillIsolated=function(g,m,h,f){var c=g.split(".");g=1===c.length;f=c[0];f=!g&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var a=0;a<c.length-1;a++){var e=c[a];if(!(e in f))return;f=f[e]}c=c[c.length-1];h=$jscomp.IS_SYMBOL_NATIVE&&"es6"===h?f[c]:null;m=m(h);null!=m&&(g?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:m}):m!==h&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=
$jscomp.propertyToPolyfillSymbol[c],$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:m})))};$jscomp.polyfill("String.prototype.startsWith",function(g){return g?g:function(m,h){var f=$jscomp.checkStringArgs(this,m,"startsWith");m+="";var c=f.length,a=m.length;h=Math.max(0,Math.min(h|0,f.length));for(var e=0;e<a&&h<c;)if(f[h++]!=m[e++])return!1;return e>=a}},"es6","es3");
function showTwoFAQR(g,m){var h=hi5.$("twofainfo");if(h){var f=hi5.$("barcodeDiv"),c=hi5.$("enableTwoFA"),a=hi5.$("disableTwoFA");m?(hi5.$("imgBarcode").src="data:image/png;base64,"+m,f.style.display="block",a.style.display="none",c.style.display="block"):(f.style.display="none",a.style.display="block",c.style.display="none");var e=new hi5.ui.Lightbox(h);e.show();hi5.$("faCode").focus();hi5.$("faCode").value="";c.onclick=a.onclick=function(k){var b=hi5.$("faCode").value;k=k.target==c?1:0;if(6!=b.length)hi5.notifications.notify(__svi18n.info.digit6||
"It must be a 6 digit number");else{var d=h.querySelector('input[name="pwd"]');g(b,k,d?d.value:"");e.dismiss()}}}}
svGlobal.auth=new function(){function g(a){hi5.tool.enableInput();if(a.error)svGlobal.gatewayError(a.name,a.message||a.msg);else{hi5.$("frmLogin").style.display="none";hi5.$("frmConn").style.display="block";var e=document.getElementById("pwdZone");e&&(e.style.display=a.isDomainUser?"none":"table-row-group");a.isDomainUser&&!a.twoFAEnabled&&(e=document.getElementById("settings"))&&(e.style.display="none");e=!0===a.passkey?"inline":"none";var k=document.getElementById("passkeySignIn");k&&(k.style.display=
e);if(k=document.getElementById("addPasskeyBtn"))k.style.display=e;if(k=document.getElementById("deletePasskeyBtn"))k.style.display=e;for(e=hi5.$("programs");e.hasChildNodes();)e.removeChild(e.firstChild);k=a.servers;if(!a.accessNotInList){var b=hi5.$("anyconn");b&&(b.style.display="none")}if(a.hash){b=hi5.$("gateway").value;var d=b.indexOf(":");-1!=d&&(b=b.substring(0,d));b.toLowerCase().startsWith("www.")&&(b=b.substring(4));document.cookie="__SV_TOKEN_S="+a.hash+"-"+encodeURIComponent(a.name)+
";domain=."+b}b=svGlobal.auth.getUserName(hi5.$("user").value);b||(b=a.name);window.__sparkUser={session:a.session,account:b,gateway:hi5.$("gateway").value,servers:k,twoFA:a.twoFA,twoFAEnabled:a.twoFAEnabled,twoFAQR:a.twoFAQR};a=k.length;if(!(1>a)){b="";for(d=0;d<a;d++){var p=k[d].server,n=k[d].id;p=k[d].displayName||n||p;var l=k[d].icon;l||(l="rdp32.png");var q=document.createElement("div");q.className="icon";var t=document.createElement("img");t.src=l;t.id=n;t.alt=n;t.title=p;t.style.cursor="pointer";
t.onclick=m;q.appendChild(t);q.appendChild(document.createElement("br"));q.appendChild(document.createTextNode(p));e.appendChild(q);hi5.appcfg.startup&&n===hi5.appcfg.startup.server&&(b=n)}!b&&hi5.appcfg.startup&&(console.log("start up:"+hi5.appcfg.startup.server+" not found, use the first instead"),b=k[0].id);b&&h(b,!hi5.appcfg.startup.newWindow,!0)}}}function m(a){var e=a.target;e.onclick=null;setTimeout(function(){e.onclick=m},300);h(e.id)}function h(a,e,k){var b=window.__sparkUser,d=b.servers,
p=d.length;b.server=null;window.sparkGateway=b.gateway;for(var n=0;n<p;n++){var l=d[n];if(a==l.id){l.gateway=b.gateway;l.session=b.session;l.account=b.account;b.server=l;break}}if(b.server){console.log("connecting to:"+b.server.id);(a=hi5.$("touchpad"))&&a.checked&&(b.server.touchpad=!0);if(a=hi5.$("keyboard"))a=parseInt(a.options[a.selectedIndex].value),0<a&&(b.server.keyboard=a);if(svGlobal.auth.onconnect)svGlobal.auth.onconnect(b.server);b.server.rdp&&b.server.rdp.remoteProgram&&(b.server.startProgram=
"app");a="default"==hi5.appcfg.newWindow?void 0:"width="+window.outerWidth+",height="+window.outerHeight;if(b.server.http)e=location.protocol+"//"+b.server.id+"."+b.gateway,b.server.http.path&&(e+=b.server.http.path),window.open(e,"_blank",a);else if(d="app"==b.server.startProgram,void 0==e&&(e=d),e){var q=svManager.getInstance();if(d&&q&&q.running())q.startApp(b.server.exe||b.server.rdp.remoteProgram,b.server.args||b.server.rdp.remoteArgs,""),c&&c.visible()&&c.dismiss();else{var t=function(r){function w(){null==
c&&(c=new hi5.ui.Lightbox(hi5.$("login")));c.visible()?c.dismiss():c.show()}var v=r.toolbar.querySelector("#__sv_btn_home");v||(v=r.toolbar.addButton(hi5.appcfg.img.home||"home.png",w),v.id="__sv_btn_home")};q=new Rdp2(b.server);hi5.$("login").style.display="none";var u=new svGlobal.LocalInterface;u.onremoteappicon=function(r,w){if(u.toolbar&&r.isMainWin()&&32==w.getWidth()){var v="win"+r.id;if(!u.toolbar.querySelector("#"+v)){t(u);var x=u.toolbar.addButton(w.getDataURL(),function(){r.activate(1)});
x.id=v;x.title=r.titleInfo;x.style.width="32px";x.style.height="32px";x.addEventListener("mouseover",function(){x.title=r.titleInfo},!1);setTimeout(function(){r.activate(1)},333)}}};u.onremoteappclose=function(r){u.toolbar&&(r=u.toolbar.querySelector("#win"+r.id))&&u.toolbar.removeChild(r)};q.addSurface(u);q.run();q.onclose=function(){k?showLogDlg():(q.hide(),hi5.$("login").style.display="block")}}}else e=document.getElementById("multiMon"),b.server.rdp?(b.server.rdp.multiMon=e&&e.checked?"on":"off",
window.open("rdpdirect.html","_blank",a)):b.server.vnc?window.open("vnc.html","_blank",a):b.server.ssh?window.open("sshdirect.html","_blank",a):b.server.telnet&&window.open("telnet.html","_blank",a)}else hi5.notifications.notify("Not a valid server")}var f=this,c=null;this.getLoginURL=function(){return("https:"==location.protocol?"wss://":"ws://")+hi5.$("gateway").value+"/LOGIN?"};this.closeSession=function(a,e){console.log("close session "+e+" on user "+a);window.__sparkUser&&(a||(a=window.__sparkUser.account),
e||(e=window.__sparkUser.session));a&&e&&(a=svGlobal.auth.getLoginURL()+"action=close&user="+encodeURIComponent(a)+"&svSession="+e,(new WebSocket(a,"login")).onopen=function(k){console.log("Sign out");window.__sparkUser=null})};this.showLogDlg=function(){if(hi5.appcfg&&hi5.appcfg.returnUrl)window.location.href=hi5.appcfg.returnUrl;else{var a=window.__sparkUser.account,e=window.__sparkUser.session;window.__sparkUser=null;var k=hi5.$("frmLogin");k.elements.pwd.value="";k.style.display="block";hi5.$("frmConn").style.display=
"none";(k=svManager.getInstance())&&k.running()&&k.close();svGlobal.auth.closeSession(a,e)}};this.getUserName=function(a){hi5.appcfg&&hi5.appcfg.domain&&(a.toLowerCase().startsWith(hi5.appcfg.domain.toLowerCase()+"\\")||(a=hi5.appcfg.domain+"\\"+a));return a};this.login=function(a){function e(d,p){window.__sparkUser=null;if(!f.beforelogin||!f.beforelogin(d)){hi5.tool.disableInput();var n=new WebSocket(d.substring(0,d.indexOf("?"))+"?_METHOD=post","login");n.onclose=function(l){k||(hi5.notifications.notify(__svi18n.errorCode.connection),
f.showLogDlg());hi5.tool.enableInput();f.afterlogin&&f.afterlogin(k);k=!1};n.onopen=function(l){k=!0};n.onmessage=function(l){var q=l.data,t=q.substring(0,2);if("00"==t)n.send("00"+d.substring(d.indexOf("?")+1));else if("01"==t)switch(hi5.tool.enableInput(),q.substring(2,3)){case "0":if(l=hi5.$("twofacode")){var u=new hi5.ui.Lightbox(l);u.show();var r=hi5.$("btnTwoFACode"),w=hi5.$("faAuthCode");w.focus();w.value="";r.onclick=function(){n.send("code:"+w.value);u.dismiss()};w.addEventListener("keyup",
function(v){if(13==v.keyCode||"Enter"==v.code)v.preventDefault(),r.click()})}break;case "1":l=q.substring(4),showTwoFAQR(function(v,x){n.send("code:"+v)},l)}else l=JSON.parse(l.data),0===l.type&&(l.message||l.name)?svGlobal.gatewayError(l.name,l.message||l.msg):(l.error||n.send("A1"+navigator.userAgent),p(l))}}}var k=!1,b=hi5.browser.cookie2Obj();b.svSession&&b.svEmail&&(a+="&svSession="+b.svSession+"&svEmail="+encodeURIComponent(b.svEmail));setTimeout(function(){e(a,g)},5);return!1}};
window.addEventListener("load",function(g){function m(){g.preventDefault();svGlobal.auth.beforesubmit&&svGlobal.auth.beforesubmit();var f=hi5.$("frmLogin").elements,c=svGlobal.auth.getUserName(f.user.value),a=f.pwd.value;c=svGlobal.auth.getLoginURL()+"user="+encodeURIComponent(c)+"&pwd="+encodeURIComponent(a);(a=f.sharedSecret)&&a.value&&(c+="&sharedSecret="+encodeURIComponent(a.value));f.pwd.value="";return svGlobal.auth.login(c)}function h(f,c,a){var e=svGlobal.auth.getLoginURL()+"action=code",
k=new WebSocket(e,"login");k.onmessage=function(b){b=JSON.parse(b.data);b.error?svGlobal.gatewayError(b.name,b.message||b.msg):hi5.notifications.notify(__svi18n.info.succeeded);k.close()};k.onopen=function(b){k.send("twof:"+f+"\t"+__sparkUser.account+"\t"+c+"\t"+__sparkUser.session+"\t"+a+"\t")}}(function(){hi5.PasskeyClient&&hi5.PasskeyClient.supportsPasskey(function(d){if(d){if(d=document.getElementById("passkeySignIn")){var p=new hi5.PasskeyClient;d.addEventListener("click",function(n){n.preventDefault();
p.passkeySignIn()});(d=document.getElementById("addPasskeyBtn"))&&d.addEventListener("click",function(n){p.passkeyAdd()});(d=document.getElementById("deletePasskeyBtn"))&&d.addEventListener("click",function(n){p.passkeyDel()})}}else(d=hi5.$("passkeySignIn"))&&d.parentNode.removeChild(d),(d=hi5.$("addPasskeyBtn"))&&d.parentNode.removeChild(d),(d=hi5.$("deletePasskeyBtn"))&&d.parentNode.removeChild(d)});hi5.$("user").focus();hi5.$("frmLogin").onsubmit=m;var f=hi5.$("anyconn");f&&(f.onclick=function(){var d=
"default"==hi5.appcfg.newWindow?void 0:"width="+window.outerWidth+",height="+window.outerHeight;window.open("rdp.html?gateway="+hi5.$("gateway").value,"_blank",d)});if(f=document.querySelector('input[name="showlogin"]'))f.onclick=svGlobal.auth.showLogDlg;var c=hi5.browser.cookie2Obj(),a=-1!=document.cookie.indexOf("__SV_TOKEN_A"),e=hi5.tool.queryToObj();if(c.svEmail||c.user||a||e.autoLogin||e.user&&e.pwd){var k=hi5.$("frmLogin").elements;k.user.value=c.svEmail||c.user||e.user||"";k.pwd.value=(c.svSession?
"fake":c.pwd)||e.pwd||"_";c.gateway&&(k.gateway.value=c.gateway);(k.user.value&&k.pwd.value||c.autoLogin||a||e.autoLogin)&&setTimeout(m,30)}f=hi5.$("settings");var b=hi5.$("settingsDiv");f&&(f.onclick=function(){if(b){var d=document.getElementById("2fa_code_pwd");d&&(d.style.display=__sparkUser.twoFAEnabled?"table-row":"none");(new hi5.ui.Lightbox(b)).show();hi5.$("currPwd").focus();if(d=hi5.$("btnTwoFA"))d.onclick=function(){showTwoFAQR(h,window.__sparkUser.twoFAQR)},0==__sparkUser.twoFA&&d.parentNode.removeChild(d)}});
if(f=hi5.$("frmSettings"))f.onsubmit=function(d){d.preventDefault();var p=d.target.elements;if(p.newPwd1.value!=p.newPwd2.value)hi5.notifications.notify(__svi18n.errorCode.pwdmatch);else{d=svGlobal.auth.getLoginURL()+"_METHOD=post&action=put";var n=new WebSocket(d,"login");n.onmessage=function(l){if(0==l.data.indexOf("00")){l="00currPwd="+encodeURIComponent(p.currPwd.value)+"&newPwd="+encodeURIComponent(p.newPwd1.value);l+="&user="+encodeURIComponent(svGlobal.auth.getUserName(hi5.$("user").value));
var q=f.elements.faCode;q&&(l+="&code="+q.value);n.send(l);hi5.$("frmSettings").reset()}else l=JSON.parse(l.data),l.error&&svGlobal.gatewayError(l.name,l.message||l.msg)};b.dismiss&&b.dismiss();return!1}};c=hi5.$("gateway");(a=c.value)||(a=hi5.appcfg.defaultPort?window.location.hostname+":"+hi5.appcfg.defaultPort:window.location.host);0==a.length&&(a="localhost");c.value=a;c=hi5.$("touchpadmode");hi5.browser.isTouch&&(c.style.display="");(c=hi5.$("user"))&&!c.value&&hi5.appcfg&&hi5.appcfg.domain&&
!hi5.appcfg.hiddenDomain&&(c.value=hi5.appcfg.domain+"\\");(function(){var d=!1,p="";try{document.createElement("canvas").getContext("2d"),d=!0}catch(t){p="This browser does not support Canvas.\n\n"}var n=!("WebSocket"in window)&&!("MozWebSocket"in window),l=navigator.userAgent,q=-1!=l.indexOf("Firefox");n&&(p+="This browser doesn't support WebSocket.\n\n",q?p+="Please update to Firefox 6 or later.\n\n":-1!=l.indexOf("Opera")?p+="Please open 'opera:config#Enable WebSockets' (type it in the link field) make 'Enable WebSockets' selected and restart Opera.\n\n":
-1!=l.indexOf("MSIE")&&(p+="Please install Google Chrome Frame.\n\n"));0<p.length&&hi5.notifications.notify(p);return!n&&d})();(c=hi5.$("defPort"))&&hi5.appcfg.defaultPort&&(c.innerHTML=hi5.appcfg.defaultPort);(c=document.getElementById("frmConn"))&&(c=c.querySelector('select[name="keyboard"]'));c&&(a=svGlobal.Rdp.languageToKeyboard.detect())&&(c.value=a)})()},!1);window.addEventListener("beforeunload",function(){svGlobal.auth.closeSession()},!1);
